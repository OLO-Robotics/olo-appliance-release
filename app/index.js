const a1_0x4b4039=a1_0x3351;function a1_0x4895(){const _0x3a857f=['totalTopics','action','/appliance/ping','/rosbridge?type=appliance&token=','message','post','\x20attempts\x20starting\x20from\x20','hide','.env','substring','376yDNseU','readyState','Authentication\x20required','dotenv','urdf_param_data','listen','length','Registering\x20with\x20server...','Backend\x20Server\x20URL:\x20','strategy','toString','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','Bearer\x20','connection','send','Proxy\x20listening\x20on\x20port:\x20','get','types','initialize','295034BqQUAm','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','data','msg','Topic\x20discovery\x20failed:','robotId','discoverTopics','match','PORT','isAuthenticated','estimatedSize','wsEndpoint','replace','APP_USERNAME=','WSL\x20Appliance','proxyPort','getTopicStrategy','code','Connected\x20to\x20server','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','registrationToken','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','toLowerCase','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','Port\x20','1025037ZzctPl','.ply','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','existsSync','unknown','use','Failed\x20to\x20connect\x20to\x20server:','prompt-sync','Access-Control-Allow-Headers','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','strategies','ROSBridge\x20(WebRTC)\x20connection\x20error:','password','includes','setAttribute','exit','login','parse','application/json','trim','\x20in\x20use,\x20trying\x20next\x20port...','String\x20value\x20is:\x20','slice','Access-Control-Allow-Methods','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','warn','get_urdf_param','join','),\x20attempting\x20to\x20reconnect...','getElementsByTagName','child_process','uri','string','Failed\x20to\x20start\x20application:','serverUrl','method','service','config','samplingRate','type','error','filename','Connected\x20to\x20ROSBridge\x20(WebRTC)','stringify','OPTIONS','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','802536xVkKKB','handleMessage','./config','\x0aAPP_PASSWORD=','open','Appliance\x20is\x20running\x20and\x20authenticated!','topics','map','service_response','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','stopAllSessions','5vMUfXu','writeFileSync','NODE_ENV','Loaded\x20appliance\x20identity:','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','.stl','json','parseFromString','APP_USERNAME','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','ROSBridge\x20(main)\x20connection\x20error:','search','development','getSharedVideoSources','unlinkSync','forward','utf8','webrtc_skip','.mesh','/robot_description','some','./services/TopicManager','serializeToString','credentials','base64','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','Enter\x20username:\x20','2lTnBas','close','[MESH]\x20Successfully\x20served\x20mesh:\x20','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','publish','log','/health','path','ros2\x20pkg\x20prefix\x20','(((.+)+)+)+$','largeDataTopics','roslib','loadConfig','Attempting\x20to\x20login\x20to:','sample_skip','174378TTkWOz','request_id','get_mesh','/appliance/register','readFileSync','express','sample','APPLIANCE_BASE_URL','[URDF\x20REWRITE]\x20Rewrote\x20','mesh_data','topic','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','/ros/mesh?uri=','APP_PASSWORD','env','values','ros2\x20param\x20get\x20','\x20from\x20','\x20of\x20','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','935596CXiDXJ','OPEN','Server\x20connection\x20error:','getToken','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','getAttribute','sendStatus','.dae','startsWith','522731Tsvqqz','response','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','70GvafbD','Ros','param_name','35693qjbMSr','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','name','[MESH]\x20Error\x20serving\x20mesh:','mesh','Failed\x20to\x20ping\x20server:','reason','xmldom','constructor','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','rosbridge','share','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','header','Access-Control-Allow-Origin','endsWith'];a1_0x4895=function(){return _0x3a857f;};return a1_0x4895();}function a1_0x3351(_0x3c554b,_0x1d4133){const _0x436ae7=a1_0x4895();return a1_0x3351=function(_0xb6d553,_0x49a683){_0xb6d553=_0xb6d553-0x15f;let _0x489518=_0x436ae7[_0xb6d553];return _0x489518;},a1_0x3351(_0x3c554b,_0x1d4133);}(function(_0x56a8de,_0x6ffe52){const _0x329258=a1_0x3351,_0x448bc7=_0x56a8de();while(!![]){try{const _0x2df06d=-parseInt(_0x329258(0x1c0))/0x1*(parseInt(_0x329258(0x161))/0x2)+parseInt(_0x329258(0x170))/0x3+parseInt(_0x329258(0x184))/0x4*(parseInt(_0x329258(0x213))/0x5)+parseInt(_0x329258(0x207))/0x6+-parseInt(_0x329258(0x193))/0x7*(-parseInt(_0x329258(0x1ad))/0x8)+parseInt(_0x329258(0x1d9))/0x9+-parseInt(_0x329258(0x190))/0xa*(parseInt(_0x329258(0x18d))/0xb);if(_0x2df06d===_0x6ffe52)break;else _0x448bc7['push'](_0x448bc7['shift']());}catch(_0x123660){_0x448bc7['push'](_0x448bc7['shift']());}}}(a1_0x4895,0x2505e));const a1_0x49a683=(function(){let _0x61874d=!![];return function(_0x113e36,_0x457174){const _0x1d3794=_0x61874d?function(){if(_0x457174){const _0x3f0f2b=_0x457174['apply'](_0x113e36,arguments);return _0x457174=null,_0x3f0f2b;}}:function(){};return _0x61874d=![],_0x1d3794;};}()),a1_0xb6d553=a1_0x49a683(this,function(){const _0x120d80=a1_0x3351;return a1_0xb6d553['toString']()[_0x120d80(0x21e)](_0x120d80(0x16a))['toString']()[_0x120d80(0x19b)](a1_0xb6d553)[_0x120d80(0x21e)]('(((.+)+)+)+$');});a1_0xb6d553();const express=require(a1_0x4b4039(0x175)),config=require(a1_0x4b4039(0x209)),authService=require('./services/auth'),webrtcService=require('./services/webrtcService'),topicManager=require(a1_0x4b4039(0x228)),WebSocket=require('ws'),axios=require('axios'),fs=require('fs'),prompt=require(a1_0x4b4039(0x1e0))({'sigint':!![]}),dotenv=require(a1_0x4b4039(0x1b0)),app=express(),port=process['env'][a1_0x4b4039(0x1c8)]||config[a1_0x4b4039(0x19d)][a1_0x4b4039(0x1cf)],APPLIANCE_FILE='.appliance.json',{DOMParser,XMLSerializer}=require(a1_0x4b4039(0x19a)),path=require(a1_0x4b4039(0x168)),{execSync}=require(a1_0x4b4039(0x1f7)),APPLIANCE_BASE_URL=process['env'][a1_0x4b4039(0x177)]||'';console['log']('Environment:\x20'+(process['env'][a1_0x4b4039(0x215)]||'development')),console[a1_0x4b4039(0x166)](a1_0x4b4039(0x1b5)+config['serverUrl']),console[a1_0x4b4039(0x166)]('ROSBridge\x20WebSocket\x20URL:\x20'+config[a1_0x4b4039(0x19d)][a1_0x4b4039(0x1cb)]),console[a1_0x4b4039(0x166)](a1_0x4b4039(0x1bc)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x3a9558,_0x2b7d7e){const _0x437ccb=a1_0x4b4039;fs[_0x437ccb(0x214)](_0x437ccb(0x1ab),_0x437ccb(0x1cd)+_0x3a9558+_0x437ccb(0x20a)+_0x2b7d7e+'\x0a');}function reloadEnv(){const _0x356e60=a1_0x4b4039;dotenv[_0x356e60(0x1fe)]({'override':!![]}),config[_0x356e60(0x22a)]['username']=process[_0x356e60(0x17e)][_0x356e60(0x21b)],config[_0x356e60(0x22a)][_0x356e60(0x1e5)]=process[_0x356e60(0x17e)][_0x356e60(0x17d)];}async function promptForCredentials(){const _0x37b9ea=a1_0x4b4039,_0x5eb418=prompt(_0x37b9ea(0x160)),_0x11e7e9=prompt[_0x37b9ea(0x1aa)]('Enter\x20password:\x20');updateEnvFile(_0x5eb418,_0x11e7e9),reloadEnv();}function loadApplianceIdentity(){const _0x618f0d=a1_0x4b4039;if(fs[_0x618f0d(0x1dc)](APPLIANCE_FILE))try{const _0xc25079=JSON[_0x618f0d(0x1ea)](fs['readFileSync'](APPLIANCE_FILE,_0x618f0d(0x223)));if(_0xc25079[_0x618f0d(0x1c5)]&&_0xc25079[_0x618f0d(0x1d4)])return robotId=_0xc25079['robotId'],registrationToken=_0xc25079[_0x618f0d(0x1d4)],console['log'](_0x618f0d(0x216),robotId),topicManager[_0x618f0d(0x16d)](_0xc25079),!![];}catch(_0x5e30e3){console['error'](_0x618f0d(0x1f1),_0x5e30e3);}return![];}function saveApplianceIdentity(_0x5419d4,_0xe4ccb3){const _0x26b719=a1_0x4b4039;let _0xfd3ca4={};if(fs[_0x26b719(0x1dc)](APPLIANCE_FILE))try{_0xfd3ca4=JSON[_0x26b719(0x1ea)](fs[_0x26b719(0x174)](APPLIANCE_FILE,_0x26b719(0x223)));}catch(_0x5d64a0){_0xfd3ca4={};}_0xfd3ca4['robotId']=_0x5419d4,_0xfd3ca4[_0x26b719(0x1d4)]=_0xe4ccb3,fs[_0x26b719(0x214)](APPLIANCE_FILE,JSON[_0x26b719(0x204)](_0xfd3ca4,null,0x2));}async function registerWithServer(){const _0x27f3ac=a1_0x4b4039;try{const _0x2d5285=authService['getToken']();if(!_0x2d5285)throw new Error('Not\x20authenticated');let _0x879f00,_0x3dbe85=![];while(!![]){try{robotId&&registrationToken?_0x879f00=await axios[_0x27f3ac(0x1a8)](config[_0x27f3ac(0x1fb)]+_0x27f3ac(0x173),{'name':_0x27f3ac(0x1ce),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x27f3ac(0x1b9)+_0x2d5285,'Content-Type':_0x27f3ac(0x1eb)}}):_0x879f00=await axios[_0x27f3ac(0x1a8)](config['serverUrl']+_0x27f3ac(0x173),{'name':_0x27f3ac(0x1ce)},{'headers':{'Authorization':_0x27f3ac(0x1b9)+_0x2d5285,'Content-Type':_0x27f3ac(0x1eb)}});break;}catch(_0x393517){const _0x562544=_0x393517?.[_0x27f3ac(0x18e)]?.['data']?.[_0x27f3ac(0x201)]||_0x393517[_0x27f3ac(0x1a7)];if(!_0x3dbe85&&_0x562544&&_0x562544[_0x27f3ac(0x1d6)]()[_0x27f3ac(0x1e6)]('robot\x20not\x20found')){console[_0x27f3ac(0x1f2)]('Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.');if(fs[_0x27f3ac(0x1dc)](APPLIANCE_FILE))fs[_0x27f3ac(0x221)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x3dbe85=!![];continue;}throw _0x393517;}}if(!_0x879f00[_0x27f3ac(0x1c2)]||!_0x879f00[_0x27f3ac(0x1c2)]['registration_token']||!_0x879f00[_0x27f3ac(0x1c2)]['id'])throw new Error(_0x27f3ac(0x211));return registrationToken=_0x879f00[_0x27f3ac(0x1c2)]['registration_token'],robotId=_0x879f00[_0x27f3ac(0x1c2)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x27f3ac(0x166)]('Successfully\x20registered\x20with\x20server'),!![];}catch(_0x5f27aa){return console[_0x27f3ac(0x201)]('Failed\x20to\x20register\x20with\x20server:',_0x5f27aa[_0x27f3ac(0x1a7)]),![];}}function rewriteUrdfMeshUris(_0xa17c4b){const _0xcc180=a1_0x4b4039;try{const _0x2d2668=new DOMParser(),_0x263f01=_0x2d2668[_0xcc180(0x21a)](_0xa17c4b,'text/xml');let _0x337b04=0x0,_0x1c72e7=0x0;const _0x2fa96c=_0x263f01[_0xcc180(0x1f6)](_0xcc180(0x197));for(let _0xa6da59=0x0;_0xa6da59<_0x2fa96c[_0xcc180(0x1b3)];_0xa6da59++){const _0x5f58c6=_0x2fa96c[_0xa6da59],_0x42b81a=_0x5f58c6[_0xcc180(0x189)](_0xcc180(0x202)),_0x1fc84e=[_0xcc180(0x218),_0xcc180(0x18b),'.obj',_0xcc180(0x1da),_0xcc180(0x225)],_0x11b510=_0x1fc84e[_0xcc180(0x227)](_0x43f8eb=>_0x42b81a[_0xcc180(0x1d6)]()[_0xcc180(0x1a2)](_0x43f8eb));if(_0x42b81a&&_0x42b81a[_0xcc180(0x18c)]('package://')&&_0x11b510){_0x337b04++;const _0x15b953=APPLIANCE_BASE_URL+_0xcc180(0x17c)+encodeURIComponent(_0x42b81a);_0x5f58c6[_0xcc180(0x1e7)](_0xcc180(0x202),_0x15b953),_0x1c72e7++,console[_0xcc180(0x166)](_0xcc180(0x206)+_0x42b81a+'\x20->\x20'+_0x15b953);}}_0x337b04>0x0?console[_0xcc180(0x166)](_0xcc180(0x178)+_0x1c72e7+_0xcc180(0x182)+_0x337b04+_0xcc180(0x183)):console['log'](_0xcc180(0x15f));const _0x2c7e0f=new XMLSerializer();return _0x2c7e0f[_0xcc180(0x229)](_0x263f01);}catch(_0x499802){return console[_0xcc180(0x201)](_0xcc180(0x1b8),_0x499802),_0xa17c4b;}}function connectToRosbridge(){const _0x58f67f=a1_0x4b4039;try{rosbridgeWs=new WebSocket(config[_0x58f67f(0x19d)][_0x58f67f(0x1cb)]),rosbridgeWs['on'](_0x58f67f(0x20b),()=>{const _0x275ac7=_0x58f67f;console[_0x275ac7(0x166)]('Connected\x20to\x20ROSBridge\x20(main)');const _0x25cb50=require(_0x275ac7(0x16c)),_0x2ed70f=new _0x25cb50[(_0x275ac7(0x191))]({'url':config[_0x275ac7(0x19d)]['wsEndpoint']});_0x2ed70f['on'](_0x275ac7(0x1ba),()=>{setTimeout(()=>{const _0x3d20b2=a1_0x3351;topicManager[_0x3d20b2(0x1c6)](_0x2ed70f)['catch'](_0x42ad4b=>{const _0xcd37bb=_0x3d20b2;console[_0xcd37bb(0x201)](_0xcd37bb(0x1c4),_0x42ad4b);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x58f67f(0x1a7),_0x4ed934=>{const _0x397024=_0x58f67f;if(serverWs&&serverWs[_0x397024(0x1ae)]===WebSocket[_0x397024(0x185)]){let _0x3eee43=_0x4ed934[_0x397024(0x1b7)]();try{const _0x411222=JSON[_0x397024(0x1ea)](_0x3eee43);if(_0x411222['op']===_0x397024(0x165)&&_0x411222[_0x397024(0x17a)]){const _0x26e078=topicManager[_0x397024(0x208)](_0x411222);switch(_0x26e078[_0x397024(0x1a4)]){case _0x397024(0x16f):return;case _0x397024(0x224):return;case _0x397024(0x222):default:_0x3eee43=JSON[_0x397024(0x204)](_0x26e078[_0x397024(0x1a7)]);break;}}if((_0x411222['op']===_0x397024(0x20f)||_0x411222['op']==='call_service')&&(_0x411222[_0x397024(0x1fd)]==='/rosapi/topics'||_0x411222[_0x397024(0x17f)]&&_0x411222[_0x397024(0x17f)][_0x397024(0x20d)])){console[_0x397024(0x166)](_0x397024(0x194));const _0x32cbee=_0x411222['values']?.[_0x397024(0x20d)]||[],_0x10be9b=_0x411222[_0x397024(0x17f)]?.[_0x397024(0x1be)]||[],_0x140ae6=_0x32cbee['map']((_0x46752c,_0x49d4cd)=>{const _0x15b184=_0x397024,_0xd23840=topicManager[_0x15b184(0x1d0)](_0x46752c);return{'name':_0x46752c,'type':_0x10be9b[_0x49d4cd]||_0x15b184(0x1dd),'throttling':_0xd23840?{'isThrottled':_0xd23840[_0x15b184(0x1b6)]===_0x15b184(0x176),'strategy':_0xd23840['strategy'],'samplingRate':_0xd23840[_0x15b184(0x1ff)],'reason':_0xd23840[_0x15b184(0x199)],'estimatedSize':_0xd23840[_0x15b184(0x1ca)]}:null};});_0x411222[_0x397024(0x17f)]={'topics':_0x140ae6['map'](_0x150326=>_0x150326[_0x397024(0x195)]),'types':_0x140ae6[_0x397024(0x20e)](_0x339acf=>_0x339acf[_0x397024(0x200)]),'throttling':_0x140ae6[_0x397024(0x20e)](_0x5e56df=>_0x5e56df['throttling'])},_0x3eee43=JSON['stringify'](_0x411222),console[_0x397024(0x166)](_0x397024(0x1db));}if(_0x411222['op']==='publish'&&_0x411222[_0x397024(0x17a)]===_0x397024(0x226))try{const _0x2cf81e=_0x411222[_0x397024(0x1c3)]['data'],_0x6bd0e7=rewriteUrdfMeshUris(_0x2cf81e);_0x411222[_0x397024(0x1c3)][_0x397024(0x1c2)]=_0x6bd0e7,_0x3eee43=JSON[_0x397024(0x204)](_0x411222);}catch(_0x31d503){console[_0x397024(0x201)](_0x397024(0x1d5),_0x31d503);}}catch(_0x9044b2){console['warn'](_0x397024(0x1d7),_0x9044b2[_0x397024(0x1a7)]);}serverWs['send'](_0x3eee43);}}),rosbridgeWs['on'](_0x58f67f(0x162),()=>{console['log']('Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...'),webrtcService['stopAllSessions'](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x58f67f(0x201),_0x52b5c8=>{const _0x523d69=_0x58f67f;console[_0x523d69(0x201)](_0x523d69(0x21d),_0x52b5c8);});}catch(_0x3c9d86){console[_0x58f67f(0x201)](_0x58f67f(0x1d3),_0x3c9d86),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x43ec9b=a1_0x4b4039;try{rosbridgeWebRTCWs=new WebSocket(config[_0x43ec9b(0x19d)][_0x43ec9b(0x1cb)]),rosbridgeWebRTCWs['on'](_0x43ec9b(0x20b),()=>{const _0x43ce7e=_0x43ec9b;console['log'](_0x43ce7e(0x203)),webrtcService[_0x43ce7e(0x1bf)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on']('message',_0x341771=>{}),rosbridgeWebRTCWs['on'](_0x43ec9b(0x162),()=>{const _0x18ccbf=_0x43ec9b;console[_0x18ccbf(0x166)](_0x18ccbf(0x19f)),webrtcService[_0x18ccbf(0x212)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x43ec9b(0x201),_0x459109=>{const _0x5e453d=_0x43ec9b;console['error'](_0x5e453d(0x1e4),_0x459109);});}catch(_0x1771f8){console[_0x43ec9b(0x201)](_0x43ec9b(0x217),_0x1771f8),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x1c2c75=a1_0x4b4039;try{if(!registrationToken)throw new Error(_0x1c2c75(0x19c));const _0x3076c4=config['serverUrl'][_0x1c2c75(0x1cc)]('http','ws')+_0x1c2c75(0x1a6)+registrationToken;serverWs=new WebSocket(_0x3076c4),serverWs['on'](_0x1c2c75(0x20b),()=>{const _0x5340f4=_0x1c2c75;console[_0x5340f4(0x166)](_0x5340f4(0x1d2)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x5340f4(0x1ae)]===WebSocket[_0x5340f4(0x185)]&&webrtcService[_0x5340f4(0x1bf)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x1c2c75(0x1a7),_0x50c91a=>{const _0x1526f4=_0x1c2c75;if(rosbridgeWs&&rosbridgeWs['readyState']===WebSocket[_0x1526f4(0x185)]){let _0x36449a=_0x50c91a[_0x1526f4(0x1b7)]();try{const _0x13cb94=JSON['parse'](_0x36449a);if(webrtcService[_0x1526f4(0x208)](_0x13cb94))return;if(_0x13cb94['op']===_0x1526f4(0x1f3)&&typeof _0x13cb94[_0x1526f4(0x192)]===_0x1526f4(0x1f9)&&_0x13cb94[_0x1526f4(0x171)])try{console['log'](_0x1526f4(0x210)+_0x13cb94[_0x1526f4(0x192)]);const _0x1bc2b9=execSync(_0x1526f4(0x180)+_0x13cb94[_0x1526f4(0x192)],{'encoding':_0x1526f4(0x223)})[_0x1526f4(0x1ec)]();let _0x4ee055=_0x1bc2b9;_0x1bc2b9[_0x1526f4(0x18c)](_0x1526f4(0x1ee))&&(_0x4ee055=_0x1bc2b9[_0x1526f4(0x1ac)]('String\x20value\x20is:\x20'[_0x1526f4(0x1b3)]()));_0x4ee055[_0x1526f4(0x18c)]('\x22')&&_0x4ee055[_0x1526f4(0x1a2)]('\x22')&&(_0x4ee055=_0x4ee055[_0x1526f4(0x1ef)](0x1,-0x1));_0x4ee055=_0x4ee055['replace'](/\\n/g,'\x0a')[_0x1526f4(0x1cc)](/\\"/g,'\x22');const _0x89d91={'op':'urdf_param_data','request_id':_0x13cb94[_0x1526f4(0x171)],'data':_0x4ee055};serverWs[_0x1526f4(0x1bb)](JSON[_0x1526f4(0x204)](_0x89d91)),console['log'](_0x1526f4(0x18f)+_0x13cb94[_0x1526f4(0x192)]);return;}catch(_0xfb81d3){console[_0x1526f4(0x201)](_0x1526f4(0x1e2),_0xfb81d3);const _0x372720={'op':_0x1526f4(0x1b1),'request_id':_0x13cb94[_0x1526f4(0x171)],'error':_0xfb81d3[_0x1526f4(0x1a7)]};serverWs[_0x1526f4(0x1bb)](JSON[_0x1526f4(0x204)](_0x372720));return;}if(_0x13cb94['op']===_0x1526f4(0x172)&&typeof _0x13cb94['uri']==='string'&&_0x13cb94[_0x1526f4(0x171)])try{const _0x507c8c=_0x13cb94['uri'][_0x1526f4(0x1c7)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x507c8c){const _0xcb0371=_0x507c8c[0x1],_0x113469=_0x507c8c[0x2],_0x5efd95=execSync(_0x1526f4(0x169)+_0xcb0371,{'encoding':_0x1526f4(0x223)})[_0x1526f4(0x1ec)](),_0x153461=path[_0x1526f4(0x1f4)](_0x5efd95,_0x1526f4(0x19e),_0xcb0371,_0x113469);if(!fs[_0x1526f4(0x1dc)](_0x153461))throw new Error('Mesh\x20file\x20not\x20found:\x20'+_0x153461);const _0x322fa3=fs[_0x1526f4(0x174)](_0x153461),_0x1a4585={'op':_0x1526f4(0x179),'request_id':_0x13cb94[_0x1526f4(0x171)],'data':_0x322fa3[_0x1526f4(0x1b7)](_0x1526f4(0x22b))};serverWs[_0x1526f4(0x1bb)](JSON[_0x1526f4(0x204)](_0x1a4585)),console[_0x1526f4(0x166)](_0x1526f4(0x163)+_0x13cb94[_0x1526f4(0x1f8)]+_0x1526f4(0x181)+_0x153461);return;}}catch(_0x3abdd3){console[_0x1526f4(0x201)](_0x1526f4(0x196),_0x3abdd3);const _0x1da8b1={'op':'mesh_data','request_id':_0x13cb94[_0x1526f4(0x171)],'error':_0x3abdd3[_0x1526f4(0x1a7)]};serverWs[_0x1526f4(0x1bb)](JSON[_0x1526f4(0x204)](_0x1da8b1));return;}rosbridgeWs[_0x1526f4(0x1bb)](_0x36449a);}catch(_0x22b606){rosbridgeWs[_0x1526f4(0x1bb)](_0x36449a);}}}),serverWs['on'](_0x1c2c75(0x162),(_0x242cb4,_0x30cf66)=>{const _0x5de1b2=_0x1c2c75;console[_0x5de1b2(0x166)]('Disconnected\x20from\x20server\x20('+_0x242cb4+':\x20'+_0x30cf66+_0x5de1b2(0x1f5)),webrtcService[_0x5de1b2(0x212)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x1c2c75(0x201),_0x10d53b=>{const _0x54f197=_0x1c2c75;console[_0x54f197(0x201)](_0x54f197(0x186),_0x10d53b);});}catch(_0x2ab770){console[_0x1c2c75(0x201)](_0x1c2c75(0x1df),_0x2ab770),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x1f1739,_0x27228d,_0x2b7e3d)=>{const _0x378c6d=a1_0x4b4039;if(!authService[_0x378c6d(0x1c9)]()){console[_0x378c6d(0x166)](_0x378c6d(0x16e),config[_0x378c6d(0x1fb)]);const _0x3267e7=await authService[_0x378c6d(0x1e9)]();if(!_0x3267e7)return _0x27228d['status'](0x191)[_0x378c6d(0x219)]({'error':_0x378c6d(0x1af)});}_0x2b7e3d();};app[a1_0x4b4039(0x1de)]((_0x583167,_0x120679,_0x27eb8a)=>{const _0x3c55f7=a1_0x4b4039;_0x120679['header'](_0x3c55f7(0x1a1),'*'),_0x120679['header'](_0x3c55f7(0x1f0),_0x3c55f7(0x21c)),_0x120679[_0x3c55f7(0x1a0)](_0x3c55f7(0x1e1),_0x3c55f7(0x1c1)),_0x583167[_0x3c55f7(0x1fc)]===_0x3c55f7(0x205)?_0x120679[_0x3c55f7(0x18a)](0xc8):_0x27eb8a();}),app['get']('/',requireAuth,(_0x56776e,_0x2912e4)=>{const _0x168ad6=a1_0x4b4039;_0x2912e4['send'](_0x168ad6(0x20c));}),app[a1_0x4b4039(0x1bd)](a1_0x4b4039(0x167),async(_0x440086,_0x8dc39c)=>{const _0x81bf8b=a1_0x4b4039,_0x24d03a=authService[_0x81bf8b(0x1c9)](),_0x484a48=webrtcService['getActiveSessions'](),_0x2d6128=webrtcService[_0x81bf8b(0x220)](),_0x5c033d=topicManager['getStatistics']();_0x8dc39c[_0x81bf8b(0x219)]({'status':'ok','environment':process['env']['NODE_ENV']||_0x81bf8b(0x21f),'backendUrl':config[_0x81bf8b(0x1fb)],'rosbridgeUrl':config[_0x81bf8b(0x19d)][_0x81bf8b(0x1cb)],'proxyPort':port,'authenticated':_0x24d03a,'topicManagement':{'discovered':_0x5c033d[_0x81bf8b(0x1a3)],'strategies':_0x5c033d[_0x81bf8b(0x1e3)],'largeDataTopics':_0x5c033d['largeDataTopics']['length'],'largeTopicsList':_0x5c033d[_0x81bf8b(0x16b)]},'webrtc':{'activeSessions':_0x484a48[_0x81bf8b(0x1b3)],'sharedVideoSources':_0x2d6128['length'],'sessions':_0x484a48,'sharedSources':_0x2d6128}});});const getInitialPort=()=>{const _0x17a0ac=a1_0x4b4039;if(process[_0x17a0ac(0x17e)][_0x17a0ac(0x1c8)])return parseInt(process[_0x17a0ac(0x17e)][_0x17a0ac(0x1c8)],0xa);return config[_0x17a0ac(0x19d)]['proxyPort'];};async function listenWithRetries(_0x1fb6cc,_0x3ee77f,_0x5bc607=0xa){const _0x3665d0=a1_0x4b4039;let _0x5ebba6=_0x3ee77f;for(let _0x4d17ab=0x1;_0x4d17ab<=_0x5bc607;_0x4d17ab++){try{return await new Promise((_0x28553f,_0x3e86b0)=>{const _0x3a5f93=a1_0x3351,_0x4de9ad=_0x1fb6cc[_0x3a5f93(0x1b2)](_0x5ebba6,()=>{const _0x3609dd=_0x3a5f93;console[_0x3609dd(0x166)](_0x3609dd(0x17b)+_0x5ebba6),_0x28553f(_0x4de9ad);});_0x4de9ad['on'](_0x3a5f93(0x201),_0x4c17cb=>{const _0x2e6700=_0x3a5f93;_0x4c17cb[_0x2e6700(0x1d1)]==='EADDRINUSE'?(console[_0x2e6700(0x1f2)](_0x2e6700(0x1d8)+_0x5ebba6+_0x2e6700(0x1ed)),_0x3e86b0(_0x4c17cb)):_0x3e86b0(_0x4c17cb);});}),_0x5ebba6;}catch(_0x43ae38){_0x5ebba6++;}}throw new Error(_0x3665d0(0x164)+_0x5bc607+_0x3665d0(0x1a9)+_0x3ee77f);}const startApp=async()=>{const _0x72e9d8=a1_0x4b4039;try{let _0x347fef=await authService[_0x72e9d8(0x1e9)]();while(!_0x347fef){console['log'](_0x72e9d8(0x188)),await promptForCredentials(),_0x347fef=await authService[_0x72e9d8(0x1e9)]();}console[_0x72e9d8(0x166)]('Successfully\x20logged\x20in');!loadApplianceIdentity()&&console[_0x72e9d8(0x166)]('No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.');console[_0x72e9d8(0x166)](_0x72e9d8(0x1b4));const _0x28c62e=await registerWithServer();if(!_0x28c62e)throw new Error('Failed\x20to\x20register\x20with\x20server');connectToRosbridge(),connectToServer();const _0x1e9ac5=getInitialPort();await listenWithRetries(app,_0x1e9ac5,0xa);}catch(_0x4efeae){console[_0x72e9d8(0x201)](_0x72e9d8(0x1fa),_0x4efeae),process[_0x72e9d8(0x1e8)](0x1);}};setInterval(async()=>{const _0x191cfd=a1_0x4b4039;try{if(robotId){const _0x1623f2=authService[_0x191cfd(0x187)]();await axios[_0x191cfd(0x1a8)](config[_0x191cfd(0x1fb)]+_0x191cfd(0x1a5),{'robotId':robotId},{'headers':{'Authorization':_0x191cfd(0x1b9)+_0x1623f2,'Content-Type':_0x191cfd(0x1eb)}});}}catch(_0x3f2cc7){console[_0x191cfd(0x201)](_0x191cfd(0x198),_0x3f2cc7[_0x191cfd(0x1a7)]);}},0x1388),startApp();