const a1_0x313efa=a1_0x57a2;(function(_0x3e9b1e,_0x4703dc){const _0x1707d1=a1_0x57a2,_0x4911ff=_0x3e9b1e();while(!![]){try{const _0x1555f1=-parseInt(_0x1707d1(0x205))/0x1+-parseInt(_0x1707d1(0x1ef))/0x2*(parseInt(_0x1707d1(0x1e0))/0x3)+-parseInt(_0x1707d1(0x1aa))/0x4+parseInt(_0x1707d1(0x16f))/0x5+parseInt(_0x1707d1(0x1d6))/0x6+parseInt(_0x1707d1(0x203))/0x7*(parseInt(_0x1707d1(0x1a1))/0x8)+parseInt(_0x1707d1(0x19d))/0x9;if(_0x1555f1===_0x4703dc)break;else _0x4911ff['push'](_0x4911ff['shift']());}catch(_0x43dd04){_0x4911ff['push'](_0x4911ff['shift']());}}}(a1_0x1c21,0xc9cec));const a1_0x16c039=(function(){let _0x45ab8f=!![];return function(_0x13b7e4,_0x2c60b5){const _0xd47f2d=_0x45ab8f?function(){const _0x294b55=a1_0x57a2;if(_0x2c60b5){const _0x4b371d=_0x2c60b5[_0x294b55(0x183)](_0x13b7e4,arguments);return _0x2c60b5=null,_0x4b371d;}}:function(){};return _0x45ab8f=![],_0xd47f2d;};}()),a1_0x1e2f04=a1_0x16c039(this,function(){const _0x36373a=a1_0x57a2;return a1_0x1e2f04[_0x36373a(0x210)]()[_0x36373a(0x176)](_0x36373a(0x17e))[_0x36373a(0x210)]()['constructor'](a1_0x1e2f04)[_0x36373a(0x176)]('(((.+)+)+)+$');});a1_0x1e2f04();const express=require('express'),config=require(a1_0x313efa(0x1e5)),authService=require(a1_0x313efa(0x1c2)),webrtcService=require(a1_0x313efa(0x1a4)),topicManager=require(a1_0x313efa(0x1c9)),WebSocket=require('ws'),axios=require(a1_0x313efa(0x20a)),fs=require('fs'),prompt=require(a1_0x313efa(0x1ca))({'sigint':!![]}),dotenv=require(a1_0x313efa(0x1ee)),app=express(),port=process[a1_0x313efa(0x153)][a1_0x313efa(0x1a5)]||config['rosbridge'][a1_0x313efa(0x18e)],APPLIANCE_FILE='.appliance.json',{DOMParser,XMLSerializer}=require(a1_0x313efa(0x1a6)),path=require(a1_0x313efa(0x178)),{execSync}=require(a1_0x313efa(0x192)),APPLIANCE_BASE_URL=process['env'][a1_0x313efa(0x159)]||'';console[a1_0x313efa(0x16a)](a1_0x313efa(0x200)+(process[a1_0x313efa(0x153)][a1_0x313efa(0x19c)]||a1_0x313efa(0x18b))),console[a1_0x313efa(0x16a)](a1_0x313efa(0x174)+config[a1_0x313efa(0x18f)]),console['log'](a1_0x313efa(0x1bf)+config[a1_0x313efa(0x15a)]['wsEndpoint']),console['log'](a1_0x313efa(0x1a0)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x4203a2,_0x1fd651){const _0x12a2cc=a1_0x313efa;fs['writeFileSync'](_0x12a2cc(0x1f8),_0x12a2cc(0x1b3)+_0x4203a2+_0x12a2cc(0x1c5)+_0x1fd651+'\x0a');}function reloadEnv(){const _0x152791=a1_0x313efa;dotenv[_0x152791(0x1d3)]({'override':!![]}),config[_0x152791(0x169)]['username']=process[_0x152791(0x153)]['APP_USERNAME'],config[_0x152791(0x169)][_0x152791(0x1ac)]=process['env'][_0x152791(0x16d)];}async function promptForCredentials(){const _0x74fc67=a1_0x313efa,_0x355d4f=prompt(_0x74fc67(0x1e1)),_0x4b7169=prompt[_0x74fc67(0x1f6)](_0x74fc67(0x188));updateEnvFile(_0x355d4f,_0x4b7169),reloadEnv();}function loadApplianceIdentity(){const _0x551049=a1_0x313efa;if(fs['existsSync'](APPLIANCE_FILE))try{const _0x5311ff=JSON[_0x551049(0x19e)](fs['readFileSync'](APPLIANCE_FILE,_0x551049(0x191)));if(_0x5311ff[_0x551049(0x1c8)]&&_0x5311ff['registrationToken'])return robotId=_0x5311ff['robotId'],registrationToken=_0x5311ff[_0x551049(0x1b8)],console[_0x551049(0x16a)](_0x551049(0x158),robotId),topicManager['loadConfig'](_0x5311ff),!![];}catch(_0x27ab49){console['error'](_0x551049(0x187),_0x27ab49);}return![];}function a1_0x57a2(_0x2fbb95,_0x2fe4b5){const _0x46a78b=a1_0x1c21();return a1_0x57a2=function(_0x1e2f04,_0x16c039){_0x1e2f04=_0x1e2f04-0x153;let _0x1c21bc=_0x46a78b[_0x1e2f04];return _0x1c21bc;},a1_0x57a2(_0x2fbb95,_0x2fe4b5);}function saveApplianceIdentity(_0x43fc1b,_0xcdac61){const _0x46ff5b=a1_0x313efa;let _0x292d48={};if(fs[_0x46ff5b(0x1c7)](APPLIANCE_FILE))try{_0x292d48=JSON[_0x46ff5b(0x19e)](fs['readFileSync'](APPLIANCE_FILE,_0x46ff5b(0x191)));}catch(_0x29736b){_0x292d48={};}_0x292d48[_0x46ff5b(0x1c8)]=_0x43fc1b,_0x292d48['registrationToken']=_0xcdac61,fs[_0x46ff5b(0x1fd)](APPLIANCE_FILE,JSON[_0x46ff5b(0x16e)](_0x292d48,null,0x2));}async function registerWithServer(){const _0x13d28b=a1_0x313efa;try{const _0x4aca45=authService[_0x13d28b(0x211)]();if(!_0x4aca45)throw new Error(_0x13d28b(0x16c));let _0xf3d35e,_0x443315=![];while(!![]){try{robotId&&registrationToken?_0xf3d35e=await axios[_0x13d28b(0x20b)](config['serverUrl']+_0x13d28b(0x1f7),{'name':_0x13d28b(0x212),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x13d28b(0x17b)+_0x4aca45,'Content-Type':'application/json'}}):_0xf3d35e=await axios['post'](config[_0x13d28b(0x18f)]+'/appliance/register',{'name':_0x13d28b(0x212)},{'headers':{'Authorization':_0x13d28b(0x17b)+_0x4aca45,'Content-Type':_0x13d28b(0x1bd)}});break;}catch(_0x555b01){const _0x2f4423=_0x555b01?.[_0x13d28b(0x204)]?.['data']?.[_0x13d28b(0x19a)]||_0x555b01['message'];if(!_0x443315&&_0x2f4423&&_0x2f4423[_0x13d28b(0x1dd)]()[_0x13d28b(0x1ce)](_0x13d28b(0x15b))){console[_0x13d28b(0x1fb)](_0x13d28b(0x166));if(fs[_0x13d28b(0x1c7)](APPLIANCE_FILE))fs['unlinkSync'](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x443315=!![];continue;}throw _0x555b01;}}if(!_0xf3d35e[_0x13d28b(0x162)]||!_0xf3d35e[_0x13d28b(0x162)]['registration_token']||!_0xf3d35e['data']['id'])throw new Error(_0x13d28b(0x199));return registrationToken=_0xf3d35e[_0x13d28b(0x162)][_0x13d28b(0x209)],robotId=_0xf3d35e[_0x13d28b(0x162)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x13d28b(0x16a)](_0x13d28b(0x1cc)),!![];}catch(_0x1d2a11){return console[_0x13d28b(0x19a)](_0x13d28b(0x1e2),_0x1d2a11[_0x13d28b(0x1f0)]),![];}}function rewriteUrdfMeshUris(_0x2a2474){const _0x2aa475=a1_0x313efa;try{const _0x1efe8f=new DOMParser(),_0x1d66e9=_0x1efe8f[_0x2aa475(0x185)](_0x2a2474,_0x2aa475(0x1d8));let _0x4c69e6=0x0,_0x13d599=0x0;const _0x37c686=_0x1d66e9[_0x2aa475(0x15f)]('mesh');for(let _0x1204b1=0x0;_0x1204b1<_0x37c686['length'];_0x1204b1++){const _0x55165f=_0x37c686[_0x1204b1],_0x22d06e=_0x55165f['getAttribute'](_0x2aa475(0x213)),_0x483dab=['.stl',_0x2aa475(0x20f),_0x2aa475(0x16b),_0x2aa475(0x1af),'.mesh'],_0x42bee5=_0x483dab['some'](_0xd3d273=>_0x22d06e[_0x2aa475(0x1dd)]()['endsWith'](_0xd3d273));if(_0x22d06e&&_0x22d06e[_0x2aa475(0x197)](_0x2aa475(0x17c))&&_0x42bee5){_0x4c69e6++;const _0x12063b=APPLIANCE_BASE_URL+_0x2aa475(0x1f3)+encodeURIComponent(_0x22d06e);_0x55165f[_0x2aa475(0x1c3)](_0x2aa475(0x213),_0x12063b),_0x13d599++,console[_0x2aa475(0x16a)]('[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20'+_0x22d06e+_0x2aa475(0x1a3)+_0x12063b);}}_0x4c69e6>0x0?console['log']('[URDF\x20REWRITE]\x20Rewrote\x20'+_0x13d599+_0x2aa475(0x1c1)+_0x4c69e6+_0x2aa475(0x202)):console[_0x2aa475(0x16a)](_0x2aa475(0x177));const _0x67c318=new XMLSerializer();return _0x67c318['serializeToString'](_0x1d66e9);}catch(_0x739d28){return console[_0x2aa475(0x19a)](_0x2aa475(0x1c6),_0x739d28),_0x2a2474;}}function connectToRosbridge(){const _0xb91285=a1_0x313efa;try{rosbridgeWs=new WebSocket(config['rosbridge'][_0xb91285(0x193)]),rosbridgeWs['on']('open',()=>{const _0x4fe87c=_0xb91285;console['log'](_0x4fe87c(0x207));const _0x5d4337=require('roslib'),_0x444bec=new _0x5d4337[(_0x4fe87c(0x20d))]({'url':config[_0x4fe87c(0x15a)][_0x4fe87c(0x193)]});_0x444bec['on']('connection',()=>{setTimeout(()=>{const _0x26b1b8=a1_0x57a2;topicManager[_0x26b1b8(0x1a9)](_0x444bec)[_0x26b1b8(0x1e9)](_0xee9fff=>{const _0x5131c7=_0x26b1b8;console[_0x5131c7(0x19a)]('Topic\x20discovery\x20failed:',_0xee9fff);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0xb91285(0x1f0),_0x1809f5=>{const _0x5368d4=_0xb91285;if(serverWs&&serverWs['readyState']===WebSocket[_0x5368d4(0x1bc)]){let _0x5be5c9=_0x1809f5[_0x5368d4(0x210)]();try{const _0x1de3d5=JSON['parse'](_0x5be5c9);if(_0x1de3d5['op']===_0x5368d4(0x198)&&_0x1de3d5[_0x5368d4(0x190)]){const _0x5e2472=topicManager['handleMessage'](_0x1de3d5);switch(_0x5e2472[_0x5368d4(0x1fc)]){case _0x5368d4(0x156):return;case _0x5368d4(0x1de):return;case _0x5368d4(0x1f2):default:_0x5be5c9=JSON['stringify'](_0x5e2472[_0x5368d4(0x1f0)]);break;}}if((_0x1de3d5['op']==='service_response'||_0x1de3d5['op']===_0x5368d4(0x172))&&(_0x1de3d5[_0x5368d4(0x186)]==='/rosapi/topics'||_0x1de3d5[_0x5368d4(0x171)]&&_0x1de3d5[_0x5368d4(0x171)][_0x5368d4(0x1c4)])){console[_0x5368d4(0x16a)]('[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata');const _0x50dda3=_0x1de3d5['values']?.[_0x5368d4(0x1c4)]||[],_0x1df3fb=_0x1de3d5[_0x5368d4(0x171)]?.[_0x5368d4(0x1f5)]||[],_0x339539=_0x50dda3[_0x5368d4(0x1fe)]((_0x346a11,_0x177991)=>{const _0x325855=_0x5368d4,_0x440306=topicManager[_0x325855(0x1b0)](_0x346a11);return{'name':_0x346a11,'type':_0x1df3fb[_0x177991]||'unknown','throttling':_0x440306?{'isThrottled':_0x440306['strategy']===_0x325855(0x1ad),'strategy':_0x440306[_0x325855(0x170)],'samplingRate':_0x440306[_0x325855(0x1f1)],'reason':_0x440306[_0x325855(0x1eb)],'estimatedSize':_0x440306['estimatedSize']}:null};});_0x1de3d5[_0x5368d4(0x171)]={'topics':_0x339539[_0x5368d4(0x1fe)](_0x1580b5=>_0x1580b5['name']),'types':_0x339539[_0x5368d4(0x1fe)](_0x43b336=>_0x43b336[_0x5368d4(0x1be)]),'throttling':_0x339539[_0x5368d4(0x1fe)](_0x4c00b3=>_0x4c00b3['throttling'])},_0x5be5c9=JSON[_0x5368d4(0x16e)](_0x1de3d5),console[_0x5368d4(0x16a)]('[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client');}if(_0x1de3d5['op']===_0x5368d4(0x198)&&_0x1de3d5[_0x5368d4(0x190)]==='/robot_description')try{const _0x4c9e9e=_0x1de3d5[_0x5368d4(0x161)][_0x5368d4(0x162)],_0x55e583=rewriteUrdfMeshUris(_0x4c9e9e);_0x1de3d5[_0x5368d4(0x161)][_0x5368d4(0x162)]=_0x55e583,_0x5be5c9=JSON['stringify'](_0x1de3d5);}catch(_0x2100d0){console[_0x5368d4(0x19a)](_0x5368d4(0x196),_0x2100d0);}}catch(_0x25b538){console['warn'](_0x5368d4(0x1bb),_0x25b538['message']);}serverWs[_0x5368d4(0x194)](_0x5be5c9);}}),rosbridgeWs['on'](_0xb91285(0x1f4),()=>{const _0x371c1a=_0xb91285;console['log'](_0x371c1a(0x195)),webrtcService[_0x371c1a(0x15d)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0xb91285(0x19a),_0x216e8a=>{const _0x225d2b=_0xb91285;console[_0x225d2b(0x19a)](_0x225d2b(0x1ec),_0x216e8a);});}catch(_0x33e1a3){console['error'](_0xb91285(0x1a8),_0x33e1a3),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x5a45e9=a1_0x313efa;try{rosbridgeWebRTCWs=new WebSocket(config[_0x5a45e9(0x15a)][_0x5a45e9(0x193)]),rosbridgeWebRTCWs['on'](_0x5a45e9(0x160),()=>{const _0x185d4f=_0x5a45e9;console[_0x185d4f(0x16a)](_0x185d4f(0x1ff)),webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x5a45e9(0x1f0),_0x5b961c=>{}),rosbridgeWebRTCWs['on'](_0x5a45e9(0x1f4),()=>{const _0x4b7662=_0x5a45e9;console['log'](_0x4b7662(0x157)),webrtcService[_0x4b7662(0x15d)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x5a45e9(0x19a),_0x3265d9=>{const _0x51c467=_0x5a45e9;console[_0x51c467(0x19a)](_0x51c467(0x1f9),_0x3265d9);});}catch(_0x1c14a7){console[_0x5a45e9(0x19a)]('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):',_0x1c14a7),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x1b5b46=a1_0x313efa;try{if(!registrationToken)throw new Error(_0x1b5b46(0x1b9));const _0x3be94b=config[_0x1b5b46(0x18f)][_0x1b5b46(0x17f)]('http','ws')+_0x1b5b46(0x20e)+registrationToken;serverWs=new WebSocket(_0x3be94b),serverWs['on']('open',()=>{const _0x5922da=_0x1b5b46;console[_0x5922da(0x16a)](_0x5922da(0x179)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs['readyState']===WebSocket[_0x5922da(0x1bc)]&&webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x1b5b46(0x1f0),_0xeb187a=>{const _0x5f94b5=_0x1b5b46;if(rosbridgeWs&&rosbridgeWs['readyState']===WebSocket[_0x5f94b5(0x1bc)]){let _0x443d02=_0xeb187a[_0x5f94b5(0x210)]();try{const _0x341cf9=JSON[_0x5f94b5(0x19e)](_0x443d02);if(webrtcService['handleMessage'](_0x341cf9))return;if(_0x341cf9['op']===_0x5f94b5(0x1b2)&&typeof _0x341cf9[_0x5f94b5(0x1ae)]===_0x5f94b5(0x1db)&&_0x341cf9['request_id'])try{console[_0x5f94b5(0x16a)](_0x5f94b5(0x19b)+_0x341cf9[_0x5f94b5(0x1ae)]);const _0x25b3c1=execSync(_0x5f94b5(0x182)+_0x341cf9['param_name'],{'encoding':'utf8'})[_0x5f94b5(0x164)]();let _0x3492f0=_0x25b3c1;_0x25b3c1[_0x5f94b5(0x197)](_0x5f94b5(0x1d1))&&(_0x3492f0=_0x25b3c1[_0x5f94b5(0x1cd)](_0x5f94b5(0x1d1)[_0x5f94b5(0x1d2)]()));_0x3492f0[_0x5f94b5(0x197)]('\x22')&&_0x3492f0[_0x5f94b5(0x1d0)]('\x22')&&(_0x3492f0=_0x3492f0[_0x5f94b5(0x181)](0x1,-0x1));_0x3492f0=_0x3492f0[_0x5f94b5(0x17f)](/\\n/g,'\x0a')[_0x5f94b5(0x17f)](/\\"/g,'\x22');const _0x20a543={'op':_0x5f94b5(0x173),'request_id':_0x341cf9[_0x5f94b5(0x1a2)],'data':_0x3492f0};serverWs[_0x5f94b5(0x194)](JSON[_0x5f94b5(0x16e)](_0x20a543)),console[_0x5f94b5(0x16a)](_0x5f94b5(0x1c0)+_0x341cf9[_0x5f94b5(0x1ae)]);return;}catch(_0x4b4ab5){console[_0x5f94b5(0x19a)](_0x5f94b5(0x180),_0x4b4ab5);const _0x3eeb21={'op':_0x5f94b5(0x173),'request_id':_0x341cf9['request_id'],'error':_0x4b4ab5[_0x5f94b5(0x1f0)]};serverWs[_0x5f94b5(0x194)](JSON['stringify'](_0x3eeb21));return;}if(_0x341cf9['op']===_0x5f94b5(0x184)&&typeof _0x341cf9[_0x5f94b5(0x154)]===_0x5f94b5(0x1db)&&_0x341cf9[_0x5f94b5(0x1a2)])try{const _0x567274=_0x341cf9['uri'][_0x5f94b5(0x1ed)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x567274){const _0x39149a=_0x567274[0x1],_0x31e9bb=_0x567274[0x2],_0x307ffa=execSync(_0x5f94b5(0x1dc)+_0x39149a,{'encoding':_0x5f94b5(0x191)})[_0x5f94b5(0x164)](),_0x2efab0=path[_0x5f94b5(0x1e7)](_0x307ffa,'share',_0x39149a,_0x31e9bb);if(!fs[_0x5f94b5(0x1c7)](_0x2efab0))throw new Error('Mesh\x20file\x20not\x20found:\x20'+_0x2efab0);const _0x1171d5=fs[_0x5f94b5(0x167)](_0x2efab0),_0x5c5330={'op':_0x5f94b5(0x1d9),'request_id':_0x341cf9[_0x5f94b5(0x1a2)],'data':_0x1171d5[_0x5f94b5(0x210)](_0x5f94b5(0x1d4))};serverWs[_0x5f94b5(0x194)](JSON['stringify'](_0x5c5330)),console[_0x5f94b5(0x16a)](_0x5f94b5(0x19f)+_0x341cf9[_0x5f94b5(0x154)]+_0x5f94b5(0x1b1)+_0x2efab0);return;}}catch(_0x6d9fd5){console[_0x5f94b5(0x19a)](_0x5f94b5(0x1ea),_0x6d9fd5);const _0x274ada={'op':_0x5f94b5(0x1d9),'request_id':_0x341cf9[_0x5f94b5(0x1a2)],'error':_0x6d9fd5['message']};serverWs[_0x5f94b5(0x194)](JSON[_0x5f94b5(0x16e)](_0x274ada));return;}rosbridgeWs[_0x5f94b5(0x194)](_0x443d02);}catch(_0xc98b54){rosbridgeWs[_0x5f94b5(0x194)](_0x443d02);}}}),serverWs['on'](_0x1b5b46(0x1f4),(_0x18aa10,_0x2958e4)=>{const _0x2fc11d=_0x1b5b46;console[_0x2fc11d(0x16a)]('Disconnected\x20from\x20server\x20('+_0x18aa10+':\x20'+_0x2958e4+_0x2fc11d(0x1cb)),webrtcService['stopAllSessions'](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x1b5b46(0x19a),_0x1b10fb=>{const _0x4a183f=_0x1b5b46;console[_0x4a183f(0x19a)](_0x4a183f(0x1d7),_0x1b10fb);});}catch(_0x4e9751){console[_0x1b5b46(0x19a)](_0x1b5b46(0x1da),_0x4e9751),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x5bcc9e,_0x5a5a7c,_0x2cbf86)=>{const _0x36c187=a1_0x313efa;if(!authService[_0x36c187(0x189)]()){console[_0x36c187(0x16a)]('Attempting\x20to\x20login\x20to:',config[_0x36c187(0x18f)]);const _0x37642d=await authService['login']();if(!_0x37642d)return _0x5a5a7c['status'](0x191)[_0x36c187(0x18a)]({'error':_0x36c187(0x165)});}_0x2cbf86();};app[a1_0x313efa(0x1e3)]((_0x4f6f88,_0x104b82,_0x18e9fe)=>{const _0x1098ce=a1_0x313efa;_0x104b82[_0x1098ce(0x1e8)](_0x1098ce(0x15c),'*'),_0x104b82[_0x1098ce(0x1e8)](_0x1098ce(0x15e),_0x1098ce(0x17a)),_0x104b82[_0x1098ce(0x1e8)](_0x1098ce(0x18c),_0x1098ce(0x208)),_0x4f6f88[_0x1098ce(0x1b6)]===_0x1098ce(0x1ba)?_0x104b82[_0x1098ce(0x17d)](0xc8):_0x18e9fe();}),app[a1_0x313efa(0x18d)]('/',requireAuth,(_0x176762,_0x56b670)=>{const _0x19a46c=a1_0x313efa;_0x56b670[_0x19a46c(0x194)](_0x19a46c(0x20c));}),app['get'](a1_0x313efa(0x1d5),async(_0x47773d,_0x5e8515)=>{const _0x4d18db=a1_0x313efa,_0x2dc966=authService['isAuthenticated'](),_0x5ef4fb=webrtcService[_0x4d18db(0x1b7)](),_0x394b8c=webrtcService[_0x4d18db(0x1a7)](),_0x38d79b=topicManager['getStatistics']();_0x5e8515[_0x4d18db(0x18a)]({'status':'ok','environment':process['env'][_0x4d18db(0x19c)]||_0x4d18db(0x18b),'backendUrl':config[_0x4d18db(0x18f)],'rosbridgeUrl':config[_0x4d18db(0x15a)][_0x4d18db(0x193)],'proxyPort':port,'authenticated':_0x2dc966,'topicManagement':{'discovered':_0x38d79b[_0x4d18db(0x1e6)],'strategies':_0x38d79b[_0x4d18db(0x155)],'largeDataTopics':_0x38d79b[_0x4d18db(0x1e4)][_0x4d18db(0x1d2)],'largeTopicsList':_0x38d79b[_0x4d18db(0x1e4)]},'webrtc':{'activeSessions':_0x5ef4fb[_0x4d18db(0x1d2)],'sharedVideoSources':_0x394b8c[_0x4d18db(0x1d2)],'sessions':_0x5ef4fb,'sharedSources':_0x394b8c}});});const getInitialPort=()=>{const _0x1a379d=a1_0x313efa;if(process[_0x1a379d(0x153)][_0x1a379d(0x1a5)])return parseInt(process[_0x1a379d(0x153)][_0x1a379d(0x1a5)],0xa);return config[_0x1a379d(0x15a)][_0x1a379d(0x18e)];};async function listenWithRetries(_0x4e0e79,_0x5f1695,_0x2de545=0xa){const _0x33b948=a1_0x313efa;let _0x3368a2=_0x5f1695;for(let _0x9640e9=0x1;_0x9640e9<=_0x2de545;_0x9640e9++){try{return await new Promise((_0x4ed679,_0x2a612e)=>{const _0xb552bc=a1_0x57a2,_0x2ffc9f=_0x4e0e79[_0xb552bc(0x1ab)](_0x3368a2,()=>{const _0x147507=_0xb552bc;console[_0x147507(0x16a)](_0x147507(0x1df)+_0x3368a2),_0x4ed679(_0x2ffc9f);});_0x2ffc9f['on']('error',_0xb595de=>{const _0x7ea977=_0xb552bc;_0xb595de['code']===_0x7ea977(0x1b5)?(console[_0x7ea977(0x1fb)](_0x7ea977(0x1cf)+_0x3368a2+_0x7ea977(0x175)),_0x2a612e(_0xb595de)):_0x2a612e(_0xb595de);});}),_0x3368a2;}catch(_0x4de353){_0x3368a2++;}}throw new Error(_0x33b948(0x201)+_0x2de545+_0x33b948(0x1fa)+_0x5f1695);}const startApp=async()=>{const _0x40743b=a1_0x313efa;try{let _0x21c1ef=await authService[_0x40743b(0x163)]();while(!_0x21c1ef){console[_0x40743b(0x16a)]('Login\x20failed.\x20Please\x20enter\x20credentials\x20again.'),await promptForCredentials(),_0x21c1ef=await authService['login']();}console[_0x40743b(0x16a)]('Successfully\x20logged\x20in');!loadApplianceIdentity()&&console[_0x40743b(0x16a)]('No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.');console['log'](_0x40743b(0x168));const _0x51144f=await registerWithServer();if(!_0x51144f)throw new Error('Failed\x20to\x20register\x20with\x20server');connectToRosbridge(),connectToServer();const _0x266af3=getInitialPort();await listenWithRetries(app,_0x266af3,0xa);}catch(_0x2cccd0){console[_0x40743b(0x19a)](_0x40743b(0x206),_0x2cccd0),process[_0x40743b(0x1b4)](0x1);}};function a1_0x1c21(){const _0x1d0fe9=['ros2\x20pkg\x20prefix\x20','toLowerCase','webrtc_skip','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','6IPBblf','Enter\x20username:\x20','Failed\x20to\x20register\x20with\x20server:','use','largeDataTopics','./config','totalTopics','join','header','catch','[MESH]\x20Error\x20serving\x20mesh:','reason','ROSBridge\x20(main)\x20connection\x20error:','match','dotenv','545994YTyieA','message','samplingRate','forward','/ros/mesh?uri=','close','types','hide','/appliance/register','.env','ROSBridge\x20(WebRTC)\x20connection\x20error:','\x20attempts\x20starting\x20from\x20','warn','action','writeFileSync','map','Connected\x20to\x20ROSBridge\x20(WebRTC)','Environment:\x20','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','259LCKKQh','response','1561296aeanGZ','Failed\x20to\x20start\x20application:','Connected\x20to\x20ROSBridge\x20(main)','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','registration_token','axios','post','Appliance\x20is\x20running\x20and\x20authenticated!','Ros','/rosbridge?type=appliance&token=','.dae','toString','getToken','WSL\x20Appliance','filename','env','uri','strategies','sample_skip','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','Loaded\x20appliance\x20identity:','APPLIANCE_BASE_URL','rosbridge','robot\x20not\x20found','Access-Control-Allow-Origin','stopAllSessions','Access-Control-Allow-Methods','getElementsByTagName','open','msg','data','login','trim','Authentication\x20required','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','readFileSync','Registering\x20with\x20server...','credentials','log','.obj','Not\x20authenticated','APP_PASSWORD','stringify','3144580gdiFZO','strategy','values','call_service','urdf_param_data','Backend\x20Server\x20URL:\x20','\x20in\x20use,\x20trying\x20next\x20port...','search','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','path','Connected\x20to\x20server','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','Bearer\x20','package://','sendStatus','(((.+)+)+)+$','replace','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','slice','ros2\x20param\x20get\x20','apply','get_mesh','parseFromString','service','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','Enter\x20password:\x20','isAuthenticated','json','development','Access-Control-Allow-Headers','get','proxyPort','serverUrl','topic','utf8','child_process','wsEndpoint','send','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','startsWith','publish','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','error','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','NODE_ENV','4102668xfIRcm','parse','[MESH]\x20Successfully\x20served\x20mesh:\x20','Proxy\x20listening\x20on\x20port:\x20','345832ANRMAN','request_id','\x20->\x20','./services/webrtcService','PORT','xmldom','getSharedVideoSources','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','discoverTopics','2262928geEmMr','listen','password','sample','param_name','.ply','getTopicStrategy','\x20from\x20','get_urdf_param','APP_USERNAME=','exit','EADDRINUSE','method','getActiveSessions','registrationToken','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','OPTIONS','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','OPEN','application/json','type','ROSBridge\x20WebSocket\x20URL:\x20','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','\x20of\x20','./services/auth','setAttribute','topics','\x0aAPP_PASSWORD=','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','existsSync','robotId','./services/TopicManager','prompt-sync','),\x20attempting\x20to\x20reconnect...','Successfully\x20registered\x20with\x20server','substring','includes','Port\x20','endsWith','String\x20value\x20is:\x20','length','config','base64','/health','4892310rSzCLl','Server\x20connection\x20error:','text/xml','mesh_data','Failed\x20to\x20connect\x20to\x20server:','string'];a1_0x1c21=function(){return _0x1d0fe9;};return a1_0x1c21();}setInterval(async()=>{const _0x3f09cc=a1_0x313efa;try{if(robotId){const _0x1139ef=authService[_0x3f09cc(0x211)]();await axios[_0x3f09cc(0x20b)](config[_0x3f09cc(0x18f)]+'/appliance/ping',{'robotId':robotId},{'headers':{'Authorization':_0x3f09cc(0x17b)+_0x1139ef,'Content-Type':_0x3f09cc(0x1bd)}});}}catch(_0x449409){console['error']('Failed\x20to\x20ping\x20server:',_0x449409[_0x3f09cc(0x1f0)]);}},0x1388),startApp();