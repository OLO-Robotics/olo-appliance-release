const a1_0x1cab69=a1_0x1584;(function(_0x1fe186,_0x4eb3ed){const _0x345632=a1_0x1584,_0x281123=_0x1fe186();while(!![]){try{const _0x3ca6a6=-parseInt(_0x345632(0x1f0))/0x1+parseInt(_0x345632(0x1f9))/0x2*(-parseInt(_0x345632(0x19b))/0x3)+-parseInt(_0x345632(0x1cb))/0x4+parseInt(_0x345632(0x239))/0x5*(-parseInt(_0x345632(0x207))/0x6)+parseInt(_0x345632(0x1fb))/0x7*(parseInt(_0x345632(0x242))/0x8)+-parseInt(_0x345632(0x25e))/0x9*(parseInt(_0x345632(0x232))/0xa)+-parseInt(_0x345632(0x25c))/0xb*(-parseInt(_0x345632(0x1f2))/0xc);if(_0x3ca6a6===_0x4eb3ed)break;else _0x281123['push'](_0x281123['shift']());}catch(_0x3199d2){_0x281123['push'](_0x281123['shift']());}}}(a1_0x3357,0x85d86));const a1_0x5994b6=(function(){let _0x1b138d=!![];return function(_0x234e4b,_0x401182){const _0x17abd8=_0x1b138d?function(){const _0x1cf973=a1_0x1584;if(_0x401182){const _0x41a3d9=_0x401182[_0x1cf973(0x1d0)](_0x234e4b,arguments);return _0x401182=null,_0x41a3d9;}}:function(){};return _0x1b138d=![],_0x17abd8;};}()),a1_0x5aebf7=a1_0x5994b6(this,function(){const _0x2867d1=a1_0x1584;return a1_0x5aebf7['toString']()['search'](_0x2867d1(0x1f5))[_0x2867d1(0x1dd)]()[_0x2867d1(0x23f)](a1_0x5aebf7)[_0x2867d1(0x1cd)]('(((.+)+)+)+$');});a1_0x5aebf7();const dotenv=require('dotenv');dotenv['config']();const express=require('express'),config=require(a1_0x1cab69(0x1db));process[a1_0x1cab69(0x238)][a1_0x1cab69(0x19a)]&&process['env']['APP_PASSWORD']&&(config[a1_0x1cab69(0x241)][a1_0x1cab69(0x1c7)]=process[a1_0x1cab69(0x238)][a1_0x1cab69(0x19a)],config[a1_0x1cab69(0x241)][a1_0x1cab69(0x229)]=process['env']['APP_PASSWORD'],console[a1_0x1cab69(0x1c8)](a1_0x1cab69(0x255)));const authService=require('./services/auth'),webrtcService=require(a1_0x1cab69(0x1e9)),topicManager=require(a1_0x1cab69(0x23e)),WebSocket=require('ws'),axios=require(a1_0x1cab69(0x202)),fs=require('fs'),prompt=require('prompt-sync')({'sigint':!![]}),app=express(),port=process[a1_0x1cab69(0x238)][a1_0x1cab69(0x262)]||config['rosbridge'][a1_0x1cab69(0x20f)],APPLIANCE_FILE=a1_0x1cab69(0x240),{DOMParser,XMLSerializer}=require(a1_0x1cab69(0x25d)),path=require(a1_0x1cab69(0x250)),{execSync}=require('child_process'),APPLIANCE_BASE_URL=process[a1_0x1cab69(0x238)]['APPLIANCE_BASE_URL']||'';console[a1_0x1cab69(0x1c8)](a1_0x1cab69(0x204)+(process[a1_0x1cab69(0x238)]['NODE_ENV']||'development')),console[a1_0x1cab69(0x1c8)](a1_0x1cab69(0x1c9)+config['serverUrl']),console['log'](a1_0x1cab69(0x253)+config[a1_0x1cab69(0x1e5)]['wsEndpoint']),console[a1_0x1cab69(0x1c8)](a1_0x1cab69(0x198)+port);function a1_0x3357(){const _0xa3f329=['serverUrl','Port\x20','name','largeDataTopics','path','\x0aAPP_PASSWORD=','Access-Control-Allow-Methods','ROSBridge\x20WebSocket\x20URL:\x20','getToken','Initial\x20credentials\x20loaded\x20from\x20environment','Connected\x20to\x20ROSBridge\x20(WebRTC)','webrtc_skip','Loaded\x20appliance\x20identity:','sendStatus','code','response','40802399bcwdQG','xmldom','9502830czueUK','length','initialize','Disconnected\x20from\x20server\x20(','PORT','substring','/appliance/register','Attempting\x20to\x20login\x20to:','listen','uri','Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file','Failed\x20to\x20register\x20with\x20server','Not\x20authenticated','Proxy\x20listening\x20on\x20port:\x20','/ros/mesh?uri=','APP_USERNAME','3eCnUgg','map','startsWith','get_mesh','registration_token','estimatedSize','discoverTopics','service_response','\x20of\x20','Appliance\x20is\x20running\x20and\x20authenticated!','Access-Control-Allow-Origin','isAuthenticated','[MESH]\x20Successfully\x20served\x20mesh:\x20','get','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','Failed\x20to\x20start\x20application:','get_urdf_param','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','stringify','replace','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','action','slice','totalTopics','readFileSync','call_service','NOT\x20SET','samplingRate','\x20->\x20','topic','.mesh','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','match','publish','WSL\x20Appliance','json','config','request_id','writeFileSync','text/xml','\x20from\x20','includes','username','log','Backend\x20Server\x20URL:\x20','topics','756316eWpIOC','registrationToken','search','Bearer\x20','exit','apply','/health','Registering\x20with\x20server...','message','reason','toLowerCase','throttling','/rosbridge?type=appliance&token=','string','.stl','/appliance/ping','./config','http','toString','parse','serializeToString','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','endsWith','getStatistics','/robot_description','/rosapi/topics','rosbridge','Successfully\x20logged\x20in','readyState','stopAllSessions','./services/webrtcService','Topic\x20discovery\x20failed:','.env','wsEndpoint','mesh_data','catch','.obj','265837RKCfvO','Access-Control-Allow-Headers','12NsRvOI','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','(((.+)+)+)+$','\x20in\x20use,\x20trying\x20next\x20port...','application/json','send','1870972JWVpMi','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','70jCqIRx','types','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','Enter\x20password:\x20','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','use','method','axios','Server\x20connection\x20error:','Environment:\x20','msg','robotId','6402GqBVjT','getTopicStrategy','strategies','getSharedVideoSources','.ply','hide','forward','login','proxyPort','Loaded\x20credentials:','status','roslib','development','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','),\x20attempting\x20to\x20reconnect...','Failed\x20to\x20ping\x20server:','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','service','post','OPTIONS','getAttribute','utf8','urdf_param_data','type','existsSync','OPEN','filename','param_name','production','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','NODE_ENV','mesh','strategy','share','password','values','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','Enter\x20username:\x20','String\x20value\x20is:\x20','APP_USERNAME=','error','trim','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','10pOLpyN','warn','Connected\x20to\x20ROSBridge\x20(main)','open','Failed\x20to\x20register\x20with\x20server:','ros2\x20param\x20get\x20','env','3955HQzLPO','join','\x20attempts\x20starting\x20from\x20','ros2\x20pkg\x20prefix\x20','robot\x20not\x20found','./services/TopicManager','constructor','.appliance.json','credentials','103352jqOayb','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','getElementsByTagName','close','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','Ros','data','header','Successfully\x20registered\x20with\x20server','SET'];a1_0x3357=function(){return _0xa3f329;};return a1_0x3357();}let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x1ae284,_0x1abcee){const _0x10c0b0=a1_0x1cab69;fs['writeFileSync'](_0x10c0b0(0x1eb),_0x10c0b0(0x22e)+_0x1ae284+_0x10c0b0(0x251)+_0x1abcee+'\x0a');}function reloadEnv(){const _0x53139d=a1_0x1cab69;dotenv[_0x53139d(0x1c1)]({'override':!![]}),config[_0x53139d(0x241)][_0x53139d(0x1c7)]=process[_0x53139d(0x238)][_0x53139d(0x19a)],config[_0x53139d(0x241)][_0x53139d(0x229)]=process[_0x53139d(0x238)]['APP_PASSWORD'],console[_0x53139d(0x1c8)](_0x53139d(0x210),{'username':config[_0x53139d(0x241)]['username']?_0x53139d(0x24b):'NOT\x20SET','password':config[_0x53139d(0x241)][_0x53139d(0x229)]?_0x53139d(0x24b):_0x53139d(0x1b5)});}async function promptForCredentials(){const _0x3e7284=a1_0x1cab69;process[_0x3e7284(0x238)][_0x3e7284(0x225)]===_0x3e7284(0x223)&&(console[_0x3e7284(0x22f)](_0x3e7284(0x195)),console['error']('Please\x20run:\x20./setup.sh\x20reconfigure'),process[_0x3e7284(0x1cf)](0x1));const _0x26494f=prompt(_0x3e7284(0x22c)),_0x8bff9d=prompt[_0x3e7284(0x20c)](_0x3e7284(0x1fe));updateEnvFile(_0x26494f,_0x8bff9d),reloadEnv();}function loadApplianceIdentity(){const _0x163a11=a1_0x1cab69;if(fs['existsSync'](APPLIANCE_FILE))try{const _0xc3660f=JSON[_0x163a11(0x1de)](fs['readFileSync'](APPLIANCE_FILE,_0x163a11(0x21c)));if(_0xc3660f[_0x163a11(0x206)]&&_0xc3660f[_0x163a11(0x1cc)])return robotId=_0xc3660f[_0x163a11(0x206)],registrationToken=_0xc3660f[_0x163a11(0x1cc)],console['log'](_0x163a11(0x258),robotId),topicManager['loadConfig'](_0xc3660f),!![];}catch(_0x51f557){console['error'](_0x163a11(0x1f4),_0x51f557);}return![];}function saveApplianceIdentity(_0x7a0fbb,_0x4a230e){const _0x15f007=a1_0x1cab69;let _0xf23e64={};if(fs[_0x15f007(0x21f)](APPLIANCE_FILE))try{_0xf23e64=JSON[_0x15f007(0x1de)](fs['readFileSync'](APPLIANCE_FILE,'utf8'));}catch(_0x3f3b57){_0xf23e64={};}_0xf23e64[_0x15f007(0x206)]=_0x7a0fbb,_0xf23e64['registrationToken']=_0x4a230e,fs[_0x15f007(0x1c3)](APPLIANCE_FILE,JSON[_0x15f007(0x1ad)](_0xf23e64,null,0x2));}async function registerWithServer(){const _0x5493af=a1_0x1cab69;try{const _0x5cb177=authService[_0x5493af(0x254)]();if(!_0x5cb177)throw new Error(_0x5493af(0x197));let _0x3dec5f,_0x53d64a=![];while(!![]){try{robotId&&registrationToken?_0x3dec5f=await axios[_0x5493af(0x219)](config[_0x5493af(0x24c)]+_0x5493af(0x264),{'name':_0x5493af(0x1bf),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x5493af(0x1ce)+_0x5cb177,'Content-Type':_0x5493af(0x1f7)}}):_0x3dec5f=await axios[_0x5493af(0x219)](config[_0x5493af(0x24c)]+_0x5493af(0x264),{'name':_0x5493af(0x1bf)},{'headers':{'Authorization':_0x5493af(0x1ce)+_0x5cb177,'Content-Type':_0x5493af(0x1f7)}});break;}catch(_0x156ec4){const _0x571a7d=_0x156ec4?.[_0x5493af(0x25b)]?.[_0x5493af(0x248)]?.[_0x5493af(0x22f)]||_0x156ec4[_0x5493af(0x1d3)];if(!_0x53d64a&&_0x571a7d&&_0x571a7d[_0x5493af(0x1d5)]()[_0x5493af(0x1c6)](_0x5493af(0x23d))){console[_0x5493af(0x233)](_0x5493af(0x231));if(fs[_0x5493af(0x21f)](APPLIANCE_FILE))fs['unlinkSync'](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x53d64a=!![];continue;}throw _0x156ec4;}}if(!_0x3dec5f[_0x5493af(0x248)]||!_0x3dec5f[_0x5493af(0x248)]['registration_token']||!_0x3dec5f[_0x5493af(0x248)]['id'])throw new Error('Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server');return registrationToken=_0x3dec5f[_0x5493af(0x248)][_0x5493af(0x19f)],robotId=_0x3dec5f[_0x5493af(0x248)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x5493af(0x1c8)](_0x5493af(0x24a)),!![];}catch(_0xf1013f){return console[_0x5493af(0x22f)](_0x5493af(0x236),_0xf1013f['message']),![];}}function rewriteUrdfMeshUris(_0x390d47){const _0x5e8b39=a1_0x1cab69;try{const _0x4affd2=new DOMParser(),_0x1bab4c=_0x4affd2['parseFromString'](_0x390d47,_0x5e8b39(0x1c4));let _0x2f7f05=0x0,_0xe300d1=0x0;const _0x26e332=_0x1bab4c[_0x5e8b39(0x244)](_0x5e8b39(0x226));for(let _0x3164be=0x0;_0x3164be<_0x26e332[_0x5e8b39(0x25f)];_0x3164be++){const _0x5a42cd=_0x26e332[_0x3164be],_0x17f313=_0x5a42cd[_0x5e8b39(0x21b)](_0x5e8b39(0x221)),_0x395cb3=[_0x5e8b39(0x1d9),'.dae',_0x5e8b39(0x1ef),_0x5e8b39(0x20b),_0x5e8b39(0x1b9)],_0x245022=_0x395cb3['some'](_0x2206d8=>_0x17f313[_0x5e8b39(0x1d5)]()[_0x5e8b39(0x1e1)](_0x2206d8));if(_0x17f313&&_0x17f313['startsWith']('package://')&&_0x245022){_0x2f7f05++;const _0x2fde75=APPLIANCE_BASE_URL+_0x5e8b39(0x199)+encodeURIComponent(_0x17f313);_0x5a42cd['setAttribute'](_0x5e8b39(0x221),_0x2fde75),_0xe300d1++,console['log']('[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20'+_0x17f313+_0x5e8b39(0x1b7)+_0x2fde75);}}_0x2f7f05>0x0?console[_0x5e8b39(0x1c8)]('[URDF\x20REWRITE]\x20Rewrote\x20'+_0xe300d1+_0x5e8b39(0x1a3)+_0x2f7f05+_0x5e8b39(0x1bb)):console['log']('[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF');const _0x33e6c9=new XMLSerializer();return _0x33e6c9[_0x5e8b39(0x1df)](_0x1bab4c);}catch(_0x5578f6){return console[_0x5e8b39(0x22f)](_0x5e8b39(0x1ba),_0x5578f6),_0x390d47;}}function connectToRosbridge(){const _0x2a9a00=a1_0x1cab69;try{rosbridgeWs=new WebSocket(config[_0x2a9a00(0x1e5)][_0x2a9a00(0x1ec)]),rosbridgeWs['on'](_0x2a9a00(0x235),()=>{const _0x4aab67=_0x2a9a00;console[_0x4aab67(0x1c8)](_0x4aab67(0x234));const _0x477c5b=require(_0x4aab67(0x212)),_0x4221c9=new _0x477c5b[(_0x4aab67(0x247))]({'url':config[_0x4aab67(0x1e5)][_0x4aab67(0x1ec)]});_0x4221c9['on']('connection',()=>{setTimeout(()=>{const _0x1de929=a1_0x1584;topicManager[_0x1de929(0x1a1)](_0x4221c9)[_0x1de929(0x1ee)](_0x3353aa=>{const _0x43207e=_0x1de929;console[_0x43207e(0x22f)](_0x43207e(0x1ea),_0x3353aa);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on']('message',_0x2c3737=>{const _0x1b5a67=_0x2a9a00;if(serverWs&&serverWs[_0x1b5a67(0x1e7)]===WebSocket[_0x1b5a67(0x220)]){let _0x5066ff=_0x2c3737[_0x1b5a67(0x1dd)]();try{const _0x4a4644=JSON[_0x1b5a67(0x1de)](_0x5066ff);if(_0x4a4644['op']===_0x1b5a67(0x1be)&&_0x4a4644[_0x1b5a67(0x1b8)]){const _0x5f3672=topicManager['handleMessage'](_0x4a4644);switch(_0x5f3672[_0x1b5a67(0x1b0)]){case'sample_skip':return;case _0x1b5a67(0x257):return;case _0x1b5a67(0x20d):default:_0x5066ff=JSON[_0x1b5a67(0x1ad)](_0x5f3672[_0x1b5a67(0x1d3)]);break;}}if((_0x4a4644['op']===_0x1b5a67(0x1a2)||_0x4a4644['op']===_0x1b5a67(0x1b4))&&(_0x4a4644[_0x1b5a67(0x218)]===_0x1b5a67(0x1e4)||_0x4a4644[_0x1b5a67(0x22a)]&&_0x4a4644[_0x1b5a67(0x22a)]['topics'])){console[_0x1b5a67(0x1c8)](_0x1b5a67(0x1fa));const _0x37c717=_0x4a4644[_0x1b5a67(0x22a)]?.[_0x1b5a67(0x1ca)]||[],_0x11ee58=_0x4a4644['values']?.[_0x1b5a67(0x1fc)]||[],_0x4726dc=_0x37c717[_0x1b5a67(0x19c)]((_0x3257f4,_0x3f6f15)=>{const _0x3e260b=_0x1b5a67,_0x5636ae=topicManager[_0x3e260b(0x208)](_0x3257f4);return{'name':_0x3257f4,'type':_0x11ee58[_0x3f6f15]||'unknown','throttling':_0x5636ae?{'isThrottled':_0x5636ae['strategy']==='sample','strategy':_0x5636ae[_0x3e260b(0x227)],'samplingRate':_0x5636ae[_0x3e260b(0x1b6)],'reason':_0x5636ae[_0x3e260b(0x1d4)],'estimatedSize':_0x5636ae[_0x3e260b(0x1a0)]}:null};});_0x4a4644[_0x1b5a67(0x22a)]={'topics':_0x4726dc[_0x1b5a67(0x19c)](_0x5b7f0c=>_0x5b7f0c[_0x1b5a67(0x24e)]),'types':_0x4726dc['map'](_0x2e0abf=>_0x2e0abf[_0x1b5a67(0x21e)]),'throttling':_0x4726dc[_0x1b5a67(0x19c)](_0x307078=>_0x307078[_0x1b5a67(0x1d6)])},_0x5066ff=JSON[_0x1b5a67(0x1ad)](_0x4a4644),console['log'](_0x1b5a67(0x217));}if(_0x4a4644['op']===_0x1b5a67(0x1be)&&_0x4a4644[_0x1b5a67(0x1b8)]===_0x1b5a67(0x1e3))try{const _0x1f64e0=_0x4a4644['msg'][_0x1b5a67(0x248)],_0x33a50a=rewriteUrdfMeshUris(_0x1f64e0);_0x4a4644[_0x1b5a67(0x205)][_0x1b5a67(0x248)]=_0x33a50a,_0x5066ff=JSON['stringify'](_0x4a4644);}catch(_0x24d031){console['error'](_0x1b5a67(0x1f3),_0x24d031);}}catch(_0x3c738d){console[_0x1b5a67(0x233)](_0x1b5a67(0x224),_0x3c738d[_0x1b5a67(0x1d3)]);}serverWs[_0x1b5a67(0x1f8)](_0x5066ff);}}),rosbridgeWs['on'](_0x2a9a00(0x245),()=>{const _0x5495d4=_0x2a9a00;console['log'](_0x5495d4(0x1ff)),webrtcService[_0x5495d4(0x1e8)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x2a9a00(0x22f),_0x1f1dc9=>{const _0x35446a=_0x2a9a00;console[_0x35446a(0x22f)]('ROSBridge\x20(main)\x20connection\x20error:',_0x1f1dc9);});}catch(_0x16eb4c){console['error'](_0x2a9a00(0x1bc),_0x16eb4c),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x556d56=a1_0x1cab69;try{rosbridgeWebRTCWs=new WebSocket(config[_0x556d56(0x1e5)]['wsEndpoint']),rosbridgeWebRTCWs['on'](_0x556d56(0x235),()=>{const _0x255291=_0x556d56;console[_0x255291(0x1c8)](_0x255291(0x256)),webrtcService[_0x255291(0x260)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on']('message',_0x54768a=>{}),rosbridgeWebRTCWs['on'](_0x556d56(0x245),()=>{const _0x3bfd3a=_0x556d56;console[_0x3bfd3a(0x1c8)]('Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...'),webrtcService['stopAllSessions'](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on']('error',_0x5ace07=>{const _0x2068c1=_0x556d56;console[_0x2068c1(0x22f)]('ROSBridge\x20(WebRTC)\x20connection\x20error:',_0x5ace07);});}catch(_0x4e1acc){console['error'](_0x556d56(0x1ac),_0x4e1acc),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x1caef4=a1_0x1cab69;try{if(!registrationToken)throw new Error(_0x1caef4(0x1fd));const _0x45611=config['serverUrl'][_0x1caef4(0x1ae)](_0x1caef4(0x1dc),'ws')+_0x1caef4(0x1d7)+registrationToken;serverWs=new WebSocket(_0x45611),serverWs['on'](_0x1caef4(0x235),()=>{const _0x3fdc23=_0x1caef4;console['log']('Connected\x20to\x20server'),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x3fdc23(0x1e7)]===WebSocket[_0x3fdc23(0x220)]&&webrtcService[_0x3fdc23(0x260)](rosbridgeWebRTCWs,serverWs);}),serverWs['on']('message',_0x56d832=>{const _0x158489=_0x1caef4;if(rosbridgeWs&&rosbridgeWs[_0x158489(0x1e7)]===WebSocket['OPEN']){let _0x3f8d8d=_0x56d832[_0x158489(0x1dd)]();try{const _0x162c73=JSON[_0x158489(0x1de)](_0x3f8d8d);if(webrtcService['handleMessage'](_0x162c73))return;if(_0x162c73['op']===_0x158489(0x1ab)&&typeof _0x162c73[_0x158489(0x222)]===_0x158489(0x1d8)&&_0x162c73[_0x158489(0x1c2)])try{console[_0x158489(0x1c8)](_0x158489(0x1e0)+_0x162c73[_0x158489(0x222)]);const _0x12505d=execSync(_0x158489(0x237)+_0x162c73[_0x158489(0x222)],{'encoding':_0x158489(0x21c)})['trim']();let _0x54ea33=_0x12505d;_0x12505d[_0x158489(0x19d)](_0x158489(0x22d))&&(_0x54ea33=_0x12505d[_0x158489(0x263)]('String\x20value\x20is:\x20'[_0x158489(0x25f)]()));_0x54ea33[_0x158489(0x19d)]('\x22')&&_0x54ea33[_0x158489(0x1e1)]('\x22')&&(_0x54ea33=_0x54ea33[_0x158489(0x1b1)](0x1,-0x1));_0x54ea33=_0x54ea33[_0x158489(0x1ae)](/\\n/g,'\x0a')[_0x158489(0x1ae)](/\\"/g,'\x22');const _0x41bc96={'op':'urdf_param_data','request_id':_0x162c73[_0x158489(0x1c2)],'data':_0x54ea33};serverWs[_0x158489(0x1f8)](JSON[_0x158489(0x1ad)](_0x41bc96)),console[_0x158489(0x1c8)](_0x158489(0x246)+_0x162c73['param_name']);return;}catch(_0xc5c9a){console[_0x158489(0x22f)](_0x158489(0x1af),_0xc5c9a);const _0x5b321a={'op':_0x158489(0x21d),'request_id':_0x162c73[_0x158489(0x1c2)],'error':_0xc5c9a[_0x158489(0x1d3)]};serverWs[_0x158489(0x1f8)](JSON[_0x158489(0x1ad)](_0x5b321a));return;}if(_0x162c73['op']===_0x158489(0x19e)&&typeof _0x162c73[_0x158489(0x194)]===_0x158489(0x1d8)&&_0x162c73[_0x158489(0x1c2)])try{const _0x1d05b0=_0x162c73[_0x158489(0x194)][_0x158489(0x1bd)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x1d05b0){const _0x10bc98=_0x1d05b0[0x1],_0x25d51a=_0x1d05b0[0x2],_0x4349b8=execSync(_0x158489(0x23c)+_0x10bc98,{'encoding':_0x158489(0x21c)})[_0x158489(0x230)](),_0x52f68e=path[_0x158489(0x23a)](_0x4349b8,_0x158489(0x228),_0x10bc98,_0x25d51a);if(!fs[_0x158489(0x21f)](_0x52f68e))throw new Error('Mesh\x20file\x20not\x20found:\x20'+_0x52f68e);const _0x10524c=fs[_0x158489(0x1b3)](_0x52f68e),_0x3f92ff={'op':_0x158489(0x1ed),'request_id':_0x162c73[_0x158489(0x1c2)],'data':_0x10524c[_0x158489(0x1dd)]('base64')};serverWs[_0x158489(0x1f8)](JSON[_0x158489(0x1ad)](_0x3f92ff)),console[_0x158489(0x1c8)](_0x158489(0x1a7)+_0x162c73[_0x158489(0x194)]+_0x158489(0x1c5)+_0x52f68e);return;}}catch(_0x822b10){console['error']('[MESH]\x20Error\x20serving\x20mesh:',_0x822b10);const _0x5a6c34={'op':_0x158489(0x1ed),'request_id':_0x162c73[_0x158489(0x1c2)],'error':_0x822b10[_0x158489(0x1d3)]};serverWs['send'](JSON[_0x158489(0x1ad)](_0x5a6c34));return;}rosbridgeWs[_0x158489(0x1f8)](_0x3f8d8d);}catch(_0x4f0a74){rosbridgeWs[_0x158489(0x1f8)](_0x3f8d8d);}}}),serverWs['on']('close',(_0x4cc309,_0x41d47b)=>{const _0x1a1b33=_0x1caef4;console['log'](_0x1a1b33(0x261)+_0x4cc309+':\x20'+_0x41d47b+_0x1a1b33(0x215)),webrtcService['stopAllSessions'](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x1caef4(0x22f),_0x2d2c6d=>{const _0x271143=_0x1caef4;console[_0x271143(0x22f)](_0x271143(0x203),_0x2d2c6d);});}catch(_0x4cefb5){console[_0x1caef4(0x22f)]('Failed\x20to\x20connect\x20to\x20server:',_0x4cefb5),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x272e47,_0x11bff1,_0x5bfa6a)=>{const _0x5a6b3b=a1_0x1cab69;if(!authService[_0x5a6b3b(0x1a6)]()){console['log'](_0x5a6b3b(0x265),config[_0x5a6b3b(0x24c)]);const _0x4b5407=await authService[_0x5a6b3b(0x20e)]();if(!_0x4b5407)return _0x11bff1[_0x5a6b3b(0x211)](0x191)[_0x5a6b3b(0x1c0)]({'error':'Authentication\x20required'});}_0x5bfa6a();};app[a1_0x1cab69(0x200)]((_0x59bc87,_0x5136eb,_0x19a76f)=>{const _0x7883d4=a1_0x1cab69;_0x5136eb[_0x7883d4(0x249)](_0x7883d4(0x1a5),'*'),_0x5136eb[_0x7883d4(0x249)](_0x7883d4(0x252),_0x7883d4(0x214)),_0x5136eb[_0x7883d4(0x249)](_0x7883d4(0x1f1),_0x7883d4(0x22b)),_0x59bc87[_0x7883d4(0x201)]===_0x7883d4(0x21a)?_0x5136eb[_0x7883d4(0x259)](0xc8):_0x19a76f();}),app[a1_0x1cab69(0x1a8)]('/',requireAuth,(_0x3a3df4,_0xe08390)=>{const _0x2b8736=a1_0x1cab69;_0xe08390[_0x2b8736(0x1f8)](_0x2b8736(0x1a4));}),app[a1_0x1cab69(0x1a8)](a1_0x1cab69(0x1d1),async(_0x23654a,_0x6bd3d9)=>{const _0x38a1bc=a1_0x1cab69,_0x45ef0d=authService[_0x38a1bc(0x1a6)](),_0x478de2=webrtcService['getActiveSessions'](),_0x2c0c18=webrtcService[_0x38a1bc(0x20a)](),_0x1c42fe=topicManager[_0x38a1bc(0x1e2)]();_0x6bd3d9[_0x38a1bc(0x1c0)]({'status':'ok','environment':process['env'][_0x38a1bc(0x225)]||_0x38a1bc(0x213),'backendUrl':config[_0x38a1bc(0x24c)],'rosbridgeUrl':config[_0x38a1bc(0x1e5)]['wsEndpoint'],'proxyPort':port,'authenticated':_0x45ef0d,'topicManagement':{'discovered':_0x1c42fe[_0x38a1bc(0x1b2)],'strategies':_0x1c42fe[_0x38a1bc(0x209)],'largeDataTopics':_0x1c42fe[_0x38a1bc(0x24f)][_0x38a1bc(0x25f)],'largeTopicsList':_0x1c42fe['largeDataTopics']},'webrtc':{'activeSessions':_0x478de2[_0x38a1bc(0x25f)],'sharedVideoSources':_0x2c0c18[_0x38a1bc(0x25f)],'sessions':_0x478de2,'sharedSources':_0x2c0c18}});});const getInitialPort=()=>{const _0x1492f3=a1_0x1cab69;if(process[_0x1492f3(0x238)][_0x1492f3(0x262)])return parseInt(process[_0x1492f3(0x238)]['PORT'],0xa);return config[_0x1492f3(0x1e5)]['proxyPort'];};async function listenWithRetries(_0xbdbb8e,_0x40fac4,_0x4a7dc3=0xa){const _0x54045f=a1_0x1cab69;let _0x2a5adc=_0x40fac4;for(let _0x4f4453=0x1;_0x4f4453<=_0x4a7dc3;_0x4f4453++){try{return await new Promise((_0x4743d3,_0x37557c)=>{const _0x2375e3=a1_0x1584,_0x46edac=_0xbdbb8e[_0x2375e3(0x193)](_0x2a5adc,()=>{const _0x43cf85=_0x2375e3;console[_0x43cf85(0x1c8)]('Appliance\x20server\x20started\x20successfully\x20on\x20port\x20'+_0x2a5adc),_0x4743d3(_0x46edac);});_0x46edac['on'](_0x2375e3(0x22f),_0x236169=>{const _0x39d56f=_0x2375e3;_0x236169[_0x39d56f(0x25a)]==='EADDRINUSE'?(console[_0x39d56f(0x233)](_0x39d56f(0x24d)+_0x2a5adc+_0x39d56f(0x1f6)),_0x37557c(_0x236169)):_0x37557c(_0x236169);});}),_0x2a5adc;}catch(_0x5b2bda){_0x2a5adc++;}}throw new Error(_0x54045f(0x1a9)+_0x4a7dc3+_0x54045f(0x23b)+_0x40fac4);}function a1_0x1584(_0x12a9b9,_0x5c2f4f){const _0x594183=a1_0x3357();return a1_0x1584=function(_0x5aebf7,_0x5994b6){_0x5aebf7=_0x5aebf7-0x193;let _0x33579d=_0x594183[_0x5aebf7];return _0x33579d;},a1_0x1584(_0x12a9b9,_0x5c2f4f);}const startApp=async()=>{const _0x3221e9=a1_0x1cab69;try{reloadEnv();let _0x5cef4a=await authService['login']();while(!_0x5cef4a){console[_0x3221e9(0x1c8)](_0x3221e9(0x243)),await promptForCredentials(),_0x5cef4a=await authService[_0x3221e9(0x20e)]();}console['log'](_0x3221e9(0x1e6));!loadApplianceIdentity()&&console['log']('No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.');console[_0x3221e9(0x1c8)](_0x3221e9(0x1d2));const _0x509527=await registerWithServer();if(!_0x509527)throw new Error(_0x3221e9(0x196));connectToRosbridge(),connectToServer();const _0xb7c2a5=getInitialPort();await listenWithRetries(app,_0xb7c2a5,0xa);}catch(_0x560c2b){console[_0x3221e9(0x22f)](_0x3221e9(0x1aa),_0x560c2b),process[_0x3221e9(0x1cf)](0x1);}};setInterval(async()=>{const _0xbfb77d=a1_0x1cab69;try{if(robotId){const _0xdd2b4a=authService['getToken']();await axios[_0xbfb77d(0x219)](config[_0xbfb77d(0x24c)]+_0xbfb77d(0x1da),{'robotId':robotId},{'headers':{'Authorization':_0xbfb77d(0x1ce)+_0xdd2b4a,'Content-Type':_0xbfb77d(0x1f7)}});}}catch(_0x21cfef){console['error'](_0xbfb77d(0x216),_0x21cfef[_0xbfb77d(0x1d3)]);}},0x1388),startApp();