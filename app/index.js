const a1_0x862c62=a1_0x4ea3;(function(_0x2cebde,_0x35a146){const _0x548349=a1_0x4ea3,_0x5741c8=_0x2cebde();while(!![]){try{const _0x385280=-parseInt(_0x548349(0x155))/0x1*(parseInt(_0x548349(0x12c))/0x2)+-parseInt(_0x548349(0x10b))/0x3+-parseInt(_0x548349(0x11d))/0x4*(-parseInt(_0x548349(0x103))/0x5)+parseInt(_0x548349(0x127))/0x6*(-parseInt(_0x548349(0x14e))/0x7)+-parseInt(_0x548349(0x13a))/0x8+-parseInt(_0x548349(0x100))/0x9+parseInt(_0x548349(0xb9))/0xa;if(_0x385280===_0x35a146)break;else _0x5741c8['push'](_0x5741c8['shift']());}catch(_0x2f69bd){_0x5741c8['push'](_0x5741c8['shift']());}}}(a1_0x17c5,0x27028));const a1_0x1726ed=(function(){let _0x3e69dc=!![];return function(_0x124811,_0x1e458e){const _0x59090d=_0x3e69dc?function(){const _0x481624=a1_0x4ea3;if(_0x1e458e){const _0x2c3328=_0x1e458e[_0x481624(0xf9)](_0x124811,arguments);return _0x1e458e=null,_0x2c3328;}}:function(){};return _0x3e69dc=![],_0x59090d;};}()),a1_0x2fece7=a1_0x1726ed(this,function(){const _0x40341f=a1_0x4ea3;return a1_0x2fece7['toString']()[_0x40341f(0xe7)](_0x40341f(0xf5))['toString']()[_0x40341f(0x11a)](a1_0x2fece7)[_0x40341f(0xe7)](_0x40341f(0xf5));});a1_0x2fece7();const dotenv=require(a1_0x862c62(0x14d));dotenv[a1_0x862c62(0x134)]();const express=require('express'),config=require(a1_0x862c62(0x15f));process[a1_0x862c62(0xdb)][a1_0x862c62(0xf4)]&&process[a1_0x862c62(0xdb)][a1_0x862c62(0xff)]&&(config[a1_0x862c62(0x12a)][a1_0x862c62(0x161)]=process['env'][a1_0x862c62(0xf4)],config[a1_0x862c62(0x12a)][a1_0x862c62(0x156)]=process[a1_0x862c62(0xdb)]['APP_PASSWORD'],console['log'](a1_0x862c62(0x12b)));const authService=require(a1_0x862c62(0xe1)),webrtcService=require('./services/webrtcService'),topicManager=require(a1_0x862c62(0x163)),WebSocket=require('ws'),axios=require(a1_0x862c62(0x10a)),fs=require('fs'),prompt=require('prompt-sync')({'sigint':!![]}),app=express(),port=process['env']['PORT']||config['rosbridge']['proxyPort'],APPLIANCE_FILE=a1_0x862c62(0x13f),{DOMParser,XMLSerializer}=require('xmldom'),path=require(a1_0x862c62(0xe3)),{execSync}=require('child_process'),APPLIANCE_BASE_URL=process[a1_0x862c62(0xdb)][a1_0x862c62(0x144)]||'';console['log'](a1_0x862c62(0x151)+(process[a1_0x862c62(0xdb)][a1_0x862c62(0xd4)]||a1_0x862c62(0x115))),console[a1_0x862c62(0x111)](a1_0x862c62(0x15b)+config['serverUrl']),console[a1_0x862c62(0x111)](a1_0x862c62(0x166)+config[a1_0x862c62(0xbe)][a1_0x862c62(0xca)]),console[a1_0x862c62(0x111)]('Proxy\x20listening\x20on\x20port:\x20'+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x3cf51c,_0x345d47){const _0x41d3b1=a1_0x862c62;fs['writeFileSync'](_0x41d3b1(0xbb),_0x41d3b1(0x153)+_0x3cf51c+'\x0aAPP_PASSWORD='+_0x345d47+'\x0a');}function reloadEnv(){const _0x31f7d3=a1_0x862c62;dotenv[_0x31f7d3(0x134)]({'override':!![]}),config['credentials'][_0x31f7d3(0x161)]=process[_0x31f7d3(0xdb)][_0x31f7d3(0xf4)],config[_0x31f7d3(0x12a)][_0x31f7d3(0x156)]=process[_0x31f7d3(0xdb)][_0x31f7d3(0xff)],console[_0x31f7d3(0x111)]('Loaded\x20credentials:',{'username':config[_0x31f7d3(0x12a)][_0x31f7d3(0x161)]?_0x31f7d3(0xc2):'NOT\x20SET','password':config[_0x31f7d3(0x12a)][_0x31f7d3(0x156)]?_0x31f7d3(0xc2):_0x31f7d3(0x139)});}async function promptForCredentials(){const _0x52dd15=a1_0x862c62;process['env'][_0x52dd15(0xd4)]==='production'&&(console[_0x52dd15(0xea)]('Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file'),console[_0x52dd15(0xea)](_0x52dd15(0x164)),process[_0x52dd15(0x135)](0x1));const _0x3a1a13=prompt('Enter\x20username:\x20'),_0x10cb31=prompt[_0x52dd15(0x15c)](_0x52dd15(0xbd));updateEnvFile(_0x3a1a13,_0x10cb31),reloadEnv();}function loadApplianceIdentity(){const _0x3e5800=a1_0x862c62;if(fs['existsSync'](APPLIANCE_FILE))try{const _0x3f4c5f=JSON[_0x3e5800(0xf3)](fs[_0x3e5800(0xf1)](APPLIANCE_FILE,'utf8'));if(_0x3f4c5f[_0x3e5800(0x119)]&&_0x3f4c5f[_0x3e5800(0x108)])return robotId=_0x3f4c5f[_0x3e5800(0x119)],registrationToken=_0x3f4c5f[_0x3e5800(0x108)],console[_0x3e5800(0x111)]('Loaded\x20appliance\x20identity:',robotId),topicManager[_0x3e5800(0x138)](_0x3f4c5f),!![];}catch(_0x266cee){console[_0x3e5800(0xea)]('Failed\x20to\x20parse\x20appliance\x20identity\x20file:',_0x266cee);}return![];}function saveApplianceIdentity(_0x4eb53c,_0x40ad99){const _0x1cb58d=a1_0x862c62;let _0x2e9ee8={};if(fs[_0x1cb58d(0xfd)](APPLIANCE_FILE))try{_0x2e9ee8=JSON[_0x1cb58d(0xf3)](fs[_0x1cb58d(0xf1)](APPLIANCE_FILE,_0x1cb58d(0x102)));}catch(_0x112a29){_0x2e9ee8={};}_0x2e9ee8[_0x1cb58d(0x119)]=_0x4eb53c,_0x2e9ee8[_0x1cb58d(0x108)]=_0x40ad99,fs[_0x1cb58d(0x154)](APPLIANCE_FILE,JSON[_0x1cb58d(0xcf)](_0x2e9ee8,null,0x2));}async function registerWithServer(){const _0x44398e=a1_0x862c62;try{const _0x4b3cb1=authService[_0x44398e(0xe9)]();if(!_0x4b3cb1)throw new Error(_0x44398e(0xc6));let _0x48aacb,_0x2eaf50=![];while(!![]){try{robotId&&registrationToken?_0x48aacb=await axios[_0x44398e(0x173)](config[_0x44398e(0x174)]+_0x44398e(0x128),{'name':'WSL\x20Appliance','robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x44398e(0xe6)+_0x4b3cb1,'Content-Type':_0x44398e(0xcd)}}):_0x48aacb=await axios['post'](config[_0x44398e(0x174)]+_0x44398e(0x128),{'name':'WSL\x20Appliance'},{'headers':{'Authorization':_0x44398e(0xe6)+_0x4b3cb1,'Content-Type':_0x44398e(0xcd)}});break;}catch(_0x1cc3df){const _0x103d48=_0x1cc3df?.[_0x44398e(0xf8)]?.['data']?.[_0x44398e(0xea)]||_0x1cc3df[_0x44398e(0xee)];if(!_0x2eaf50&&_0x103d48&&_0x103d48[_0x44398e(0xb3)]()[_0x44398e(0x10c)](_0x44398e(0xd1))){console[_0x44398e(0xd8)]('Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.');if(fs[_0x44398e(0xfd)](APPLIANCE_FILE))fs[_0x44398e(0x152)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x2eaf50=!![];continue;}throw _0x1cc3df;}}if(!_0x48aacb[_0x44398e(0xe8)]||!_0x48aacb[_0x44398e(0xe8)][_0x44398e(0x15a)]||!_0x48aacb[_0x44398e(0xe8)]['id'])throw new Error(_0x44398e(0xda));return registrationToken=_0x48aacb[_0x44398e(0xe8)][_0x44398e(0x15a)],robotId=_0x48aacb[_0x44398e(0xe8)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x44398e(0x111)](_0x44398e(0x162)),!![];}catch(_0x58040b){return console[_0x44398e(0xea)](_0x44398e(0xd3),_0x58040b[_0x44398e(0xee)]),![];}}function rewriteUrdfMeshUris(_0x1a2b17){const _0x3d46f3=a1_0x862c62;try{const _0x386537=new DOMParser(),_0x4d4d73=_0x386537[_0x3d46f3(0x13d)](_0x1a2b17,_0x3d46f3(0x132));let _0x30f6e3=0x0,_0x7a86b9=0x0;const _0x3131cd=_0x4d4d73['getElementsByTagName'](_0x3d46f3(0x145));for(let _0x5194fd=0x0;_0x5194fd<_0x3131cd['length'];_0x5194fd++){const _0xbcf0c=_0x3131cd[_0x5194fd],_0x3031f6=_0xbcf0c['getAttribute']('filename'),_0x961ebd=[_0x3d46f3(0x15e),'.dae','.obj',_0x3d46f3(0x118),_0x3d46f3(0x125)],_0x1d7468=_0x961ebd[_0x3d46f3(0x16c)](_0x55bc2c=>_0x3031f6[_0x3d46f3(0xb3)]()[_0x3d46f3(0xeb)](_0x55bc2c));if(_0x3031f6&&_0x3031f6[_0x3d46f3(0xcc)](_0x3d46f3(0x13b))&&_0x1d7468){_0x30f6e3++;const _0x53fa21=APPLIANCE_BASE_URL+_0x3d46f3(0x13e)+encodeURIComponent(_0x3031f6);_0xbcf0c[_0x3d46f3(0x123)]('filename',_0x53fa21),_0x7a86b9++,console[_0x3d46f3(0x111)](_0x3d46f3(0x168)+_0x3031f6+_0x3d46f3(0xec)+_0x53fa21);}}_0x30f6e3>0x0?console[_0x3d46f3(0x111)](_0x3d46f3(0x14c)+_0x7a86b9+'\x20of\x20'+_0x30f6e3+_0x3d46f3(0x175)):console[_0x3d46f3(0x111)](_0x3d46f3(0x11b));const _0x24a1ff=new XMLSerializer();return _0x24a1ff[_0x3d46f3(0x10e)](_0x4d4d73);}catch(_0x30a3fe){return console[_0x3d46f3(0xea)](_0x3d46f3(0xfc),_0x30a3fe),_0x1a2b17;}}function a1_0x17c5(){const _0x502b13=['.env','\x20from\x20','Enter\x20password:\x20','rosbridge','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','string','join','SET','forward','action','http','Not\x20authenticated','ros2\x20pkg\x20prefix\x20','Connected\x20to\x20ROSBridge\x20(main)','readyState','wsEndpoint','strategies','startsWith','application/json','publish','stringify','sample','robot\x20not\x20found','Mesh\x20file\x20not\x20found:\x20','Failed\x20to\x20register\x20with\x20server:','NODE_ENV','toString','status','Attempting\x20to\x20login\x20to:','warn','/health','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','env','topics','getSharedVideoSources','/robot_description','Failed\x20to\x20ping\x20server:','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','./services/auth','share','path','header','open','Bearer\x20','search','data','getToken','error','endsWith','\x20->\x20','\x20in\x20use,\x20trying\x20next\x20port...','message','estimatedSize','ROSBridge\x20(main)\x20connection\x20error:','readFileSync','map','parse','APP_USERNAME','(((.+)+)+)+$','urdf_param_data','Access-Control-Allow-Headers','response','apply','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','get_urdf_param','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','existsSync','Server\x20connection\x20error:','APP_PASSWORD','1429605YwtVkv','msg','utf8','85190YMBbAE','reason','largeDataTopics','values','[MESH]\x20Successfully\x20served\x20mesh:\x20','registrationToken','unknown','axios','5361WtxaXi','includes','OPEN','serializeToString','connection','Access-Control-Allow-Methods','log','sendStatus','Port\x20','Authentication\x20required','development','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','),\x20attempting\x20to\x20reconnect...','.ply','robotId','constructor','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','totalTopics','24ZErBPI','stopAllSessions','Topic\x20discovery\x20failed:','getStatistics','Failed\x20to\x20connect\x20to\x20server:','Access-Control-Allow-Origin','setAttribute','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','.mesh','getActiveSessions','2382Mnyhve','/appliance/register','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','credentials','Initial\x20credentials\x20loaded\x20from\x20environment','92Usgebi','code','handleMessage','json','trim','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','text/xml','login','config','exit','uri','Connected\x20to\x20server','loadConfig','NOT\x20SET','1661784FLMzEL','package://','close','parseFromString','/ros/mesh?uri=','.appliance.json','EADDRINUSE','getTopicStrategy','method','call_service','APPLIANCE_BASE_URL','mesh','/appliance/ping','roslib','samplingRate','OPTIONS','Failed\x20to\x20start\x20application:','Appliance\x20is\x20running\x20and\x20authenticated!','[URDF\x20REWRITE]\x20Rewrote\x20','dotenv','329QGOTmY','param_name','length','Environment:\x20','unlinkSync','APP_USERNAME=','writeFileSync','2281wqDgDP','password','discoverTopics','request_id','name','registration_token','Backend\x20Server\x20URL:\x20','hide','String\x20value\x20is:\x20','.stl','./config','proxyPort','username','Successfully\x20registered\x20with\x20server','./services/TopicManager','Please\x20run:\x20./setup.sh\x20reconfigure','slice','ROSBridge\x20WebSocket\x20URL:\x20','substring','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','catch','type','mesh_data','some','throttling','PORT','topic','types','sample_skip','use','post','serverUrl','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','isAuthenticated','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','toLowerCase','replace','strategy','get_mesh','[MESH]\x20Error\x20serving\x20mesh:','send','5494960JRGXnu','base64'];a1_0x17c5=function(){return _0x502b13;};return a1_0x17c5();}function connectToRosbridge(){const _0xbe37ce=a1_0x862c62;try{rosbridgeWs=new WebSocket(config[_0xbe37ce(0xbe)][_0xbe37ce(0xca)]),rosbridgeWs['on'](_0xbe37ce(0xe5),()=>{const _0x58ebe6=_0xbe37ce;console[_0x58ebe6(0x111)](_0x58ebe6(0xc8));const _0x18ee20=require(_0x58ebe6(0x147)),_0x589fad=new _0x18ee20['Ros']({'url':config[_0x58ebe6(0xbe)][_0x58ebe6(0xca)]});_0x589fad['on'](_0x58ebe6(0x10f),()=>{setTimeout(()=>{const _0x5014ec=a1_0x4ea3;topicManager[_0x5014ec(0x157)](_0x589fad)[_0x5014ec(0x169)](_0x28a278=>{const _0x8a4143=_0x5014ec;console[_0x8a4143(0xea)](_0x8a4143(0x11f),_0x28a278);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on']('message',_0x25b769=>{const _0x9bb1b3=_0xbe37ce;if(serverWs&&serverWs[_0x9bb1b3(0xc9)]===WebSocket[_0x9bb1b3(0x10d)]){let _0x4264a1=_0x25b769[_0x9bb1b3(0xd5)]();try{const _0x280de8=JSON[_0x9bb1b3(0xf3)](_0x4264a1);if(_0x280de8['op']===_0x9bb1b3(0xce)&&_0x280de8[_0x9bb1b3(0x16f)]){const _0x2a7e03=topicManager['handleMessage'](_0x280de8);switch(_0x2a7e03[_0x9bb1b3(0xc4)]){case _0x9bb1b3(0x171):return;case'webrtc_skip':return;case _0x9bb1b3(0xc3):default:_0x4264a1=JSON[_0x9bb1b3(0xcf)](_0x2a7e03[_0x9bb1b3(0xee)]);break;}}if((_0x280de8['op']==='service_response'||_0x280de8['op']===_0x9bb1b3(0x143))&&(_0x280de8['service']==='/rosapi/topics'||_0x280de8[_0x9bb1b3(0x106)]&&_0x280de8[_0x9bb1b3(0x106)]['topics'])){console[_0x9bb1b3(0x111)](_0x9bb1b3(0x17a));const _0x5d743a=_0x280de8[_0x9bb1b3(0x106)]?.[_0x9bb1b3(0xdc)]||[],_0x124e16=_0x280de8['values']?.[_0x9bb1b3(0x170)]||[],_0x54502a=_0x5d743a[_0x9bb1b3(0xf2)]((_0xd4449,_0x425937)=>{const _0x3d0b02=_0x9bb1b3,_0x56cf04=topicManager[_0x3d0b02(0x141)](_0xd4449);return{'name':_0xd4449,'type':_0x124e16[_0x425937]||_0x3d0b02(0x109),'throttling':_0x56cf04?{'isThrottled':_0x56cf04[_0x3d0b02(0xb5)]===_0x3d0b02(0xd0),'strategy':_0x56cf04[_0x3d0b02(0xb5)],'samplingRate':_0x56cf04[_0x3d0b02(0x148)],'reason':_0x56cf04[_0x3d0b02(0x104)],'estimatedSize':_0x56cf04[_0x3d0b02(0xef)]}:null};});_0x280de8['values']={'topics':_0x54502a['map'](_0x247f8c=>_0x247f8c[_0x9bb1b3(0x159)]),'types':_0x54502a[_0x9bb1b3(0xf2)](_0x44c7e8=>_0x44c7e8[_0x9bb1b3(0x16a)]),'throttling':_0x54502a['map'](_0x25896f=>_0x25896f[_0x9bb1b3(0x16d)])},_0x4264a1=JSON['stringify'](_0x280de8),console['log']('[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client');}if(_0x280de8['op']===_0x9bb1b3(0xce)&&_0x280de8[_0x9bb1b3(0x16f)]===_0x9bb1b3(0xde))try{const _0x55ed32=_0x280de8[_0x9bb1b3(0x101)][_0x9bb1b3(0xe8)],_0x28cab8=rewriteUrdfMeshUris(_0x55ed32);_0x280de8[_0x9bb1b3(0x101)][_0x9bb1b3(0xe8)]=_0x28cab8,_0x4264a1=JSON[_0x9bb1b3(0xcf)](_0x280de8);}catch(_0x3868f6){console[_0x9bb1b3(0xea)](_0x9bb1b3(0xe0),_0x3868f6);}}catch(_0x21c220){console[_0x9bb1b3(0xd8)](_0x9bb1b3(0x129),_0x21c220['message']);}serverWs[_0x9bb1b3(0xb8)](_0x4264a1);}}),rosbridgeWs['on'](_0xbe37ce(0x13c),()=>{const _0x202522=_0xbe37ce;console[_0x202522(0x111)](_0x202522(0x179)),webrtcService['stopAllSessions'](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on']('error',_0x2210c1=>{const _0x11350e=_0xbe37ce;console[_0x11350e(0xea)](_0x11350e(0xf0),_0x2210c1);});}catch(_0xab5c1b){console[_0xbe37ce(0xea)]('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):',_0xab5c1b),setTimeout(connectToRosbridge,0x1388);}}function a1_0x4ea3(_0x149233,_0x1f692d){const _0x3e51e7=a1_0x17c5();return a1_0x4ea3=function(_0x2fece7,_0x1726ed){_0x2fece7=_0x2fece7-0xb3;let _0x17c554=_0x3e51e7[_0x2fece7];return _0x17c554;},a1_0x4ea3(_0x149233,_0x1f692d);}function connectToRosbridgeWebRTC(){const _0xaf4676=a1_0x862c62;try{rosbridgeWebRTCWs=new WebSocket(config['rosbridge']['wsEndpoint']),rosbridgeWebRTCWs['on'](_0xaf4676(0xe5),()=>{const _0xc1aa6b=_0xaf4676;console[_0xc1aa6b(0x111)]('Connected\x20to\x20ROSBridge\x20(WebRTC)'),webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0xaf4676(0xee),_0x19f649=>{}),rosbridgeWebRTCWs['on'](_0xaf4676(0x13c),()=>{const _0x56cc3a=_0xaf4676;console[_0x56cc3a(0x111)]('Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x56cc3a(0x11e)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0xaf4676(0xea),_0x1a556c=>{const _0x2011af=_0xaf4676;console[_0x2011af(0xea)]('ROSBridge\x20(WebRTC)\x20connection\x20error:',_0x1a556c);});}catch(_0x3ba6cc){console['error'](_0xaf4676(0x177),_0x3ba6cc),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x6574e9=a1_0x862c62;try{if(!registrationToken)throw new Error(_0x6574e9(0x124));const _0x214d02=config[_0x6574e9(0x174)][_0x6574e9(0xb4)](_0x6574e9(0xc5),'ws')+'/rosbridge?type=appliance&token='+registrationToken;serverWs=new WebSocket(_0x214d02),serverWs['on'](_0x6574e9(0xe5),()=>{const _0x2d73d2=_0x6574e9;console[_0x2d73d2(0x111)](_0x2d73d2(0x137)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x2d73d2(0xc9)]===WebSocket[_0x2d73d2(0x10d)]&&webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x6574e9(0xee),_0x1ab9c8=>{const _0x78c47=_0x6574e9;if(rosbridgeWs&&rosbridgeWs[_0x78c47(0xc9)]===WebSocket['OPEN']){let _0x11cce3=_0x1ab9c8[_0x78c47(0xd5)]();try{const _0xee7cee=JSON[_0x78c47(0xf3)](_0x11cce3);if(webrtcService[_0x78c47(0x12e)](_0xee7cee))return;if(_0xee7cee['op']===_0x78c47(0xfb)&&typeof _0xee7cee[_0x78c47(0x14f)]==='string'&&_0xee7cee[_0x78c47(0x158)])try{console[_0x78c47(0x111)]('[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20'+_0xee7cee[_0x78c47(0x14f)]);const _0x4d5ff9=execSync('ros2\x20param\x20get\x20'+_0xee7cee[_0x78c47(0x14f)],{'encoding':_0x78c47(0x102)})[_0x78c47(0x130)]();let _0x5b42f3=_0x4d5ff9;_0x4d5ff9['startsWith'](_0x78c47(0x15d))&&(_0x5b42f3=_0x4d5ff9[_0x78c47(0x167)]('String\x20value\x20is:\x20'[_0x78c47(0x150)]()));_0x5b42f3[_0x78c47(0xcc)]('\x22')&&_0x5b42f3['endsWith']('\x22')&&(_0x5b42f3=_0x5b42f3[_0x78c47(0x165)](0x1,-0x1));_0x5b42f3=_0x5b42f3[_0x78c47(0xb4)](/\\n/g,'\x0a')['replace'](/\\"/g,'\x22');const _0x2171d5={'op':'urdf_param_data','request_id':_0xee7cee[_0x78c47(0x158)],'data':_0x5b42f3};serverWs[_0x78c47(0xb8)](JSON[_0x78c47(0xcf)](_0x2171d5)),console[_0x78c47(0x111)]('[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20'+_0xee7cee[_0x78c47(0x14f)]);return;}catch(_0x3317a3){console[_0x78c47(0xea)](_0x78c47(0x176),_0x3317a3);const _0xa38b19={'op':_0x78c47(0xf6),'request_id':_0xee7cee[_0x78c47(0x158)],'error':_0x3317a3['message']};serverWs[_0x78c47(0xb8)](JSON[_0x78c47(0xcf)](_0xa38b19));return;}if(_0xee7cee['op']===_0x78c47(0xb6)&&typeof _0xee7cee[_0x78c47(0x136)]===_0x78c47(0xc0)&&_0xee7cee[_0x78c47(0x158)])try{const _0x30dd71=_0xee7cee['uri']['match'](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x30dd71){const _0x2fbb98=_0x30dd71[0x1],_0x1b3b69=_0x30dd71[0x2],_0x14ac6f=execSync(_0x78c47(0xc7)+_0x2fbb98,{'encoding':_0x78c47(0x102)})['trim'](),_0x45e86f=path[_0x78c47(0xc1)](_0x14ac6f,_0x78c47(0xe2),_0x2fbb98,_0x1b3b69);if(!fs[_0x78c47(0xfd)](_0x45e86f))throw new Error(_0x78c47(0xd2)+_0x45e86f);const _0x659c2=fs['readFileSync'](_0x45e86f),_0x42610d={'op':'mesh_data','request_id':_0xee7cee['request_id'],'data':_0x659c2[_0x78c47(0xd5)](_0x78c47(0xba))};serverWs['send'](JSON[_0x78c47(0xcf)](_0x42610d)),console[_0x78c47(0x111)](_0x78c47(0x107)+_0xee7cee[_0x78c47(0x136)]+_0x78c47(0xbc)+_0x45e86f);return;}}catch(_0x442bc7){console[_0x78c47(0xea)](_0x78c47(0xb7),_0x442bc7);const _0x37533f={'op':_0x78c47(0x16b),'request_id':_0xee7cee['request_id'],'error':_0x442bc7[_0x78c47(0xee)]};serverWs[_0x78c47(0xb8)](JSON[_0x78c47(0xcf)](_0x37533f));return;}rosbridgeWs['send'](_0x11cce3);}catch(_0x215e22){rosbridgeWs['send'](_0x11cce3);}}}),serverWs['on'](_0x6574e9(0x13c),(_0x572fca,_0x48b3cb)=>{const _0x1ba297=_0x6574e9;console[_0x1ba297(0x111)]('Disconnected\x20from\x20server\x20('+_0x572fca+':\x20'+_0x48b3cb+_0x1ba297(0x117)),webrtcService['stopAllSessions'](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x6574e9(0xea),_0x4d5aa8=>{const _0x2fb7f6=_0x6574e9;console[_0x2fb7f6(0xea)](_0x2fb7f6(0xfe),_0x4d5aa8);});}catch(_0x209b73){console[_0x6574e9(0xea)](_0x6574e9(0x121),_0x209b73),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x3da5f3,_0x3ba614,_0xf8f132)=>{const _0x26168a=a1_0x862c62;if(!authService[_0x26168a(0x178)]()){console['log'](_0x26168a(0xd7),config[_0x26168a(0x174)]);const _0x4a8f1c=await authService[_0x26168a(0x133)]();if(!_0x4a8f1c)return _0x3ba614[_0x26168a(0xd6)](0x191)[_0x26168a(0x12f)]({'error':_0x26168a(0x114)});}_0xf8f132();};app[a1_0x862c62(0x172)]((_0x2f9840,_0x216300,_0x3503a0)=>{const _0x481cb9=a1_0x862c62;_0x216300[_0x481cb9(0xe4)](_0x481cb9(0x122),'*'),_0x216300[_0x481cb9(0xe4)](_0x481cb9(0x110),_0x481cb9(0xbf)),_0x216300[_0x481cb9(0xe4)](_0x481cb9(0xf7),'Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization'),_0x2f9840[_0x481cb9(0x142)]===_0x481cb9(0x149)?_0x216300[_0x481cb9(0x112)](0xc8):_0x3503a0();}),app['get']('/',requireAuth,(_0x361b5b,_0x2fbc17)=>{const _0x2b5487=a1_0x862c62;_0x2fbc17[_0x2b5487(0xb8)](_0x2b5487(0x14b));}),app['get'](a1_0x862c62(0xd9),async(_0x465f97,_0x2637c1)=>{const _0x37ac5c=a1_0x862c62,_0x27572d=authService[_0x37ac5c(0x178)](),_0x2e26b0=webrtcService[_0x37ac5c(0x126)](),_0x1e0d35=webrtcService[_0x37ac5c(0xdd)](),_0x4dcf62=topicManager[_0x37ac5c(0x120)]();_0x2637c1[_0x37ac5c(0x12f)]({'status':'ok','environment':process['env'][_0x37ac5c(0xd4)]||'development','backendUrl':config[_0x37ac5c(0x174)],'rosbridgeUrl':config[_0x37ac5c(0xbe)][_0x37ac5c(0xca)],'proxyPort':port,'authenticated':_0x27572d,'topicManagement':{'discovered':_0x4dcf62[_0x37ac5c(0x11c)],'strategies':_0x4dcf62[_0x37ac5c(0xcb)],'largeDataTopics':_0x4dcf62[_0x37ac5c(0x105)]['length'],'largeTopicsList':_0x4dcf62[_0x37ac5c(0x105)]},'webrtc':{'activeSessions':_0x2e26b0[_0x37ac5c(0x150)],'sharedVideoSources':_0x1e0d35[_0x37ac5c(0x150)],'sessions':_0x2e26b0,'sharedSources':_0x1e0d35}});});const getInitialPort=()=>{const _0x211e2f=a1_0x862c62;if(process[_0x211e2f(0xdb)][_0x211e2f(0x16e)])return parseInt(process[_0x211e2f(0xdb)]['PORT'],0xa);return config[_0x211e2f(0xbe)][_0x211e2f(0x160)];};async function listenWithRetries(_0x1a7509,_0x10fefe,_0x23ef52=0xa){let _0x583ab2=_0x10fefe;for(let _0x49dd39=0x1;_0x49dd39<=_0x23ef52;_0x49dd39++){try{return await new Promise((_0x2bf215,_0xc113b9)=>{const _0x1caec5=a1_0x4ea3,_0x5770b6=_0x1a7509['listen'](_0x583ab2,()=>{const _0x5f2f1f=a1_0x4ea3;console['log'](_0x5f2f1f(0x131)+_0x583ab2),_0x2bf215(_0x5770b6);});_0x5770b6['on'](_0x1caec5(0xea),_0x1014e5=>{const _0x33f0c0=_0x1caec5;_0x1014e5[_0x33f0c0(0x12d)]===_0x33f0c0(0x140)?(console[_0x33f0c0(0xd8)](_0x33f0c0(0x113)+_0x583ab2+_0x33f0c0(0xed)),_0xc113b9(_0x1014e5)):_0xc113b9(_0x1014e5);});}),_0x583ab2;}catch(_0x5a7a8e){_0x583ab2++;}}throw new Error('Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20'+_0x23ef52+'\x20attempts\x20starting\x20from\x20'+_0x10fefe);}const startApp=async()=>{const _0x90340=a1_0x862c62;try{reloadEnv();let _0x102839=await authService[_0x90340(0x133)]();while(!_0x102839){console[_0x90340(0x111)](_0x90340(0x116)),await promptForCredentials(),_0x102839=await authService[_0x90340(0x133)]();}console[_0x90340(0x111)]('Successfully\x20logged\x20in');!loadApplianceIdentity()&&console[_0x90340(0x111)](_0x90340(0xfa));console[_0x90340(0x111)]('Registering\x20with\x20server...');const _0x1eaefb=await registerWithServer();if(!_0x1eaefb)throw new Error('Failed\x20to\x20register\x20with\x20server');connectToRosbridge(),connectToServer();const _0x5c9b28=getInitialPort();await listenWithRetries(app,_0x5c9b28,0xa);}catch(_0x43b0b4){console[_0x90340(0xea)](_0x90340(0x14a),_0x43b0b4),process[_0x90340(0x135)](0x1);}};setInterval(async()=>{const _0x4154c6=a1_0x862c62;try{if(robotId){const _0x159744=authService['getToken']();await axios[_0x4154c6(0x173)](config[_0x4154c6(0x174)]+_0x4154c6(0x146),{'robotId':robotId},{'headers':{'Authorization':_0x4154c6(0xe6)+_0x159744,'Content-Type':_0x4154c6(0xcd)}});}}catch(_0x57934c){console[_0x4154c6(0xea)](_0x4154c6(0xdf),_0x57934c['message']);}},0x1388),startApp();