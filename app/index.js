const a1_0x52e043=a1_0x54cd;(function(_0x4e4b57,_0x211675){const _0x18212e=a1_0x54cd,_0x425bbb=_0x4e4b57();while(!![]){try{const _0x3a093c=parseInt(_0x18212e(0xeb))/0x1+parseInt(_0x18212e(0x12f))/0x2*(parseInt(_0x18212e(0x125))/0x3)+-parseInt(_0x18212e(0x13a))/0x4*(-parseInt(_0x18212e(0xd0))/0x5)+parseInt(_0x18212e(0x13d))/0x6*(-parseInt(_0x18212e(0x109))/0x7)+-parseInt(_0x18212e(0x159))/0x8+-parseInt(_0x18212e(0x105))/0x9*(-parseInt(_0x18212e(0x104))/0xa)+parseInt(_0x18212e(0xfc))/0xb*(parseInt(_0x18212e(0x144))/0xc);if(_0x3a093c===_0x211675)break;else _0x425bbb['push'](_0x425bbb['shift']());}catch(_0x4f4305){_0x425bbb['push'](_0x425bbb['shift']());}}}(a1_0x10ae,0xd4179));const a1_0x1d437e=(function(){let _0x195471=!![];return function(_0x8329b5,_0x219695){const _0x41d99=_0x195471?function(){const _0x1b94bc=a1_0x54cd;if(_0x219695){const _0x181f7f=_0x219695[_0x1b94bc(0xc4)](_0x8329b5,arguments);return _0x219695=null,_0x181f7f;}}:function(){};return _0x195471=![],_0x41d99;};}()),a1_0x4a64b6=a1_0x1d437e(this,function(){const _0x2a029c=a1_0x54cd;return a1_0x4a64b6['toString']()[_0x2a029c(0x107)](_0x2a029c(0x14a))[_0x2a029c(0x123)]()['constructor'](a1_0x4a64b6)['search'](_0x2a029c(0x14a));});a1_0x4a64b6();const dotenv=require(a1_0x52e043(0x161));dotenv[a1_0x52e043(0xdf)]();const express=require(a1_0x52e043(0xef)),config=require(a1_0x52e043(0xf7));process[a1_0x52e043(0xcd)][a1_0x52e043(0xc8)]&&process[a1_0x52e043(0xcd)][a1_0x52e043(0x16a)]&&(config[a1_0x52e043(0x11a)][a1_0x52e043(0x15f)]=process[a1_0x52e043(0xcd)][a1_0x52e043(0xc8)],config[a1_0x52e043(0x11a)][a1_0x52e043(0x170)]=process[a1_0x52e043(0xcd)][a1_0x52e043(0x16a)],console[a1_0x52e043(0xe6)](a1_0x52e043(0x13b)));const authService=require(a1_0x52e043(0x15d)),webrtcService=require(a1_0x52e043(0xd3)),topicManager=require(a1_0x52e043(0xc6)),WebSocket=require('ws'),axios=require(a1_0x52e043(0x163)),fs=require('fs'),prompt=require('prompt-sync')({'sigint':!![]}),app=express(),port=process[a1_0x52e043(0xcd)]['PORT']||config[a1_0x52e043(0xcc)][a1_0x52e043(0xc5)],APPLIANCE_FILE=a1_0x52e043(0xc2),{DOMParser,XMLSerializer}=require('xmldom'),path=require('path'),{execSync}=require(a1_0x52e043(0xe0)),APPLIANCE_BASE_URL=process['env']['APPLIANCE_BASE_URL']||'';function a1_0x10ae(){const _0x30cefc=['json','ROSBridge\x20(WebRTC)\x20connection\x20error:','./config','Failed\x20to\x20ping\x20server:','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','sample','ROSBridge\x20WebSocket\x20URL:\x20','22BOhEOh','writeFileSync','Authentication\x20required','isAuthenticated','existsSync','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','forward','application/json','9504670RykGFr','9pRXJiv','roslib','search','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','2174347FiuDwY','open','robot\x20not\x20found','header','NOT\x20SET','getSharedVideoSources','match','replace','NODE_ENV','String\x20value\x20is:\x20','wsEndpoint','data','initialize','sendStatus','get_mesh','ros2\x20pkg\x20prefix\x20','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','credentials','code','values','Enter\x20password:\x20','.env','map','filename','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','discoverTopics','toString','get_urdf_param','242211cZAzvk','service_response','stopAllSessions','topics','Bearer\x20','param_name','package://','substring','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','[MESH]\x20Error\x20serving\x20mesh:','4ZZPvim','development','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','Registering\x20with\x20server...','close','webrtc_skip','length','WSL\x20Appliance','ros2\x20param\x20get\x20','.stl','exit','15068cIyWYQ','Initial\x20credentials\x20loaded\x20from\x20environment','endsWith','12QZQUXx','\x20from\x20','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','warn','share','Access-Control-Allow-Headers','Failed\x20to\x20connect\x20to\x20server:','7290996FWbvzP','Environment:\x20','ROSBridge\x20(main)\x20connection\x20error:','Access-Control-Allow-Origin','readyState','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','(((.+)+)+)+$','/ros/mesh?uri=','/appliance/register','EADDRINUSE','samplingRate','setAttribute','strategy','Topic\x20discovery\x20failed:','parse','getStatistics','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','post','largeDataTopics','utf8','.mesh','12574848YHxUQS','getToken','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','uri','./services/auth','totalTopics','username','text/xml','dotenv','),\x20attempting\x20to\x20reconnect...','axios','msg','serverUrl','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','request_id','types','getActiveSessions','APP_PASSWORD','Failed\x20to\x20start\x20application:','listen','message','registration_token','Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file','password','\x20in\x20use,\x20trying\x20next\x20port...','serializeToString','/rosbridge?type=appliance&token=','includes','[MESH]\x20Successfully\x20served\x20mesh:\x20','Ros','join','toLowerCase','string','Server\x20connection\x20error:','call_service','login','robotId','OPTIONS','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','slice','.appliance.json','\x20attempts\x20starting\x20from\x20','apply','proxyPort','./services/TopicManager','/rosapi/topics','APP_USERNAME','registrationToken','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','send','rosbridge','env','\x20of\x20','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','890oFjWRl','OPEN','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','./services/webrtcService','Loaded\x20credentials:','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','production','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','Enter\x20username:\x20','\x20->\x20','mesh_data','/appliance/ping','topic','loadConfig','config','child_process','urdf_param_data','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','handleMessage','stringify','error','log','service','action','startsWith','PORT','64194JkFWSl','trim','get','mesh','express','unlinkSync','Port\x20','Please\x20run:\x20./setup.sh\x20reconfigure','base64','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.'];a1_0x10ae=function(){return _0x30cefc;};return a1_0x10ae();}console[a1_0x52e043(0xe6)](a1_0x52e043(0x145)+(process[a1_0x52e043(0xcd)]['NODE_ENV']||a1_0x52e043(0x130))),console['log']('Backend\x20Server\x20URL:\x20'+config[a1_0x52e043(0x165)]),console[a1_0x52e043(0xe6)](a1_0x52e043(0xfb)+config[a1_0x52e043(0xcc)]['wsEndpoint']),console[a1_0x52e043(0xe6)]('Proxy\x20listening\x20on\x20port:\x20'+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x2b09df,_0x1db688){const _0x5cdb10=a1_0x52e043;fs['writeFileSync'](_0x5cdb10(0x11e),'APP_USERNAME='+_0x2b09df+'\x0aAPP_PASSWORD='+_0x1db688+'\x0a');}function reloadEnv(){const _0x53d7d3=a1_0x52e043;dotenv['config']({'override':!![]}),config['credentials'][_0x53d7d3(0x15f)]=process[_0x53d7d3(0xcd)][_0x53d7d3(0xc8)],config[_0x53d7d3(0x11a)][_0x53d7d3(0x170)]=process['env'][_0x53d7d3(0x16a)],console[_0x53d7d3(0xe6)](_0x53d7d3(0xd4),{'username':config[_0x53d7d3(0x11a)][_0x53d7d3(0x15f)]?'SET':_0x53d7d3(0x10d),'password':config['credentials']['password']?'SET':_0x53d7d3(0x10d)});}async function promptForCredentials(){const _0x5bb558=a1_0x52e043;process[_0x5bb558(0xcd)][_0x5bb558(0x111)]===_0x5bb558(0xd7)&&(console[_0x5bb558(0xe5)](_0x5bb558(0x16f)),console[_0x5bb558(0xe5)](_0x5bb558(0xf2)),process['exit'](0x1));const _0xf9f923=prompt(_0x5bb558(0xd9)),_0x2ff3dd=prompt['hide'](_0x5bb558(0x11d));updateEnvFile(_0xf9f923,_0x2ff3dd),reloadEnv();}function loadApplianceIdentity(){const _0x18a173=a1_0x52e043;if(fs[_0x18a173(0x100)](APPLIANCE_FILE))try{const _0x31cb31=JSON['parse'](fs['readFileSync'](APPLIANCE_FILE,'utf8'));if(_0x31cb31[_0x18a173(0xbe)]&&_0x31cb31[_0x18a173(0xc9)])return robotId=_0x31cb31[_0x18a173(0xbe)],registrationToken=_0x31cb31[_0x18a173(0xc9)],console[_0x18a173(0xe6)]('Loaded\x20appliance\x20identity:',robotId),topicManager[_0x18a173(0xde)](_0x31cb31),!![];}catch(_0x3be133){console[_0x18a173(0xe5)](_0x18a173(0xd5),_0x3be133);}return![];}function saveApplianceIdentity(_0x29fe25,_0x14dab1){const _0x1363e7=a1_0x52e043;let _0x18719a={};if(fs[_0x1363e7(0x100)](APPLIANCE_FILE))try{_0x18719a=JSON[_0x1363e7(0x152)](fs['readFileSync'](APPLIANCE_FILE,_0x1363e7(0x157)));}catch(_0x4dea3d){_0x18719a={};}_0x18719a[_0x1363e7(0xbe)]=_0x29fe25,_0x18719a[_0x1363e7(0xc9)]=_0x14dab1,fs[_0x1363e7(0xfd)](APPLIANCE_FILE,JSON[_0x1363e7(0xe4)](_0x18719a,null,0x2));}async function registerWithServer(){const _0x55f0c8=a1_0x52e043;try{const _0x2801b6=authService[_0x55f0c8(0x15a)]();if(!_0x2801b6)throw new Error('Not\x20authenticated');let _0x21a119,_0x12e08b=![];while(!![]){try{robotId&&registrationToken?_0x21a119=await axios[_0x55f0c8(0x155)](config[_0x55f0c8(0x165)]+_0x55f0c8(0x14c),{'name':_0x55f0c8(0x136),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':'Bearer\x20'+_0x2801b6,'Content-Type':_0x55f0c8(0x103)}}):_0x21a119=await axios[_0x55f0c8(0x155)](config[_0x55f0c8(0x165)]+_0x55f0c8(0x14c),{'name':'WSL\x20Appliance'},{'headers':{'Authorization':_0x55f0c8(0x129)+_0x2801b6,'Content-Type':_0x55f0c8(0x103)}});break;}catch(_0x2708c9){const _0xb42339=_0x2708c9?.['response']?.[_0x55f0c8(0x114)]?.[_0x55f0c8(0xe5)]||_0x2708c9[_0x55f0c8(0x16d)];if(!_0x12e08b&&_0xb42339&&_0xb42339[_0x55f0c8(0x178)]()[_0x55f0c8(0x174)](_0x55f0c8(0x10b))){console['warn'](_0x55f0c8(0x15b));if(fs[_0x55f0c8(0x100)](APPLIANCE_FILE))fs[_0x55f0c8(0xf0)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x12e08b=!![];continue;}throw _0x2708c9;}}if(!_0x21a119['data']||!_0x21a119[_0x55f0c8(0x114)][_0x55f0c8(0x16e)]||!_0x21a119[_0x55f0c8(0x114)]['id'])throw new Error(_0x55f0c8(0xd8));return registrationToken=_0x21a119[_0x55f0c8(0x114)]['registration_token'],robotId=_0x21a119['data']['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x55f0c8(0xe6)]('Successfully\x20registered\x20with\x20server'),!![];}catch(_0x456231){return console[_0x55f0c8(0xe5)]('Failed\x20to\x20register\x20with\x20server:',_0x456231['message']),![];}}function rewriteUrdfMeshUris(_0x4e18cf){const _0x48885c=a1_0x52e043;try{const _0x4521b8=new DOMParser(),_0x2723da=_0x4521b8['parseFromString'](_0x4e18cf,_0x48885c(0x160));let _0x1ed526=0x0,_0x1848f4=0x0;const _0x3de8da=_0x2723da['getElementsByTagName'](_0x48885c(0xee));for(let _0x468d46=0x0;_0x468d46<_0x3de8da['length'];_0x468d46++){const _0x15d092=_0x3de8da[_0x468d46],_0x4bf509=_0x15d092['getAttribute'](_0x48885c(0x120)),_0x270ca6=[_0x48885c(0x138),'.dae','.obj','.ply',_0x48885c(0x158)],_0x4616f7=_0x270ca6['some'](_0x159cf9=>_0x4bf509[_0x48885c(0x178)]()[_0x48885c(0x13c)](_0x159cf9));if(_0x4bf509&&_0x4bf509[_0x48885c(0xe9)](_0x48885c(0x12b))&&_0x4616f7){_0x1ed526++;const _0x3440e9=APPLIANCE_BASE_URL+_0x48885c(0x14b)+encodeURIComponent(_0x4bf509);_0x15d092[_0x48885c(0x14f)](_0x48885c(0x120),_0x3440e9),_0x1848f4++,console['log'](_0x48885c(0xc0)+_0x4bf509+_0x48885c(0xda)+_0x3440e9);}}_0x1ed526>0x0?console[_0x48885c(0xe6)]('[URDF\x20REWRITE]\x20Rewrote\x20'+_0x1848f4+_0x48885c(0xce)+_0x1ed526+_0x48885c(0x149)):console[_0x48885c(0xe6)](_0x48885c(0x108));const _0x5b4d13=new XMLSerializer();return _0x5b4d13[_0x48885c(0x172)](_0x2723da);}catch(_0x28bf29){return console[_0x48885c(0xe5)](_0x48885c(0x154),_0x28bf29),_0x4e18cf;}}function a1_0x54cd(_0x52c820,_0x22f3b9){const _0x10cadf=a1_0x10ae();return a1_0x54cd=function(_0x4a64b6,_0x1d437e){_0x4a64b6=_0x4a64b6-0xbe;let _0x10ae1a=_0x10cadf[_0x4a64b6];return _0x10ae1a;},a1_0x54cd(_0x52c820,_0x22f3b9);}function connectToRosbridge(){const _0x25b1f5=a1_0x52e043;try{rosbridgeWs=new WebSocket(config[_0x25b1f5(0xcc)][_0x25b1f5(0x113)]),rosbridgeWs['on'](_0x25b1f5(0x10a),()=>{const _0x5b68cb=_0x25b1f5;console[_0x5b68cb(0xe6)]('Connected\x20to\x20ROSBridge\x20(main)');const _0x331749=require(_0x5b68cb(0x106)),_0x3c4a23=new _0x331749[(_0x5b68cb(0x176))]({'url':config['rosbridge'][_0x5b68cb(0x113)]});_0x3c4a23['on']('connection',()=>{setTimeout(()=>{const _0x4a8a1d=a1_0x54cd;topicManager[_0x4a8a1d(0x122)](_0x3c4a23)['catch'](_0x2ff8bf=>{const _0x2c3c15=_0x4a8a1d;console[_0x2c3c15(0xe5)](_0x2c3c15(0x151),_0x2ff8bf);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x25b1f5(0x16d),_0x2ec45c=>{const _0x3c9bdf=_0x25b1f5;if(serverWs&&serverWs[_0x3c9bdf(0x148)]===WebSocket[_0x3c9bdf(0xd1)]){let _0x3acd5e=_0x2ec45c[_0x3c9bdf(0x123)]();try{const _0x19c2c8=JSON[_0x3c9bdf(0x152)](_0x3acd5e);if(_0x19c2c8['op']==='publish'&&_0x19c2c8[_0x3c9bdf(0xdd)]){const _0x295a2e=topicManager[_0x3c9bdf(0xe3)](_0x19c2c8);switch(_0x295a2e[_0x3c9bdf(0xe8)]){case'sample_skip':return;case _0x3c9bdf(0x134):return;case _0x3c9bdf(0x102):default:_0x3acd5e=JSON[_0x3c9bdf(0xe4)](_0x295a2e[_0x3c9bdf(0x16d)]);break;}}if((_0x19c2c8['op']===_0x3c9bdf(0x126)||_0x19c2c8['op']===_0x3c9bdf(0x17b))&&(_0x19c2c8[_0x3c9bdf(0xe7)]===_0x3c9bdf(0xc7)||_0x19c2c8[_0x3c9bdf(0x11c)]&&_0x19c2c8['values'][_0x3c9bdf(0x128)])){console[_0x3c9bdf(0xe6)](_0x3c9bdf(0x13f));const _0x21dc2d=_0x19c2c8['values']?.[_0x3c9bdf(0x128)]||[],_0xa93440=_0x19c2c8['values']?.[_0x3c9bdf(0x168)]||[],_0x8e60a1=_0x21dc2d[_0x3c9bdf(0x11f)]((_0x1809e3,_0x563b6f)=>{const _0x55cd8f=_0x3c9bdf,_0x5c0835=topicManager['getTopicStrategy'](_0x1809e3);return{'name':_0x1809e3,'type':_0xa93440[_0x563b6f]||'unknown','throttling':_0x5c0835?{'isThrottled':_0x5c0835[_0x55cd8f(0x150)]===_0x55cd8f(0xfa),'strategy':_0x5c0835[_0x55cd8f(0x150)],'samplingRate':_0x5c0835[_0x55cd8f(0x14e)],'reason':_0x5c0835['reason'],'estimatedSize':_0x5c0835['estimatedSize']}:null};});_0x19c2c8[_0x3c9bdf(0x11c)]={'topics':_0x8e60a1[_0x3c9bdf(0x11f)](_0x1ee2a2=>_0x1ee2a2['name']),'types':_0x8e60a1['map'](_0x283b31=>_0x283b31['type']),'throttling':_0x8e60a1[_0x3c9bdf(0x11f)](_0x4af0a7=>_0x4af0a7['throttling'])},_0x3acd5e=JSON[_0x3c9bdf(0xe4)](_0x19c2c8),console[_0x3c9bdf(0xe6)](_0x3c9bdf(0x119));}if(_0x19c2c8['op']==='publish'&&_0x19c2c8['topic']==='/robot_description')try{const _0x1c3eb3=_0x19c2c8[_0x3c9bdf(0x164)][_0x3c9bdf(0x114)],_0x38bdcc=rewriteUrdfMeshUris(_0x1c3eb3);_0x19c2c8[_0x3c9bdf(0x164)][_0x3c9bdf(0x114)]=_0x38bdcc,_0x3acd5e=JSON[_0x3c9bdf(0xe4)](_0x19c2c8);}catch(_0x240523){console[_0x3c9bdf(0xe5)]('[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:',_0x240523);}}catch(_0x411552){console[_0x3c9bdf(0x140)](_0x3c9bdf(0xd6),_0x411552['message']);}serverWs['send'](_0x3acd5e);}}),rosbridgeWs['on'](_0x25b1f5(0x133),()=>{const _0x24dbf4=_0x25b1f5;console[_0x24dbf4(0xe6)](_0x24dbf4(0xca)),webrtcService[_0x24dbf4(0x127)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x25b1f5(0xe5),_0xdad214=>{const _0x5b80f5=_0x25b1f5;console['error'](_0x5b80f5(0x146),_0xdad214);});}catch(_0x5e355f){console[_0x25b1f5(0xe5)](_0x25b1f5(0x166),_0x5e355f),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x4d491a=a1_0x52e043;try{rosbridgeWebRTCWs=new WebSocket(config['rosbridge'][_0x4d491a(0x113)]),rosbridgeWebRTCWs['on'](_0x4d491a(0x10a),()=>{const _0x519a99=_0x4d491a;console[_0x519a99(0xe6)]('Connected\x20to\x20ROSBridge\x20(WebRTC)'),webrtcService[_0x519a99(0x115)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x4d491a(0x16d),_0x24d173=>{}),rosbridgeWebRTCWs['on']('close',()=>{const _0x559784=_0x4d491a;console['log'](_0x559784(0xcf)),webrtcService[_0x559784(0x127)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x4d491a(0xe5),_0x31419d=>{const _0x12ba0b=_0x4d491a;console[_0x12ba0b(0xe5)](_0x12ba0b(0xf6),_0x31419d);});}catch(_0x1af6dd){console[_0x4d491a(0xe5)](_0x4d491a(0xd2),_0x1af6dd),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x575458=a1_0x52e043;try{if(!registrationToken)throw new Error(_0x575458(0x101));const _0x1e8afc=config[_0x575458(0x165)][_0x575458(0x110)]('http','ws')+_0x575458(0x173)+registrationToken;serverWs=new WebSocket(_0x1e8afc),serverWs['on'](_0x575458(0x10a),()=>{const _0x186425=_0x575458;console['log']('Connected\x20to\x20server'),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x186425(0x148)]===WebSocket[_0x186425(0xd1)]&&webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x575458(0x16d),_0x36728e=>{const _0x3ad8af=_0x575458;if(rosbridgeWs&&rosbridgeWs[_0x3ad8af(0x148)]===WebSocket[_0x3ad8af(0xd1)]){let _0x720858=_0x36728e[_0x3ad8af(0x123)]();try{const _0x44d891=JSON[_0x3ad8af(0x152)](_0x720858);if(webrtcService[_0x3ad8af(0xe3)](_0x44d891))return;if(_0x44d891['op']===_0x3ad8af(0x124)&&typeof _0x44d891['param_name']===_0x3ad8af(0x179)&&_0x44d891['request_id'])try{console[_0x3ad8af(0xe6)](_0x3ad8af(0xe2)+_0x44d891['param_name']);const _0x295b40=execSync(_0x3ad8af(0x137)+_0x44d891[_0x3ad8af(0x12a)],{'encoding':_0x3ad8af(0x157)})[_0x3ad8af(0xec)]();let _0x3a9632=_0x295b40;_0x295b40['startsWith'](_0x3ad8af(0x112))&&(_0x3a9632=_0x295b40[_0x3ad8af(0x12c)](_0x3ad8af(0x112)['length']()));_0x3a9632[_0x3ad8af(0xe9)]('\x22')&&_0x3a9632[_0x3ad8af(0x13c)]('\x22')&&(_0x3a9632=_0x3a9632[_0x3ad8af(0xc1)](0x1,-0x1));_0x3a9632=_0x3a9632[_0x3ad8af(0x110)](/\\n/g,'\x0a')[_0x3ad8af(0x110)](/\\"/g,'\x22');const _0x3ece46={'op':_0x3ad8af(0xe1),'request_id':_0x44d891[_0x3ad8af(0x167)],'data':_0x3a9632};serverWs[_0x3ad8af(0xcb)](JSON[_0x3ad8af(0xe4)](_0x3ece46)),console[_0x3ad8af(0xe6)]('[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20'+_0x44d891[_0x3ad8af(0x12a)]);return;}catch(_0x391986){console[_0x3ad8af(0xe5)](_0x3ad8af(0xf9),_0x391986);const _0x55c481={'op':_0x3ad8af(0xe1),'request_id':_0x44d891[_0x3ad8af(0x167)],'error':_0x391986['message']};serverWs[_0x3ad8af(0xcb)](JSON['stringify'](_0x55c481));return;}if(_0x44d891['op']===_0x3ad8af(0x117)&&typeof _0x44d891[_0x3ad8af(0x15c)]==='string'&&_0x44d891['request_id'])try{const _0x774280=_0x44d891[_0x3ad8af(0x15c)][_0x3ad8af(0x10f)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x774280){const _0x207054=_0x774280[0x1],_0x5b33f5=_0x774280[0x2],_0x359432=execSync(_0x3ad8af(0x118)+_0x207054,{'encoding':_0x3ad8af(0x157)})[_0x3ad8af(0xec)](),_0x511278=path[_0x3ad8af(0x177)](_0x359432,_0x3ad8af(0x141),_0x207054,_0x5b33f5);if(!fs[_0x3ad8af(0x100)](_0x511278))throw new Error('Mesh\x20file\x20not\x20found:\x20'+_0x511278);const _0x438875=fs['readFileSync'](_0x511278),_0x4d4a31={'op':_0x3ad8af(0xdb),'request_id':_0x44d891[_0x3ad8af(0x167)],'data':_0x438875['toString'](_0x3ad8af(0xf3))};serverWs['send'](JSON[_0x3ad8af(0xe4)](_0x4d4a31)),console[_0x3ad8af(0xe6)](_0x3ad8af(0x175)+_0x44d891[_0x3ad8af(0x15c)]+_0x3ad8af(0x13e)+_0x511278);return;}}catch(_0x58ea20){console[_0x3ad8af(0xe5)](_0x3ad8af(0x12e),_0x58ea20);const _0x106161={'op':_0x3ad8af(0xdb),'request_id':_0x44d891[_0x3ad8af(0x167)],'error':_0x58ea20['message']};serverWs[_0x3ad8af(0xcb)](JSON[_0x3ad8af(0xe4)](_0x106161));return;}rosbridgeWs['send'](_0x720858);}catch(_0x3dd594){rosbridgeWs[_0x3ad8af(0xcb)](_0x720858);}}}),serverWs['on']('close',(_0x51cbdc,_0x321e03)=>{const _0xf81a0b=_0x575458;console['log']('Disconnected\x20from\x20server\x20('+_0x51cbdc+':\x20'+_0x321e03+_0xf81a0b(0x162)),webrtcService[_0xf81a0b(0x127)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x575458(0xe5),_0x1ca1b2=>{const _0x5b27a5=_0x575458;console['error'](_0x5b27a5(0x17a),_0x1ca1b2);});}catch(_0x2dd5b8){console[_0x575458(0xe5)](_0x575458(0x143),_0x2dd5b8),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x10f535,_0x344103,_0x46a02c)=>{const _0x30c997=a1_0x52e043;if(!authService[_0x30c997(0xff)]()){console[_0x30c997(0xe6)]('Attempting\x20to\x20login\x20to:',config['serverUrl']);const _0x3d9dd6=await authService[_0x30c997(0x17c)]();if(!_0x3d9dd6)return _0x344103['status'](0x191)[_0x30c997(0xf5)]({'error':_0x30c997(0xfe)});}_0x46a02c();};app['use']((_0x34d31b,_0x7363eb,_0x5176fc)=>{const _0x1b7b72=a1_0x52e043;_0x7363eb[_0x1b7b72(0x10c)](_0x1b7b72(0x147),'*'),_0x7363eb[_0x1b7b72(0x10c)]('Access-Control-Allow-Methods','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS'),_0x7363eb['header'](_0x1b7b72(0x142),_0x1b7b72(0x12d)),_0x34d31b['method']===_0x1b7b72(0xbf)?_0x7363eb[_0x1b7b72(0x116)](0xc8):_0x5176fc();}),app['get']('/',requireAuth,(_0x4d3776,_0x51c6d8)=>{const _0x4eeea5=a1_0x52e043;_0x51c6d8[_0x4eeea5(0xcb)]('Appliance\x20is\x20running\x20and\x20authenticated!');}),app[a1_0x52e043(0xed)]('/health',async(_0x5b1208,_0x518aab)=>{const _0x463305=a1_0x52e043,_0x369b22=authService[_0x463305(0xff)](),_0x52ce3d=webrtcService[_0x463305(0x169)](),_0xf47d4=webrtcService[_0x463305(0x10e)](),_0x24239d=topicManager[_0x463305(0x153)]();_0x518aab[_0x463305(0xf5)]({'status':'ok','environment':process[_0x463305(0xcd)]['NODE_ENV']||_0x463305(0x130),'backendUrl':config[_0x463305(0x165)],'rosbridgeUrl':config[_0x463305(0xcc)][_0x463305(0x113)],'proxyPort':port,'authenticated':_0x369b22,'topicManagement':{'discovered':_0x24239d[_0x463305(0x15e)],'strategies':_0x24239d['strategies'],'largeDataTopics':_0x24239d[_0x463305(0x156)][_0x463305(0x135)],'largeTopicsList':_0x24239d['largeDataTopics']},'webrtc':{'activeSessions':_0x52ce3d[_0x463305(0x135)],'sharedVideoSources':_0xf47d4[_0x463305(0x135)],'sessions':_0x52ce3d,'sharedSources':_0xf47d4}});});const getInitialPort=()=>{const _0x31f048=a1_0x52e043;if(process[_0x31f048(0xcd)][_0x31f048(0xea)])return parseInt(process[_0x31f048(0xcd)][_0x31f048(0xea)],0xa);return config[_0x31f048(0xcc)]['proxyPort'];};async function listenWithRetries(_0x52ead4,_0x360002,_0x2fdc4f=0xa){const _0x120775=a1_0x52e043;let _0x2beb0f=_0x360002;for(let _0x184513=0x1;_0x184513<=_0x2fdc4f;_0x184513++){try{return await new Promise((_0x45700f,_0x441bad)=>{const _0x2f65a2=a1_0x54cd,_0x18f411=_0x52ead4[_0x2f65a2(0x16c)](_0x2beb0f,()=>{const _0x1ceb7c=_0x2f65a2;console[_0x1ceb7c(0xe6)]('Appliance\x20server\x20started\x20successfully\x20on\x20port\x20'+_0x2beb0f),_0x45700f(_0x18f411);});_0x18f411['on'](_0x2f65a2(0xe5),_0xcb14f3=>{const _0x78b780=_0x2f65a2;_0xcb14f3[_0x78b780(0x11b)]===_0x78b780(0x14d)?(console[_0x78b780(0x140)](_0x78b780(0xf1)+_0x2beb0f+_0x78b780(0x171)),_0x441bad(_0xcb14f3)):_0x441bad(_0xcb14f3);});}),_0x2beb0f;}catch(_0x9da834){_0x2beb0f++;}}throw new Error(_0x120775(0x121)+_0x2fdc4f+_0x120775(0xc3)+_0x360002);}const startApp=async()=>{const _0x24316a=a1_0x52e043;try{reloadEnv();let _0x5535f5=await authService[_0x24316a(0x17c)]();while(!_0x5535f5){console[_0x24316a(0xe6)](_0x24316a(0xf4)),await promptForCredentials(),_0x5535f5=await authService[_0x24316a(0x17c)]();}console['log']('Successfully\x20logged\x20in');!loadApplianceIdentity()&&console[_0x24316a(0xe6)](_0x24316a(0x131));console[_0x24316a(0xe6)](_0x24316a(0x132));const _0x3baf21=await registerWithServer();if(!_0x3baf21)throw new Error('Failed\x20to\x20register\x20with\x20server');connectToRosbridge(),connectToServer();const _0x490361=getInitialPort();await listenWithRetries(app,_0x490361,0xa);}catch(_0x46f2bb){console[_0x24316a(0xe5)](_0x24316a(0x16b),_0x46f2bb),process[_0x24316a(0x139)](0x1);}};setInterval(async()=>{const _0x54149d=a1_0x52e043;try{if(robotId){const _0x4e9e37=authService['getToken']();await axios[_0x54149d(0x155)](config[_0x54149d(0x165)]+_0x54149d(0xdc),{'robotId':robotId},{'headers':{'Authorization':_0x54149d(0x129)+_0x4e9e37,'Content-Type':_0x54149d(0x103)}});}}catch(_0x100053){console[_0x54149d(0xe5)](_0x54149d(0xf8),_0x100053[_0x54149d(0x16d)]);}},0x1388),startApp();