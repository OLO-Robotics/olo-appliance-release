const a1_0x2e0de9=a1_0x4efe;(function(_0x139d08,_0x36254c){const _0x6f5900=a1_0x4efe,_0x3acace=_0x139d08();while(!![]){try{const _0x13e3d0=-parseInt(_0x6f5900(0x1b8))/0x1*(parseInt(_0x6f5900(0x19d))/0x2)+parseInt(_0x6f5900(0x12e))/0x3+-parseInt(_0x6f5900(0x14d))/0x4+-parseInt(_0x6f5900(0x170))/0x5+parseInt(_0x6f5900(0x1d2))/0x6*(parseInt(_0x6f5900(0x1d1))/0x7)+-parseInt(_0x6f5900(0x174))/0x8*(-parseInt(_0x6f5900(0x1ac))/0x9)+-parseInt(_0x6f5900(0x145))/0xa;if(_0x13e3d0===_0x36254c)break;else _0x3acace['push'](_0x3acace['shift']());}catch(_0x21371e){_0x3acace['push'](_0x3acace['shift']());}}}(a1_0xc8a2,0xc3be2));const a1_0x106845=(function(){let _0x46bbad=!![];return function(_0x4288b4,_0x43d42f){const _0x4c274b=_0x46bbad?function(){const _0xf8d18=a1_0x4efe;if(_0x43d42f){const _0x4674e7=_0x43d42f[_0xf8d18(0x17e)](_0x4288b4,arguments);return _0x43d42f=null,_0x4674e7;}}:function(){};return _0x46bbad=![],_0x4c274b;};}()),a1_0x5139d1=a1_0x106845(this,function(){const _0x43ddb4=a1_0x4efe;return a1_0x5139d1[_0x43ddb4(0x197)]()[_0x43ddb4(0x1bf)](_0x43ddb4(0x17b))[_0x43ddb4(0x197)]()[_0x43ddb4(0x176)](a1_0x5139d1)['search'](_0x43ddb4(0x17b));});a1_0x5139d1();const express=require(a1_0x2e0de9(0x159)),config=require(a1_0x2e0de9(0x183)),authService=require(a1_0x2e0de9(0x182)),webrtcService=require('./services/webrtcService'),topicManager=require(a1_0x2e0de9(0x1c8)),WebSocket=require('ws'),axios=require(a1_0x2e0de9(0x13a)),fs=require('fs'),prompt=require('prompt-sync')({'sigint':!![]}),dotenv=require('dotenv'),app=express(),port=process[a1_0x2e0de9(0x173)][a1_0x2e0de9(0x1b9)]||config[a1_0x2e0de9(0x138)][a1_0x2e0de9(0x1dc)],APPLIANCE_FILE=a1_0x2e0de9(0x148),{DOMParser,XMLSerializer}=require(a1_0x2e0de9(0x16d)),path=require(a1_0x2e0de9(0x19a)),{execSync}=require(a1_0x2e0de9(0x1cf)),APPLIANCE_BASE_URL=process[a1_0x2e0de9(0x173)][a1_0x2e0de9(0x126)]||'';console[a1_0x2e0de9(0x16f)](a1_0x2e0de9(0x1c6)+(process[a1_0x2e0de9(0x173)][a1_0x2e0de9(0x129)]||a1_0x2e0de9(0x16a))),console['log'](a1_0x2e0de9(0x133)+config['serverUrl']),console['log']('ROSBridge\x20WebSocket\x20URL:\x20'+config['rosbridge'][a1_0x2e0de9(0x12f)]),console[a1_0x2e0de9(0x16f)]('Proxy\x20listening\x20on\x20port:\x20'+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x4401ec,_0x1d1587){const _0x4f1fdb=a1_0x2e0de9;fs[_0x4f1fdb(0x179)]('.env',_0x4f1fdb(0x132)+_0x4401ec+_0x4f1fdb(0x166)+_0x1d1587+'\x0a');}function reloadEnv(){const _0x2eee6f=a1_0x2e0de9;dotenv[_0x2eee6f(0x1b1)]({'override':!![]}),config[_0x2eee6f(0x15a)][_0x2eee6f(0x1df)]=process[_0x2eee6f(0x173)]['APP_USERNAME'],config['credentials'][_0x2eee6f(0x1d6)]=process[_0x2eee6f(0x173)][_0x2eee6f(0x1c5)];}async function promptForCredentials(){const _0x1a6e90=a1_0x2e0de9,_0xb7925=prompt(_0x1a6e90(0x1bc)),_0x2aa40b=prompt['hide']('Enter\x20password:\x20');updateEnvFile(_0xb7925,_0x2aa40b),reloadEnv();}function loadApplianceIdentity(){const _0xf6408c=a1_0x2e0de9;if(fs[_0xf6408c(0x1a2)](APPLIANCE_FILE))try{const _0x5a08b6=JSON[_0xf6408c(0x122)](fs[_0xf6408c(0x135)](APPLIANCE_FILE,_0xf6408c(0x1bb)));if(_0x5a08b6['robotId']&&_0x5a08b6[_0xf6408c(0x1db)])return robotId=_0x5a08b6[_0xf6408c(0x18c)],registrationToken=_0x5a08b6[_0xf6408c(0x1db)],console[_0xf6408c(0x16f)](_0xf6408c(0x1ae),robotId),topicManager[_0xf6408c(0x146)](_0x5a08b6),!![];}catch(_0x4a9894){console[_0xf6408c(0x1a8)]('Failed\x20to\x20parse\x20appliance\x20identity\x20file:',_0x4a9894);}return![];}function saveApplianceIdentity(_0x4e8a36,_0x167569){const _0x42457e=a1_0x2e0de9;let _0x3d53aa={};if(fs[_0x42457e(0x1a2)](APPLIANCE_FILE))try{_0x3d53aa=JSON[_0x42457e(0x122)](fs[_0x42457e(0x135)](APPLIANCE_FILE,'utf8'));}catch(_0x4196e3){_0x3d53aa={};}_0x3d53aa[_0x42457e(0x18c)]=_0x4e8a36,_0x3d53aa['registrationToken']=_0x167569,fs[_0x42457e(0x179)](APPLIANCE_FILE,JSON[_0x42457e(0x163)](_0x3d53aa,null,0x2));}async function registerWithServer(){const _0x446d18=a1_0x2e0de9;try{const _0x553fa9=authService[_0x446d18(0x171)]();if(!_0x553fa9)throw new Error(_0x446d18(0x1b3));let _0x3570b3,_0xac18e2=![];while(!![]){try{robotId&&registrationToken?_0x3570b3=await axios[_0x446d18(0x1c1)](config['serverUrl']+'/appliance/register',{'name':'WSL\x20Appliance','robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x446d18(0x185)+_0x553fa9,'Content-Type':'application/json'}}):_0x3570b3=await axios['post'](config['serverUrl']+_0x446d18(0x15e),{'name':_0x446d18(0x198)},{'headers':{'Authorization':_0x446d18(0x185)+_0x553fa9,'Content-Type':_0x446d18(0x15f)}});break;}catch(_0x265e4a){const _0x2676df=_0x265e4a?.[_0x446d18(0x1d8)]?.[_0x446d18(0x1c7)]?.['error']||_0x265e4a[_0x446d18(0x1b6)];if(!_0xac18e2&&_0x2676df&&_0x2676df[_0x446d18(0x162)]()[_0x446d18(0x1c4)](_0x446d18(0x186))){console[_0x446d18(0x196)](_0x446d18(0x1e2));if(fs[_0x446d18(0x1a2)](APPLIANCE_FILE))fs[_0x446d18(0x16c)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0xac18e2=!![];continue;}throw _0x265e4a;}}if(!_0x3570b3[_0x446d18(0x1c7)]||!_0x3570b3['data'][_0x446d18(0x141)]||!_0x3570b3[_0x446d18(0x1c7)]['id'])throw new Error('Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server');return registrationToken=_0x3570b3['data'][_0x446d18(0x141)],robotId=_0x3570b3[_0x446d18(0x1c7)]['id'],saveApplianceIdentity(robotId,registrationToken),console['log']('Successfully\x20registered\x20with\x20server'),!![];}catch(_0x4be6b5){return console[_0x446d18(0x1a8)](_0x446d18(0x139),_0x4be6b5[_0x446d18(0x1b6)]),![];}}function rewriteUrdfMeshUris(_0x8e5ec0){const _0xfc101=a1_0x2e0de9;try{const _0x2d9839=new DOMParser(),_0x530078=_0x2d9839[_0xfc101(0x195)](_0x8e5ec0,_0xfc101(0x158));let _0x5cc0a5=0x0,_0x7ad21b=0x0;const _0x4375ee=_0x530078[_0xfc101(0x161)]('mesh');for(let _0x3c47a9=0x0;_0x3c47a9<_0x4375ee['length'];_0x3c47a9++){const _0x4071ce=_0x4375ee[_0x3c47a9],_0x10983d=_0x4071ce[_0xfc101(0x151)](_0xfc101(0x156)),_0xb3731d=['.stl',_0xfc101(0x12a),'.obj',_0xfc101(0x1b0),_0xfc101(0x1cb)],_0x1db3f5=_0xb3731d[_0xfc101(0x140)](_0x24467b=>_0x10983d[_0xfc101(0x162)]()[_0xfc101(0x121)](_0x24467b));if(_0x10983d&&_0x10983d[_0xfc101(0x19c)](_0xfc101(0x142))&&_0x1db3f5){_0x5cc0a5++;const _0x544f74=APPLIANCE_BASE_URL+_0xfc101(0x16b)+encodeURIComponent(_0x10983d);_0x4071ce[_0xfc101(0x1b4)](_0xfc101(0x156),_0x544f74),_0x7ad21b++,console['log']('[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20'+_0x10983d+'\x20->\x20'+_0x544f74);}}_0x5cc0a5>0x0?console[_0xfc101(0x16f)]('[URDF\x20REWRITE]\x20Rewrote\x20'+_0x7ad21b+_0xfc101(0x1e0)+_0x5cc0a5+_0xfc101(0x1b5)):console['log'](_0xfc101(0x1ba));const _0x5505bc=new XMLSerializer();return _0x5505bc[_0xfc101(0x193)](_0x530078);}catch(_0x36f016){return console['error'](_0xfc101(0x18a),_0x36f016),_0x8e5ec0;}}function connectToRosbridge(){const _0x478abb=a1_0x2e0de9;try{rosbridgeWs=new WebSocket(config['rosbridge'][_0x478abb(0x12f)]),rosbridgeWs['on'](_0x478abb(0x1b2),()=>{const _0x11225f=_0x478abb;console[_0x11225f(0x16f)](_0x11225f(0x1e4));const _0x4cacf8=require('roslib'),_0x34ad3c=new _0x4cacf8['Ros']({'url':config['rosbridge'][_0x11225f(0x12f)]});_0x34ad3c['on'](_0x11225f(0x128),()=>{setTimeout(()=>{const _0x2aaab0=a1_0x4efe;topicManager[_0x2aaab0(0x18d)](_0x34ad3c)[_0x2aaab0(0x17d)](_0xd7d3dd=>{const _0x2d2415=_0x2aaab0;console[_0x2d2415(0x1a8)](_0x2d2415(0x191),_0xd7d3dd);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x478abb(0x1b6),_0x80df97=>{const _0x2c6756=_0x478abb;if(serverWs&&serverWs[_0x2c6756(0x144)]===WebSocket['OPEN']){let _0x5ec8ec=_0x80df97[_0x2c6756(0x197)]();try{const _0x4cc58f=JSON[_0x2c6756(0x122)](_0x5ec8ec);if(_0x4cc58f['op']===_0x2c6756(0x1a9)&&_0x4cc58f[_0x2c6756(0x120)]){const _0x48314c=topicManager[_0x2c6756(0x18f)](_0x4cc58f);switch(_0x48314c['action']){case _0x2c6756(0x1ca):return;case _0x2c6756(0x155):return;case _0x2c6756(0x184):default:_0x5ec8ec=JSON[_0x2c6756(0x163)](_0x48314c[_0x2c6756(0x1b6)]);break;}}if((_0x4cc58f['op']===_0x2c6756(0x19b)||_0x4cc58f['op']===_0x2c6756(0x17f))&&(_0x4cc58f[_0x2c6756(0x1d9)]===_0x2c6756(0x1a3)||_0x4cc58f['values']&&_0x4cc58f['values'][_0x2c6756(0x1a1)])){console[_0x2c6756(0x16f)](_0x2c6756(0x1ad));const _0x369a91=_0x4cc58f[_0x2c6756(0x1ab)]?.[_0x2c6756(0x1a1)]||[],_0x5ce48f=_0x4cc58f[_0x2c6756(0x1ab)]?.[_0x2c6756(0x1aa)]||[],_0x1bb29a=_0x369a91[_0x2c6756(0x1e1)]((_0x3c79f4,_0x50d5f4)=>{const _0x17f5dc=_0x2c6756,_0x33a6a4=topicManager[_0x17f5dc(0x164)](_0x3c79f4);return{'name':_0x3c79f4,'type':_0x5ce48f[_0x50d5f4]||_0x17f5dc(0x180),'throttling':_0x33a6a4?{'isThrottled':_0x33a6a4[_0x17f5dc(0x177)]===_0x17f5dc(0x15b),'strategy':_0x33a6a4[_0x17f5dc(0x177)],'samplingRate':_0x33a6a4[_0x17f5dc(0x12d)],'reason':_0x33a6a4[_0x17f5dc(0x14e)],'estimatedSize':_0x33a6a4[_0x17f5dc(0x1cc)]}:null};});_0x4cc58f['values']={'topics':_0x1bb29a[_0x2c6756(0x1e1)](_0x20c61=>_0x20c61[_0x2c6756(0x130)]),'types':_0x1bb29a[_0x2c6756(0x1e1)](_0x46e7a1=>_0x46e7a1[_0x2c6756(0x1d3)]),'throttling':_0x1bb29a[_0x2c6756(0x1e1)](_0x4511e9=>_0x4511e9[_0x2c6756(0x1ce)])},_0x5ec8ec=JSON[_0x2c6756(0x163)](_0x4cc58f),console[_0x2c6756(0x16f)](_0x2c6756(0x194));}if(_0x4cc58f['op']===_0x2c6756(0x1a9)&&_0x4cc58f['topic']==='/robot_description')try{const _0x48bf2a=_0x4cc58f['msg'][_0x2c6756(0x1c7)],_0x2f5d1a=rewriteUrdfMeshUris(_0x48bf2a);_0x4cc58f[_0x2c6756(0x1e3)][_0x2c6756(0x1c7)]=_0x2f5d1a,_0x5ec8ec=JSON[_0x2c6756(0x163)](_0x4cc58f);}catch(_0x3e0880){console['error'](_0x2c6756(0x149),_0x3e0880);}}catch(_0x50d88c){console[_0x2c6756(0x196)](_0x2c6756(0x127),_0x50d88c[_0x2c6756(0x1b6)]);}serverWs['send'](_0x5ec8ec);}}),rosbridgeWs['on'](_0x478abb(0x15c),()=>{const _0x28c2a9=_0x478abb;console[_0x28c2a9(0x16f)]('Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x28c2a9(0x152)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x478abb(0x1a8),_0x238164=>{const _0x2e688a=_0x478abb;console[_0x2e688a(0x1a8)](_0x2e688a(0x123),_0x238164);});}catch(_0x1fbbfd){console[_0x478abb(0x1a8)](_0x478abb(0x1c3),_0x1fbbfd),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x59777e=a1_0x2e0de9;try{rosbridgeWebRTCWs=new WebSocket(config[_0x59777e(0x138)][_0x59777e(0x12f)]),rosbridgeWebRTCWs['on'](_0x59777e(0x1b2),()=>{const _0x189a79=_0x59777e;console[_0x189a79(0x16f)](_0x189a79(0x165)),webrtcService[_0x189a79(0x17a)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on']('message',_0xb6e7dd=>{}),rosbridgeWebRTCWs['on'](_0x59777e(0x15c),()=>{const _0x184df1=_0x59777e;console[_0x184df1(0x16f)]('Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x184df1(0x152)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x59777e(0x1a8),_0x15d270=>{const _0x4a6ac9=_0x59777e;console[_0x4a6ac9(0x1a8)](_0x4a6ac9(0x13d),_0x15d270);});}catch(_0x622c73){console[_0x59777e(0x1a8)](_0x59777e(0x181),_0x622c73),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x2a2a4d=a1_0x2e0de9;try{if(!registrationToken)throw new Error('Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.');const _0x1b6325=config[_0x2a2a4d(0x1b7)]['replace'](_0x2a2a4d(0x19f),'ws')+'/rosbridge?type=appliance&token='+registrationToken;serverWs=new WebSocket(_0x1b6325),serverWs['on'](_0x2a2a4d(0x1b2),()=>{const _0x33e4e2=_0x2a2a4d;console[_0x33e4e2(0x16f)]('Connected\x20to\x20server'),rosbridgeWebRTCWs&&rosbridgeWebRTCWs['readyState']===WebSocket[_0x33e4e2(0x14a)]&&webrtcService[_0x33e4e2(0x17a)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x2a2a4d(0x1b6),_0x838e03=>{const _0x5012cc=_0x2a2a4d;if(rosbridgeWs&&rosbridgeWs[_0x5012cc(0x144)]===WebSocket[_0x5012cc(0x14a)]){let _0x34575a=_0x838e03['toString']();try{const _0x52cb98=JSON[_0x5012cc(0x122)](_0x34575a);if(webrtcService[_0x5012cc(0x18f)](_0x52cb98))return;if(_0x52cb98['op']===_0x5012cc(0x134)&&typeof _0x52cb98[_0x5012cc(0x167)]===_0x5012cc(0x13f)&&_0x52cb98[_0x5012cc(0x13e)])try{console['log']('[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20'+_0x52cb98['param_name']);const _0x5ca165=execSync(_0x5012cc(0x154)+_0x52cb98[_0x5012cc(0x167)],{'encoding':_0x5012cc(0x1bb)})[_0x5012cc(0x1da)]();let _0x67207f=_0x5ca165;_0x5ca165[_0x5012cc(0x19c)]('String\x20value\x20is:\x20')&&(_0x67207f=_0x5ca165[_0x5012cc(0x1d7)](_0x5012cc(0x136)[_0x5012cc(0x124)]()));_0x67207f[_0x5012cc(0x19c)]('\x22')&&_0x67207f[_0x5012cc(0x121)]('\x22')&&(_0x67207f=_0x67207f[_0x5012cc(0x1a6)](0x1,-0x1));_0x67207f=_0x67207f[_0x5012cc(0x1d0)](/\\n/g,'\x0a')[_0x5012cc(0x1d0)](/\\"/g,'\x22');const _0x509be5={'op':_0x5012cc(0x190),'request_id':_0x52cb98[_0x5012cc(0x13e)],'data':_0x67207f};serverWs[_0x5012cc(0x153)](JSON[_0x5012cc(0x163)](_0x509be5)),console['log'](_0x5012cc(0x14c)+_0x52cb98[_0x5012cc(0x167)]);return;}catch(_0x3e1f63){console[_0x5012cc(0x1a8)](_0x5012cc(0x168),_0x3e1f63);const _0x3e1a78={'op':_0x5012cc(0x190),'request_id':_0x52cb98[_0x5012cc(0x13e)],'error':_0x3e1f63[_0x5012cc(0x1b6)]};serverWs[_0x5012cc(0x153)](JSON[_0x5012cc(0x163)](_0x3e1a78));return;}if(_0x52cb98['op']===_0x5012cc(0x189)&&typeof _0x52cb98['uri']===_0x5012cc(0x13f)&&_0x52cb98['request_id'])try{const _0x4a45b8=_0x52cb98[_0x5012cc(0x1c0)]['match'](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x4a45b8){const _0x520339=_0x4a45b8[0x1],_0x50a12a=_0x4a45b8[0x2],_0x58306e=execSync('ros2\x20pkg\x20prefix\x20'+_0x520339,{'encoding':_0x5012cc(0x1bb)})[_0x5012cc(0x1da)](),_0x1e217c=path['join'](_0x58306e,_0x5012cc(0x1de),_0x520339,_0x50a12a);if(!fs[_0x5012cc(0x1a2)](_0x1e217c))throw new Error(_0x5012cc(0x169)+_0x1e217c);const _0x1f50f8=fs['readFileSync'](_0x1e217c),_0x2014b4={'op':_0x5012cc(0x1a5),'request_id':_0x52cb98[_0x5012cc(0x13e)],'data':_0x1f50f8['toString'](_0x5012cc(0x125))};serverWs[_0x5012cc(0x153)](JSON['stringify'](_0x2014b4)),console['log'](_0x5012cc(0x187)+_0x52cb98[_0x5012cc(0x1c0)]+_0x5012cc(0x157)+_0x1e217c);return;}}catch(_0x5e6801){console[_0x5012cc(0x1a8)]('[MESH]\x20Error\x20serving\x20mesh:',_0x5e6801);const _0x4fdb74={'op':_0x5012cc(0x1a5),'request_id':_0x52cb98[_0x5012cc(0x13e)],'error':_0x5e6801[_0x5012cc(0x1b6)]};serverWs['send'](JSON[_0x5012cc(0x163)](_0x4fdb74));return;}rosbridgeWs['send'](_0x34575a);}catch(_0x3723d4){rosbridgeWs[_0x5012cc(0x153)](_0x34575a);}}}),serverWs['on'](_0x2a2a4d(0x15c),(_0x351331,_0xdd91da)=>{const _0x31e78c=_0x2a2a4d;console[_0x31e78c(0x16f)](_0x31e78c(0x160)+_0x351331+':\x20'+_0xdd91da+'),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x31e78c(0x152)](),setTimeout(connectToServer,0x1388);}),serverWs['on']('error',_0x5e2ccd=>{const _0x21b2b5=_0x2a2a4d;console[_0x21b2b5(0x1a8)]('Server\x20connection\x20error:',_0x5e2ccd);});}catch(_0x1668d3){console[_0x2a2a4d(0x1a8)](_0x2a2a4d(0x1a7),_0x1668d3),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x9635b7,_0x2ea54f,_0x35e8ae)=>{const _0x1268f5=a1_0x2e0de9;if(!authService[_0x1268f5(0x172)]()){console[_0x1268f5(0x16f)](_0x1268f5(0x143),config['serverUrl']);const _0x20c1f1=await authService['login']();if(!_0x20c1f1)return _0x2ea54f[_0x1268f5(0x1c2)](0x191)[_0x1268f5(0x150)]({'error':_0x1268f5(0x1dd)});}_0x35e8ae();};function a1_0x4efe(_0x59c9e0,_0x20f81f){const _0x3508be=a1_0xc8a2();return a1_0x4efe=function(_0x5139d1,_0x106845){_0x5139d1=_0x5139d1-0x120;let _0xc8a296=_0x3508be[_0x5139d1];return _0xc8a296;},a1_0x4efe(_0x59c9e0,_0x20f81f);}app[a1_0x2e0de9(0x14f)]((_0x2f3ea9,_0x15c646,_0x54bf2e)=>{const _0xf02496=a1_0x2e0de9;_0x15c646['header']('Access-Control-Allow-Origin','*'),_0x15c646['header']('Access-Control-Allow-Methods',_0xf02496(0x178)),_0x15c646[_0xf02496(0x1c9)](_0xf02496(0x147),_0xf02496(0x12b)),_0x2f3ea9['method']===_0xf02496(0x1af)?_0x15c646['sendStatus'](0xc8):_0x54bf2e();}),app['get']('/',requireAuth,(_0x5cf254,_0x55f9f5)=>{const _0x2cbaf6=a1_0x2e0de9;_0x55f9f5['send'](_0x2cbaf6(0x192));}),app[a1_0x2e0de9(0x1cd)](a1_0x2e0de9(0x1a4),async(_0x3c9719,_0x1c4e59)=>{const _0x45aa11=a1_0x2e0de9,_0x2c074c=authService[_0x45aa11(0x172)](),_0x5e2c27=webrtcService['getActiveSessions'](),_0x2e3dd6=webrtcService['getSharedVideoSources'](),_0x21d022=topicManager[_0x45aa11(0x131)]();_0x1c4e59[_0x45aa11(0x150)]({'status':'ok','environment':process['env'][_0x45aa11(0x129)]||_0x45aa11(0x16a),'backendUrl':config['serverUrl'],'rosbridgeUrl':config[_0x45aa11(0x138)]['wsEndpoint'],'proxyPort':port,'authenticated':_0x2c074c,'topicManagement':{'discovered':_0x21d022[_0x45aa11(0x12c)],'strategies':_0x21d022[_0x45aa11(0x14b)],'largeDataTopics':_0x21d022[_0x45aa11(0x19e)]['length'],'largeTopicsList':_0x21d022[_0x45aa11(0x19e)]},'webrtc':{'activeSessions':_0x5e2c27[_0x45aa11(0x124)],'sharedVideoSources':_0x2e3dd6[_0x45aa11(0x124)],'sessions':_0x5e2c27,'sharedSources':_0x2e3dd6}});});const getInitialPort=()=>{const _0x1fa8a6=a1_0x2e0de9;if(process[_0x1fa8a6(0x173)][_0x1fa8a6(0x1b9)])return parseInt(process[_0x1fa8a6(0x173)][_0x1fa8a6(0x1b9)],0xa);return config['rosbridge'][_0x1fa8a6(0x1dc)];};async function listenWithRetries(_0x5b4dd3,_0x338cc0,_0x5112cf=0xa){const _0x3842e8=a1_0x2e0de9;let _0x49ea46=_0x338cc0;for(let _0x4e8b09=0x1;_0x4e8b09<=_0x5112cf;_0x4e8b09++){try{return await new Promise((_0x423370,_0x6126a)=>{const _0x2fd344=a1_0x4efe,_0x56a3b4=_0x5b4dd3[_0x2fd344(0x18e)](_0x49ea46,()=>{const _0x5f1469=_0x2fd344;console[_0x5f1469(0x16f)](_0x5f1469(0x13b)+_0x49ea46),_0x423370(_0x56a3b4);});_0x56a3b4['on'](_0x2fd344(0x1a8),_0x1babcc=>{const _0x33d7cd=_0x2fd344;_0x1babcc[_0x33d7cd(0x15d)]===_0x33d7cd(0x1d5)?(console[_0x33d7cd(0x196)](_0x33d7cd(0x175)+_0x49ea46+_0x33d7cd(0x1bd)),_0x6126a(_0x1babcc)):_0x6126a(_0x1babcc);});}),_0x49ea46;}catch(_0x15fc6d){_0x49ea46++;}}throw new Error('Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20'+_0x5112cf+_0x3842e8(0x18b)+_0x338cc0);}function a1_0xc8a2(){const _0x3f87dc=['registration_token','package://','Attempting\x20to\x20login\x20to:','readyState','5595550cboXgW','loadConfig','Access-Control-Allow-Headers','.appliance.json','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','OPEN','strategies','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','4692304UrBVHO','reason','use','json','getAttribute','stopAllSessions','send','ros2\x20param\x20get\x20','webrtc_skip','filename','\x20from\x20','text/xml','express','credentials','sample','close','code','/appliance/register','application/json','Disconnected\x20from\x20server\x20(','getElementsByTagName','toLowerCase','stringify','getTopicStrategy','Connected\x20to\x20ROSBridge\x20(WebRTC)','\x0aAPP_PASSWORD=','param_name','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','Mesh\x20file\x20not\x20found:\x20','development','/ros/mesh?uri=','unlinkSync','xmldom','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','log','1027980gDdSJA','getToken','isAuthenticated','env','136aKWNDu','Port\x20','constructor','strategy','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','writeFileSync','initialize','(((.+)+)+)+$','Failed\x20to\x20register\x20with\x20server','catch','apply','call_service','unknown','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','./services/auth','./config','forward','Bearer\x20','robot\x20not\x20found','[MESH]\x20Successfully\x20served\x20mesh:\x20','Failed\x20to\x20start\x20application:','get_mesh','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','\x20attempts\x20starting\x20from\x20','robotId','discoverTopics','listen','handleMessage','urdf_param_data','Topic\x20discovery\x20failed:','Appliance\x20is\x20running\x20and\x20authenticated!','serializeToString','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','parseFromString','warn','toString','WSL\x20Appliance','Registering\x20with\x20server...','path','service_response','startsWith','20fBPvQw','largeDataTopics','http','Failed\x20to\x20ping\x20server:','topics','existsSync','/rosapi/topics','/health','mesh_data','slice','Failed\x20to\x20connect\x20to\x20server:','error','publish','types','values','701352gFQUIz','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','Loaded\x20appliance\x20identity:','OPTIONS','.ply','config','open','Not\x20authenticated','setAttribute','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','message','serverUrl','2230qKYqNK','PORT','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','utf8','Enter\x20username:\x20','\x20in\x20use,\x20trying\x20next\x20port...','exit','search','uri','post','status','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','includes','APP_PASSWORD','Environment:\x20','data','./services/TopicManager','header','sample_skip','.mesh','estimatedSize','get','throttling','child_process','replace','77obvbmg','766338CDqHOj','type','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','EADDRINUSE','password','substring','response','service','trim','registrationToken','proxyPort','Authentication\x20required','share','username','\x20of\x20','map','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','msg','Connected\x20to\x20ROSBridge\x20(main)','topic','endsWith','parse','ROSBridge\x20(main)\x20connection\x20error:','length','base64','APPLIANCE_BASE_URL','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','connection','NODE_ENV','.dae','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','totalTopics','samplingRate','97680zjkGVq','wsEndpoint','name','getStatistics','APP_USERNAME=','Backend\x20Server\x20URL:\x20','get_urdf_param','readFileSync','String\x20value\x20is:\x20','login','rosbridge','Failed\x20to\x20register\x20with\x20server:','axios','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','Successfully\x20logged\x20in','ROSBridge\x20(WebRTC)\x20connection\x20error:','request_id','string','some'];a1_0xc8a2=function(){return _0x3f87dc;};return a1_0xc8a2();}const startApp=async()=>{const _0x27b2d8=a1_0x2e0de9;try{let _0x156af0=await authService[_0x27b2d8(0x137)]();while(!_0x156af0){console[_0x27b2d8(0x16f)](_0x27b2d8(0x1d4)),await promptForCredentials(),_0x156af0=await authService[_0x27b2d8(0x137)]();}console[_0x27b2d8(0x16f)](_0x27b2d8(0x13c));!loadApplianceIdentity()&&console[_0x27b2d8(0x16f)](_0x27b2d8(0x16e));console['log'](_0x27b2d8(0x199));const _0x5674ad=await registerWithServer();if(!_0x5674ad)throw new Error(_0x27b2d8(0x17c));connectToRosbridge(),connectToServer();const _0x20bff9=getInitialPort();await listenWithRetries(app,_0x20bff9,0xa);}catch(_0x3302e3){console[_0x27b2d8(0x1a8)](_0x27b2d8(0x188),_0x3302e3),process[_0x27b2d8(0x1be)](0x1);}};setInterval(async()=>{const _0x344d1a=a1_0x2e0de9;try{if(robotId){const _0x305e3a=authService[_0x344d1a(0x171)]();await axios[_0x344d1a(0x1c1)](config[_0x344d1a(0x1b7)]+'/appliance/ping',{'robotId':robotId},{'headers':{'Authorization':_0x344d1a(0x185)+_0x305e3a,'Content-Type':_0x344d1a(0x15f)}});}}catch(_0x937454){console[_0x344d1a(0x1a8)](_0x344d1a(0x1a0),_0x937454[_0x344d1a(0x1b6)]);}},0x1388),startApp();