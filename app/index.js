const a1_0x36f1fd=a1_0x43c8;(function(_0x3caa89,_0x7a2864){const _0x5ca766=a1_0x43c8,_0x7acaf3=_0x3caa89();while(!![]){try{const _0x4c6c60=-parseInt(_0x5ca766(0x1ac))/0x1*(parseInt(_0x5ca766(0x1b1))/0x2)+-parseInt(_0x5ca766(0x18d))/0x3*(parseInt(_0x5ca766(0x163))/0x4)+parseInt(_0x5ca766(0x16b))/0x5+-parseInt(_0x5ca766(0x1d7))/0x6*(-parseInt(_0x5ca766(0x1d4))/0x7)+-parseInt(_0x5ca766(0x1ec))/0x8+parseInt(_0x5ca766(0x1cb))/0x9+parseInt(_0x5ca766(0x20e))/0xa*(parseInt(_0x5ca766(0x1fb))/0xb);if(_0x4c6c60===_0x7a2864)break;else _0x7acaf3['push'](_0x7acaf3['shift']());}catch(_0x46842a){_0x7acaf3['push'](_0x7acaf3['shift']());}}}(a1_0x16a8,0x37142));const a1_0x4491e5=(function(){let _0x2de0ad=!![];return function(_0x50a323,_0x378b81){const _0x69ae3f=_0x2de0ad?function(){const _0x3a2951=a1_0x43c8;if(_0x378b81){const _0x14bb5b=_0x378b81[_0x3a2951(0x1f4)](_0x50a323,arguments);return _0x378b81=null,_0x14bb5b;}}:function(){};return _0x2de0ad=![],_0x69ae3f;};}()),a1_0x467d3c=a1_0x4491e5(this,function(){const _0xdbbe86=a1_0x43c8;return a1_0x467d3c[_0xdbbe86(0x197)]()[_0xdbbe86(0x1bb)](_0xdbbe86(0x19e))[_0xdbbe86(0x197)]()[_0xdbbe86(0x1b9)](a1_0x467d3c)[_0xdbbe86(0x1bb)](_0xdbbe86(0x19e));});a1_0x467d3c();const express=require(a1_0x36f1fd(0x186)),config=require('./config'),authService=require(a1_0x36f1fd(0x1d3)),webrtcService=require('./services/webrtcService'),topicManager=require('./services/TopicManager'),WebSocket=require('ws'),axios=require(a1_0x36f1fd(0x17e)),fs=require('fs'),prompt=require('prompt-sync')({'sigint':!![]}),dotenv=require(a1_0x36f1fd(0x1c8)),app=express(),port=process[a1_0x36f1fd(0x1a9)]['PORT']||config[a1_0x36f1fd(0x182)][a1_0x36f1fd(0x1f7)],APPLIANCE_FILE=a1_0x36f1fd(0x199),{DOMParser,XMLSerializer}=require(a1_0x36f1fd(0x1e5)),path=require('path'),{execSync}=require(a1_0x36f1fd(0x1e8)),APPLIANCE_BASE_URL=process[a1_0x36f1fd(0x1a9)][a1_0x36f1fd(0x1fa)]||'';console['log'](a1_0x36f1fd(0x195)+(process[a1_0x36f1fd(0x1a9)][a1_0x36f1fd(0x208)]||'development')),console[a1_0x36f1fd(0x15c)]('Backend\x20Server\x20URL:\x20'+config[a1_0x36f1fd(0x165)]),console['log']('ROSBridge\x20WebSocket\x20URL:\x20'+config[a1_0x36f1fd(0x182)][a1_0x36f1fd(0x1d9)]),console[a1_0x36f1fd(0x15c)](a1_0x36f1fd(0x1bd)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x525607,_0x47ca61){const _0x3fb082=a1_0x36f1fd;fs[_0x3fb082(0x176)](_0x3fb082(0x209),_0x3fb082(0x20c)+_0x525607+_0x3fb082(0x207)+_0x47ca61+'\x0a');}function reloadEnv(){const _0x2e0a2f=a1_0x36f1fd;dotenv[_0x2e0a2f(0x1a8)]({'override':!![]}),config['credentials'][_0x2e0a2f(0x172)]=process['env']['APP_USERNAME'],config['credentials']['password']=process[_0x2e0a2f(0x1a9)][_0x2e0a2f(0x1b6)];}async function promptForCredentials(){const _0x5059d2=a1_0x36f1fd,_0x484c64=prompt(_0x5059d2(0x167)),_0x2f92f8=prompt[_0x5059d2(0x1ed)](_0x5059d2(0x183));updateEnvFile(_0x484c64,_0x2f92f8),reloadEnv();}function loadApplianceIdentity(){const _0x2364a5=a1_0x36f1fd;if(fs[_0x2364a5(0x1ca)](APPLIANCE_FILE))try{const _0x2b4f4e=JSON[_0x2364a5(0x190)](fs[_0x2364a5(0x162)](APPLIANCE_FILE,_0x2364a5(0x16c)));if(_0x2b4f4e[_0x2364a5(0x1a5)]&&_0x2b4f4e['registrationToken'])return robotId=_0x2b4f4e[_0x2364a5(0x1a5)],registrationToken=_0x2b4f4e[_0x2364a5(0x201)],console['log'](_0x2364a5(0x1a2),robotId),topicManager[_0x2364a5(0x1d5)](_0x2b4f4e),!![];}catch(_0x466cb9){console[_0x2364a5(0x196)](_0x2364a5(0x19b),_0x466cb9);}return![];}function saveApplianceIdentity(_0x1263ee,_0x42e720){const _0x803b98=a1_0x36f1fd;let _0x1dad8e={};if(fs[_0x803b98(0x1ca)](APPLIANCE_FILE))try{_0x1dad8e=JSON['parse'](fs[_0x803b98(0x162)](APPLIANCE_FILE,_0x803b98(0x16c)));}catch(_0x3b6497){_0x1dad8e={};}_0x1dad8e[_0x803b98(0x1a5)]=_0x1263ee,_0x1dad8e[_0x803b98(0x201)]=_0x42e720,fs[_0x803b98(0x176)](APPLIANCE_FILE,JSON['stringify'](_0x1dad8e,null,0x2));}function a1_0x16a8(){const _0x90c2dc=['config','env','throttling','use','90019Immgho','samplingRate','PORT','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','6qUbVZe','catch','map','Bearer\x20','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','APP_PASSWORD','OPEN','get_urdf_param','constructor','mesh_data','search','strategies','Proxy\x20listening\x20on\x20port:\x20','msg','Failed\x20to\x20start\x20application:','\x20->\x20','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','\x20attempts\x20starting\x20from\x20','stopAllSessions','connection','exit','Appliance\x20is\x20running\x20and\x20authenticated!','request_id','dotenv','http','existsSync','1145475UqsPgK','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','Disconnected\x20from\x20server\x20(','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','login','EADDRINUSE','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','strategy','./services/auth','84hFjdiZ','loadConfig','values','201594lriJBg','largeDataTopics','wsEndpoint','[MESH]\x20Error\x20serving\x20mesh:','startsWith','getElementsByTagName','application/json','.stl','discoverTopics','send','Failed\x20to\x20connect\x20to\x20server:','substring','text/xml','\x20in\x20use,\x20trying\x20next\x20port...','xmldom','Successfully\x20registered\x20with\x20server','unknown','child_process','share','sample_skip','Port\x20','1291656MjMMpw','hide','/robot_description','WSL\x20Appliance','development','Failed\x20to\x20ping\x20server:','readyState','stringify','apply','reason','publish','proxyPort','Failed\x20to\x20register\x20with\x20server:','message','APPLIANCE_BASE_URL','31482qbsiuX','join','Connected\x20to\x20server','header','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','name','registrationToken','json','.dae','Ros','[URDF\x20REWRITE]\x20Rewrote\x20','service','\x0aAPP_PASSWORD=','NODE_ENV','.env','types','getToken','APP_USERNAME=','endsWith','410eBTNsK','topic','slice','webrtc_skip','.obj','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','Server\x20connection\x20error:','totalTopics','log','/ros/mesh?uri=','open','data','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','getStatistics','readFileSync','152EsJZLV','action','serverUrl','Connected\x20to\x20ROSBridge\x20(WebRTC)','Enter\x20username:\x20','post','registration_token','toLowerCase','1287825EjFiSn','utf8','get','OPTIONS','param_name','estimatedSize','/appliance/ping','username','Authentication\x20required','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','writeFileSync','getActiveSessions','initialize','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','robot\x20not\x20found','.mesh','Topic\x20discovery\x20failed:','parseFromString','axios','/rosapi/topics','uri','status','rosbridge','Enter\x20password:\x20','string','replace','express','isAuthenticated','Access-Control-Allow-Headers','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','Access-Control-Allow-Origin','handleMessage','\x20of\x20','19599UvkUFR','listen','trim','parse','/appliance/register','close','call_service','getSharedVideoSources','Environment:\x20','error','toString','code','.appliance.json','Connected\x20to\x20ROSBridge\x20(main)','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','String\x20value\x20is:\x20','filename','(((.+)+)+)+$','Attempting\x20to\x20login\x20to:','length','service_response','Loaded\x20appliance\x20identity:','topics','response','robotId','urdf_param_data','\x20from\x20'];a1_0x16a8=function(){return _0x90c2dc;};return a1_0x16a8();}async function registerWithServer(){const _0xc7e17a=a1_0x36f1fd;try{const _0x25e13a=authService[_0xc7e17a(0x20b)]();if(!_0x25e13a)throw new Error('Not\x20authenticated');let _0x30805e,_0x57b4b1=![];while(!![]){try{robotId&&registrationToken?_0x30805e=await axios[_0xc7e17a(0x168)](config[_0xc7e17a(0x165)]+'/appliance/register',{'name':'WSL\x20Appliance','robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0xc7e17a(0x1b4)+_0x25e13a,'Content-Type':_0xc7e17a(0x1dd)}}):_0x30805e=await axios[_0xc7e17a(0x168)](config[_0xc7e17a(0x165)]+_0xc7e17a(0x191),{'name':_0xc7e17a(0x1ef)},{'headers':{'Authorization':_0xc7e17a(0x1b4)+_0x25e13a,'Content-Type':_0xc7e17a(0x1dd)}});break;}catch(_0x1b086c){const _0x47f1dd=_0x1b086c?.[_0xc7e17a(0x1a4)]?.[_0xc7e17a(0x15f)]?.[_0xc7e17a(0x196)]||_0x1b086c['message'];if(!_0x57b4b1&&_0x47f1dd&&_0x47f1dd[_0xc7e17a(0x16a)]()['includes'](_0xc7e17a(0x17a))){console['warn'](_0xc7e17a(0x1af));if(fs['existsSync'](APPLIANCE_FILE))fs['unlinkSync'](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x57b4b1=!![];continue;}throw _0x1b086c;}}if(!_0x30805e['data']||!_0x30805e['data'][_0xc7e17a(0x169)]||!_0x30805e[_0xc7e17a(0x15f)]['id'])throw new Error('Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server');return registrationToken=_0x30805e[_0xc7e17a(0x15f)]['registration_token'],robotId=_0x30805e[_0xc7e17a(0x15f)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0xc7e17a(0x15c)](_0xc7e17a(0x1e6)),!![];}catch(_0x3baaea){return console[_0xc7e17a(0x196)](_0xc7e17a(0x1f8),_0x3baaea['message']),![];}}function rewriteUrdfMeshUris(_0x5a6018){const _0x1181b6=a1_0x36f1fd;try{const _0x1c8af1=new DOMParser(),_0x4bd2e8=_0x1c8af1[_0x1181b6(0x17d)](_0x5a6018,_0x1181b6(0x1e3));let _0x5db972=0x0,_0x920649=0x0;const _0x509c36=_0x4bd2e8[_0x1181b6(0x1dc)]('mesh');for(let _0x4cb9b4=0x0;_0x4cb9b4<_0x509c36[_0x1181b6(0x1a0)];_0x4cb9b4++){const _0x395710=_0x509c36[_0x4cb9b4],_0x23d6dd=_0x395710['getAttribute'](_0x1181b6(0x19d)),_0x15d95a=[_0x1181b6(0x1de),_0x1181b6(0x203),_0x1181b6(0x158),'.ply',_0x1181b6(0x17b)],_0x834531=_0x15d95a['some'](_0x2f686e=>_0x23d6dd['toLowerCase']()[_0x1181b6(0x20d)](_0x2f686e));if(_0x23d6dd&&_0x23d6dd[_0x1181b6(0x1db)]('package://')&&_0x834531){_0x5db972++;const _0xc66cec=APPLIANCE_BASE_URL+_0x1181b6(0x15d)+encodeURIComponent(_0x23d6dd);_0x395710['setAttribute'](_0x1181b6(0x19d),_0xc66cec),_0x920649++,console['log']('[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20'+_0x23d6dd+_0x1181b6(0x1c0)+_0xc66cec);}}_0x5db972>0x0?console[_0x1181b6(0x15c)](_0x1181b6(0x205)+_0x920649+_0x1181b6(0x18c)+_0x5db972+_0x1181b6(0x189)):console[_0x1181b6(0x15c)](_0x1181b6(0x1d1));const _0x102a70=new XMLSerializer();return _0x102a70['serializeToString'](_0x4bd2e8);}catch(_0x501d9b){return console[_0x1181b6(0x196)]('[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):',_0x501d9b),_0x5a6018;}}function connectToRosbridge(){const _0x417076=a1_0x36f1fd;try{rosbridgeWs=new WebSocket(config[_0x417076(0x182)]['wsEndpoint']),rosbridgeWs['on'](_0x417076(0x15e),()=>{const _0x545075=_0x417076;console['log'](_0x545075(0x19a));const _0x3a2e8f=require('roslib'),_0x27c62e=new _0x3a2e8f[(_0x545075(0x204))]({'url':config['rosbridge']['wsEndpoint']});_0x27c62e['on'](_0x545075(0x1c4),()=>{setTimeout(()=>{const _0x131a20=a1_0x43c8;topicManager[_0x131a20(0x1df)](_0x27c62e)[_0x131a20(0x1b2)](_0x419f12=>{const _0x4927a7=_0x131a20;console[_0x4927a7(0x196)](_0x4927a7(0x17c),_0x419f12);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x417076(0x1f9),_0x322a4a=>{const _0x418a9d=_0x417076;if(serverWs&&serverWs['readyState']===WebSocket[_0x418a9d(0x1b7)]){let _0x19a9bb=_0x322a4a[_0x418a9d(0x197)]();try{const _0x3d0f61=JSON[_0x418a9d(0x190)](_0x19a9bb);if(_0x3d0f61['op']===_0x418a9d(0x1f6)&&_0x3d0f61[_0x418a9d(0x20f)]){const _0x141175=topicManager[_0x418a9d(0x18b)](_0x3d0f61);switch(_0x141175[_0x418a9d(0x164)]){case _0x418a9d(0x1ea):return;case _0x418a9d(0x157):return;case'forward':default:_0x19a9bb=JSON[_0x418a9d(0x1f3)](_0x141175[_0x418a9d(0x1f9)]);break;}}if((_0x3d0f61['op']===_0x418a9d(0x1a1)||_0x3d0f61['op']===_0x418a9d(0x193))&&(_0x3d0f61[_0x418a9d(0x206)]===_0x418a9d(0x17f)||_0x3d0f61[_0x418a9d(0x1d6)]&&_0x3d0f61[_0x418a9d(0x1d6)][_0x418a9d(0x1a3)])){console[_0x418a9d(0x15c)]('[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata');const _0x2536c0=_0x3d0f61[_0x418a9d(0x1d6)]?.['topics']||[],_0x3c6704=_0x3d0f61[_0x418a9d(0x1d6)]?.[_0x418a9d(0x20a)]||[],_0x118107=_0x2536c0[_0x418a9d(0x1b3)]((_0x5cdd82,_0x573d49)=>{const _0x46c2d2=_0x418a9d,_0x570073=topicManager['getTopicStrategy'](_0x5cdd82);return{'name':_0x5cdd82,'type':_0x3c6704[_0x573d49]||_0x46c2d2(0x1e7),'throttling':_0x570073?{'isThrottled':_0x570073[_0x46c2d2(0x1d2)]==='sample','strategy':_0x570073['strategy'],'samplingRate':_0x570073[_0x46c2d2(0x1ad)],'reason':_0x570073[_0x46c2d2(0x1f5)],'estimatedSize':_0x570073[_0x46c2d2(0x170)]}:null};});_0x3d0f61['values']={'topics':_0x118107[_0x418a9d(0x1b3)](_0x3ce672=>_0x3ce672[_0x418a9d(0x200)]),'types':_0x118107['map'](_0x502997=>_0x502997['type']),'throttling':_0x118107[_0x418a9d(0x1b3)](_0x7e3bc5=>_0x7e3bc5[_0x418a9d(0x1aa)])},_0x19a9bb=JSON['stringify'](_0x3d0f61),console[_0x418a9d(0x15c)]('[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client');}if(_0x3d0f61['op']===_0x418a9d(0x1f6)&&_0x3d0f61[_0x418a9d(0x20f)]===_0x418a9d(0x1ee))try{const _0x4a2948=_0x3d0f61[_0x418a9d(0x1be)][_0x418a9d(0x15f)],_0x1e3301=rewriteUrdfMeshUris(_0x4a2948);_0x3d0f61['msg'][_0x418a9d(0x15f)]=_0x1e3301,_0x19a9bb=JSON[_0x418a9d(0x1f3)](_0x3d0f61);}catch(_0x7b91f5){console[_0x418a9d(0x196)](_0x418a9d(0x1b0),_0x7b91f5);}}catch(_0x423f4){console['warn'](_0x418a9d(0x1b5),_0x423f4[_0x418a9d(0x1f9)]);}serverWs[_0x418a9d(0x1e0)](_0x19a9bb);}}),rosbridgeWs['on'](_0x417076(0x192),()=>{const _0x593e3c=_0x417076;console[_0x593e3c(0x15c)](_0x593e3c(0x1ce)),webrtcService['stopAllSessions'](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x417076(0x196),_0x5296ca=>{const _0x3ef05c=_0x417076;console[_0x3ef05c(0x196)]('ROSBridge\x20(main)\x20connection\x20error:',_0x5296ca);});}catch(_0x41073c){console[_0x417076(0x196)](_0x417076(0x159),_0x41073c),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x18f676=a1_0x36f1fd;try{rosbridgeWebRTCWs=new WebSocket(config[_0x18f676(0x182)][_0x18f676(0x1d9)]),rosbridgeWebRTCWs['on'](_0x18f676(0x15e),()=>{const _0x16ed9c=_0x18f676;console[_0x16ed9c(0x15c)](_0x16ed9c(0x166)),webrtcService[_0x16ed9c(0x178)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x18f676(0x1f9),_0x4693cd=>{}),rosbridgeWebRTCWs['on'](_0x18f676(0x192),()=>{const _0x195c6b=_0x18f676;console[_0x195c6b(0x15c)]('Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...'),webrtcService['stopAllSessions'](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x18f676(0x196),_0x44e715=>{const _0x30947b=_0x18f676;console[_0x30947b(0x196)]('ROSBridge\x20(WebRTC)\x20connection\x20error:',_0x44e715);});}catch(_0x24af5a){console[_0x18f676(0x196)](_0x18f676(0x175),_0x24af5a),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x4c0780=a1_0x36f1fd;try{if(!registrationToken)throw new Error(_0x4c0780(0x160));const _0x3be76e=config['serverUrl'][_0x4c0780(0x185)](_0x4c0780(0x1c9),'ws')+'/rosbridge?type=appliance&token='+registrationToken;serverWs=new WebSocket(_0x3be76e),serverWs['on'](_0x4c0780(0x15e),()=>{const _0x34681a=_0x4c0780;console['log'](_0x34681a(0x1fd)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs['readyState']===WebSocket['OPEN']&&webrtcService[_0x34681a(0x178)](rosbridgeWebRTCWs,serverWs);}),serverWs['on']('message',_0x4c3048=>{const _0x1d2f67=_0x4c0780;if(rosbridgeWs&&rosbridgeWs[_0x1d2f67(0x1f2)]===WebSocket[_0x1d2f67(0x1b7)]){let _0x52206=_0x4c3048[_0x1d2f67(0x197)]();try{const _0xab838d=JSON[_0x1d2f67(0x190)](_0x52206);if(webrtcService[_0x1d2f67(0x18b)](_0xab838d))return;if(_0xab838d['op']===_0x1d2f67(0x1b8)&&typeof _0xab838d[_0x1d2f67(0x16f)]==='string'&&_0xab838d[_0x1d2f67(0x1c7)])try{console[_0x1d2f67(0x15c)]('[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20'+_0xab838d['param_name']);const _0x337921=execSync('ros2\x20param\x20get\x20'+_0xab838d['param_name'],{'encoding':_0x1d2f67(0x16c)})[_0x1d2f67(0x18f)]();let _0x7f9163=_0x337921;_0x337921['startsWith'](_0x1d2f67(0x19c))&&(_0x7f9163=_0x337921[_0x1d2f67(0x1e2)](_0x1d2f67(0x19c)[_0x1d2f67(0x1a0)]()));_0x7f9163[_0x1d2f67(0x1db)]('\x22')&&_0x7f9163['endsWith']('\x22')&&(_0x7f9163=_0x7f9163[_0x1d2f67(0x156)](0x1,-0x1));_0x7f9163=_0x7f9163[_0x1d2f67(0x185)](/\\n/g,'\x0a')[_0x1d2f67(0x185)](/\\"/g,'\x22');const _0x17cb41={'op':_0x1d2f67(0x1a6),'request_id':_0xab838d['request_id'],'data':_0x7f9163};serverWs['send'](JSON['stringify'](_0x17cb41)),console[_0x1d2f67(0x15c)](_0x1d2f67(0x1ff)+_0xab838d[_0x1d2f67(0x16f)]);return;}catch(_0xe921d5){console['error']('[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:',_0xe921d5);const _0x575fa={'op':_0x1d2f67(0x1a6),'request_id':_0xab838d[_0x1d2f67(0x1c7)],'error':_0xe921d5[_0x1d2f67(0x1f9)]};serverWs[_0x1d2f67(0x1e0)](JSON[_0x1d2f67(0x1f3)](_0x575fa));return;}if(_0xab838d['op']==='get_mesh'&&typeof _0xab838d[_0x1d2f67(0x180)]===_0x1d2f67(0x184)&&_0xab838d['request_id'])try{const _0x3431c8=_0xab838d[_0x1d2f67(0x180)]['match'](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x3431c8){const _0x37b134=_0x3431c8[0x1],_0x5a93b0=_0x3431c8[0x2],_0xc78e1c=execSync('ros2\x20pkg\x20prefix\x20'+_0x37b134,{'encoding':_0x1d2f67(0x16c)})[_0x1d2f67(0x18f)](),_0x23e2b7=path[_0x1d2f67(0x1fc)](_0xc78e1c,_0x1d2f67(0x1e9),_0x37b134,_0x5a93b0);if(!fs[_0x1d2f67(0x1ca)](_0x23e2b7))throw new Error('Mesh\x20file\x20not\x20found:\x20'+_0x23e2b7);const _0x392d37=fs[_0x1d2f67(0x162)](_0x23e2b7),_0x20c891={'op':'mesh_data','request_id':_0xab838d[_0x1d2f67(0x1c7)],'data':_0x392d37[_0x1d2f67(0x197)]('base64')};serverWs[_0x1d2f67(0x1e0)](JSON[_0x1d2f67(0x1f3)](_0x20c891)),console[_0x1d2f67(0x15c)]('[MESH]\x20Successfully\x20served\x20mesh:\x20'+_0xab838d[_0x1d2f67(0x180)]+_0x1d2f67(0x1a7)+_0x23e2b7);return;}}catch(_0x20c59a){console[_0x1d2f67(0x196)](_0x1d2f67(0x1da),_0x20c59a);const _0x1c4944={'op':_0x1d2f67(0x1ba),'request_id':_0xab838d[_0x1d2f67(0x1c7)],'error':_0x20c59a[_0x1d2f67(0x1f9)]};serverWs[_0x1d2f67(0x1e0)](JSON[_0x1d2f67(0x1f3)](_0x1c4944));return;}rosbridgeWs[_0x1d2f67(0x1e0)](_0x52206);}catch(_0x1b881d){rosbridgeWs[_0x1d2f67(0x1e0)](_0x52206);}}}),serverWs['on'](_0x4c0780(0x192),(_0x440458,_0x57eca0)=>{const _0x598489=_0x4c0780;console[_0x598489(0x15c)](_0x598489(0x1cd)+_0x440458+':\x20'+_0x57eca0+'),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x598489(0x1c3)](),setTimeout(connectToServer,0x1388);}),serverWs['on']('error',_0x30ffaa=>{const _0x1b61df=_0x4c0780;console[_0x1b61df(0x196)](_0x1b61df(0x15a),_0x30ffaa);});}catch(_0x4ec0bb){console[_0x4c0780(0x196)](_0x4c0780(0x1e1),_0x4ec0bb),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x3b3252,_0xa36a5f,_0x18969f)=>{const _0x704c55=a1_0x36f1fd;if(!authService[_0x704c55(0x187)]()){console['log'](_0x704c55(0x19f),config[_0x704c55(0x165)]);const _0x7d9e35=await authService[_0x704c55(0x1cf)]();if(!_0x7d9e35)return _0xa36a5f[_0x704c55(0x181)](0x191)[_0x704c55(0x202)]({'error':_0x704c55(0x173)});}_0x18969f();};app[a1_0x36f1fd(0x1ab)]((_0x3541f0,_0x352396,_0xf14537)=>{const _0x414460=a1_0x36f1fd;_0x352396[_0x414460(0x1fe)](_0x414460(0x18a),'*'),_0x352396['header']('Access-Control-Allow-Methods',_0x414460(0x1cc)),_0x352396[_0x414460(0x1fe)](_0x414460(0x188),'Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization'),_0x3541f0['method']===_0x414460(0x16e)?_0x352396['sendStatus'](0xc8):_0xf14537();}),app[a1_0x36f1fd(0x16d)]('/',requireAuth,(_0x345883,_0x828fe6)=>{const _0x57e973=a1_0x36f1fd;_0x828fe6[_0x57e973(0x1e0)](_0x57e973(0x1c6));}),app['get']('/health',async(_0x54130b,_0x4215a3)=>{const _0x4be1a4=a1_0x36f1fd,_0x4f1066=authService[_0x4be1a4(0x187)](),_0x57fd2e=webrtcService[_0x4be1a4(0x177)](),_0x249a01=webrtcService[_0x4be1a4(0x194)](),_0x518d94=topicManager[_0x4be1a4(0x161)]();_0x4215a3[_0x4be1a4(0x202)]({'status':'ok','environment':process['env'][_0x4be1a4(0x208)]||_0x4be1a4(0x1f0),'backendUrl':config[_0x4be1a4(0x165)],'rosbridgeUrl':config[_0x4be1a4(0x182)][_0x4be1a4(0x1d9)],'proxyPort':port,'authenticated':_0x4f1066,'topicManagement':{'discovered':_0x518d94[_0x4be1a4(0x15b)],'strategies':_0x518d94[_0x4be1a4(0x1bc)],'largeDataTopics':_0x518d94[_0x4be1a4(0x1d8)]['length'],'largeTopicsList':_0x518d94[_0x4be1a4(0x1d8)]},'webrtc':{'activeSessions':_0x57fd2e[_0x4be1a4(0x1a0)],'sharedVideoSources':_0x249a01['length'],'sessions':_0x57fd2e,'sharedSources':_0x249a01}});});const getInitialPort=()=>{const _0x1bb5e5=a1_0x36f1fd;if(process['env'][_0x1bb5e5(0x1ae)])return parseInt(process['env'][_0x1bb5e5(0x1ae)],0xa);return config[_0x1bb5e5(0x182)][_0x1bb5e5(0x1f7)];};function a1_0x43c8(_0x259dd4,_0x3b2d52){const _0x19591f=a1_0x16a8();return a1_0x43c8=function(_0x467d3c,_0x4491e5){_0x467d3c=_0x467d3c-0x156;let _0x16a83e=_0x19591f[_0x467d3c];return _0x16a83e;},a1_0x43c8(_0x259dd4,_0x3b2d52);}async function listenWithRetries(_0x4e0e84,_0xc9fad9,_0xedc1e3=0xa){const _0x4638f4=a1_0x36f1fd;let _0x1ebc53=_0xc9fad9;for(let _0x3d3644=0x1;_0x3d3644<=_0xedc1e3;_0x3d3644++){try{return await new Promise((_0x360918,_0x1bd7e6)=>{const _0x38e693=a1_0x43c8,_0x50395a=_0x4e0e84[_0x38e693(0x18e)](_0x1ebc53,()=>{const _0x6c7a5d=_0x38e693;console[_0x6c7a5d(0x15c)](_0x6c7a5d(0x179)+_0x1ebc53),_0x360918(_0x50395a);});_0x50395a['on'](_0x38e693(0x196),_0xc3faad=>{const _0x3250c3=_0x38e693;_0xc3faad[_0x3250c3(0x198)]===_0x3250c3(0x1d0)?(console['warn'](_0x3250c3(0x1eb)+_0x1ebc53+_0x3250c3(0x1e4)),_0x1bd7e6(_0xc3faad)):_0x1bd7e6(_0xc3faad);});}),_0x1ebc53;}catch(_0x495a51){_0x1ebc53++;}}throw new Error('Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20'+_0xedc1e3+_0x4638f4(0x1c2)+_0xc9fad9);}const startApp=async()=>{const _0x2ee3fd=a1_0x36f1fd;try{let _0x3516fa=await authService[_0x2ee3fd(0x1cf)]();while(!_0x3516fa){console['log'](_0x2ee3fd(0x1c1)),await promptForCredentials(),_0x3516fa=await authService[_0x2ee3fd(0x1cf)]();}console['log']('Successfully\x20logged\x20in');!loadApplianceIdentity()&&console[_0x2ee3fd(0x15c)](_0x2ee3fd(0x174));console[_0x2ee3fd(0x15c)]('Registering\x20with\x20server...');const _0x10cb6b=await registerWithServer();if(!_0x10cb6b)throw new Error('Failed\x20to\x20register\x20with\x20server');connectToRosbridge(),connectToServer();const _0x2aded9=getInitialPort();await listenWithRetries(app,_0x2aded9,0xa);}catch(_0x187f79){console[_0x2ee3fd(0x196)](_0x2ee3fd(0x1bf),_0x187f79),process[_0x2ee3fd(0x1c5)](0x1);}};setInterval(async()=>{const _0x24e324=a1_0x36f1fd;try{if(robotId){const _0x1b0cf4=authService[_0x24e324(0x20b)]();await axios['post'](config[_0x24e324(0x165)]+_0x24e324(0x171),{'robotId':robotId},{'headers':{'Authorization':'Bearer\x20'+_0x1b0cf4,'Content-Type':'application/json'}});}}catch(_0x37cd07){console[_0x24e324(0x196)](_0x24e324(0x1f1),_0x37cd07['message']);}},0x1388),startApp();