const a1_0x4fd64b=a1_0x116e;(function(_0x1facd8,_0x20f7d0){const _0x5bc21b=a1_0x116e,_0x2a1fb3=_0x1facd8();while(!![]){try{const _0x5020b6=-parseInt(_0x5bc21b(0x120))/0x1*(-parseInt(_0x5bc21b(0xc1))/0x2)+-parseInt(_0x5bc21b(0xd0))/0x3*(-parseInt(_0x5bc21b(0xd9))/0x4)+-parseInt(_0x5bc21b(0x152))/0x5*(parseInt(_0x5bc21b(0x148))/0x6)+-parseInt(_0x5bc21b(0xab))/0x7+parseInt(_0x5bc21b(0x115))/0x8*(parseInt(_0x5bc21b(0x103))/0x9)+-parseInt(_0x5bc21b(0x161))/0xa+-parseInt(_0x5bc21b(0x119))/0xb*(-parseInt(_0x5bc21b(0x116))/0xc);if(_0x5020b6===_0x20f7d0)break;else _0x2a1fb3['push'](_0x2a1fb3['shift']());}catch(_0x5e5c6c){_0x2a1fb3['push'](_0x2a1fb3['shift']());}}}(a1_0x589d,0xa5b6c));const a1_0xdf14bb=(function(){let _0x1f6886=!![];return function(_0x30f5b7,_0x4a1c47){const _0x3f4bbd=_0x1f6886?function(){const _0x1c409f=a1_0x116e;if(_0x4a1c47){const _0x1e5a5c=_0x4a1c47[_0x1c409f(0x153)](_0x30f5b7,arguments);return _0x4a1c47=null,_0x1e5a5c;}}:function(){};return _0x1f6886=![],_0x3f4bbd;};}()),a1_0x4a2cf3=a1_0xdf14bb(this,function(){const _0x397841=a1_0x116e;return a1_0x4a2cf3['toString']()['search'](_0x397841(0xdc))['toString']()['constructor'](a1_0x4a2cf3)[_0x397841(0x106)](_0x397841(0xdc));});a1_0x4a2cf3();const express=require(a1_0x4fd64b(0xb5)),config=require(a1_0x4fd64b(0xd7)),authService=require(a1_0x4fd64b(0xe7)),webrtcService=require('./services/webrtcService'),topicManager=require(a1_0x4fd64b(0x154)),WebSocket=require('ws'),axios=require(a1_0x4fd64b(0xf9)),fs=require('fs'),prompt=require(a1_0x4fd64b(0x108))({'sigint':!![]}),dotenv=require(a1_0x4fd64b(0x10a)),app=express(),port=process['env']['PORT']||config[a1_0x4fd64b(0xe5)][a1_0x4fd64b(0xbe)],APPLIANCE_FILE=a1_0x4fd64b(0xdf),{DOMParser,XMLSerializer}=require(a1_0x4fd64b(0x135)),path=require('path'),{execSync}=require(a1_0x4fd64b(0x14f)),APPLIANCE_BASE_URL=process['env'][a1_0x4fd64b(0xfb)]||'';console[a1_0x4fd64b(0x11f)](a1_0x4fd64b(0xa9)+(process[a1_0x4fd64b(0x157)][a1_0x4fd64b(0xe9)]||'development')),console[a1_0x4fd64b(0x11f)](a1_0x4fd64b(0x150)+config['serverUrl']),console[a1_0x4fd64b(0x11f)]('ROSBridge\x20WebSocket\x20URL:\x20'+config[a1_0x4fd64b(0xe5)][a1_0x4fd64b(0xf0)]),console[a1_0x4fd64b(0x11f)]('Proxy\x20listening\x20on\x20port:\x20'+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function a1_0x589d(){const _0x26331d=['robotId','warn','post','parseFromString','utf8','/appliance/register','child_process','Backend\x20Server\x20URL:\x20','types','1455GzzeEe','apply','./services/TopicManager','connection','[MESH]\x20Successfully\x20served\x20mesh:\x20','env','message','json','mesh_data','stopAllSessions','hide','unlinkSync','toLowerCase','existsSync','Failed\x20to\x20ping\x20server:','12625490ztqXcD','config','totalTopics','share','EADDRINUSE','[MESH]\x20Error\x20serving\x20mesh:','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','APP_USERNAME=','data','Failed\x20to\x20register\x20with\x20server','OPEN','Environment:\x20','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','6449380NFWRzu','package://','Attempting\x20to\x20login\x20to:','Loaded\x20appliance\x20identity:','request_id','get_mesh','discoverTopics','header','\x20in\x20use,\x20trying\x20next\x20port...','getElementsByTagName','express','samplingRate','writeFileSync','application/json','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','getSharedVideoSources','sample_skip','getActiveSessions','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','proxyPort','Authentication\x20required','Failed\x20to\x20connect\x20to\x20server:','2189098bXFZEd','isAuthenticated','\x0aAPP_PASSWORD=','Successfully\x20registered\x20with\x20server','replace','getStatistics','endsWith','some','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','readFileSync','Connected\x20to\x20server','credentials','use','substring','String\x20value\x20is:\x20','3bBIMKp','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','slice','\x20attempts\x20starting\x20from\x20','getToken','values','get','./config','username','2368796ctNyYz','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','Access-Control-Allow-Methods','(((.+)+)+)+$','serverUrl','registrationToken','.appliance.json','sendStatus','),\x20attempting\x20to\x20reconnect...','length','Server\x20connection\x20error:','registration_token','rosbridge','largeDataTopics','./services/auth','uri','NODE_ENV','Registering\x20with\x20server...','.stl','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','map','base64','mesh','wsEndpoint','param_name','string','startsWith','ROSBridge\x20(WebRTC)\x20connection\x20error:','readyState','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','Connected\x20to\x20ROSBridge\x20(WebRTC)','/ros/mesh?uri=','axios','.ply','APPLIANCE_BASE_URL','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','Failed\x20to\x20start\x20application:','name','ros2\x20param\x20get\x20','Mesh\x20file\x20not\x20found:\x20','catch','330363SNHNhr','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','\x20->\x20','search','urdf_param_data','prompt-sync','webrtc_skip','dotenv','estimatedSize','/health','ROSBridge\x20(main)\x20connection\x20error:','PORT','APP_USERNAME','unknown','response','Enter\x20username:\x20','OPTIONS','Access-Control-Allow-Headers','56EyYvBF','24063108uhgnIo','service','stringify','11dLszom','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','getTopicStrategy','password','WSL\x20Appliance','code','log','1YBshgC','topics','error','close','toString','Disconnected\x20from\x20server\x20(','forward','strategy','match','Bearer\x20','filename','publish','.dae','status','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','get_urdf_param','Topic\x20discovery\x20failed:','initialize','handleMessage','Connected\x20to\x20ROSBridge\x20(main)','xmldom','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','open','Failed\x20to\x20register\x20with\x20server:','ros2\x20pkg\x20prefix\x20','/rosapi/topics','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','strategies','.mesh','send','roslib','login','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','http','APP_PASSWORD','throttling','trim','parse','join','22398WtvFhM'];a1_0x589d=function(){return _0x26331d;};return a1_0x589d();}function updateEnvFile(_0x3ac8d7,_0x307cf6){const _0x4a023a=a1_0x4fd64b;fs[_0x4a023a(0xb7)]('.env',_0x4a023a(0x168)+_0x3ac8d7+_0x4a023a(0xc3)+_0x307cf6+'\x0a');}function reloadEnv(){const _0x4ae3d4=a1_0x4fd64b;dotenv[_0x4ae3d4(0x162)]({'override':!![]}),config[_0x4ae3d4(0xcc)][_0x4ae3d4(0xd8)]=process[_0x4ae3d4(0x157)][_0x4ae3d4(0x10f)],config[_0x4ae3d4(0xcc)][_0x4ae3d4(0x11c)]=process['env'][_0x4ae3d4(0x143)];}async function promptForCredentials(){const _0x5d1a0d=a1_0x4fd64b,_0x462c88=prompt(_0x5d1a0d(0x112)),_0x52aa82=prompt[_0x5d1a0d(0x15c)]('Enter\x20password:\x20');updateEnvFile(_0x462c88,_0x52aa82),reloadEnv();}function loadApplianceIdentity(){const _0x4d735c=a1_0x4fd64b;if(fs[_0x4d735c(0x15f)](APPLIANCE_FILE))try{const _0x1508c7=JSON[_0x4d735c(0x146)](fs[_0x4d735c(0xca)](APPLIANCE_FILE,_0x4d735c(0x14d)));if(_0x1508c7['robotId']&&_0x1508c7[_0x4d735c(0xde)])return robotId=_0x1508c7[_0x4d735c(0x149)],registrationToken=_0x1508c7[_0x4d735c(0xde)],console[_0x4d735c(0x11f)](_0x4d735c(0xae),robotId),topicManager['loadConfig'](_0x1508c7),!![];}catch(_0x31e8eb){console[_0x4d735c(0x122)](_0x4d735c(0xf6),_0x31e8eb);}return![];}function saveApplianceIdentity(_0xa02ae3,_0x3da911){const _0x1e91bb=a1_0x4fd64b;let _0x595b4f={};if(fs['existsSync'](APPLIANCE_FILE))try{_0x595b4f=JSON[_0x1e91bb(0x146)](fs[_0x1e91bb(0xca)](APPLIANCE_FILE,'utf8'));}catch(_0x8dff8f){_0x595b4f={};}_0x595b4f[_0x1e91bb(0x149)]=_0xa02ae3,_0x595b4f[_0x1e91bb(0xde)]=_0x3da911,fs[_0x1e91bb(0xb7)](APPLIANCE_FILE,JSON['stringify'](_0x595b4f,null,0x2));}async function registerWithServer(){const _0x348bbc=a1_0x4fd64b;try{const _0x470267=authService[_0x348bbc(0xd4)]();if(!_0x470267)throw new Error('Not\x20authenticated');let _0x2a6f06,_0x4f6eba=![];while(!![]){try{robotId&&registrationToken?_0x2a6f06=await axios[_0x348bbc(0x14b)](config[_0x348bbc(0xdd)]+_0x348bbc(0x14e),{'name':_0x348bbc(0x11d),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x348bbc(0x129)+_0x470267,'Content-Type':_0x348bbc(0xb8)}}):_0x2a6f06=await axios[_0x348bbc(0x14b)](config[_0x348bbc(0xdd)]+_0x348bbc(0x14e),{'name':_0x348bbc(0x11d)},{'headers':{'Authorization':_0x348bbc(0x129)+_0x470267,'Content-Type':'application/json'}});break;}catch(_0x320df7){const _0x4c4a40=_0x320df7?.[_0x348bbc(0x111)]?.['data']?.[_0x348bbc(0x122)]||_0x320df7[_0x348bbc(0x158)];if(!_0x4f6eba&&_0x4c4a40&&_0x4c4a40[_0x348bbc(0x15e)]()['includes']('robot\x20not\x20found')){console[_0x348bbc(0x14a)](_0x348bbc(0x104));if(fs[_0x348bbc(0x15f)](APPLIANCE_FILE))fs[_0x348bbc(0x15d)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x4f6eba=!![];continue;}throw _0x320df7;}}if(!_0x2a6f06[_0x348bbc(0x169)]||!_0x2a6f06[_0x348bbc(0x169)][_0x348bbc(0xe4)]||!_0x2a6f06[_0x348bbc(0x169)]['id'])throw new Error(_0x348bbc(0x12e));return registrationToken=_0x2a6f06[_0x348bbc(0x169)][_0x348bbc(0xe4)],robotId=_0x2a6f06[_0x348bbc(0x169)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x348bbc(0x11f)](_0x348bbc(0xc4)),!![];}catch(_0x23da81){return console[_0x348bbc(0x122)](_0x348bbc(0x138),_0x23da81[_0x348bbc(0x158)]),![];}}function rewriteUrdfMeshUris(_0x6e0126){const _0x553d85=a1_0x4fd64b;try{const _0x303148=new DOMParser(),_0x49123a=_0x303148[_0x553d85(0x14c)](_0x6e0126,'text/xml');let _0x5af95f=0x0,_0x496b03=0x0;const _0x24993d=_0x49123a[_0x553d85(0xb4)](_0x553d85(0xef));for(let _0x54e59d=0x0;_0x54e59d<_0x24993d['length'];_0x54e59d++){const _0x467736=_0x24993d[_0x54e59d],_0x428f11=_0x467736['getAttribute']('filename'),_0x44eefb=[_0x553d85(0xeb),_0x553d85(0x12c),'.obj',_0x553d85(0xfa),_0x553d85(0x13d)],_0xd57cf2=_0x44eefb[_0x553d85(0xc8)](_0x4860e9=>_0x428f11[_0x553d85(0x15e)]()[_0x553d85(0xc7)](_0x4860e9));if(_0x428f11&&_0x428f11[_0x553d85(0xf3)](_0x553d85(0xac))&&_0xd57cf2){_0x5af95f++;const _0x493822=APPLIANCE_BASE_URL+_0x553d85(0xf8)+encodeURIComponent(_0x428f11);_0x467736['setAttribute'](_0x553d85(0x12a),_0x493822),_0x496b03++,console['log'](_0x553d85(0x141)+_0x428f11+_0x553d85(0x105)+_0x493822);}}_0x5af95f>0x0?console[_0x553d85(0x11f)]('[URDF\x20REWRITE]\x20Rewrote\x20'+_0x496b03+'\x20of\x20'+_0x5af95f+_0x553d85(0xb9)):console[_0x553d85(0x11f)]('[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF');const _0x3f5f7d=new XMLSerializer();return _0x3f5f7d['serializeToString'](_0x49123a);}catch(_0x6067d1){return console['error'](_0x553d85(0x12f),_0x6067d1),_0x6e0126;}}function connectToRosbridge(){const _0x230798=a1_0x4fd64b;try{rosbridgeWs=new WebSocket(config['rosbridge'][_0x230798(0xf0)]),rosbridgeWs['on'](_0x230798(0x137),()=>{const _0xfc3f38=_0x230798;console[_0xfc3f38(0x11f)](_0xfc3f38(0x134));const _0x9034a7=require(_0xfc3f38(0x13f)),_0x35989b=new _0x9034a7['Ros']({'url':config[_0xfc3f38(0xe5)]['wsEndpoint']});_0x35989b['on'](_0xfc3f38(0x155),()=>{setTimeout(()=>{const _0x58504e=a1_0x116e;topicManager[_0x58504e(0xb1)](_0x35989b)[_0x58504e(0x102)](_0x54edfe=>{const _0x59943a=_0x58504e;console[_0x59943a(0x122)](_0x59943a(0x131),_0x54edfe);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on']('message',_0x5d4dfb=>{const _0x52aabe=_0x230798;if(serverWs&&serverWs['readyState']===WebSocket[_0x52aabe(0xa8)]){let _0x5cadb6=_0x5d4dfb[_0x52aabe(0x124)]();try{const _0x6a8818=JSON['parse'](_0x5cadb6);if(_0x6a8818['op']===_0x52aabe(0x12b)&&_0x6a8818['topic']){const _0x123464=topicManager[_0x52aabe(0x133)](_0x6a8818);switch(_0x123464['action']){case _0x52aabe(0xbb):return;case _0x52aabe(0x109):return;case _0x52aabe(0x126):default:_0x5cadb6=JSON['stringify'](_0x123464[_0x52aabe(0x158)]);break;}}if((_0x6a8818['op']==='service_response'||_0x6a8818['op']==='call_service')&&(_0x6a8818[_0x52aabe(0x117)]===_0x52aabe(0x13a)||_0x6a8818[_0x52aabe(0xd5)]&&_0x6a8818[_0x52aabe(0xd5)][_0x52aabe(0x121)])){console[_0x52aabe(0x11f)](_0x52aabe(0x13b));const _0x279606=_0x6a8818[_0x52aabe(0xd5)]?.[_0x52aabe(0x121)]||[],_0x2be99f=_0x6a8818[_0x52aabe(0xd5)]?.[_0x52aabe(0x151)]||[],_0x35d712=_0x279606[_0x52aabe(0xed)]((_0x38c493,_0x45ebf3)=>{const _0x331be8=_0x52aabe,_0x2c7bc5=topicManager[_0x331be8(0x11b)](_0x38c493);return{'name':_0x38c493,'type':_0x2be99f[_0x45ebf3]||_0x331be8(0x110),'throttling':_0x2c7bc5?{'isThrottled':_0x2c7bc5[_0x331be8(0x127)]==='sample','strategy':_0x2c7bc5['strategy'],'samplingRate':_0x2c7bc5[_0x331be8(0xb6)],'reason':_0x2c7bc5['reason'],'estimatedSize':_0x2c7bc5[_0x331be8(0x10b)]}:null};});_0x6a8818['values']={'topics':_0x35d712['map'](_0x35ea36=>_0x35ea36[_0x52aabe(0xff)]),'types':_0x35d712['map'](_0x14ba07=>_0x14ba07['type']),'throttling':_0x35d712[_0x52aabe(0xed)](_0xd9f2a0=>_0xd9f2a0[_0x52aabe(0x144)])},_0x5cadb6=JSON[_0x52aabe(0x118)](_0x6a8818),console[_0x52aabe(0x11f)]('[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client');}if(_0x6a8818['op']===_0x52aabe(0x12b)&&_0x6a8818['topic']==='/robot_description')try{const _0x3f7369=_0x6a8818['msg'][_0x52aabe(0x169)],_0x5c684e=rewriteUrdfMeshUris(_0x3f7369);_0x6a8818['msg'][_0x52aabe(0x169)]=_0x5c684e,_0x5cadb6=JSON[_0x52aabe(0x118)](_0x6a8818);}catch(_0x5b06cd){console[_0x52aabe(0x122)](_0x52aabe(0xfd),_0x5b06cd);}}catch(_0x54bc8c){console['warn']('[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:',_0x54bc8c[_0x52aabe(0x158)]);}serverWs[_0x52aabe(0x13e)](_0x5cadb6);}}),rosbridgeWs['on'](_0x230798(0x123),()=>{const _0xf724f6=_0x230798;console['log'](_0xf724f6(0xd1)),webrtcService[_0xf724f6(0x15b)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x230798(0x122),_0x2af628=>{const _0x39e5ed=_0x230798;console[_0x39e5ed(0x122)](_0x39e5ed(0x10d),_0x2af628);});}catch(_0x12d8ef){console[_0x230798(0x122)]('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):',_0x12d8ef),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x2d6f05=a1_0x4fd64b;try{rosbridgeWebRTCWs=new WebSocket(config[_0x2d6f05(0xe5)]['wsEndpoint']),rosbridgeWebRTCWs['on'](_0x2d6f05(0x137),()=>{const _0xcb2339=_0x2d6f05;console[_0xcb2339(0x11f)](_0xcb2339(0xf7)),webrtcService[_0xcb2339(0x132)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x2d6f05(0x158),_0x3fac33=>{}),rosbridgeWebRTCWs['on']('close',()=>{const _0x40b1c5=_0x2d6f05;console[_0x40b1c5(0x11f)]('Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x40b1c5(0x15b)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on']('error',_0x4a813e=>{const _0x31fe1b=_0x2d6f05;console['error'](_0x31fe1b(0xf4),_0x4a813e);});}catch(_0x38fc95){console['error'](_0x2d6f05(0x136),_0x38fc95),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x15b190=a1_0x4fd64b;try{if(!registrationToken)throw new Error(_0x15b190(0xbd));const _0xa16865=config[_0x15b190(0xdd)][_0x15b190(0xc5)](_0x15b190(0x142),'ws')+'/rosbridge?type=appliance&token='+registrationToken;serverWs=new WebSocket(_0xa16865),serverWs['on'](_0x15b190(0x137),()=>{const _0x1bd7b4=_0x15b190;console['log'](_0x1bd7b4(0xcb)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs['readyState']===WebSocket[_0x1bd7b4(0xa8)]&&webrtcService[_0x1bd7b4(0x132)](rosbridgeWebRTCWs,serverWs);}),serverWs['on']('message',_0x15a808=>{const _0x52e9eb=_0x15b190;if(rosbridgeWs&&rosbridgeWs[_0x52e9eb(0xf5)]===WebSocket[_0x52e9eb(0xa8)]){let _0x496a60=_0x15a808[_0x52e9eb(0x124)]();try{const _0x4af8e2=JSON['parse'](_0x496a60);if(webrtcService[_0x52e9eb(0x133)](_0x4af8e2))return;if(_0x4af8e2['op']===_0x52e9eb(0x130)&&typeof _0x4af8e2[_0x52e9eb(0xf1)]===_0x52e9eb(0xf2)&&_0x4af8e2[_0x52e9eb(0xaf)])try{console[_0x52e9eb(0x11f)](_0x52e9eb(0xc9)+_0x4af8e2['param_name']);const _0x369a7b=execSync(_0x52e9eb(0x100)+_0x4af8e2[_0x52e9eb(0xf1)],{'encoding':'utf8'})['trim']();let _0x304428=_0x369a7b;_0x369a7b['startsWith'](_0x52e9eb(0xcf))&&(_0x304428=_0x369a7b[_0x52e9eb(0xce)](_0x52e9eb(0xcf)[_0x52e9eb(0xe2)]()));_0x304428[_0x52e9eb(0xf3)]('\x22')&&_0x304428[_0x52e9eb(0xc7)]('\x22')&&(_0x304428=_0x304428[_0x52e9eb(0xd2)](0x1,-0x1));_0x304428=_0x304428[_0x52e9eb(0xc5)](/\\n/g,'\x0a')[_0x52e9eb(0xc5)](/\\"/g,'\x22');const _0xfc9f6={'op':'urdf_param_data','request_id':_0x4af8e2['request_id'],'data':_0x304428};serverWs[_0x52e9eb(0x13e)](JSON[_0x52e9eb(0x118)](_0xfc9f6)),console['log'](_0x52e9eb(0xec)+_0x4af8e2['param_name']);return;}catch(_0x195bd5){console[_0x52e9eb(0x122)]('[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:',_0x195bd5);const _0x406686={'op':_0x52e9eb(0x107),'request_id':_0x4af8e2[_0x52e9eb(0xaf)],'error':_0x195bd5[_0x52e9eb(0x158)]};serverWs[_0x52e9eb(0x13e)](JSON[_0x52e9eb(0x118)](_0x406686));return;}if(_0x4af8e2['op']===_0x52e9eb(0xb0)&&typeof _0x4af8e2[_0x52e9eb(0xe8)]===_0x52e9eb(0xf2)&&_0x4af8e2[_0x52e9eb(0xaf)])try{const _0x426ab9=_0x4af8e2[_0x52e9eb(0xe8)][_0x52e9eb(0x128)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x426ab9){const _0x16f5dc=_0x426ab9[0x1],_0x285447=_0x426ab9[0x2],_0x499935=execSync(_0x52e9eb(0x139)+_0x16f5dc,{'encoding':'utf8'})[_0x52e9eb(0x145)](),_0x16dd64=path[_0x52e9eb(0x147)](_0x499935,_0x52e9eb(0x164),_0x16f5dc,_0x285447);if(!fs['existsSync'](_0x16dd64))throw new Error(_0x52e9eb(0x101)+_0x16dd64);const _0x1d4920=fs[_0x52e9eb(0xca)](_0x16dd64),_0x1be9f4={'op':_0x52e9eb(0x15a),'request_id':_0x4af8e2[_0x52e9eb(0xaf)],'data':_0x1d4920[_0x52e9eb(0x124)](_0x52e9eb(0xee))};serverWs[_0x52e9eb(0x13e)](JSON['stringify'](_0x1be9f4)),console[_0x52e9eb(0x11f)](_0x52e9eb(0x156)+_0x4af8e2[_0x52e9eb(0xe8)]+'\x20from\x20'+_0x16dd64);return;}}catch(_0x3e4169){console[_0x52e9eb(0x122)](_0x52e9eb(0x166),_0x3e4169);const _0x4477f9={'op':_0x52e9eb(0x15a),'request_id':_0x4af8e2['request_id'],'error':_0x3e4169[_0x52e9eb(0x158)]};serverWs['send'](JSON[_0x52e9eb(0x118)](_0x4477f9));return;}rosbridgeWs['send'](_0x496a60);}catch(_0x574b14){rosbridgeWs['send'](_0x496a60);}}}),serverWs['on'](_0x15b190(0x123),(_0x5208fd,_0x233200)=>{const _0x50dc5c=_0x15b190;console['log'](_0x50dc5c(0x125)+_0x5208fd+':\x20'+_0x233200+_0x50dc5c(0xe1)),webrtcService[_0x50dc5c(0x15b)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x15b190(0x122),_0x430ebd=>{const _0x4ed33d=_0x15b190;console[_0x4ed33d(0x122)](_0x4ed33d(0xe3),_0x430ebd);});}catch(_0x25e8cb){console[_0x15b190(0x122)](_0x15b190(0xc0),_0x25e8cb),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x5e1d64,_0x54b689,_0x328243)=>{const _0x54ccf3=a1_0x4fd64b;if(!authService['isAuthenticated']()){console[_0x54ccf3(0x11f)](_0x54ccf3(0xad),config['serverUrl']);const _0x45a919=await authService[_0x54ccf3(0x140)]();if(!_0x45a919)return _0x54b689[_0x54ccf3(0x12d)](0x191)[_0x54ccf3(0x159)]({'error':_0x54ccf3(0xbf)});}_0x328243();};app[a1_0x4fd64b(0xcd)]((_0x3a9206,_0x2f5079,_0x9b92ad)=>{const _0x5c2dbe=a1_0x4fd64b;_0x2f5079['header']('Access-Control-Allow-Origin','*'),_0x2f5079[_0x5c2dbe(0xb2)](_0x5c2dbe(0xdb),'GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS'),_0x2f5079[_0x5c2dbe(0xb2)](_0x5c2dbe(0x114),_0x5c2dbe(0x167)),_0x3a9206['method']===_0x5c2dbe(0x113)?_0x2f5079[_0x5c2dbe(0xe0)](0xc8):_0x9b92ad();}),app[a1_0x4fd64b(0xd6)]('/',requireAuth,(_0x941353,_0x493474)=>{const _0x199e62=a1_0x4fd64b;_0x493474[_0x199e62(0x13e)]('Appliance\x20is\x20running\x20and\x20authenticated!');}),app[a1_0x4fd64b(0xd6)](a1_0x4fd64b(0x10c),async(_0x39b2b6,_0x14fa89)=>{const _0x1079ea=a1_0x4fd64b,_0x444c7a=authService[_0x1079ea(0xc2)](),_0x403715=webrtcService[_0x1079ea(0xbc)](),_0x19af07=webrtcService[_0x1079ea(0xba)](),_0x5dbe12=topicManager[_0x1079ea(0xc6)]();_0x14fa89['json']({'status':'ok','environment':process[_0x1079ea(0x157)][_0x1079ea(0xe9)]||'development','backendUrl':config[_0x1079ea(0xdd)],'rosbridgeUrl':config[_0x1079ea(0xe5)][_0x1079ea(0xf0)],'proxyPort':port,'authenticated':_0x444c7a,'topicManagement':{'discovered':_0x5dbe12[_0x1079ea(0x163)],'strategies':_0x5dbe12[_0x1079ea(0x13c)],'largeDataTopics':_0x5dbe12['largeDataTopics'][_0x1079ea(0xe2)],'largeTopicsList':_0x5dbe12[_0x1079ea(0xe6)]},'webrtc':{'activeSessions':_0x403715[_0x1079ea(0xe2)],'sharedVideoSources':_0x19af07['length'],'sessions':_0x403715,'sharedSources':_0x19af07}});});function a1_0x116e(_0x166b14,_0x477226){const _0x14894d=a1_0x589d();return a1_0x116e=function(_0x4a2cf3,_0xdf14bb){_0x4a2cf3=_0x4a2cf3-0xa8;let _0x589d71=_0x14894d[_0x4a2cf3];return _0x589d71;},a1_0x116e(_0x166b14,_0x477226);}const getInitialPort=()=>{const _0x525e67=a1_0x4fd64b;if(process[_0x525e67(0x157)][_0x525e67(0x10e)])return parseInt(process['env']['PORT'],0xa);return config[_0x525e67(0xe5)]['proxyPort'];};async function listenWithRetries(_0x11979b,_0x1ba28c,_0x3d1493=0xa){const _0x352848=a1_0x4fd64b;let _0x17009e=_0x1ba28c;for(let _0x1081fe=0x1;_0x1081fe<=_0x3d1493;_0x1081fe++){try{return await new Promise((_0x5be2c1,_0x541769)=>{const _0x1e7974=a1_0x116e,_0x52ccec=_0x11979b['listen'](_0x17009e,()=>{const _0x655727=a1_0x116e;console['log'](_0x655727(0xaa)+_0x17009e),_0x5be2c1(_0x52ccec);});_0x52ccec['on'](_0x1e7974(0x122),_0x1fe9b6=>{const _0x1d6f08=_0x1e7974;_0x1fe9b6[_0x1d6f08(0x11e)]===_0x1d6f08(0x165)?(console[_0x1d6f08(0x14a)]('Port\x20'+_0x17009e+_0x1d6f08(0xb3)),_0x541769(_0x1fe9b6)):_0x541769(_0x1fe9b6);});}),_0x17009e;}catch(_0x43618d){_0x17009e++;}}throw new Error(_0x352848(0x11a)+_0x3d1493+_0x352848(0xd3)+_0x1ba28c);}const startApp=async()=>{const _0x2ba36e=a1_0x4fd64b;try{let _0x1662f1=await authService['login']();while(!_0x1662f1){console[_0x2ba36e(0x11f)](_0x2ba36e(0xfc)),await promptForCredentials(),_0x1662f1=await authService['login']();}console[_0x2ba36e(0x11f)]('Successfully\x20logged\x20in');!loadApplianceIdentity()&&console['log'](_0x2ba36e(0xda));console[_0x2ba36e(0x11f)](_0x2ba36e(0xea));const _0x13297d=await registerWithServer();if(!_0x13297d)throw new Error(_0x2ba36e(0x16a));connectToRosbridge(),connectToServer();const _0x4b40bf=getInitialPort();await listenWithRetries(app,_0x4b40bf,0xa);}catch(_0xa235ce){console[_0x2ba36e(0x122)](_0x2ba36e(0xfe),_0xa235ce),process['exit'](0x1);}};setInterval(async()=>{const _0x355182=a1_0x4fd64b;try{if(robotId){const _0x3a33a2=authService[_0x355182(0xd4)]();await axios[_0x355182(0x14b)](config[_0x355182(0xdd)]+'/appliance/ping',{'robotId':robotId},{'headers':{'Authorization':_0x355182(0x129)+_0x3a33a2,'Content-Type':'application/json'}});}}catch(_0x1139cb){console[_0x355182(0x122)](_0x355182(0x160),_0x1139cb[_0x355182(0x158)]);}},0x1388),startApp();