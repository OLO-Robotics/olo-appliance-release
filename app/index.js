const a1_0x3cee72=a1_0x4180;(function(_0x106b15,_0x1e69ea){const _0x39cbb6=a1_0x4180,_0x1d6243=_0x106b15();while(!![]){try{const _0x1ba8e8=parseInt(_0x39cbb6(0x207))/0x1*(parseInt(_0x39cbb6(0x1b9))/0x2)+-parseInt(_0x39cbb6(0x233))/0x3+parseInt(_0x39cbb6(0x22f))/0x4+-parseInt(_0x39cbb6(0x1b0))/0x5+parseInt(_0x39cbb6(0x1fc))/0x6+parseInt(_0x39cbb6(0x1e0))/0x7+-parseInt(_0x39cbb6(0x201))/0x8*(parseInt(_0x39cbb6(0x188))/0x9);if(_0x1ba8e8===_0x1e69ea)break;else _0x1d6243['push'](_0x1d6243['shift']());}catch(_0x597ddb){_0x1d6243['push'](_0x1d6243['shift']());}}}(a1_0xa17c,0xbf654));const a1_0x5e2bf2=(function(){let _0x3efa8b=!![];return function(_0x5d24e6,_0x597d28){const _0x29422f=_0x3efa8b?function(){const _0x4c8163=a1_0x4180;if(_0x597d28){const _0x55eebf=_0x597d28[_0x4c8163(0x1f1)](_0x5d24e6,arguments);return _0x597d28=null,_0x55eebf;}}:function(){};return _0x3efa8b=![],_0x29422f;};}()),a1_0x170bb3=a1_0x5e2bf2(this,function(){const _0x1a00b3=a1_0x4180;return a1_0x170bb3[_0x1a00b3(0x1be)]()['search'](_0x1a00b3(0x217))[_0x1a00b3(0x1be)]()['constructor'](a1_0x170bb3)[_0x1a00b3(0x1b3)]('(((.+)+)+)+$');});a1_0x170bb3();const express=require(a1_0x3cee72(0x1d4)),config=require('./config'),authService=require(a1_0x3cee72(0x19c)),webrtcService=require('./services/webrtcService'),topicManager=require(a1_0x3cee72(0x1a8)),WebSocket=require('ws'),axios=require('axios'),fs=require('fs'),prompt=require('prompt-sync')({'sigint':!![]}),dotenv=require('dotenv'),app=express(),port=process[a1_0x3cee72(0x205)][a1_0x3cee72(0x21a)]||config[a1_0x3cee72(0x1f8)]['proxyPort'],APPLIANCE_FILE=a1_0x3cee72(0x1eb),{DOMParser,XMLSerializer}=require('xmldom'),path=require('path'),{execSync}=require('child_process'),APPLIANCE_BASE_URL=process[a1_0x3cee72(0x205)][a1_0x3cee72(0x1c7)]||'';console[a1_0x3cee72(0x235)](a1_0x3cee72(0x1cd)+(process[a1_0x3cee72(0x205)][a1_0x3cee72(0x1fd)]||a1_0x3cee72(0x224))),console[a1_0x3cee72(0x235)](a1_0x3cee72(0x1c5)+config[a1_0x3cee72(0x1f4)]),console[a1_0x3cee72(0x235)]('ROSBridge\x20WebSocket\x20URL:\x20'+config[a1_0x3cee72(0x1f8)][a1_0x3cee72(0x239)]),console[a1_0x3cee72(0x235)](a1_0x3cee72(0x1a1)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x39a51c,_0x70c1cd){const _0x18daff=a1_0x3cee72;fs[_0x18daff(0x196)](_0x18daff(0x227),_0x18daff(0x1c1)+_0x39a51c+_0x18daff(0x212)+_0x70c1cd+'\x0a');}function reloadEnv(){const _0x31e5dc=a1_0x3cee72;dotenv[_0x31e5dc(0x1d0)]({'override':!![]}),config[_0x31e5dc(0x1fe)]['username']=process[_0x31e5dc(0x205)]['APP_USERNAME'],config['credentials'][_0x31e5dc(0x203)]=process[_0x31e5dc(0x205)][_0x31e5dc(0x1dd)];}async function promptForCredentials(){const _0xfc2c7f=a1_0x3cee72,_0x35a3d7=prompt(_0xfc2c7f(0x19a)),_0x4e56c4=prompt[_0xfc2c7f(0x1e6)](_0xfc2c7f(0x214));updateEnvFile(_0x35a3d7,_0x4e56c4),reloadEnv();}function loadApplianceIdentity(){const _0x350c7b=a1_0x3cee72;if(fs[_0x350c7b(0x1f7)](APPLIANCE_FILE))try{const _0x4b5b66=JSON['parse'](fs['readFileSync'](APPLIANCE_FILE,_0x350c7b(0x1b8)));if(_0x4b5b66['robotId']&&_0x4b5b66[_0x350c7b(0x1db)])return robotId=_0x4b5b66[_0x350c7b(0x192)],registrationToken=_0x4b5b66[_0x350c7b(0x1db)],console['log']('Loaded\x20appliance\x20identity:',robotId),topicManager['loadConfig'](_0x4b5b66),!![];}catch(_0x348192){console[_0x350c7b(0x1e8)](_0x350c7b(0x20f),_0x348192);}return![];}function saveApplianceIdentity(_0x3e637c,_0x31cd2a){const _0x2ffd04=a1_0x3cee72;let _0x1b68d9={};if(fs[_0x2ffd04(0x1f7)](APPLIANCE_FILE))try{_0x1b68d9=JSON[_0x2ffd04(0x222)](fs['readFileSync'](APPLIANCE_FILE,_0x2ffd04(0x1b8)));}catch(_0x20c328){_0x1b68d9={};}_0x1b68d9[_0x2ffd04(0x192)]=_0x3e637c,_0x1b68d9[_0x2ffd04(0x1db)]=_0x31cd2a,fs[_0x2ffd04(0x196)](APPLIANCE_FILE,JSON[_0x2ffd04(0x1c2)](_0x1b68d9,null,0x2));}async function registerWithServer(){const _0x299d48=a1_0x3cee72;try{const _0x562c2e=authService[_0x299d48(0x18a)]();if(!_0x562c2e)throw new Error('Not\x20authenticated');let _0x449aee,_0x269e11=![];while(!![]){try{robotId&&registrationToken?_0x449aee=await axios[_0x299d48(0x1b1)](config['serverUrl']+_0x299d48(0x18d),{'name':'WSL\x20Appliance','robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x299d48(0x20c)+_0x562c2e,'Content-Type':_0x299d48(0x1c4)}}):_0x449aee=await axios[_0x299d48(0x1b1)](config['serverUrl']+_0x299d48(0x18d),{'name':_0x299d48(0x1d1)},{'headers':{'Authorization':_0x299d48(0x20c)+_0x562c2e,'Content-Type':_0x299d48(0x1c4)}});break;}catch(_0x17bc5d){const _0x473868=_0x17bc5d?.['response']?.[_0x299d48(0x19d)]?.['error']||_0x17bc5d[_0x299d48(0x1af)];if(!_0x269e11&&_0x473868&&_0x473868[_0x299d48(0x20d)]()['includes'](_0x299d48(0x1ac))){console['warn'](_0x299d48(0x193));if(fs['existsSync'](APPLIANCE_FILE))fs[_0x299d48(0x1b4)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x269e11=!![];continue;}throw _0x17bc5d;}}if(!_0x449aee['data']||!_0x449aee[_0x299d48(0x19d)][_0x299d48(0x208)]||!_0x449aee['data']['id'])throw new Error('Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server');return registrationToken=_0x449aee['data']['registration_token'],robotId=_0x449aee[_0x299d48(0x19d)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x299d48(0x235)]('Successfully\x20registered\x20with\x20server'),!![];}catch(_0x503bdc){return console[_0x299d48(0x1e8)](_0x299d48(0x220),_0x503bdc[_0x299d48(0x1af)]),![];}}function rewriteUrdfMeshUris(_0x45720a){const _0x585b41=a1_0x3cee72;try{const _0x20d326=new DOMParser(),_0x500644=_0x20d326[_0x585b41(0x226)](_0x45720a,_0x585b41(0x1c3));let _0x3921c8=0x0,_0x3b4a03=0x0;const _0x13c770=_0x500644[_0x585b41(0x231)](_0x585b41(0x21c));for(let _0x5d387d=0x0;_0x5d387d<_0x13c770[_0x585b41(0x22e)];_0x5d387d++){const _0xc5d77a=_0x13c770[_0x5d387d],_0x1158d2=_0xc5d77a['getAttribute'](_0x585b41(0x1f2)),_0x5a28c0=[_0x585b41(0x209),_0x585b41(0x22d),_0x585b41(0x1df),_0x585b41(0x206),_0x585b41(0x21f)],_0x2accef=_0x5a28c0[_0x585b41(0x1b5)](_0x13b335=>_0x1158d2['toLowerCase']()['endsWith'](_0x13b335));if(_0x1158d2&&_0x1158d2[_0x585b41(0x218)]('package://')&&_0x2accef){_0x3921c8++;const _0x34ab52=APPLIANCE_BASE_URL+'/ros/mesh?uri='+encodeURIComponent(_0x1158d2);_0xc5d77a[_0x585b41(0x1a2)](_0x585b41(0x1f2),_0x34ab52),_0x3b4a03++,console['log'](_0x585b41(0x204)+_0x1158d2+_0x585b41(0x200)+_0x34ab52);}}_0x3921c8>0x0?console[_0x585b41(0x235)](_0x585b41(0x18f)+_0x3b4a03+_0x585b41(0x21e)+_0x3921c8+_0x585b41(0x1e3)):console[_0x585b41(0x235)]('[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF');const _0x34a5ba=new XMLSerializer();return _0x34a5ba['serializeToString'](_0x500644);}catch(_0x10d494){return console[_0x585b41(0x1e8)]('[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):',_0x10d494),_0x45720a;}}function a1_0xa17c(){const _0xa2d3de=['urdf_param_data','117zpqTFx','EADDRINUSE','getToken','map','/health','/appliance/register','throttling','[URDF\x20REWRITE]\x20Rewrote\x20','share','type','robotId','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','isAuthenticated','slice','writeFileSync','send','strategies','ros2\x20param\x20get\x20','Enter\x20username:\x20','reason','./services/auth','data','topics','[MESH]\x20Error\x20serving\x20mesh:','Connected\x20to\x20ROSBridge\x20(WebRTC)','Proxy\x20listening\x20on\x20port:\x20','setAttribute','login','json','trim','param_name','string','./services/TopicManager','Failed\x20to\x20register\x20with\x20server','listen','/appliance/ping','robot\x20not\x20found','call_service','endsWith','message','7802380XcXkRE','post','catch','search','unlinkSync','some','samplingRate','sample_skip','utf8','2380376GuuPLB','estimatedSize','Mesh\x20file\x20not\x20found:\x20','initialize','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','toString','code','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','APP_USERNAME=','stringify','text/xml','application/json','Backend\x20Server\x20URL:\x20','action','APPLIANCE_BASE_URL','Disconnected\x20from\x20server\x20(','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','match','Topic\x20discovery\x20failed:','getStatistics','Environment:\x20','discoverTopics','name','config','WSL\x20Appliance','OPEN','open','express','header','getActiveSessions','substring','get_mesh','Access-Control-Allow-Methods','Successfully\x20logged\x20in','registrationToken','mesh_data','APP_PASSWORD','/rosbridge?type=appliance&token=','.obj','5968179SjdIaT','Access-Control-Allow-Headers','strategy','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','msg','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','hide','Failed\x20to\x20start\x20application:','error','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','request_id','.appliance.json','getTopicStrategy','Ros','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','join','apply','filename','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','serverUrl','exit','uri','existsSync','rosbridge','\x20in\x20use,\x20trying\x20next\x20port...','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','webrtc_skip','9075600VLPDZf','NODE_ENV','credentials','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','\x20->\x20','940408HIuIkx','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','password','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','env','.ply','1eNaiXh','registration_token','.stl','close','/rosapi/topics','Bearer\x20','toLowerCase','sample','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','ros2\x20pkg\x20prefix\x20','readyState','\x0aAPP_PASSWORD=','topic','Enter\x20password:\x20','Authentication\x20required','values','(((.+)+)+)+$','startsWith','publish','PORT','connection','mesh','Connected\x20to\x20server','\x20of\x20','.mesh','Failed\x20to\x20register\x20with\x20server:','http','parse','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','development','method','parseFromString','.env','Server\x20connection\x20error:','get','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','forward','\x20attempts\x20starting\x20from\x20','.dae','length','1463496aTWrWp','totalTopics','getElementsByTagName','stopAllSessions','145992DEdupL','sendStatus','log','warn','OPTIONS','replace','wsEndpoint','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','Failed\x20to\x20connect\x20to\x20server:','base64'];a1_0xa17c=function(){return _0xa2d3de;};return a1_0xa17c();}function connectToRosbridge(){const _0x2b130e=a1_0x3cee72;try{rosbridgeWs=new WebSocket(config['rosbridge'][_0x2b130e(0x239)]),rosbridgeWs['on'](_0x2b130e(0x1d3),()=>{const _0x51f8e8=_0x2b130e;console[_0x51f8e8(0x235)]('Connected\x20to\x20ROSBridge\x20(main)');const _0x39ae91=require('roslib'),_0x1ed51b=new _0x39ae91[(_0x51f8e8(0x1ed))]({'url':config[_0x51f8e8(0x1f8)][_0x51f8e8(0x239)]});_0x1ed51b['on'](_0x51f8e8(0x21b),()=>{setTimeout(()=>{const _0x46548d=a1_0x4180;topicManager[_0x46548d(0x1ce)](_0x1ed51b)[_0x46548d(0x1b2)](_0x2ddfb9=>{const _0x480689=_0x46548d;console[_0x480689(0x1e8)](_0x480689(0x1cb),_0x2ddfb9);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x2b130e(0x1af),_0x23f282=>{const _0x7293a=_0x2b130e;if(serverWs&&serverWs[_0x7293a(0x211)]===WebSocket[_0x7293a(0x1d2)]){let _0xc8ece5=_0x23f282['toString']();try{const _0xf6eaed=JSON[_0x7293a(0x222)](_0xc8ece5);if(_0xf6eaed['op']===_0x7293a(0x219)&&_0xf6eaed['topic']){const _0x37d69d=topicManager['handleMessage'](_0xf6eaed);switch(_0x37d69d[_0x7293a(0x1c6)]){case _0x7293a(0x1b7):return;case _0x7293a(0x1fb):return;case _0x7293a(0x22b):default:_0xc8ece5=JSON['stringify'](_0x37d69d[_0x7293a(0x1af)]);break;}}if((_0xf6eaed['op']==='service_response'||_0xf6eaed['op']===_0x7293a(0x1ad))&&(_0xf6eaed['service']===_0x7293a(0x20b)||_0xf6eaed[_0x7293a(0x216)]&&_0xf6eaed['values']['topics'])){console[_0x7293a(0x235)]('[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata');const _0x31072c=_0xf6eaed['values']?.[_0x7293a(0x19e)]||[],_0x155b1b=_0xf6eaed[_0x7293a(0x216)]?.['types']||[],_0x32242f=_0x31072c[_0x7293a(0x18b)]((_0x3037d2,_0x2ac0ce)=>{const _0x36a144=_0x7293a,_0x5d9d77=topicManager[_0x36a144(0x1ec)](_0x3037d2);return{'name':_0x3037d2,'type':_0x155b1b[_0x2ac0ce]||'unknown','throttling':_0x5d9d77?{'isThrottled':_0x5d9d77['strategy']===_0x36a144(0x20e),'strategy':_0x5d9d77[_0x36a144(0x1e2)],'samplingRate':_0x5d9d77[_0x36a144(0x1b6)],'reason':_0x5d9d77[_0x36a144(0x19b)],'estimatedSize':_0x5d9d77[_0x36a144(0x1ba)]}:null};});_0xf6eaed[_0x7293a(0x216)]={'topics':_0x32242f[_0x7293a(0x18b)](_0x5b2b51=>_0x5b2b51[_0x7293a(0x1cf)]),'types':_0x32242f[_0x7293a(0x18b)](_0x3aa721=>_0x3aa721[_0x7293a(0x191)]),'throttling':_0x32242f[_0x7293a(0x18b)](_0xfbe211=>_0xfbe211[_0x7293a(0x18e)])},_0xc8ece5=JSON[_0x7293a(0x1c2)](_0xf6eaed),console[_0x7293a(0x235)]('[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client');}if(_0xf6eaed['op']===_0x7293a(0x219)&&_0xf6eaed[_0x7293a(0x213)]==='/robot_description')try{const _0x528466=_0xf6eaed[_0x7293a(0x1e4)][_0x7293a(0x19d)],_0x345cb0=rewriteUrdfMeshUris(_0x528466);_0xf6eaed[_0x7293a(0x1e4)]['data']=_0x345cb0,_0xc8ece5=JSON[_0x7293a(0x1c2)](_0xf6eaed);}catch(_0x15b00b){console[_0x7293a(0x1e8)](_0x7293a(0x1ee),_0x15b00b);}}catch(_0x5ced9c){console[_0x7293a(0x236)](_0x7293a(0x1e5),_0x5ced9c['message']);}serverWs[_0x7293a(0x197)](_0xc8ece5);}}),rosbridgeWs['on'](_0x2b130e(0x20a),()=>{const _0x132901=_0x2b130e;console[_0x132901(0x235)](_0x132901(0x223)),webrtcService[_0x132901(0x232)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x2b130e(0x1e8),_0x229ba7=>{const _0x19cc41=_0x2b130e;console[_0x19cc41(0x1e8)]('ROSBridge\x20(main)\x20connection\x20error:',_0x229ba7);});}catch(_0xc411d){console[_0x2b130e(0x1e8)]('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):',_0xc411d),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x3ed12f=a1_0x3cee72;try{rosbridgeWebRTCWs=new WebSocket(config[_0x3ed12f(0x1f8)][_0x3ed12f(0x239)]),rosbridgeWebRTCWs['on'](_0x3ed12f(0x1d3),()=>{const _0x2f62ca=_0x3ed12f;console[_0x2f62ca(0x235)](_0x2f62ca(0x1a0)),webrtcService[_0x2f62ca(0x1bc)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x3ed12f(0x1af),_0x341ff3=>{}),rosbridgeWebRTCWs['on'](_0x3ed12f(0x20a),()=>{const _0x4e4831=_0x3ed12f;console[_0x4e4831(0x235)](_0x4e4831(0x1fa)),webrtcService['stopAllSessions'](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on']('error',_0x1842d5=>{console['error']('ROSBridge\x20(WebRTC)\x20connection\x20error:',_0x1842d5);});}catch(_0x57c767){console[_0x3ed12f(0x1e8)](_0x3ed12f(0x1ef),_0x57c767),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x418585=a1_0x3cee72;try{if(!registrationToken)throw new Error(_0x418585(0x1e9));const _0x90721f=config[_0x418585(0x1f4)]['replace'](_0x418585(0x221),'ws')+_0x418585(0x1de)+registrationToken;serverWs=new WebSocket(_0x90721f),serverWs['on']('open',()=>{const _0x42d563=_0x418585;console[_0x42d563(0x235)](_0x42d563(0x21d)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs['readyState']===WebSocket[_0x42d563(0x1d2)]&&webrtcService[_0x42d563(0x1bc)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x418585(0x1af),_0xe4479c=>{const _0xbab5b4=_0x418585;if(rosbridgeWs&&rosbridgeWs['readyState']===WebSocket[_0xbab5b4(0x1d2)]){let _0x5e1ce5=_0xe4479c['toString']();try{const _0x21f17e=JSON[_0xbab5b4(0x222)](_0x5e1ce5);if(webrtcService['handleMessage'](_0x21f17e))return;if(_0x21f17e['op']==='get_urdf_param'&&typeof _0x21f17e[_0xbab5b4(0x1a6)]===_0xbab5b4(0x1a7)&&_0x21f17e[_0xbab5b4(0x1ea)])try{console['log'](_0xbab5b4(0x1ff)+_0x21f17e[_0xbab5b4(0x1a6)]);const _0xdcde82=execSync(_0xbab5b4(0x199)+_0x21f17e[_0xbab5b4(0x1a6)],{'encoding':'utf8'})[_0xbab5b4(0x1a5)]();let _0x226dca=_0xdcde82;_0xdcde82[_0xbab5b4(0x218)]('String\x20value\x20is:\x20')&&(_0x226dca=_0xdcde82[_0xbab5b4(0x1d7)]('String\x20value\x20is:\x20'[_0xbab5b4(0x22e)]()));_0x226dca['startsWith']('\x22')&&_0x226dca[_0xbab5b4(0x1ae)]('\x22')&&(_0x226dca=_0x226dca[_0xbab5b4(0x195)](0x1,-0x1));_0x226dca=_0x226dca['replace'](/\\n/g,'\x0a')[_0xbab5b4(0x238)](/\\"/g,'\x22');const _0x3fcf73={'op':_0xbab5b4(0x187),'request_id':_0x21f17e[_0xbab5b4(0x1ea)],'data':_0x226dca};serverWs[_0xbab5b4(0x197)](JSON[_0xbab5b4(0x1c2)](_0x3fcf73)),console[_0xbab5b4(0x235)](_0xbab5b4(0x202)+_0x21f17e[_0xbab5b4(0x1a6)]);return;}catch(_0x2f5df0){console[_0xbab5b4(0x1e8)](_0xbab5b4(0x1bd),_0x2f5df0);const _0x20ff9a={'op':_0xbab5b4(0x187),'request_id':_0x21f17e[_0xbab5b4(0x1ea)],'error':_0x2f5df0[_0xbab5b4(0x1af)]};serverWs[_0xbab5b4(0x197)](JSON[_0xbab5b4(0x1c2)](_0x20ff9a));return;}if(_0x21f17e['op']===_0xbab5b4(0x1d8)&&typeof _0x21f17e[_0xbab5b4(0x1f6)]===_0xbab5b4(0x1a7)&&_0x21f17e[_0xbab5b4(0x1ea)])try{const _0x50a144=_0x21f17e[_0xbab5b4(0x1f6)][_0xbab5b4(0x1ca)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x50a144){const _0x52cb93=_0x50a144[0x1],_0x18f8ba=_0x50a144[0x2],_0x101342=execSync(_0xbab5b4(0x210)+_0x52cb93,{'encoding':'utf8'})[_0xbab5b4(0x1a5)](),_0x43e6fb=path[_0xbab5b4(0x1f0)](_0x101342,_0xbab5b4(0x190),_0x52cb93,_0x18f8ba);if(!fs[_0xbab5b4(0x1f7)](_0x43e6fb))throw new Error(_0xbab5b4(0x1bb)+_0x43e6fb);const _0x4af814=fs['readFileSync'](_0x43e6fb),_0x15ea2c={'op':_0xbab5b4(0x1dc),'request_id':_0x21f17e[_0xbab5b4(0x1ea)],'data':_0x4af814['toString'](_0xbab5b4(0x186))};serverWs[_0xbab5b4(0x197)](JSON[_0xbab5b4(0x1c2)](_0x15ea2c)),console[_0xbab5b4(0x235)]('[MESH]\x20Successfully\x20served\x20mesh:\x20'+_0x21f17e[_0xbab5b4(0x1f6)]+'\x20from\x20'+_0x43e6fb);return;}}catch(_0x41c942){console[_0xbab5b4(0x1e8)](_0xbab5b4(0x19f),_0x41c942);const _0xa345aa={'op':_0xbab5b4(0x1dc),'request_id':_0x21f17e[_0xbab5b4(0x1ea)],'error':_0x41c942[_0xbab5b4(0x1af)]};serverWs[_0xbab5b4(0x197)](JSON[_0xbab5b4(0x1c2)](_0xa345aa));return;}rosbridgeWs['send'](_0x5e1ce5);}catch(_0x299963){rosbridgeWs[_0xbab5b4(0x197)](_0x5e1ce5);}}}),serverWs['on'](_0x418585(0x20a),(_0x2f9477,_0x45a5d6)=>{const _0x418eb6=_0x418585;console[_0x418eb6(0x235)](_0x418eb6(0x1c8)+_0x2f9477+':\x20'+_0x45a5d6+'),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x418eb6(0x232)](),setTimeout(connectToServer,0x1388);}),serverWs['on']('error',_0x47ca54=>{const _0x298605=_0x418585;console[_0x298605(0x1e8)](_0x298605(0x228),_0x47ca54);});}catch(_0x305f5e){console[_0x418585(0x1e8)](_0x418585(0x185),_0x305f5e),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x4d5730,_0x534b53,_0x3c86c3)=>{const _0x36c857=a1_0x3cee72;if(!authService['isAuthenticated']()){console['log']('Attempting\x20to\x20login\x20to:',config[_0x36c857(0x1f4)]);const _0x44a85d=await authService[_0x36c857(0x1a3)]();if(!_0x44a85d)return _0x534b53['status'](0x191)[_0x36c857(0x1a4)]({'error':_0x36c857(0x215)});}_0x3c86c3();};app['use']((_0x486c74,_0xd3f3d6,_0x3ff65e)=>{const _0xb44d22=a1_0x3cee72;_0xd3f3d6[_0xb44d22(0x1d5)]('Access-Control-Allow-Origin','*'),_0xd3f3d6[_0xb44d22(0x1d5)](_0xb44d22(0x1d9),'GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS'),_0xd3f3d6[_0xb44d22(0x1d5)](_0xb44d22(0x1e1),_0xb44d22(0x184)),_0x486c74[_0xb44d22(0x225)]===_0xb44d22(0x237)?_0xd3f3d6[_0xb44d22(0x234)](0xc8):_0x3ff65e();}),app['get']('/',requireAuth,(_0x524c45,_0x142da9)=>{const _0x45318d=a1_0x3cee72;_0x142da9[_0x45318d(0x197)]('Appliance\x20is\x20running\x20and\x20authenticated!');}),app[a1_0x3cee72(0x229)](a1_0x3cee72(0x18c),async(_0x4ef05c,_0x29bcc3)=>{const _0xe6bfa7=a1_0x3cee72,_0x5a90bb=authService[_0xe6bfa7(0x194)](),_0x5adc4c=webrtcService[_0xe6bfa7(0x1d6)](),_0x41ab93=webrtcService['getSharedVideoSources'](),_0x3bb602=topicManager[_0xe6bfa7(0x1cc)]();_0x29bcc3['json']({'status':'ok','environment':process[_0xe6bfa7(0x205)]['NODE_ENV']||_0xe6bfa7(0x224),'backendUrl':config[_0xe6bfa7(0x1f4)],'rosbridgeUrl':config[_0xe6bfa7(0x1f8)][_0xe6bfa7(0x239)],'proxyPort':port,'authenticated':_0x5a90bb,'topicManagement':{'discovered':_0x3bb602[_0xe6bfa7(0x230)],'strategies':_0x3bb602[_0xe6bfa7(0x198)],'largeDataTopics':_0x3bb602['largeDataTopics']['length'],'largeTopicsList':_0x3bb602['largeDataTopics']},'webrtc':{'activeSessions':_0x5adc4c[_0xe6bfa7(0x22e)],'sharedVideoSources':_0x41ab93[_0xe6bfa7(0x22e)],'sessions':_0x5adc4c,'sharedSources':_0x41ab93}});});const getInitialPort=()=>{const _0x1d2a0a=a1_0x3cee72;if(process['env']['PORT'])return parseInt(process[_0x1d2a0a(0x205)][_0x1d2a0a(0x21a)],0xa);return config[_0x1d2a0a(0x1f8)]['proxyPort'];};async function listenWithRetries(_0x370a82,_0x5beaa3,_0x4dacc7=0xa){const _0x56d8c0=a1_0x3cee72;let _0x53d259=_0x5beaa3;for(let _0xd0b52=0x1;_0xd0b52<=_0x4dacc7;_0xd0b52++){try{return await new Promise((_0x496b6b,_0x4c2ca6)=>{const _0x4eae9c=a1_0x4180,_0x2f3100=_0x370a82[_0x4eae9c(0x1aa)](_0x53d259,()=>{const _0x416341=_0x4eae9c;console[_0x416341(0x235)](_0x416341(0x1f3)+_0x53d259),_0x496b6b(_0x2f3100);});_0x2f3100['on']('error',_0x29d0d8=>{const _0x150106=_0x4eae9c;_0x29d0d8[_0x150106(0x1bf)]===_0x150106(0x189)?(console[_0x150106(0x236)]('Port\x20'+_0x53d259+_0x150106(0x1f9)),_0x4c2ca6(_0x29d0d8)):_0x4c2ca6(_0x29d0d8);});}),_0x53d259;}catch(_0x156a35){_0x53d259++;}}throw new Error(_0x56d8c0(0x1c9)+_0x4dacc7+_0x56d8c0(0x22c)+_0x5beaa3);}const startApp=async()=>{const _0x54c59f=a1_0x3cee72;try{let _0x367d92=await authService[_0x54c59f(0x1a3)]();while(!_0x367d92){console[_0x54c59f(0x235)](_0x54c59f(0x1c0)),await promptForCredentials(),_0x367d92=await authService[_0x54c59f(0x1a3)]();}console[_0x54c59f(0x235)](_0x54c59f(0x1da));!loadApplianceIdentity()&&console[_0x54c59f(0x235)](_0x54c59f(0x22a));console[_0x54c59f(0x235)]('Registering\x20with\x20server...');const _0x2acc2c=await registerWithServer();if(!_0x2acc2c)throw new Error(_0x54c59f(0x1a9));connectToRosbridge(),connectToServer();const _0x4692b8=getInitialPort();await listenWithRetries(app,_0x4692b8,0xa);}catch(_0x4e37a3){console[_0x54c59f(0x1e8)](_0x54c59f(0x1e7),_0x4e37a3),process[_0x54c59f(0x1f5)](0x1);}};function a1_0x4180(_0x45e34c,_0x2873ef){const _0x3bde4a=a1_0xa17c();return a1_0x4180=function(_0x170bb3,_0x5e2bf2){_0x170bb3=_0x170bb3-0x184;let _0xa17cb2=_0x3bde4a[_0x170bb3];return _0xa17cb2;},a1_0x4180(_0x45e34c,_0x2873ef);}setInterval(async()=>{const _0x15aac2=a1_0x3cee72;try{if(robotId){const _0x462885=authService[_0x15aac2(0x18a)]();await axios['post'](config[_0x15aac2(0x1f4)]+_0x15aac2(0x1ab),{'robotId':robotId},{'headers':{'Authorization':_0x15aac2(0x20c)+_0x462885,'Content-Type':_0x15aac2(0x1c4)}});}}catch(_0x379a75){console['error']('Failed\x20to\x20ping\x20server:',_0x379a75['message']);}},0x1388),startApp();