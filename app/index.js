const a1_0x4ecf85=a1_0x3258;(function(_0x195685,_0x14d814){const _0x4c6913=a1_0x3258,_0x5c9c48=_0x195685();while(!![]){try{const _0x4eb077=-parseInt(_0x4c6913(0x1b0))/0x1*(-parseInt(_0x4c6913(0x1bf))/0x2)+-parseInt(_0x4c6913(0x202))/0x3+parseInt(_0x4c6913(0x14a))/0x4*(parseInt(_0x4c6913(0x1b7))/0x5)+parseInt(_0x4c6913(0x1a8))/0x6*(parseInt(_0x4c6913(0x1fb))/0x7)+parseInt(_0x4c6913(0x1c3))/0x8+parseInt(_0x4c6913(0x1f3))/0x9*(parseInt(_0x4c6913(0x1f4))/0xa)+-parseInt(_0x4c6913(0x1c0))/0xb*(parseInt(_0x4c6913(0x182))/0xc);if(_0x4eb077===_0x14d814)break;else _0x5c9c48['push'](_0x5c9c48['shift']());}catch(_0xc945eb){_0x5c9c48['push'](_0x5c9c48['shift']());}}}(a1_0x2db1,0x3fd18));function a1_0x3258(_0x5b5eb4,_0x2097db){const _0x329c05=a1_0x2db1();return a1_0x3258=function(_0x287d1d,_0x1a383b){_0x287d1d=_0x287d1d-0x13d;let _0x2db124=_0x329c05[_0x287d1d];return _0x2db124;},a1_0x3258(_0x5b5eb4,_0x2097db);}const a1_0x1a383b=(function(){let _0x1c69ca=!![];return function(_0x4bc032,_0x282277){const _0x6df525=_0x1c69ca?function(){const _0x3fa40b=a1_0x3258;if(_0x282277){const _0x214b76=_0x282277[_0x3fa40b(0x1e6)](_0x4bc032,arguments);return _0x282277=null,_0x214b76;}}:function(){};return _0x1c69ca=![],_0x6df525;};}()),a1_0x287d1d=a1_0x1a383b(this,function(){const _0x181445=a1_0x3258;return a1_0x287d1d[_0x181445(0x1e7)]()[_0x181445(0x18e)]('(((.+)+)+)+$')[_0x181445(0x1e7)]()['constructor'](a1_0x287d1d)[_0x181445(0x18e)](_0x181445(0x1a9));});a1_0x287d1d();const dotenv=require(a1_0x4ecf85(0x19a));dotenv[a1_0x4ecf85(0x174)]();const express=require(a1_0x4ecf85(0x17a)),config=require(a1_0x4ecf85(0x1f8));process[a1_0x4ecf85(0x167)][a1_0x4ecf85(0x1ff)]&&process[a1_0x4ecf85(0x167)]['APP_PASSWORD']&&(config['credentials']['username']=process[a1_0x4ecf85(0x167)][a1_0x4ecf85(0x1ff)],config[a1_0x4ecf85(0x1fc)][a1_0x4ecf85(0x1eb)]=process['env']['APP_PASSWORD'],console[a1_0x4ecf85(0x1f7)](a1_0x4ecf85(0x17d)));const authService=require(a1_0x4ecf85(0x143)),webrtcService=require(a1_0x4ecf85(0x1c9)),topicManager=require(a1_0x4ecf85(0x173)),WebSocket=require('ws'),axios=require(a1_0x4ecf85(0x1fe)),fs=require('fs'),prompt=require(a1_0x4ecf85(0x1ed))({'sigint':!![]}),app=express(),port=process['env']['PORT']||config[a1_0x4ecf85(0x1d4)]['proxyPort'],APPLIANCE_FILE='.appliance.json',{DOMParser,XMLSerializer}=require('xmldom'),path=require(a1_0x4ecf85(0x19d)),{execSync}=require(a1_0x4ecf85(0x1ec)),APPLIANCE_BASE_URL=process[a1_0x4ecf85(0x167)][a1_0x4ecf85(0x1df)]||'';console[a1_0x4ecf85(0x1f7)](a1_0x4ecf85(0x166)+(process[a1_0x4ecf85(0x167)][a1_0x4ecf85(0x1ae)]||a1_0x4ecf85(0x1dd))),console['log'](a1_0x4ecf85(0x18b)+config[a1_0x4ecf85(0x172)]),console[a1_0x4ecf85(0x1f7)](a1_0x4ecf85(0x155)+config[a1_0x4ecf85(0x1d4)][a1_0x4ecf85(0x150)]),console['log'](a1_0x4ecf85(0x1cb)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x4a30e8,_0x282770){const _0x10e909=a1_0x4ecf85;fs['writeFileSync'](_0x10e909(0x14f),_0x10e909(0x142)+_0x4a30e8+'\x0aAPP_PASSWORD='+_0x282770+'\x0a');}function reloadEnv(){const _0x3581a8=a1_0x4ecf85;dotenv[_0x3581a8(0x174)]({'override':!![]}),config[_0x3581a8(0x1fc)][_0x3581a8(0x191)]=process[_0x3581a8(0x167)][_0x3581a8(0x1ff)],config[_0x3581a8(0x1fc)][_0x3581a8(0x1eb)]=process[_0x3581a8(0x167)][_0x3581a8(0x1c8)],console['log'](_0x3581a8(0x1d9),{'username':config[_0x3581a8(0x1fc)]['username']?'SET':'NOT\x20SET','password':config[_0x3581a8(0x1fc)][_0x3581a8(0x1eb)]?_0x3581a8(0x1d6):_0x3581a8(0x144)});}async function promptForCredentials(){const _0x270ed6=a1_0x4ecf85;process[_0x270ed6(0x167)]['NODE_ENV']===_0x270ed6(0x1f1)&&(console['error'](_0x270ed6(0x1e8)),console[_0x270ed6(0x1a5)]('Please\x20run:\x20./setup.sh\x20reconfigure'),process['exit'](0x1));const _0xdbd041=prompt('Enter\x20username:\x20'),_0x3f3026=prompt[_0x270ed6(0x1ba)]('Enter\x20password:\x20');updateEnvFile(_0xdbd041,_0x3f3026),reloadEnv();}function loadApplianceIdentity(){const _0x5a034c=a1_0x4ecf85;if(fs[_0x5a034c(0x163)](APPLIANCE_FILE))try{const _0x2634f2=JSON[_0x5a034c(0x1b8)](fs['readFileSync'](APPLIANCE_FILE,'utf8'));if(_0x2634f2[_0x5a034c(0x1ac)]&&_0x2634f2[_0x5a034c(0x140)])return robotId=_0x2634f2[_0x5a034c(0x1ac)],registrationToken=_0x2634f2['registrationToken'],console[_0x5a034c(0x1f7)](_0x5a034c(0x1a6),robotId),topicManager[_0x5a034c(0x1aa)](_0x2634f2),!![];}catch(_0xedef09){console[_0x5a034c(0x1a5)](_0x5a034c(0x14c),_0xedef09);}return![];}function saveApplianceIdentity(_0x462bf6,_0x1736c9){const _0x3ea5e0=a1_0x4ecf85;let _0x15fbb7={};if(fs[_0x3ea5e0(0x163)](APPLIANCE_FILE))try{_0x15fbb7=JSON[_0x3ea5e0(0x1b8)](fs[_0x3ea5e0(0x1f6)](APPLIANCE_FILE,'utf8'));}catch(_0x2ef34c){_0x15fbb7={};}_0x15fbb7[_0x3ea5e0(0x1ac)]=_0x462bf6,_0x15fbb7[_0x3ea5e0(0x140)]=_0x1736c9,fs['writeFileSync'](APPLIANCE_FILE,JSON['stringify'](_0x15fbb7,null,0x2));}async function registerWithServer(){const _0x45bca4=a1_0x4ecf85;try{const _0x133a66=authService['getToken']();if(!_0x133a66)throw new Error(_0x45bca4(0x1c4));let _0x23759d,_0x2acdec=![];while(!![]){try{robotId&&registrationToken?_0x23759d=await axios['post'](config[_0x45bca4(0x172)]+'/appliance/register',{'name':_0x45bca4(0x1ca),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x45bca4(0x1e2)+_0x133a66,'Content-Type':_0x45bca4(0x1bc)}}):_0x23759d=await axios[_0x45bca4(0x169)](config[_0x45bca4(0x172)]+_0x45bca4(0x1bb),{'name':_0x45bca4(0x1ca)},{'headers':{'Authorization':'Bearer\x20'+_0x133a66,'Content-Type':'application/json'}});break;}catch(_0x9650e1){const _0x5380fd=_0x9650e1?.[_0x45bca4(0x1d3)]?.[_0x45bca4(0x19b)]?.['error']||_0x9650e1[_0x45bca4(0x1d2)];if(!_0x2acdec&&_0x5380fd&&_0x5380fd['toLowerCase']()[_0x45bca4(0x186)](_0x45bca4(0x1a0))){console[_0x45bca4(0x17b)](_0x45bca4(0x1a3));if(fs[_0x45bca4(0x163)](APPLIANCE_FILE))fs[_0x45bca4(0x157)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x2acdec=!![];continue;}throw _0x9650e1;}}if(!_0x23759d[_0x45bca4(0x19b)]||!_0x23759d[_0x45bca4(0x19b)][_0x45bca4(0x16d)]||!_0x23759d[_0x45bca4(0x19b)]['id'])throw new Error(_0x45bca4(0x1e4));return registrationToken=_0x23759d[_0x45bca4(0x19b)][_0x45bca4(0x16d)],robotId=_0x23759d[_0x45bca4(0x19b)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x45bca4(0x1f7)](_0x45bca4(0x1e3)),!![];}catch(_0x123fa5){return console[_0x45bca4(0x1a5)](_0x45bca4(0x1c1),_0x123fa5[_0x45bca4(0x1d2)]),![];}}function rewriteUrdfMeshUris(_0x3dc89b){const _0x3e255d=a1_0x4ecf85;try{const _0x46bdd2=new DOMParser(),_0x59afd2=_0x46bdd2['parseFromString'](_0x3dc89b,_0x3e255d(0x1b9));let _0x1e643d=0x0,_0xcc8419=0x0;const _0xe8897d=_0x59afd2[_0x3e255d(0x1dc)]('mesh');for(let _0x534233=0x0;_0x534233<_0xe8897d['length'];_0x534233++){const _0x48fb4a=_0xe8897d[_0x534233],_0x1b30a0=_0x48fb4a['getAttribute']('filename'),_0x183ead=['.stl',_0x3e255d(0x187),_0x3e255d(0x1b6),_0x3e255d(0x184),_0x3e255d(0x13e)],_0x3e4140=_0x183ead[_0x3e255d(0x13f)](_0x28a77e=>_0x1b30a0[_0x3e255d(0x154)]()[_0x3e255d(0x162)](_0x28a77e));if(_0x1b30a0&&_0x1b30a0[_0x3e255d(0x1db)]('package://')&&_0x3e4140){_0x1e643d++;const _0x22e3e=APPLIANCE_BASE_URL+_0x3e255d(0x192)+encodeURIComponent(_0x1b30a0);_0x48fb4a[_0x3e255d(0x1ef)](_0x3e255d(0x18c),_0x22e3e),_0xcc8419++,console[_0x3e255d(0x1f7)]('[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20'+_0x1b30a0+'\x20->\x20'+_0x22e3e);}}_0x1e643d>0x0?console[_0x3e255d(0x1f7)]('[URDF\x20REWRITE]\x20Rewrote\x20'+_0xcc8419+_0x3e255d(0x1e5)+_0x1e643d+_0x3e255d(0x1ee)):console[_0x3e255d(0x1f7)](_0x3e255d(0x1ce));const _0x24e835=new XMLSerializer();return _0x24e835[_0x3e255d(0x1ea)](_0x59afd2);}catch(_0x4899e2){return console[_0x3e255d(0x1a5)](_0x3e255d(0x1b4),_0x4899e2),_0x3dc89b;}}function connectToRosbridge(){const _0xb427aa=a1_0x4ecf85;try{rosbridgeWs=new WebSocket(config[_0xb427aa(0x1d4)][_0xb427aa(0x150)]),rosbridgeWs['on'](_0xb427aa(0x1a1),()=>{const _0x2ef8e0=_0xb427aa;console[_0x2ef8e0(0x1f7)](_0x2ef8e0(0x141));const _0x4c97d9=require(_0x2ef8e0(0x200)),_0x23967a=new _0x4c97d9[(_0x2ef8e0(0x179))]({'url':config[_0x2ef8e0(0x1d4)][_0x2ef8e0(0x150)]});_0x23967a['on'](_0x2ef8e0(0x1d8),()=>{setTimeout(()=>{const _0x3d8e01=a1_0x3258;topicManager['discoverTopics'](_0x23967a)[_0x3d8e01(0x1d5)](_0x43830d=>{const _0x15f6c2=_0x3d8e01;console['error'](_0x15f6c2(0x16b),_0x43830d);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on']('message',_0x12efa5=>{const _0x432dc3=_0xb427aa;if(serverWs&&serverWs[_0x432dc3(0x1c5)]===WebSocket[_0x432dc3(0x188)]){let _0x2d523a=_0x12efa5[_0x432dc3(0x1e7)]();try{const _0x3b02fc=JSON['parse'](_0x2d523a);if(_0x3b02fc['op']===_0x432dc3(0x14d)&&_0x3b02fc[_0x432dc3(0x198)]){const _0x51b149=topicManager['handleMessage'](_0x3b02fc);switch(_0x51b149[_0x432dc3(0x1b2)]){case'sample_skip':return;case'webrtc_skip':return;case'forward':default:_0x2d523a=JSON['stringify'](_0x51b149[_0x432dc3(0x1d2)]);break;}}if((_0x3b02fc['op']==='service_response'||_0x3b02fc['op']===_0x432dc3(0x203))&&(_0x3b02fc['service']===_0x432dc3(0x197)||_0x3b02fc[_0x432dc3(0x1a2)]&&_0x3b02fc[_0x432dc3(0x1a2)]['topics'])){console['log'](_0x432dc3(0x205));const _0x2349b7=_0x3b02fc[_0x432dc3(0x1a2)]?.[_0x432dc3(0x19c)]||[],_0x4b1889=_0x3b02fc[_0x432dc3(0x1a2)]?.['types']||[],_0x1dc74c=_0x2349b7[_0x432dc3(0x196)]((_0x58d8dd,_0x5decf5)=>{const _0x5053fd=_0x432dc3,_0x32ab1b=topicManager[_0x5053fd(0x183)](_0x58d8dd);return{'name':_0x58d8dd,'type':_0x4b1889[_0x5decf5]||_0x5053fd(0x1de),'throttling':_0x32ab1b?{'isThrottled':_0x32ab1b[_0x5053fd(0x18a)]==='sample','strategy':_0x32ab1b[_0x5053fd(0x18a)],'samplingRate':_0x32ab1b[_0x5053fd(0x164)],'reason':_0x32ab1b[_0x5053fd(0x189)],'estimatedSize':_0x32ab1b[_0x5053fd(0x18d)]}:null};});_0x3b02fc[_0x432dc3(0x1a2)]={'topics':_0x1dc74c['map'](_0x7732e3=>_0x7732e3[_0x432dc3(0x1b3)]),'types':_0x1dc74c[_0x432dc3(0x196)](_0x3e7842=>_0x3e7842['type']),'throttling':_0x1dc74c[_0x432dc3(0x196)](_0x20efb0=>_0x20efb0['throttling'])},_0x2d523a=JSON[_0x432dc3(0x1d1)](_0x3b02fc),console[_0x432dc3(0x1f7)](_0x432dc3(0x14b));}if(_0x3b02fc['op']===_0x432dc3(0x14d)&&_0x3b02fc[_0x432dc3(0x198)]===_0x432dc3(0x153))try{const _0x488666=_0x3b02fc[_0x432dc3(0x204)][_0x432dc3(0x19b)],_0x617f5d=rewriteUrdfMeshUris(_0x488666);_0x3b02fc[_0x432dc3(0x204)][_0x432dc3(0x19b)]=_0x617f5d,_0x2d523a=JSON['stringify'](_0x3b02fc);}catch(_0x5a18d0){console[_0x432dc3(0x1a5)](_0x432dc3(0x15d),_0x5a18d0);}}catch(_0x5e13bd){console[_0x432dc3(0x17b)]('[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:',_0x5e13bd['message']);}serverWs[_0x432dc3(0x15a)](_0x2d523a);}}),rosbridgeWs['on'](_0xb427aa(0x1fa),()=>{const _0x307b23=_0xb427aa;console[_0x307b23(0x1f7)](_0x307b23(0x15f)),webrtcService[_0x307b23(0x17f)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0xb427aa(0x1a5),_0x1979c0=>{const _0x41faa6=_0xb427aa;console[_0x41faa6(0x1a5)](_0x41faa6(0x1e0),_0x1979c0);});}catch(_0x585807){console[_0xb427aa(0x1a5)](_0xb427aa(0x180),_0x585807),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x1499a7=a1_0x4ecf85;try{rosbridgeWebRTCWs=new WebSocket(config[_0x1499a7(0x1d4)][_0x1499a7(0x150)]),rosbridgeWebRTCWs['on'](_0x1499a7(0x1a1),()=>{const _0x338373=_0x1499a7;console[_0x338373(0x1f7)](_0x338373(0x16e)),webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on']('message',_0xff6553=>{}),rosbridgeWebRTCWs['on'](_0x1499a7(0x1fa),()=>{const _0x4efac7=_0x1499a7;console[_0x4efac7(0x1f7)](_0x4efac7(0x1ad)),webrtcService['stopAllSessions'](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x1499a7(0x1a5),_0x1ce93c=>{const _0x4d98ec=_0x1499a7;console[_0x4d98ec(0x1a5)]('ROSBridge\x20(WebRTC)\x20connection\x20error:',_0x1ce93c);});}catch(_0x3e715d){console['error'](_0x1499a7(0x1d0),_0x3e715d),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function a1_0x2db1(){const _0x4eb005=['SET','ros2\x20pkg\x20prefix\x20','connection','Loaded\x20credentials:','strategies','startsWith','getElementsByTagName','development','unknown','APPLIANCE_BASE_URL','ROSBridge\x20(main)\x20connection\x20error:','Mesh\x20file\x20not\x20found:\x20','Bearer\x20','Successfully\x20registered\x20with\x20server','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','\x20of\x20','apply','toString','Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file','param_name','serializeToString','password','child_process','prompt-sync','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','setAttribute','initialize','production','Port\x20','9fXslgf','2891780fyAscA','utf8','readFileSync','log','./config','trim','close','1211847YPxStr','credentials','EADDRINUSE','axios','APP_USERNAME','roslib','Authentication\x20required','27885EQuzJr','call_service','msg','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','request_id','.mesh','some','registrationToken','Connected\x20to\x20ROSBridge\x20(main)','APP_USERNAME=','./services/auth','NOT\x20SET','[MESH]\x20Error\x20serving\x20mesh:','OPTIONS','ros2\x20param\x20get\x20','Successfully\x20logged\x20in','Failed\x20to\x20ping\x20server:','876ZmqVZG','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','publish','get_mesh','.env','wsEndpoint','proxyPort','string','/robot_description','toLowerCase','ROSBridge\x20WebSocket\x20URL:\x20','length','unlinkSync','Attempting\x20to\x20login\x20to:','use','send','getToken','code','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','status','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','/appliance/ping','Registering\x20with\x20server...','endsWith','existsSync','samplingRate','getActiveSessions','Environment:\x20','env','Appliance\x20is\x20running\x20and\x20authenticated!','post','get','Topic\x20discovery\x20failed:','base64','registration_token','Connected\x20to\x20ROSBridge\x20(WebRTC)','Access-Control-Allow-Origin','login','http','serverUrl','./services/TopicManager','config','Access-Control-Allow-Headers','/health','Server\x20connection\x20error:','\x20in\x20use,\x20trying\x20next\x20port...','Ros','express','warn','json','Initial\x20credentials\x20loaded\x20from\x20environment','mesh_data','stopAllSessions','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','120648zqOMkD','getTopicStrategy','.ply','isAuthenticated','includes','.dae','OPEN','reason','strategy','Backend\x20Server\x20URL:\x20','filename','estimatedSize','search','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','urdf_param_data','username','/ros/mesh?uri=','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','exit','share','map','/rosapi/topics','topic','handleMessage','dotenv','data','topics','path','header','uri','robot\x20not\x20found','open','values','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','PORT','error','Loaded\x20appliance\x20identity:','/rosbridge?type=appliance&token=','12DXmrnE','(((.+)+)+)+$','loadConfig','substring','robotId','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','NODE_ENV','totalTopics','589jcUfJt','slice','action','name','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','Disconnected\x20from\x20server\x20(','.obj','10235AnwnFd','parse','text/xml','hide','/appliance/register','application/json','String\x20value\x20is:\x20','match','46iXcoAs','1430qydHPg','Failed\x20to\x20register\x20with\x20server:','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','3843640ZCHBjm','Not\x20authenticated','readyState','Failed\x20to\x20start\x20application:','getStatistics','APP_PASSWORD','./services/webrtcService','WSL\x20Appliance','Proxy\x20listening\x20on\x20port:\x20','largeDataTopics','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','listen','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','stringify','message','response','rosbridge','catch'];a1_0x2db1=function(){return _0x4eb005;};return a1_0x2db1();}function connectToServer(){const _0x49b58e=a1_0x4ecf85;try{if(!registrationToken)throw new Error(_0x49b58e(0x1cd));const _0x41fec1=config[_0x49b58e(0x172)]['replace'](_0x49b58e(0x171),'ws')+_0x49b58e(0x1a7)+registrationToken;serverWs=new WebSocket(_0x41fec1),serverWs['on'](_0x49b58e(0x1a1),()=>{const _0x416a52=_0x49b58e;console[_0x416a52(0x1f7)]('Connected\x20to\x20server'),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x416a52(0x1c5)]===WebSocket[_0x416a52(0x188)]&&webrtcService[_0x416a52(0x1f0)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x49b58e(0x1d2),_0x3ec26a=>{const _0x16fade=_0x49b58e;if(rosbridgeWs&&rosbridgeWs[_0x16fade(0x1c5)]===WebSocket[_0x16fade(0x188)]){let _0x470376=_0x3ec26a[_0x16fade(0x1e7)]();try{const _0x43432f=JSON[_0x16fade(0x1b8)](_0x470376);if(webrtcService[_0x16fade(0x199)](_0x43432f))return;if(_0x43432f['op']==='get_urdf_param'&&typeof _0x43432f[_0x16fade(0x1e9)]===_0x16fade(0x152)&&_0x43432f['request_id'])try{console['log']('[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20'+_0x43432f[_0x16fade(0x1e9)]);const _0x57e3af=execSync(_0x16fade(0x147)+_0x43432f[_0x16fade(0x1e9)],{'encoding':_0x16fade(0x1f5)})[_0x16fade(0x1f9)]();let _0x46a8c1=_0x57e3af;_0x57e3af['startsWith']('String\x20value\x20is:\x20')&&(_0x46a8c1=_0x57e3af[_0x16fade(0x1ab)](_0x16fade(0x1bd)[_0x16fade(0x156)]()));_0x46a8c1['startsWith']('\x22')&&_0x46a8c1['endsWith']('\x22')&&(_0x46a8c1=_0x46a8c1[_0x16fade(0x1b1)](0x1,-0x1));_0x46a8c1=_0x46a8c1['replace'](/\\n/g,'\x0a')['replace'](/\\"/g,'\x22');const _0x51342e={'op':_0x16fade(0x190),'request_id':_0x43432f['request_id'],'data':_0x46a8c1};serverWs['send'](JSON[_0x16fade(0x1d1)](_0x51342e)),console[_0x16fade(0x1f7)]('[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20'+_0x43432f[_0x16fade(0x1e9)]);return;}catch(_0x6c31b1){console[_0x16fade(0x1a5)]('[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:',_0x6c31b1);const _0x282cbf={'op':_0x16fade(0x190),'request_id':_0x43432f[_0x16fade(0x13d)],'error':_0x6c31b1['message']};serverWs[_0x16fade(0x15a)](JSON[_0x16fade(0x1d1)](_0x282cbf));return;}if(_0x43432f['op']===_0x16fade(0x14e)&&typeof _0x43432f[_0x16fade(0x19f)]===_0x16fade(0x152)&&_0x43432f[_0x16fade(0x13d)])try{const _0x5124c3=_0x43432f['uri'][_0x16fade(0x1be)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x5124c3){const _0x27f5a1=_0x5124c3[0x1],_0x49e38c=_0x5124c3[0x2],_0x10f8cb=execSync(_0x16fade(0x1d7)+_0x27f5a1,{'encoding':_0x16fade(0x1f5)})['trim'](),_0xe5dbca=path['join'](_0x10f8cb,_0x16fade(0x195),_0x27f5a1,_0x49e38c);if(!fs[_0x16fade(0x163)](_0xe5dbca))throw new Error(_0x16fade(0x1e1)+_0xe5dbca);const _0xfc0f97=fs[_0x16fade(0x1f6)](_0xe5dbca),_0x3348aa={'op':_0x16fade(0x17e),'request_id':_0x43432f[_0x16fade(0x13d)],'data':_0xfc0f97[_0x16fade(0x1e7)](_0x16fade(0x16c))};serverWs['send'](JSON['stringify'](_0x3348aa)),console['log']('[MESH]\x20Successfully\x20served\x20mesh:\x20'+_0x43432f['uri']+'\x20from\x20'+_0xe5dbca);return;}}catch(_0x1b0735){console['error'](_0x16fade(0x145),_0x1b0735);const _0x2fbd62={'op':_0x16fade(0x17e),'request_id':_0x43432f[_0x16fade(0x13d)],'error':_0x1b0735['message']};serverWs['send'](JSON['stringify'](_0x2fbd62));return;}rosbridgeWs['send'](_0x470376);}catch(_0x288263){rosbridgeWs['send'](_0x470376);}}}),serverWs['on'](_0x49b58e(0x1fa),(_0x48f866,_0x2ae88a)=>{const _0x3dce0e=_0x49b58e;console[_0x3dce0e(0x1f7)](_0x3dce0e(0x1b5)+_0x48f866+':\x20'+_0x2ae88a+'),\x20attempting\x20to\x20reconnect...'),webrtcService['stopAllSessions'](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x49b58e(0x1a5),_0x1fe4cd=>{const _0x560337=_0x49b58e;console[_0x560337(0x1a5)](_0x560337(0x177),_0x1fe4cd);});}catch(_0x425e63){console[_0x49b58e(0x1a5)]('Failed\x20to\x20connect\x20to\x20server:',_0x425e63),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x4e6977,_0x4f3a0c,_0x3a3961)=>{const _0x53650c=a1_0x4ecf85;if(!authService[_0x53650c(0x185)]()){console[_0x53650c(0x1f7)](_0x53650c(0x158),config[_0x53650c(0x172)]);const _0x1fd3e6=await authService[_0x53650c(0x170)]();if(!_0x1fd3e6)return _0x4f3a0c[_0x53650c(0x15e)](0x191)[_0x53650c(0x17c)]({'error':_0x53650c(0x201)});}_0x3a3961();};app[a1_0x4ecf85(0x159)]((_0x26637e,_0x5cc619,_0x1e9c95)=>{const _0x22f151=a1_0x4ecf85;_0x5cc619[_0x22f151(0x19e)](_0x22f151(0x16f),'*'),_0x5cc619[_0x22f151(0x19e)]('Access-Control-Allow-Methods',_0x22f151(0x1c2)),_0x5cc619['header'](_0x22f151(0x175),_0x22f151(0x18f)),_0x26637e['method']===_0x22f151(0x146)?_0x5cc619['sendStatus'](0xc8):_0x1e9c95();}),app[a1_0x4ecf85(0x16a)]('/',requireAuth,(_0x2f1a0e,_0x38fbbe)=>{const _0x1fd567=a1_0x4ecf85;_0x38fbbe[_0x1fd567(0x15a)](_0x1fd567(0x168));}),app[a1_0x4ecf85(0x16a)](a1_0x4ecf85(0x176),async(_0x305b13,_0x35b31d)=>{const _0x30881b=a1_0x4ecf85,_0x29c1c4=authService['isAuthenticated'](),_0x4487d2=webrtcService[_0x30881b(0x165)](),_0x4a16ee=webrtcService['getSharedVideoSources'](),_0x4aa528=topicManager[_0x30881b(0x1c7)]();_0x35b31d[_0x30881b(0x17c)]({'status':'ok','environment':process[_0x30881b(0x167)][_0x30881b(0x1ae)]||_0x30881b(0x1dd),'backendUrl':config[_0x30881b(0x172)],'rosbridgeUrl':config[_0x30881b(0x1d4)][_0x30881b(0x150)],'proxyPort':port,'authenticated':_0x29c1c4,'topicManagement':{'discovered':_0x4aa528[_0x30881b(0x1af)],'strategies':_0x4aa528[_0x30881b(0x1da)],'largeDataTopics':_0x4aa528[_0x30881b(0x1cc)][_0x30881b(0x156)],'largeTopicsList':_0x4aa528[_0x30881b(0x1cc)]},'webrtc':{'activeSessions':_0x4487d2['length'],'sharedVideoSources':_0x4a16ee[_0x30881b(0x156)],'sessions':_0x4487d2,'sharedSources':_0x4a16ee}});});const getInitialPort=()=>{const _0x254ed3=a1_0x4ecf85;if(process[_0x254ed3(0x167)][_0x254ed3(0x1a4)])return parseInt(process[_0x254ed3(0x167)][_0x254ed3(0x1a4)],0xa);return config[_0x254ed3(0x1d4)][_0x254ed3(0x151)];};async function listenWithRetries(_0x1ea91c,_0x329177,_0x1d032b=0xa){const _0x52530c=a1_0x4ecf85;let _0x4004d9=_0x329177;for(let _0x2bdd6b=0x1;_0x2bdd6b<=_0x1d032b;_0x2bdd6b++){try{return await new Promise((_0x58be72,_0x5400c2)=>{const _0x1a8163=a1_0x3258,_0x3f7f36=_0x1ea91c[_0x1a8163(0x1cf)](_0x4004d9,()=>{const _0x1fc398=_0x1a8163;console[_0x1fc398(0x1f7)](_0x1fc398(0x181)+_0x4004d9),_0x58be72(_0x3f7f36);});_0x3f7f36['on'](_0x1a8163(0x1a5),_0x5ef7b0=>{const _0x547daf=_0x1a8163;_0x5ef7b0[_0x547daf(0x15c)]===_0x547daf(0x1fd)?(console[_0x547daf(0x17b)](_0x547daf(0x1f2)+_0x4004d9+_0x547daf(0x178)),_0x5400c2(_0x5ef7b0)):_0x5400c2(_0x5ef7b0);});}),_0x4004d9;}catch(_0x50aff5){_0x4004d9++;}}throw new Error(_0x52530c(0x193)+_0x1d032b+'\x20attempts\x20starting\x20from\x20'+_0x329177);}const startApp=async()=>{const _0x5b6be9=a1_0x4ecf85;try{reloadEnv();let _0x355d55=await authService[_0x5b6be9(0x170)]();while(!_0x355d55){console[_0x5b6be9(0x1f7)]('Login\x20failed.\x20Please\x20enter\x20credentials\x20again.'),await promptForCredentials(),_0x355d55=await authService[_0x5b6be9(0x170)]();}console[_0x5b6be9(0x1f7)](_0x5b6be9(0x148));!loadApplianceIdentity()&&console[_0x5b6be9(0x1f7)]('No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.');console['log'](_0x5b6be9(0x161));const _0x55bbe1=await registerWithServer();if(!_0x55bbe1)throw new Error('Failed\x20to\x20register\x20with\x20server');connectToRosbridge(),connectToServer();const _0x5a11af=getInitialPort();await listenWithRetries(app,_0x5a11af,0xa);}catch(_0x716ce2){console[_0x5b6be9(0x1a5)](_0x5b6be9(0x1c6),_0x716ce2),process[_0x5b6be9(0x194)](0x1);}};setInterval(async()=>{const _0x239e5d=a1_0x4ecf85;try{if(robotId){const _0x1aff74=authService[_0x239e5d(0x15b)]();await axios[_0x239e5d(0x169)](config[_0x239e5d(0x172)]+_0x239e5d(0x160),{'robotId':robotId},{'headers':{'Authorization':_0x239e5d(0x1e2)+_0x1aff74,'Content-Type':_0x239e5d(0x1bc)}});}}catch(_0x555bce){console[_0x239e5d(0x1a5)](_0x239e5d(0x149),_0x555bce[_0x239e5d(0x1d2)]);}},0x1388),startApp();