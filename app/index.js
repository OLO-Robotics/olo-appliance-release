const a1_0x4034d0=a1_0x48a6;(function(_0x111699,_0x1094cd){const _0x3c7d96=a1_0x48a6,_0x94abc7=_0x111699();while(!![]){try{const _0x3c2011=parseInt(_0x3c7d96(0xfa))/0x1*(-parseInt(_0x3c7d96(0xf1))/0x2)+parseInt(_0x3c7d96(0x1b7))/0x3+-parseInt(_0x3c7d96(0x156))/0x4*(-parseInt(_0x3c7d96(0x107))/0x5)+parseInt(_0x3c7d96(0x12b))/0x6+parseInt(_0x3c7d96(0xf0))/0x7*(-parseInt(_0x3c7d96(0x18b))/0x8)+-parseInt(_0x3c7d96(0x1af))/0x9+parseInt(_0x3c7d96(0xf6))/0xa*(-parseInt(_0x3c7d96(0x12d))/0xb);if(_0x3c2011===_0x1094cd)break;else _0x94abc7['push'](_0x94abc7['shift']());}catch(_0xe9fdc1){_0x94abc7['push'](_0x94abc7['shift']());}}}(a1_0x60d3,0xc3b68));const a1_0x25f765=(function(){let _0x192c03=!![];return function(_0x4ae0ec,_0x354052){const _0x48c50e=_0x192c03?function(){const _0x4e41b6=a1_0x48a6;if(_0x354052){const _0x15b565=_0x354052[_0x4e41b6(0x111)](_0x4ae0ec,arguments);return _0x354052=null,_0x15b565;}}:function(){};return _0x192c03=![],_0x48c50e;};}()),a1_0x3eb6cc=a1_0x25f765(this,function(){const _0x543c75=a1_0x48a6;return a1_0x3eb6cc['toString']()['search'](_0x543c75(0x176))['toString']()[_0x543c75(0x1a6)](a1_0x3eb6cc)['search'](_0x543c75(0x176));});a1_0x3eb6cc();const dotenv=require(a1_0x4034d0(0x17a));dotenv['config']();const express=require('express'),config=require('./config');process['env']['APP_USERNAME']&&process['env']['APP_PASSWORD']&&(config['credentials'][a1_0x4034d0(0x179)]=process['env'][a1_0x4034d0(0x162)],config[a1_0x4034d0(0x123)][a1_0x4034d0(0x11c)]=process[a1_0x4034d0(0x1ae)][a1_0x4034d0(0x112)],console[a1_0x4034d0(0x142)](a1_0x4034d0(0x1b0)));const authService=require(a1_0x4034d0(0x100)),webrtcService=require(a1_0x4034d0(0x109)),topicManager=require('./services/TopicManager'),WebSocket=require('ws'),axios=require(a1_0x4034d0(0x13d)),fs=require('fs'),prompt=require('prompt-sync')({'sigint':!![]}),app=express(),port=process['env'][a1_0x4034d0(0x152)]||config[a1_0x4034d0(0x128)][a1_0x4034d0(0x15f)],APPLIANCE_FILE=a1_0x4034d0(0x106),{DOMParser,XMLSerializer}=require(a1_0x4034d0(0x14e)),path=require('path'),{execSync}=require(a1_0x4034d0(0x13e)),APPLIANCE_BASE_URL=process[a1_0x4034d0(0x1ae)]['APPLIANCE_BASE_URL']||'';console[a1_0x4034d0(0x142)]('Environment:\x20'+(process[a1_0x4034d0(0x1ae)]['NODE_ENV']||a1_0x4034d0(0x101))),console[a1_0x4034d0(0x142)](a1_0x4034d0(0x18e)+config[a1_0x4034d0(0xef)]),console[a1_0x4034d0(0x142)](a1_0x4034d0(0x186)+config[a1_0x4034d0(0x128)]['wsEndpoint']),console[a1_0x4034d0(0x142)](a1_0x4034d0(0x12c)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x33e786,_0x1d6a41){const _0x492184=a1_0x4034d0;fs[_0x492184(0x12e)]('.env',_0x492184(0x1a2)+_0x33e786+_0x492184(0x180)+_0x1d6a41+'\x0a');}function reloadEnv(){const _0x514e55=a1_0x4034d0;dotenv[_0x514e55(0x16a)]({'override':!![]}),config[_0x514e55(0x123)][_0x514e55(0x179)]=process[_0x514e55(0x1ae)][_0x514e55(0x162)],config[_0x514e55(0x123)]['password']=process[_0x514e55(0x1ae)][_0x514e55(0x112)],console[_0x514e55(0x142)](_0x514e55(0x131),{'username':config['credentials'][_0x514e55(0x179)]?_0x514e55(0x182):_0x514e55(0xf9),'password':config[_0x514e55(0x123)][_0x514e55(0x11c)]?_0x514e55(0x182):_0x514e55(0xf9)});}async function promptForCredentials(){const _0x112ba4=a1_0x4034d0;process[_0x112ba4(0x1ae)][_0x112ba4(0x19a)]==='production'&&(console[_0x112ba4(0x177)](_0x112ba4(0x140)),console[_0x112ba4(0x177)](_0x112ba4(0x10a)),process[_0x112ba4(0x17c)](0x1));const _0x2238d6=prompt(_0x112ba4(0x10b)),_0x575f06=prompt[_0x112ba4(0x108)](_0x112ba4(0x175));updateEnvFile(_0x2238d6,_0x575f06),reloadEnv();}function loadApplianceIdentity(){const _0x1113a2=a1_0x4034d0;if(fs[_0x1113a2(0x144)](APPLIANCE_FILE))try{const _0x5d1201=JSON['parse'](fs[_0x1113a2(0x174)](APPLIANCE_FILE,'utf8'));if(_0x5d1201['robotId']&&_0x5d1201[_0x1113a2(0x1a7)])return robotId=_0x5d1201['robotId'],registrationToken=_0x5d1201['registrationToken'],console[_0x1113a2(0x142)](_0x1113a2(0x191),robotId),topicManager[_0x1113a2(0x17b)](_0x5d1201),!![];}catch(_0x4fc3ee){console[_0x1113a2(0x177)](_0x1113a2(0x1a5),_0x4fc3ee);}return![];}function a1_0x48a6(_0x25ff45,_0x370244){const _0x1315b5=a1_0x60d3();return a1_0x48a6=function(_0x3eb6cc,_0x25f765){_0x3eb6cc=_0x3eb6cc-0xed;let _0x60d316=_0x1315b5[_0x3eb6cc];return _0x60d316;},a1_0x48a6(_0x25ff45,_0x370244);}function saveApplianceIdentity(_0x5659dc,_0x17da6a){const _0x960a97=a1_0x4034d0;let _0x140e4b={};if(fs['existsSync'](APPLIANCE_FILE))try{_0x140e4b=JSON[_0x960a97(0x170)](fs[_0x960a97(0x174)](APPLIANCE_FILE,_0x960a97(0x19d)));}catch(_0x110cfb){_0x140e4b={};}_0x140e4b[_0x960a97(0x167)]=_0x5659dc,_0x140e4b[_0x960a97(0x1a7)]=_0x17da6a,fs[_0x960a97(0x12e)](APPLIANCE_FILE,JSON[_0x960a97(0xfc)](_0x140e4b,null,0x2));}async function registerWithServer(){const _0x596bba=a1_0x4034d0;try{const _0x47ec12=authService[_0x596bba(0x15d)]();if(!_0x47ec12)throw new Error(_0x596bba(0xee));let _0x5dcf27,_0x234e2c=![];while(!![]){try{robotId&&registrationToken?_0x5dcf27=await axios['post'](config[_0x596bba(0xef)]+_0x596bba(0xf7),{'name':_0x596bba(0x113),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x596bba(0x14b)+_0x47ec12,'Content-Type':_0x596bba(0x161)}}):_0x5dcf27=await axios[_0x596bba(0xf2)](config['serverUrl']+_0x596bba(0xf7),{'name':_0x596bba(0x113)},{'headers':{'Authorization':_0x596bba(0x14b)+_0x47ec12,'Content-Type':_0x596bba(0x161)}});break;}catch(_0x3ac080){const _0x32471b=_0x3ac080?.[_0x596bba(0x145)]?.[_0x596bba(0x110)]?.[_0x596bba(0x177)]||_0x3ac080['message'];if(!_0x234e2c&&_0x32471b&&_0x32471b['toLowerCase']()['includes'](_0x596bba(0x132))){console[_0x596bba(0x13f)](_0x596bba(0x120));if(fs[_0x596bba(0x144)](APPLIANCE_FILE))fs[_0x596bba(0x18c)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x234e2c=!![];continue;}throw _0x3ac080;}}if(!_0x5dcf27[_0x596bba(0x110)]||!_0x5dcf27[_0x596bba(0x110)][_0x596bba(0x197)]||!_0x5dcf27[_0x596bba(0x110)]['id'])throw new Error(_0x596bba(0x126));return registrationToken=_0x5dcf27[_0x596bba(0x110)][_0x596bba(0x197)],robotId=_0x5dcf27[_0x596bba(0x110)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x596bba(0x142)](_0x596bba(0x18f)),!![];}catch(_0x12f477){return console[_0x596bba(0x177)](_0x596bba(0xf4),_0x12f477[_0x596bba(0x1ab)]),![];}}function rewriteUrdfMeshUris(_0x993c1b){const _0x46f56=a1_0x4034d0;try{const _0x54329d=new DOMParser(),_0x4ce0de=_0x54329d[_0x46f56(0x1a4)](_0x993c1b,_0x46f56(0x16b));let _0x2c0eb1=0x0,_0x419718=0x0;const _0x4efe09=_0x4ce0de['getElementsByTagName'](_0x46f56(0x136));for(let _0x2e573a=0x0;_0x2e573a<_0x4efe09[_0x46f56(0x16c)];_0x2e573a++){const _0x598cd0=_0x4efe09[_0x2e573a],_0x10494b=_0x598cd0[_0x46f56(0x13b)](_0x46f56(0x16f)),_0x531700=[_0x46f56(0x158),_0x46f56(0x183),'.obj',_0x46f56(0x178),_0x46f56(0x153)],_0x5d58f7=_0x531700[_0x46f56(0x192)](_0x31b5e0=>_0x10494b[_0x46f56(0x199)]()[_0x46f56(0x11e)](_0x31b5e0));if(_0x10494b&&_0x10494b[_0x46f56(0x134)](_0x46f56(0x171))&&_0x5d58f7){_0x2c0eb1++;const _0xf29178=APPLIANCE_BASE_URL+'/ros/mesh?uri='+encodeURIComponent(_0x10494b);_0x598cd0[_0x46f56(0x189)](_0x46f56(0x16f),_0xf29178),_0x419718++,console['log'](_0x46f56(0x129)+_0x10494b+'\x20->\x20'+_0xf29178);}}_0x2c0eb1>0x0?console['log']('[URDF\x20REWRITE]\x20Rewrote\x20'+_0x419718+_0x46f56(0x151)+_0x2c0eb1+_0x46f56(0x1a0)):console[_0x46f56(0x142)](_0x46f56(0x127));const _0x33e089=new XMLSerializer();return _0x33e089[_0x46f56(0x121)](_0x4ce0de);}catch(_0xe0a509){return console[_0x46f56(0x177)](_0x46f56(0x17f),_0xe0a509),_0x993c1b;}}function connectToRosbridge(){const _0x4a2c38=a1_0x4034d0;try{rosbridgeWs=new WebSocket(config['rosbridge'][_0x4a2c38(0x17d)]),rosbridgeWs['on'](_0x4a2c38(0x1a1),()=>{const _0x45d813=_0x4a2c38;console[_0x45d813(0x142)](_0x45d813(0x119));const _0x4148dc=require(_0x45d813(0x18d)),_0x5d87a7=new _0x4148dc[(_0x45d813(0x1b9))]({'url':config['rosbridge'][_0x45d813(0x17d)]});_0x5d87a7['on'](_0x45d813(0x122),()=>{setTimeout(()=>{const _0x44d7bd=a1_0x48a6;topicManager[_0x44d7bd(0x194)](_0x5d87a7)[_0x44d7bd(0x125)](_0x56cca8=>{const _0xe107d1=_0x44d7bd;console['error'](_0xe107d1(0x19c),_0x56cca8);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x4a2c38(0x1ab),_0x3a5888=>{const _0x56fb12=_0x4a2c38;if(serverWs&&serverWs[_0x56fb12(0x190)]===WebSocket['OPEN']){let _0x18450f=_0x3a5888[_0x56fb12(0x1b1)]();try{const _0xee5ef7=JSON[_0x56fb12(0x170)](_0x18450f);if(_0xee5ef7['op']==='publish'&&_0xee5ef7[_0x56fb12(0x138)]){const _0x289a1b=topicManager[_0x56fb12(0x115)](_0xee5ef7);switch(_0x289a1b[_0x56fb12(0x19f)]){case'sample_skip':return;case _0x56fb12(0x18a):return;case _0x56fb12(0x143):default:_0x18450f=JSON[_0x56fb12(0xfc)](_0x289a1b[_0x56fb12(0x1ab)]);break;}}if((_0xee5ef7['op']===_0x56fb12(0x105)||_0xee5ef7['op']===_0x56fb12(0x149))&&(_0xee5ef7[_0x56fb12(0xfd)]===_0x56fb12(0x185)||_0xee5ef7[_0x56fb12(0x168)]&&_0xee5ef7[_0x56fb12(0x168)][_0x56fb12(0x1a9)])){console[_0x56fb12(0x142)]('[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata');const _0x4e2007=_0xee5ef7['values']?.[_0x56fb12(0x1a9)]||[],_0x2f1b14=_0xee5ef7['values']?.[_0x56fb12(0x14c)]||[],_0x544311=_0x4e2007[_0x56fb12(0x10c)]((_0x531b00,_0x18a9f2)=>{const _0x459eb1=_0x56fb12,_0x457e29=topicManager[_0x459eb1(0x148)](_0x531b00);return{'name':_0x531b00,'type':_0x2f1b14[_0x18a9f2]||_0x459eb1(0x117),'throttling':_0x457e29?{'isThrottled':_0x457e29[_0x459eb1(0x195)]===_0x459eb1(0xfb),'strategy':_0x457e29['strategy'],'samplingRate':_0x457e29[_0x459eb1(0x157)],'reason':_0x457e29[_0x459eb1(0x11a)],'estimatedSize':_0x457e29[_0x459eb1(0x193)]}:null};});_0xee5ef7[_0x56fb12(0x168)]={'topics':_0x544311[_0x56fb12(0x10c)](_0x2e07be=>_0x2e07be['name']),'types':_0x544311['map'](_0xf8e147=>_0xf8e147[_0x56fb12(0x160)]),'throttling':_0x544311[_0x56fb12(0x10c)](_0x187ece=>_0x187ece[_0x56fb12(0x1b8)])},_0x18450f=JSON[_0x56fb12(0xfc)](_0xee5ef7),console['log'](_0x56fb12(0x1a3));}if(_0xee5ef7['op']==='publish'&&_0xee5ef7[_0x56fb12(0x138)]===_0x56fb12(0xf3))try{const _0x4ef260=_0xee5ef7['msg'][_0x56fb12(0x110)],_0x11ae45=rewriteUrdfMeshUris(_0x4ef260);_0xee5ef7[_0x56fb12(0xff)][_0x56fb12(0x110)]=_0x11ae45,_0x18450f=JSON[_0x56fb12(0xfc)](_0xee5ef7);}catch(_0x5ce805){console[_0x56fb12(0x177)]('[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:',_0x5ce805);}}catch(_0x258d71){console[_0x56fb12(0x13f)](_0x56fb12(0x114),_0x258d71['message']);}serverWs['send'](_0x18450f);}}),rosbridgeWs['on'](_0x4a2c38(0x198),()=>{const _0x5f5048=_0x4a2c38;console[_0x5f5048(0x142)](_0x5f5048(0x12f)),webrtcService[_0x5f5048(0x12a)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x4a2c38(0x177),_0xca78f2=>{const _0xd5f67=_0x4a2c38;console[_0xd5f67(0x177)](_0xd5f67(0x1ad),_0xca78f2);});}catch(_0xdc1b5e){console['error'](_0x4a2c38(0x173),_0xdc1b5e),setTimeout(connectToRosbridge,0x1388);}}function a1_0x60d3(){const _0xe22ac8=['isAuthenticated','join','\x20in\x20use,\x20trying\x20next\x20port...','Failed\x20to\x20start\x20application:','4619325caANex','throttling','Ros','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','Not\x20authenticated','serverUrl','2314389UkHlzB','2osikhk','post','/robot_description','Failed\x20to\x20register\x20with\x20server:','Server\x20connection\x20error:','1848790vSiYvF','/appliance/register','listen','NOT\x20SET','265749LOrZoz','sample','stringify','service','match','msg','./services/auth','development','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','sendStatus','getSharedVideoSources','service_response','.appliance.json','120daxWtN','hide','./services/webrtcService','Please\x20run:\x20./setup.sh\x20reconfigure','Enter\x20username:\x20','map','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','ROSBridge\x20(WebRTC)\x20connection\x20error:','data','apply','APP_PASSWORD','WSL\x20Appliance','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','handleMessage','[MESH]\x20Error\x20serving\x20mesh:','unknown','header','Connected\x20to\x20ROSBridge\x20(main)','reason','),\x20attempting\x20to\x20reconnect...','password','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','endsWith','get_mesh','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','serializeToString','connection','credentials','mesh_data','catch','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','rosbridge','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','stopAllSessions','5393124ftwQTh','Proxy\x20listening\x20on\x20port:\x20','11XQmGqv','writeFileSync','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','replace','Loaded\x20credentials:','robot\x20not\x20found','send','startsWith','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','mesh','initialize','topic','\x20attempts\x20starting\x20from\x20','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','getAttribute','Connected\x20to\x20server','axios','child_process','warn','Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file','largeDataTopics','log','forward','existsSync','response','String\x20value\x20is:\x20','Failed\x20to\x20register\x20with\x20server','getTopicStrategy','call_service','EADDRINUSE','Bearer\x20','types','Registering\x20with\x20server...','xmldom','login','trim','\x20of\x20','PORT','.mesh','OPTIONS','share','148964aGVkfm','samplingRate','.stl','slice','request_id','getStatistics','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','getToken','Access-Control-Allow-Origin','proxyPort','type','application/json','APP_USERNAME','param_name','Failed\x20to\x20ping\x20server:','status','method','robotId','values','Connected\x20to\x20ROSBridge\x20(WebRTC)','config','text/xml','length','string','Attempting\x20to\x20login\x20to:','filename','parse','package://','/rosbridge?type=appliance&token=','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','readFileSync','Enter\x20password:\x20','(((.+)+)+)+$','error','.ply','username','dotenv','loadConfig','exit','wsEndpoint','[MESH]\x20Successfully\x20served\x20mesh:\x20','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','\x0aAPP_PASSWORD=','strategies','SET','.dae','Authentication\x20required','/rosapi/topics','ROSBridge\x20WebSocket\x20URL:\x20','http','uri','setAttribute','webrtc_skip','24WiSNkK','unlinkSync','roslib','Backend\x20Server\x20URL:\x20','Successfully\x20registered\x20with\x20server','readyState','Loaded\x20appliance\x20identity:','some','estimatedSize','discoverTopics','strategy','Successfully\x20logged\x20in','registration_token','close','toLowerCase','NODE_ENV','Mesh\x20file\x20not\x20found:\x20','Topic\x20discovery\x20failed:','utf8','json','action','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','open','APP_USERNAME=','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','parseFromString','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','constructor','registrationToken','get','topics','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','message','urdf_param_data','ROSBridge\x20(main)\x20connection\x20error:','env','9794376uTEOUF','Initial\x20credentials\x20loaded\x20from\x20environment','toString','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS'];a1_0x60d3=function(){return _0xe22ac8;};return a1_0x60d3();}function connectToRosbridgeWebRTC(){const _0x3d9ef0=a1_0x4034d0;try{rosbridgeWebRTCWs=new WebSocket(config[_0x3d9ef0(0x128)][_0x3d9ef0(0x17d)]),rosbridgeWebRTCWs['on']('open',()=>{const _0x3f53b7=_0x3d9ef0;console[_0x3f53b7(0x142)](_0x3f53b7(0x169)),webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x3d9ef0(0x1ab),_0x52e505=>{}),rosbridgeWebRTCWs['on'](_0x3d9ef0(0x198),()=>{const _0x119598=_0x3d9ef0;console['log'](_0x119598(0x10d)),webrtcService[_0x119598(0x12a)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x3d9ef0(0x177),_0x5a0954=>{const _0xfd93b5=_0x3d9ef0;console['error'](_0xfd93b5(0x10f),_0x5a0954);});}catch(_0x3bc490){console[_0x3d9ef0(0x177)](_0x3d9ef0(0x15c),_0x3bc490),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x16960d=a1_0x4034d0;try{if(!registrationToken)throw new Error(_0x16960d(0xed));const _0x336f4c=config[_0x16960d(0xef)][_0x16960d(0x130)](_0x16960d(0x187),'ws')+_0x16960d(0x172)+registrationToken;serverWs=new WebSocket(_0x336f4c),serverWs['on'](_0x16960d(0x1a1),()=>{const _0x3820d8=_0x16960d;console['log'](_0x3820d8(0x13c)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x3820d8(0x190)]===WebSocket['OPEN']&&webrtcService[_0x3820d8(0x137)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x16960d(0x1ab),_0x1094a2=>{const _0x21d422=_0x16960d;if(rosbridgeWs&&rosbridgeWs['readyState']===WebSocket['OPEN']){let _0x603401=_0x1094a2[_0x21d422(0x1b1)]();try{const _0x2a6e50=JSON[_0x21d422(0x170)](_0x603401);if(webrtcService[_0x21d422(0x115)](_0x2a6e50))return;if(_0x2a6e50['op']==='get_urdf_param'&&typeof _0x2a6e50[_0x21d422(0x163)]===_0x21d422(0x16d)&&_0x2a6e50[_0x21d422(0x15a)])try{console['log'](_0x21d422(0x1ba)+_0x2a6e50[_0x21d422(0x163)]);const _0x1b788a=execSync('ros2\x20param\x20get\x20'+_0x2a6e50[_0x21d422(0x163)],{'encoding':_0x21d422(0x19d)})[_0x21d422(0x150)]();let _0x2f0189=_0x1b788a;_0x1b788a[_0x21d422(0x134)](_0x21d422(0x146))&&(_0x2f0189=_0x1b788a['substring'](_0x21d422(0x146)[_0x21d422(0x16c)]()));_0x2f0189[_0x21d422(0x134)]('\x22')&&_0x2f0189['endsWith']('\x22')&&(_0x2f0189=_0x2f0189[_0x21d422(0x159)](0x1,-0x1));_0x2f0189=_0x2f0189[_0x21d422(0x130)](/\\n/g,'\x0a')[_0x21d422(0x130)](/\\"/g,'\x22');const _0x3228e9={'op':_0x21d422(0x1ac),'request_id':_0x2a6e50['request_id'],'data':_0x2f0189};serverWs[_0x21d422(0x133)](JSON[_0x21d422(0xfc)](_0x3228e9)),console[_0x21d422(0x142)](_0x21d422(0x102)+_0x2a6e50[_0x21d422(0x163)]);return;}catch(_0x2c157a){console[_0x21d422(0x177)](_0x21d422(0x135),_0x2c157a);const _0xea27f0={'op':_0x21d422(0x1ac),'request_id':_0x2a6e50[_0x21d422(0x15a)],'error':_0x2c157a[_0x21d422(0x1ab)]};serverWs[_0x21d422(0x133)](JSON[_0x21d422(0xfc)](_0xea27f0));return;}if(_0x2a6e50['op']===_0x21d422(0x11f)&&typeof _0x2a6e50['uri']===_0x21d422(0x16d)&&_0x2a6e50['request_id'])try{const _0x33dacb=_0x2a6e50[_0x21d422(0x188)][_0x21d422(0xfe)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x33dacb){const _0x2fe235=_0x33dacb[0x1],_0x17c1b0=_0x33dacb[0x2],_0x383e96=execSync('ros2\x20pkg\x20prefix\x20'+_0x2fe235,{'encoding':_0x21d422(0x19d)})['trim'](),_0xce3a41=path[_0x21d422(0x1b4)](_0x383e96,_0x21d422(0x155),_0x2fe235,_0x17c1b0);if(!fs[_0x21d422(0x144)](_0xce3a41))throw new Error(_0x21d422(0x19b)+_0xce3a41);const _0x2a2db9=fs['readFileSync'](_0xce3a41),_0x12e734={'op':_0x21d422(0x124),'request_id':_0x2a6e50['request_id'],'data':_0x2a2db9[_0x21d422(0x1b1)]('base64')};serverWs[_0x21d422(0x133)](JSON[_0x21d422(0xfc)](_0x12e734)),console[_0x21d422(0x142)](_0x21d422(0x17e)+_0x2a6e50[_0x21d422(0x188)]+'\x20from\x20'+_0xce3a41);return;}}catch(_0x1df5aa){console[_0x21d422(0x177)](_0x21d422(0x116),_0x1df5aa);const _0x35bd42={'op':_0x21d422(0x124),'request_id':_0x2a6e50['request_id'],'error':_0x1df5aa[_0x21d422(0x1ab)]};serverWs['send'](JSON['stringify'](_0x35bd42));return;}rosbridgeWs['send'](_0x603401);}catch(_0x589698){rosbridgeWs[_0x21d422(0x133)](_0x603401);}}}),serverWs['on'](_0x16960d(0x198),(_0x368bf3,_0x916d99)=>{const _0x5cb8b8=_0x16960d;console[_0x5cb8b8(0x142)]('Disconnected\x20from\x20server\x20('+_0x368bf3+':\x20'+_0x916d99+_0x5cb8b8(0x11b)),webrtcService[_0x5cb8b8(0x12a)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x16960d(0x177),_0x13f9e2=>{const _0x1a6737=_0x16960d;console[_0x1a6737(0x177)](_0x1a6737(0xf5),_0x13f9e2);});}catch(_0x4e9abb){console['error']('Failed\x20to\x20connect\x20to\x20server:',_0x4e9abb),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x28738f,_0x2c986f,_0x47ae5a)=>{const _0x3f5dc4=a1_0x4034d0;if(!authService[_0x3f5dc4(0x1b3)]()){console[_0x3f5dc4(0x142)](_0x3f5dc4(0x16e),config[_0x3f5dc4(0xef)]);const _0x5a3f2a=await authService[_0x3f5dc4(0x14f)]();if(!_0x5a3f2a)return _0x2c986f[_0x3f5dc4(0x165)](0x191)[_0x3f5dc4(0x19e)]({'error':_0x3f5dc4(0x184)});}_0x47ae5a();};app['use']((_0x7485ee,_0x220979,_0x568258)=>{const _0x48e300=a1_0x4034d0;_0x220979[_0x48e300(0x118)](_0x48e300(0x15e),'*'),_0x220979[_0x48e300(0x118)]('Access-Control-Allow-Methods',_0x48e300(0x1b2)),_0x220979['header']('Access-Control-Allow-Headers','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization'),_0x7485ee[_0x48e300(0x166)]===_0x48e300(0x154)?_0x220979[_0x48e300(0x103)](0xc8):_0x568258();}),app[a1_0x4034d0(0x1a8)]('/',requireAuth,(_0x1b51b8,_0x2a438f)=>{const _0xef7798=a1_0x4034d0;_0x2a438f[_0xef7798(0x133)]('Appliance\x20is\x20running\x20and\x20authenticated!');}),app['get']('/health',async(_0x548a9f,_0x52d7ee)=>{const _0x35a192=a1_0x4034d0,_0x559ce7=authService['isAuthenticated'](),_0x57a010=webrtcService['getActiveSessions'](),_0x193cc4=webrtcService[_0x35a192(0x104)](),_0x314b96=topicManager[_0x35a192(0x15b)]();_0x52d7ee[_0x35a192(0x19e)]({'status':'ok','environment':process[_0x35a192(0x1ae)]['NODE_ENV']||_0x35a192(0x101),'backendUrl':config[_0x35a192(0xef)],'rosbridgeUrl':config[_0x35a192(0x128)]['wsEndpoint'],'proxyPort':port,'authenticated':_0x559ce7,'topicManagement':{'discovered':_0x314b96['totalTopics'],'strategies':_0x314b96[_0x35a192(0x181)],'largeDataTopics':_0x314b96[_0x35a192(0x141)][_0x35a192(0x16c)],'largeTopicsList':_0x314b96['largeDataTopics']},'webrtc':{'activeSessions':_0x57a010[_0x35a192(0x16c)],'sharedVideoSources':_0x193cc4[_0x35a192(0x16c)],'sessions':_0x57a010,'sharedSources':_0x193cc4}});});const getInitialPort=()=>{const _0x29637f=a1_0x4034d0;if(process[_0x29637f(0x1ae)][_0x29637f(0x152)])return parseInt(process[_0x29637f(0x1ae)]['PORT'],0xa);return config[_0x29637f(0x128)][_0x29637f(0x15f)];};async function listenWithRetries(_0x74b209,_0x61ea0e,_0x3ad3b4=0xa){const _0x1ed7bc=a1_0x4034d0;let _0x4614c1=_0x61ea0e;for(let _0x576e61=0x1;_0x576e61<=_0x3ad3b4;_0x576e61++){try{return await new Promise((_0x3b24c6,_0x2646f4)=>{const _0x412ff5=a1_0x48a6,_0x4bb68b=_0x74b209[_0x412ff5(0xf8)](_0x4614c1,()=>{const _0x355a04=_0x412ff5;console[_0x355a04(0x142)](_0x355a04(0x10e)+_0x4614c1),_0x3b24c6(_0x4bb68b);});_0x4bb68b['on'](_0x412ff5(0x177),_0x5829cd=>{const _0x2a223d=_0x412ff5;_0x5829cd['code']===_0x2a223d(0x14a)?(console[_0x2a223d(0x13f)]('Port\x20'+_0x4614c1+_0x2a223d(0x1b5)),_0x2646f4(_0x5829cd)):_0x2646f4(_0x5829cd);});}),_0x4614c1;}catch(_0x28402a){_0x4614c1++;}}throw new Error(_0x1ed7bc(0x11d)+_0x3ad3b4+_0x1ed7bc(0x139)+_0x61ea0e);}const startApp=async()=>{const _0x1f5852=a1_0x4034d0;try{reloadEnv();let _0xa59adb=await authService[_0x1f5852(0x14f)]();while(!_0xa59adb){console[_0x1f5852(0x142)](_0x1f5852(0x1aa)),await promptForCredentials(),_0xa59adb=await authService[_0x1f5852(0x14f)]();}console[_0x1f5852(0x142)](_0x1f5852(0x196));!loadApplianceIdentity()&&console[_0x1f5852(0x142)](_0x1f5852(0x13a));console[_0x1f5852(0x142)](_0x1f5852(0x14d));const _0x2c7c48=await registerWithServer();if(!_0x2c7c48)throw new Error(_0x1f5852(0x147));connectToRosbridge(),connectToServer();const _0x4a459e=getInitialPort();await listenWithRetries(app,_0x4a459e,0xa);}catch(_0x3a168f){console[_0x1f5852(0x177)](_0x1f5852(0x1b6),_0x3a168f),process[_0x1f5852(0x17c)](0x1);}};setInterval(async()=>{const _0x205ed8=a1_0x4034d0;try{if(robotId){const _0x570b7a=authService['getToken']();await axios[_0x205ed8(0xf2)](config[_0x205ed8(0xef)]+'/appliance/ping',{'robotId':robotId},{'headers':{'Authorization':_0x205ed8(0x14b)+_0x570b7a,'Content-Type':_0x205ed8(0x161)}});}}catch(_0x279502){console[_0x205ed8(0x177)](_0x205ed8(0x164),_0x279502['message']);}},0x1388),startApp();