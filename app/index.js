const a1_0x8cc654=a1_0x214c;(function(_0x5994e6,_0x7c63ee){const _0x637001=a1_0x214c,_0x2086bf=_0x5994e6();while(!![]){try{const _0x477d4b=parseInt(_0x637001(0x244))/0x1+parseInt(_0x637001(0x21f))/0x2*(parseInt(_0x637001(0x263))/0x3)+parseInt(_0x637001(0x268))/0x4*(-parseInt(_0x637001(0x24c))/0x5)+parseInt(_0x637001(0x214))/0x6*(-parseInt(_0x637001(0x202))/0x7)+-parseInt(_0x637001(0x1f0))/0x8*(parseInt(_0x637001(0x25b))/0x9)+-parseInt(_0x637001(0x27d))/0xa+-parseInt(_0x637001(0x203))/0xb*(-parseInt(_0x637001(0x276))/0xc);if(_0x477d4b===_0x7c63ee)break;else _0x2086bf['push'](_0x2086bf['shift']());}catch(_0x1ba422){_0x2086bf['push'](_0x2086bf['shift']());}}}(a1_0x85fc,0x696de));const a1_0x16dd9c=(function(){let _0x55498e=!![];return function(_0x2cd9f6,_0x1e5943){const _0x457699=_0x55498e?function(){const _0x5c0362=a1_0x214c;if(_0x1e5943){const _0x46f605=_0x1e5943[_0x5c0362(0x285)](_0x2cd9f6,arguments);return _0x1e5943=null,_0x46f605;}}:function(){};return _0x55498e=![],_0x457699;};}()),a1_0x3b9bda=a1_0x16dd9c(this,function(){const _0x176136=a1_0x214c;return a1_0x3b9bda[_0x176136(0x252)]()[_0x176136(0x224)](_0x176136(0x282))['toString']()[_0x176136(0x24d)](a1_0x3b9bda)['search']('(((.+)+)+)+$');});a1_0x3b9bda();const express=require('express'),config=require(a1_0x8cc654(0x226)),authService=require(a1_0x8cc654(0x1ff)),webrtcService=require(a1_0x8cc654(0x1f3)),topicManager=require('./services/TopicManager'),WebSocket=require('ws'),axios=require(a1_0x8cc654(0x1ea)),fs=require('fs'),prompt=require(a1_0x8cc654(0x1d1))({'sigint':!![]}),dotenv=require('dotenv'),app=express(),port=process[a1_0x8cc654(0x1d4)][a1_0x8cc654(0x1e5)]||config[a1_0x8cc654(0x212)][a1_0x8cc654(0x262)],APPLIANCE_FILE=a1_0x8cc654(0x1e3),{DOMParser,XMLSerializer}=require(a1_0x8cc654(0x204)),path=require(a1_0x8cc654(0x1d9)),{execSync}=require(a1_0x8cc654(0x1f5)),APPLIANCE_BASE_URL=process[a1_0x8cc654(0x1d4)]['APPLIANCE_BASE_URL']||'';console[a1_0x8cc654(0x219)](a1_0x8cc654(0x201)+(process['env']['NODE_ENV']||a1_0x8cc654(0x210))),console[a1_0x8cc654(0x219)](a1_0x8cc654(0x254)+config['serverUrl']),console[a1_0x8cc654(0x219)](a1_0x8cc654(0x1ee)+config[a1_0x8cc654(0x212)][a1_0x8cc654(0x280)]),console[a1_0x8cc654(0x219)]('Proxy\x20listening\x20on\x20port:\x20'+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x59a136,_0x15b2ed){const _0x3d035b=a1_0x8cc654;fs[_0x3d035b(0x245)](_0x3d035b(0x246),'APP_USERNAME='+_0x59a136+_0x3d035b(0x26c)+_0x15b2ed+'\x0a');}function reloadEnv(){const _0xa80b81=a1_0x8cc654;dotenv['config']({'override':!![]}),config[_0xa80b81(0x250)][_0xa80b81(0x23a)]=process[_0xa80b81(0x1d4)][_0xa80b81(0x22e)],config[_0xa80b81(0x250)]['password']=process[_0xa80b81(0x1d4)]['APP_PASSWORD'];}async function promptForCredentials(){const _0xa402d7=a1_0x8cc654,_0x30f81f=prompt(_0xa402d7(0x1de)),_0x18d66e=prompt['hide'](_0xa402d7(0x274));updateEnvFile(_0x30f81f,_0x18d66e),reloadEnv();}function loadApplianceIdentity(){const _0x4827fa=a1_0x8cc654;if(fs[_0x4827fa(0x1e0)](APPLIANCE_FILE))try{const _0x550511=JSON['parse'](fs['readFileSync'](APPLIANCE_FILE,_0x4827fa(0x205)));if(_0x550511['robotId']&&_0x550511[_0x4827fa(0x23f)])return robotId=_0x550511['robotId'],registrationToken=_0x550511[_0x4827fa(0x23f)],console['log'](_0x4827fa(0x234),robotId),topicManager[_0x4827fa(0x27f)](_0x550511),!![];}catch(_0x4f9a39){console['error'](_0x4827fa(0x267),_0x4f9a39);}return![];}function a1_0x85fc(){const _0x2955f3=['/appliance/ping','NODE_ENV','endsWith','param_name','Connected\x20to\x20server','Enter\x20password:\x20','\x20->\x20','12dogOzV','msg','toLowerCase','forward','/rosapi/topics','strategy','[MESH]\x20Successfully\x20served\x20mesh:\x20','5349050DjTNrZ','Successfully\x20logged\x20in','loadConfig','wsEndpoint','Connected\x20to\x20ROSBridge\x20(main)','(((.+)+)+)+$','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','handleMessage','apply','service_response','isAuthenticated','publish','totalTopics','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','use','/ros/mesh?uri=','Mesh\x20file\x20not\x20found:\x20','error','.stl','startsWith','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','/health','connection','map','prompt-sync','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','message','env','getStatistics','header','samplingRate','readyState','path','length','stringify','get_urdf_param','close','Enter\x20username:\x20','Failed\x20to\x20connect\x20to\x20server:','existsSync','service','\x20from\x20','.appliance.json','request_id','PORT','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','getSharedVideoSources','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','join','axios','sample_skip','replace','Failed\x20to\x20start\x20application:','ROSBridge\x20WebSocket\x20URL:\x20','reason','3066544iWtPSo','name','string','./services/webrtcService','roslib','child_process','Successfully\x20registered\x20with\x20server','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','Server\x20connection\x20error:','getElementsByTagName','Appliance\x20is\x20running\x20and\x20authenticated!','webrtc_skip','/robot_description','sendStatus','some','./services/auth','/appliance/register','Environment:\x20','7SuWHMt','25172785CdCyAn','xmldom','utf8','listen','getToken','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','unknown','mesh','topic','WSL\x20Appliance','development','open','rosbridge','ROSBridge\x20(main)\x20connection\x20error:','2053218Vpejbe','readFileSync','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','estimatedSize','[MESH]\x20Error\x20serving\x20mesh:','log','exit','slice','OPEN','/rosbridge?type=appliance&token=','types','45418TCXQEY','topics','call_service','serverUrl','initialize','search','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','./config','Failed\x20to\x20register\x20with\x20server:','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','Topic\x20discovery\x20failed:','status','uri','action','filename','APP_USERNAME','substring','throttling','warn','.dae','.mesh','Loaded\x20appliance\x20identity:','parseFromString','send','Not\x20authenticated','Connected\x20to\x20ROSBridge\x20(WebRTC)','Ros','username','Failed\x20to\x20register\x20with\x20server','share','http','Access-Control-Allow-Methods','registrationToken','stopAllSessions','values','parse','robotId','348110jfIYQM','writeFileSync','.env','Authentication\x20required','\x20of\x20','Failed\x20to\x20ping\x20server:','text/xml','includes','5zxNyNX','constructor','Disconnected\x20from\x20server\x20(','login','credentials','Bearer\x20','toString','match','Backend\x20Server\x20URL:\x20','largeDataTopics','EADDRINUSE','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','mesh_data','\x20in\x20use,\x20trying\x20next\x20port...','getTopicStrategy','18yuVsbM','Attempting\x20to\x20login\x20to:','\x20attempts\x20starting\x20from\x20','Port\x20','String\x20value\x20is:\x20','data','code','proxyPort','12VMOwVr','serializeToString','unlinkSync','registration_token','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','2607196pIMGmd','json','setAttribute','application/json','\x0aAPP_PASSWORD=','OPTIONS','response'];a1_0x85fc=function(){return _0x2955f3;};return a1_0x85fc();}function saveApplianceIdentity(_0x5e58a9,_0x615884){const _0x101416=a1_0x8cc654;let _0x431ec7={};if(fs['existsSync'](APPLIANCE_FILE))try{_0x431ec7=JSON[_0x101416(0x242)](fs[_0x101416(0x215)](APPLIANCE_FILE,_0x101416(0x205)));}catch(_0x5c79c4){_0x431ec7={};}_0x431ec7[_0x101416(0x243)]=_0x5e58a9,_0x431ec7[_0x101416(0x23f)]=_0x615884,fs[_0x101416(0x245)](APPLIANCE_FILE,JSON[_0x101416(0x1db)](_0x431ec7,null,0x2));}async function registerWithServer(){const _0x556937=a1_0x8cc654;try{const _0x371e5c=authService['getToken']();if(!_0x371e5c)throw new Error(_0x556937(0x237));let _0x180317,_0x408e92=![];while(!![]){try{robotId&&registrationToken?_0x180317=await axios['post'](config[_0x556937(0x222)]+'/appliance/register',{'name':_0x556937(0x20f),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':'Bearer\x20'+_0x371e5c,'Content-Type':'application/json'}}):_0x180317=await axios['post'](config['serverUrl']+_0x556937(0x200),{'name':_0x556937(0x20f)},{'headers':{'Authorization':'Bearer\x20'+_0x371e5c,'Content-Type':_0x556937(0x26b)}});break;}catch(_0x373ee8){const _0x4678b2=_0x373ee8?.[_0x556937(0x26e)]?.[_0x556937(0x260)]?.['error']||_0x373ee8[_0x556937(0x1d3)];if(!_0x408e92&&_0x4678b2&&_0x4678b2[_0x556937(0x278)]()[_0x556937(0x24b)]('robot\x20not\x20found')){console['warn'](_0x556937(0x293));if(fs[_0x556937(0x1e0)](APPLIANCE_FILE))fs[_0x556937(0x265)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x408e92=!![];continue;}throw _0x373ee8;}}if(!_0x180317['data']||!_0x180317['data'][_0x556937(0x266)]||!_0x180317[_0x556937(0x260)]['id'])throw new Error(_0x556937(0x283));return registrationToken=_0x180317[_0x556937(0x260)][_0x556937(0x266)],robotId=_0x180317[_0x556937(0x260)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x556937(0x219)](_0x556937(0x1f6)),!![];}catch(_0x319def){return console[_0x556937(0x28e)](_0x556937(0x227),_0x319def[_0x556937(0x1d3)]),![];}}function rewriteUrdfMeshUris(_0x3f0768){const _0xc29c97=a1_0x8cc654;try{const _0x5321a8=new DOMParser(),_0x58a208=_0x5321a8[_0xc29c97(0x235)](_0x3f0768,_0xc29c97(0x24a));let _0x6c418d=0x0,_0x239162=0x0;const _0x346df2=_0x58a208[_0xc29c97(0x1f9)](_0xc29c97(0x20d));for(let _0x2d4bcf=0x0;_0x2d4bcf<_0x346df2[_0xc29c97(0x1da)];_0x2d4bcf++){const _0x410746=_0x346df2[_0x2d4bcf],_0x33e617=_0x410746['getAttribute']('filename'),_0x3e9d60=[_0xc29c97(0x28f),_0xc29c97(0x232),'.obj','.ply',_0xc29c97(0x233)],_0x3661de=_0x3e9d60[_0xc29c97(0x1fe)](_0x385882=>_0x33e617[_0xc29c97(0x278)]()[_0xc29c97(0x271)](_0x385882));if(_0x33e617&&_0x33e617[_0xc29c97(0x290)]('package://')&&_0x3661de){_0x6c418d++;const _0x462bea=APPLIANCE_BASE_URL+_0xc29c97(0x28c)+encodeURIComponent(_0x33e617);_0x410746[_0xc29c97(0x26a)](_0xc29c97(0x22d),_0x462bea),_0x239162++,console['log'](_0xc29c97(0x20b)+_0x33e617+_0xc29c97(0x275)+_0x462bea);}}_0x6c418d>0x0?console['log']('[URDF\x20REWRITE]\x20Rewrote\x20'+_0x239162+_0xc29c97(0x248)+_0x6c418d+_0xc29c97(0x28a)):console[_0xc29c97(0x219)](_0xc29c97(0x291));const _0x755c23=new XMLSerializer();return _0x755c23[_0xc29c97(0x264)](_0x58a208);}catch(_0x22e144){return console[_0xc29c97(0x28e)](_0xc29c97(0x257),_0x22e144),_0x3f0768;}}function connectToRosbridge(){const _0x2f7942=a1_0x8cc654;try{rosbridgeWs=new WebSocket(config[_0x2f7942(0x212)][_0x2f7942(0x280)]),rosbridgeWs['on'](_0x2f7942(0x211),()=>{const _0x163eec=_0x2f7942;console['log'](_0x163eec(0x281));const _0x144ec0=require(_0x163eec(0x1f4)),_0x3417bb=new _0x144ec0[(_0x163eec(0x239))]({'url':config[_0x163eec(0x212)][_0x163eec(0x280)]});_0x3417bb['on'](_0x163eec(0x295),()=>{setTimeout(()=>{topicManager['discoverTopics'](_0x3417bb)['catch'](_0x1c487b=>{const _0x5c590b=a1_0x214c;console['error'](_0x5c590b(0x229),_0x1c487b);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x2f7942(0x1d3),_0xde9178=>{const _0x3dda13=_0x2f7942;if(serverWs&&serverWs[_0x3dda13(0x1d8)]===WebSocket[_0x3dda13(0x21c)]){let _0x2e26ee=_0xde9178[_0x3dda13(0x252)]();try{const _0x581e74=JSON[_0x3dda13(0x242)](_0x2e26ee);if(_0x581e74['op']==='publish'&&_0x581e74['topic']){const _0x10d113=topicManager[_0x3dda13(0x284)](_0x581e74);switch(_0x10d113[_0x3dda13(0x22c)]){case _0x3dda13(0x1eb):return;case _0x3dda13(0x1fb):return;case _0x3dda13(0x279):default:_0x2e26ee=JSON[_0x3dda13(0x1db)](_0x10d113['message']);break;}}if((_0x581e74['op']===_0x3dda13(0x286)||_0x581e74['op']===_0x3dda13(0x221))&&(_0x581e74[_0x3dda13(0x1e1)]===_0x3dda13(0x27a)||_0x581e74['values']&&_0x581e74[_0x3dda13(0x241)][_0x3dda13(0x220)])){console[_0x3dda13(0x219)]('[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata');const _0x49143d=_0x581e74['values']?.[_0x3dda13(0x220)]||[],_0xabace0=_0x581e74['values']?.[_0x3dda13(0x21e)]||[],_0x253d97=_0x49143d[_0x3dda13(0x1d0)]((_0x395598,_0x5c8c38)=>{const _0x75aedf=_0x3dda13,_0x49856d=topicManager[_0x75aedf(0x25a)](_0x395598);return{'name':_0x395598,'type':_0xabace0[_0x5c8c38]||_0x75aedf(0x20c),'throttling':_0x49856d?{'isThrottled':_0x49856d['strategy']==='sample','strategy':_0x49856d[_0x75aedf(0x27b)],'samplingRate':_0x49856d[_0x75aedf(0x1d7)],'reason':_0x49856d[_0x75aedf(0x1ef)],'estimatedSize':_0x49856d[_0x75aedf(0x217)]}:null};});_0x581e74['values']={'topics':_0x253d97[_0x3dda13(0x1d0)](_0x29e66f=>_0x29e66f[_0x3dda13(0x1f1)]),'types':_0x253d97[_0x3dda13(0x1d0)](_0x328e72=>_0x328e72['type']),'throttling':_0x253d97[_0x3dda13(0x1d0)](_0x4e05f0=>_0x4e05f0[_0x3dda13(0x230)])},_0x2e26ee=JSON[_0x3dda13(0x1db)](_0x581e74),console[_0x3dda13(0x219)](_0x3dda13(0x20a));}if(_0x581e74['op']===_0x3dda13(0x288)&&_0x581e74[_0x3dda13(0x20e)]===_0x3dda13(0x1fc))try{const _0x2cbddd=_0x581e74['msg']['data'],_0x3e5b75=rewriteUrdfMeshUris(_0x2cbddd);_0x581e74[_0x3dda13(0x277)][_0x3dda13(0x260)]=_0x3e5b75,_0x2e26ee=JSON[_0x3dda13(0x1db)](_0x581e74);}catch(_0x113ebb){console['error']('[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:',_0x113ebb);}}catch(_0x463a1a){console[_0x3dda13(0x231)](_0x3dda13(0x1d2),_0x463a1a['message']);}serverWs[_0x3dda13(0x236)](_0x2e26ee);}}),rosbridgeWs['on'](_0x2f7942(0x1dd),()=>{const _0x21b2a=_0x2f7942;console[_0x21b2a(0x219)](_0x21b2a(0x208)),webrtcService['stopAllSessions'](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x2f7942(0x28e),_0x3a28a4=>{const _0x4ab8b7=_0x2f7942;console[_0x4ab8b7(0x28e)](_0x4ab8b7(0x213),_0x3a28a4);});}catch(_0x17e7ea){console['error'](_0x2f7942(0x225),_0x17e7ea),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x8da4b4=a1_0x8cc654;try{rosbridgeWebRTCWs=new WebSocket(config[_0x8da4b4(0x212)][_0x8da4b4(0x280)]),rosbridgeWebRTCWs['on'](_0x8da4b4(0x211),()=>{const _0x5bfe3d=_0x8da4b4;console[_0x5bfe3d(0x219)](_0x5bfe3d(0x238)),webrtcService[_0x5bfe3d(0x223)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on']('message',_0x5a8045=>{}),rosbridgeWebRTCWs['on'](_0x8da4b4(0x1dd),()=>{const _0x15e70f=_0x8da4b4;console[_0x15e70f(0x219)](_0x15e70f(0x209)),webrtcService[_0x15e70f(0x240)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x8da4b4(0x28e),_0x438301=>{const _0x43cd4b=_0x8da4b4;console[_0x43cd4b(0x28e)]('ROSBridge\x20(WebRTC)\x20connection\x20error:',_0x438301);});}catch(_0x343efb){console[_0x8da4b4(0x28e)](_0x8da4b4(0x1e8),_0x343efb),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x18af42=a1_0x8cc654;try{if(!registrationToken)throw new Error('Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.');const _0x66b842=config['serverUrl'][_0x18af42(0x1ec)](_0x18af42(0x23d),'ws')+_0x18af42(0x21d)+registrationToken;serverWs=new WebSocket(_0x66b842),serverWs['on'](_0x18af42(0x211),()=>{const _0x161e0e=_0x18af42;console['log'](_0x161e0e(0x273)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs['readyState']===WebSocket[_0x161e0e(0x21c)]&&webrtcService[_0x161e0e(0x223)](rosbridgeWebRTCWs,serverWs);}),serverWs['on']('message',_0x1a511=>{const _0x464edd=_0x18af42;if(rosbridgeWs&&rosbridgeWs[_0x464edd(0x1d8)]===WebSocket[_0x464edd(0x21c)]){let _0x24a19c=_0x1a511[_0x464edd(0x252)]();try{const _0x3ffd54=JSON['parse'](_0x24a19c);if(webrtcService[_0x464edd(0x284)](_0x3ffd54))return;if(_0x3ffd54['op']===_0x464edd(0x1dc)&&typeof _0x3ffd54[_0x464edd(0x272)]===_0x464edd(0x1f2)&&_0x3ffd54[_0x464edd(0x1e4)])try{console[_0x464edd(0x219)](_0x464edd(0x292)+_0x3ffd54[_0x464edd(0x272)]);const _0x2cbcdd=execSync('ros2\x20param\x20get\x20'+_0x3ffd54[_0x464edd(0x272)],{'encoding':_0x464edd(0x205)})['trim']();let _0x71eea6=_0x2cbcdd;_0x2cbcdd[_0x464edd(0x290)]('String\x20value\x20is:\x20')&&(_0x71eea6=_0x2cbcdd[_0x464edd(0x22f)](_0x464edd(0x25f)[_0x464edd(0x1da)]()));_0x71eea6[_0x464edd(0x290)]('\x22')&&_0x71eea6[_0x464edd(0x271)]('\x22')&&(_0x71eea6=_0x71eea6[_0x464edd(0x21b)](0x1,-0x1));_0x71eea6=_0x71eea6[_0x464edd(0x1ec)](/\\n/g,'\x0a')[_0x464edd(0x1ec)](/\\"/g,'\x22');const _0x92c500={'op':'urdf_param_data','request_id':_0x3ffd54[_0x464edd(0x1e4)],'data':_0x71eea6};serverWs[_0x464edd(0x236)](JSON[_0x464edd(0x1db)](_0x92c500)),console[_0x464edd(0x219)]('[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20'+_0x3ffd54[_0x464edd(0x272)]);return;}catch(_0x4e9892){console[_0x464edd(0x28e)](_0x464edd(0x1f7),_0x4e9892);const _0x3f6d0d={'op':'urdf_param_data','request_id':_0x3ffd54[_0x464edd(0x1e4)],'error':_0x4e9892[_0x464edd(0x1d3)]};serverWs[_0x464edd(0x236)](JSON[_0x464edd(0x1db)](_0x3f6d0d));return;}if(_0x3ffd54['op']==='get_mesh'&&typeof _0x3ffd54['uri']===_0x464edd(0x1f2)&&_0x3ffd54[_0x464edd(0x1e4)])try{const _0x24198f=_0x3ffd54[_0x464edd(0x22b)][_0x464edd(0x253)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x24198f){const _0x48be20=_0x24198f[0x1],_0x33d0f8=_0x24198f[0x2],_0x152bb8=execSync('ros2\x20pkg\x20prefix\x20'+_0x48be20,{'encoding':_0x464edd(0x205)})['trim'](),_0x2eb493=path[_0x464edd(0x1e9)](_0x152bb8,_0x464edd(0x23c),_0x48be20,_0x33d0f8);if(!fs['existsSync'](_0x2eb493))throw new Error(_0x464edd(0x28d)+_0x2eb493);const _0x37cbae=fs['readFileSync'](_0x2eb493),_0x3912f7={'op':_0x464edd(0x258),'request_id':_0x3ffd54[_0x464edd(0x1e4)],'data':_0x37cbae[_0x464edd(0x252)]('base64')};serverWs[_0x464edd(0x236)](JSON[_0x464edd(0x1db)](_0x3912f7)),console[_0x464edd(0x219)](_0x464edd(0x27c)+_0x3ffd54[_0x464edd(0x22b)]+_0x464edd(0x1e2)+_0x2eb493);return;}}catch(_0x3c8574){console[_0x464edd(0x28e)](_0x464edd(0x218),_0x3c8574);const _0x4319ad={'op':_0x464edd(0x258),'request_id':_0x3ffd54[_0x464edd(0x1e4)],'error':_0x3c8574['message']};serverWs[_0x464edd(0x236)](JSON['stringify'](_0x4319ad));return;}rosbridgeWs['send'](_0x24a19c);}catch(_0x1afec7){rosbridgeWs['send'](_0x24a19c);}}}),serverWs['on'](_0x18af42(0x1dd),(_0xa069bf,_0x2972a0)=>{const _0x285fa4=_0x18af42;console[_0x285fa4(0x219)](_0x285fa4(0x24e)+_0xa069bf+':\x20'+_0x2972a0+'),\x20attempting\x20to\x20reconnect...'),webrtcService['stopAllSessions'](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x18af42(0x28e),_0x111c59=>{const _0x425ad0=_0x18af42;console['error'](_0x425ad0(0x1f8),_0x111c59);});}catch(_0x23ba6a){console[_0x18af42(0x28e)](_0x18af42(0x1df),_0x23ba6a),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x762e91,_0x4ee78d,_0x981c2c)=>{const _0x51d323=a1_0x8cc654;if(!authService[_0x51d323(0x287)]()){console[_0x51d323(0x219)](_0x51d323(0x25c),config[_0x51d323(0x222)]);const _0x4cd4de=await authService[_0x51d323(0x24f)]();if(!_0x4cd4de)return _0x4ee78d[_0x51d323(0x22a)](0x191)[_0x51d323(0x269)]({'error':_0x51d323(0x247)});}_0x981c2c();};app[a1_0x8cc654(0x28b)]((_0x3e3c62,_0x28f992,_0x102137)=>{const _0x449ddc=a1_0x8cc654;_0x28f992['header']('Access-Control-Allow-Origin','*'),_0x28f992[_0x449ddc(0x1d6)](_0x449ddc(0x23e),_0x449ddc(0x1e6)),_0x28f992[_0x449ddc(0x1d6)]('Access-Control-Allow-Headers','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization'),_0x3e3c62['method']===_0x449ddc(0x26d)?_0x28f992[_0x449ddc(0x1fd)](0xc8):_0x102137();}),app['get']('/',requireAuth,(_0x441ab5,_0x4d0c2d)=>{const _0xf8588e=a1_0x8cc654;_0x4d0c2d[_0xf8588e(0x236)](_0xf8588e(0x1fa));}),app['get'](a1_0x8cc654(0x294),async(_0x1e8f73,_0x5aaea3)=>{const _0xa4fb70=a1_0x8cc654,_0x16b9d4=authService[_0xa4fb70(0x287)](),_0x4b72ab=webrtcService['getActiveSessions'](),_0x4a1bfe=webrtcService[_0xa4fb70(0x1e7)](),_0x2a5b83=topicManager[_0xa4fb70(0x1d5)]();_0x5aaea3[_0xa4fb70(0x269)]({'status':'ok','environment':process[_0xa4fb70(0x1d4)][_0xa4fb70(0x270)]||_0xa4fb70(0x210),'backendUrl':config[_0xa4fb70(0x222)],'rosbridgeUrl':config['rosbridge'][_0xa4fb70(0x280)],'proxyPort':port,'authenticated':_0x16b9d4,'topicManagement':{'discovered':_0x2a5b83[_0xa4fb70(0x289)],'strategies':_0x2a5b83['strategies'],'largeDataTopics':_0x2a5b83[_0xa4fb70(0x255)][_0xa4fb70(0x1da)],'largeTopicsList':_0x2a5b83[_0xa4fb70(0x255)]},'webrtc':{'activeSessions':_0x4b72ab[_0xa4fb70(0x1da)],'sharedVideoSources':_0x4a1bfe[_0xa4fb70(0x1da)],'sessions':_0x4b72ab,'sharedSources':_0x4a1bfe}});});const getInitialPort=()=>{const _0x52ae59=a1_0x8cc654;if(process[_0x52ae59(0x1d4)][_0x52ae59(0x1e5)])return parseInt(process[_0x52ae59(0x1d4)][_0x52ae59(0x1e5)],0xa);return config['rosbridge'][_0x52ae59(0x262)];};function a1_0x214c(_0x406dd3,_0x4e1a67){const _0x47aba9=a1_0x85fc();return a1_0x214c=function(_0x3b9bda,_0x16dd9c){_0x3b9bda=_0x3b9bda-0x1d0;let _0x85fc5f=_0x47aba9[_0x3b9bda];return _0x85fc5f;},a1_0x214c(_0x406dd3,_0x4e1a67);}async function listenWithRetries(_0x1da1b9,_0xb770a,_0x4c1fad=0xa){const _0x18296f=a1_0x8cc654;let _0x4a7780=_0xb770a;for(let _0x307ee0=0x1;_0x307ee0<=_0x4c1fad;_0x307ee0++){try{return await new Promise((_0x5d8d6c,_0x40e218)=>{const _0x32d9d0=a1_0x214c,_0x51c216=_0x1da1b9[_0x32d9d0(0x206)](_0x4a7780,()=>{const _0x1ef68e=_0x32d9d0;console[_0x1ef68e(0x219)](_0x1ef68e(0x216)+_0x4a7780),_0x5d8d6c(_0x51c216);});_0x51c216['on']('error',_0x5c7c8f=>{const _0x56fa63=_0x32d9d0;_0x5c7c8f[_0x56fa63(0x261)]===_0x56fa63(0x256)?(console['warn'](_0x56fa63(0x25e)+_0x4a7780+_0x56fa63(0x259)),_0x40e218(_0x5c7c8f)):_0x40e218(_0x5c7c8f);});}),_0x4a7780;}catch(_0x4fefdd){_0x4a7780++;}}throw new Error('Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20'+_0x4c1fad+_0x18296f(0x25d)+_0xb770a);}const startApp=async()=>{const _0x335c25=a1_0x8cc654;try{let _0x594fbe=await authService[_0x335c25(0x24f)]();while(!_0x594fbe){console[_0x335c25(0x219)](_0x335c25(0x228)),await promptForCredentials(),_0x594fbe=await authService[_0x335c25(0x24f)]();}console[_0x335c25(0x219)](_0x335c25(0x27e));!loadApplianceIdentity()&&console[_0x335c25(0x219)]('No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.');console['log']('Registering\x20with\x20server...');const _0x2b3eb9=await registerWithServer();if(!_0x2b3eb9)throw new Error(_0x335c25(0x23b));connectToRosbridge(),connectToServer();const _0x442f0a=getInitialPort();await listenWithRetries(app,_0x442f0a,0xa);}catch(_0x14ecee){console['error'](_0x335c25(0x1ed),_0x14ecee),process[_0x335c25(0x21a)](0x1);}};setInterval(async()=>{const _0x412457=a1_0x8cc654;try{if(robotId){const _0x3a147c=authService[_0x412457(0x207)]();await axios['post'](config[_0x412457(0x222)]+_0x412457(0x26f),{'robotId':robotId},{'headers':{'Authorization':_0x412457(0x251)+_0x3a147c,'Content-Type':'application/json'}});}}catch(_0x93961e){console[_0x412457(0x28e)](_0x412457(0x249),_0x93961e[_0x412457(0x1d3)]);}},0x1388),startApp();