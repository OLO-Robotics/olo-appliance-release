const a1_0x1aac81=a1_0x4dde;(function(_0x4cacb6,_0x59ebee){const _0x4aaf70=a1_0x4dde,_0x53de5b=_0x4cacb6();while(!![]){try{const _0x3f723e=-parseInt(_0x4aaf70(0x1be))/0x1*(parseInt(_0x4aaf70(0x1a1))/0x2)+parseInt(_0x4aaf70(0x1cd))/0x3+-parseInt(_0x4aaf70(0x133))/0x4+-parseInt(_0x4aaf70(0x140))/0x5*(parseInt(_0x4aaf70(0x15e))/0x6)+parseInt(_0x4aaf70(0x1aa))/0x7*(parseInt(_0x4aaf70(0x114))/0x8)+-parseInt(_0x4aaf70(0x1a5))/0x9*(parseInt(_0x4aaf70(0x149))/0xa)+parseInt(_0x4aaf70(0x128))/0xb;if(_0x3f723e===_0x59ebee)break;else _0x53de5b['push'](_0x53de5b['shift']());}catch(_0x554059){_0x53de5b['push'](_0x53de5b['shift']());}}}(a1_0x5ee5,0x964a4));const a1_0x262e59=(function(){let _0x2c3091=!![];return function(_0x83bdb9,_0x11bf23){const _0xd1330c=_0x2c3091?function(){const _0x143bff=a1_0x4dde;if(_0x11bf23){const _0x31aa71=_0x11bf23[_0x143bff(0x111)](_0x83bdb9,arguments);return _0x11bf23=null,_0x31aa71;}}:function(){};return _0x2c3091=![],_0xd1330c;};}()),a1_0x5010b0=a1_0x262e59(this,function(){const _0x427a68=a1_0x4dde;return a1_0x5010b0[_0x427a68(0x1ca)]()[_0x427a68(0x1c7)](_0x427a68(0x1ad))[_0x427a68(0x1ca)]()[_0x427a68(0x19e)](a1_0x5010b0)['search']('(((.+)+)+)+$');});a1_0x5010b0();const express=require(a1_0x1aac81(0x11f)),config=require(a1_0x1aac81(0x15c)),authService=require(a1_0x1aac81(0x141)),webrtcService=require(a1_0x1aac81(0x178)),topicManager=require('./services/TopicManager'),WebSocket=require('ws'),axios=require(a1_0x1aac81(0x15b)),fs=require('fs'),prompt=require(a1_0x1aac81(0x1ae))({'sigint':!![]}),dotenv=require(a1_0x1aac81(0x14a)),app=express(),port=process[a1_0x1aac81(0x113)][a1_0x1aac81(0x14e)]||config[a1_0x1aac81(0x17c)]['proxyPort'],APPLIANCE_FILE=a1_0x1aac81(0x148),{DOMParser,XMLSerializer}=require('xmldom'),path=require(a1_0x1aac81(0x18e)),{execSync}=require('child_process'),APPLIANCE_BASE_URL=process[a1_0x1aac81(0x113)]['APPLIANCE_BASE_URL']||'';console[a1_0x1aac81(0x1b5)](a1_0x1aac81(0x1bc)+(process[a1_0x1aac81(0x113)][a1_0x1aac81(0x161)]||a1_0x1aac81(0x13e))),console['log'](a1_0x1aac81(0x16d)+config['serverUrl']),console[a1_0x1aac81(0x1b5)]('ROSBridge\x20WebSocket\x20URL:\x20'+config[a1_0x1aac81(0x17c)]['wsEndpoint']),console[a1_0x1aac81(0x1b5)](a1_0x1aac81(0x11a)+port);function a1_0x4dde(_0x1b47c9,_0x3e5eca){const _0x4cacba=a1_0x5ee5();return a1_0x4dde=function(_0x5010b0,_0x262e59){_0x5010b0=_0x5010b0-0x10c;let _0x5ee5fc=_0x4cacba[_0x5010b0];return _0x5ee5fc;},a1_0x4dde(_0x1b47c9,_0x3e5eca);}let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x21046d,_0x248352){const _0x1179ce=a1_0x1aac81;fs[_0x1179ce(0x147)](_0x1179ce(0x19c),_0x1179ce(0x15a)+_0x21046d+_0x1179ce(0x150)+_0x248352+'\x0a');}function reloadEnv(){const _0x56ad3d=a1_0x1aac81;dotenv[_0x56ad3d(0x18f)]({'override':!![]}),config[_0x56ad3d(0x127)][_0x56ad3d(0x198)]=process[_0x56ad3d(0x113)]['APP_USERNAME'],config[_0x56ad3d(0x127)][_0x56ad3d(0x142)]=process[_0x56ad3d(0x113)][_0x56ad3d(0x145)];}async function promptForCredentials(){const _0x4fa5a5=a1_0x1aac81,_0x23c415=prompt(_0x4fa5a5(0x18c)),_0x180b4b=prompt[_0x4fa5a5(0x13b)]('Enter\x20password:\x20');updateEnvFile(_0x23c415,_0x180b4b),reloadEnv();}function a1_0x5ee5(){const _0x2f06fa=['get_urdf_param','text/xml','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','name','.obj','string','.ply','4745636AgmAwT','trim','Server\x20connection\x20error:','send','ROSBridge\x20(WebRTC)\x20connection\x20error:','discoverTopics','.mesh','values','hide','toLowerCase','Successfully\x20logged\x20in','development','registration_token','520EpzBMG','./services/auth','password','strategy','getAttribute','APP_PASSWORD','strategies','writeFileSync','.appliance.json','30iofPer','dotenv','/appliance/ping','topic','WSL\x20Appliance','PORT','isAuthenticated','\x0aAPP_PASSWORD=','getTopicStrategy','code','OPEN','response','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','request_id','Failed\x20to\x20start\x20application:','topics','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','APP_USERNAME=','axios','./config','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','8460PmcjqN','msg','forward','NODE_ENV','Disconnected\x20from\x20server\x20(','message','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','parseFromString','proxyPort','sendStatus','largeDataTopics','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','Registering\x20with\x20server...','uri','Backend\x20Server\x20URL:\x20','registrationToken','length','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','Loaded\x20appliance\x20identity:','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','login','robot\x20not\x20found','package://','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','Appliance\x20is\x20running\x20and\x20authenticated!','./services/webrtcService','param_name','\x20of\x20','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','rosbridge','EADDRINUSE','json','use','exit','/ros/mesh?uri=','method','Not\x20authenticated','endsWith','service','.dae','\x20attempts\x20starting\x20from\x20','handleMessage','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','samplingRate','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','Enter\x20username:\x20','stringify','path','config','OPTIONS','/rosbridge?type=appliance&token=','slice','listen','warn','map','filename','sample_skip','username','Bearer\x20','/robot_description','includes','.env','types','constructor','Mesh\x20file\x20not\x20found:\x20','readyState','2CbJYFg','stopAllSessions','header','base64','2963475NLcPHz','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','publish','unknown','webrtc_skip','10675etZyJc','connection','[MESH]\x20Successfully\x20served\x20mesh:\x20','(((.+)+)+)+$','prompt-sync','readFileSync','error','ros2\x20param\x20get\x20','Connected\x20to\x20ROSBridge\x20(main)','serverUrl','sample','log','Access-Control-Allow-Methods','Topic\x20discovery\x20failed:','call_service','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','ROSBridge\x20(main)\x20connection\x20error:','getStatistics','Environment:\x20','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','303377TsdnRO','/appliance/register','Access-Control-Allow-Headers','utf8','Attempting\x20to\x20login\x20to:','String\x20value\x20is:\x20','startsWith','unlinkSync','replace','search','urdf_param_data','initialize','toString','existsSync','Successfully\x20registered\x20with\x20server','217215rogsPm','application/json','post','serializeToString','getSharedVideoSources','robotId','apply','Connected\x20to\x20server','env','4568OYLRbU','substring','getToken','service_response','\x20in\x20use,\x20trying\x20next\x20port...','Failed\x20to\x20connect\x20to\x20server:','Proxy\x20listening\x20on\x20port:\x20','open','parse','mesh_data','wsEndpoint','express','Failed\x20to\x20register\x20with\x20server','type','reason','getElementsByTagName','Connected\x20to\x20ROSBridge\x20(WebRTC)','data','get','credentials','25263249AeCriV','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','share','match'];a1_0x5ee5=function(){return _0x2f06fa;};return a1_0x5ee5();}function loadApplianceIdentity(){const _0x220140=a1_0x1aac81;if(fs['existsSync'](APPLIANCE_FILE))try{const _0x2704fb=JSON[_0x220140(0x11c)](fs[_0x220140(0x1af)](APPLIANCE_FILE,_0x220140(0x1c1)));if(_0x2704fb['robotId']&&_0x2704fb['registrationToken'])return robotId=_0x2704fb[_0x220140(0x110)],registrationToken=_0x2704fb[_0x220140(0x16e)],console['log'](_0x220140(0x171),robotId),topicManager['loadConfig'](_0x2704fb),!![];}catch(_0xa493cd){console[_0x220140(0x1b0)](_0x220140(0x159),_0xa493cd);}return![];}function saveApplianceIdentity(_0x45a252,_0x8b240d){const _0x3bc221=a1_0x1aac81;let _0x3a10d6={};if(fs['existsSync'](APPLIANCE_FILE))try{_0x3a10d6=JSON[_0x3bc221(0x11c)](fs[_0x3bc221(0x1af)](APPLIANCE_FILE,_0x3bc221(0x1c1)));}catch(_0x4de628){_0x3a10d6={};}_0x3a10d6[_0x3bc221(0x110)]=_0x45a252,_0x3a10d6['registrationToken']=_0x8b240d,fs[_0x3bc221(0x147)](APPLIANCE_FILE,JSON['stringify'](_0x3a10d6,null,0x2));}async function registerWithServer(){const _0x35cba1=a1_0x1aac81;try{const _0x3e0256=authService[_0x35cba1(0x116)]();if(!_0x3e0256)throw new Error(_0x35cba1(0x183));let _0xe22c66,_0x45ed96=![];while(!![]){try{robotId&&registrationToken?_0xe22c66=await axios[_0x35cba1(0x10d)](config[_0x35cba1(0x1b3)]+_0x35cba1(0x1bf),{'name':_0x35cba1(0x14d),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x35cba1(0x199)+_0x3e0256,'Content-Type':'application/json'}}):_0xe22c66=await axios[_0x35cba1(0x10d)](config[_0x35cba1(0x1b3)]+'/appliance/register',{'name':'WSL\x20Appliance'},{'headers':{'Authorization':'Bearer\x20'+_0x3e0256,'Content-Type':_0x35cba1(0x10c)}});break;}catch(_0x525193){const _0x26f58f=_0x525193?.[_0x35cba1(0x154)]?.[_0x35cba1(0x125)]?.[_0x35cba1(0x1b0)]||_0x525193['message'];if(!_0x45ed96&&_0x26f58f&&_0x26f58f[_0x35cba1(0x13c)]()[_0x35cba1(0x19b)](_0x35cba1(0x174))){console['warn'](_0x35cba1(0x18b));if(fs[_0x35cba1(0x1cb)](APPLIANCE_FILE))fs[_0x35cba1(0x1c5)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x45ed96=!![];continue;}throw _0x525193;}}if(!_0xe22c66[_0x35cba1(0x125)]||!_0xe22c66[_0x35cba1(0x125)][_0x35cba1(0x13f)]||!_0xe22c66['data']['id'])throw new Error('Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server');return registrationToken=_0xe22c66['data'][_0x35cba1(0x13f)],robotId=_0xe22c66[_0x35cba1(0x125)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x35cba1(0x1b5)](_0x35cba1(0x1cc)),!![];}catch(_0x55454e){return console['error']('Failed\x20to\x20register\x20with\x20server:',_0x55454e[_0x35cba1(0x163)]),![];}}function rewriteUrdfMeshUris(_0x12aa1d){const _0xb21c0b=a1_0x1aac81;try{const _0x4f67f5=new DOMParser(),_0x4deafd=_0x4f67f5[_0xb21c0b(0x165)](_0x12aa1d,_0xb21c0b(0x12d));let _0x5653a7=0x0,_0xd2a4d5=0x0;const _0x55d9bc=_0x4deafd[_0xb21c0b(0x123)]('mesh');for(let _0x2ee031=0x0;_0x2ee031<_0x55d9bc[_0xb21c0b(0x16f)];_0x2ee031++){const _0x3eed3f=_0x55d9bc[_0x2ee031],_0x370682=_0x3eed3f[_0xb21c0b(0x144)](_0xb21c0b(0x196)),_0x389e7c=['.stl',_0xb21c0b(0x186),_0xb21c0b(0x130),_0xb21c0b(0x132),_0xb21c0b(0x139)],_0x4de3c1=_0x389e7c['some'](_0x31ccf7=>_0x370682[_0xb21c0b(0x13c)]()[_0xb21c0b(0x184)](_0x31ccf7));if(_0x370682&&_0x370682[_0xb21c0b(0x1c4)](_0xb21c0b(0x175))&&_0x4de3c1){_0x5653a7++;const _0x4fb22c=APPLIANCE_BASE_URL+_0xb21c0b(0x181)+encodeURIComponent(_0x370682);_0x3eed3f['setAttribute'](_0xb21c0b(0x196),_0x4fb22c),_0xd2a4d5++,console[_0xb21c0b(0x1b5)](_0xb21c0b(0x12e)+_0x370682+'\x20->\x20'+_0x4fb22c);}}_0x5653a7>0x0?console['log']('[URDF\x20REWRITE]\x20Rewrote\x20'+_0xd2a4d5+_0xb21c0b(0x17a)+_0x5653a7+_0xb21c0b(0x189)):console[_0xb21c0b(0x1b5)](_0xb21c0b(0x15d));const _0x436287=new XMLSerializer();return _0x436287[_0xb21c0b(0x10e)](_0x4deafd);}catch(_0x4ba492){return console['error'](_0xb21c0b(0x129),_0x4ba492),_0x12aa1d;}}function connectToRosbridge(){const _0x5a3535=a1_0x1aac81;try{rosbridgeWs=new WebSocket(config[_0x5a3535(0x17c)][_0x5a3535(0x11e)]),rosbridgeWs['on'](_0x5a3535(0x11b),()=>{const _0x322a4a=_0x5a3535;console[_0x322a4a(0x1b5)](_0x322a4a(0x1b2));const _0x598b70=require('roslib'),_0x3dab41=new _0x598b70['Ros']({'url':config[_0x322a4a(0x17c)][_0x322a4a(0x11e)]});_0x3dab41['on'](_0x322a4a(0x1ab),()=>{setTimeout(()=>{const _0x1f22a7=a1_0x4dde;topicManager[_0x1f22a7(0x138)](_0x3dab41)['catch'](_0x58ee94=>{const _0x1a051b=_0x1f22a7;console[_0x1a051b(0x1b0)](_0x1a051b(0x1b7),_0x58ee94);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x5a3535(0x163),_0xadffc8=>{const _0x58da48=_0x5a3535;if(serverWs&&serverWs[_0x58da48(0x1a0)]===WebSocket[_0x58da48(0x153)]){let _0x140cf1=_0xadffc8[_0x58da48(0x1ca)]();try{const _0x45e3f2=JSON[_0x58da48(0x11c)](_0x140cf1);if(_0x45e3f2['op']===_0x58da48(0x1a7)&&_0x45e3f2[_0x58da48(0x14c)]){const _0x34bef3=topicManager[_0x58da48(0x188)](_0x45e3f2);switch(_0x34bef3['action']){case _0x58da48(0x197):return;case _0x58da48(0x1a9):return;case _0x58da48(0x160):default:_0x140cf1=JSON[_0x58da48(0x18d)](_0x34bef3['message']);break;}}if((_0x45e3f2['op']===_0x58da48(0x117)||_0x45e3f2['op']===_0x58da48(0x1b8))&&(_0x45e3f2[_0x58da48(0x185)]==='/rosapi/topics'||_0x45e3f2[_0x58da48(0x13a)]&&_0x45e3f2[_0x58da48(0x13a)][_0x58da48(0x158)])){console['log'](_0x58da48(0x1bd));const _0x1d8785=_0x45e3f2['values']?.[_0x58da48(0x158)]||[],_0xee2d99=_0x45e3f2[_0x58da48(0x13a)]?.[_0x58da48(0x19d)]||[],_0x4ec44e=_0x1d8785[_0x58da48(0x195)]((_0x2f94ff,_0x32882e)=>{const _0x4382f3=_0x58da48,_0x342d22=topicManager[_0x4382f3(0x151)](_0x2f94ff);return{'name':_0x2f94ff,'type':_0xee2d99[_0x32882e]||_0x4382f3(0x1a8),'throttling':_0x342d22?{'isThrottled':_0x342d22[_0x4382f3(0x143)]===_0x4382f3(0x1b4),'strategy':_0x342d22[_0x4382f3(0x143)],'samplingRate':_0x342d22[_0x4382f3(0x18a)],'reason':_0x342d22[_0x4382f3(0x122)],'estimatedSize':_0x342d22['estimatedSize']}:null};});_0x45e3f2[_0x58da48(0x13a)]={'topics':_0x4ec44e[_0x58da48(0x195)](_0x35d648=>_0x35d648[_0x58da48(0x12f)]),'types':_0x4ec44e[_0x58da48(0x195)](_0x141c4a=>_0x141c4a[_0x58da48(0x121)]),'throttling':_0x4ec44e[_0x58da48(0x195)](_0x352cd5=>_0x352cd5['throttling'])},_0x140cf1=JSON[_0x58da48(0x18d)](_0x45e3f2),console[_0x58da48(0x1b5)](_0x58da48(0x1b9));}if(_0x45e3f2['op']===_0x58da48(0x1a7)&&_0x45e3f2[_0x58da48(0x14c)]===_0x58da48(0x19a))try{const _0x53f792=_0x45e3f2[_0x58da48(0x15f)]['data'],_0xf1a225=rewriteUrdfMeshUris(_0x53f792);_0x45e3f2[_0x58da48(0x15f)][_0x58da48(0x125)]=_0xf1a225,_0x140cf1=JSON['stringify'](_0x45e3f2);}catch(_0x3dd37a){console['error']('[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:',_0x3dd37a);}}catch(_0x4f86b3){console[_0x58da48(0x194)](_0x58da48(0x172),_0x4f86b3['message']);}serverWs[_0x58da48(0x136)](_0x140cf1);}}),rosbridgeWs['on']('close',()=>{const _0xff2978=_0x5a3535;console['log'](_0xff2978(0x17b)),webrtcService['stopAllSessions'](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on']('error',_0x4b8087=>{const _0x9e0a99=_0x5a3535;console[_0x9e0a99(0x1b0)](_0x9e0a99(0x1ba),_0x4b8087);});}catch(_0x57c628){console[_0x5a3535(0x1b0)]('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):',_0x57c628),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x1a21da=a1_0x1aac81;try{rosbridgeWebRTCWs=new WebSocket(config[_0x1a21da(0x17c)][_0x1a21da(0x11e)]),rosbridgeWebRTCWs['on']('open',()=>{const _0x21ec70=_0x1a21da;console[_0x21ec70(0x1b5)](_0x21ec70(0x124)),webrtcService[_0x21ec70(0x1c9)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x1a21da(0x163),_0x202f56=>{}),rosbridgeWebRTCWs['on']('close',()=>{const _0x2eb82d=_0x1a21da;console[_0x2eb82d(0x1b5)]('Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x2eb82d(0x1a2)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x1a21da(0x1b0),_0x46e520=>{const _0x45466b=_0x1a21da;console[_0x45466b(0x1b0)](_0x45466b(0x137),_0x46e520);});}catch(_0x7aaec0){console[_0x1a21da(0x1b0)]('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):',_0x7aaec0),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x2e0a6d=a1_0x1aac81;try{if(!registrationToken)throw new Error(_0x2e0a6d(0x1a6));const _0x55212d=config[_0x2e0a6d(0x1b3)][_0x2e0a6d(0x1c6)]('http','ws')+_0x2e0a6d(0x191)+registrationToken;serverWs=new WebSocket(_0x55212d),serverWs['on'](_0x2e0a6d(0x11b),()=>{const _0x4edc52=_0x2e0a6d;console[_0x4edc52(0x1b5)](_0x4edc52(0x112)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x4edc52(0x1a0)]===WebSocket[_0x4edc52(0x153)]&&webrtcService[_0x4edc52(0x1c9)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x2e0a6d(0x163),_0x25c663=>{const _0x3be14b=_0x2e0a6d;if(rosbridgeWs&&rosbridgeWs['readyState']===WebSocket['OPEN']){let _0x3c7c3e=_0x25c663[_0x3be14b(0x1ca)]();try{const _0x2ba74a=JSON[_0x3be14b(0x11c)](_0x3c7c3e);if(webrtcService[_0x3be14b(0x188)](_0x2ba74a))return;if(_0x2ba74a['op']===_0x3be14b(0x12c)&&typeof _0x2ba74a[_0x3be14b(0x179)]===_0x3be14b(0x131)&&_0x2ba74a[_0x3be14b(0x156)])try{console[_0x3be14b(0x1b5)]('[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20'+_0x2ba74a[_0x3be14b(0x179)]);const _0x3b7bd0=execSync(_0x3be14b(0x1b1)+_0x2ba74a[_0x3be14b(0x179)],{'encoding':_0x3be14b(0x1c1)})[_0x3be14b(0x134)]();let _0xeb5333=_0x3b7bd0;_0x3b7bd0[_0x3be14b(0x1c4)]('String\x20value\x20is:\x20')&&(_0xeb5333=_0x3b7bd0[_0x3be14b(0x115)](_0x3be14b(0x1c3)['length']()));_0xeb5333[_0x3be14b(0x1c4)]('\x22')&&_0xeb5333[_0x3be14b(0x184)]('\x22')&&(_0xeb5333=_0xeb5333[_0x3be14b(0x192)](0x1,-0x1));_0xeb5333=_0xeb5333['replace'](/\\n/g,'\x0a')[_0x3be14b(0x1c6)](/\\"/g,'\x22');const _0x380389={'op':_0x3be14b(0x1c8),'request_id':_0x2ba74a[_0x3be14b(0x156)],'data':_0xeb5333};serverWs['send'](JSON[_0x3be14b(0x18d)](_0x380389)),console['log']('[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20'+_0x2ba74a[_0x3be14b(0x179)]);return;}catch(_0x212839){console[_0x3be14b(0x1b0)](_0x3be14b(0x16a),_0x212839);const _0x48e0a4={'op':'urdf_param_data','request_id':_0x2ba74a[_0x3be14b(0x156)],'error':_0x212839['message']};serverWs[_0x3be14b(0x136)](JSON[_0x3be14b(0x18d)](_0x48e0a4));return;}if(_0x2ba74a['op']==='get_mesh'&&typeof _0x2ba74a[_0x3be14b(0x16c)]===_0x3be14b(0x131)&&_0x2ba74a['request_id'])try{const _0x53cc5e=_0x2ba74a[_0x3be14b(0x16c)][_0x3be14b(0x12b)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x53cc5e){const _0x4b0aee=_0x53cc5e[0x1],_0x2545ab=_0x53cc5e[0x2],_0xa502f7=execSync('ros2\x20pkg\x20prefix\x20'+_0x4b0aee,{'encoding':_0x3be14b(0x1c1)})['trim'](),_0x9f84e7=path['join'](_0xa502f7,_0x3be14b(0x12a),_0x4b0aee,_0x2545ab);if(!fs['existsSync'](_0x9f84e7))throw new Error(_0x3be14b(0x19f)+_0x9f84e7);const _0x148cc0=fs[_0x3be14b(0x1af)](_0x9f84e7),_0x165ba7={'op':_0x3be14b(0x11d),'request_id':_0x2ba74a['request_id'],'data':_0x148cc0['toString'](_0x3be14b(0x1a4))};serverWs[_0x3be14b(0x136)](JSON[_0x3be14b(0x18d)](_0x165ba7)),console[_0x3be14b(0x1b5)](_0x3be14b(0x1ac)+_0x2ba74a[_0x3be14b(0x16c)]+'\x20from\x20'+_0x9f84e7);return;}}catch(_0x54976b){console[_0x3be14b(0x1b0)]('[MESH]\x20Error\x20serving\x20mesh:',_0x54976b);const _0xc7247a={'op':_0x3be14b(0x11d),'request_id':_0x2ba74a[_0x3be14b(0x156)],'error':_0x54976b[_0x3be14b(0x163)]};serverWs['send'](JSON[_0x3be14b(0x18d)](_0xc7247a));return;}rosbridgeWs[_0x3be14b(0x136)](_0x3c7c3e);}catch(_0x36b4eb){rosbridgeWs[_0x3be14b(0x136)](_0x3c7c3e);}}}),serverWs['on']('close',(_0x42b976,_0x2ea3ee)=>{const _0x43dadb=_0x2e0a6d;console[_0x43dadb(0x1b5)](_0x43dadb(0x162)+_0x42b976+':\x20'+_0x2ea3ee+'),\x20attempting\x20to\x20reconnect...'),webrtcService['stopAllSessions'](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x2e0a6d(0x1b0),_0x315d2=>{const _0x1233ab=_0x2e0a6d;console[_0x1233ab(0x1b0)](_0x1233ab(0x135),_0x315d2);});}catch(_0x39df4f){console[_0x2e0a6d(0x1b0)](_0x2e0a6d(0x119),_0x39df4f),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x46648b,_0x4bd31f,_0x445e16)=>{const _0x3ab261=a1_0x1aac81;if(!authService[_0x3ab261(0x14f)]()){console[_0x3ab261(0x1b5)](_0x3ab261(0x1c2),config['serverUrl']);const _0x3716ad=await authService[_0x3ab261(0x173)]();if(!_0x3716ad)return _0x4bd31f['status'](0x191)['json']({'error':'Authentication\x20required'});}_0x445e16();};app[a1_0x1aac81(0x17f)]((_0x5d2c43,_0x14e5cf,_0x148a68)=>{const _0x3d4d34=a1_0x1aac81;_0x14e5cf[_0x3d4d34(0x1a3)]('Access-Control-Allow-Origin','*'),_0x14e5cf[_0x3d4d34(0x1a3)](_0x3d4d34(0x1b6),_0x3d4d34(0x155)),_0x14e5cf[_0x3d4d34(0x1a3)](_0x3d4d34(0x1c0),_0x3d4d34(0x169)),_0x5d2c43[_0x3d4d34(0x182)]===_0x3d4d34(0x190)?_0x14e5cf[_0x3d4d34(0x167)](0xc8):_0x148a68();}),app[a1_0x1aac81(0x126)]('/',requireAuth,(_0xdfce61,_0x2b88ac)=>{const _0x4e1fbd=a1_0x1aac81;_0x2b88ac[_0x4e1fbd(0x136)](_0x4e1fbd(0x177));}),app[a1_0x1aac81(0x126)]('/health',async(_0x59811d,_0x1895b9)=>{const _0x47552f=a1_0x1aac81,_0x58e481=authService['isAuthenticated'](),_0x1f0ed0=webrtcService['getActiveSessions'](),_0x2def3e=webrtcService[_0x47552f(0x10f)](),_0x13cb3b=topicManager[_0x47552f(0x1bb)]();_0x1895b9[_0x47552f(0x17e)]({'status':'ok','environment':process['env']['NODE_ENV']||_0x47552f(0x13e),'backendUrl':config[_0x47552f(0x1b3)],'rosbridgeUrl':config[_0x47552f(0x17c)]['wsEndpoint'],'proxyPort':port,'authenticated':_0x58e481,'topicManagement':{'discovered':_0x13cb3b['totalTopics'],'strategies':_0x13cb3b[_0x47552f(0x146)],'largeDataTopics':_0x13cb3b[_0x47552f(0x168)][_0x47552f(0x16f)],'largeTopicsList':_0x13cb3b['largeDataTopics']},'webrtc':{'activeSessions':_0x1f0ed0['length'],'sharedVideoSources':_0x2def3e['length'],'sessions':_0x1f0ed0,'sharedSources':_0x2def3e}});});const getInitialPort=()=>{const _0x50c6cd=a1_0x1aac81;if(process['env'][_0x50c6cd(0x14e)])return parseInt(process[_0x50c6cd(0x113)][_0x50c6cd(0x14e)],0xa);return config[_0x50c6cd(0x17c)][_0x50c6cd(0x166)];};async function listenWithRetries(_0x74f2f,_0xca87b7,_0x1a92d7=0xa){const _0x431211=a1_0x1aac81;let _0x26c50f=_0xca87b7;for(let _0x4cad33=0x1;_0x4cad33<=_0x1a92d7;_0x4cad33++){try{return await new Promise((_0x4a788b,_0x310beb)=>{const _0x1017ae=a1_0x4dde,_0x1c676f=_0x74f2f[_0x1017ae(0x193)](_0x26c50f,()=>{const _0x3980a1=_0x1017ae;console['log'](_0x3980a1(0x176)+_0x26c50f),_0x4a788b(_0x1c676f);});_0x1c676f['on']('error',_0x2e8f49=>{const _0x23608e=_0x1017ae;_0x2e8f49[_0x23608e(0x152)]===_0x23608e(0x17d)?(console[_0x23608e(0x194)]('Port\x20'+_0x26c50f+_0x23608e(0x118)),_0x310beb(_0x2e8f49)):_0x310beb(_0x2e8f49);});}),_0x26c50f;}catch(_0x111c27){_0x26c50f++;}}throw new Error('Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20'+_0x1a92d7+_0x431211(0x187)+_0xca87b7);}const startApp=async()=>{const _0x12f588=a1_0x1aac81;try{let _0x953daa=await authService[_0x12f588(0x173)]();while(!_0x953daa){console[_0x12f588(0x1b5)](_0x12f588(0x170)),await promptForCredentials(),_0x953daa=await authService[_0x12f588(0x173)]();}console[_0x12f588(0x1b5)](_0x12f588(0x13d));!loadApplianceIdentity()&&console[_0x12f588(0x1b5)](_0x12f588(0x164));console['log'](_0x12f588(0x16b));const _0x2b67ee=await registerWithServer();if(!_0x2b67ee)throw new Error(_0x12f588(0x120));connectToRosbridge(),connectToServer();const _0x18f7d=getInitialPort();await listenWithRetries(app,_0x18f7d,0xa);}catch(_0x22488d){console[_0x12f588(0x1b0)](_0x12f588(0x157),_0x22488d),process[_0x12f588(0x180)](0x1);}};setInterval(async()=>{const _0x513ab5=a1_0x1aac81;try{if(robotId){const _0xede3aa=authService[_0x513ab5(0x116)]();await axios[_0x513ab5(0x10d)](config[_0x513ab5(0x1b3)]+_0x513ab5(0x14b),{'robotId':robotId},{'headers':{'Authorization':_0x513ab5(0x199)+_0xede3aa,'Content-Type':'application/json'}});}}catch(_0x437205){console['error']('Failed\x20to\x20ping\x20server:',_0x437205[_0x513ab5(0x163)]);}},0x1388),startApp();