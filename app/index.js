const a1_0x39f1f9=a1_0x194b;(function(_0x1c58a3,_0x50d377){const _0xea7b6a=a1_0x194b,_0x26ae6c=_0x1c58a3();while(!![]){try{const _0x3c2000=-parseInt(_0xea7b6a(0x23d))/0x1*(parseInt(_0xea7b6a(0x26f))/0x2)+parseInt(_0xea7b6a(0x248))/0x3+parseInt(_0xea7b6a(0x269))/0x4*(parseInt(_0xea7b6a(0x1e7))/0x5)+parseInt(_0xea7b6a(0x245))/0x6*(-parseInt(_0xea7b6a(0x286))/0x7)+-parseInt(_0xea7b6a(0x2a1))/0x8*(parseInt(_0xea7b6a(0x243))/0x9)+parseInt(_0xea7b6a(0x268))/0xa*(parseInt(_0xea7b6a(0x1fc))/0xb)+parseInt(_0xea7b6a(0x202))/0xc;if(_0x3c2000===_0x50d377)break;else _0x26ae6c['push'](_0x26ae6c['shift']());}catch(_0x348f9f){_0x26ae6c['push'](_0x26ae6c['shift']());}}}(a1_0x1404,0xcec19));const a1_0x5e95b9=(function(){let _0x5524cf=!![];return function(_0x5a5f45,_0x49acc3){const _0x5ccca3=_0x5524cf?function(){const _0x2f26af=a1_0x194b;if(_0x49acc3){const _0xad4542=_0x49acc3[_0x2f26af(0x1dd)](_0x5a5f45,arguments);return _0x49acc3=null,_0xad4542;}}:function(){};return _0x5524cf=![],_0x5ccca3;};}()),a1_0x134184=a1_0x5e95b9(this,function(){const _0x2f8c52=a1_0x194b;return a1_0x134184[_0x2f8c52(0x1f7)]()[_0x2f8c52(0x1d7)](_0x2f8c52(0x256))['toString']()[_0x2f8c52(0x22e)](a1_0x134184)[_0x2f8c52(0x1d7)](_0x2f8c52(0x256));});a1_0x134184();const dotenv=require(a1_0x39f1f9(0x205));dotenv[a1_0x39f1f9(0x285)]();const express=require(a1_0x39f1f9(0x1e0)),config=require('./config');process[a1_0x39f1f9(0x279)]['APP_USERNAME']&&process['env'][a1_0x39f1f9(0x254)]&&(config[a1_0x39f1f9(0x217)][a1_0x39f1f9(0x204)]=process[a1_0x39f1f9(0x279)][a1_0x39f1f9(0x212)],config['credentials'][a1_0x39f1f9(0x263)]=process[a1_0x39f1f9(0x279)]['APP_PASSWORD'],console['log'](a1_0x39f1f9(0x1d8)));const authService=require(a1_0x39f1f9(0x223)),webrtcService=require(a1_0x39f1f9(0x227)),topicManager=require('./services/TopicManager'),WebSocket=require('ws'),axios=require(a1_0x39f1f9(0x1f4)),fs=require('fs'),prompt=require(a1_0x39f1f9(0x20d))({'sigint':!![]}),app=express(),port=process[a1_0x39f1f9(0x279)][a1_0x39f1f9(0x209)]||config[a1_0x39f1f9(0x20a)][a1_0x39f1f9(0x24d)],APPLIANCE_FILE=a1_0x39f1f9(0x29d),{DOMParser,XMLSerializer}=require('xmldom'),path=require(a1_0x39f1f9(0x241)),{execSync}=require(a1_0x39f1f9(0x211)),APPLIANCE_BASE_URL=process[a1_0x39f1f9(0x279)]['APPLIANCE_BASE_URL']||'';console[a1_0x39f1f9(0x297)](a1_0x39f1f9(0x23b)+(process[a1_0x39f1f9(0x279)][a1_0x39f1f9(0x27b)]||a1_0x39f1f9(0x219))),console['log'](a1_0x39f1f9(0x2a7)+config[a1_0x39f1f9(0x21e)]),console[a1_0x39f1f9(0x297)](a1_0x39f1f9(0x224)+config[a1_0x39f1f9(0x20a)][a1_0x39f1f9(0x21b)]),console['log']('Proxy\x20listening\x20on\x20port:\x20'+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x5f1bce,_0x38d53d){const _0x1de81d=a1_0x39f1f9;fs[_0x1de81d(0x1d6)]('.env',_0x1de81d(0x287)+_0x5f1bce+_0x1de81d(0x1da)+_0x38d53d+'\x0a');}function a1_0x194b(_0x502a67,_0x26a77b){const _0x2b1f5e=a1_0x1404();return a1_0x194b=function(_0x134184,_0x5e95b9){_0x134184=_0x134184-0x1d6;let _0x140411=_0x2b1f5e[_0x134184];return _0x140411;},a1_0x194b(_0x502a67,_0x26a77b);}function reloadEnv(){const _0xbcac02=a1_0x39f1f9;dotenv[_0xbcac02(0x285)]({'override':!![]}),config[_0xbcac02(0x217)][_0xbcac02(0x204)]=process['env'][_0xbcac02(0x212)],config['credentials'][_0xbcac02(0x263)]=process['env'][_0xbcac02(0x254)],console[_0xbcac02(0x297)]('Loaded\x20credentials:',{'username':config['credentials'][_0xbcac02(0x204)]?_0xbcac02(0x289):_0xbcac02(0x26c),'password':config[_0xbcac02(0x217)]['password']?_0xbcac02(0x289):_0xbcac02(0x26c)});}async function promptForCredentials(){const _0xe9a63f=a1_0x39f1f9;process[_0xe9a63f(0x279)][_0xe9a63f(0x27b)]===_0xe9a63f(0x214)&&(console[_0xe9a63f(0x25d)](_0xe9a63f(0x1fd)),console[_0xe9a63f(0x25d)]('Please\x20run:\x20./setup.sh\x20reconfigure'),process[_0xe9a63f(0x261)](0x1));const _0x391daf=prompt(_0xe9a63f(0x1de)),_0x1a14a6=prompt[_0xe9a63f(0x281)](_0xe9a63f(0x26d));updateEnvFile(_0x391daf,_0x1a14a6),reloadEnv();}function loadApplianceIdentity(){const _0x4dda72=a1_0x39f1f9;if(fs[_0x4dda72(0x1e9)](APPLIANCE_FILE))try{const _0x220b70=JSON[_0x4dda72(0x28b)](fs[_0x4dda72(0x213)](APPLIANCE_FILE,_0x4dda72(0x208)));if(_0x220b70['robotId']&&_0x220b70['registrationToken'])return robotId=_0x220b70[_0x4dda72(0x2a5)],registrationToken=_0x220b70['registrationToken'],console[_0x4dda72(0x297)](_0x4dda72(0x238),robotId),topicManager[_0x4dda72(0x24e)](_0x220b70),!![];}catch(_0x3ffc5d){console['error'](_0x4dda72(0x296),_0x3ffc5d);}return![];}function saveApplianceIdentity(_0x4a8db7,_0x3b9985){const _0x2d20ed=a1_0x39f1f9;let _0x24eca5={};if(fs['existsSync'](APPLIANCE_FILE))try{_0x24eca5=JSON[_0x2d20ed(0x28b)](fs['readFileSync'](APPLIANCE_FILE,_0x2d20ed(0x208)));}catch(_0x46aa63){_0x24eca5={};}_0x24eca5[_0x2d20ed(0x2a5)]=_0x4a8db7,_0x24eca5[_0x2d20ed(0x272)]=_0x3b9985,fs[_0x2d20ed(0x1d6)](APPLIANCE_FILE,JSON['stringify'](_0x24eca5,null,0x2));}async function registerWithServer(){const _0x25a39a=a1_0x39f1f9;try{const _0x4e59b6=authService[_0x25a39a(0x1f2)]();if(!_0x4e59b6)throw new Error(_0x25a39a(0x277));let _0x45afad,_0x5ba7ac=![];while(!![]){try{robotId&&registrationToken?_0x45afad=await axios['post'](config['serverUrl']+'/appliance/register',{'name':_0x25a39a(0x1e5),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x25a39a(0x1e2)+_0x4e59b6,'Content-Type':_0x25a39a(0x266)}}):_0x45afad=await axios[_0x25a39a(0x250)](config[_0x25a39a(0x21e)]+_0x25a39a(0x28a),{'name':_0x25a39a(0x1e5)},{'headers':{'Authorization':'Bearer\x20'+_0x4e59b6,'Content-Type':_0x25a39a(0x266)}});break;}catch(_0x83efbc){const _0x4734ff=_0x83efbc?.[_0x25a39a(0x298)]?.['data']?.['error']||_0x83efbc[_0x25a39a(0x260)];if(!_0x5ba7ac&&_0x4734ff&&_0x4734ff['toLowerCase']()[_0x25a39a(0x22c)]('robot\x20not\x20found')){console[_0x25a39a(0x24a)](_0x25a39a(0x278));if(fs[_0x25a39a(0x1e9)](APPLIANCE_FILE))fs[_0x25a39a(0x246)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x5ba7ac=!![];continue;}throw _0x83efbc;}}if(!_0x45afad[_0x25a39a(0x288)]||!_0x45afad[_0x25a39a(0x288)][_0x25a39a(0x215)]||!_0x45afad[_0x25a39a(0x288)]['id'])throw new Error(_0x25a39a(0x257));return registrationToken=_0x45afad['data'][_0x25a39a(0x215)],robotId=_0x45afad['data']['id'],saveApplianceIdentity(robotId,registrationToken),console['log'](_0x25a39a(0x222)),!![];}catch(_0x516935){return console[_0x25a39a(0x25d)](_0x25a39a(0x24f),_0x516935[_0x25a39a(0x260)]),![];}}function rewriteUrdfMeshUris(_0x2da049){const _0x440af3=a1_0x39f1f9;try{const _0x2e22d9=new DOMParser(),_0xb5a819=_0x2e22d9[_0x440af3(0x262)](_0x2da049,'text/xml');let _0x4162e6=0x0,_0xa7c626=0x0;const _0x3bc6f3=_0xb5a819[_0x440af3(0x253)](_0x440af3(0x274));for(let _0x1e2fbf=0x0;_0x1e2fbf<_0x3bc6f3['length'];_0x1e2fbf++){const _0x3bfc7c=_0x3bc6f3[_0x1e2fbf],_0x8dd3c0=_0x3bfc7c[_0x440af3(0x24b)](_0x440af3(0x234)),_0x324fb6=['.stl','.dae','.obj',_0x440af3(0x203),_0x440af3(0x293)],_0x59bee9=_0x324fb6[_0x440af3(0x229)](_0x4d6bf6=>_0x8dd3c0[_0x440af3(0x1d9)]()[_0x440af3(0x270)](_0x4d6bf6));if(_0x8dd3c0&&_0x8dd3c0[_0x440af3(0x29f)](_0x440af3(0x23f))&&_0x59bee9){_0x4162e6++;const _0x8216ec=APPLIANCE_BASE_URL+'/ros/mesh?uri='+encodeURIComponent(_0x8dd3c0);_0x3bfc7c[_0x440af3(0x283)](_0x440af3(0x234),_0x8216ec),_0xa7c626++,console[_0x440af3(0x297)](_0x440af3(0x21a)+_0x8dd3c0+_0x440af3(0x1df)+_0x8216ec);}}_0x4162e6>0x0?console[_0x440af3(0x297)](_0x440af3(0x299)+_0xa7c626+_0x440af3(0x1dc)+_0x4162e6+_0x440af3(0x23e)):console[_0x440af3(0x297)]('[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF');const _0x43c042=new XMLSerializer();return _0x43c042[_0x440af3(0x27c)](_0xb5a819);}catch(_0x25752a){return console['error'](_0x440af3(0x255),_0x25752a),_0x2da049;}}function connectToRosbridge(){const _0x1a1ba6=a1_0x39f1f9;try{rosbridgeWs=new WebSocket(config['rosbridge'][_0x1a1ba6(0x21b)]),rosbridgeWs['on'](_0x1a1ba6(0x1fe),()=>{const _0x24ec89=_0x1a1ba6;console[_0x24ec89(0x297)]('Connected\x20to\x20ROSBridge\x20(main)');const _0x3922cc=require(_0x24ec89(0x275)),_0x4ce7e4=new _0x3922cc[(_0x24ec89(0x25b))]({'url':config[_0x24ec89(0x20a)][_0x24ec89(0x21b)]});_0x4ce7e4['on']('connection',()=>{setTimeout(()=>{const _0x5878da=a1_0x194b;topicManager['discoverTopics'](_0x4ce7e4)[_0x5878da(0x26b)](_0x5cf461=>{const _0x2fa7ad=_0x5878da;console[_0x2fa7ad(0x25d)](_0x2fa7ad(0x230),_0x5cf461);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x1a1ba6(0x260),_0x5c5bc4=>{const _0xcb18f4=_0x1a1ba6;if(serverWs&&serverWs[_0xcb18f4(0x267)]===WebSocket[_0xcb18f4(0x1ef)]){let _0x4aaa0d=_0x5c5bc4[_0xcb18f4(0x1f7)]();try{const _0x1cb821=JSON[_0xcb18f4(0x28b)](_0x4aaa0d);if(_0x1cb821['op']===_0xcb18f4(0x29c)&&_0x1cb821[_0xcb18f4(0x20c)]){const _0x4c2b45=topicManager[_0xcb18f4(0x23a)](_0x1cb821);switch(_0x4c2b45[_0xcb18f4(0x25e)]){case _0xcb18f4(0x1e4):return;case _0xcb18f4(0x1ec):return;case _0xcb18f4(0x284):default:_0x4aaa0d=JSON[_0xcb18f4(0x291)](_0x4c2b45['message']);break;}}if((_0x1cb821['op']===_0xcb18f4(0x29e)||_0x1cb821['op']===_0xcb18f4(0x25a))&&(_0x1cb821[_0xcb18f4(0x259)]===_0xcb18f4(0x24c)||_0x1cb821[_0xcb18f4(0x273)]&&_0x1cb821[_0xcb18f4(0x273)]['topics'])){console[_0xcb18f4(0x297)]('[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata');const _0x521884=_0x1cb821[_0xcb18f4(0x273)]?.[_0xcb18f4(0x226)]||[],_0x584d7f=_0x1cb821[_0xcb18f4(0x273)]?.[_0xcb18f4(0x1f8)]||[],_0xccbca7=_0x521884[_0xcb18f4(0x218)]((_0x948b16,_0x218073)=>{const _0x5d8b03=_0xcb18f4,_0x57da93=topicManager[_0x5d8b03(0x232)](_0x948b16);return{'name':_0x948b16,'type':_0x584d7f[_0x218073]||'unknown','throttling':_0x57da93?{'isThrottled':_0x57da93['strategy']==='sample','strategy':_0x57da93[_0x5d8b03(0x237)],'samplingRate':_0x57da93[_0x5d8b03(0x1ee)],'reason':_0x57da93[_0x5d8b03(0x20e)],'estimatedSize':_0x57da93[_0x5d8b03(0x1fb)]}:null};});_0x1cb821[_0xcb18f4(0x273)]={'topics':_0xccbca7['map'](_0x57daa6=>_0x57daa6[_0xcb18f4(0x294)]),'types':_0xccbca7[_0xcb18f4(0x218)](_0x24bbda=>_0x24bbda[_0xcb18f4(0x2a4)]),'throttling':_0xccbca7[_0xcb18f4(0x218)](_0x123669=>_0x123669[_0xcb18f4(0x242)])},_0x4aaa0d=JSON[_0xcb18f4(0x291)](_0x1cb821),console[_0xcb18f4(0x297)](_0xcb18f4(0x27e));}if(_0x1cb821['op']===_0xcb18f4(0x29c)&&_0x1cb821[_0xcb18f4(0x20c)]===_0xcb18f4(0x1f3))try{const _0x40ad21=_0x1cb821[_0xcb18f4(0x28d)][_0xcb18f4(0x288)],_0x7d9c87=rewriteUrdfMeshUris(_0x40ad21);_0x1cb821['msg']['data']=_0x7d9c87,_0x4aaa0d=JSON[_0xcb18f4(0x291)](_0x1cb821);}catch(_0x2f1072){console[_0xcb18f4(0x25d)](_0xcb18f4(0x1fa),_0x2f1072);}}catch(_0x5d285a){console[_0xcb18f4(0x24a)](_0xcb18f4(0x20b),_0x5d285a['message']);}serverWs[_0xcb18f4(0x265)](_0x4aaa0d);}}),rosbridgeWs['on']('close',()=>{const _0x163d8b=_0x1a1ba6;console[_0x163d8b(0x297)](_0x163d8b(0x21d)),webrtcService[_0x163d8b(0x25f)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on']('error',_0xee9716=>{const _0x2794a4=_0x1a1ba6;console['error'](_0x2794a4(0x1e8),_0xee9716);});}catch(_0x3383a4){console[_0x1a1ba6(0x25d)](_0x1a1ba6(0x276),_0x3383a4),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x70da93=a1_0x39f1f9;try{rosbridgeWebRTCWs=new WebSocket(config[_0x70da93(0x20a)][_0x70da93(0x21b)]),rosbridgeWebRTCWs['on']('open',()=>{const _0x557f30=_0x70da93;console['log'](_0x557f30(0x23c)),webrtcService[_0x557f30(0x1db)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x70da93(0x260),_0x4ac6a2=>{}),rosbridgeWebRTCWs['on'](_0x70da93(0x258),()=>{const _0x4afa02=_0x70da93;console[_0x4afa02(0x297)]('Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x4afa02(0x25f)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on']('error',_0x47ce18=>{const _0x57a11c=_0x70da93;console[_0x57a11c(0x25d)]('ROSBridge\x20(WebRTC)\x20connection\x20error:',_0x47ce18);});}catch(_0x3f5c55){console['error'](_0x70da93(0x1f5),_0x3f5c55),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x10dd8a=a1_0x39f1f9;try{if(!registrationToken)throw new Error(_0x10dd8a(0x21c));const _0x948a9c=config[_0x10dd8a(0x21e)][_0x10dd8a(0x1f0)]('http','ws')+_0x10dd8a(0x1eb)+registrationToken;serverWs=new WebSocket(_0x948a9c),serverWs['on'](_0x10dd8a(0x1fe),()=>{const _0x4d842f=_0x10dd8a;console['log'](_0x4d842f(0x22d)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x4d842f(0x267)]===WebSocket['OPEN']&&webrtcService[_0x4d842f(0x1db)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x10dd8a(0x260),_0x45fdc3=>{const _0x19cca9=_0x10dd8a;if(rosbridgeWs&&rosbridgeWs[_0x19cca9(0x267)]===WebSocket['OPEN']){let _0x56fe75=_0x45fdc3[_0x19cca9(0x1f7)]();try{const _0x14fadb=JSON[_0x19cca9(0x28b)](_0x56fe75);if(webrtcService[_0x19cca9(0x23a)](_0x14fadb))return;if(_0x14fadb['op']===_0x19cca9(0x233)&&typeof _0x14fadb[_0x19cca9(0x22b)]===_0x19cca9(0x2a3)&&_0x14fadb[_0x19cca9(0x206)])try{console[_0x19cca9(0x297)](_0x19cca9(0x235)+_0x14fadb[_0x19cca9(0x22b)]);const _0x3a23df=execSync(_0x19cca9(0x271)+_0x14fadb[_0x19cca9(0x22b)],{'encoding':'utf8'})['trim']();let _0xb0e44d=_0x3a23df;_0x3a23df['startsWith']('String\x20value\x20is:\x20')&&(_0xb0e44d=_0x3a23df[_0x19cca9(0x200)](_0x19cca9(0x1f1)[_0x19cca9(0x249)]()));_0xb0e44d['startsWith']('\x22')&&_0xb0e44d[_0x19cca9(0x270)]('\x22')&&(_0xb0e44d=_0xb0e44d[_0x19cca9(0x21f)](0x1,-0x1));_0xb0e44d=_0xb0e44d['replace'](/\\n/g,'\x0a')[_0x19cca9(0x1f0)](/\\"/g,'\x22');const _0x414fdc={'op':_0x19cca9(0x28f),'request_id':_0x14fadb['request_id'],'data':_0xb0e44d};serverWs[_0x19cca9(0x265)](JSON[_0x19cca9(0x291)](_0x414fdc)),console[_0x19cca9(0x297)](_0x19cca9(0x201)+_0x14fadb[_0x19cca9(0x22b)]);return;}catch(_0x31059a){console[_0x19cca9(0x25d)]('[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:',_0x31059a);const _0x427dac={'op':_0x19cca9(0x28f),'request_id':_0x14fadb[_0x19cca9(0x206)],'error':_0x31059a['message']};serverWs[_0x19cca9(0x265)](JSON['stringify'](_0x427dac));return;}if(_0x14fadb['op']==='get_mesh'&&typeof _0x14fadb[_0x19cca9(0x26e)]===_0x19cca9(0x2a3)&&_0x14fadb[_0x19cca9(0x206)])try{const _0x123f67=_0x14fadb[_0x19cca9(0x26e)]['match'](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x123f67){const _0x39dafd=_0x123f67[0x1],_0x34fef5=_0x123f67[0x2],_0x22b901=execSync(_0x19cca9(0x292)+_0x39dafd,{'encoding':_0x19cca9(0x208)})[_0x19cca9(0x216)](),_0x2a2f46=path[_0x19cca9(0x1e3)](_0x22b901,_0x19cca9(0x221),_0x39dafd,_0x34fef5);if(!fs[_0x19cca9(0x1e9)](_0x2a2f46))throw new Error(_0x19cca9(0x290)+_0x2a2f46);const _0x245dc2=fs[_0x19cca9(0x213)](_0x2a2f46),_0x53b8bc={'op':_0x19cca9(0x22f),'request_id':_0x14fadb['request_id'],'data':_0x245dc2[_0x19cca9(0x1f7)](_0x19cca9(0x1f6))};serverWs[_0x19cca9(0x265)](JSON[_0x19cca9(0x291)](_0x53b8bc)),console[_0x19cca9(0x297)](_0x19cca9(0x239)+_0x14fadb[_0x19cca9(0x26e)]+_0x19cca9(0x252)+_0x2a2f46);return;}}catch(_0x5e9aab){console['error']('[MESH]\x20Error\x20serving\x20mesh:',_0x5e9aab);const _0x39cf87={'op':_0x19cca9(0x22f),'request_id':_0x14fadb[_0x19cca9(0x206)],'error':_0x5e9aab[_0x19cca9(0x260)]};serverWs[_0x19cca9(0x265)](JSON['stringify'](_0x39cf87));return;}rosbridgeWs[_0x19cca9(0x265)](_0x56fe75);}catch(_0x365c82){rosbridgeWs[_0x19cca9(0x265)](_0x56fe75);}}}),serverWs['on'](_0x10dd8a(0x258),(_0x507210,_0x49f852)=>{const _0x25b51f=_0x10dd8a;console[_0x25b51f(0x297)]('Disconnected\x20from\x20server\x20('+_0x507210+':\x20'+_0x49f852+'),\x20attempting\x20to\x20reconnect...'),webrtcService['stopAllSessions'](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x10dd8a(0x25d),_0x2f32f5=>{const _0x827846=_0x10dd8a;console[_0x827846(0x25d)](_0x827846(0x282),_0x2f32f5);});}catch(_0xff73a5){console[_0x10dd8a(0x25d)](_0x10dd8a(0x2a2),_0xff73a5),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x10fe68,_0x5a4be0,_0x311fa1)=>{const _0x46d2f6=a1_0x39f1f9;if(!authService[_0x46d2f6(0x210)]()){console[_0x46d2f6(0x297)](_0x46d2f6(0x228),config[_0x46d2f6(0x21e)]);const _0x2a58ae=await authService[_0x46d2f6(0x22a)]();if(!_0x2a58ae)return _0x5a4be0['status'](0x191)[_0x46d2f6(0x29a)]({'error':_0x46d2f6(0x28e)});}_0x311fa1();};app['use']((_0x4249e1,_0x5358d8,_0x58110f)=>{const _0x4c4c34=a1_0x39f1f9;_0x5358d8[_0x4c4c34(0x2a6)](_0x4c4c34(0x280),'*'),_0x5358d8['header'](_0x4c4c34(0x225),_0x4c4c34(0x1e1)),_0x5358d8[_0x4c4c34(0x2a6)]('Access-Control-Allow-Headers',_0x4c4c34(0x26a)),_0x4249e1[_0x4c4c34(0x220)]===_0x4c4c34(0x207)?_0x5358d8[_0x4c4c34(0x1ea)](0xc8):_0x58110f();}),app[a1_0x39f1f9(0x20f)]('/',requireAuth,(_0x25359b,_0xe042a7)=>{const _0x40f914=a1_0x39f1f9;_0xe042a7[_0x40f914(0x265)](_0x40f914(0x247));}),app[a1_0x39f1f9(0x20f)]('/health',async(_0x287609,_0x2316cd)=>{const _0xb86a76=a1_0x39f1f9,_0x3ac3dc=authService[_0xb86a76(0x210)](),_0xf57007=webrtcService[_0xb86a76(0x251)](),_0x22ad47=webrtcService[_0xb86a76(0x27f)](),_0x3dabd0=topicManager[_0xb86a76(0x1f9)]();_0x2316cd['json']({'status':'ok','environment':process['env']['NODE_ENV']||'development','backendUrl':config[_0xb86a76(0x21e)],'rosbridgeUrl':config[_0xb86a76(0x20a)]['wsEndpoint'],'proxyPort':port,'authenticated':_0x3ac3dc,'topicManagement':{'discovered':_0x3dabd0[_0xb86a76(0x236)],'strategies':_0x3dabd0[_0xb86a76(0x244)],'largeDataTopics':_0x3dabd0[_0xb86a76(0x1e6)][_0xb86a76(0x249)],'largeTopicsList':_0x3dabd0[_0xb86a76(0x1e6)]},'webrtc':{'activeSessions':_0xf57007[_0xb86a76(0x249)],'sharedVideoSources':_0x22ad47['length'],'sessions':_0xf57007,'sharedSources':_0x22ad47}});});const getInitialPort=()=>{const _0x420da5=a1_0x39f1f9;if(process[_0x420da5(0x279)][_0x420da5(0x209)])return parseInt(process[_0x420da5(0x279)][_0x420da5(0x209)],0xa);return config['rosbridge'][_0x420da5(0x24d)];};function a1_0x1404(){const _0x425294=['OPEN','replace','String\x20value\x20is:\x20','getToken','/robot_description','axios','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','base64','toString','types','getStatistics','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','estimatedSize','6446UNNHoU','Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file','open','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','substring','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','25974444nQpzJr','.ply','username','dotenv','request_id','OPTIONS','utf8','PORT','rosbridge','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','topic','prompt-sync','reason','get','isAuthenticated','child_process','APP_USERNAME','readFileSync','production','registration_token','trim','credentials','map','development','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','wsEndpoint','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','serverUrl','slice','method','share','Successfully\x20registered\x20with\x20server','./services/auth','ROSBridge\x20WebSocket\x20URL:\x20','Access-Control-Allow-Methods','topics','./services/webrtcService','Attempting\x20to\x20login\x20to:','some','login','param_name','includes','Connected\x20to\x20server','constructor','mesh_data','Topic\x20discovery\x20failed:','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','getTopicStrategy','get_urdf_param','filename','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','totalTopics','strategy','Loaded\x20appliance\x20identity:','[MESH]\x20Successfully\x20served\x20mesh:\x20','handleMessage','Environment:\x20','Connected\x20to\x20ROSBridge\x20(WebRTC)','104nCOvAT','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','package://','Failed\x20to\x20ping\x20server:','path','throttling','27lBZVHd','strategies','900qgTaYW','unlinkSync','Appliance\x20is\x20running\x20and\x20authenticated!','2935812WlWZpu','length','warn','getAttribute','/rosapi/topics','proxyPort','loadConfig','Failed\x20to\x20register\x20with\x20server:','post','getActiveSessions','\x20from\x20','getElementsByTagName','APP_PASSWORD','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','(((.+)+)+)+$','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','close','service','call_service','Ros','Successfully\x20logged\x20in','error','action','stopAllSessions','message','exit','parseFromString','password','\x20attempts\x20starting\x20from\x20','send','application/json','readyState','1340lBkGzb','232XJAmLd','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','catch','NOT\x20SET','Enter\x20password:\x20','uri','16688dTKmOu','endsWith','ros2\x20param\x20get\x20','registrationToken','values','mesh','roslib','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','Not\x20authenticated','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','env','\x20in\x20use,\x20trying\x20next\x20port...','NODE_ENV','serializeToString','Registering\x20with\x20server...','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','getSharedVideoSources','Access-Control-Allow-Origin','hide','Server\x20connection\x20error:','setAttribute','forward','config','44415yGhobZ','APP_USERNAME=','data','SET','/appliance/register','parse','Failed\x20to\x20start\x20application:','msg','Authentication\x20required','urdf_param_data','Mesh\x20file\x20not\x20found:\x20','stringify','ros2\x20pkg\x20prefix\x20','.mesh','name','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','log','response','[URDF\x20REWRITE]\x20Rewrote\x20','json','code','publish','.appliance.json','service_response','startsWith','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','3436624slOCoe','Failed\x20to\x20connect\x20to\x20server:','string','type','robotId','header','Backend\x20Server\x20URL:\x20','writeFileSync','search','Initial\x20credentials\x20loaded\x20from\x20environment','toLowerCase','\x0aAPP_PASSWORD=','initialize','\x20of\x20','apply','Enter\x20username:\x20','\x20->\x20','express','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','Bearer\x20','join','sample_skip','WSL\x20Appliance','largeDataTopics','63230ZomanZ','ROSBridge\x20(main)\x20connection\x20error:','existsSync','sendStatus','/rosbridge?type=appliance&token=','webrtc_skip','Port\x20','samplingRate'];a1_0x1404=function(){return _0x425294;};return a1_0x1404();}async function listenWithRetries(_0x3bef69,_0x3857ff,_0x326d4e=0xa){const _0x27f37a=a1_0x39f1f9;let _0x851a1f=_0x3857ff;for(let _0x4c93d4=0x1;_0x4c93d4<=_0x326d4e;_0x4c93d4++){try{return await new Promise((_0x8f24ac,_0x3c3bbc)=>{const _0x193f3d=a1_0x194b,_0x591d2a=_0x3bef69['listen'](_0x851a1f,()=>{const _0x137b9b=a1_0x194b;console[_0x137b9b(0x297)](_0x137b9b(0x231)+_0x851a1f),_0x8f24ac(_0x591d2a);});_0x591d2a['on'](_0x193f3d(0x25d),_0x4f8d32=>{const _0xfcdbf0=_0x193f3d;_0x4f8d32[_0xfcdbf0(0x29b)]==='EADDRINUSE'?(console['warn'](_0xfcdbf0(0x1ed)+_0x851a1f+_0xfcdbf0(0x27a)),_0x3c3bbc(_0x4f8d32)):_0x3c3bbc(_0x4f8d32);});}),_0x851a1f;}catch(_0x5b7da4){_0x851a1f++;}}throw new Error(_0x27f37a(0x1ff)+_0x326d4e+_0x27f37a(0x264)+_0x3857ff);}const startApp=async()=>{const _0x2d5949=a1_0x39f1f9;try{reloadEnv();let _0x3ab367=await authService['login']();while(!_0x3ab367){console[_0x2d5949(0x297)](_0x2d5949(0x295)),await promptForCredentials(),_0x3ab367=await authService[_0x2d5949(0x22a)]();}console[_0x2d5949(0x297)](_0x2d5949(0x25c));!loadApplianceIdentity()&&console[_0x2d5949(0x297)](_0x2d5949(0x2a0));console[_0x2d5949(0x297)](_0x2d5949(0x27d));const _0x487ba5=await registerWithServer();if(!_0x487ba5)throw new Error('Failed\x20to\x20register\x20with\x20server');connectToRosbridge(),connectToServer();const _0xeb7654=getInitialPort();await listenWithRetries(app,_0xeb7654,0xa);}catch(_0x586d15){console['error'](_0x2d5949(0x28c),_0x586d15),process[_0x2d5949(0x261)](0x1);}};setInterval(async()=>{const _0x3eb7a4=a1_0x39f1f9;try{if(robotId){const _0xb1890a=authService['getToken']();await axios[_0x3eb7a4(0x250)](config['serverUrl']+'/appliance/ping',{'robotId':robotId},{'headers':{'Authorization':_0x3eb7a4(0x1e2)+_0xb1890a,'Content-Type':'application/json'}});}}catch(_0xfb89b7){console[_0x3eb7a4(0x25d)](_0x3eb7a4(0x240),_0xfb89b7[_0x3eb7a4(0x260)]);}},0x1388),startApp();