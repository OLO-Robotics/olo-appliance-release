const a1_0x15b2b6=a1_0x2273;(function(_0x4e7dcd,_0xf57a35){const _0x1b12a8=a1_0x2273,_0x4f82bd=_0x4e7dcd();while(!![]){try{const _0x247556=-parseInt(_0x1b12a8(0x122))/0x1+parseInt(_0x1b12a8(0x155))/0x2*(parseInt(_0x1b12a8(0x1aa))/0x3)+-parseInt(_0x1b12a8(0x160))/0x4+parseInt(_0x1b12a8(0x16a))/0x5*(parseInt(_0x1b12a8(0x124))/0x6)+parseInt(_0x1b12a8(0x1b1))/0x7*(-parseInt(_0x1b12a8(0x11d))/0x8)+parseInt(_0x1b12a8(0x139))/0x9*(-parseInt(_0x1b12a8(0x18e))/0xa)+parseInt(_0x1b12a8(0x152))/0xb;if(_0x247556===_0xf57a35)break;else _0x4f82bd['push'](_0x4f82bd['shift']());}catch(_0x761501){_0x4f82bd['push'](_0x4f82bd['shift']());}}}(a1_0x4588,0x6d227));const a1_0x3dfe09=(function(){let _0x5f9a13=!![];return function(_0x5935db,_0x283063){const _0xbccc24=_0x5f9a13?function(){const _0x1bd2ac=a1_0x2273;if(_0x283063){const _0x42aac9=_0x283063[_0x1bd2ac(0x1b0)](_0x5935db,arguments);return _0x283063=null,_0x42aac9;}}:function(){};return _0x5f9a13=![],_0xbccc24;};}()),a1_0x1f8fae=a1_0x3dfe09(this,function(){const _0x57516b=a1_0x2273;return a1_0x1f8fae[_0x57516b(0x11b)]()[_0x57516b(0x13f)](_0x57516b(0x1b4))[_0x57516b(0x11b)]()['constructor'](a1_0x1f8fae)[_0x57516b(0x13f)](_0x57516b(0x1b4));});a1_0x1f8fae();function a1_0x4588(){const _0x571e82=['development','param_name','prompt-sync','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','isAuthenticated','NODE_ENV','Mesh\x20file\x20not\x20found:\x20','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','listen','Loaded\x20appliance\x20identity:','EADDRINUSE','http','sendStatus','PORT','.ply','strategy','Registering\x20with\x20server...','values','type','Failed\x20to\x20register\x20with\x20server','exit','.obj','getTopicStrategy','package://','sample','getElementsByTagName','Bearer\x20','service','toLowerCase','base64','Connected\x20to\x20server','map','publish','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','.mesh','310UbLbfO','Disconnected\x20from\x20server\x20(','topics','xmldom','/rosbridge?type=appliance&token=','path','loadConfig','message','log','String\x20value\x20is:\x20','roslib','setAttribute','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','config','username','msg','existsSync','/health','express','Failed\x20to\x20register\x20with\x20server:','Not\x20authenticated','robot\x20not\x20found','stringify','parseFromString','endsWith','child_process','),\x20attempting\x20to\x20reconnect...','rosbridge','3xRRzVK','ROSBridge\x20(WebRTC)\x20connection\x20error:','\x20->\x20','filename','error','wsEndpoint','apply','763KtqkIN','post','header','(((.+)+)+)+$','./config','readyState','send','Successfully\x20registered\x20with\x20server','mesh_data','response','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','robotId','throttling','Authentication\x20required','[MESH]\x20Error\x20serving\x20mesh:','json','text/xml','ROSBridge\x20WebSocket\x20URL:\x20','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','Enter\x20password:\x20','getActiveSessions','get','\x20attempts\x20starting\x20from\x20','\x0aAPP_PASSWORD=','./services/auth','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','./services/webrtcService','method','urdf_param_data','Environment:\x20','parse','/appliance/register','registration_token','topic','[URDF\x20REWRITE]\x20Rewrote\x20','data','\x20of\x20','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','Server\x20connection\x20error:','.env','Access-Control-Allow-Headers','APP_PASSWORD','samplingRate','application/json','Backend\x20Server\x20URL:\x20','toString','largeDataTopics','11848ZSfRRj','share','WSL\x20Appliance','Access-Control-Allow-Methods','replace','513140oISBeP','.dae','167862vtYRLE','uri','ros2\x20param\x20get\x20','some','./services/TopicManager','request_id','sample_skip','login','serializeToString','forward','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','close','getToken','unknown','getAttribute','APP_USERNAME=','unlinkSync','\x20from\x20','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','open','APPLIANCE_BASE_URL','152613dmAbtB','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','match','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','webrtc_skip','search','Port\x20','substring','handleMessage','status','includes','readFileSync','utf8','service_response','proxyPort','warn','writeFileSync','code','call_service','stopAllSessions','slice','totalTopics','/rosapi/topics','APP_USERNAME','12992837vNVlXI','trim','Failed\x20to\x20ping\x20server:','1442436tNDIdH','env','/ros/mesh?uri=','password','OPTIONS','\x20in\x20use,\x20trying\x20next\x20port...','startsWith','use','get_mesh','Attempting\x20to\x20login\x20to:','types','1244352WdXbKK','length','Access-Control-Allow-Origin','serverUrl','registrationToken','connection','ROSBridge\x20(main)\x20connection\x20error:','[MESH]\x20Successfully\x20served\x20mesh:\x20','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','OPEN','10QmRRGC'];a1_0x4588=function(){return _0x571e82;};return a1_0x4588();}const express=require(a1_0x15b2b6(0x1a0)),config=require(a1_0x15b2b6(0x1b5)),authService=require(a1_0x15b2b6(0x1ca)),webrtcService=require(a1_0x15b2b6(0x1cc)),topicManager=require(a1_0x15b2b6(0x128)),WebSocket=require('ws'),axios=require('axios'),fs=require('fs'),prompt=require(a1_0x15b2b6(0x16d))({'sigint':!![]}),dotenv=require('dotenv'),app=express(),port=process[a1_0x15b2b6(0x156)][a1_0x15b2b6(0x178)]||config[a1_0x15b2b6(0x1a9)][a1_0x15b2b6(0x148)],APPLIANCE_FILE='.appliance.json',{DOMParser,XMLSerializer}=require(a1_0x15b2b6(0x191)),path=require(a1_0x15b2b6(0x193)),{execSync}=require(a1_0x15b2b6(0x1a7)),APPLIANCE_BASE_URL=process[a1_0x15b2b6(0x156)][a1_0x15b2b6(0x138)]||'';console['log'](a1_0x15b2b6(0x10b)+(process[a1_0x15b2b6(0x156)]['NODE_ENV']||a1_0x15b2b6(0x16b))),console[a1_0x15b2b6(0x196)](a1_0x15b2b6(0x11a)+config[a1_0x15b2b6(0x163)]),console[a1_0x15b2b6(0x196)](a1_0x15b2b6(0x1c3)+config[a1_0x15b2b6(0x1a9)][a1_0x15b2b6(0x1af)]),console['log']('Proxy\x20listening\x20on\x20port:\x20'+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x4263f9,_0x4d72e9){const _0xd31a77=a1_0x15b2b6;fs[_0xd31a77(0x14a)](_0xd31a77(0x115),_0xd31a77(0x133)+_0x4263f9+_0xd31a77(0x1c9)+_0x4d72e9+'\x0a');}function a1_0x2273(_0x91207b,_0x499003){const _0x192420=a1_0x4588();return a1_0x2273=function(_0x1f8fae,_0x3dfe09){_0x1f8fae=_0x1f8fae-0x10b;let _0x458884=_0x192420[_0x1f8fae];return _0x458884;},a1_0x2273(_0x91207b,_0x499003);}function reloadEnv(){const _0x54f0ff=a1_0x15b2b6;dotenv[_0x54f0ff(0x19b)]({'override':!![]}),config['credentials'][_0x54f0ff(0x19c)]=process[_0x54f0ff(0x156)][_0x54f0ff(0x151)],config['credentials'][_0x54f0ff(0x158)]=process[_0x54f0ff(0x156)][_0x54f0ff(0x117)];}async function promptForCredentials(){const _0xcff5e4=a1_0x15b2b6,_0x22bf9a=prompt('Enter\x20username:\x20'),_0x420f26=prompt['hide'](_0xcff5e4(0x1c5));updateEnvFile(_0x22bf9a,_0x420f26),reloadEnv();}function loadApplianceIdentity(){const _0x16ab4d=a1_0x15b2b6;if(fs[_0x16ab4d(0x19e)](APPLIANCE_FILE))try{const _0x1f556b=JSON[_0x16ab4d(0x10c)](fs[_0x16ab4d(0x145)](APPLIANCE_FILE,_0x16ab4d(0x146)));if(_0x1f556b[_0x16ab4d(0x1bd)]&&_0x1f556b[_0x16ab4d(0x164)])return robotId=_0x1f556b[_0x16ab4d(0x1bd)],registrationToken=_0x1f556b['registrationToken'],console[_0x16ab4d(0x196)](_0x16ab4d(0x174),robotId),topicManager[_0x16ab4d(0x194)](_0x1f556b),!![];}catch(_0x2cb5a9){console[_0x16ab4d(0x1ae)](_0x16ab4d(0x1c4),_0x2cb5a9);}return![];}function saveApplianceIdentity(_0x586fa3,_0x4df459){const _0x4a0428=a1_0x15b2b6;let _0x17af6f={};if(fs[_0x4a0428(0x19e)](APPLIANCE_FILE))try{_0x17af6f=JSON[_0x4a0428(0x10c)](fs['readFileSync'](APPLIANCE_FILE,_0x4a0428(0x146)));}catch(_0x1f348a){_0x17af6f={};}_0x17af6f[_0x4a0428(0x1bd)]=_0x586fa3,_0x17af6f['registrationToken']=_0x4df459,fs[_0x4a0428(0x14a)](APPLIANCE_FILE,JSON['stringify'](_0x17af6f,null,0x2));}async function registerWithServer(){const _0x5532c4=a1_0x15b2b6;try{const _0x45251b=authService['getToken']();if(!_0x45251b)throw new Error(_0x5532c4(0x1a2));let _0x58ea2f,_0x31246c=![];while(!![]){try{robotId&&registrationToken?_0x58ea2f=await axios[_0x5532c4(0x1b2)](config['serverUrl']+_0x5532c4(0x10d),{'name':_0x5532c4(0x11f),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x5532c4(0x185)+_0x45251b,'Content-Type':_0x5532c4(0x119)}}):_0x58ea2f=await axios['post'](config[_0x5532c4(0x163)]+_0x5532c4(0x10d),{'name':_0x5532c4(0x11f)},{'headers':{'Authorization':_0x5532c4(0x185)+_0x45251b,'Content-Type':_0x5532c4(0x119)}});break;}catch(_0x51b600){const _0x490ecc=_0x51b600?.[_0x5532c4(0x1ba)]?.[_0x5532c4(0x111)]?.[_0x5532c4(0x1ae)]||_0x51b600[_0x5532c4(0x195)];if(!_0x31246c&&_0x490ecc&&_0x490ecc[_0x5532c4(0x187)]()[_0x5532c4(0x144)](_0x5532c4(0x1a3))){console[_0x5532c4(0x149)]('Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.');if(fs[_0x5532c4(0x19e)](APPLIANCE_FILE))fs[_0x5532c4(0x134)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x31246c=!![];continue;}throw _0x51b600;}}if(!_0x58ea2f[_0x5532c4(0x111)]||!_0x58ea2f['data'][_0x5532c4(0x10e)]||!_0x58ea2f[_0x5532c4(0x111)]['id'])throw new Error(_0x5532c4(0x13a));return registrationToken=_0x58ea2f[_0x5532c4(0x111)][_0x5532c4(0x10e)],robotId=_0x58ea2f[_0x5532c4(0x111)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x5532c4(0x196)](_0x5532c4(0x1b8)),!![];}catch(_0x3b24ff){return console[_0x5532c4(0x1ae)](_0x5532c4(0x1a1),_0x3b24ff['message']),![];}}function rewriteUrdfMeshUris(_0x9d2afe){const _0x68402f=a1_0x15b2b6;try{const _0x255d99=new DOMParser(),_0x4eca15=_0x255d99[_0x68402f(0x1a5)](_0x9d2afe,_0x68402f(0x1c2));let _0x98b8bf=0x0,_0x1e85bc=0x0;const _0x3cb5fe=_0x4eca15[_0x68402f(0x184)]('mesh');for(let _0x473114=0x0;_0x473114<_0x3cb5fe[_0x68402f(0x161)];_0x473114++){const _0x56b675=_0x3cb5fe[_0x473114],_0x292490=_0x56b675[_0x68402f(0x132)](_0x68402f(0x1ad)),_0x454b2d=['.stl',_0x68402f(0x123),_0x68402f(0x180),_0x68402f(0x179),_0x68402f(0x18d)],_0xf7be7e=_0x454b2d[_0x68402f(0x127)](_0x298794=>_0x292490[_0x68402f(0x187)]()[_0x68402f(0x1a6)](_0x298794));if(_0x292490&&_0x292490['startsWith'](_0x68402f(0x182))&&_0xf7be7e){_0x98b8bf++;const _0x13857d=APPLIANCE_BASE_URL+_0x68402f(0x157)+encodeURIComponent(_0x292490);_0x56b675[_0x68402f(0x199)](_0x68402f(0x1ad),_0x13857d),_0x1e85bc++,console['log']('[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20'+_0x292490+_0x68402f(0x1ac)+_0x13857d);}}_0x98b8bf>0x0?console['log'](_0x68402f(0x110)+_0x1e85bc+_0x68402f(0x112)+_0x98b8bf+_0x68402f(0x136)):console[_0x68402f(0x196)]('[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF');const _0x368118=new XMLSerializer();return _0x368118[_0x68402f(0x12c)](_0x4eca15);}catch(_0x8bcd66){return console[_0x68402f(0x1ae)]('[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):',_0x8bcd66),_0x9d2afe;}}function connectToRosbridge(){const _0x2c0bee=a1_0x15b2b6;try{rosbridgeWs=new WebSocket(config[_0x2c0bee(0x1a9)]['wsEndpoint']),rosbridgeWs['on'](_0x2c0bee(0x137),()=>{const _0x4c86f3=_0x2c0bee;console[_0x4c86f3(0x196)]('Connected\x20to\x20ROSBridge\x20(main)');const _0x1be746=require(_0x4c86f3(0x198)),_0x4fefcc=new _0x1be746['Ros']({'url':config[_0x4c86f3(0x1a9)][_0x4c86f3(0x1af)]});_0x4fefcc['on'](_0x4c86f3(0x165),()=>{setTimeout(()=>{topicManager['discoverTopics'](_0x4fefcc)['catch'](_0x5d5bf5=>{const _0xe820e3=a1_0x2273;console[_0xe820e3(0x1ae)]('Topic\x20discovery\x20failed:',_0x5d5bf5);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on']('message',_0x48966e=>{const _0x2bc144=_0x2c0bee;if(serverWs&&serverWs[_0x2bc144(0x1b6)]===WebSocket['OPEN']){let _0x36c379=_0x48966e['toString']();try{const _0x236049=JSON['parse'](_0x36c379);if(_0x236049['op']===_0x2bc144(0x18b)&&_0x236049['topic']){const _0x351e12=topicManager[_0x2bc144(0x142)](_0x236049);switch(_0x351e12['action']){case _0x2bc144(0x12a):return;case _0x2bc144(0x13e):return;case _0x2bc144(0x12d):default:_0x36c379=JSON[_0x2bc144(0x1a4)](_0x351e12['message']);break;}}if((_0x236049['op']===_0x2bc144(0x147)||_0x236049['op']===_0x2bc144(0x14c))&&(_0x236049[_0x2bc144(0x186)]===_0x2bc144(0x150)||_0x236049[_0x2bc144(0x17c)]&&_0x236049[_0x2bc144(0x17c)][_0x2bc144(0x190)])){console[_0x2bc144(0x196)]('[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata');const _0x2c35fa=_0x236049[_0x2bc144(0x17c)]?.[_0x2bc144(0x190)]||[],_0x245d58=_0x236049[_0x2bc144(0x17c)]?.[_0x2bc144(0x15f)]||[],_0x546467=_0x2c35fa[_0x2bc144(0x18a)]((_0x5d53ab,_0xdc7558)=>{const _0x11c5f5=_0x2bc144,_0x22a79e=topicManager[_0x11c5f5(0x181)](_0x5d53ab);return{'name':_0x5d53ab,'type':_0x245d58[_0xdc7558]||_0x11c5f5(0x131),'throttling':_0x22a79e?{'isThrottled':_0x22a79e[_0x11c5f5(0x17a)]===_0x11c5f5(0x183),'strategy':_0x22a79e[_0x11c5f5(0x17a)],'samplingRate':_0x22a79e[_0x11c5f5(0x118)],'reason':_0x22a79e['reason'],'estimatedSize':_0x22a79e['estimatedSize']}:null};});_0x236049['values']={'topics':_0x546467[_0x2bc144(0x18a)](_0x2cfb71=>_0x2cfb71['name']),'types':_0x546467[_0x2bc144(0x18a)](_0x39ea54=>_0x39ea54[_0x2bc144(0x17d)]),'throttling':_0x546467[_0x2bc144(0x18a)](_0x5f4416=>_0x5f4416[_0x2bc144(0x1be)])},_0x36c379=JSON[_0x2bc144(0x1a4)](_0x236049),console[_0x2bc144(0x196)]('[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client');}if(_0x236049['op']==='publish'&&_0x236049[_0x2bc144(0x10f)]==='/robot_description')try{const _0x500406=_0x236049[_0x2bc144(0x19d)][_0x2bc144(0x111)],_0x138009=rewriteUrdfMeshUris(_0x500406);_0x236049[_0x2bc144(0x19d)][_0x2bc144(0x111)]=_0x138009,_0x36c379=JSON[_0x2bc144(0x1a4)](_0x236049);}catch(_0x3879e1){console[_0x2bc144(0x1ae)](_0x2bc144(0x18c),_0x3879e1);}}catch(_0x26746a){console['warn']('[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:',_0x26746a[_0x2bc144(0x195)]);}serverWs[_0x2bc144(0x1b7)](_0x36c379);}}),rosbridgeWs['on'](_0x2c0bee(0x12f),()=>{const _0x49aeb1=_0x2c0bee;console['log'](_0x49aeb1(0x13b)),webrtcService[_0x49aeb1(0x14d)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on']('error',_0x29594e=>{const _0x50a537=_0x2c0bee;console[_0x50a537(0x1ae)](_0x50a537(0x166),_0x29594e);});}catch(_0xbb3081){console[_0x2c0bee(0x1ae)]('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):',_0xbb3081),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x40ad39=a1_0x15b2b6;try{rosbridgeWebRTCWs=new WebSocket(config[_0x40ad39(0x1a9)][_0x40ad39(0x1af)]),rosbridgeWebRTCWs['on'](_0x40ad39(0x137),()=>{const _0x1ac582=_0x40ad39;console[_0x1ac582(0x196)]('Connected\x20to\x20ROSBridge\x20(WebRTC)'),webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x40ad39(0x195),_0x25e247=>{}),rosbridgeWebRTCWs['on']('close',()=>{const _0x1f8449=_0x40ad39;console[_0x1f8449(0x196)](_0x1f8449(0x113)),webrtcService[_0x1f8449(0x14d)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x40ad39(0x1ae),_0xc77f88=>{const _0x2a0fd5=_0x40ad39;console['error'](_0x2a0fd5(0x1ab),_0xc77f88);});}catch(_0x168489){console[_0x40ad39(0x1ae)](_0x40ad39(0x168),_0x168489),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x2507e3=a1_0x15b2b6;try{if(!registrationToken)throw new Error('Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.');const _0x8a2ffb=config[_0x2507e3(0x163)][_0x2507e3(0x121)](_0x2507e3(0x176),'ws')+_0x2507e3(0x192)+registrationToken;serverWs=new WebSocket(_0x8a2ffb),serverWs['on']('open',()=>{const _0x30ae8e=_0x2507e3;console[_0x30ae8e(0x196)](_0x30ae8e(0x189)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x30ae8e(0x1b6)]===WebSocket[_0x30ae8e(0x169)]&&webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),serverWs['on']('message',_0x55d93b=>{const _0x3585fd=_0x2507e3;if(rosbridgeWs&&rosbridgeWs[_0x3585fd(0x1b6)]===WebSocket[_0x3585fd(0x169)]){let _0x459fe8=_0x55d93b[_0x3585fd(0x11b)]();try{const _0x45f7e3=JSON['parse'](_0x459fe8);if(webrtcService[_0x3585fd(0x142)](_0x45f7e3))return;if(_0x45f7e3['op']==='get_urdf_param'&&typeof _0x45f7e3['param_name']==='string'&&_0x45f7e3[_0x3585fd(0x129)])try{console[_0x3585fd(0x196)](_0x3585fd(0x16e)+_0x45f7e3[_0x3585fd(0x16c)]);const _0x5c4247=execSync(_0x3585fd(0x126)+_0x45f7e3[_0x3585fd(0x16c)],{'encoding':_0x3585fd(0x146)})['trim']();let _0x4e2b9f=_0x5c4247;_0x5c4247['startsWith'](_0x3585fd(0x197))&&(_0x4e2b9f=_0x5c4247[_0x3585fd(0x141)](_0x3585fd(0x197)[_0x3585fd(0x161)]()));_0x4e2b9f[_0x3585fd(0x15b)]('\x22')&&_0x4e2b9f['endsWith']('\x22')&&(_0x4e2b9f=_0x4e2b9f[_0x3585fd(0x14e)](0x1,-0x1));_0x4e2b9f=_0x4e2b9f['replace'](/\\n/g,'\x0a')[_0x3585fd(0x121)](/\\"/g,'\x22');const _0x456f92={'op':_0x3585fd(0x1ce),'request_id':_0x45f7e3[_0x3585fd(0x129)],'data':_0x4e2b9f};serverWs[_0x3585fd(0x1b7)](JSON[_0x3585fd(0x1a4)](_0x456f92)),console[_0x3585fd(0x196)](_0x3585fd(0x1bb)+_0x45f7e3[_0x3585fd(0x16c)]);return;}catch(_0x461286){console[_0x3585fd(0x1ae)](_0x3585fd(0x1cb),_0x461286);const _0x12d51e={'op':_0x3585fd(0x1ce),'request_id':_0x45f7e3['request_id'],'error':_0x461286[_0x3585fd(0x195)]};serverWs['send'](JSON[_0x3585fd(0x1a4)](_0x12d51e));return;}if(_0x45f7e3['op']===_0x3585fd(0x15d)&&typeof _0x45f7e3['uri']==='string'&&_0x45f7e3[_0x3585fd(0x129)])try{const _0x2b1dfa=_0x45f7e3['uri'][_0x3585fd(0x13c)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x2b1dfa){const _0x460774=_0x2b1dfa[0x1],_0x5e1c83=_0x2b1dfa[0x2],_0x3d4169=execSync('ros2\x20pkg\x20prefix\x20'+_0x460774,{'encoding':'utf8'})[_0x3585fd(0x153)](),_0x2efc99=path['join'](_0x3d4169,_0x3585fd(0x11e),_0x460774,_0x5e1c83);if(!fs['existsSync'](_0x2efc99))throw new Error(_0x3585fd(0x171)+_0x2efc99);const _0x2a4603=fs[_0x3585fd(0x145)](_0x2efc99),_0x1152c4={'op':_0x3585fd(0x1b9),'request_id':_0x45f7e3[_0x3585fd(0x129)],'data':_0x2a4603[_0x3585fd(0x11b)](_0x3585fd(0x188))};serverWs['send'](JSON[_0x3585fd(0x1a4)](_0x1152c4)),console['log'](_0x3585fd(0x167)+_0x45f7e3[_0x3585fd(0x125)]+_0x3585fd(0x135)+_0x2efc99);return;}}catch(_0x4f4d6d){console[_0x3585fd(0x1ae)](_0x3585fd(0x1c0),_0x4f4d6d);const _0x5eddff={'op':'mesh_data','request_id':_0x45f7e3[_0x3585fd(0x129)],'error':_0x4f4d6d['message']};serverWs['send'](JSON['stringify'](_0x5eddff));return;}rosbridgeWs[_0x3585fd(0x1b7)](_0x459fe8);}catch(_0x59f20d){rosbridgeWs[_0x3585fd(0x1b7)](_0x459fe8);}}}),serverWs['on'](_0x2507e3(0x12f),(_0x1a972d,_0x5a8397)=>{const _0x1f78b7=_0x2507e3;console['log'](_0x1f78b7(0x18f)+_0x1a972d+':\x20'+_0x5a8397+_0x1f78b7(0x1a8)),webrtcService[_0x1f78b7(0x14d)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x2507e3(0x1ae),_0x4d5792=>{const _0x277db4=_0x2507e3;console[_0x277db4(0x1ae)](_0x277db4(0x114),_0x4d5792);});}catch(_0x4d99a3){console[_0x2507e3(0x1ae)]('Failed\x20to\x20connect\x20to\x20server:',_0x4d99a3),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x1abfa9,_0xb7148a,_0x1b7da3)=>{const _0x2c8f65=a1_0x15b2b6;if(!authService[_0x2c8f65(0x16f)]()){console[_0x2c8f65(0x196)](_0x2c8f65(0x15e),config[_0x2c8f65(0x163)]);const _0x38413c=await authService[_0x2c8f65(0x12b)]();if(!_0x38413c)return _0xb7148a[_0x2c8f65(0x143)](0x191)['json']({'error':_0x2c8f65(0x1bf)});}_0x1b7da3();};app[a1_0x15b2b6(0x15c)]((_0x59e393,_0x3dd41c,_0x9ff157)=>{const _0x71dad0=a1_0x15b2b6;_0x3dd41c[_0x71dad0(0x1b3)](_0x71dad0(0x162),'*'),_0x3dd41c['header'](_0x71dad0(0x120),'GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS'),_0x3dd41c[_0x71dad0(0x1b3)](_0x71dad0(0x116),_0x71dad0(0x13d)),_0x59e393[_0x71dad0(0x1cd)]===_0x71dad0(0x159)?_0x3dd41c[_0x71dad0(0x177)](0xc8):_0x9ff157();}),app[a1_0x15b2b6(0x1c7)]('/',requireAuth,(_0x329368,_0x433726)=>{const _0x466048=a1_0x15b2b6;_0x433726[_0x466048(0x1b7)]('Appliance\x20is\x20running\x20and\x20authenticated!');}),app[a1_0x15b2b6(0x1c7)](a1_0x15b2b6(0x19f),async(_0x971fee,_0x44b298)=>{const _0x230b7f=a1_0x15b2b6,_0xed6db=authService['isAuthenticated'](),_0x27053f=webrtcService[_0x230b7f(0x1c6)](),_0x4314e0=webrtcService['getSharedVideoSources'](),_0x348de9=topicManager['getStatistics']();_0x44b298[_0x230b7f(0x1c1)]({'status':'ok','environment':process['env'][_0x230b7f(0x170)]||_0x230b7f(0x16b),'backendUrl':config[_0x230b7f(0x163)],'rosbridgeUrl':config[_0x230b7f(0x1a9)][_0x230b7f(0x1af)],'proxyPort':port,'authenticated':_0xed6db,'topicManagement':{'discovered':_0x348de9[_0x230b7f(0x14f)],'strategies':_0x348de9['strategies'],'largeDataTopics':_0x348de9[_0x230b7f(0x11c)]['length'],'largeTopicsList':_0x348de9[_0x230b7f(0x11c)]},'webrtc':{'activeSessions':_0x27053f[_0x230b7f(0x161)],'sharedVideoSources':_0x4314e0[_0x230b7f(0x161)],'sessions':_0x27053f,'sharedSources':_0x4314e0}});});const getInitialPort=()=>{const _0x5009d3=a1_0x15b2b6;if(process[_0x5009d3(0x156)][_0x5009d3(0x178)])return parseInt(process[_0x5009d3(0x156)][_0x5009d3(0x178)],0xa);return config['rosbridge'][_0x5009d3(0x148)];};async function listenWithRetries(_0x1b1a73,_0xa1ff6,_0x58d470=0xa){const _0x6c2659=a1_0x15b2b6;let _0x246717=_0xa1ff6;for(let _0x279566=0x1;_0x279566<=_0x58d470;_0x279566++){try{return await new Promise((_0x2641ee,_0x3c8481)=>{const _0xa0d01e=a1_0x2273,_0x1b76c2=_0x1b1a73[_0xa0d01e(0x173)](_0x246717,()=>{const _0x20f6b4=_0xa0d01e;console[_0x20f6b4(0x196)](_0x20f6b4(0x172)+_0x246717),_0x2641ee(_0x1b76c2);});_0x1b76c2['on'](_0xa0d01e(0x1ae),_0x46b715=>{const _0xbab9d7=_0xa0d01e;_0x46b715[_0xbab9d7(0x14b)]===_0xbab9d7(0x175)?(console[_0xbab9d7(0x149)](_0xbab9d7(0x140)+_0x246717+_0xbab9d7(0x15a)),_0x3c8481(_0x46b715)):_0x3c8481(_0x46b715);});}),_0x246717;}catch(_0xfc5e0d){_0x246717++;}}throw new Error(_0x6c2659(0x19a)+_0x58d470+_0x6c2659(0x1c8)+_0xa1ff6);}const startApp=async()=>{const _0x42732a=a1_0x15b2b6;try{let _0xe767b8=await authService[_0x42732a(0x12b)]();while(!_0xe767b8){console[_0x42732a(0x196)](_0x42732a(0x1bc)),await promptForCredentials(),_0xe767b8=await authService[_0x42732a(0x12b)]();}console[_0x42732a(0x196)]('Successfully\x20logged\x20in');!loadApplianceIdentity()&&console['log'](_0x42732a(0x12e));console[_0x42732a(0x196)](_0x42732a(0x17b));const _0x1cbd7e=await registerWithServer();if(!_0x1cbd7e)throw new Error(_0x42732a(0x17e));connectToRosbridge(),connectToServer();const _0x2d0fc9=getInitialPort();await listenWithRetries(app,_0x2d0fc9,0xa);}catch(_0x13081e){console[_0x42732a(0x1ae)]('Failed\x20to\x20start\x20application:',_0x13081e),process[_0x42732a(0x17f)](0x1);}};setInterval(async()=>{const _0x3ee93a=a1_0x15b2b6;try{if(robotId){const _0x1c28b1=authService[_0x3ee93a(0x130)]();await axios[_0x3ee93a(0x1b2)](config[_0x3ee93a(0x163)]+'/appliance/ping',{'robotId':robotId},{'headers':{'Authorization':_0x3ee93a(0x185)+_0x1c28b1,'Content-Type':_0x3ee93a(0x119)}});}}catch(_0x1a0b1f){console[_0x3ee93a(0x1ae)](_0x3ee93a(0x154),_0x1a0b1f[_0x3ee93a(0x195)]);}},0x1388),startApp();