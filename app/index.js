const a1_0x46e7c6=a1_0x2232;(function(_0x5a6d60,_0x3ddb95){const _0x1e00eb=a1_0x2232,_0x325042=_0x5a6d60();while(!![]){try{const _0x27621e=-parseInt(_0x1e00eb(0x15c))/0x1*(-parseInt(_0x1e00eb(0x170))/0x2)+-parseInt(_0x1e00eb(0x14c))/0x3*(-parseInt(_0x1e00eb(0xfe))/0x4)+-parseInt(_0x1e00eb(0x12b))/0x5+parseInt(_0x1e00eb(0x18d))/0x6*(parseInt(_0x1e00eb(0x145))/0x7)+parseInt(_0x1e00eb(0x115))/0x8*(-parseInt(_0x1e00eb(0x108))/0x9)+-parseInt(_0x1e00eb(0x15b))/0xa*(-parseInt(_0x1e00eb(0x10d))/0xb)+parseInt(_0x1e00eb(0x173))/0xc*(-parseInt(_0x1e00eb(0xe1))/0xd);if(_0x27621e===_0x3ddb95)break;else _0x325042['push'](_0x325042['shift']());}catch(_0x4180d3){_0x325042['push'](_0x325042['shift']());}}}(a1_0x15ef,0x742fd));function a1_0x2232(_0x2316e2,_0x481395){const _0x160f7b=a1_0x15ef();return a1_0x2232=function(_0x135e15,_0x3fbafc){_0x135e15=_0x135e15-0xc6;let _0x15ef24=_0x160f7b[_0x135e15];return _0x15ef24;},a1_0x2232(_0x2316e2,_0x481395);}const a1_0x3fbafc=(function(){let _0x22a023=!![];return function(_0x58ae4d,_0x5be8f3){const _0x288350=_0x22a023?function(){if(_0x5be8f3){const _0xbb8abc=_0x5be8f3['apply'](_0x58ae4d,arguments);return _0x5be8f3=null,_0xbb8abc;}}:function(){};return _0x22a023=![],_0x288350;};}()),a1_0x135e15=a1_0x3fbafc(this,function(){const _0x521a85=a1_0x2232;return a1_0x135e15[_0x521a85(0x184)]()['search'](_0x521a85(0x18a))[_0x521a85(0x184)]()['constructor'](a1_0x135e15)[_0x521a85(0x126)](_0x521a85(0x18a));});a1_0x135e15();const dotenv=require(a1_0x46e7c6(0xdd));dotenv[a1_0x46e7c6(0xf4)]();const express=require(a1_0x46e7c6(0x133)),config=require(a1_0x46e7c6(0x16d));process['env'][a1_0x46e7c6(0x158)]&&process['env'][a1_0x46e7c6(0x103)]&&(config[a1_0x46e7c6(0x17c)][a1_0x46e7c6(0x187)]=process[a1_0x46e7c6(0x121)]['APP_USERNAME'],config[a1_0x46e7c6(0x17c)]['password']=process['env'][a1_0x46e7c6(0x103)],console['log'](a1_0x46e7c6(0x14b)));const authService=require('./services/auth'),webrtcService=require('./services/webrtcService'),topicManager=require(a1_0x46e7c6(0x175)),WebSocket=require('ws'),axios=require('axios'),fs=require('fs'),prompt=require(a1_0x46e7c6(0x134))({'sigint':!![]}),app=express(),port=process[a1_0x46e7c6(0x121)][a1_0x46e7c6(0x13c)]||config['rosbridge']['proxyPort'],APPLIANCE_FILE=a1_0x46e7c6(0x16c),{DOMParser,XMLSerializer}=require(a1_0x46e7c6(0x12d)),path=require(a1_0x46e7c6(0x161)),{execSync}=require('child_process'),APPLIANCE_BASE_URL=process[a1_0x46e7c6(0x121)][a1_0x46e7c6(0x130)]||'';console[a1_0x46e7c6(0x124)](a1_0x46e7c6(0xd0)+(process[a1_0x46e7c6(0x121)][a1_0x46e7c6(0x102)]||a1_0x46e7c6(0xf3))),console[a1_0x46e7c6(0x124)](a1_0x46e7c6(0xcb)+config['serverUrl']),console[a1_0x46e7c6(0x124)]('ROSBridge\x20WebSocket\x20URL:\x20'+config[a1_0x46e7c6(0x17d)]['wsEndpoint']),console['log'](a1_0x46e7c6(0xd4)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x59045a,_0xc18744){const _0xe6fd1d=a1_0x46e7c6;fs[_0xe6fd1d(0x131)]('.env',_0xe6fd1d(0x163)+_0x59045a+_0xe6fd1d(0x11b)+_0xc18744+'\x0a');}function reloadEnv(){const _0x1625e9=a1_0x46e7c6;dotenv[_0x1625e9(0xf4)]({'override':!![]}),config[_0x1625e9(0x17c)][_0x1625e9(0x187)]=process[_0x1625e9(0x121)][_0x1625e9(0x158)],config[_0x1625e9(0x17c)][_0x1625e9(0x13e)]=process['env'][_0x1625e9(0x103)],console[_0x1625e9(0x124)](_0x1625e9(0x149),{'username':config['credentials']['username']?_0x1625e9(0x17f):_0x1625e9(0x137),'password':config['credentials'][_0x1625e9(0x13e)]?_0x1625e9(0x17f):_0x1625e9(0x137)});}async function promptForCredentials(){const _0x589e76=a1_0x46e7c6;process[_0x589e76(0x121)][_0x589e76(0x102)]==='production'&&(console[_0x589e76(0x189)](_0x589e76(0x178)),console['error'](_0x589e76(0x185)),process[_0x589e76(0x11c)](0x1));const _0x1bf5ee=prompt(_0x589e76(0x10a)),_0x4017da=prompt['hide']('Enter\x20password:\x20');updateEnvFile(_0x1bf5ee,_0x4017da),reloadEnv();}function loadApplianceIdentity(){const _0xe82b49=a1_0x46e7c6;if(fs[_0xe82b49(0x150)](APPLIANCE_FILE))try{const _0x191630=JSON[_0xe82b49(0x10c)](fs[_0xe82b49(0x118)](APPLIANCE_FILE,'utf8'));if(_0x191630['robotId']&&_0x191630['registrationToken'])return robotId=_0x191630[_0xe82b49(0xcf)],registrationToken=_0x191630[_0xe82b49(0xe7)],console[_0xe82b49(0x124)](_0xe82b49(0x113),robotId),topicManager[_0xe82b49(0x151)](_0x191630),!![];}catch(_0x32b231){console[_0xe82b49(0x189)](_0xe82b49(0xdb),_0x32b231);}return![];}function saveApplianceIdentity(_0x50eb61,_0x5f3b6e){const _0x1d9569=a1_0x46e7c6;let _0x3a1b3b={};if(fs[_0x1d9569(0x150)](APPLIANCE_FILE))try{_0x3a1b3b=JSON[_0x1d9569(0x10c)](fs[_0x1d9569(0x118)](APPLIANCE_FILE,'utf8'));}catch(_0x17574d){_0x3a1b3b={};}_0x3a1b3b[_0x1d9569(0xcf)]=_0x50eb61,_0x3a1b3b[_0x1d9569(0xe7)]=_0x5f3b6e,fs['writeFileSync'](APPLIANCE_FILE,JSON[_0x1d9569(0x14e)](_0x3a1b3b,null,0x2));}function a1_0x15ef(){const _0x3eff8a=['samplingRate','Bearer\x20','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','ROSBridge\x20(WebRTC)\x20connection\x20error:','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','roslib','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','map','.appliance.json','./config','urdf_param_data','request_id','10awJKSN','toLowerCase','Mesh\x20file\x20not\x20found:\x20','48384lBXhvr','\x20attempts\x20starting\x20from\x20','./services/TopicManager','code','String\x20value\x20is:\x20','Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file','open','method','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','credentials','rosbridge','Failed\x20to\x20ping\x20server:','SET','topic','Failed\x20to\x20register\x20with\x20server','unlinkSync','data','toString','Please\x20run:\x20./setup.sh\x20reconfigure','Failed\x20to\x20connect\x20to\x20server:','username','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','error','(((.+)+)+)+$','name','Access-Control-Allow-Methods','6uLGpGV','use','mesh_data','getToken','robot\x20not\x20found','send','webrtc_skip','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','serverUrl','Backend\x20Server\x20URL:\x20','forward','catch','stopAllSessions','robotId','Environment:\x20','Topic\x20discovery\x20failed:','header','Attempting\x20to\x20login\x20to:','Proxy\x20listening\x20on\x20port:\x20','Access-Control-Allow-Origin','wsEndpoint','.mesh','text/xml','values','publish','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','OPEN','dotenv','readyState','sample_skip','.dae','4173YqjuaV','package://','[MESH]\x20Error\x20serving\x20mesh:','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','strategies','registrationToken','\x20from\x20','totalTopics','Appliance\x20is\x20running\x20and\x20authenticated!','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','proxyPort','length','getActiveSessions','get_mesh','filename','service','development','config','isAuthenticated','msg','setAttribute','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','sendStatus','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','utf8','\x20in\x20use,\x20trying\x20next\x20port...','serializeToString','20380ePwryT','mesh','\x20->\x20','Failed\x20to\x20start\x20application:','NODE_ENV','APP_PASSWORD','substring','/appliance/ping','unknown','action','4239oXIgQQ','getSharedVideoSources','Enter\x20username:\x20','http','parse','33olysXw','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','Successfully\x20logged\x20in','endsWith','/robot_description','Loaded\x20appliance\x20identity:','some','2768iewHQt','status','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','readFileSync','response','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','\x0aAPP_PASSWORD=','exit','application/json','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','replace','sample','env','.ply','startsWith','log','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','search','uri','reason','throttling','json','1106280GfsmJY','getStatistics','xmldom','registration_token','types','APPLIANCE_BASE_URL','writeFileSync','topics','express','prompt-sync','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','string','NOT\x20SET','Disconnected\x20from\x20server\x20(','includes','Not\x20authenticated','[URDF\x20REWRITE]\x20Rewrote\x20','PORT','ros2\x20param\x20get\x20','password','handleMessage','getTopicStrategy','Successfully\x20registered\x20with\x20server','estimatedSize','param_name','largeDataTopics','2775941ykfzZv','ros2\x20pkg\x20prefix\x20','/rosbridge?type=appliance&token=','discoverTopics','Loaded\x20credentials:','base64','Initial\x20credentials\x20loaded\x20from\x20environment','87lEKFBH','get_urdf_param','stringify','close','existsSync','loadConfig','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','message','service_response','get','.stl','post','APP_USERNAME','login','/appliance/register','2727040BbjFIZ','158393sTWdYT','Server\x20connection\x20error:','share','trim','initialize','path','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','APP_USERNAME='];a1_0x15ef=function(){return _0x3eff8a;};return a1_0x15ef();}async function registerWithServer(){const _0x335dae=a1_0x46e7c6;try{const _0x3c36cc=authService[_0x335dae(0x190)]();if(!_0x3c36cc)throw new Error(_0x335dae(0x13a));let _0x38174f,_0x39d26f=![];while(!![]){try{robotId&&registrationToken?_0x38174f=await axios[_0x335dae(0x157)](config[_0x335dae(0xca)]+_0x335dae(0x15a),{'name':'WSL\x20Appliance','robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':'Bearer\x20'+_0x3c36cc,'Content-Type':_0x335dae(0x11d)}}):_0x38174f=await axios[_0x335dae(0x157)](config[_0x335dae(0xca)]+_0x335dae(0x15a),{'name':'WSL\x20Appliance'},{'headers':{'Authorization':_0x335dae(0x165)+_0x3c36cc,'Content-Type':'application/json'}});break;}catch(_0x1db2f9){const _0x1d0cd0=_0x1db2f9?.[_0x335dae(0x119)]?.[_0x335dae(0x183)]?.[_0x335dae(0x189)]||_0x1db2f9[_0x335dae(0x153)];if(!_0x39d26f&&_0x1d0cd0&&_0x1d0cd0['toLowerCase']()[_0x335dae(0x139)](_0x335dae(0xc6))){console['warn'](_0x335dae(0xc9));if(fs[_0x335dae(0x150)](APPLIANCE_FILE))fs[_0x335dae(0x182)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x39d26f=!![];continue;}throw _0x1db2f9;}}if(!_0x38174f['data']||!_0x38174f[_0x335dae(0x183)][_0x335dae(0x12e)]||!_0x38174f[_0x335dae(0x183)]['id'])throw new Error(_0x335dae(0xe4));return registrationToken=_0x38174f[_0x335dae(0x183)][_0x335dae(0x12e)],robotId=_0x38174f[_0x335dae(0x183)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x335dae(0x124)](_0x335dae(0x141)),!![];}catch(_0x223cf3){return console[_0x335dae(0x189)]('Failed\x20to\x20register\x20with\x20server:',_0x223cf3['message']),![];}}function rewriteUrdfMeshUris(_0x392c8c){const _0x24e3e7=a1_0x46e7c6;try{const _0x27ba41=new DOMParser(),_0xcdd695=_0x27ba41['parseFromString'](_0x392c8c,_0x24e3e7(0xd8));let _0x5ca22e=0x0,_0x5c6d8a=0x0;const _0x46d750=_0xcdd695['getElementsByTagName'](_0x24e3e7(0xff));for(let _0x3cddde=0x0;_0x3cddde<_0x46d750[_0x24e3e7(0xee)];_0x3cddde++){const _0x4a08ca=_0x46d750[_0x3cddde],_0x819360=_0x4a08ca['getAttribute'](_0x24e3e7(0xf1)),_0x4be186=[_0x24e3e7(0x156),_0x24e3e7(0xe0),'.obj',_0x24e3e7(0x122),_0x24e3e7(0xd7)],_0x43272b=_0x4be186[_0x24e3e7(0x114)](_0x3b7460=>_0x819360[_0x24e3e7(0x171)]()[_0x24e3e7(0x111)](_0x3b7460));if(_0x819360&&_0x819360[_0x24e3e7(0x123)](_0x24e3e7(0xe2))&&_0x43272b){_0x5ca22e++;const _0x262b96=APPLIANCE_BASE_URL+'/ros/mesh?uri='+encodeURIComponent(_0x819360);_0x4a08ca[_0x24e3e7(0xf7)](_0x24e3e7(0xf1),_0x262b96),_0x5c6d8a++,console[_0x24e3e7(0x124)](_0x24e3e7(0xe5)+_0x819360+_0x24e3e7(0x100)+_0x262b96);}}_0x5ca22e>0x0?console[_0x24e3e7(0x124)](_0x24e3e7(0x13b)+_0x5c6d8a+'\x20of\x20'+_0x5ca22e+_0x24e3e7(0x10f)):console['log'](_0x24e3e7(0x10e));const _0x53eca6=new XMLSerializer();return _0x53eca6[_0x24e3e7(0xfd)](_0xcdd695);}catch(_0x4cf4ca){return console['error']('[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):',_0x4cf4ca),_0x392c8c;}}function connectToRosbridge(){const _0x398d85=a1_0x46e7c6;try{rosbridgeWs=new WebSocket(config[_0x398d85(0x17d)][_0x398d85(0xd6)]),rosbridgeWs['on'](_0x398d85(0x179),()=>{const _0x42c0a0=_0x398d85;console['log']('Connected\x20to\x20ROSBridge\x20(main)');const _0x23e707=require(_0x42c0a0(0x169)),_0x586605=new _0x23e707['Ros']({'url':config['rosbridge'][_0x42c0a0(0xd6)]});_0x586605['on']('connection',()=>{setTimeout(()=>{const _0x3c3538=a1_0x2232;topicManager[_0x3c3538(0x148)](_0x586605)[_0x3c3538(0xcd)](_0xef0089=>{const _0xad4114=_0x3c3538;console[_0xad4114(0x189)](_0xad4114(0xd1),_0xef0089);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x398d85(0x153),_0x2e16a0=>{const _0x3720bb=_0x398d85;if(serverWs&&serverWs[_0x3720bb(0xde)]===WebSocket[_0x3720bb(0xdc)]){let _0x4bf188=_0x2e16a0['toString']();try{const _0x3c3457=JSON[_0x3720bb(0x10c)](_0x4bf188);if(_0x3c3457['op']===_0x3720bb(0xda)&&_0x3c3457[_0x3720bb(0x180)]){const _0xc68bc1=topicManager[_0x3720bb(0x13f)](_0x3c3457);switch(_0xc68bc1[_0x3720bb(0x107)]){case _0x3720bb(0xdf):return;case _0x3720bb(0xc8):return;case _0x3720bb(0xcc):default:_0x4bf188=JSON[_0x3720bb(0x14e)](_0xc68bc1[_0x3720bb(0x153)]);break;}}if((_0x3c3457['op']===_0x3720bb(0x154)||_0x3c3457['op']==='call_service')&&(_0x3c3457[_0x3720bb(0xf2)]==='/rosapi/topics'||_0x3c3457['values']&&_0x3c3457[_0x3720bb(0xd9)][_0x3720bb(0x132)])){console[_0x3720bb(0x124)](_0x3720bb(0x188));const _0x4e66cc=_0x3c3457[_0x3720bb(0xd9)]?.[_0x3720bb(0x132)]||[],_0x4d094d=_0x3c3457[_0x3720bb(0xd9)]?.[_0x3720bb(0x12f)]||[],_0x3354c1=_0x4e66cc[_0x3720bb(0x16b)]((_0x2e789a,_0x3cef6a)=>{const _0x525784=_0x3720bb,_0x52d227=topicManager[_0x525784(0x140)](_0x2e789a);return{'name':_0x2e789a,'type':_0x4d094d[_0x3cef6a]||_0x525784(0x106),'throttling':_0x52d227?{'isThrottled':_0x52d227['strategy']===_0x525784(0x120),'strategy':_0x52d227['strategy'],'samplingRate':_0x52d227[_0x525784(0x164)],'reason':_0x52d227[_0x525784(0x128)],'estimatedSize':_0x52d227[_0x525784(0x142)]}:null};});_0x3c3457[_0x3720bb(0xd9)]={'topics':_0x3354c1[_0x3720bb(0x16b)](_0x3c2ce8=>_0x3c2ce8[_0x3720bb(0x18b)]),'types':_0x3354c1['map'](_0x582195=>_0x582195['type']),'throttling':_0x3354c1[_0x3720bb(0x16b)](_0x9d1097=>_0x9d1097[_0x3720bb(0x129)])},_0x4bf188=JSON['stringify'](_0x3c3457),console[_0x3720bb(0x124)](_0x3720bb(0xfa));}if(_0x3c3457['op']===_0x3720bb(0xda)&&_0x3c3457['topic']===_0x3720bb(0x112))try{const _0x4f77fa=_0x3c3457[_0x3720bb(0xf6)][_0x3720bb(0x183)],_0x3d2dc2=rewriteUrdfMeshUris(_0x4f77fa);_0x3c3457[_0x3720bb(0xf6)]['data']=_0x3d2dc2,_0x4bf188=JSON[_0x3720bb(0x14e)](_0x3c3457);}catch(_0x21adf1){console['error'](_0x3720bb(0x117),_0x21adf1);}}catch(_0x29d3f7){console['warn'](_0x3720bb(0x166),_0x29d3f7[_0x3720bb(0x153)]);}serverWs[_0x3720bb(0xc7)](_0x4bf188);}}),rosbridgeWs['on']('close',()=>{const _0x5c71c7=_0x398d85;console[_0x5c71c7(0x124)](_0x5c71c7(0x17b)),webrtcService[_0x5c71c7(0xce)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x398d85(0x189),_0x304476=>{console['error']('ROSBridge\x20(main)\x20connection\x20error:',_0x304476);});}catch(_0x32e3e2){console[_0x398d85(0x189)](_0x398d85(0xeb),_0x32e3e2),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x43599e=a1_0x46e7c6;try{rosbridgeWebRTCWs=new WebSocket(config[_0x43599e(0x17d)][_0x43599e(0xd6)]),rosbridgeWebRTCWs['on'](_0x43599e(0x179),()=>{const _0x3744db=_0x43599e;console['log']('Connected\x20to\x20ROSBridge\x20(WebRTC)'),webrtcService[_0x3744db(0x160)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x43599e(0x153),_0x15b29e=>{}),rosbridgeWebRTCWs['on'](_0x43599e(0x14f),()=>{const _0x469185=_0x43599e;console[_0x469185(0x124)](_0x469185(0x162)),webrtcService[_0x469185(0xce)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x43599e(0x189),_0x26d42d=>{const _0x182a03=_0x43599e;console[_0x182a03(0x189)](_0x182a03(0x167),_0x26d42d);});}catch(_0x7cd0a3){console[_0x43599e(0x189)]('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):',_0x7cd0a3),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x5ac13d=a1_0x46e7c6;try{if(!registrationToken)throw new Error(_0x5ac13d(0x11a));const _0x4c8510=config[_0x5ac13d(0xca)][_0x5ac13d(0x11f)](_0x5ac13d(0x10b),'ws')+_0x5ac13d(0x147)+registrationToken;serverWs=new WebSocket(_0x4c8510),serverWs['on'](_0x5ac13d(0x179),()=>{const _0x3a54f7=_0x5ac13d;console[_0x3a54f7(0x124)]('Connected\x20to\x20server'),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x3a54f7(0xde)]===WebSocket[_0x3a54f7(0xdc)]&&webrtcService[_0x3a54f7(0x160)](rosbridgeWebRTCWs,serverWs);}),serverWs['on']('message',_0x109b70=>{const _0x18b381=_0x5ac13d;if(rosbridgeWs&&rosbridgeWs[_0x18b381(0xde)]===WebSocket['OPEN']){let _0x2ad0cf=_0x109b70[_0x18b381(0x184)]();try{const _0x4b3b7a=JSON['parse'](_0x2ad0cf);if(webrtcService[_0x18b381(0x13f)](_0x4b3b7a))return;if(_0x4b3b7a['op']===_0x18b381(0x14d)&&typeof _0x4b3b7a[_0x18b381(0x143)]===_0x18b381(0x136)&&_0x4b3b7a[_0x18b381(0x16f)])try{console[_0x18b381(0x124)](_0x18b381(0xf8)+_0x4b3b7a['param_name']);const _0x6e42ea=execSync(_0x18b381(0x13d)+_0x4b3b7a[_0x18b381(0x143)],{'encoding':'utf8'})[_0x18b381(0x15f)]();let _0x31e6ae=_0x6e42ea;_0x6e42ea[_0x18b381(0x123)](_0x18b381(0x177))&&(_0x31e6ae=_0x6e42ea[_0x18b381(0x104)](_0x18b381(0x177)[_0x18b381(0xee)]()));_0x31e6ae['startsWith']('\x22')&&_0x31e6ae['endsWith']('\x22')&&(_0x31e6ae=_0x31e6ae['slice'](0x1,-0x1));_0x31e6ae=_0x31e6ae[_0x18b381(0x11f)](/\\n/g,'\x0a')[_0x18b381(0x11f)](/\\"/g,'\x22');const _0x13e94a={'op':_0x18b381(0x16e),'request_id':_0x4b3b7a[_0x18b381(0x16f)],'data':_0x31e6ae};serverWs[_0x18b381(0xc7)](JSON[_0x18b381(0x14e)](_0x13e94a)),console[_0x18b381(0x124)](_0x18b381(0xec)+_0x4b3b7a[_0x18b381(0x143)]);return;}catch(_0x3c0b48){console[_0x18b381(0x189)]('[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:',_0x3c0b48);const _0x12e0e0={'op':_0x18b381(0x16e),'request_id':_0x4b3b7a[_0x18b381(0x16f)],'error':_0x3c0b48[_0x18b381(0x153)]};serverWs[_0x18b381(0xc7)](JSON[_0x18b381(0x14e)](_0x12e0e0));return;}if(_0x4b3b7a['op']===_0x18b381(0xf0)&&typeof _0x4b3b7a[_0x18b381(0x127)]===_0x18b381(0x136)&&_0x4b3b7a[_0x18b381(0x16f)])try{const _0x4b7b10=_0x4b3b7a[_0x18b381(0x127)]['match'](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x4b7b10){const _0x327833=_0x4b7b10[0x1],_0x542345=_0x4b7b10[0x2],_0x3cd6d6=execSync(_0x18b381(0x146)+_0x327833,{'encoding':_0x18b381(0xfb)})['trim'](),_0x2603c3=path['join'](_0x3cd6d6,_0x18b381(0x15e),_0x327833,_0x542345);if(!fs[_0x18b381(0x150)](_0x2603c3))throw new Error(_0x18b381(0x172)+_0x2603c3);const _0x39f3a7=fs[_0x18b381(0x118)](_0x2603c3),_0x39e5aa={'op':'mesh_data','request_id':_0x4b3b7a[_0x18b381(0x16f)],'data':_0x39f3a7[_0x18b381(0x184)](_0x18b381(0x14a))};serverWs[_0x18b381(0xc7)](JSON[_0x18b381(0x14e)](_0x39e5aa)),console['log']('[MESH]\x20Successfully\x20served\x20mesh:\x20'+_0x4b3b7a['uri']+_0x18b381(0xe8)+_0x2603c3);return;}}catch(_0x35aa40){console['error'](_0x18b381(0xe3),_0x35aa40);const _0xc28953={'op':_0x18b381(0x18f),'request_id':_0x4b3b7a['request_id'],'error':_0x35aa40[_0x18b381(0x153)]};serverWs[_0x18b381(0xc7)](JSON['stringify'](_0xc28953));return;}rosbridgeWs[_0x18b381(0xc7)](_0x2ad0cf);}catch(_0x5cdc99){rosbridgeWs['send'](_0x2ad0cf);}}}),serverWs['on'](_0x5ac13d(0x14f),(_0x1b7bc3,_0x2e95ce)=>{const _0x10f417=_0x5ac13d;console['log'](_0x10f417(0x138)+_0x1b7bc3+':\x20'+_0x2e95ce+'),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x10f417(0xce)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x5ac13d(0x189),_0x107e71=>{const _0x50cd77=_0x5ac13d;console[_0x50cd77(0x189)](_0x50cd77(0x15d),_0x107e71);});}catch(_0x13dbd2){console['error'](_0x5ac13d(0x186),_0x13dbd2),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0xc48cac,_0x48b305,_0x5137c8)=>{const _0x2e6104=a1_0x46e7c6;if(!authService[_0x2e6104(0xf5)]()){console[_0x2e6104(0x124)](_0x2e6104(0xd3),config['serverUrl']);const _0x1a3ed3=await authService[_0x2e6104(0x159)]();if(!_0x1a3ed3)return _0x48b305[_0x2e6104(0x116)](0x191)['json']({'error':'Authentication\x20required'});}_0x5137c8();};app[a1_0x46e7c6(0x18e)]((_0x4d770d,_0x2aa293,_0x1fdf7a)=>{const _0x163b1d=a1_0x46e7c6;_0x2aa293[_0x163b1d(0xd2)](_0x163b1d(0xd5),'*'),_0x2aa293['header'](_0x163b1d(0x18c),_0x163b1d(0x125)),_0x2aa293['header']('Access-Control-Allow-Headers',_0x163b1d(0x135)),_0x4d770d[_0x163b1d(0x17a)]==='OPTIONS'?_0x2aa293[_0x163b1d(0xf9)](0xc8):_0x1fdf7a();}),app[a1_0x46e7c6(0x155)]('/',requireAuth,(_0x24878f,_0x222d5f)=>{const _0x511c8f=a1_0x46e7c6;_0x222d5f[_0x511c8f(0xc7)](_0x511c8f(0xea));}),app[a1_0x46e7c6(0x155)]('/health',async(_0xd5f546,_0xbdf315)=>{const _0x5f4b9a=a1_0x46e7c6,_0x1a5307=authService[_0x5f4b9a(0xf5)](),_0x514340=webrtcService[_0x5f4b9a(0xef)](),_0x396b16=webrtcService[_0x5f4b9a(0x109)](),_0x240b8d=topicManager[_0x5f4b9a(0x12c)]();_0xbdf315[_0x5f4b9a(0x12a)]({'status':'ok','environment':process['env'][_0x5f4b9a(0x102)]||'development','backendUrl':config[_0x5f4b9a(0xca)],'rosbridgeUrl':config[_0x5f4b9a(0x17d)]['wsEndpoint'],'proxyPort':port,'authenticated':_0x1a5307,'topicManagement':{'discovered':_0x240b8d[_0x5f4b9a(0xe9)],'strategies':_0x240b8d[_0x5f4b9a(0xe6)],'largeDataTopics':_0x240b8d[_0x5f4b9a(0x144)]['length'],'largeTopicsList':_0x240b8d[_0x5f4b9a(0x144)]},'webrtc':{'activeSessions':_0x514340[_0x5f4b9a(0xee)],'sharedVideoSources':_0x396b16['length'],'sessions':_0x514340,'sharedSources':_0x396b16}});});const getInitialPort=()=>{const _0x208dee=a1_0x46e7c6;if(process['env'][_0x208dee(0x13c)])return parseInt(process[_0x208dee(0x121)][_0x208dee(0x13c)],0xa);return config[_0x208dee(0x17d)][_0x208dee(0xed)];};async function listenWithRetries(_0x1182b6,_0x51907a,_0x374d28=0xa){const _0x56ed20=a1_0x46e7c6;let _0xdb03b7=_0x51907a;for(let _0x4f8905=0x1;_0x4f8905<=_0x374d28;_0x4f8905++){try{return await new Promise((_0x411139,_0x30f461)=>{const _0x146d31=a1_0x2232,_0x95fd75=_0x1182b6['listen'](_0xdb03b7,()=>{const _0x108d70=a1_0x2232;console[_0x108d70(0x124)](_0x108d70(0x16a)+_0xdb03b7),_0x411139(_0x95fd75);});_0x95fd75['on'](_0x146d31(0x189),_0x52ac4c=>{const _0x3804ec=_0x146d31;_0x52ac4c[_0x3804ec(0x176)]==='EADDRINUSE'?(console['warn']('Port\x20'+_0xdb03b7+_0x3804ec(0xfc)),_0x30f461(_0x52ac4c)):_0x30f461(_0x52ac4c);});}),_0xdb03b7;}catch(_0x1b893c){_0xdb03b7++;}}throw new Error(_0x56ed20(0x168)+_0x374d28+_0x56ed20(0x174)+_0x51907a);}const startApp=async()=>{const _0x191240=a1_0x46e7c6;try{reloadEnv();let _0x4b4b45=await authService[_0x191240(0x159)]();while(!_0x4b4b45){console[_0x191240(0x124)](_0x191240(0x11e)),await promptForCredentials(),_0x4b4b45=await authService[_0x191240(0x159)]();}console[_0x191240(0x124)](_0x191240(0x110));!loadApplianceIdentity()&&console['log'](_0x191240(0x152));console[_0x191240(0x124)]('Registering\x20with\x20server...');const _0x3c02e3=await registerWithServer();if(!_0x3c02e3)throw new Error(_0x191240(0x181));connectToRosbridge(),connectToServer();const _0x323378=getInitialPort();await listenWithRetries(app,_0x323378,0xa);}catch(_0xeb3d95){console[_0x191240(0x189)](_0x191240(0x101),_0xeb3d95),process[_0x191240(0x11c)](0x1);}};setInterval(async()=>{const _0xd86daa=a1_0x46e7c6;try{if(robotId){const _0x2dac8b=authService[_0xd86daa(0x190)]();await axios[_0xd86daa(0x157)](config['serverUrl']+_0xd86daa(0x105),{'robotId':robotId},{'headers':{'Authorization':'Bearer\x20'+_0x2dac8b,'Content-Type':'application/json'}});}}catch(_0x2bf79d){console[_0xd86daa(0x189)](_0xd86daa(0x17e),_0x2bf79d[_0xd86daa(0x153)]);}},0x1388),startApp();