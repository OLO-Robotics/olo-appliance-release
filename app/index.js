const a1_0x2d62f9=a1_0x55d1;(function(_0x59151b,_0x3a6f27){const _0x1fdf86=a1_0x55d1,_0x231884=_0x59151b();while(!![]){try{const _0x139e06=parseInt(_0x1fdf86(0x16e))/0x1*(parseInt(_0x1fdf86(0x157))/0x2)+parseInt(_0x1fdf86(0x11d))/0x3*(parseInt(_0x1fdf86(0x114))/0x4)+-parseInt(_0x1fdf86(0x15b))/0x5+parseInt(_0x1fdf86(0xdb))/0x6*(-parseInt(_0x1fdf86(0x11b))/0x7)+parseInt(_0x1fdf86(0xb4))/0x8+-parseInt(_0x1fdf86(0xbc))/0x9*(-parseInt(_0x1fdf86(0x131))/0xa)+-parseInt(_0x1fdf86(0xb3))/0xb;if(_0x139e06===_0x3a6f27)break;else _0x231884['push'](_0x231884['shift']());}catch(_0xa22582){_0x231884['push'](_0x231884['shift']());}}}(a1_0x47ce,0x788cc));const a1_0x4e8cb4=(function(){let _0x313582=!![];return function(_0x118426,_0x370510){const _0x3d8018=_0x313582?function(){if(_0x370510){const _0x31cb89=_0x370510['apply'](_0x118426,arguments);return _0x370510=null,_0x31cb89;}}:function(){};return _0x313582=![],_0x3d8018;};}()),a1_0x4c7002=a1_0x4e8cb4(this,function(){const _0x60a49f=a1_0x55d1;return a1_0x4c7002[_0x60a49f(0xb7)]()[_0x60a49f(0xf4)]('(((.+)+)+)+$')[_0x60a49f(0xb7)]()[_0x60a49f(0x11a)](a1_0x4c7002)[_0x60a49f(0xf4)](_0x60a49f(0x123));});a1_0x4c7002();const express=require('express'),config=require(a1_0x2d62f9(0x108)),authService=require('./services/auth'),webrtcService=require(a1_0x2d62f9(0x113)),topicManager=require(a1_0x2d62f9(0xef)),WebSocket=require('ws'),axios=require(a1_0x2d62f9(0xf3)),fs=require('fs'),prompt=require('prompt-sync')({'sigint':!![]}),dotenv=require('dotenv'),app=express(),port=process[a1_0x2d62f9(0x133)][a1_0x2d62f9(0x116)]||config['rosbridge']['proxyPort'],APPLIANCE_FILE=a1_0x2d62f9(0x16a),{DOMParser,XMLSerializer}=require(a1_0x2d62f9(0xd0)),path=require('path'),{execSync}=require('child_process'),APPLIANCE_BASE_URL=process[a1_0x2d62f9(0x133)][a1_0x2d62f9(0x159)]||'';console[a1_0x2d62f9(0xaf)](a1_0x2d62f9(0xc0)+(process[a1_0x2d62f9(0x133)]['NODE_ENV']||'development')),console[a1_0x2d62f9(0xaf)]('Backend\x20Server\x20URL:\x20'+config[a1_0x2d62f9(0x168)]),console['log'](a1_0x2d62f9(0xcc)+config['rosbridge'][a1_0x2d62f9(0x16d)]),console['log'](a1_0x2d62f9(0xbf)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x17579f,_0x2e8352){const _0x29e432=a1_0x2d62f9;fs[_0x29e432(0x12a)](_0x29e432(0xd5),_0x29e432(0x137)+_0x17579f+_0x29e432(0x150)+_0x2e8352+'\x0a');}function reloadEnv(){const _0x33acd5=a1_0x2d62f9;dotenv[_0x33acd5(0x149)]({'override':!![]}),config[_0x33acd5(0x100)][_0x33acd5(0xfc)]=process['env'][_0x33acd5(0xfb)],config[_0x33acd5(0x100)][_0x33acd5(0xc7)]=process[_0x33acd5(0x133)][_0x33acd5(0xba)];}async function promptForCredentials(){const _0x159443=a1_0x2d62f9,_0x480162=prompt('Enter\x20username:\x20'),_0x5d8954=prompt[_0x159443(0x10d)](_0x159443(0xf7));updateEnvFile(_0x480162,_0x5d8954),reloadEnv();}function loadApplianceIdentity(){const _0x3b8ce3=a1_0x2d62f9;if(fs[_0x3b8ce3(0xc2)](APPLIANCE_FILE))try{const _0x198cd3=JSON[_0x3b8ce3(0x148)](fs[_0x3b8ce3(0x143)](APPLIANCE_FILE,_0x3b8ce3(0x11e)));if(_0x198cd3[_0x3b8ce3(0x151)]&&_0x198cd3[_0x3b8ce3(0xff)])return robotId=_0x198cd3['robotId'],registrationToken=_0x198cd3[_0x3b8ce3(0xff)],console[_0x3b8ce3(0xaf)]('Loaded\x20appliance\x20identity:',robotId),topicManager[_0x3b8ce3(0x162)](_0x198cd3),!![];}catch(_0x4d8ac9){console[_0x3b8ce3(0x125)]('Failed\x20to\x20parse\x20appliance\x20identity\x20file:',_0x4d8ac9);}return![];}function saveApplianceIdentity(_0x5ee0a8,_0x32d0d9){const _0x356898=a1_0x2d62f9;let _0x591e31={};if(fs[_0x356898(0xc2)](APPLIANCE_FILE))try{_0x591e31=JSON['parse'](fs[_0x356898(0x143)](APPLIANCE_FILE,'utf8'));}catch(_0x3c8d83){_0x591e31={};}_0x591e31[_0x356898(0x151)]=_0x5ee0a8,_0x591e31['registrationToken']=_0x32d0d9,fs[_0x356898(0x12a)](APPLIANCE_FILE,JSON[_0x356898(0xdf)](_0x591e31,null,0x2));}function a1_0x47ce(){const _0x127630=['APP_USERNAME','username','getElementsByTagName','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','registrationToken','credentials','close','largeDataTopics','Connected\x20to\x20ROSBridge\x20(main)','/rosbridge?type=appliance&token=','ROSBridge\x20(main)\x20connection\x20error:','EADDRINUSE','throttling','./config','WSL\x20Appliance','\x20of\x20','base64','endsWith','hide','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','startsWith','service_response','string','String\x20value\x20is:\x20','./services/webrtcService','401372UAoxzJ','strategy','PORT','totalTopics','length','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','constructor','86737rHOTch','post','15kJKMVx','utf8','join','Bearer\x20','toLowerCase','slice','(((.+)+)+)+$','includes','error','handleMessage','connection','.dae','action','writeFileSync','type','sample','getStatistics','Ros','request_id','initialize','1090FKUwXY','data','env','topic','[MESH]\x20Successfully\x20served\x20mesh:\x20','[MESH]\x20Error\x20serving\x20mesh:','APP_USERNAME=','estimatedSize','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','rosbridge','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','share','Successfully\x20logged\x20in','serializeToString','Disconnected\x20from\x20server\x20(','getToken','/appliance/ping','readFileSync','exit','text/xml','\x20attempts\x20starting\x20from\x20','publish','parse','config','ros2\x20pkg\x20prefix\x20','getSharedVideoSources','get','uri','replace','getTopicStrategy','\x0aAPP_PASSWORD=','robotId','.mesh','Failed\x20to\x20connect\x20to\x20server:','setAttribute','registration_token','header','514DKFhFR','Access-Control-Allow-Methods','APPLIANCE_BASE_URL','some','3561315RcUvdq','application/json','send','values','json','use','name','loadConfig','get_urdf_param','/appliance/register','readyState','samplingRate','),\x20attempting\x20to\x20reconnect...','serverUrl','Access-Control-Allow-Origin','.appliance.json','Registering\x20with\x20server...','Access-Control-Allow-Headers','wsEndpoint','3373DTSJoT','Appliance\x20is\x20running\x20and\x20authenticated!','robot\x20not\x20found','response','log','Failed\x20to\x20start\x20application:','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','12394118CCLAFX','7062792CfmMPQ','isAuthenticated','ROSBridge\x20(WebRTC)\x20connection\x20error:','toString','ros2\x20param\x20get\x20','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','APP_PASSWORD','mesh','36387KKFXhJ','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','OPEN','Proxy\x20listening\x20on\x20port:\x20','Environment:\x20','/rosapi/topics','existsSync','forward','Connected\x20to\x20ROSBridge\x20(WebRTC)','[URDF\x20REWRITE]\x20Rewrote\x20','trim','password','Topic\x20discovery\x20failed:','message','Connected\x20to\x20server','urdf_param_data','ROSBridge\x20WebSocket\x20URL:\x20','package://','code','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','xmldom','stopAllSessions','topics','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','warn','.env','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','getActiveSessions','substring','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','sample_skip','174sUgkrJ','discoverTopics','map','/health','stringify','login','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','param_name','status','\x20->\x20','catch','get_mesh','.obj','strategies','.ply','Port\x20','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','reason','Attempting\x20to\x20login\x20to:','./services/TopicManager','filename','Not\x20authenticated','mesh_data','axios','search','NODE_ENV','\x20in\x20use,\x20trying\x20next\x20port...','Enter\x20password:\x20','webrtc_skip','unknown','open'];a1_0x47ce=function(){return _0x127630;};return a1_0x47ce();}async function registerWithServer(){const _0x2da474=a1_0x2d62f9;try{const _0xdf51c3=authService[_0x2da474(0x141)]();if(!_0xdf51c3)throw new Error(_0x2da474(0xf1));let _0x548a4b,_0x198bfa=![];while(!![]){try{robotId&&registrationToken?_0x548a4b=await axios[_0x2da474(0x11c)](config['serverUrl']+_0x2da474(0x164),{'name':'WSL\x20Appliance','robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x2da474(0x120)+_0xdf51c3,'Content-Type':_0x2da474(0x15c)}}):_0x548a4b=await axios[_0x2da474(0x11c)](config['serverUrl']+'/appliance/register',{'name':_0x2da474(0x109)},{'headers':{'Authorization':_0x2da474(0x120)+_0xdf51c3,'Content-Type':'application/json'}});break;}catch(_0x45d67d){const _0x5eb584=_0x45d67d?.[_0x2da474(0xae)]?.[_0x2da474(0x132)]?.[_0x2da474(0x125)]||_0x45d67d['message'];if(!_0x198bfa&&_0x5eb584&&_0x5eb584[_0x2da474(0x121)]()[_0x2da474(0x124)](_0x2da474(0xad))){console[_0x2da474(0xd4)](_0x2da474(0xbd));if(fs[_0x2da474(0xc2)](APPLIANCE_FILE))fs['unlinkSync'](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x198bfa=!![];continue;}throw _0x45d67d;}}if(!_0x548a4b['data']||!_0x548a4b[_0x2da474(0x132)]['registration_token']||!_0x548a4b['data']['id'])throw new Error(_0x2da474(0xd9));return registrationToken=_0x548a4b['data'][_0x2da474(0x155)],robotId=_0x548a4b['data']['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x2da474(0xaf)]('Successfully\x20registered\x20with\x20server'),!![];}catch(_0xbfa5de){return console[_0x2da474(0x125)]('Failed\x20to\x20register\x20with\x20server:',_0xbfa5de[_0x2da474(0xc9)]),![];}}function rewriteUrdfMeshUris(_0x405cdb){const _0x5ec9b0=a1_0x2d62f9;try{const _0x2f2157=new DOMParser(),_0x2e978b=_0x2f2157['parseFromString'](_0x405cdb,_0x5ec9b0(0x145));let _0x3df94e=0x0,_0x3ff8ee=0x0;const _0x5e9860=_0x2e978b[_0x5ec9b0(0xfd)](_0x5ec9b0(0xbb));for(let _0x149400=0x0;_0x149400<_0x5e9860[_0x5ec9b0(0x118)];_0x149400++){const _0x22869e=_0x5e9860[_0x149400],_0x49d11f=_0x22869e['getAttribute'](_0x5ec9b0(0xf0)),_0x415fd6=['.stl',_0x5ec9b0(0x128),_0x5ec9b0(0xe7),_0x5ec9b0(0xe9),_0x5ec9b0(0x152)],_0x5d093a=_0x415fd6[_0x5ec9b0(0x15a)](_0x356fa4=>_0x49d11f['toLowerCase']()[_0x5ec9b0(0x10c)](_0x356fa4));if(_0x49d11f&&_0x49d11f[_0x5ec9b0(0x10f)](_0x5ec9b0(0xcd))&&_0x5d093a){_0x3df94e++;const _0x41d34e=APPLIANCE_BASE_URL+'/ros/mesh?uri='+encodeURIComponent(_0x49d11f);_0x22869e[_0x5ec9b0(0x154)](_0x5ec9b0(0xf0),_0x41d34e),_0x3ff8ee++,console['log'](_0x5ec9b0(0xfe)+_0x49d11f+_0x5ec9b0(0xe4)+_0x41d34e);}}_0x3df94e>0x0?console[_0x5ec9b0(0xaf)](_0x5ec9b0(0xc5)+_0x3ff8ee+_0x5ec9b0(0x10a)+_0x3df94e+_0x5ec9b0(0xb2)):console['log']('[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF');const _0x59d373=new XMLSerializer();return _0x59d373[_0x5ec9b0(0x13f)](_0x2e978b);}catch(_0x129446){return console[_0x5ec9b0(0x125)](_0x5ec9b0(0xeb),_0x129446),_0x405cdb;}}function connectToRosbridge(){const _0x35f7e5=a1_0x2d62f9;try{rosbridgeWs=new WebSocket(config[_0x35f7e5(0x13a)][_0x35f7e5(0x16d)]),rosbridgeWs['on'](_0x35f7e5(0xfa),()=>{const _0xd115f1=_0x35f7e5;console[_0xd115f1(0xaf)](_0xd115f1(0x103));const _0x59af63=require('roslib'),_0x6ab72d=new _0x59af63[(_0xd115f1(0x12e))]({'url':config['rosbridge'][_0xd115f1(0x16d)]});_0x6ab72d['on'](_0xd115f1(0x127),()=>{setTimeout(()=>{const _0x2cd47f=a1_0x55d1;topicManager[_0x2cd47f(0xdc)](_0x6ab72d)[_0x2cd47f(0xe5)](_0x3dbce2=>{const _0x48cc1c=_0x2cd47f;console['error'](_0x48cc1c(0xc8),_0x3dbce2);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x35f7e5(0xc9),_0x5e9c72=>{const _0x5af7b5=_0x35f7e5;if(serverWs&&serverWs[_0x5af7b5(0x165)]===WebSocket[_0x5af7b5(0xbe)]){let _0xdad97c=_0x5e9c72['toString']();try{const _0x4796e5=JSON[_0x5af7b5(0x148)](_0xdad97c);if(_0x4796e5['op']==='publish'&&_0x4796e5['topic']){const _0x58cd04=topicManager[_0x5af7b5(0x126)](_0x4796e5);switch(_0x58cd04[_0x5af7b5(0x129)]){case _0x5af7b5(0xda):return;case _0x5af7b5(0xf8):return;case _0x5af7b5(0xc3):default:_0xdad97c=JSON[_0x5af7b5(0xdf)](_0x58cd04['message']);break;}}if((_0x4796e5['op']===_0x5af7b5(0x110)||_0x4796e5['op']==='call_service')&&(_0x4796e5['service']===_0x5af7b5(0xc1)||_0x4796e5[_0x5af7b5(0x15e)]&&_0x4796e5[_0x5af7b5(0x15e)][_0x5af7b5(0xd2)])){console[_0x5af7b5(0xaf)]('[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata');const _0x2966b1=_0x4796e5[_0x5af7b5(0x15e)]?.[_0x5af7b5(0xd2)]||[],_0x648d05=_0x4796e5[_0x5af7b5(0x15e)]?.['types']||[],_0x2fb269=_0x2966b1['map']((_0xf1b711,_0x183a12)=>{const _0x50afb0=_0x5af7b5,_0x5db393=topicManager[_0x50afb0(0x14f)](_0xf1b711);return{'name':_0xf1b711,'type':_0x648d05[_0x183a12]||_0x50afb0(0xf9),'throttling':_0x5db393?{'isThrottled':_0x5db393[_0x50afb0(0x115)]===_0x50afb0(0x12c),'strategy':_0x5db393['strategy'],'samplingRate':_0x5db393[_0x50afb0(0x166)],'reason':_0x5db393[_0x50afb0(0xed)],'estimatedSize':_0x5db393[_0x50afb0(0x138)]}:null};});_0x4796e5['values']={'topics':_0x2fb269[_0x5af7b5(0xdd)](_0x56fb78=>_0x56fb78[_0x5af7b5(0x161)]),'types':_0x2fb269[_0x5af7b5(0xdd)](_0x3a0d9a=>_0x3a0d9a[_0x5af7b5(0x12b)]),'throttling':_0x2fb269[_0x5af7b5(0xdd)](_0x3774c0=>_0x3774c0[_0x5af7b5(0x107)])},_0xdad97c=JSON[_0x5af7b5(0xdf)](_0x4796e5),console[_0x5af7b5(0xaf)]('[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client');}if(_0x4796e5['op']===_0x5af7b5(0x147)&&_0x4796e5[_0x5af7b5(0x134)]==='/robot_description')try{const _0x1231c5=_0x4796e5['msg']['data'],_0x27acc4=rewriteUrdfMeshUris(_0x1231c5);_0x4796e5['msg']['data']=_0x27acc4,_0xdad97c=JSON[_0x5af7b5(0xdf)](_0x4796e5);}catch(_0x24ec6d){console[_0x5af7b5(0x125)](_0x5af7b5(0xd6),_0x24ec6d);}}catch(_0x5954c2){console[_0x5af7b5(0xd4)](_0x5af7b5(0xcf),_0x5954c2[_0x5af7b5(0xc9)]);}serverWs[_0x5af7b5(0x15d)](_0xdad97c);}}),rosbridgeWs['on'](_0x35f7e5(0x101),()=>{const _0x1ef986=_0x35f7e5;console[_0x1ef986(0xaf)](_0x1ef986(0xe1)),webrtcService[_0x1ef986(0xd1)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x35f7e5(0x125),_0x5bdf71=>{const _0x5a6c28=_0x35f7e5;console[_0x5a6c28(0x125)](_0x5a6c28(0x105),_0x5bdf71);});}catch(_0x400141){console[_0x35f7e5(0x125)](_0x35f7e5(0x139),_0x400141),setTimeout(connectToRosbridge,0x1388);}}function a1_0x55d1(_0x307670,_0x4da633){const _0x3efd1b=a1_0x47ce();return a1_0x55d1=function(_0x4c7002,_0x4e8cb4){_0x4c7002=_0x4c7002-0xac;let _0x47cea1=_0x3efd1b[_0x4c7002];return _0x47cea1;},a1_0x55d1(_0x307670,_0x4da633);}function connectToRosbridgeWebRTC(){const _0x1ed2d6=a1_0x2d62f9;try{rosbridgeWebRTCWs=new WebSocket(config[_0x1ed2d6(0x13a)][_0x1ed2d6(0x16d)]),rosbridgeWebRTCWs['on']('open',()=>{const _0x30c735=_0x1ed2d6;console['log'](_0x30c735(0xc4)),webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x1ed2d6(0xc9),_0x2c38c3=>{}),rosbridgeWebRTCWs['on']('close',()=>{const _0x37c1d5=_0x1ed2d6;console[_0x37c1d5(0xaf)]('Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x37c1d5(0xd1)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x1ed2d6(0x125),_0x475fc9=>{const _0x569432=_0x1ed2d6;console['error'](_0x569432(0xb6),_0x475fc9);});}catch(_0x292279){console[_0x1ed2d6(0x125)](_0x1ed2d6(0xb9),_0x292279),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x2894e7=a1_0x2d62f9;try{if(!registrationToken)throw new Error('Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.');const _0x520f6f=config[_0x2894e7(0x168)][_0x2894e7(0x14e)]('http','ws')+_0x2894e7(0x104)+registrationToken;serverWs=new WebSocket(_0x520f6f),serverWs['on'](_0x2894e7(0xfa),()=>{const _0x49800b=_0x2894e7;console[_0x49800b(0xaf)](_0x49800b(0xca)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x49800b(0x165)]===WebSocket[_0x49800b(0xbe)]&&webrtcService[_0x49800b(0x130)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x2894e7(0xc9),_0xc8a4d7=>{const _0x14a4f7=_0x2894e7;if(rosbridgeWs&&rosbridgeWs[_0x14a4f7(0x165)]===WebSocket[_0x14a4f7(0xbe)]){let _0x111043=_0xc8a4d7[_0x14a4f7(0xb7)]();try{const _0x55f7d5=JSON[_0x14a4f7(0x148)](_0x111043);if(webrtcService[_0x14a4f7(0x126)](_0x55f7d5))return;if(_0x55f7d5['op']===_0x14a4f7(0x163)&&typeof _0x55f7d5[_0x14a4f7(0xe2)]===_0x14a4f7(0x111)&&_0x55f7d5[_0x14a4f7(0x12f)])try{console[_0x14a4f7(0xaf)](_0x14a4f7(0xd3)+_0x55f7d5['param_name']);const _0x502014=execSync(_0x14a4f7(0xb8)+_0x55f7d5['param_name'],{'encoding':_0x14a4f7(0x11e)})[_0x14a4f7(0xc6)]();let _0x47210b=_0x502014;_0x502014[_0x14a4f7(0x10f)](_0x14a4f7(0x112))&&(_0x47210b=_0x502014[_0x14a4f7(0xd8)]('String\x20value\x20is:\x20'[_0x14a4f7(0x118)]()));_0x47210b[_0x14a4f7(0x10f)]('\x22')&&_0x47210b[_0x14a4f7(0x10c)]('\x22')&&(_0x47210b=_0x47210b[_0x14a4f7(0x122)](0x1,-0x1));_0x47210b=_0x47210b[_0x14a4f7(0x14e)](/\\n/g,'\x0a')[_0x14a4f7(0x14e)](/\\"/g,'\x22');const _0x7f7d07={'op':'urdf_param_data','request_id':_0x55f7d5[_0x14a4f7(0x12f)],'data':_0x47210b};serverWs[_0x14a4f7(0x15d)](JSON[_0x14a4f7(0xdf)](_0x7f7d07)),console[_0x14a4f7(0xaf)]('[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20'+_0x55f7d5[_0x14a4f7(0xe2)]);return;}catch(_0x5332d0){console['error'](_0x14a4f7(0x13b),_0x5332d0);const _0x1a19fe={'op':_0x14a4f7(0xcb),'request_id':_0x55f7d5['request_id'],'error':_0x5332d0['message']};serverWs[_0x14a4f7(0x15d)](JSON[_0x14a4f7(0xdf)](_0x1a19fe));return;}if(_0x55f7d5['op']===_0x14a4f7(0xe6)&&typeof _0x55f7d5[_0x14a4f7(0x14d)]===_0x14a4f7(0x111)&&_0x55f7d5[_0x14a4f7(0x12f)])try{const _0x3c8ed9=_0x55f7d5[_0x14a4f7(0x14d)]['match'](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x3c8ed9){const _0x227f7f=_0x3c8ed9[0x1],_0x1983d9=_0x3c8ed9[0x2],_0x17bf40=execSync(_0x14a4f7(0x14a)+_0x227f7f,{'encoding':_0x14a4f7(0x11e)})[_0x14a4f7(0xc6)](),_0x2cb8cc=path[_0x14a4f7(0x11f)](_0x17bf40,_0x14a4f7(0x13d),_0x227f7f,_0x1983d9);if(!fs[_0x14a4f7(0xc2)](_0x2cb8cc))throw new Error('Mesh\x20file\x20not\x20found:\x20'+_0x2cb8cc);const _0x9962ec=fs['readFileSync'](_0x2cb8cc),_0x5e5342={'op':'mesh_data','request_id':_0x55f7d5[_0x14a4f7(0x12f)],'data':_0x9962ec[_0x14a4f7(0xb7)](_0x14a4f7(0x10b))};serverWs[_0x14a4f7(0x15d)](JSON[_0x14a4f7(0xdf)](_0x5e5342)),console[_0x14a4f7(0xaf)](_0x14a4f7(0x135)+_0x55f7d5[_0x14a4f7(0x14d)]+'\x20from\x20'+_0x2cb8cc);return;}}catch(_0x21dbc2){console[_0x14a4f7(0x125)](_0x14a4f7(0x136),_0x21dbc2);const _0x3175ca={'op':_0x14a4f7(0xf2),'request_id':_0x55f7d5[_0x14a4f7(0x12f)],'error':_0x21dbc2['message']};serverWs[_0x14a4f7(0x15d)](JSON[_0x14a4f7(0xdf)](_0x3175ca));return;}rosbridgeWs[_0x14a4f7(0x15d)](_0x111043);}catch(_0x485503){rosbridgeWs[_0x14a4f7(0x15d)](_0x111043);}}}),serverWs['on']('close',(_0x48f6e1,_0x5410fc)=>{const _0x58466d=_0x2894e7;console[_0x58466d(0xaf)](_0x58466d(0x140)+_0x48f6e1+':\x20'+_0x5410fc+_0x58466d(0x167)),webrtcService[_0x58466d(0xd1)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x2894e7(0x125),_0x2375ed=>{const _0x139834=_0x2894e7;console[_0x139834(0x125)]('Server\x20connection\x20error:',_0x2375ed);});}catch(_0x3ebdb1){console['error'](_0x2894e7(0x153),_0x3ebdb1),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x107a33,_0x59e598,_0x4bf155)=>{const _0x5eb43f=a1_0x2d62f9;if(!authService[_0x5eb43f(0xb5)]()){console[_0x5eb43f(0xaf)](_0x5eb43f(0xee),config[_0x5eb43f(0x168)]);const _0x4bf21f=await authService[_0x5eb43f(0xe0)]();if(!_0x4bf21f)return _0x59e598[_0x5eb43f(0xe3)](0x191)[_0x5eb43f(0x15f)]({'error':'Authentication\x20required'});}_0x4bf155();};app[a1_0x2d62f9(0x160)]((_0x84b7ab,_0x15ac4f,_0x25b0a4)=>{const _0x3eed6e=a1_0x2d62f9;_0x15ac4f[_0x3eed6e(0x156)](_0x3eed6e(0x169),'*'),_0x15ac4f['header'](_0x3eed6e(0x158),_0x3eed6e(0xec)),_0x15ac4f['header'](_0x3eed6e(0x16c),_0x3eed6e(0x10e)),_0x84b7ab['method']==='OPTIONS'?_0x15ac4f['sendStatus'](0xc8):_0x25b0a4();}),app[a1_0x2d62f9(0x14c)]('/',requireAuth,(_0x9d08e9,_0x3bff30)=>{const _0x5ef5e9=a1_0x2d62f9;_0x3bff30[_0x5ef5e9(0x15d)](_0x5ef5e9(0xac));}),app[a1_0x2d62f9(0x14c)](a1_0x2d62f9(0xde),async(_0x5e9c1d,_0x35571d)=>{const _0x5ccfde=a1_0x2d62f9,_0x188dc0=authService[_0x5ccfde(0xb5)](),_0x4bdfe4=webrtcService[_0x5ccfde(0xd7)](),_0x225775=webrtcService[_0x5ccfde(0x14b)](),_0x227d4b=topicManager[_0x5ccfde(0x12d)]();_0x35571d['json']({'status':'ok','environment':process[_0x5ccfde(0x133)][_0x5ccfde(0xf5)]||'development','backendUrl':config[_0x5ccfde(0x168)],'rosbridgeUrl':config[_0x5ccfde(0x13a)]['wsEndpoint'],'proxyPort':port,'authenticated':_0x188dc0,'topicManagement':{'discovered':_0x227d4b[_0x5ccfde(0x117)],'strategies':_0x227d4b[_0x5ccfde(0xe8)],'largeDataTopics':_0x227d4b[_0x5ccfde(0x102)][_0x5ccfde(0x118)],'largeTopicsList':_0x227d4b[_0x5ccfde(0x102)]},'webrtc':{'activeSessions':_0x4bdfe4[_0x5ccfde(0x118)],'sharedVideoSources':_0x225775[_0x5ccfde(0x118)],'sessions':_0x4bdfe4,'sharedSources':_0x225775}});});const getInitialPort=()=>{const _0x469ba1=a1_0x2d62f9;if(process[_0x469ba1(0x133)][_0x469ba1(0x116)])return parseInt(process['env'][_0x469ba1(0x116)],0xa);return config[_0x469ba1(0x13a)]['proxyPort'];};async function listenWithRetries(_0x801bc3,_0x1111a1,_0x47c261=0xa){const _0x54d8c6=a1_0x2d62f9;let _0x29d8da=_0x1111a1;for(let _0x23ff9f=0x1;_0x23ff9f<=_0x47c261;_0x23ff9f++){try{return await new Promise((_0x58a7ef,_0x3b52e7)=>{const _0x4130ff=a1_0x55d1,_0x1dc358=_0x801bc3['listen'](_0x29d8da,()=>{const _0x3a0660=a1_0x55d1;console[_0x3a0660(0xaf)](_0x3a0660(0x13c)+_0x29d8da),_0x58a7ef(_0x1dc358);});_0x1dc358['on'](_0x4130ff(0x125),_0x57ee4b=>{const _0x3a82e6=_0x4130ff;_0x57ee4b[_0x3a82e6(0xce)]===_0x3a82e6(0x106)?(console[_0x3a82e6(0xd4)](_0x3a82e6(0xea)+_0x29d8da+_0x3a82e6(0xf6)),_0x3b52e7(_0x57ee4b)):_0x3b52e7(_0x57ee4b);});}),_0x29d8da;}catch(_0x5c4ad5){_0x29d8da++;}}throw new Error(_0x54d8c6(0xb1)+_0x47c261+_0x54d8c6(0x146)+_0x1111a1);}const startApp=async()=>{const _0x19f102=a1_0x2d62f9;try{let _0x47c90b=await authService[_0x19f102(0xe0)]();while(!_0x47c90b){console[_0x19f102(0xaf)](_0x19f102(0x119)),await promptForCredentials(),_0x47c90b=await authService['login']();}console['log'](_0x19f102(0x13e));!loadApplianceIdentity()&&console[_0x19f102(0xaf)]('No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.');console[_0x19f102(0xaf)](_0x19f102(0x16b));const _0x5e2077=await registerWithServer();if(!_0x5e2077)throw new Error('Failed\x20to\x20register\x20with\x20server');connectToRosbridge(),connectToServer();const _0x1c3782=getInitialPort();await listenWithRetries(app,_0x1c3782,0xa);}catch(_0x2c5a80){console[_0x19f102(0x125)](_0x19f102(0xb0),_0x2c5a80),process[_0x19f102(0x144)](0x1);}};setInterval(async()=>{const _0x289686=a1_0x2d62f9;try{if(robotId){const _0x2802e4=authService[_0x289686(0x141)]();await axios[_0x289686(0x11c)](config['serverUrl']+_0x289686(0x142),{'robotId':robotId},{'headers':{'Authorization':_0x289686(0x120)+_0x2802e4,'Content-Type':_0x289686(0x15c)}});}}catch(_0x3b3dd3){console[_0x289686(0x125)]('Failed\x20to\x20ping\x20server:',_0x3b3dd3[_0x289686(0xc9)]);}},0x1388),startApp();