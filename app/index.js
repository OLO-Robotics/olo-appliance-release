const a1_0x1343ea=a1_0x5bbc;(function(_0x389ee0,_0x328bfc){const _0x273891=a1_0x5bbc,_0x3a805e=_0x389ee0();while(!![]){try{const _0x360e7a=-parseInt(_0x273891(0xcf))/0x1*(parseInt(_0x273891(0x13e))/0x2)+parseInt(_0x273891(0xdb))/0x3*(-parseInt(_0x273891(0xd8))/0x4)+-parseInt(_0x273891(0xa3))/0x5+-parseInt(_0x273891(0x104))/0x6+-parseInt(_0x273891(0xb4))/0x7*(parseInt(_0x273891(0x10b))/0x8)+parseInt(_0x273891(0xb5))/0x9*(parseInt(_0x273891(0xd2))/0xa)+parseInt(_0x273891(0x164))/0xb;if(_0x360e7a===_0x328bfc)break;else _0x3a805e['push'](_0x3a805e['shift']());}catch(_0x267626){_0x3a805e['push'](_0x3a805e['shift']());}}}(a1_0x2962,0x1f049));const a1_0x5a888b=(function(){let _0x43bb0b=!![];return function(_0x229b9a,_0x196c03){const _0x38afd5=_0x43bb0b?function(){const _0x9c40ad=a1_0x5bbc;if(_0x196c03){const _0x35982f=_0x196c03[_0x9c40ad(0x11b)](_0x229b9a,arguments);return _0x196c03=null,_0x35982f;}}:function(){};return _0x43bb0b=![],_0x38afd5;};}()),a1_0x4d8d18=a1_0x5a888b(this,function(){const _0xf3492c=a1_0x5bbc;return a1_0x4d8d18['toString']()[_0xf3492c(0xdd)](_0xf3492c(0x132))[_0xf3492c(0x121)]()[_0xf3492c(0x106)](a1_0x4d8d18)['search'](_0xf3492c(0x132));});a1_0x4d8d18();const express=require(a1_0x1343ea(0x154)),config=require('./config'),authService=require(a1_0x1343ea(0xc1)),webrtcService=require('./services/webrtcService'),topicManager=require(a1_0x1343ea(0xc7)),WebSocket=require('ws'),axios=require(a1_0x1343ea(0x109)),fs=require('fs'),prompt=require('prompt-sync')({'sigint':!![]}),dotenv=require(a1_0x1343ea(0xd9)),app=express(),port=process[a1_0x1343ea(0xc2)]['PORT']||config[a1_0x1343ea(0xfd)][a1_0x1343ea(0xcb)],APPLIANCE_FILE=a1_0x1343ea(0x10f),{DOMParser,XMLSerializer}=require(a1_0x1343ea(0xe8)),path=require(a1_0x1343ea(0x133)),{execSync}=require(a1_0x1343ea(0xef)),APPLIANCE_BASE_URL=process[a1_0x1343ea(0xc2)]['APPLIANCE_BASE_URL']||'';function a1_0x2962(){const _0x5d891e=['text/xml','proxyPort','base64','log','catch','827qnxzXr','getStatistics','webrtc_skip','30ivEOiX','\x20attempts\x20starting\x20from\x20','startsWith','forward','Registering\x20with\x20server...','data','118792FTkkOZ','dotenv','Connected\x20to\x20server','6dukGbV','initialize','search','share','registrationToken','endsWith','Topic\x20discovery\x20failed:','Successfully\x20logged\x20in','Disconnected\x20from\x20server\x20(','isAuthenticated','credentials','serverUrl','readFileSync','xmldom','[URDF\x20REWRITE]\x20Rewrote\x20','getToken','stringify','samplingRate','Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file','param_name','child_process','Failed\x20to\x20start\x20application:','topic','discoverTopics','getAttribute','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','APP_USERNAME=','EADDRINUSE','uri','Failed\x20to\x20register\x20with\x20server:','NODE_ENV','connection','getActiveSessions','largeDataTopics','rosbridge','Connected\x20to\x20ROSBridge\x20(WebRTC)','replace','application/json','reason','mesh','registration_token','470100DHtDpL','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','constructor','open','setAttribute','axios','serializeToString','354232tUNxAi','send','),\x20attempting\x20to\x20reconnect...','/appliance/ping','.appliance.json','.ply','mesh_data','header','WSL\x20Appliance','ROSBridge\x20(WebRTC)\x20connection\x20error:','readyState','unknown','.env','PORT','publish','post','apply','some','exit','writeFileSync','login','utf8','toString','service','Loaded\x20appliance\x20identity:','type','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','.mesh','error','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','topics','filename','ROSBridge\x20WebSocket\x20URL:\x20','join','loadConfig','trim','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','(((.+)+)+)+$','path','/appliance/register','string','service_response','use','\x20->\x20','code','Bearer\x20','warn','Proxy\x20listening\x20on\x20port:\x20','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','298oAtspj','OPTIONS','getTopicStrategy','robot\x20not\x20found','development','wsEndpoint','existsSync','OPEN','/health','status','Server\x20connection\x20error:','Ros','substring','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','Enter\x20username:\x20','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','getSharedVideoSources','Access-Control-Allow-Methods','Failed\x20to\x20connect\x20to\x20server:','\x0aAPP_PASSWORD=','\x20of\x20','Successfully\x20registered\x20with\x20server','express','get','close','handleMessage','Not\x20authenticated','roslib','package://','toLowerCase','Mesh\x20file\x20not\x20found:\x20','values','Authentication\x20required','method','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','totalTopics','.obj','message','7137427nIyAjj','production','.dae','1024030UJtLxa','urdf_param_data','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','length','/rosbridge?type=appliance&token=','request_id','Access-Control-Allow-Origin','listen','APP_PASSWORD','APP_USERNAME','parse','Backend\x20Server\x20URL:\x20','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','\x20in\x20use,\x20trying\x20next\x20port...','strategy','getElementsByTagName','28PuAFSM','363249mtrEHJ','includes','unlinkSync','Connected\x20to\x20ROSBridge\x20(main)','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','throttling','ros2\x20param\x20get\x20','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','slice','robotId','String\x20value\x20is:\x20','./services/auth','env','parseFromString','Please\x20run:\x20./setup.sh\x20reconfigure','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','map','./services/TopicManager','stopAllSessions','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):'];a1_0x2962=function(){return _0x5d891e;};return a1_0x2962();}console[a1_0x1343ea(0xcd)]('Environment:\x20'+(process[a1_0x1343ea(0xc2)][a1_0x1343ea(0xf9)]||a1_0x1343ea(0x142))),console[a1_0x1343ea(0xcd)](a1_0x1343ea(0xaf)+config['serverUrl']),console[a1_0x1343ea(0xcd)](a1_0x1343ea(0x12d)+config[a1_0x1343ea(0xfd)]['wsEndpoint']),console['log'](a1_0x1343ea(0x13c)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x3a3136,_0x2aa74){const _0x29185b=a1_0x1343ea;fs[_0x29185b(0x11e)](_0x29185b(0x117),_0x29185b(0xf5)+_0x3a3136+_0x29185b(0x151)+_0x2aa74+'\x0a');}function reloadEnv(){const _0x4b2ccf=a1_0x1343ea;dotenv['config']({'override':!![]}),config[_0x4b2ccf(0xe5)]['username']=process['env'][_0x4b2ccf(0xad)],config[_0x4b2ccf(0xe5)]['password']=process[_0x4b2ccf(0xc2)][_0x4b2ccf(0xac)];}function a1_0x5bbc(_0x296fdb,_0x5dd5a1){const _0x30842b=a1_0x2962();return a1_0x5bbc=function(_0x4d8d18,_0x5a888b){_0x4d8d18=_0x4d8d18-0xa2;let _0x29629f=_0x30842b[_0x4d8d18];return _0x29629f;},a1_0x5bbc(_0x296fdb,_0x5dd5a1);}async function promptForCredentials(){const _0x542c35=a1_0x1343ea;process[_0x542c35(0xc2)]['NODE_ENV']===_0x542c35(0x165)&&(console['error'](_0x542c35(0xed)),console[_0x542c35(0x127)](_0x542c35(0xc4)),process[_0x542c35(0x11d)](0x1));const _0x505a9b=prompt(_0x542c35(0x14c)),_0xbbf1dd=prompt['hide']('Enter\x20password:\x20');updateEnvFile(_0x505a9b,_0xbbf1dd),reloadEnv();}function loadApplianceIdentity(){const _0x5ac27e=a1_0x1343ea;if(fs[_0x5ac27e(0x144)](APPLIANCE_FILE))try{const _0x43c58b=JSON[_0x5ac27e(0xae)](fs[_0x5ac27e(0xe7)](APPLIANCE_FILE,_0x5ac27e(0x120)));if(_0x43c58b[_0x5ac27e(0xbf)]&&_0x43c58b['registrationToken'])return robotId=_0x43c58b[_0x5ac27e(0xbf)],registrationToken=_0x43c58b[_0x5ac27e(0xdf)],console['log'](_0x5ac27e(0x123),robotId),topicManager[_0x5ac27e(0x12f)](_0x43c58b),!![];}catch(_0x292977){console[_0x5ac27e(0x127)](_0x5ac27e(0x160),_0x292977);}return![];}function saveApplianceIdentity(_0x398cd6,_0x4d2bef){const _0x49af02=a1_0x1343ea;let _0x560165={};if(fs[_0x49af02(0x144)](APPLIANCE_FILE))try{_0x560165=JSON[_0x49af02(0xae)](fs[_0x49af02(0xe7)](APPLIANCE_FILE,'utf8'));}catch(_0x34c4d3){_0x560165={};}_0x560165[_0x49af02(0xbf)]=_0x398cd6,_0x560165['registrationToken']=_0x4d2bef,fs[_0x49af02(0x11e)](APPLIANCE_FILE,JSON[_0x49af02(0xeb)](_0x560165,null,0x2));}async function registerWithServer(){const _0x3a5fd5=a1_0x1343ea;try{const _0x50a0da=authService['getToken']();if(!_0x50a0da)throw new Error(_0x3a5fd5(0x158));let _0x4ce695,_0x75fe4c=![];while(!![]){try{robotId&&registrationToken?_0x4ce695=await axios['post'](config[_0x3a5fd5(0xe6)]+_0x3a5fd5(0x134),{'name':_0x3a5fd5(0x113),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':'Bearer\x20'+_0x50a0da,'Content-Type':_0x3a5fd5(0x100)}}):_0x4ce695=await axios[_0x3a5fd5(0x11a)](config[_0x3a5fd5(0xe6)]+_0x3a5fd5(0x134),{'name':_0x3a5fd5(0x113)},{'headers':{'Authorization':_0x3a5fd5(0x13a)+_0x50a0da,'Content-Type':_0x3a5fd5(0x100)}});break;}catch(_0x6bdec9){const _0x3e49ab=_0x6bdec9?.['response']?.[_0x3a5fd5(0xd7)]?.[_0x3a5fd5(0x127)]||_0x6bdec9[_0x3a5fd5(0x163)];if(!_0x75fe4c&&_0x3e49ab&&_0x3e49ab[_0x3a5fd5(0x15b)]()[_0x3a5fd5(0xb6)](_0x3a5fd5(0x141))){console[_0x3a5fd5(0x13b)](_0x3a5fd5(0x13d));if(fs[_0x3a5fd5(0x144)](APPLIANCE_FILE))fs[_0x3a5fd5(0xb7)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x75fe4c=!![];continue;}throw _0x6bdec9;}}if(!_0x4ce695['data']||!_0x4ce695[_0x3a5fd5(0xd7)][_0x3a5fd5(0x103)]||!_0x4ce695[_0x3a5fd5(0xd7)]['id'])throw new Error(_0x3a5fd5(0xbd));return registrationToken=_0x4ce695[_0x3a5fd5(0xd7)][_0x3a5fd5(0x103)],robotId=_0x4ce695[_0x3a5fd5(0xd7)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x3a5fd5(0xcd)](_0x3a5fd5(0x153)),!![];}catch(_0x3ca554){return console['error'](_0x3a5fd5(0xf8),_0x3ca554[_0x3a5fd5(0x163)]),![];}}function rewriteUrdfMeshUris(_0x2f759){const _0x59e54d=a1_0x1343ea;try{const _0x234ee7=new DOMParser(),_0x258927=_0x234ee7[_0x59e54d(0xc3)](_0x2f759,_0x59e54d(0xca));let _0x259a93=0x0,_0x5f1ebd=0x0;const _0xb7b34d=_0x258927[_0x59e54d(0xb3)](_0x59e54d(0x102));for(let _0x16a2bf=0x0;_0x16a2bf<_0xb7b34d[_0x59e54d(0xa7)];_0x16a2bf++){const _0x119b65=_0xb7b34d[_0x16a2bf],_0x2f6fc0=_0x119b65[_0x59e54d(0xf3)](_0x59e54d(0x12c)),_0x2ccfd4=['.stl',_0x59e54d(0xa2),_0x59e54d(0x162),_0x59e54d(0x110),_0x59e54d(0x126)],_0x8d41a7=_0x2ccfd4[_0x59e54d(0x11c)](_0x39103e=>_0x2f6fc0['toLowerCase']()[_0x59e54d(0xe0)](_0x39103e));if(_0x2f6fc0&&_0x2f6fc0[_0x59e54d(0xd4)](_0x59e54d(0x15a))&&_0x8d41a7){_0x259a93++;const _0xe29fa7=APPLIANCE_BASE_URL+'/ros/mesh?uri='+encodeURIComponent(_0x2f6fc0);_0x119b65[_0x59e54d(0x108)](_0x59e54d(0x12c),_0xe29fa7),_0x5f1ebd++,console['log'](_0x59e54d(0xb0)+_0x2f6fc0+_0x59e54d(0x138)+_0xe29fa7);}}_0x259a93>0x0?console[_0x59e54d(0xcd)](_0x59e54d(0xe9)+_0x5f1ebd+_0x59e54d(0x152)+_0x259a93+_0x59e54d(0xb9)):console[_0x59e54d(0xcd)](_0x59e54d(0xf4));const _0x2d4381=new XMLSerializer();return _0x2d4381[_0x59e54d(0x10a)](_0x258927);}catch(_0x5c39a4){return console[_0x59e54d(0x127)](_0x59e54d(0xa5),_0x5c39a4),_0x2f759;}}function connectToRosbridge(){const _0x47b8e8=a1_0x1343ea;try{rosbridgeWs=new WebSocket(config[_0x47b8e8(0xfd)][_0x47b8e8(0x143)]),rosbridgeWs['on']('open',()=>{const _0x47334f=_0x47b8e8;console[_0x47334f(0xcd)](_0x47334f(0xb8));const _0x3ef25b=require(_0x47334f(0x159)),_0x412d96=new _0x3ef25b[(_0x47334f(0x149))]({'url':config['rosbridge'][_0x47334f(0x143)]});_0x412d96['on'](_0x47334f(0xfa),()=>{setTimeout(()=>{const _0x513105=a1_0x5bbc;topicManager[_0x513105(0xf2)](_0x412d96)[_0x513105(0xce)](_0x22cf40=>{const _0x5034d2=_0x513105;console[_0x5034d2(0x127)](_0x5034d2(0xe1),_0x22cf40);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on']('message',_0x57f873=>{const _0x3fb5b1=_0x47b8e8;if(serverWs&&serverWs[_0x3fb5b1(0x115)]===WebSocket[_0x3fb5b1(0x145)]){let _0x2d25d7=_0x57f873['toString']();try{const _0x2e5370=JSON[_0x3fb5b1(0xae)](_0x2d25d7);if(_0x2e5370['op']===_0x3fb5b1(0x119)&&_0x2e5370[_0x3fb5b1(0xf1)]){const _0x665a96=topicManager[_0x3fb5b1(0x157)](_0x2e5370);switch(_0x665a96['action']){case'sample_skip':return;case _0x3fb5b1(0xd1):return;case _0x3fb5b1(0xd5):default:_0x2d25d7=JSON[_0x3fb5b1(0xeb)](_0x665a96[_0x3fb5b1(0x163)]);break;}}if((_0x2e5370['op']===_0x3fb5b1(0x136)||_0x2e5370['op']==='call_service')&&(_0x2e5370[_0x3fb5b1(0x122)]==='/rosapi/topics'||_0x2e5370[_0x3fb5b1(0x15d)]&&_0x2e5370[_0x3fb5b1(0x15d)][_0x3fb5b1(0x12b)])){console[_0x3fb5b1(0xcd)]('[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata');const _0x33bcd6=_0x2e5370['values']?.[_0x3fb5b1(0x12b)]||[],_0x21858e=_0x2e5370[_0x3fb5b1(0x15d)]?.['types']||[],_0x29829d=_0x33bcd6[_0x3fb5b1(0xc6)]((_0x4533a1,_0x3b1cab)=>{const _0x18cab0=_0x3fb5b1,_0x2ca377=topicManager[_0x18cab0(0x140)](_0x4533a1);return{'name':_0x4533a1,'type':_0x21858e[_0x3b1cab]||_0x18cab0(0x116),'throttling':_0x2ca377?{'isThrottled':_0x2ca377[_0x18cab0(0xb2)]==='sample','strategy':_0x2ca377[_0x18cab0(0xb2)],'samplingRate':_0x2ca377[_0x18cab0(0xec)],'reason':_0x2ca377[_0x18cab0(0x101)],'estimatedSize':_0x2ca377['estimatedSize']}:null};});_0x2e5370[_0x3fb5b1(0x15d)]={'topics':_0x29829d['map'](_0x59d3d3=>_0x59d3d3['name']),'types':_0x29829d['map'](_0x57146f=>_0x57146f[_0x3fb5b1(0x124)]),'throttling':_0x29829d[_0x3fb5b1(0xc6)](_0x5b16f1=>_0x5b16f1[_0x3fb5b1(0xba)])},_0x2d25d7=JSON[_0x3fb5b1(0xeb)](_0x2e5370),console[_0x3fb5b1(0xcd)](_0x3fb5b1(0x12a));}if(_0x2e5370['op']===_0x3fb5b1(0x119)&&_0x2e5370['topic']==='/robot_description')try{const _0x4ddbd6=_0x2e5370['msg'][_0x3fb5b1(0xd7)],_0x110444=rewriteUrdfMeshUris(_0x4ddbd6);_0x2e5370['msg'][_0x3fb5b1(0xd7)]=_0x110444,_0x2d25d7=JSON[_0x3fb5b1(0xeb)](_0x2e5370);}catch(_0x324997){console[_0x3fb5b1(0x127)](_0x3fb5b1(0xbc),_0x324997);}}catch(_0x4ac0e0){console[_0x3fb5b1(0x13b)](_0x3fb5b1(0x14b),_0x4ac0e0['message']);}serverWs['send'](_0x2d25d7);}}),rosbridgeWs['on'](_0x47b8e8(0x156),()=>{const _0x529124=_0x47b8e8;console[_0x529124(0xcd)](_0x529124(0x125)),webrtcService[_0x529124(0xc8)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on']('error',_0x9301a9=>{const _0x5d8152=_0x47b8e8;console[_0x5d8152(0x127)]('ROSBridge\x20(main)\x20connection\x20error:',_0x9301a9);});}catch(_0x2b1198){console[_0x47b8e8(0x127)](_0x47b8e8(0xc9),_0x2b1198),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x17b2ce=a1_0x1343ea;try{rosbridgeWebRTCWs=new WebSocket(config['rosbridge']['wsEndpoint']),rosbridgeWebRTCWs['on'](_0x17b2ce(0x107),()=>{const _0x9a95fa=_0x17b2ce;console[_0x9a95fa(0xcd)](_0x9a95fa(0xfe)),webrtcService[_0x9a95fa(0xdc)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x17b2ce(0x163),_0x4d2f37=>{}),rosbridgeWebRTCWs['on'](_0x17b2ce(0x156),()=>{const _0xd62f9e=_0x17b2ce;console[_0xd62f9e(0xcd)](_0xd62f9e(0xa6)),webrtcService[_0xd62f9e(0xc8)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x17b2ce(0x127),_0x37c10b=>{const _0x591192=_0x17b2ce;console[_0x591192(0x127)](_0x591192(0x114),_0x37c10b);});}catch(_0x2ce76b){console['error'](_0x17b2ce(0x14d),_0x2ce76b),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x49e06a=a1_0x1343ea;try{if(!registrationToken)throw new Error('Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.');const _0x101b95=config[_0x49e06a(0xe6)]['replace']('http','ws')+_0x49e06a(0xa8)+registrationToken;serverWs=new WebSocket(_0x101b95),serverWs['on'](_0x49e06a(0x107),()=>{const _0x871aea=_0x49e06a;console[_0x871aea(0xcd)](_0x871aea(0xda)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs['readyState']===WebSocket['OPEN']&&webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x49e06a(0x163),_0x52315c=>{const _0x513973=_0x49e06a;if(rosbridgeWs&&rosbridgeWs[_0x513973(0x115)]===WebSocket['OPEN']){let _0x574d5a=_0x52315c[_0x513973(0x121)]();try{const _0x14430f=JSON[_0x513973(0xae)](_0x574d5a);if(webrtcService[_0x513973(0x157)](_0x14430f))return;if(_0x14430f['op']==='get_urdf_param'&&typeof _0x14430f[_0x513973(0xee)]===_0x513973(0x135)&&_0x14430f[_0x513973(0xa9)])try{console[_0x513973(0xcd)]('[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20'+_0x14430f[_0x513973(0xee)]);const _0x4c55aa=execSync(_0x513973(0xbb)+_0x14430f[_0x513973(0xee)],{'encoding':'utf8'})[_0x513973(0x130)]();let _0x5d2332=_0x4c55aa;_0x4c55aa[_0x513973(0xd4)]('String\x20value\x20is:\x20')&&(_0x5d2332=_0x4c55aa[_0x513973(0x14a)](_0x513973(0xc0)[_0x513973(0xa7)]()));_0x5d2332['startsWith']('\x22')&&_0x5d2332[_0x513973(0xe0)]('\x22')&&(_0x5d2332=_0x5d2332[_0x513973(0xbe)](0x1,-0x1));_0x5d2332=_0x5d2332[_0x513973(0xff)](/\\n/g,'\x0a')[_0x513973(0xff)](/\\"/g,'\x22');const _0x9dc58b={'op':_0x513973(0xa4),'request_id':_0x14430f[_0x513973(0xa9)],'data':_0x5d2332};serverWs[_0x513973(0x10c)](JSON[_0x513973(0xeb)](_0x9dc58b)),console[_0x513973(0xcd)]('[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20'+_0x14430f[_0x513973(0xee)]);return;}catch(_0x5e97a3){console[_0x513973(0x127)](_0x513973(0x105),_0x5e97a3);const _0x246235={'op':_0x513973(0xa4),'request_id':_0x14430f[_0x513973(0xa9)],'error':_0x5e97a3[_0x513973(0x163)]};serverWs[_0x513973(0x10c)](JSON[_0x513973(0xeb)](_0x246235));return;}if(_0x14430f['op']==='get_mesh'&&typeof _0x14430f[_0x513973(0xf7)]==='string'&&_0x14430f[_0x513973(0xa9)])try{const _0x72d990=_0x14430f[_0x513973(0xf7)]['match'](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x72d990){const _0x50d444=_0x72d990[0x1],_0x189cbc=_0x72d990[0x2],_0x2a9314=execSync('ros2\x20pkg\x20prefix\x20'+_0x50d444,{'encoding':'utf8'})[_0x513973(0x130)](),_0x4123d6=path[_0x513973(0x12e)](_0x2a9314,_0x513973(0xde),_0x50d444,_0x189cbc);if(!fs[_0x513973(0x144)](_0x4123d6))throw new Error(_0x513973(0x15c)+_0x4123d6);const _0x27daa1=fs['readFileSync'](_0x4123d6),_0x4f0107={'op':_0x513973(0x111),'request_id':_0x14430f[_0x513973(0xa9)],'data':_0x27daa1[_0x513973(0x121)](_0x513973(0xcc))};serverWs[_0x513973(0x10c)](JSON[_0x513973(0xeb)](_0x4f0107)),console['log']('[MESH]\x20Successfully\x20served\x20mesh:\x20'+_0x14430f[_0x513973(0xf7)]+'\x20from\x20'+_0x4123d6);return;}}catch(_0x4fba1e){console[_0x513973(0x127)]('[MESH]\x20Error\x20serving\x20mesh:',_0x4fba1e);const _0x574052={'op':_0x513973(0x111),'request_id':_0x14430f[_0x513973(0xa9)],'error':_0x4fba1e['message']};serverWs['send'](JSON[_0x513973(0xeb)](_0x574052));return;}rosbridgeWs['send'](_0x574d5a);}catch(_0x557962){rosbridgeWs[_0x513973(0x10c)](_0x574d5a);}}}),serverWs['on'](_0x49e06a(0x156),(_0x327c1c,_0x2582a2)=>{const _0x403ba4=_0x49e06a;console[_0x403ba4(0xcd)](_0x403ba4(0xe3)+_0x327c1c+':\x20'+_0x2582a2+_0x403ba4(0x10d)),webrtcService[_0x403ba4(0xc8)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x49e06a(0x127),_0x3e073f=>{const _0x4e4a9f=_0x49e06a;console[_0x4e4a9f(0x127)](_0x4e4a9f(0x148),_0x3e073f);});}catch(_0x25d55d){console[_0x49e06a(0x127)](_0x49e06a(0x150),_0x25d55d),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x43fd9b,_0x3caa24,_0x2f7fd3)=>{const _0x38d3b4=a1_0x1343ea;if(!authService[_0x38d3b4(0xe4)]()){console[_0x38d3b4(0xcd)]('Attempting\x20to\x20login\x20to:',config[_0x38d3b4(0xe6)]);const _0x1c9767=await authService[_0x38d3b4(0x11f)]();if(!_0x1c9767)return _0x3caa24[_0x38d3b4(0x147)](0x191)['json']({'error':_0x38d3b4(0x15e)});}_0x2f7fd3();};app[a1_0x1343ea(0x137)]((_0x53ddd4,_0x340b15,_0x186dcc)=>{const _0x358364=a1_0x1343ea;_0x340b15[_0x358364(0x112)](_0x358364(0xaa),'*'),_0x340b15[_0x358364(0x112)](_0x358364(0x14f),'GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS'),_0x340b15[_0x358364(0x112)]('Access-Control-Allow-Headers',_0x358364(0x128)),_0x53ddd4[_0x358364(0x15f)]===_0x358364(0x13f)?_0x340b15['sendStatus'](0xc8):_0x186dcc();}),app[a1_0x1343ea(0x155)]('/',requireAuth,(_0x1daa69,_0x73d39d)=>{const _0x3e2a07=a1_0x1343ea;_0x73d39d[_0x3e2a07(0x10c)]('Appliance\x20is\x20running\x20and\x20authenticated!');}),app['get'](a1_0x1343ea(0x146),async(_0x176b11,_0x48baa2)=>{const _0x21a7df=a1_0x1343ea,_0xc6ee33=authService[_0x21a7df(0xe4)](),_0x3c26f5=webrtcService[_0x21a7df(0xfb)](),_0x5de9d4=webrtcService[_0x21a7df(0x14e)](),_0x53808c=topicManager[_0x21a7df(0xd0)]();_0x48baa2['json']({'status':'ok','environment':process[_0x21a7df(0xc2)][_0x21a7df(0xf9)]||_0x21a7df(0x142),'backendUrl':config[_0x21a7df(0xe6)],'rosbridgeUrl':config[_0x21a7df(0xfd)][_0x21a7df(0x143)],'proxyPort':port,'authenticated':_0xc6ee33,'topicManagement':{'discovered':_0x53808c[_0x21a7df(0x161)],'strategies':_0x53808c['strategies'],'largeDataTopics':_0x53808c[_0x21a7df(0xfc)]['length'],'largeTopicsList':_0x53808c[_0x21a7df(0xfc)]},'webrtc':{'activeSessions':_0x3c26f5[_0x21a7df(0xa7)],'sharedVideoSources':_0x5de9d4[_0x21a7df(0xa7)],'sessions':_0x3c26f5,'sharedSources':_0x5de9d4}});});const getInitialPort=()=>{const _0x2f252a=a1_0x1343ea;if(process[_0x2f252a(0xc2)]['PORT'])return parseInt(process[_0x2f252a(0xc2)][_0x2f252a(0x118)],0xa);return config[_0x2f252a(0xfd)][_0x2f252a(0xcb)];};async function listenWithRetries(_0x5b8734,_0xff0456,_0x245435=0xa){const _0x537105=a1_0x1343ea;let _0x279941=_0xff0456;for(let _0x35901d=0x1;_0x35901d<=_0x245435;_0x35901d++){try{return await new Promise((_0x112077,_0x549046)=>{const _0x5d412e=a1_0x5bbc,_0x17d001=_0x5b8734[_0x5d412e(0xab)](_0x279941,()=>{const _0x36d02d=_0x5d412e;console[_0x36d02d(0xcd)]('Appliance\x20server\x20started\x20successfully\x20on\x20port\x20'+_0x279941),_0x112077(_0x17d001);});_0x17d001['on'](_0x5d412e(0x127),_0x418b36=>{const _0x204d70=_0x5d412e;_0x418b36[_0x204d70(0x139)]===_0x204d70(0xf6)?(console[_0x204d70(0x13b)]('Port\x20'+_0x279941+_0x204d70(0xb1)),_0x549046(_0x418b36)):_0x549046(_0x418b36);});}),_0x279941;}catch(_0xc7e9b5){_0x279941++;}}throw new Error(_0x537105(0x131)+_0x245435+_0x537105(0xd3)+_0xff0456);}const startApp=async()=>{const _0x487a03=a1_0x1343ea;try{reloadEnv();let _0x1c7939=await authService[_0x487a03(0x11f)]();while(!_0x1c7939){console[_0x487a03(0xcd)](_0x487a03(0xc5)),await promptForCredentials(),_0x1c7939=await authService[_0x487a03(0x11f)]();}console[_0x487a03(0xcd)](_0x487a03(0xe2));!loadApplianceIdentity()&&console['log'](_0x487a03(0x129));console[_0x487a03(0xcd)](_0x487a03(0xd6));const _0x2d125f=await registerWithServer();if(!_0x2d125f)throw new Error('Failed\x20to\x20register\x20with\x20server');connectToRosbridge(),connectToServer();const _0x59617a=getInitialPort();await listenWithRetries(app,_0x59617a,0xa);}catch(_0x25ea91){console[_0x487a03(0x127)](_0x487a03(0xf0),_0x25ea91),process[_0x487a03(0x11d)](0x1);}};setInterval(async()=>{const _0x25114e=a1_0x1343ea;try{if(robotId){const _0x8aeeca=authService[_0x25114e(0xea)]();await axios['post'](config[_0x25114e(0xe6)]+_0x25114e(0x10e),{'robotId':robotId},{'headers':{'Authorization':_0x25114e(0x13a)+_0x8aeeca,'Content-Type':'application/json'}});}}catch(_0xc5256b){console[_0x25114e(0x127)]('Failed\x20to\x20ping\x20server:',_0xc5256b['message']);}},0x1388),startApp();