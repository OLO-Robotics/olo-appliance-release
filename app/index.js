const a1_0x4bbd3e=a1_0x18a8;(function(_0x1c3683,_0xfa69ae){const _0x1e5bbb=a1_0x18a8,_0x4c6aac=_0x1c3683();while(!![]){try{const _0x217cff=parseInt(_0x1e5bbb(0x13d))/0x1*(parseInt(_0x1e5bbb(0x123))/0x2)+parseInt(_0x1e5bbb(0x116))/0x3+parseInt(_0x1e5bbb(0xf0))/0x4*(-parseInt(_0x1e5bbb(0x15a))/0x5)+parseInt(_0x1e5bbb(0x19d))/0x6+parseInt(_0x1e5bbb(0x110))/0x7*(parseInt(_0x1e5bbb(0xeb))/0x8)+parseInt(_0x1e5bbb(0xed))/0x9+-parseInt(_0x1e5bbb(0x117))/0xa*(parseInt(_0x1e5bbb(0xf3))/0xb);if(_0x217cff===_0xfa69ae)break;else _0x4c6aac['push'](_0x4c6aac['shift']());}catch(_0x1b34ce){_0x4c6aac['push'](_0x4c6aac['shift']());}}}(a1_0x6c77,0x2bf5d));const a1_0x51cbb5=(function(){let _0x319341=!![];return function(_0x2ba0d7,_0x2ed1c0){const _0x434f5d=_0x319341?function(){const _0x42edd1=a1_0x18a8;if(_0x2ed1c0){const _0x27f695=_0x2ed1c0[_0x42edd1(0x14e)](_0x2ba0d7,arguments);return _0x2ed1c0=null,_0x27f695;}}:function(){};return _0x319341=![],_0x434f5d;};}()),a1_0x42d53c=a1_0x51cbb5(this,function(){const _0x14eac5=a1_0x18a8;return a1_0x42d53c[_0x14eac5(0x102)]()[_0x14eac5(0x17a)]('(((.+)+)+)+$')[_0x14eac5(0x102)]()[_0x14eac5(0x101)](a1_0x42d53c)[_0x14eac5(0x17a)](_0x14eac5(0x159));});a1_0x42d53c();const express=require('express'),config=require(a1_0x4bbd3e(0x146)),authService=require(a1_0x4bbd3e(0x137)),webrtcService=require(a1_0x4bbd3e(0xf9)),topicManager=require(a1_0x4bbd3e(0x14c)),WebSocket=require('ws'),axios=require(a1_0x4bbd3e(0xf2)),fs=require('fs'),prompt=require(a1_0x4bbd3e(0x175))({'sigint':!![]}),dotenv=require(a1_0x4bbd3e(0x183)),app=express(),port=process[a1_0x4bbd3e(0x144)][a1_0x4bbd3e(0x13b)]||config[a1_0x4bbd3e(0x121)]['proxyPort'],APPLIANCE_FILE='.appliance.json',{DOMParser,XMLSerializer}=require(a1_0x4bbd3e(0xe7)),path=require(a1_0x4bbd3e(0x160)),{execSync}=require(a1_0x4bbd3e(0x176)),APPLIANCE_BASE_URL=process[a1_0x4bbd3e(0x144)]['APPLIANCE_BASE_URL']||'';console[a1_0x4bbd3e(0x16e)](a1_0x4bbd3e(0x12b)+(process[a1_0x4bbd3e(0x144)][a1_0x4bbd3e(0xff)]||'development')),console['log'](a1_0x4bbd3e(0x112)+config[a1_0x4bbd3e(0x12a)]),console['log'](a1_0x4bbd3e(0x10b)+config[a1_0x4bbd3e(0x121)][a1_0x4bbd3e(0x177)]),console['log']('Proxy\x20listening\x20on\x20port:\x20'+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x19d3fd,_0x533b8b){const _0x45bf28=a1_0x4bbd3e;fs[_0x45bf28(0xe2)](_0x45bf28(0xe8),'APP_USERNAME='+_0x19d3fd+_0x45bf28(0x18f)+_0x533b8b+'\x0a');}function reloadEnv(){const _0x52e626=a1_0x4bbd3e;dotenv[_0x52e626(0x17c)]({'override':!![]}),config['credentials'][_0x52e626(0x17b)]=process[_0x52e626(0x144)][_0x52e626(0x12f)],config[_0x52e626(0x11f)]['password']=process['env'][_0x52e626(0x15c)];}async function promptForCredentials(){const _0x5e87e5=a1_0x4bbd3e,_0x4acd4c=prompt('Enter\x20username:\x20'),_0x5af339=prompt[_0x5e87e5(0x18d)]('Enter\x20password:\x20');updateEnvFile(_0x4acd4c,_0x5af339),reloadEnv();}function loadApplianceIdentity(){const _0x44169e=a1_0x4bbd3e;if(fs[_0x44169e(0xfb)](APPLIANCE_FILE))try{const _0x54dd52=JSON[_0x44169e(0x136)](fs[_0x44169e(0x1a2)](APPLIANCE_FILE,_0x44169e(0x191)));if(_0x54dd52[_0x44169e(0x173)]&&_0x54dd52[_0x44169e(0xf8)])return robotId=_0x54dd52['robotId'],registrationToken=_0x54dd52[_0x44169e(0xf8)],console[_0x44169e(0x16e)]('Loaded\x20appliance\x20identity:',robotId),topicManager[_0x44169e(0x18a)](_0x54dd52),!![];}catch(_0xfb6549){console['error']('Failed\x20to\x20parse\x20appliance\x20identity\x20file:',_0xfb6549);}return![];}function saveApplianceIdentity(_0xafa968,_0x29ca2f){const _0x4deafa=a1_0x4bbd3e;let _0x1e0013={};if(fs[_0x4deafa(0xfb)](APPLIANCE_FILE))try{_0x1e0013=JSON['parse'](fs[_0x4deafa(0x1a2)](APPLIANCE_FILE,_0x4deafa(0x191)));}catch(_0x4f8cf4){_0x1e0013={};}_0x1e0013[_0x4deafa(0x173)]=_0xafa968,_0x1e0013['registrationToken']=_0x29ca2f,fs[_0x4deafa(0xe2)](APPLIANCE_FILE,JSON[_0x4deafa(0x187)](_0x1e0013,null,0x2));}function a1_0x6c77(){const _0x7143f4=['stopAllSessions','APP_PASSWORD','Topic\x20discovery\x20failed:','Not\x20authenticated','filename','path','topics','service_response','header','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','trim','Server\x20connection\x20error:','sendStatus','status','estimatedSize','urdf_param_data','[MESH]\x20Successfully\x20served\x20mesh:\x20','service','response','log','text/xml','get_mesh','login','throttling','robotId','Attempting\x20to\x20login\x20to:','prompt-sync','child_process','wsEndpoint','Access-Control-Allow-Origin','readyState','search','username','config','/appliance/register','ros2\x20param\x20get\x20','uri','name','registration_token','Access-Control-Allow-Methods','dotenv','use','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','some','stringify','open','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','loadConfig','values','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','hide','.obj','\x0aAPP_PASSWORD=','Port\x20','utf8','.ply','largeDataTopics','Connected\x20to\x20ROSBridge\x20(WebRTC)','/appliance/ping','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','ROSBridge\x20(WebRTC)\x20connection\x20error:','base64','includes','OPTIONS','publish','endsWith','147750iHsZiI','isAuthenticated','startsWith','[URDF\x20REWRITE]\x20Rewrote\x20','type','readFileSync','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','json','join','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','writeFileSync','map','Failed\x20to\x20register\x20with\x20server:','\x20of\x20','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','xmldom','.env','types','Successfully\x20logged\x20in','232epYbna','strategies','2032875sqaSWP','string','initialize','4zAIZTI','Disconnected\x20from\x20server\x20(','axios','822965fpcQAA','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','get','\x20->\x20','reason','registrationToken','./services/webrtcService','Connected\x20to\x20ROSBridge\x20(main)','existsSync','/rosapi/topics','Authentication\x20required','ROSBridge\x20(main)\x20connection\x20error:','NODE_ENV','development','constructor','toString','exit','getAttribute','unlinkSync','\x20attempts\x20starting\x20from\x20','close','/rosbridge?type=appliance&token=','slice','.dae','ROSBridge\x20WebSocket\x20URL:\x20','samplingRate','length','strategy','WSL\x20Appliance','51814fxSEKy','forward','Backend\x20Server\x20URL:\x20','[MESH]\x20Error\x20serving\x20mesh:','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','warn','99933YPAyBy','30TPoELC','getTopicStrategy','.stl','/robot_description','\x20in\x20use,\x20trying\x20next\x20port...','error','package://','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','credentials','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','rosbridge','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','6488UXhtkH','String\x20value\x20is:\x20','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','Successfully\x20registered\x20with\x20server','webrtc_skip','method','substring','serverUrl','Environment:\x20','ros2\x20pkg\x20prefix\x20','request_id','match','APP_USERNAME','topic','replace','OPEN','Connected\x20to\x20server','message','code','parse','./services/auth','get_urdf_param','sample','.mesh','PORT','Mesh\x20file\x20not\x20found:\x20','43iOZGBz','data','Failed\x20to\x20ping\x20server:','mesh_data','send','Ros','getSharedVideoSources','env','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','./config','totalTopics','),\x20attempting\x20to\x20reconnect...','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','getActiveSessions','toLowerCase','./services/TopicManager','serializeToString','apply','application/json','setAttribute','param_name','call_service','parseFromString','Bearer\x20','robot\x20not\x20found','getToken','msg','post','(((.+)+)+)+$','1167275MVvVEC'];a1_0x6c77=function(){return _0x7143f4;};return a1_0x6c77();}async function registerWithServer(){const _0x2b27bd=a1_0x4bbd3e;try{const _0x26afbd=authService[_0x2b27bd(0x156)]();if(!_0x26afbd)throw new Error(_0x2b27bd(0x15e));let _0x646ff1,_0x2f7655=![];while(!![]){try{robotId&&registrationToken?_0x646ff1=await axios[_0x2b27bd(0x158)](config['serverUrl']+_0x2b27bd(0x17d),{'name':_0x2b27bd(0x10f),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x2b27bd(0x154)+_0x26afbd,'Content-Type':_0x2b27bd(0x14f)}}):_0x646ff1=await axios['post'](config['serverUrl']+_0x2b27bd(0x17d),{'name':_0x2b27bd(0x10f)},{'headers':{'Authorization':_0x2b27bd(0x154)+_0x26afbd,'Content-Type':'application/json'}});break;}catch(_0xb87ce4){const _0x305dd3=_0xb87ce4?.[_0x2b27bd(0x16d)]?.[_0x2b27bd(0x13e)]?.[_0x2b27bd(0x11c)]||_0xb87ce4[_0x2b27bd(0x134)];if(!_0x2f7655&&_0x305dd3&&_0x305dd3[_0x2b27bd(0x14b)]()[_0x2b27bd(0x199)](_0x2b27bd(0x155))){console[_0x2b27bd(0x115)](_0x2b27bd(0x122));if(fs[_0x2b27bd(0xfb)](APPLIANCE_FILE))fs[_0x2b27bd(0x105)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x2f7655=!![];continue;}throw _0xb87ce4;}}if(!_0x646ff1[_0x2b27bd(0x13e)]||!_0x646ff1[_0x2b27bd(0x13e)][_0x2b27bd(0x181)]||!_0x646ff1[_0x2b27bd(0x13e)]['id'])throw new Error('Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server');return registrationToken=_0x646ff1['data'][_0x2b27bd(0x181)],robotId=_0x646ff1[_0x2b27bd(0x13e)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x2b27bd(0x16e)](_0x2b27bd(0x126)),!![];}catch(_0x3d7cb0){return console['error'](_0x2b27bd(0xe4),_0x3d7cb0['message']),![];}}function rewriteUrdfMeshUris(_0x3c2c43){const _0x34d7c8=a1_0x4bbd3e;try{const _0x8d6dac=new DOMParser(),_0x41a04e=_0x8d6dac[_0x34d7c8(0x153)](_0x3c2c43,_0x34d7c8(0x16f));let _0x185d1b=0x0,_0x25bd13=0x0;const _0x2a6339=_0x41a04e['getElementsByTagName']('mesh');for(let _0x5b5ac1=0x0;_0x5b5ac1<_0x2a6339[_0x34d7c8(0x10d)];_0x5b5ac1++){const _0x48d8e4=_0x2a6339[_0x5b5ac1],_0x48dae2=_0x48d8e4[_0x34d7c8(0x104)]('filename'),_0x1f499f=[_0x34d7c8(0x119),_0x34d7c8(0x10a),_0x34d7c8(0x18e),_0x34d7c8(0x192),_0x34d7c8(0x13a)],_0x1136dd=_0x1f499f[_0x34d7c8(0x186)](_0x45c2bd=>_0x48dae2[_0x34d7c8(0x14b)]()['endsWith'](_0x45c2bd));if(_0x48dae2&&_0x48dae2['startsWith'](_0x34d7c8(0x11d))&&_0x1136dd){_0x185d1b++;const _0x39bbcb=APPLIANCE_BASE_URL+'/ros/mesh?uri='+encodeURIComponent(_0x48dae2);_0x48d8e4[_0x34d7c8(0x150)](_0x34d7c8(0x15f),_0x39bbcb),_0x25bd13++,console[_0x34d7c8(0x16e)](_0x34d7c8(0x189)+_0x48dae2+_0x34d7c8(0xf6)+_0x39bbcb);}}_0x185d1b>0x0?console[_0x34d7c8(0x16e)](_0x34d7c8(0x1a0)+_0x25bd13+_0x34d7c8(0xe5)+_0x185d1b+_0x34d7c8(0x18c)):console[_0x34d7c8(0x16e)]('[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF');const _0x5894bd=new XMLSerializer();return _0x5894bd[_0x34d7c8(0x14d)](_0x41a04e);}catch(_0x462c46){return console[_0x34d7c8(0x11c)](_0x34d7c8(0x164),_0x462c46),_0x3c2c43;}}function connectToRosbridge(){const _0x1d5cda=a1_0x4bbd3e;try{rosbridgeWs=new WebSocket(config['rosbridge'][_0x1d5cda(0x177)]),rosbridgeWs['on'](_0x1d5cda(0x188),()=>{const _0x4a2016=_0x1d5cda;console[_0x4a2016(0x16e)](_0x4a2016(0xfa));const _0x3ecd0a=require('roslib'),_0x21e867=new _0x3ecd0a[(_0x4a2016(0x142))]({'url':config[_0x4a2016(0x121)][_0x4a2016(0x177)]});_0x21e867['on']('connection',()=>{setTimeout(()=>{topicManager['discoverTopics'](_0x21e867)['catch'](_0x14a0a7=>{const _0x561bd5=a1_0x18a8;console[_0x561bd5(0x11c)](_0x561bd5(0x15d),_0x14a0a7);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x1d5cda(0x134),_0x217ec6=>{const _0x25676f=_0x1d5cda;if(serverWs&&serverWs[_0x25676f(0x179)]===WebSocket[_0x25676f(0x132)]){let _0x3f1679=_0x217ec6[_0x25676f(0x102)]();try{const _0x48660c=JSON['parse'](_0x3f1679);if(_0x48660c['op']===_0x25676f(0x19b)&&_0x48660c[_0x25676f(0x130)]){const _0x423a7c=topicManager['handleMessage'](_0x48660c);switch(_0x423a7c['action']){case'sample_skip':return;case _0x25676f(0x127):return;case _0x25676f(0x111):default:_0x3f1679=JSON['stringify'](_0x423a7c[_0x25676f(0x134)]);break;}}if((_0x48660c['op']===_0x25676f(0x162)||_0x48660c['op']===_0x25676f(0x152))&&(_0x48660c[_0x25676f(0x16c)]===_0x25676f(0xfc)||_0x48660c[_0x25676f(0x18b)]&&_0x48660c[_0x25676f(0x18b)][_0x25676f(0x161)])){console[_0x25676f(0x16e)](_0x25676f(0x149));const _0x473e3e=_0x48660c['values']?.[_0x25676f(0x161)]||[],_0x1a3db2=_0x48660c[_0x25676f(0x18b)]?.[_0x25676f(0xe9)]||[],_0x53441d=_0x473e3e[_0x25676f(0xe3)]((_0x50f87e,_0x2f2df0)=>{const _0x5e928a=_0x25676f,_0xa180e5=topicManager[_0x5e928a(0x118)](_0x50f87e);return{'name':_0x50f87e,'type':_0x1a3db2[_0x2f2df0]||'unknown','throttling':_0xa180e5?{'isThrottled':_0xa180e5['strategy']===_0x5e928a(0x139),'strategy':_0xa180e5[_0x5e928a(0x10e)],'samplingRate':_0xa180e5[_0x5e928a(0x10c)],'reason':_0xa180e5[_0x5e928a(0xf7)],'estimatedSize':_0xa180e5[_0x5e928a(0x169)]}:null};});_0x48660c['values']={'topics':_0x53441d[_0x25676f(0xe3)](_0x5ccb0e=>_0x5ccb0e[_0x25676f(0x180)]),'types':_0x53441d[_0x25676f(0xe3)](_0x3d76f2=>_0x3d76f2[_0x25676f(0x1a1)]),'throttling':_0x53441d[_0x25676f(0xe3)](_0x4dda67=>_0x4dda67[_0x25676f(0x172)])},_0x3f1679=JSON[_0x25676f(0x187)](_0x48660c),console[_0x25676f(0x16e)]('[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client');}if(_0x48660c['op']==='publish'&&_0x48660c[_0x25676f(0x130)]===_0x25676f(0x11a))try{const _0x2d7933=_0x48660c[_0x25676f(0x157)]['data'],_0x302bee=rewriteUrdfMeshUris(_0x2d7933);_0x48660c[_0x25676f(0x157)][_0x25676f(0x13e)]=_0x302bee,_0x3f1679=JSON[_0x25676f(0x187)](_0x48660c);}catch(_0x268351){console['error'](_0x25676f(0x185),_0x268351);}}catch(_0x39a797){console[_0x25676f(0x115)](_0x25676f(0x11e),_0x39a797['message']);}serverWs[_0x25676f(0x141)](_0x3f1679);}}),rosbridgeWs['on'](_0x1d5cda(0x107),()=>{const _0x187723=_0x1d5cda;console[_0x187723(0x16e)](_0x187723(0x196)),webrtcService[_0x187723(0x15b)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x1d5cda(0x11c),_0x222726=>{const _0x57c9da=_0x1d5cda;console[_0x57c9da(0x11c)](_0x57c9da(0xfe),_0x222726);});}catch(_0x457224){console[_0x1d5cda(0x11c)](_0x1d5cda(0x114),_0x457224),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x3467e6=a1_0x4bbd3e;try{rosbridgeWebRTCWs=new WebSocket(config[_0x3467e6(0x121)][_0x3467e6(0x177)]),rosbridgeWebRTCWs['on'](_0x3467e6(0x188),()=>{const _0x1e45bb=_0x3467e6;console['log'](_0x1e45bb(0x194)),webrtcService[_0x1e45bb(0xef)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x3467e6(0x134),_0x218468=>{}),rosbridgeWebRTCWs['on'](_0x3467e6(0x107),()=>{const _0x258e62=_0x3467e6;console[_0x258e62(0x16e)]('Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x258e62(0x15b)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x3467e6(0x11c),_0x14eca1=>{const _0x55eb44=_0x3467e6;console['error'](_0x55eb44(0x197),_0x14eca1);});}catch(_0x47eb34){console[_0x3467e6(0x11c)]('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):',_0x47eb34),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x126ba9=a1_0x4bbd3e;try{if(!registrationToken)throw new Error(_0x126ba9(0x1a3));const _0x1222b5=config[_0x126ba9(0x12a)][_0x126ba9(0x131)]('http','ws')+_0x126ba9(0x108)+registrationToken;serverWs=new WebSocket(_0x1222b5),serverWs['on'](_0x126ba9(0x188),()=>{const _0x12b25f=_0x126ba9;console[_0x12b25f(0x16e)](_0x12b25f(0x133)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x12b25f(0x179)]===WebSocket[_0x12b25f(0x132)]&&webrtcService[_0x12b25f(0xef)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x126ba9(0x134),_0x57ef7c=>{const _0x200235=_0x126ba9;if(rosbridgeWs&&rosbridgeWs['readyState']===WebSocket[_0x200235(0x132)]){let _0x4f3d25=_0x57ef7c[_0x200235(0x102)]();try{const _0x4a2ab5=JSON[_0x200235(0x136)](_0x4f3d25);if(webrtcService['handleMessage'](_0x4a2ab5))return;if(_0x4a2ab5['op']===_0x200235(0x138)&&typeof _0x4a2ab5[_0x200235(0x151)]===_0x200235(0xee)&&_0x4a2ab5[_0x200235(0x12d)])try{console['log'](_0x200235(0xe1)+_0x4a2ab5[_0x200235(0x151)]);const _0x2a87e9=execSync(_0x200235(0x17e)+_0x4a2ab5[_0x200235(0x151)],{'encoding':_0x200235(0x191)})[_0x200235(0x165)]();let _0x8badc4=_0x2a87e9;_0x2a87e9[_0x200235(0x19f)](_0x200235(0x124))&&(_0x8badc4=_0x2a87e9[_0x200235(0x129)]('String\x20value\x20is:\x20'[_0x200235(0x10d)]()));_0x8badc4[_0x200235(0x19f)]('\x22')&&_0x8badc4[_0x200235(0x19c)]('\x22')&&(_0x8badc4=_0x8badc4[_0x200235(0x109)](0x1,-0x1));_0x8badc4=_0x8badc4['replace'](/\\n/g,'\x0a')[_0x200235(0x131)](/\\"/g,'\x22');const _0x4100e4={'op':_0x200235(0x16a),'request_id':_0x4a2ab5[_0x200235(0x12d)],'data':_0x8badc4};serverWs[_0x200235(0x141)](JSON[_0x200235(0x187)](_0x4100e4)),console[_0x200235(0x16e)](_0x200235(0xf4)+_0x4a2ab5['param_name']);return;}catch(_0x267883){console['error']('[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:',_0x267883);const _0x3257c0={'op':'urdf_param_data','request_id':_0x4a2ab5[_0x200235(0x12d)],'error':_0x267883[_0x200235(0x134)]};serverWs['send'](JSON[_0x200235(0x187)](_0x3257c0));return;}if(_0x4a2ab5['op']===_0x200235(0x170)&&typeof _0x4a2ab5['uri']===_0x200235(0xee)&&_0x4a2ab5[_0x200235(0x12d)])try{const _0x2603d8=_0x4a2ab5[_0x200235(0x17f)][_0x200235(0x12e)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x2603d8){const _0x5e8f42=_0x2603d8[0x1],_0x598efc=_0x2603d8[0x2],_0x2f2b4d=execSync(_0x200235(0x12c)+_0x5e8f42,{'encoding':'utf8'})[_0x200235(0x165)](),_0x1a201d=path[_0x200235(0xe0)](_0x2f2b4d,'share',_0x5e8f42,_0x598efc);if(!fs[_0x200235(0xfb)](_0x1a201d))throw new Error(_0x200235(0x13c)+_0x1a201d);const _0x57c98e=fs[_0x200235(0x1a2)](_0x1a201d),_0x445d40={'op':_0x200235(0x140),'request_id':_0x4a2ab5[_0x200235(0x12d)],'data':_0x57c98e[_0x200235(0x102)](_0x200235(0x198))};serverWs[_0x200235(0x141)](JSON[_0x200235(0x187)](_0x445d40)),console[_0x200235(0x16e)](_0x200235(0x16b)+_0x4a2ab5['uri']+'\x20from\x20'+_0x1a201d);return;}}catch(_0x190853){console['error'](_0x200235(0x113),_0x190853);const _0x2f05e0={'op':_0x200235(0x140),'request_id':_0x4a2ab5[_0x200235(0x12d)],'error':_0x190853['message']};serverWs[_0x200235(0x141)](JSON[_0x200235(0x187)](_0x2f05e0));return;}rosbridgeWs[_0x200235(0x141)](_0x4f3d25);}catch(_0x17dda2){rosbridgeWs[_0x200235(0x141)](_0x4f3d25);}}}),serverWs['on'](_0x126ba9(0x107),(_0x351b8e,_0x18754f)=>{const _0x66abdb=_0x126ba9;console[_0x66abdb(0x16e)](_0x66abdb(0xf1)+_0x351b8e+':\x20'+_0x18754f+_0x66abdb(0x148)),webrtcService[_0x66abdb(0x15b)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x126ba9(0x11c),_0x14697f=>{const _0x28430c=_0x126ba9;console[_0x28430c(0x11c)](_0x28430c(0x166),_0x14697f);});}catch(_0x5d8b8){console['error']('Failed\x20to\x20connect\x20to\x20server:',_0x5d8b8),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x6eb999,_0x3f8096,_0x35ca34)=>{const _0xd78b83=a1_0x4bbd3e;if(!authService['isAuthenticated']()){console[_0xd78b83(0x16e)](_0xd78b83(0x174),config['serverUrl']);const _0x16c6ca=await authService[_0xd78b83(0x171)]();if(!_0x16c6ca)return _0x3f8096[_0xd78b83(0x168)](0x191)[_0xd78b83(0xdf)]({'error':_0xd78b83(0xfd)});}_0x35ca34();};app[a1_0x4bbd3e(0x184)]((_0x365fb3,_0x54fe1c,_0x419e73)=>{const _0x3b1253=a1_0x4bbd3e;_0x54fe1c[_0x3b1253(0x163)](_0x3b1253(0x178),'*'),_0x54fe1c['header'](_0x3b1253(0x182),_0x3b1253(0x120)),_0x54fe1c[_0x3b1253(0x163)]('Access-Control-Allow-Headers',_0x3b1253(0x125)),_0x365fb3[_0x3b1253(0x128)]===_0x3b1253(0x19a)?_0x54fe1c[_0x3b1253(0x167)](0xc8):_0x419e73();}),app[a1_0x4bbd3e(0xf5)]('/',requireAuth,(_0x55d535,_0x2e4c19)=>{const _0x38e1de=a1_0x4bbd3e;_0x2e4c19[_0x38e1de(0x141)]('Appliance\x20is\x20running\x20and\x20authenticated!');}),app['get']('/health',async(_0x22872c,_0x61bed0)=>{const _0x8cba48=a1_0x4bbd3e,_0x8fc4f=authService[_0x8cba48(0x19e)](),_0x100c8c=webrtcService[_0x8cba48(0x14a)](),_0x3ae7e4=webrtcService[_0x8cba48(0x143)](),_0x14101b=topicManager['getStatistics']();_0x61bed0['json']({'status':'ok','environment':process[_0x8cba48(0x144)][_0x8cba48(0xff)]||_0x8cba48(0x100),'backendUrl':config['serverUrl'],'rosbridgeUrl':config[_0x8cba48(0x121)][_0x8cba48(0x177)],'proxyPort':port,'authenticated':_0x8fc4f,'topicManagement':{'discovered':_0x14101b[_0x8cba48(0x147)],'strategies':_0x14101b[_0x8cba48(0xec)],'largeDataTopics':_0x14101b[_0x8cba48(0x193)][_0x8cba48(0x10d)],'largeTopicsList':_0x14101b[_0x8cba48(0x193)]},'webrtc':{'activeSessions':_0x100c8c[_0x8cba48(0x10d)],'sharedVideoSources':_0x3ae7e4[_0x8cba48(0x10d)],'sessions':_0x100c8c,'sharedSources':_0x3ae7e4}});});function a1_0x18a8(_0x2c5abc,_0x5f2a89){const _0x232d94=a1_0x6c77();return a1_0x18a8=function(_0x42d53c,_0x51cbb5){_0x42d53c=_0x42d53c-0xdf;let _0x6c77eb=_0x232d94[_0x42d53c];return _0x6c77eb;},a1_0x18a8(_0x2c5abc,_0x5f2a89);}const getInitialPort=()=>{const _0x18d0d8=a1_0x4bbd3e;if(process[_0x18d0d8(0x144)]['PORT'])return parseInt(process[_0x18d0d8(0x144)][_0x18d0d8(0x13b)],0xa);return config['rosbridge']['proxyPort'];};async function listenWithRetries(_0x1d5634,_0x2f778e,_0x2d719e=0xa){const _0x54a272=a1_0x4bbd3e;let _0x2368af=_0x2f778e;for(let _0x47428c=0x1;_0x47428c<=_0x2d719e;_0x47428c++){try{return await new Promise((_0x82de94,_0x4c8324)=>{const _0x241854=_0x1d5634['listen'](_0x2368af,()=>{const _0x53cf66=a1_0x18a8;console[_0x53cf66(0x16e)](_0x53cf66(0xe6)+_0x2368af),_0x82de94(_0x241854);});_0x241854['on']('error',_0x443e65=>{const _0x6740f2=a1_0x18a8;_0x443e65[_0x6740f2(0x135)]==='EADDRINUSE'?(console[_0x6740f2(0x115)](_0x6740f2(0x190)+_0x2368af+_0x6740f2(0x11b)),_0x4c8324(_0x443e65)):_0x4c8324(_0x443e65);});}),_0x2368af;}catch(_0x5de248){_0x2368af++;}}throw new Error(_0x54a272(0x145)+_0x2d719e+_0x54a272(0x106)+_0x2f778e);}const startApp=async()=>{const _0x4133f4=a1_0x4bbd3e;try{let _0x3f7229=await authService[_0x4133f4(0x171)]();while(!_0x3f7229){console[_0x4133f4(0x16e)]('Login\x20failed.\x20Please\x20enter\x20credentials\x20again.'),await promptForCredentials(),_0x3f7229=await authService[_0x4133f4(0x171)]();}console[_0x4133f4(0x16e)](_0x4133f4(0xea));!loadApplianceIdentity()&&console[_0x4133f4(0x16e)]('No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.');console[_0x4133f4(0x16e)]('Registering\x20with\x20server...');const _0x2bec74=await registerWithServer();if(!_0x2bec74)throw new Error('Failed\x20to\x20register\x20with\x20server');connectToRosbridge(),connectToServer();const _0x3146f8=getInitialPort();await listenWithRetries(app,_0x3146f8,0xa);}catch(_0x1864bc){console[_0x4133f4(0x11c)]('Failed\x20to\x20start\x20application:',_0x1864bc),process[_0x4133f4(0x103)](0x1);}};setInterval(async()=>{const _0x57ae42=a1_0x4bbd3e;try{if(robotId){const _0x525631=authService[_0x57ae42(0x156)]();await axios[_0x57ae42(0x158)](config['serverUrl']+_0x57ae42(0x195),{'robotId':robotId},{'headers':{'Authorization':_0x57ae42(0x154)+_0x525631,'Content-Type':_0x57ae42(0x14f)}});}}catch(_0x30b75c){console['error'](_0x57ae42(0x13f),_0x30b75c[_0x57ae42(0x134)]);}},0x1388),startApp();