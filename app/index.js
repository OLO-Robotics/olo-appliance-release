const a1_0x3e177b=a1_0x25ce;(function(_0x4e6a6e,_0x28a9e7){const _0xe53ccd=a1_0x25ce,_0x1c953c=_0x4e6a6e();while(!![]){try{const _0x238e14=-parseInt(_0xe53ccd(0x1d8))/0x1*(parseInt(_0xe53ccd(0x206))/0x2)+-parseInt(_0xe53ccd(0x1ef))/0x3*(-parseInt(_0xe53ccd(0x173))/0x4)+-parseInt(_0xe53ccd(0x218))/0x5*(parseInt(_0xe53ccd(0x1be))/0x6)+-parseInt(_0xe53ccd(0x20b))/0x7*(parseInt(_0xe53ccd(0x20c))/0x8)+-parseInt(_0xe53ccd(0x1e0))/0x9*(-parseInt(_0xe53ccd(0x207))/0xa)+parseInt(_0xe53ccd(0x170))/0xb*(parseInt(_0xe53ccd(0x169))/0xc)+parseInt(_0xe53ccd(0x1ff))/0xd*(parseInt(_0xe53ccd(0x1f4))/0xe);if(_0x238e14===_0x28a9e7)break;else _0x1c953c['push'](_0x1c953c['shift']());}catch(_0xb8e3b2){_0x1c953c['push'](_0x1c953c['shift']());}}}(a1_0x1d1d,0x205d2));const a1_0x1d4786=(function(){let _0x2d0d58=!![];return function(_0x315aa3,_0x23d0d6){const _0x367e73=_0x2d0d58?function(){const _0x4d149b=a1_0x25ce;if(_0x23d0d6){const _0x20211a=_0x23d0d6[_0x4d149b(0x19c)](_0x315aa3,arguments);return _0x23d0d6=null,_0x20211a;}}:function(){};return _0x2d0d58=![],_0x367e73;};}()),a1_0x283946=a1_0x1d4786(this,function(){const _0x19aa79=a1_0x25ce;return a1_0x283946[_0x19aa79(0x199)]()[_0x19aa79(0x19e)](_0x19aa79(0x1b4))[_0x19aa79(0x199)]()[_0x19aa79(0x1d2)](a1_0x283946)[_0x19aa79(0x19e)](_0x19aa79(0x1b4));});a1_0x283946();const dotenv=require('dotenv');dotenv[a1_0x3e177b(0x220)]();const express=require(a1_0x3e177b(0x16e)),config=require(a1_0x3e177b(0x21e));function a1_0x25ce(_0x2f0f21,_0x3e6663){const _0x2e6983=a1_0x1d1d();return a1_0x25ce=function(_0x283946,_0x1d4786){_0x283946=_0x283946-0x155;let _0x1d1de6=_0x2e6983[_0x283946];return _0x1d1de6;},a1_0x25ce(_0x2f0f21,_0x3e6663);}process[a1_0x3e177b(0x20a)][a1_0x3e177b(0x1df)]&&process[a1_0x3e177b(0x20a)][a1_0x3e177b(0x1de)]&&(config[a1_0x3e177b(0x1cb)][a1_0x3e177b(0x1fb)]=process['env'][a1_0x3e177b(0x1df)],config[a1_0x3e177b(0x1cb)][a1_0x3e177b(0x1dc)]=process['env'][a1_0x3e177b(0x1de)],console[a1_0x3e177b(0x186)](a1_0x3e177b(0x222)));const authService=require('./services/auth'),webrtcService=require(a1_0x3e177b(0x1e1)),topicManager=require(a1_0x3e177b(0x213)),WebSocket=require('ws'),axios=require(a1_0x3e177b(0x184)),fs=require('fs'),prompt=require(a1_0x3e177b(0x18a))({'sigint':!![]}),app=express(),port=process[a1_0x3e177b(0x20a)]['PORT']||config[a1_0x3e177b(0x225)][a1_0x3e177b(0x1e9)],APPLIANCE_FILE=a1_0x3e177b(0x19b),{DOMParser,XMLSerializer}=require(a1_0x3e177b(0x21f)),path=require(a1_0x3e177b(0x214)),{execSync}=require('child_process'),APPLIANCE_BASE_URL=process[a1_0x3e177b(0x20a)][a1_0x3e177b(0x1d9)]||'';console['log'](a1_0x3e177b(0x18b)+(process[a1_0x3e177b(0x20a)][a1_0x3e177b(0x211)]||a1_0x3e177b(0x191))),console['log']('Backend\x20Server\x20URL:\x20'+config[a1_0x3e177b(0x1bb)]),console[a1_0x3e177b(0x186)](a1_0x3e177b(0x1e2)+config[a1_0x3e177b(0x225)][a1_0x3e177b(0x180)]),console[a1_0x3e177b(0x186)](a1_0x3e177b(0x208)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x1a3aae,_0xd1e104){const _0x6b1120=a1_0x3e177b;fs[_0x6b1120(0x162)](_0x6b1120(0x166),_0x6b1120(0x1c0)+_0x1a3aae+_0x6b1120(0x1bf)+_0xd1e104+'\x0a');}function reloadEnv(){const _0x2b8e7b=a1_0x3e177b;dotenv['config']({'override':!![]}),config[_0x2b8e7b(0x1cb)][_0x2b8e7b(0x1fb)]=process[_0x2b8e7b(0x20a)][_0x2b8e7b(0x1df)],config['credentials']['password']=process[_0x2b8e7b(0x20a)][_0x2b8e7b(0x1de)],console[_0x2b8e7b(0x186)]('Loaded\x20credentials:',{'username':config['credentials'][_0x2b8e7b(0x1fb)]?'SET':_0x2b8e7b(0x194),'password':config[_0x2b8e7b(0x1cb)][_0x2b8e7b(0x1dc)]?'SET':_0x2b8e7b(0x194)});}async function promptForCredentials(){const _0x49aee5=a1_0x3e177b;process[_0x49aee5(0x20a)]['NODE_ENV']===_0x49aee5(0x196)&&(console[_0x49aee5(0x15d)](_0x49aee5(0x18f)),console['error'](_0x49aee5(0x1d1)),process[_0x49aee5(0x16b)](0x1));const _0x28c8ca=prompt(_0x49aee5(0x1a5)),_0x3174f8=prompt[_0x49aee5(0x1ed)]('Enter\x20password:\x20');updateEnvFile(_0x28c8ca,_0x3174f8),reloadEnv();}function loadApplianceIdentity(){const _0x508523=a1_0x3e177b;if(fs[_0x508523(0x1a0)](APPLIANCE_FILE))try{const _0x3baa23=JSON['parse'](fs[_0x508523(0x1b5)](APPLIANCE_FILE,'utf8'));if(_0x3baa23[_0x508523(0x1d0)]&&_0x3baa23['registrationToken'])return robotId=_0x3baa23[_0x508523(0x1d0)],registrationToken=_0x3baa23[_0x508523(0x19d)],console[_0x508523(0x186)](_0x508523(0x1f2),robotId),topicManager[_0x508523(0x1fd)](_0x3baa23),!![];}catch(_0x15c477){console[_0x508523(0x15d)](_0x508523(0x216),_0x15c477);}return![];}function saveApplianceIdentity(_0x4cf02d,_0x41b27b){const _0x23f054=a1_0x3e177b;let _0x2ddad8={};if(fs[_0x23f054(0x1a0)](APPLIANCE_FILE))try{_0x2ddad8=JSON[_0x23f054(0x195)](fs['readFileSync'](APPLIANCE_FILE,_0x23f054(0x155)));}catch(_0x83be90){_0x2ddad8={};}_0x2ddad8[_0x23f054(0x1d0)]=_0x4cf02d,_0x2ddad8[_0x23f054(0x19d)]=_0x41b27b,fs[_0x23f054(0x162)](APPLIANCE_FILE,JSON[_0x23f054(0x1e3)](_0x2ddad8,null,0x2));}function a1_0x1d1d(){const _0x28909d=['readyState','wsEndpoint','sendStatus','getToken','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','axios','application/json','log','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','estimatedSize','samplingRate','prompt-sync','Environment:\x20','get_mesh','initialize','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file','urdf_param_data','development','stopAllSessions','name','NOT\x20SET','parse','production','get_urdf_param','OPTIONS','toString','data','.appliance.json','apply','registrationToken','search','post','existsSync','substring','Successfully\x20logged\x20in','registration_token','get','Enter\x20username:\x20','handleMessage','unlinkSync','topics','warn','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','reason','/robot_description','.mesh','EADDRINUSE','Connected\x20to\x20ROSBridge\x20(WebRTC)','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','string','/health','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','(((.+)+)+)+$','readFileSync','.ply','Port\x20','Access-Control-Allow-Methods','includes','/rosbridge?type=appliance&token=','serverUrl','sample','Bearer\x20','571278agoEuc','\x0aAPP_PASSWORD=','APP_USERNAME=','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','method','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','use','open','Appliance\x20is\x20running\x20and\x20authenticated!','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','strategies','ros2\x20pkg\x20prefix\x20','\x20from\x20','credentials','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','send','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','.stl','robotId','Please\x20run:\x20./setup.sh\x20reconfigure','constructor','strategy','ROSBridge\x20(main)\x20connection\x20error:','Failed\x20to\x20start\x20application:','Access-Control-Allow-Headers','unknown','6151TzgZIo','APPLIANCE_BASE_URL','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','publish','password','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','APP_PASSWORD','APP_USERNAME','639iGIocU','./services/webrtcService','ROSBridge\x20WebSocket\x20URL:\x20','stringify','sample_skip','ros2\x20param\x20get\x20','PORT','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','isAuthenticated','proxyPort','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','OPEN','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','hide','toLowerCase','30471APbusS','request_id','roslib','Loaded\x20appliance\x20identity:','parseFromString','2310WXydFa','Registering\x20with\x20server...','Attempting\x20to\x20login\x20to:','startsWith','getActiveSessions','share','getAttribute','username','length','loadConfig','\x20->\x20','31499KxJPPi','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','trim','package://','slice','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','/ros/mesh?uri=','74ZkoYqo','740tSiDEO','Proxy\x20listening\x20on\x20port:\x20','\x20in\x20use,\x20trying\x20next\x20port...','env','897491BzmSsy','8FTwHre','filename','msg','values','Server\x20connection\x20error:','NODE_ENV','[MESH]\x20Error\x20serving\x20mesh:','./services/TopicManager','path','call_service','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','forward','10EKMNEA','uri','totalTopics','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','close','Authentication\x20required','./config','xmldom','config','base64','Initial\x20credentials\x20loaded\x20from\x20environment','getTopicStrategy','service_response','rosbridge','utf8','param_name','getStatistics','Disconnected\x20from\x20server\x20(','listen','/rosapi/topics','join','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','error','Failed\x20to\x20register\x20with\x20server:','[MESH]\x20Successfully\x20served\x20mesh:\x20','WSL\x20Appliance','topic','writeFileSync','Ros','mesh','getSharedVideoSources','.env','mesh_data','message','3576KcgEum','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','exit','discoverTopics','webrtc_skip','express','Mesh\x20file\x20not\x20found:\x20','7480QmSlEA','replace','String\x20value\x20is:\x20','28ThjtAN','some','login','\x20of\x20','action','types','getElementsByTagName','header','largeDataTopics','serializeToString','json','map'];a1_0x1d1d=function(){return _0x28909d;};return a1_0x1d1d();}async function registerWithServer(){const _0x49deb4=a1_0x3e177b;try{const _0x5c1671=authService['getToken']();if(!_0x5c1671)throw new Error('Not\x20authenticated');let _0x74d99e,_0x5abfa3=![];while(!![]){try{robotId&&registrationToken?_0x74d99e=await axios[_0x49deb4(0x19f)](config[_0x49deb4(0x1bb)]+'/appliance/register',{'name':_0x49deb4(0x160),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x49deb4(0x1bd)+_0x5c1671,'Content-Type':_0x49deb4(0x185)}}):_0x74d99e=await axios[_0x49deb4(0x19f)](config['serverUrl']+'/appliance/register',{'name':_0x49deb4(0x160)},{'headers':{'Authorization':_0x49deb4(0x1bd)+_0x5c1671,'Content-Type':_0x49deb4(0x185)}});break;}catch(_0x4cec93){const _0x41b67a=_0x4cec93?.['response']?.[_0x49deb4(0x19a)]?.[_0x49deb4(0x15d)]||_0x4cec93['message'];if(!_0x5abfa3&&_0x41b67a&&_0x41b67a[_0x49deb4(0x1ee)]()[_0x49deb4(0x1b9)]('robot\x20not\x20found')){console[_0x49deb4(0x1a9)](_0x49deb4(0x1aa));if(fs[_0x49deb4(0x1a0)](APPLIANCE_FILE))fs[_0x49deb4(0x1a7)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x5abfa3=!![];continue;}throw _0x4cec93;}}if(!_0x74d99e[_0x49deb4(0x19a)]||!_0x74d99e[_0x49deb4(0x19a)][_0x49deb4(0x1a3)]||!_0x74d99e[_0x49deb4(0x19a)]['id'])throw new Error(_0x49deb4(0x1c7));return registrationToken=_0x74d99e[_0x49deb4(0x19a)][_0x49deb4(0x1a3)],robotId=_0x74d99e['data']['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x49deb4(0x186)]('Successfully\x20registered\x20with\x20server'),!![];}catch(_0x40cc04){return console['error'](_0x49deb4(0x15e),_0x40cc04[_0x49deb4(0x168)]),![];}}function rewriteUrdfMeshUris(_0x1d07ff){const _0x4345a1=a1_0x3e177b;try{const _0x3797fe=new DOMParser(),_0x2a64e7=_0x3797fe[_0x4345a1(0x1f3)](_0x1d07ff,'text/xml');let _0x1ac169=0x0,_0x484dd3=0x0;const _0x48825e=_0x2a64e7[_0x4345a1(0x179)](_0x4345a1(0x164));for(let _0x5d21ff=0x0;_0x5d21ff<_0x48825e[_0x4345a1(0x1fc)];_0x5d21ff++){const _0x30d058=_0x48825e[_0x5d21ff],_0x58e556=_0x30d058[_0x4345a1(0x1fa)](_0x4345a1(0x20d)),_0x18aebb=[_0x4345a1(0x1cf),'.dae','.obj',_0x4345a1(0x1b6),_0x4345a1(0x1ad)],_0x4e49c3=_0x18aebb[_0x4345a1(0x174)](_0x1e948a=>_0x58e556['toLowerCase']()['endsWith'](_0x1e948a));if(_0x58e556&&_0x58e556[_0x4345a1(0x1f7)](_0x4345a1(0x202))&&_0x4e49c3){_0x1ac169++;const _0x1810a1=APPLIANCE_BASE_URL+_0x4345a1(0x205)+encodeURIComponent(_0x58e556);_0x30d058['setAttribute'](_0x4345a1(0x20d),_0x1810a1),_0x484dd3++,console[_0x4345a1(0x186)]('[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20'+_0x58e556+_0x4345a1(0x1fe)+_0x1810a1);}}_0x1ac169>0x0?console['log']('[URDF\x20REWRITE]\x20Rewrote\x20'+_0x484dd3+_0x4345a1(0x176)+_0x1ac169+_0x4345a1(0x18e)):console[_0x4345a1(0x186)](_0x4345a1(0x1e7));const _0x5c40cc=new XMLSerializer();return _0x5c40cc[_0x4345a1(0x17c)](_0x2a64e7);}catch(_0x497fa6){return console[_0x4345a1(0x15d)](_0x4345a1(0x187),_0x497fa6),_0x1d07ff;}}function connectToRosbridge(){const _0x46bc59=a1_0x3e177b;try{rosbridgeWs=new WebSocket(config[_0x46bc59(0x225)][_0x46bc59(0x180)]),rosbridgeWs['on'](_0x46bc59(0x1c5),()=>{const _0x47a337=_0x46bc59;console[_0x47a337(0x186)]('Connected\x20to\x20ROSBridge\x20(main)');const _0x491e56=require(_0x47a337(0x1f1)),_0x3657d6=new _0x491e56[(_0x47a337(0x163))]({'url':config[_0x47a337(0x225)]['wsEndpoint']});_0x3657d6['on']('connection',()=>{setTimeout(()=>{const _0x22b28f=a1_0x25ce;topicManager[_0x22b28f(0x16c)](_0x3657d6)['catch'](_0x3b2477=>{console['error']('Topic\x20discovery\x20failed:',_0x3b2477);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on']('message',_0x407772=>{const _0x2109d3=_0x46bc59;if(serverWs&&serverWs[_0x2109d3(0x17f)]===WebSocket[_0x2109d3(0x1eb)]){let _0x18c1a9=_0x407772['toString']();try{const _0x18bda6=JSON['parse'](_0x18c1a9);if(_0x18bda6['op']==='publish'&&_0x18bda6[_0x2109d3(0x161)]){const _0x2c0c42=topicManager['handleMessage'](_0x18bda6);switch(_0x2c0c42[_0x2109d3(0x177)]){case _0x2109d3(0x1e4):return;case _0x2109d3(0x16d):return;case _0x2109d3(0x217):default:_0x18c1a9=JSON[_0x2109d3(0x1e3)](_0x2c0c42[_0x2109d3(0x168)]);break;}}if((_0x18bda6['op']===_0x2109d3(0x224)||_0x18bda6['op']===_0x2109d3(0x215))&&(_0x18bda6['service']===_0x2109d3(0x15a)||_0x18bda6[_0x2109d3(0x20f)]&&_0x18bda6[_0x2109d3(0x20f)][_0x2109d3(0x1a8)])){console[_0x2109d3(0x186)](_0x2109d3(0x16a));const _0x4d2864=_0x18bda6[_0x2109d3(0x20f)]?.[_0x2109d3(0x1a8)]||[],_0x4684b7=_0x18bda6[_0x2109d3(0x20f)]?.[_0x2109d3(0x178)]||[],_0x40fe3b=_0x4d2864[_0x2109d3(0x17e)]((_0x5b5637,_0x156329)=>{const _0x57fe25=_0x2109d3,_0xdc80b8=topicManager[_0x57fe25(0x223)](_0x5b5637);return{'name':_0x5b5637,'type':_0x4684b7[_0x156329]||_0x57fe25(0x1d7),'throttling':_0xdc80b8?{'isThrottled':_0xdc80b8[_0x57fe25(0x1d3)]===_0x57fe25(0x1bc),'strategy':_0xdc80b8[_0x57fe25(0x1d3)],'samplingRate':_0xdc80b8[_0x57fe25(0x189)],'reason':_0xdc80b8[_0x57fe25(0x1ab)],'estimatedSize':_0xdc80b8[_0x57fe25(0x188)]}:null};});_0x18bda6[_0x2109d3(0x20f)]={'topics':_0x40fe3b[_0x2109d3(0x17e)](_0xb2c7e3=>_0xb2c7e3[_0x2109d3(0x193)]),'types':_0x40fe3b[_0x2109d3(0x17e)](_0x20928b=>_0x20928b['type']),'throttling':_0x40fe3b['map'](_0x4b7c39=>_0x4b7c39['throttling'])},_0x18c1a9=JSON[_0x2109d3(0x1e3)](_0x18bda6),console[_0x2109d3(0x186)](_0x2109d3(0x1c3));}if(_0x18bda6['op']===_0x2109d3(0x1db)&&_0x18bda6['topic']===_0x2109d3(0x1ac))try{const _0x56b5cb=_0x18bda6[_0x2109d3(0x20e)][_0x2109d3(0x19a)],_0x3e2547=rewriteUrdfMeshUris(_0x56b5cb);_0x18bda6[_0x2109d3(0x20e)][_0x2109d3(0x19a)]=_0x3e2547,_0x18c1a9=JSON['stringify'](_0x18bda6);}catch(_0x3a1969){console[_0x2109d3(0x15d)](_0x2109d3(0x1ec),_0x3a1969);}}catch(_0x40ebd8){console[_0x2109d3(0x1a9)](_0x2109d3(0x1ce),_0x40ebd8[_0x2109d3(0x168)]);}serverWs[_0x2109d3(0x1cd)](_0x18c1a9);}}),rosbridgeWs['on'](_0x46bc59(0x21c),()=>{const _0x2a680c=_0x46bc59;console[_0x2a680c(0x186)](_0x2a680c(0x1b0)),webrtcService[_0x2a680c(0x192)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on']('error',_0x3a8e4f=>{const _0x2409c5=_0x46bc59;console[_0x2409c5(0x15d)](_0x2409c5(0x1d4),_0x3a8e4f);});}catch(_0x596138){console['error'](_0x46bc59(0x1b3),_0x596138),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x16a2b4=a1_0x3e177b;try{rosbridgeWebRTCWs=new WebSocket(config['rosbridge'][_0x16a2b4(0x180)]),rosbridgeWebRTCWs['on']('open',()=>{const _0x143421=_0x16a2b4;console[_0x143421(0x186)](_0x143421(0x1af)),webrtcService[_0x143421(0x18d)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x16a2b4(0x168),_0x586e94=>{}),rosbridgeWebRTCWs['on']('close',()=>{const _0x34ef83=_0x16a2b4;console['log'](_0x34ef83(0x204)),webrtcService[_0x34ef83(0x192)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x16a2b4(0x15d),_0x2fdbd0=>{const _0x5af243=_0x16a2b4;console[_0x5af243(0x15d)]('ROSBridge\x20(WebRTC)\x20connection\x20error:',_0x2fdbd0);});}catch(_0x2e733d){console[_0x16a2b4(0x15d)](_0x16a2b4(0x200),_0x2e733d),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x377cc1=a1_0x3e177b;try{if(!registrationToken)throw new Error(_0x377cc1(0x183));const _0x9b2783=config['serverUrl']['replace']('http','ws')+_0x377cc1(0x1ba)+registrationToken;serverWs=new WebSocket(_0x9b2783),serverWs['on'](_0x377cc1(0x1c5),()=>{const _0x734d12=_0x377cc1;console[_0x734d12(0x186)]('Connected\x20to\x20server'),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x734d12(0x17f)]===WebSocket['OPEN']&&webrtcService[_0x734d12(0x18d)](rosbridgeWebRTCWs,serverWs);}),serverWs['on']('message',_0x529e44=>{const _0xb5dc44=_0x377cc1;if(rosbridgeWs&&rosbridgeWs['readyState']===WebSocket[_0xb5dc44(0x1eb)]){let _0x318208=_0x529e44[_0xb5dc44(0x199)]();try{const _0x5a2435=JSON[_0xb5dc44(0x195)](_0x318208);if(webrtcService[_0xb5dc44(0x1a6)](_0x5a2435))return;if(_0x5a2435['op']===_0xb5dc44(0x197)&&typeof _0x5a2435[_0xb5dc44(0x156)]===_0xb5dc44(0x1b1)&&_0x5a2435[_0xb5dc44(0x1f0)])try{console[_0xb5dc44(0x186)](_0xb5dc44(0x1dd)+_0x5a2435[_0xb5dc44(0x156)]);const _0x682af6=execSync(_0xb5dc44(0x1e5)+_0x5a2435[_0xb5dc44(0x156)],{'encoding':_0xb5dc44(0x155)})[_0xb5dc44(0x201)]();let _0x39884e=_0x682af6;_0x682af6[_0xb5dc44(0x1f7)](_0xb5dc44(0x172))&&(_0x39884e=_0x682af6[_0xb5dc44(0x1a1)](_0xb5dc44(0x172)['length']()));_0x39884e[_0xb5dc44(0x1f7)]('\x22')&&_0x39884e['endsWith']('\x22')&&(_0x39884e=_0x39884e[_0xb5dc44(0x203)](0x1,-0x1));_0x39884e=_0x39884e[_0xb5dc44(0x171)](/\\n/g,'\x0a')[_0xb5dc44(0x171)](/\\"/g,'\x22');const _0x22579a={'op':_0xb5dc44(0x190),'request_id':_0x5a2435[_0xb5dc44(0x1f0)],'data':_0x39884e};serverWs[_0xb5dc44(0x1cd)](JSON['stringify'](_0x22579a)),console[_0xb5dc44(0x186)](_0xb5dc44(0x15c)+_0x5a2435[_0xb5dc44(0x156)]);return;}catch(_0x1529cd){console[_0xb5dc44(0x15d)]('[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:',_0x1529cd);const _0x469490={'op':_0xb5dc44(0x190),'request_id':_0x5a2435[_0xb5dc44(0x1f0)],'error':_0x1529cd[_0xb5dc44(0x168)]};serverWs[_0xb5dc44(0x1cd)](JSON['stringify'](_0x469490));return;}if(_0x5a2435['op']===_0xb5dc44(0x18c)&&typeof _0x5a2435[_0xb5dc44(0x219)]===_0xb5dc44(0x1b1)&&_0x5a2435['request_id'])try{const _0x485cc4=_0x5a2435[_0xb5dc44(0x219)]['match'](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x485cc4){const _0x3b9392=_0x485cc4[0x1],_0x50ac36=_0x485cc4[0x2],_0x5c9d9c=execSync(_0xb5dc44(0x1c9)+_0x3b9392,{'encoding':'utf8'})['trim'](),_0x49620d=path[_0xb5dc44(0x15b)](_0x5c9d9c,_0xb5dc44(0x1f9),_0x3b9392,_0x50ac36);if(!fs[_0xb5dc44(0x1a0)](_0x49620d))throw new Error(_0xb5dc44(0x16f)+_0x49620d);const _0x5d3e04=fs['readFileSync'](_0x49620d),_0x4e993f={'op':'mesh_data','request_id':_0x5a2435['request_id'],'data':_0x5d3e04[_0xb5dc44(0x199)](_0xb5dc44(0x221))};serverWs[_0xb5dc44(0x1cd)](JSON[_0xb5dc44(0x1e3)](_0x4e993f)),console[_0xb5dc44(0x186)](_0xb5dc44(0x15f)+_0x5a2435['uri']+_0xb5dc44(0x1ca)+_0x49620d);return;}}catch(_0x3ebfa8){console[_0xb5dc44(0x15d)](_0xb5dc44(0x212),_0x3ebfa8);const _0x43164e={'op':_0xb5dc44(0x167),'request_id':_0x5a2435[_0xb5dc44(0x1f0)],'error':_0x3ebfa8['message']};serverWs[_0xb5dc44(0x1cd)](JSON[_0xb5dc44(0x1e3)](_0x43164e));return;}rosbridgeWs[_0xb5dc44(0x1cd)](_0x318208);}catch(_0x5bee11){rosbridgeWs['send'](_0x318208);}}}),serverWs['on'](_0x377cc1(0x21c),(_0x553940,_0x31d8e6)=>{const _0x511b66=_0x377cc1;console[_0x511b66(0x186)](_0x511b66(0x158)+_0x553940+':\x20'+_0x31d8e6+'),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x511b66(0x192)](),setTimeout(connectToServer,0x1388);}),serverWs['on']('error',_0x4c31b3=>{const _0x57b4c4=_0x377cc1;console[_0x57b4c4(0x15d)](_0x57b4c4(0x210),_0x4c31b3);});}catch(_0x3365f3){console['error']('Failed\x20to\x20connect\x20to\x20server:',_0x3365f3),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x1b2c28,_0x4784e6,_0x42de2e)=>{const _0x37bebb=a1_0x3e177b;if(!authService[_0x37bebb(0x1e8)]()){console[_0x37bebb(0x186)](_0x37bebb(0x1f6),config[_0x37bebb(0x1bb)]);const _0x5d8c6f=await authService[_0x37bebb(0x175)]();if(!_0x5d8c6f)return _0x4784e6['status'](0x191)[_0x37bebb(0x17d)]({'error':_0x37bebb(0x21d)});}_0x42de2e();};app[a1_0x3e177b(0x1c4)]((_0x55d302,_0x1a97b2,_0x53ce9d)=>{const _0x2f09fb=a1_0x3e177b;_0x1a97b2[_0x2f09fb(0x17a)]('Access-Control-Allow-Origin','*'),_0x1a97b2['header'](_0x2f09fb(0x1b8),'GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS'),_0x1a97b2[_0x2f09fb(0x17a)](_0x2f09fb(0x1d6),_0x2f09fb(0x1ea)),_0x55d302[_0x2f09fb(0x1c2)]===_0x2f09fb(0x198)?_0x1a97b2[_0x2f09fb(0x181)](0xc8):_0x53ce9d();}),app['get']('/',requireAuth,(_0x12c703,_0x4888da)=>{const _0x1f9936=a1_0x3e177b;_0x4888da[_0x1f9936(0x1cd)](_0x1f9936(0x1c6));}),app[a1_0x3e177b(0x1a4)](a1_0x3e177b(0x1b2),async(_0x251807,_0x31e452)=>{const _0xb1362f=a1_0x3e177b,_0x1b3078=authService['isAuthenticated'](),_0x3671da=webrtcService[_0xb1362f(0x1f8)](),_0x506311=webrtcService[_0xb1362f(0x165)](),_0x19b4a0=topicManager[_0xb1362f(0x157)]();_0x31e452[_0xb1362f(0x17d)]({'status':'ok','environment':process['env'][_0xb1362f(0x211)]||_0xb1362f(0x191),'backendUrl':config['serverUrl'],'rosbridgeUrl':config[_0xb1362f(0x225)][_0xb1362f(0x180)],'proxyPort':port,'authenticated':_0x1b3078,'topicManagement':{'discovered':_0x19b4a0[_0xb1362f(0x21a)],'strategies':_0x19b4a0[_0xb1362f(0x1c8)],'largeDataTopics':_0x19b4a0[_0xb1362f(0x17b)][_0xb1362f(0x1fc)],'largeTopicsList':_0x19b4a0[_0xb1362f(0x17b)]},'webrtc':{'activeSessions':_0x3671da['length'],'sharedVideoSources':_0x506311['length'],'sessions':_0x3671da,'sharedSources':_0x506311}});});const getInitialPort=()=>{const _0x775fbe=a1_0x3e177b;if(process['env']['PORT'])return parseInt(process[_0x775fbe(0x20a)][_0x775fbe(0x1e6)],0xa);return config[_0x775fbe(0x225)][_0x775fbe(0x1e9)];};async function listenWithRetries(_0x341225,_0x53a3f7,_0x1a21e8=0xa){const _0xc57d7=a1_0x3e177b;let _0x156398=_0x53a3f7;for(let _0x4517cc=0x1;_0x4517cc<=_0x1a21e8;_0x4517cc++){try{return await new Promise((_0x4cd1bd,_0x24ffdd)=>{const _0x4daa13=a1_0x25ce,_0x3ed0e6=_0x341225[_0x4daa13(0x159)](_0x156398,()=>{const _0x3e3498=_0x4daa13;console[_0x3e3498(0x186)](_0x3e3498(0x1cc)+_0x156398),_0x4cd1bd(_0x3ed0e6);});_0x3ed0e6['on'](_0x4daa13(0x15d),_0x1c3687=>{const _0x5111ff=_0x4daa13;_0x1c3687['code']===_0x5111ff(0x1ae)?(console[_0x5111ff(0x1a9)](_0x5111ff(0x1b7)+_0x156398+_0x5111ff(0x209)),_0x24ffdd(_0x1c3687)):_0x24ffdd(_0x1c3687);});}),_0x156398;}catch(_0x14009){_0x156398++;}}throw new Error(_0xc57d7(0x1c1)+_0x1a21e8+'\x20attempts\x20starting\x20from\x20'+_0x53a3f7);}const startApp=async()=>{const _0xb6a5e3=a1_0x3e177b;try{reloadEnv();let _0xe4e6b1=await authService['login']();while(!_0xe4e6b1){console['log'](_0xb6a5e3(0x21b)),await promptForCredentials(),_0xe4e6b1=await authService[_0xb6a5e3(0x175)]();}console[_0xb6a5e3(0x186)](_0xb6a5e3(0x1a2));!loadApplianceIdentity()&&console[_0xb6a5e3(0x186)](_0xb6a5e3(0x1da));console[_0xb6a5e3(0x186)](_0xb6a5e3(0x1f5));const _0x530d97=await registerWithServer();if(!_0x530d97)throw new Error('Failed\x20to\x20register\x20with\x20server');connectToRosbridge(),connectToServer();const _0x2b095c=getInitialPort();await listenWithRetries(app,_0x2b095c,0xa);}catch(_0x2edf95){console[_0xb6a5e3(0x15d)](_0xb6a5e3(0x1d5),_0x2edf95),process[_0xb6a5e3(0x16b)](0x1);}};setInterval(async()=>{const _0x52c0ef=a1_0x3e177b;try{if(robotId){const _0x38ecf6=authService[_0x52c0ef(0x182)]();await axios[_0x52c0ef(0x19f)](config[_0x52c0ef(0x1bb)]+'/appliance/ping',{'robotId':robotId},{'headers':{'Authorization':_0x52c0ef(0x1bd)+_0x38ecf6,'Content-Type':_0x52c0ef(0x185)}});}}catch(_0x881263){console[_0x52c0ef(0x15d)]('Failed\x20to\x20ping\x20server:',_0x881263[_0x52c0ef(0x168)]);}},0x1388),startApp();