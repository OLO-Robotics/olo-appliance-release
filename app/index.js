const a1_0x381e0e=a1_0x7bba;(function(_0x3c262c,_0x20337b){const _0x3e2de4=a1_0x7bba,_0xee4672=_0x3c262c();while(!![]){try{const _0x1d97b3=-parseInt(_0x3e2de4(0x128))/0x1*(parseInt(_0x3e2de4(0x192))/0x2)+parseInt(_0x3e2de4(0x1ca))/0x3*(-parseInt(_0x3e2de4(0x17d))/0x4)+parseInt(_0x3e2de4(0x129))/0x5*(parseInt(_0x3e2de4(0x14a))/0x6)+-parseInt(_0x3e2de4(0x126))/0x7*(parseInt(_0x3e2de4(0x188))/0x8)+parseInt(_0x3e2de4(0x18e))/0x9*(-parseInt(_0x3e2de4(0x1a6))/0xa)+parseInt(_0x3e2de4(0x132))/0xb+-parseInt(_0x3e2de4(0x1b3))/0xc*(-parseInt(_0x3e2de4(0x14d))/0xd);if(_0x1d97b3===_0x20337b)break;else _0xee4672['push'](_0xee4672['shift']());}catch(_0x299878){_0xee4672['push'](_0xee4672['shift']());}}}(a1_0x39e1,0x6ccc0));const a1_0x58a145=(function(){let _0x2cf9f3=!![];return function(_0x11f4ef,_0x3ea101){const _0x25ec0e=_0x2cf9f3?function(){if(_0x3ea101){const _0x1b0b7e=_0x3ea101['apply'](_0x11f4ef,arguments);return _0x3ea101=null,_0x1b0b7e;}}:function(){};return _0x2cf9f3=![],_0x25ec0e;};}()),a1_0x4280dc=a1_0x58a145(this,function(){const _0x1a4d78=a1_0x7bba;return a1_0x4280dc[_0x1a4d78(0x164)]()[_0x1a4d78(0x148)](_0x1a4d78(0x11b))[_0x1a4d78(0x164)]()[_0x1a4d78(0x1b2)](a1_0x4280dc)[_0x1a4d78(0x148)](_0x1a4d78(0x11b));});a1_0x4280dc();const express=require('express'),config=require(a1_0x381e0e(0x138)),authService=require(a1_0x381e0e(0x125)),webrtcService=require(a1_0x381e0e(0x1a5)),topicManager=require('./services/TopicManager'),WebSocket=require('ws'),axios=require(a1_0x381e0e(0x135)),fs=require('fs'),prompt=require(a1_0x381e0e(0x15c))({'sigint':!![]}),dotenv=require('dotenv'),app=express(),port=process[a1_0x381e0e(0x13c)][a1_0x381e0e(0x186)]||config[a1_0x381e0e(0x1ae)][a1_0x381e0e(0x1c3)],APPLIANCE_FILE='.appliance.json',{DOMParser,XMLSerializer}=require('xmldom'),path=require(a1_0x381e0e(0x121)),{execSync}=require(a1_0x381e0e(0x1c5)),APPLIANCE_BASE_URL=process[a1_0x381e0e(0x13c)][a1_0x381e0e(0x139)]||'';console[a1_0x381e0e(0x1bf)](a1_0x381e0e(0x177)+(process[a1_0x381e0e(0x13c)][a1_0x381e0e(0x1c8)]||a1_0x381e0e(0x1ce))),console['log']('Backend\x20Server\x20URL:\x20'+config[a1_0x381e0e(0x146)]),console['log']('ROSBridge\x20WebSocket\x20URL:\x20'+config['rosbridge']['wsEndpoint']),console[a1_0x381e0e(0x1bf)](a1_0x381e0e(0x17e)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x2a1ca9,_0xc70788){const _0x162f49=a1_0x381e0e;fs[_0x162f49(0x1aa)](_0x162f49(0x153),_0x162f49(0x1cc)+_0x2a1ca9+_0x162f49(0x1b0)+_0xc70788+'\x0a');}function reloadEnv(){const _0x2b6763=a1_0x381e0e;dotenv[_0x2b6763(0x197)]({'override':!![]}),config[_0x2b6763(0x16e)][_0x2b6763(0x12c)]=process[_0x2b6763(0x13c)]['APP_USERNAME'],config[_0x2b6763(0x16e)][_0x2b6763(0x12b)]=process['env'][_0x2b6763(0x14e)];}function a1_0x39e1(){const _0x1595bf=['estimatedSize','discoverTopics','registration_token','getElementsByTagName','ROSBridge\x20(WebRTC)\x20connection\x20error:','data','post','PORT','ROSBridge\x20(main)\x20connection\x20error:','80YSiImv','json','request_id','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','getActiveSessions','status','865233lcTvqQ','mesh','text/xml','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','332572JakVSv','join','trim','robotId','isAuthenticated','config','.ply','uri','Connected\x20to\x20ROSBridge\x20(main)','getToken','slice','mesh_data','readFileSync','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','Server\x20connection\x20error:','Disconnected\x20from\x20server\x20(','length','warn','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','./services/webrtcService','70BXLqhk','startsWith','String\x20value\x20is:\x20','parse','writeFileSync','service_response','Failed\x20to\x20start\x20application:','topic','rosbridge','\x20attempts\x20starting\x20from\x20','\x0aAPP_PASSWORD=','utf8','constructor','13111332eKXyGG','ros2\x20pkg\x20prefix\x20','),\x20attempting\x20to\x20reconnect...','Bearer\x20','Ros','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','type','application/json','exit','name','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','header','log','existsSync','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','listen','proxyPort','send','child_process','OPEN','Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file','NODE_ENV','get','3eRNJbj','urdf_param_data','APP_USERNAME=','match','development','serializeToString','string','Access-Control-Allow-Methods','Topic\x20discovery\x20failed:','\x20of\x20','loadConfig','/ros/mesh?uri=','error','Port\x20','strategies','Access-Control-Allow-Headers','Enter\x20password:\x20','(((.+)+)+)+$','replace','types','param_name','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','path','Failed\x20to\x20register\x20with\x20server','message','http','./services/auth','374962RnMDpy','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','2FJHwUh','10ZuMCto','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','password','username','stopAllSessions','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','[URDF\x20REWRITE]\x20Rewrote\x20','Access-Control-Allow-Origin','open','8359604fxOWZR','use','sample_skip','axios','includes','strategy','./config','APPLIANCE_BASE_URL','values','/rosbridge?type=appliance&token=','env','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','sendStatus','/appliance/ping','wsEndpoint','.mesh','msg','substring','stringify','service','serverUrl','robot\x20not\x20found','search','\x20->\x20','1088778ifyTSO','hide','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','13SDPTVE','APP_PASSWORD','largeDataTopics','method','.dae','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','.env','\x20in\x20use,\x20trying\x20next\x20port...','Authentication\x20required','close','handleMessage','login','parseFromString','[MESH]\x20Successfully\x20served\x20mesh:\x20','endsWith','prompt-sync','Attempting\x20to\x20login\x20to:','/rosapi/topics','map','WSL\x20Appliance','samplingRate','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','Successfully\x20registered\x20with\x20server','toString','readyState','getStatistics','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','webrtc_skip','filename','registrationToken','share','Registering\x20with\x20server...','credentials','get_mesh','getSharedVideoSources','/appliance/register','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','Please\x20run:\x20./setup.sh\x20reconfigure','action','some','[MESH]\x20Error\x20serving\x20mesh:','Environment:\x20','topics','call_service','/health','Connected\x20to\x20server','response','914712IQaCbZ','Proxy\x20listening\x20on\x20port:\x20'];a1_0x39e1=function(){return _0x1595bf;};return a1_0x39e1();}async function promptForCredentials(){const _0x2fea60=a1_0x381e0e;process[_0x2fea60(0x13c)][_0x2fea60(0x1c8)]==='production'&&(console[_0x2fea60(0x116)](_0x2fea60(0x1c7)),console[_0x2fea60(0x116)](_0x2fea60(0x173)),process[_0x2fea60(0x1bb)](0x1));const _0x32876d=prompt('Enter\x20username:\x20'),_0x46b8bb=prompt[_0x2fea60(0x14b)](_0x2fea60(0x11a));updateEnvFile(_0x32876d,_0x46b8bb),reloadEnv();}function loadApplianceIdentity(){const _0x3d714b=a1_0x381e0e;if(fs[_0x3d714b(0x1c0)](APPLIANCE_FILE))try{const _0x53c17b=JSON[_0x3d714b(0x1a9)](fs[_0x3d714b(0x19e)](APPLIANCE_FILE,'utf8'));if(_0x53c17b[_0x3d714b(0x195)]&&_0x53c17b['registrationToken'])return robotId=_0x53c17b[_0x3d714b(0x195)],registrationToken=_0x53c17b[_0x3d714b(0x16b)],console['log']('Loaded\x20appliance\x20identity:',robotId),topicManager[_0x3d714b(0x114)](_0x53c17b),!![];}catch(_0x5a69aa){console[_0x3d714b(0x116)](_0x3d714b(0x127),_0x5a69aa);}return![];}function saveApplianceIdentity(_0x29f336,_0x52cc33){const _0x1b4aff=a1_0x381e0e;let _0x565a74={};if(fs[_0x1b4aff(0x1c0)](APPLIANCE_FILE))try{_0x565a74=JSON['parse'](fs[_0x1b4aff(0x19e)](APPLIANCE_FILE,_0x1b4aff(0x1b1)));}catch(_0x48ee7b){_0x565a74={};}_0x565a74[_0x1b4aff(0x195)]=_0x29f336,_0x565a74[_0x1b4aff(0x16b)]=_0x52cc33,fs[_0x1b4aff(0x1aa)](APPLIANCE_FILE,JSON[_0x1b4aff(0x144)](_0x565a74,null,0x2));}async function registerWithServer(){const _0x342eb7=a1_0x381e0e;try{const _0x5e60b8=authService[_0x342eb7(0x19b)]();if(!_0x5e60b8)throw new Error('Not\x20authenticated');let _0x4d8b53,_0x4f6254=![];while(!![]){try{robotId&&registrationToken?_0x4d8b53=await axios[_0x342eb7(0x185)](config['serverUrl']+_0x342eb7(0x171),{'name':_0x342eb7(0x160),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':'Bearer\x20'+_0x5e60b8,'Content-Type':_0x342eb7(0x1ba)}}):_0x4d8b53=await axios[_0x342eb7(0x185)](config['serverUrl']+_0x342eb7(0x171),{'name':_0x342eb7(0x160)},{'headers':{'Authorization':_0x342eb7(0x1b6)+_0x5e60b8,'Content-Type':_0x342eb7(0x1ba)}});break;}catch(_0x319082){const _0x1fadc6=_0x319082?.[_0x342eb7(0x17c)]?.[_0x342eb7(0x184)]?.[_0x342eb7(0x116)]||_0x319082[_0x342eb7(0x123)];if(!_0x4f6254&&_0x1fadc6&&_0x1fadc6['toLowerCase']()[_0x342eb7(0x136)](_0x342eb7(0x147))){console['warn'](_0x342eb7(0x167));if(fs[_0x342eb7(0x1c0)](APPLIANCE_FILE))fs['unlinkSync'](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x4f6254=!![];continue;}throw _0x319082;}}if(!_0x4d8b53['data']||!_0x4d8b53[_0x342eb7(0x184)][_0x342eb7(0x181)]||!_0x4d8b53[_0x342eb7(0x184)]['id'])throw new Error(_0x342eb7(0x1a4));return registrationToken=_0x4d8b53['data'][_0x342eb7(0x181)],robotId=_0x4d8b53[_0x342eb7(0x184)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x342eb7(0x1bf)](_0x342eb7(0x163)),!![];}catch(_0x150490){return console[_0x342eb7(0x116)]('Failed\x20to\x20register\x20with\x20server:',_0x150490[_0x342eb7(0x123)]),![];}}function rewriteUrdfMeshUris(_0xcc342c){const _0x45106e=a1_0x381e0e;try{const _0x2e76f4=new DOMParser(),_0x174dc9=_0x2e76f4[_0x45106e(0x159)](_0xcc342c,_0x45106e(0x190));let _0x495cb2=0x0,_0x355daa=0x0;const _0x17555c=_0x174dc9[_0x45106e(0x182)](_0x45106e(0x18f));for(let _0x44859b=0x0;_0x44859b<_0x17555c[_0x45106e(0x1a2)];_0x44859b++){const _0xfb6b14=_0x17555c[_0x44859b],_0x5cf7ea=_0xfb6b14['getAttribute'](_0x45106e(0x16a)),_0x26bb02=['.stl',_0x45106e(0x151),'.obj',_0x45106e(0x198),_0x45106e(0x141)],_0x278342=_0x26bb02[_0x45106e(0x175)](_0x39a019=>_0x5cf7ea['toLowerCase']()['endsWith'](_0x39a019));if(_0x5cf7ea&&_0x5cf7ea[_0x45106e(0x1a7)]('package://')&&_0x278342){_0x495cb2++;const _0xbb316a=APPLIANCE_BASE_URL+_0x45106e(0x115)+encodeURIComponent(_0x5cf7ea);_0xfb6b14['setAttribute'](_0x45106e(0x16a),_0xbb316a),_0x355daa++,console[_0x45106e(0x1bf)]('[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20'+_0x5cf7ea+_0x45106e(0x149)+_0xbb316a);}}_0x495cb2>0x0?console[_0x45106e(0x1bf)](_0x45106e(0x12f)+_0x355daa+_0x45106e(0x113)+_0x495cb2+_0x45106e(0x152)):console['log'](_0x45106e(0x1b8));const _0x3ef5cd=new XMLSerializer();return _0x3ef5cd[_0x45106e(0x1cf)](_0x174dc9);}catch(_0x1c04e2){return console['error'](_0x45106e(0x1bd),_0x1c04e2),_0xcc342c;}}function a1_0x7bba(_0x33d537,_0x404877){const _0x24824e=a1_0x39e1();return a1_0x7bba=function(_0x4280dc,_0x58a145){_0x4280dc=_0x4280dc-0x110;let _0x39e172=_0x24824e[_0x4280dc];return _0x39e172;},a1_0x7bba(_0x33d537,_0x404877);}function connectToRosbridge(){const _0x5643ca=a1_0x381e0e;try{rosbridgeWs=new WebSocket(config['rosbridge'][_0x5643ca(0x140)]),rosbridgeWs['on'](_0x5643ca(0x131),()=>{const _0x43dbd0=_0x5643ca;console[_0x43dbd0(0x1bf)](_0x43dbd0(0x19a));const _0x263ac7=require('roslib'),_0xa79d7f=new _0x263ac7[(_0x43dbd0(0x1b7))]({'url':config['rosbridge']['wsEndpoint']});_0xa79d7f['on']('connection',()=>{setTimeout(()=>{const _0x44c375=a1_0x7bba;topicManager[_0x44c375(0x180)](_0xa79d7f)['catch'](_0x3ef1e6=>{const _0xae5a5a=_0x44c375;console['error'](_0xae5a5a(0x112),_0x3ef1e6);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x5643ca(0x123),_0x6bc094=>{const _0x54d276=_0x5643ca;if(serverWs&&serverWs[_0x54d276(0x165)]===WebSocket[_0x54d276(0x1c6)]){let _0x199f59=_0x6bc094[_0x54d276(0x164)]();try{const _0x19f9bc=JSON[_0x54d276(0x1a9)](_0x199f59);if(_0x19f9bc['op']==='publish'&&_0x19f9bc[_0x54d276(0x1ad)]){const _0x5ac347=topicManager[_0x54d276(0x157)](_0x19f9bc);switch(_0x5ac347[_0x54d276(0x174)]){case _0x54d276(0x134):return;case _0x54d276(0x169):return;case'forward':default:_0x199f59=JSON['stringify'](_0x5ac347['message']);break;}}if((_0x19f9bc['op']===_0x54d276(0x1ab)||_0x19f9bc['op']===_0x54d276(0x179))&&(_0x19f9bc[_0x54d276(0x145)]===_0x54d276(0x15e)||_0x19f9bc[_0x54d276(0x13a)]&&_0x19f9bc[_0x54d276(0x13a)][_0x54d276(0x178)])){console[_0x54d276(0x1bf)]('[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata');const _0x200b29=_0x19f9bc[_0x54d276(0x13a)]?.[_0x54d276(0x178)]||[],_0x2f9b9d=_0x19f9bc[_0x54d276(0x13a)]?.[_0x54d276(0x11d)]||[],_0xec58c9=_0x200b29[_0x54d276(0x15f)]((_0x2f93d4,_0x143c40)=>{const _0x93b9ac=_0x54d276,_0x447469=topicManager['getTopicStrategy'](_0x2f93d4);return{'name':_0x2f93d4,'type':_0x2f9b9d[_0x143c40]||'unknown','throttling':_0x447469?{'isThrottled':_0x447469[_0x93b9ac(0x137)]==='sample','strategy':_0x447469[_0x93b9ac(0x137)],'samplingRate':_0x447469[_0x93b9ac(0x161)],'reason':_0x447469['reason'],'estimatedSize':_0x447469[_0x93b9ac(0x17f)]}:null};});_0x19f9bc[_0x54d276(0x13a)]={'topics':_0xec58c9[_0x54d276(0x15f)](_0x48c4c2=>_0x48c4c2[_0x54d276(0x1bc)]),'types':_0xec58c9[_0x54d276(0x15f)](_0x2a1d17=>_0x2a1d17[_0x54d276(0x1b9)]),'throttling':_0xec58c9['map'](_0x1559d8=>_0x1559d8['throttling'])},_0x199f59=JSON[_0x54d276(0x144)](_0x19f9bc),console['log'](_0x54d276(0x11f));}if(_0x19f9bc['op']==='publish'&&_0x19f9bc['topic']==='/robot_description')try{const _0x59b483=_0x19f9bc[_0x54d276(0x142)]['data'],_0x17c1db=rewriteUrdfMeshUris(_0x59b483);_0x19f9bc[_0x54d276(0x142)][_0x54d276(0x184)]=_0x17c1db,_0x199f59=JSON['stringify'](_0x19f9bc);}catch(_0x4c0368){console[_0x54d276(0x116)]('[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:',_0x4c0368);}}catch(_0x25a749){console[_0x54d276(0x1a3)]('[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:',_0x25a749[_0x54d276(0x123)]);}serverWs[_0x54d276(0x1c4)](_0x199f59);}}),rosbridgeWs['on'](_0x5643ca(0x156),()=>{const _0x258b90=_0x5643ca;console[_0x258b90(0x1bf)](_0x258b90(0x168)),webrtcService['stopAllSessions'](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on']('error',_0x2700b7=>{const _0x22f57b=_0x5643ca;console[_0x22f57b(0x116)](_0x22f57b(0x187),_0x2700b7);});}catch(_0x4f7cfb){console[_0x5643ca(0x116)]('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):',_0x4f7cfb),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x29caa6=a1_0x381e0e;try{rosbridgeWebRTCWs=new WebSocket(config['rosbridge']['wsEndpoint']),rosbridgeWebRTCWs['on'](_0x29caa6(0x131),()=>{const _0x5ee4ae=_0x29caa6;console[_0x5ee4ae(0x1bf)]('Connected\x20to\x20ROSBridge\x20(WebRTC)'),webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x29caa6(0x123),_0x34f199=>{}),rosbridgeWebRTCWs['on']('close',()=>{const _0x4ec5b4=_0x29caa6;console[_0x4ec5b4(0x1bf)](_0x4ec5b4(0x14c)),webrtcService[_0x4ec5b4(0x12d)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x29caa6(0x116),_0x269b2e=>{const _0x480c8b=_0x29caa6;console['error'](_0x480c8b(0x183),_0x269b2e);});}catch(_0x3b2d5f){console['error'](_0x29caa6(0x1c1),_0x3b2d5f),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x3730f4=a1_0x381e0e;try{if(!registrationToken)throw new Error(_0x3730f4(0x12a));const _0x11ab36=config[_0x3730f4(0x146)][_0x3730f4(0x11c)](_0x3730f4(0x124),'ws')+_0x3730f4(0x13b)+registrationToken;serverWs=new WebSocket(_0x11ab36),serverWs['on'](_0x3730f4(0x131),()=>{const _0x3ec591=_0x3730f4;console[_0x3ec591(0x1bf)](_0x3ec591(0x17b)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x3ec591(0x165)]===WebSocket['OPEN']&&webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x3730f4(0x123),_0x20c357=>{const _0x8f50d8=_0x3730f4;if(rosbridgeWs&&rosbridgeWs['readyState']===WebSocket[_0x8f50d8(0x1c6)]){let _0x1c4843=_0x20c357[_0x8f50d8(0x164)]();try{const _0x428c93=JSON[_0x8f50d8(0x1a9)](_0x1c4843);if(webrtcService[_0x8f50d8(0x157)](_0x428c93))return;if(_0x428c93['op']==='get_urdf_param'&&typeof _0x428c93[_0x8f50d8(0x11e)]==='string'&&_0x428c93[_0x8f50d8(0x18a)])try{console['log'](_0x8f50d8(0x191)+_0x428c93['param_name']);const _0x53a090=execSync('ros2\x20param\x20get\x20'+_0x428c93[_0x8f50d8(0x11e)],{'encoding':'utf8'})['trim']();let _0x121b32=_0x53a090;_0x53a090[_0x8f50d8(0x1a7)](_0x8f50d8(0x1a8))&&(_0x121b32=_0x53a090[_0x8f50d8(0x143)](_0x8f50d8(0x1a8)['length']()));_0x121b32[_0x8f50d8(0x1a7)]('\x22')&&_0x121b32[_0x8f50d8(0x15b)]('\x22')&&(_0x121b32=_0x121b32[_0x8f50d8(0x19c)](0x1,-0x1));_0x121b32=_0x121b32[_0x8f50d8(0x11c)](/\\n/g,'\x0a')[_0x8f50d8(0x11c)](/\\"/g,'\x22');const _0x2bd5c1={'op':_0x8f50d8(0x1cb),'request_id':_0x428c93[_0x8f50d8(0x18a)],'data':_0x121b32};serverWs['send'](JSON['stringify'](_0x2bd5c1)),console['log'](_0x8f50d8(0x19f)+_0x428c93[_0x8f50d8(0x11e)]);return;}catch(_0x5a7667){console['error'](_0x8f50d8(0x12e),_0x5a7667);const _0x39aa31={'op':_0x8f50d8(0x1cb),'request_id':_0x428c93[_0x8f50d8(0x18a)],'error':_0x5a7667[_0x8f50d8(0x123)]};serverWs[_0x8f50d8(0x1c4)](JSON[_0x8f50d8(0x144)](_0x39aa31));return;}if(_0x428c93['op']===_0x8f50d8(0x16f)&&typeof _0x428c93[_0x8f50d8(0x199)]===_0x8f50d8(0x110)&&_0x428c93[_0x8f50d8(0x18a)])try{const _0x1bc949=_0x428c93['uri'][_0x8f50d8(0x1cd)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x1bc949){const _0x2dba3a=_0x1bc949[0x1],_0x1ea668=_0x1bc949[0x2],_0x27ee8d=execSync(_0x8f50d8(0x1b4)+_0x2dba3a,{'encoding':_0x8f50d8(0x1b1)})[_0x8f50d8(0x194)](),_0x5916bf=path[_0x8f50d8(0x193)](_0x27ee8d,_0x8f50d8(0x16c),_0x2dba3a,_0x1ea668);if(!fs[_0x8f50d8(0x1c0)](_0x5916bf))throw new Error('Mesh\x20file\x20not\x20found:\x20'+_0x5916bf);const _0x8ca7f7=fs[_0x8f50d8(0x19e)](_0x5916bf),_0x241e36={'op':'mesh_data','request_id':_0x428c93[_0x8f50d8(0x18a)],'data':_0x8ca7f7[_0x8f50d8(0x164)]('base64')};serverWs[_0x8f50d8(0x1c4)](JSON[_0x8f50d8(0x144)](_0x241e36)),console['log'](_0x8f50d8(0x15a)+_0x428c93[_0x8f50d8(0x199)]+'\x20from\x20'+_0x5916bf);return;}}catch(_0x58150f){console['error'](_0x8f50d8(0x176),_0x58150f);const _0x2616c3={'op':_0x8f50d8(0x19d),'request_id':_0x428c93[_0x8f50d8(0x18a)],'error':_0x58150f[_0x8f50d8(0x123)]};serverWs[_0x8f50d8(0x1c4)](JSON[_0x8f50d8(0x144)](_0x2616c3));return;}rosbridgeWs[_0x8f50d8(0x1c4)](_0x1c4843);}catch(_0x498ccd){rosbridgeWs['send'](_0x1c4843);}}}),serverWs['on']('close',(_0x2ad895,_0x2ae3fc)=>{const _0x58e46d=_0x3730f4;console[_0x58e46d(0x1bf)](_0x58e46d(0x1a1)+_0x2ad895+':\x20'+_0x2ae3fc+_0x58e46d(0x1b5)),webrtcService[_0x58e46d(0x12d)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x3730f4(0x116),_0x18097d=>{const _0x185f64=_0x3730f4;console[_0x185f64(0x116)](_0x185f64(0x1a0),_0x18097d);});}catch(_0x417687){console[_0x3730f4(0x116)]('Failed\x20to\x20connect\x20to\x20server:',_0x417687),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x1247a9,_0x57774f,_0x6cc561)=>{const _0x86d930=a1_0x381e0e;if(!authService['isAuthenticated']()){console[_0x86d930(0x1bf)](_0x86d930(0x15d),config[_0x86d930(0x146)]);const _0x128bf6=await authService[_0x86d930(0x158)]();if(!_0x128bf6)return _0x57774f[_0x86d930(0x18d)](0x191)[_0x86d930(0x189)]({'error':_0x86d930(0x155)});}_0x6cc561();};app[a1_0x381e0e(0x133)]((_0x1a48f8,_0x106235,_0x85f9a5)=>{const _0xace94e=a1_0x381e0e;_0x106235[_0xace94e(0x1be)](_0xace94e(0x130),'*'),_0x106235['header'](_0xace94e(0x111),_0xace94e(0x18b)),_0x106235['header'](_0xace94e(0x119),_0xace94e(0x120)),_0x1a48f8[_0xace94e(0x150)]==='OPTIONS'?_0x106235[_0xace94e(0x13e)](0xc8):_0x85f9a5();}),app[a1_0x381e0e(0x1c9)]('/',requireAuth,(_0x52162a,_0x2f0b6e)=>{const _0x1694c1=a1_0x381e0e;_0x2f0b6e[_0x1694c1(0x1c4)]('Appliance\x20is\x20running\x20and\x20authenticated!');}),app['get'](a1_0x381e0e(0x17a),async(_0x30dcd6,_0x4557a8)=>{const _0x1ef36e=a1_0x381e0e,_0x14236a=authService[_0x1ef36e(0x196)](),_0x131693=webrtcService[_0x1ef36e(0x18c)](),_0x36896e=webrtcService[_0x1ef36e(0x170)](),_0x18b537=topicManager[_0x1ef36e(0x166)]();_0x4557a8[_0x1ef36e(0x189)]({'status':'ok','environment':process[_0x1ef36e(0x13c)]['NODE_ENV']||'development','backendUrl':config[_0x1ef36e(0x146)],'rosbridgeUrl':config['rosbridge'][_0x1ef36e(0x140)],'proxyPort':port,'authenticated':_0x14236a,'topicManagement':{'discovered':_0x18b537['totalTopics'],'strategies':_0x18b537[_0x1ef36e(0x118)],'largeDataTopics':_0x18b537[_0x1ef36e(0x14f)][_0x1ef36e(0x1a2)],'largeTopicsList':_0x18b537[_0x1ef36e(0x14f)]},'webrtc':{'activeSessions':_0x131693[_0x1ef36e(0x1a2)],'sharedVideoSources':_0x36896e[_0x1ef36e(0x1a2)],'sessions':_0x131693,'sharedSources':_0x36896e}});});const getInitialPort=()=>{const _0x19cfdb=a1_0x381e0e;if(process['env'][_0x19cfdb(0x186)])return parseInt(process['env'][_0x19cfdb(0x186)],0xa);return config[_0x19cfdb(0x1ae)][_0x19cfdb(0x1c3)];};async function listenWithRetries(_0x354a3b,_0x422281,_0x2deead=0xa){const _0x588d17=a1_0x381e0e;let _0x404773=_0x422281;for(let _0x26c337=0x1;_0x26c337<=_0x2deead;_0x26c337++){try{return await new Promise((_0x36d10e,_0x417ff3)=>{const _0x23355c=a1_0x7bba,_0x19c10b=_0x354a3b[_0x23355c(0x1c2)](_0x404773,()=>{const _0x1d4992=_0x23355c;console[_0x1d4992(0x1bf)](_0x1d4992(0x162)+_0x404773),_0x36d10e(_0x19c10b);});_0x19c10b['on']('error',_0xc59cff=>{const _0x5dccd3=_0x23355c;_0xc59cff['code']==='EADDRINUSE'?(console[_0x5dccd3(0x1a3)](_0x5dccd3(0x117)+_0x404773+_0x5dccd3(0x154)),_0x417ff3(_0xc59cff)):_0x417ff3(_0xc59cff);});}),_0x404773;}catch(_0x40aec8){_0x404773++;}}throw new Error(_0x588d17(0x13d)+_0x2deead+_0x588d17(0x1af)+_0x422281);}const startApp=async()=>{const _0x1ee3f6=a1_0x381e0e;try{let _0x58a8e0=await authService['login']();while(!_0x58a8e0){console[_0x1ee3f6(0x1bf)](_0x1ee3f6(0x172)),await promptForCredentials(),_0x58a8e0=await authService[_0x1ee3f6(0x158)]();}console[_0x1ee3f6(0x1bf)]('Successfully\x20logged\x20in');!loadApplianceIdentity()&&console[_0x1ee3f6(0x1bf)]('No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.');console[_0x1ee3f6(0x1bf)](_0x1ee3f6(0x16d));const _0x48f043=await registerWithServer();if(!_0x48f043)throw new Error(_0x1ee3f6(0x122));connectToRosbridge(),connectToServer();const _0x389b2a=getInitialPort();await listenWithRetries(app,_0x389b2a,0xa);}catch(_0x57b60f){console[_0x1ee3f6(0x116)](_0x1ee3f6(0x1ac),_0x57b60f),process[_0x1ee3f6(0x1bb)](0x1);}};setInterval(async()=>{const _0x25097e=a1_0x381e0e;try{if(robotId){const _0x268b30=authService[_0x25097e(0x19b)]();await axios[_0x25097e(0x185)](config[_0x25097e(0x146)]+_0x25097e(0x13f),{'robotId':robotId},{'headers':{'Authorization':_0x25097e(0x1b6)+_0x268b30,'Content-Type':'application/json'}});}}catch(_0x2827d7){console[_0x25097e(0x116)]('Failed\x20to\x20ping\x20server:',_0x2827d7[_0x25097e(0x123)]);}},0x1388),startApp();