const a1_0x51c45e=a1_0x17a8;(function(_0x4b86b0,_0x36183d){const _0x129c6a=a1_0x17a8,_0x40e515=_0x4b86b0();while(!![]){try{const _0x409dd4=-parseInt(_0x129c6a(0x1c9))/0x1*(-parseInt(_0x129c6a(0x180))/0x2)+parseInt(_0x129c6a(0x1e3))/0x3+parseInt(_0x129c6a(0x18d))/0x4+parseInt(_0x129c6a(0x152))/0x5+-parseInt(_0x129c6a(0x174))/0x6+-parseInt(_0x129c6a(0x15d))/0x7+parseInt(_0x129c6a(0x1b8))/0x8*(-parseInt(_0x129c6a(0x132))/0x9);if(_0x409dd4===_0x36183d)break;else _0x40e515['push'](_0x40e515['shift']());}catch(_0x45959a){_0x40e515['push'](_0x40e515['shift']());}}}(a1_0x2d02,0x9a375));const a1_0x2221ed=(function(){let _0x19147a=!![];return function(_0x4b2c08,_0xee973b){const _0x58d9b3=_0x19147a?function(){if(_0xee973b){const _0xdd1b74=_0xee973b['apply'](_0x4b2c08,arguments);return _0xee973b=null,_0xdd1b74;}}:function(){};return _0x19147a=![],_0x58d9b3;};}()),a1_0x942f98=a1_0x2221ed(this,function(){const _0x38ee89=a1_0x17a8;return a1_0x942f98[_0x38ee89(0x13c)]()['search']('(((.+)+)+)+$')[_0x38ee89(0x13c)]()[_0x38ee89(0x1c6)](a1_0x942f98)[_0x38ee89(0x15f)](_0x38ee89(0x13d));});function a1_0x2d02(){const _0x39412d=['EADDRINUSE','send','1129851OUysdJ','.dae','Access-Control-Allow-Methods','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','param_name','existsSync','code','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','getAttribute','toString','(((.+)+)+)+$','length','[URDF\x20REWRITE]\x20Rewrote\x20','axios','./config','substring','post','Access-Control-Allow-Headers','reason','getElementsByTagName','stringify','endsWith','Successfully\x20logged\x20in','log','/robot_description','forward','get','readyState','get_urdf_param','getStatistics','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','3097380JAnBuV','open','/rosbridge?type=appliance&token=','publish','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','warn','startsWith','Enter\x20password:\x20','ros2\x20param\x20get\x20','ROSBridge\x20(WebRTC)\x20connection\x20error:','rosbridge','2185323FUNFqZ','/health','search','Enter\x20username:\x20','readFileSync','listen','webrtc_skip','match','APPLIANCE_BASE_URL','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','service','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','mesh','samplingRate','.stl','Proxy\x20listening\x20on\x20port:\x20','filename','largeDataTopics','path','[MESH]\x20Successfully\x20served\x20mesh:\x20','\x20->\x20','.ply','Access-Control-Allow-Origin','6313806PZWhKD','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','share','mesh_data','handleMessage','slice','Disconnected\x20from\x20server\x20(','type','username','Not\x20authenticated','Authentication\x20required','/appliance/ping','2078KFjstJ','\x20in\x20use,\x20trying\x20next\x20port...','serializeToString','./services/webrtcService','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','string','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','setAttribute','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','APP_USERNAME','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','package://','close','731224safrTj','robotId','utf8','Environment:\x20','wsEndpoint','Successfully\x20registered\x20with\x20server','/rosapi/topics','toLowerCase','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','parse','proxyPort','loadConfig','\x20attempts\x20starting\x20from\x20','/appliance/register','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','types','error','credentials','getTopicStrategy','Port\x20','Failed\x20to\x20register\x20with\x20server','Ros','\x0aAPP_PASSWORD=','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','getToken','serverUrl','stopAllSessions','Appliance\x20is\x20running\x20and\x20authenticated!','xmldom','trim','request_id','header','application/json','Failed\x20to\x20start\x20application:','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','status','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','dotenv','Bearer\x20','topic','use','discoverTopics','40XSTMQx','exit','Registering\x20with\x20server...','.mesh','service_response','sendStatus','data','sample_skip','unknown','parseFromString','message','msg','ROSBridge\x20(main)\x20connection\x20error:','map','constructor','Connected\x20to\x20ROSBridge\x20(main)','writeFileSync','666JrvkUn','some','registrationToken','initialize','http','OPTIONS','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','OPEN','env','),\x20attempting\x20to\x20reconnect...','urdf_param_data','uri','String\x20value\x20is:\x20','Connected\x20to\x20ROSBridge\x20(WebRTC)','values','config','includes','Server\x20connection\x20error:','\x20of\x20','.appliance.json','Connected\x20to\x20server','WSL\x20Appliance','robot\x20not\x20found','login','base64','PORT','3388794RDUTxV','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','registration_token','text/xml','connection','./services/auth','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','strategy','Mesh\x20file\x20not\x20found:\x20','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20'];a1_0x2d02=function(){return _0x39412d;};return a1_0x2d02();}a1_0x942f98();const express=require('express'),config=require(a1_0x51c45e(0x141)),authService=require(a1_0x51c45e(0x12b)),webrtcService=require(a1_0x51c45e(0x183)),topicManager=require('./services/TopicManager'),WebSocket=require('ws'),axios=require(a1_0x51c45e(0x140)),fs=require('fs'),prompt=require('prompt-sync')({'sigint':!![]}),dotenv=require(a1_0x51c45e(0x1b3)),app=express(),port=process[a1_0x51c45e(0x1d1)][a1_0x51c45e(0x1e2)]||config['rosbridge'][a1_0x51c45e(0x197)],APPLIANCE_FILE=a1_0x51c45e(0x1dc),{DOMParser,XMLSerializer}=require(a1_0x51c45e(0x1a9)),path=require(a1_0x51c45e(0x16f)),{execSync}=require('child_process'),APPLIANCE_BASE_URL=process['env'][a1_0x51c45e(0x165)]||'';console['log'](a1_0x51c45e(0x190)+(process[a1_0x51c45e(0x1d1)]['NODE_ENV']||'development')),console[a1_0x51c45e(0x14a)]('Backend\x20Server\x20URL:\x20'+config[a1_0x51c45e(0x1a6)]),console[a1_0x51c45e(0x14a)]('ROSBridge\x20WebSocket\x20URL:\x20'+config[a1_0x51c45e(0x15c)]['wsEndpoint']),console[a1_0x51c45e(0x14a)](a1_0x51c45e(0x16c)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x57a9af,_0x46830c){const _0x33c9b4=a1_0x51c45e;fs[_0x33c9b4(0x1c8)]('.env','APP_USERNAME='+_0x57a9af+_0x33c9b4(0x1a3)+_0x46830c+'\x0a');}function reloadEnv(){const _0x4b2170=a1_0x51c45e;dotenv[_0x4b2170(0x1d8)]({'override':!![]}),config[_0x4b2170(0x19e)][_0x4b2170(0x17c)]=process[_0x4b2170(0x1d1)][_0x4b2170(0x189)],config[_0x4b2170(0x19e)]['password']=process[_0x4b2170(0x1d1)]['APP_PASSWORD'];}async function promptForCredentials(){const _0x5324e8=a1_0x51c45e,_0xdfc63f=prompt(_0x5324e8(0x160)),_0x53edf6=prompt['hide'](_0x5324e8(0x159));updateEnvFile(_0xdfc63f,_0x53edf6),reloadEnv();}function loadApplianceIdentity(){const _0x567c99=a1_0x51c45e;if(fs[_0x567c99(0x137)](APPLIANCE_FILE))try{const _0x3e7200=JSON[_0x567c99(0x196)](fs[_0x567c99(0x161)](APPLIANCE_FILE,_0x567c99(0x18f)));if(_0x3e7200[_0x567c99(0x18e)]&&_0x3e7200[_0x567c99(0x1cb)])return robotId=_0x3e7200[_0x567c99(0x18e)],registrationToken=_0x3e7200[_0x567c99(0x1cb)],console[_0x567c99(0x14a)]('Loaded\x20appliance\x20identity:',robotId),topicManager[_0x567c99(0x198)](_0x3e7200),!![];}catch(_0x207104){console[_0x567c99(0x19d)](_0x567c99(0x18a),_0x207104);}return![];}function saveApplianceIdentity(_0x486a8a,_0x1ca3a2){const _0x15ed8a=a1_0x51c45e;let _0x5ddb8e={};if(fs[_0x15ed8a(0x137)](APPLIANCE_FILE))try{_0x5ddb8e=JSON[_0x15ed8a(0x196)](fs[_0x15ed8a(0x161)](APPLIANCE_FILE,_0x15ed8a(0x18f)));}catch(_0x3d79b8){_0x5ddb8e={};}_0x5ddb8e[_0x15ed8a(0x18e)]=_0x486a8a,_0x5ddb8e['registrationToken']=_0x1ca3a2,fs[_0x15ed8a(0x1c8)](APPLIANCE_FILE,JSON[_0x15ed8a(0x147)](_0x5ddb8e,null,0x2));}async function registerWithServer(){const _0x2c2574=a1_0x51c45e;try{const _0x4c00f2=authService[_0x2c2574(0x1a5)]();if(!_0x4c00f2)throw new Error(_0x2c2574(0x17d));let _0x4c843a,_0x3dd18c=![];while(!![]){try{robotId&&registrationToken?_0x4c843a=await axios[_0x2c2574(0x143)](config[_0x2c2574(0x1a6)]+_0x2c2574(0x19a),{'name':_0x2c2574(0x1de),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x2c2574(0x1b4)+_0x4c00f2,'Content-Type':_0x2c2574(0x1ad)}}):_0x4c843a=await axios[_0x2c2574(0x143)](config[_0x2c2574(0x1a6)]+_0x2c2574(0x19a),{'name':_0x2c2574(0x1de)},{'headers':{'Authorization':_0x2c2574(0x1b4)+_0x4c00f2,'Content-Type':_0x2c2574(0x1ad)}});break;}catch(_0x5c73ba){const _0x3ab957=_0x5c73ba?.['response']?.[_0x2c2574(0x1be)]?.[_0x2c2574(0x19d)]||_0x5c73ba[_0x2c2574(0x1c2)];if(!_0x3dd18c&&_0x3ab957&&_0x3ab957[_0x2c2574(0x194)]()[_0x2c2574(0x1d9)](_0x2c2574(0x1df))){console['warn'](_0x2c2574(0x184));if(fs[_0x2c2574(0x137)](APPLIANCE_FILE))fs['unlinkSync'](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x3dd18c=!![];continue;}throw _0x5c73ba;}}if(!_0x4c843a[_0x2c2574(0x1be)]||!_0x4c843a['data'][_0x2c2574(0x1e6)]||!_0x4c843a[_0x2c2574(0x1be)]['id'])throw new Error(_0x2c2574(0x188));return registrationToken=_0x4c843a['data'][_0x2c2574(0x1e6)],robotId=_0x4c843a[_0x2c2574(0x1be)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x2c2574(0x14a)](_0x2c2574(0x192)),!![];}catch(_0x5e31f9){return console[_0x2c2574(0x19d)]('Failed\x20to\x20register\x20with\x20server:',_0x5e31f9[_0x2c2574(0x1c2)]),![];}}function rewriteUrdfMeshUris(_0x4028a6){const _0x396ea5=a1_0x51c45e;try{const _0x23b250=new DOMParser(),_0x39382c=_0x23b250[_0x396ea5(0x1c1)](_0x4028a6,_0x396ea5(0x129));let _0x4917d6=0x0,_0x4ac60a=0x0;const _0x2922fb=_0x39382c[_0x396ea5(0x146)](_0x396ea5(0x169));for(let _0x442dd2=0x0;_0x442dd2<_0x2922fb[_0x396ea5(0x13e)];_0x442dd2++){const _0x2d4855=_0x2922fb[_0x442dd2],_0x2b1b51=_0x2d4855[_0x396ea5(0x13b)](_0x396ea5(0x16d)),_0x413862=[_0x396ea5(0x16b),_0x396ea5(0x133),'.obj',_0x396ea5(0x172),_0x396ea5(0x1bb)],_0x1b900c=_0x413862[_0x396ea5(0x1ca)](_0x2e5c0c=>_0x2b1b51[_0x396ea5(0x194)]()[_0x396ea5(0x148)](_0x2e5c0c));if(_0x2b1b51&&_0x2b1b51['startsWith'](_0x396ea5(0x18b))&&_0x1b900c){_0x4917d6++;const _0x1e233c=APPLIANCE_BASE_URL+'/ros/mesh?uri='+encodeURIComponent(_0x2b1b51);_0x2d4855[_0x396ea5(0x187)](_0x396ea5(0x16d),_0x1e233c),_0x4ac60a++,console['log']('[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20'+_0x2b1b51+_0x396ea5(0x171)+_0x1e233c);}}_0x4917d6>0x0?console[_0x396ea5(0x14a)](_0x396ea5(0x13f)+_0x4ac60a+_0x396ea5(0x1db)+_0x4917d6+_0x396ea5(0x175)):console['log'](_0x396ea5(0x139));const _0x4d8877=new XMLSerializer();return _0x4d8877[_0x396ea5(0x182)](_0x39382c);}catch(_0x332ac5){return console[_0x396ea5(0x19d)](_0x396ea5(0x151),_0x332ac5),_0x4028a6;}}function connectToRosbridge(){const _0xdae9d9=a1_0x51c45e;try{rosbridgeWs=new WebSocket(config[_0xdae9d9(0x15c)]['wsEndpoint']),rosbridgeWs['on']('open',()=>{const _0x55f49e=_0xdae9d9;console[_0x55f49e(0x14a)](_0x55f49e(0x1c7));const _0x5e5e87=require('roslib'),_0x2244d9=new _0x5e5e87[(_0x55f49e(0x1a2))]({'url':config['rosbridge'][_0x55f49e(0x191)]});_0x2244d9['on'](_0x55f49e(0x12a),()=>{setTimeout(()=>{const _0x576547=a1_0x17a8;topicManager[_0x576547(0x1b7)](_0x2244d9)['catch'](_0x55c9f7=>{const _0x3d1e79=_0x576547;console[_0x3d1e79(0x19d)]('Topic\x20discovery\x20failed:',_0x55c9f7);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0xdae9d9(0x1c2),_0x552623=>{const _0x466049=_0xdae9d9;if(serverWs&&serverWs[_0x466049(0x14e)]===WebSocket['OPEN']){let _0x4fa792=_0x552623[_0x466049(0x13c)]();try{const _0xcbdd68=JSON[_0x466049(0x196)](_0x4fa792);if(_0xcbdd68['op']===_0x466049(0x155)&&_0xcbdd68[_0x466049(0x1b5)]){const _0xec8725=topicManager[_0x466049(0x178)](_0xcbdd68);switch(_0xec8725['action']){case _0x466049(0x1bf):return;case _0x466049(0x163):return;case _0x466049(0x14c):default:_0x4fa792=JSON[_0x466049(0x147)](_0xec8725[_0x466049(0x1c2)]);break;}}if((_0xcbdd68['op']===_0x466049(0x1bc)||_0xcbdd68['op']==='call_service')&&(_0xcbdd68[_0x466049(0x167)]===_0x466049(0x193)||_0xcbdd68[_0x466049(0x1d7)]&&_0xcbdd68['values']['topics'])){console[_0x466049(0x14a)](_0x466049(0x1b2));const _0x25f4c0=_0xcbdd68[_0x466049(0x1d7)]?.['topics']||[],_0x4a5611=_0xcbdd68[_0x466049(0x1d7)]?.[_0x466049(0x19c)]||[],_0xee1dc4=_0x25f4c0[_0x466049(0x1c5)]((_0x239858,_0x416d46)=>{const _0x51e3ae=_0x466049,_0x53c11b=topicManager[_0x51e3ae(0x19f)](_0x239858);return{'name':_0x239858,'type':_0x4a5611[_0x416d46]||_0x51e3ae(0x1c0),'throttling':_0x53c11b?{'isThrottled':_0x53c11b[_0x51e3ae(0x12d)]==='sample','strategy':_0x53c11b[_0x51e3ae(0x12d)],'samplingRate':_0x53c11b[_0x51e3ae(0x16a)],'reason':_0x53c11b[_0x51e3ae(0x145)],'estimatedSize':_0x53c11b['estimatedSize']}:null};});_0xcbdd68[_0x466049(0x1d7)]={'topics':_0xee1dc4['map'](_0x2d9006=>_0x2d9006['name']),'types':_0xee1dc4[_0x466049(0x1c5)](_0x821be3=>_0x821be3[_0x466049(0x17b)]),'throttling':_0xee1dc4[_0x466049(0x1c5)](_0x59d1ba=>_0x59d1ba['throttling'])},_0x4fa792=JSON['stringify'](_0xcbdd68),console[_0x466049(0x14a)](_0x466049(0x1e4));}if(_0xcbdd68['op']===_0x466049(0x155)&&_0xcbdd68['topic']===_0x466049(0x14b))try{const _0x49277d=_0xcbdd68['msg'][_0x466049(0x1be)],_0xec0ee6=rewriteUrdfMeshUris(_0x49277d);_0xcbdd68[_0x466049(0x1c3)][_0x466049(0x1be)]=_0xec0ee6,_0x4fa792=JSON[_0x466049(0x147)](_0xcbdd68);}catch(_0x3cee21){console[_0x466049(0x19d)](_0x466049(0x156),_0x3cee21);}}catch(_0x2be8bb){console[_0x466049(0x157)](_0x466049(0x1af),_0x2be8bb[_0x466049(0x1c2)]);}serverWs[_0x466049(0x131)](_0x4fa792);}}),rosbridgeWs['on'](_0xdae9d9(0x18c),()=>{const _0x4cf692=_0xdae9d9;console['log']('Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x4cf692(0x1a7)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0xdae9d9(0x19d),_0x3ff493=>{const _0x31cd83=_0xdae9d9;console[_0x31cd83(0x19d)](_0x31cd83(0x1c4),_0x3ff493);});}catch(_0x3c645f){console[_0xdae9d9(0x19d)](_0xdae9d9(0x135),_0x3c645f),setTimeout(connectToRosbridge,0x1388);}}function a1_0x17a8(_0x35a6b8,_0x48ee46){const _0x18aa2b=a1_0x2d02();return a1_0x17a8=function(_0x942f98,_0x2221ed){_0x942f98=_0x942f98-0x129;let _0x2d02fa=_0x18aa2b[_0x942f98];return _0x2d02fa;},a1_0x17a8(_0x35a6b8,_0x48ee46);}function connectToRosbridgeWebRTC(){const _0x20412e=a1_0x51c45e;try{rosbridgeWebRTCWs=new WebSocket(config['rosbridge'][_0x20412e(0x191)]),rosbridgeWebRTCWs['on'](_0x20412e(0x153),()=>{const _0xd36834=_0x20412e;console[_0xd36834(0x14a)](_0xd36834(0x1d6)),webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on']('message',_0x629885=>{}),rosbridgeWebRTCWs['on'](_0x20412e(0x18c),()=>{const _0x2e6d62=_0x20412e;console['log'](_0x2e6d62(0x168)),webrtcService[_0x2e6d62(0x1a7)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x20412e(0x19d),_0x5830ad=>{const _0x5374a0=_0x20412e;console['error'](_0x5374a0(0x15b),_0x5830ad);});}catch(_0x43ad55){console[_0x20412e(0x19d)](_0x20412e(0x1e5),_0x43ad55),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x2dae73=a1_0x51c45e;try{if(!registrationToken)throw new Error(_0x2dae73(0x19b));const _0x43c985=config[_0x2dae73(0x1a6)]['replace'](_0x2dae73(0x1cd),'ws')+_0x2dae73(0x154)+registrationToken;serverWs=new WebSocket(_0x43c985),serverWs['on'](_0x2dae73(0x153),()=>{const _0x411288=_0x2dae73;console[_0x411288(0x14a)](_0x411288(0x1dd)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs['readyState']===WebSocket[_0x411288(0x1d0)]&&webrtcService[_0x411288(0x1cc)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x2dae73(0x1c2),_0x2e6ff2=>{const _0x505a88=_0x2dae73;if(rosbridgeWs&&rosbridgeWs['readyState']===WebSocket['OPEN']){let _0x50d792=_0x2e6ff2[_0x505a88(0x13c)]();try{const _0x30ff30=JSON[_0x505a88(0x196)](_0x50d792);if(webrtcService['handleMessage'](_0x30ff30))return;if(_0x30ff30['op']===_0x505a88(0x14f)&&typeof _0x30ff30['param_name']==='string'&&_0x30ff30[_0x505a88(0x1ab)])try{console[_0x505a88(0x14a)](_0x505a88(0x166)+_0x30ff30[_0x505a88(0x136)]);const _0x580a6b=execSync(_0x505a88(0x15a)+_0x30ff30[_0x505a88(0x136)],{'encoding':_0x505a88(0x18f)})[_0x505a88(0x1aa)]();let _0x4b6534=_0x580a6b;_0x580a6b['startsWith'](_0x505a88(0x1d5))&&(_0x4b6534=_0x580a6b[_0x505a88(0x142)](_0x505a88(0x1d5)[_0x505a88(0x13e)]()));_0x4b6534[_0x505a88(0x158)]('\x22')&&_0x4b6534[_0x505a88(0x148)]('\x22')&&(_0x4b6534=_0x4b6534[_0x505a88(0x179)](0x1,-0x1));_0x4b6534=_0x4b6534['replace'](/\\n/g,'\x0a')['replace'](/\\"/g,'\x22');const _0x23fedb={'op':_0x505a88(0x1d3),'request_id':_0x30ff30[_0x505a88(0x1ab)],'data':_0x4b6534};serverWs[_0x505a88(0x131)](JSON[_0x505a88(0x147)](_0x23fedb)),console[_0x505a88(0x14a)](_0x505a88(0x1b1)+_0x30ff30[_0x505a88(0x136)]);return;}catch(_0x333060){console[_0x505a88(0x19d)](_0x505a88(0x12c),_0x333060);const _0xfd20f5={'op':_0x505a88(0x1d3),'request_id':_0x30ff30[_0x505a88(0x1ab)],'error':_0x333060[_0x505a88(0x1c2)]};serverWs['send'](JSON[_0x505a88(0x147)](_0xfd20f5));return;}if(_0x30ff30['op']==='get_mesh'&&typeof _0x30ff30['uri']===_0x505a88(0x185)&&_0x30ff30[_0x505a88(0x1ab)])try{const _0x3e5189=_0x30ff30[_0x505a88(0x1d4)][_0x505a88(0x164)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x3e5189){const _0x86615a=_0x3e5189[0x1],_0x4e7351=_0x3e5189[0x2],_0x465c2d=execSync('ros2\x20pkg\x20prefix\x20'+_0x86615a,{'encoding':_0x505a88(0x18f)})[_0x505a88(0x1aa)](),_0x2d1683=path['join'](_0x465c2d,_0x505a88(0x176),_0x86615a,_0x4e7351);if(!fs[_0x505a88(0x137)](_0x2d1683))throw new Error(_0x505a88(0x12e)+_0x2d1683);const _0x577665=fs[_0x505a88(0x161)](_0x2d1683),_0x4f3bda={'op':'mesh_data','request_id':_0x30ff30[_0x505a88(0x1ab)],'data':_0x577665['toString'](_0x505a88(0x1e1))};serverWs[_0x505a88(0x131)](JSON['stringify'](_0x4f3bda)),console[_0x505a88(0x14a)](_0x505a88(0x170)+_0x30ff30[_0x505a88(0x1d4)]+'\x20from\x20'+_0x2d1683);return;}}catch(_0x6659ed){console[_0x505a88(0x19d)]('[MESH]\x20Error\x20serving\x20mesh:',_0x6659ed);const _0x2a04ad={'op':_0x505a88(0x177),'request_id':_0x30ff30[_0x505a88(0x1ab)],'error':_0x6659ed[_0x505a88(0x1c2)]};serverWs[_0x505a88(0x131)](JSON[_0x505a88(0x147)](_0x2a04ad));return;}rosbridgeWs['send'](_0x50d792);}catch(_0xce9d0a){rosbridgeWs['send'](_0x50d792);}}}),serverWs['on'](_0x2dae73(0x18c),(_0x215131,_0xd4654)=>{const _0x14e098=_0x2dae73;console[_0x14e098(0x14a)](_0x14e098(0x17a)+_0x215131+':\x20'+_0xd4654+_0x14e098(0x1d2)),webrtcService[_0x14e098(0x1a7)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x2dae73(0x19d),_0x8c5c10=>{const _0x34ef71=_0x2dae73;console[_0x34ef71(0x19d)](_0x34ef71(0x1da),_0x8c5c10);});}catch(_0x4c73e7){console['error']('Failed\x20to\x20connect\x20to\x20server:',_0x4c73e7),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x3458b4,_0x1f8ccf,_0x1c9337)=>{const _0x273290=a1_0x51c45e;if(!authService['isAuthenticated']()){console[_0x273290(0x14a)]('Attempting\x20to\x20login\x20to:',config[_0x273290(0x1a6)]);const _0x1f2d30=await authService[_0x273290(0x1e0)]();if(!_0x1f2d30)return _0x1f8ccf[_0x273290(0x1b0)](0x191)['json']({'error':_0x273290(0x17e)});}_0x1c9337();};app[a1_0x51c45e(0x1b6)]((_0x58b406,_0x30dabf,_0x5a74d5)=>{const _0x435b74=a1_0x51c45e;_0x30dabf['header'](_0x435b74(0x173),'*'),_0x30dabf[_0x435b74(0x1ac)](_0x435b74(0x134),_0x435b74(0x13a)),_0x30dabf[_0x435b74(0x1ac)](_0x435b74(0x144),_0x435b74(0x195)),_0x58b406['method']===_0x435b74(0x1ce)?_0x30dabf[_0x435b74(0x1bd)](0xc8):_0x5a74d5();}),app[a1_0x51c45e(0x14d)]('/',requireAuth,(_0x3da227,_0x5792e4)=>{const _0xebcb15=a1_0x51c45e;_0x5792e4[_0xebcb15(0x131)](_0xebcb15(0x1a8));}),app['get'](a1_0x51c45e(0x15e),async(_0x405080,_0x388da6)=>{const _0x29fea1=a1_0x51c45e,_0x2d6021=authService['isAuthenticated'](),_0x27a3f5=webrtcService['getActiveSessions'](),_0x300520=webrtcService['getSharedVideoSources'](),_0x524705=topicManager[_0x29fea1(0x150)]();_0x388da6['json']({'status':'ok','environment':process[_0x29fea1(0x1d1)]['NODE_ENV']||'development','backendUrl':config[_0x29fea1(0x1a6)],'rosbridgeUrl':config[_0x29fea1(0x15c)]['wsEndpoint'],'proxyPort':port,'authenticated':_0x2d6021,'topicManagement':{'discovered':_0x524705['totalTopics'],'strategies':_0x524705['strategies'],'largeDataTopics':_0x524705[_0x29fea1(0x16e)]['length'],'largeTopicsList':_0x524705[_0x29fea1(0x16e)]},'webrtc':{'activeSessions':_0x27a3f5[_0x29fea1(0x13e)],'sharedVideoSources':_0x300520[_0x29fea1(0x13e)],'sessions':_0x27a3f5,'sharedSources':_0x300520}});});const getInitialPort=()=>{const _0x46a34f=a1_0x51c45e;if(process[_0x46a34f(0x1d1)][_0x46a34f(0x1e2)])return parseInt(process['env'][_0x46a34f(0x1e2)],0xa);return config[_0x46a34f(0x15c)]['proxyPort'];};async function listenWithRetries(_0x2b42c4,_0x567f36,_0x95b022=0xa){const _0x519de5=a1_0x51c45e;let _0x2d5d9e=_0x567f36;for(let _0x2c815d=0x1;_0x2c815d<=_0x95b022;_0x2c815d++){try{return await new Promise((_0xe935a7,_0x2ae64b)=>{const _0x51f956=a1_0x17a8,_0x5d2598=_0x2b42c4[_0x51f956(0x162)](_0x2d5d9e,()=>{const _0x1b3fc3=_0x51f956;console[_0x1b3fc3(0x14a)](_0x1b3fc3(0x1cf)+_0x2d5d9e),_0xe935a7(_0x5d2598);});_0x5d2598['on'](_0x51f956(0x19d),_0x5c3124=>{const _0x517162=_0x51f956;_0x5c3124[_0x517162(0x138)]===_0x517162(0x130)?(console[_0x517162(0x157)](_0x517162(0x1a0)+_0x2d5d9e+_0x517162(0x181)),_0x2ae64b(_0x5c3124)):_0x2ae64b(_0x5c3124);});}),_0x2d5d9e;}catch(_0x1d776d){_0x2d5d9e++;}}throw new Error(_0x519de5(0x12f)+_0x95b022+_0x519de5(0x199)+_0x567f36);}const startApp=async()=>{const _0x5d2d0b=a1_0x51c45e;try{let _0x37093c=await authService[_0x5d2d0b(0x1e0)]();while(!_0x37093c){console[_0x5d2d0b(0x14a)](_0x5d2d0b(0x1a4)),await promptForCredentials(),_0x37093c=await authService[_0x5d2d0b(0x1e0)]();}console[_0x5d2d0b(0x14a)](_0x5d2d0b(0x149));!loadApplianceIdentity()&&console['log'](_0x5d2d0b(0x186));console[_0x5d2d0b(0x14a)](_0x5d2d0b(0x1ba));const _0x35b60a=await registerWithServer();if(!_0x35b60a)throw new Error(_0x5d2d0b(0x1a1));connectToRosbridge(),connectToServer();const _0x1a64f3=getInitialPort();await listenWithRetries(app,_0x1a64f3,0xa);}catch(_0x457f80){console[_0x5d2d0b(0x19d)](_0x5d2d0b(0x1ae),_0x457f80),process[_0x5d2d0b(0x1b9)](0x1);}};setInterval(async()=>{const _0x114cac=a1_0x51c45e;try{if(robotId){const _0x427c95=authService[_0x114cac(0x1a5)]();await axios['post'](config[_0x114cac(0x1a6)]+_0x114cac(0x17f),{'robotId':robotId},{'headers':{'Authorization':_0x114cac(0x1b4)+_0x427c95,'Content-Type':'application/json'}});}}catch(_0x631ba9){console[_0x114cac(0x19d)]('Failed\x20to\x20ping\x20server:',_0x631ba9[_0x114cac(0x1c2)]);}},0x1388),startApp();