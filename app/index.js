const a1_0x8d0930=a1_0x2e25;(function(_0x2e3c3d,_0x56811b){const _0x17bcd3=a1_0x2e25,_0x168f78=_0x2e3c3d();while(!![]){try{const _0x3e2cd8=parseInt(_0x17bcd3(0x1e1))/0x1+-parseInt(_0x17bcd3(0x1f7))/0x2*(parseInt(_0x17bcd3(0x21d))/0x3)+parseInt(_0x17bcd3(0x17f))/0x4+-parseInt(_0x17bcd3(0x172))/0x5+parseInt(_0x17bcd3(0x1d7))/0x6+-parseInt(_0x17bcd3(0x20c))/0x7+parseInt(_0x17bcd3(0x1d2))/0x8*(parseInt(_0x17bcd3(0x1de))/0x9);if(_0x3e2cd8===_0x56811b)break;else _0x168f78['push'](_0x168f78['shift']());}catch(_0x59a32a){_0x168f78['push'](_0x168f78['shift']());}}}(a1_0x2364,0x2cd0d));const a1_0x49fd82=(function(){let _0x3c8de0=!![];return function(_0x235e23,_0x330acc){const _0xb9954=_0x3c8de0?function(){if(_0x330acc){const _0x3fb9f4=_0x330acc['apply'](_0x235e23,arguments);return _0x330acc=null,_0x3fb9f4;}}:function(){};return _0x3c8de0=![],_0xb9954;};}()),a1_0x19e648=a1_0x49fd82(this,function(){const _0x194703=a1_0x2e25;return a1_0x19e648[_0x194703(0x178)]()[_0x194703(0x1ee)](_0x194703(0x21c))[_0x194703(0x178)]()[_0x194703(0x1bf)](a1_0x19e648)['search'](_0x194703(0x21c));});a1_0x19e648();const express=require(a1_0x8d0930(0x1c6)),config=require('./config'),authService=require('./services/auth'),webrtcService=require(a1_0x8d0930(0x1bc)),topicManager=require(a1_0x8d0930(0x1ca)),WebSocket=require('ws'),axios=require(a1_0x8d0930(0x187)),fs=require('fs'),prompt=require(a1_0x8d0930(0x1d6))({'sigint':!![]}),dotenv=require(a1_0x8d0930(0x1c1)),app=express(),port=process[a1_0x8d0930(0x1dc)][a1_0x8d0930(0x1c9)]||config['rosbridge'][a1_0x8d0930(0x1be)],APPLIANCE_FILE=a1_0x8d0930(0x1e8),{DOMParser,XMLSerializer}=require('xmldom'),path=require(a1_0x8d0930(0x1eb)),{execSync}=require('child_process'),APPLIANCE_BASE_URL=process['env'][a1_0x8d0930(0x1db)]||'';console[a1_0x8d0930(0x183)](a1_0x8d0930(0x1e6)+(process[a1_0x8d0930(0x1dc)][a1_0x8d0930(0x20a)]||a1_0x8d0930(0x21f))),console['log'](a1_0x8d0930(0x1e9)+config[a1_0x8d0930(0x1ec)]),console['log'](a1_0x8d0930(0x226)+config['rosbridge']['wsEndpoint']),console['log']('Proxy\x20listening\x20on\x20port:\x20'+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x16dc07,_0x3854f5){const _0x43a84b=a1_0x8d0930;fs[_0x43a84b(0x1f2)](_0x43a84b(0x220),_0x43a84b(0x182)+_0x16dc07+_0x43a84b(0x1fb)+_0x3854f5+'\x0a');}function a1_0x2364(){const _0x64ef9b=['ros2\x20param\x20get\x20','express','topics','parse','PORT','./services/TopicManager','unlinkSync','publish','get_mesh','Failed\x20to\x20register\x20with\x20server:','application/json','\x20from\x20','wsEndpoint','50624feWNIt','service','endsWith','param_name','prompt-sync','1696308usPJew','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','request_id','APPLIANCE_BASE_URL','env','trim','9NKzTFk','code','stringify','61594wgzIZA','Topic\x20discovery\x20failed:','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','getSharedVideoSources','Environment:\x20','join','.appliance.json','Backend\x20Server\x20URL:\x20','send','path','serverUrl','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','search','/robot_description','Port\x20','json','writeFileSync','open','length','/rosbridge?type=appliance&token=','strategies','26584xkYNfg','msg','topic','Failed\x20to\x20ping\x20server:','\x0aAPP_PASSWORD=','mesh','type','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','Bearer\x20','values','startsWith','APP_PASSWORD','action','Not\x20authenticated','readFileSync','username','[MESH]\x20Successfully\x20served\x20mesh:\x20','includes','http','NODE_ENV','utf8','1170428uwvTmM','ros2\x20pkg\x20prefix\x20','rosbridge','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','Failed\x20to\x20connect\x20to\x20server:','Connected\x20to\x20ROSBridge\x20(main)','\x20->\x20','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','warn','mesh_data','substring','\x20of\x20','/ros/mesh?uri=','\x20in\x20use,\x20trying\x20next\x20port...','catch','loadConfig','(((.+)+)+)+$','6xXlGrn','.ply','development','.env','share','Access-Control-Allow-Headers','.obj','config','/appliance/register','ROSBridge\x20WebSocket\x20URL:\x20','call_service','password','stopAllSessions','sendStatus','getToken','readyState','.mesh','header','.dae','Connected\x20to\x20server','string','unknown','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','1002340BpPxUP','map','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','WSL\x20Appliance','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','name','toString','Successfully\x20logged\x20in','[URDF\x20REWRITE]\x20Rewrote\x20','text/xml','listen','response','registrationToken','908724DvPepF','credentials','robotId','APP_USERNAME=','log','strategy','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','uri','axios','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','toLowerCase','ROSBridge\x20(main)\x20connection\x20error:','samplingRate','message','Access-Control-Allow-Methods','setAttribute','sample_skip','get','reason','roslib','getElementsByTagName','largeDataTopics','registration_token','Registering\x20with\x20server...','login','sample','Enter\x20username:\x20','existsSync','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','\x20attempts\x20starting\x20from\x20','totalTopics','close','throttling','/health','getActiveSessions','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','webrtc_skip','Connected\x20to\x20ROSBridge\x20(WebRTC)','service_response','String\x20value\x20is:\x20','status','APP_USERNAME','post','data','initialize','Appliance\x20is\x20running\x20and\x20authenticated!','Authentication\x20required','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','robot\x20not\x20found','getAttribute','Access-Control-Allow-Origin','hide','replace','),\x20attempting\x20to\x20reconnect...','error','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','some','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','OPEN','Enter\x20password:\x20','filename','./services/webrtcService','handleMessage','proxyPort','constructor','Ros','dotenv','types','Server\x20connection\x20error:','getTopicStrategy'];a1_0x2364=function(){return _0x64ef9b;};return a1_0x2364();}function reloadEnv(){const _0x5501a5=a1_0x8d0930;dotenv[_0x5501a5(0x224)]({'override':!![]}),config[_0x5501a5(0x180)][_0x5501a5(0x206)]=process[_0x5501a5(0x1dc)][_0x5501a5(0x1a8)],config[_0x5501a5(0x180)][_0x5501a5(0x228)]=process['env'][_0x5501a5(0x202)];}async function promptForCredentials(){const _0x23a1ff=a1_0x8d0930,_0x2807e8=prompt(_0x23a1ff(0x199)),_0x1bb843=prompt[_0x23a1ff(0x1b2)](_0x23a1ff(0x1ba));updateEnvFile(_0x2807e8,_0x1bb843),reloadEnv();}function loadApplianceIdentity(){const _0x3d0046=a1_0x8d0930;if(fs[_0x3d0046(0x19a)](APPLIANCE_FILE))try{const _0x52970d=JSON[_0x3d0046(0x1c8)](fs[_0x3d0046(0x205)](APPLIANCE_FILE,_0x3d0046(0x20b)));if(_0x52970d[_0x3d0046(0x181)]&&_0x52970d[_0x3d0046(0x17e)])return robotId=_0x52970d['robotId'],registrationToken=_0x52970d[_0x3d0046(0x17e)],console[_0x3d0046(0x183)]('Loaded\x20appliance\x20identity:',robotId),topicManager[_0x3d0046(0x21b)](_0x52970d),!![];}catch(_0x53959b){console[_0x3d0046(0x1b5)]('Failed\x20to\x20parse\x20appliance\x20identity\x20file:',_0x53959b);}return![];}function saveApplianceIdentity(_0x537a22,_0x6bb3ea){const _0x1d6054=a1_0x8d0930;let _0x439881={};if(fs[_0x1d6054(0x19a)](APPLIANCE_FILE))try{_0x439881=JSON['parse'](fs['readFileSync'](APPLIANCE_FILE,_0x1d6054(0x20b)));}catch(_0x2955b1){_0x439881={};}_0x439881[_0x1d6054(0x181)]=_0x537a22,_0x439881[_0x1d6054(0x17e)]=_0x6bb3ea,fs['writeFileSync'](APPLIANCE_FILE,JSON[_0x1d6054(0x1e0)](_0x439881,null,0x2));}async function registerWithServer(){const _0x6172c7=a1_0x8d0930;try{const _0x2e876c=authService['getToken']();if(!_0x2e876c)throw new Error(_0x6172c7(0x204));let _0x6ba1cc,_0x2c4833=![];while(!![]){try{robotId&&registrationToken?_0x6ba1cc=await axios[_0x6172c7(0x1a9)](config[_0x6172c7(0x1ec)]+_0x6172c7(0x225),{'name':_0x6172c7(0x175),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x6172c7(0x1ff)+_0x2e876c,'Content-Type':'application/json'}}):_0x6ba1cc=await axios['post'](config['serverUrl']+_0x6172c7(0x225),{'name':_0x6172c7(0x175)},{'headers':{'Authorization':_0x6172c7(0x1ff)+_0x2e876c,'Content-Type':_0x6172c7(0x1cf)}});break;}catch(_0x7aeb98){const _0x32d097=_0x7aeb98?.[_0x6172c7(0x17d)]?.[_0x6172c7(0x1aa)]?.[_0x6172c7(0x1b5)]||_0x7aeb98[_0x6172c7(0x18c)];if(!_0x2c4833&&_0x32d097&&_0x32d097[_0x6172c7(0x189)]()[_0x6172c7(0x208)](_0x6172c7(0x1af))){console[_0x6172c7(0x214)](_0x6172c7(0x188));if(fs[_0x6172c7(0x19a)](APPLIANCE_FILE))fs[_0x6172c7(0x1cb)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x2c4833=!![];continue;}throw _0x7aeb98;}}if(!_0x6ba1cc['data']||!_0x6ba1cc[_0x6172c7(0x1aa)]['registration_token']||!_0x6ba1cc['data']['id'])throw new Error(_0x6172c7(0x174));return registrationToken=_0x6ba1cc[_0x6172c7(0x1aa)][_0x6172c7(0x195)],robotId=_0x6ba1cc[_0x6172c7(0x1aa)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x6172c7(0x183)]('Successfully\x20registered\x20with\x20server'),!![];}catch(_0x3126ed){return console[_0x6172c7(0x1b5)](_0x6172c7(0x1ce),_0x3126ed[_0x6172c7(0x18c)]),![];}}function rewriteUrdfMeshUris(_0x2db796){const _0x59eec1=a1_0x8d0930;try{const _0x501c0d=new DOMParser(),_0x5b7004=_0x501c0d['parseFromString'](_0x2db796,_0x59eec1(0x17b));let _0x353a22=0x0,_0xe2fbc7=0x0;const _0x32aeb1=_0x5b7004[_0x59eec1(0x193)](_0x59eec1(0x1fc));for(let _0x3f475e=0x0;_0x3f475e<_0x32aeb1['length'];_0x3f475e++){const _0x551b7b=_0x32aeb1[_0x3f475e],_0x5839f9=_0x551b7b[_0x59eec1(0x1b0)](_0x59eec1(0x1bb)),_0x3a1755=['.stl',_0x59eec1(0x16c),_0x59eec1(0x223),_0x59eec1(0x21e),_0x59eec1(0x16a)],_0x238e95=_0x3a1755[_0x59eec1(0x1b7)](_0x503419=>_0x5839f9[_0x59eec1(0x189)]()[_0x59eec1(0x1d4)](_0x503419));if(_0x5839f9&&_0x5839f9[_0x59eec1(0x201)]('package://')&&_0x238e95){_0x353a22++;const _0x63b252=APPLIANCE_BASE_URL+_0x59eec1(0x218)+encodeURIComponent(_0x5839f9);_0x551b7b[_0x59eec1(0x18e)](_0x59eec1(0x1bb),_0x63b252),_0xe2fbc7++,console['log'](_0x59eec1(0x1fe)+_0x5839f9+_0x59eec1(0x212)+_0x63b252);}}_0x353a22>0x0?console[_0x59eec1(0x183)](_0x59eec1(0x17a)+_0xe2fbc7+_0x59eec1(0x217)+_0x353a22+_0x59eec1(0x1ae)):console[_0x59eec1(0x183)](_0x59eec1(0x176));const _0x123b2c=new XMLSerializer();return _0x123b2c['serializeToString'](_0x5b7004);}catch(_0x33161b){return console[_0x59eec1(0x1b5)](_0x59eec1(0x1d9),_0x33161b),_0x2db796;}}function connectToRosbridge(){const _0x3b0284=a1_0x8d0930;try{rosbridgeWs=new WebSocket(config['rosbridge']['wsEndpoint']),rosbridgeWs['on'](_0x3b0284(0x1f3),()=>{const _0x2968be=_0x3b0284;console[_0x2968be(0x183)](_0x2968be(0x211));const _0x5c999a=require(_0x2968be(0x192)),_0x310785=new _0x5c999a[(_0x2968be(0x1c0))]({'url':config['rosbridge']['wsEndpoint']});_0x310785['on']('connection',()=>{setTimeout(()=>{const _0x1541c7=a1_0x2e25;topicManager['discoverTopics'](_0x310785)[_0x1541c7(0x21a)](_0xf1b297=>{const _0x25217e=_0x1541c7;console[_0x25217e(0x1b5)](_0x25217e(0x1e2),_0xf1b297);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on']('message',_0x479828=>{const _0xe29e77=_0x3b0284;if(serverWs&&serverWs[_0xe29e77(0x169)]===WebSocket[_0xe29e77(0x1b9)]){let _0x3a0af0=_0x479828[_0xe29e77(0x178)]();try{const _0x5bc7f5=JSON['parse'](_0x3a0af0);if(_0x5bc7f5['op']==='publish'&&_0x5bc7f5[_0xe29e77(0x1f9)]){const _0x3c1911=topicManager[_0xe29e77(0x1bd)](_0x5bc7f5);switch(_0x3c1911[_0xe29e77(0x203)]){case _0xe29e77(0x18f):return;case _0xe29e77(0x1a3):return;case'forward':default:_0x3a0af0=JSON[_0xe29e77(0x1e0)](_0x3c1911['message']);break;}}if((_0x5bc7f5['op']===_0xe29e77(0x1a5)||_0x5bc7f5['op']===_0xe29e77(0x227))&&(_0x5bc7f5[_0xe29e77(0x1d3)]==='/rosapi/topics'||_0x5bc7f5['values']&&_0x5bc7f5[_0xe29e77(0x200)]['topics'])){console[_0xe29e77(0x183)](_0xe29e77(0x213));const _0x46100d=_0x5bc7f5[_0xe29e77(0x200)]?.[_0xe29e77(0x1c7)]||[],_0x2a7e85=_0x5bc7f5[_0xe29e77(0x200)]?.[_0xe29e77(0x1c2)]||[],_0xd3f42=_0x46100d[_0xe29e77(0x173)]((_0x49071f,_0x1de9a7)=>{const _0x378308=_0xe29e77,_0x462254=topicManager[_0x378308(0x1c4)](_0x49071f);return{'name':_0x49071f,'type':_0x2a7e85[_0x1de9a7]||_0x378308(0x16f),'throttling':_0x462254?{'isThrottled':_0x462254[_0x378308(0x184)]===_0x378308(0x198),'strategy':_0x462254['strategy'],'samplingRate':_0x462254[_0x378308(0x18b)],'reason':_0x462254[_0x378308(0x191)],'estimatedSize':_0x462254['estimatedSize']}:null};});_0x5bc7f5[_0xe29e77(0x200)]={'topics':_0xd3f42[_0xe29e77(0x173)](_0xe12d19=>_0xe12d19[_0xe29e77(0x177)]),'types':_0xd3f42['map'](_0x47c8f2=>_0x47c8f2[_0xe29e77(0x1fd)]),'throttling':_0xd3f42[_0xe29e77(0x173)](_0x43dc7b=>_0x43dc7b[_0xe29e77(0x19f)])},_0x3a0af0=JSON['stringify'](_0x5bc7f5),console['log']('[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client');}if(_0x5bc7f5['op']===_0xe29e77(0x1cc)&&_0x5bc7f5['topic']===_0xe29e77(0x1ef))try{const _0x275277=_0x5bc7f5[_0xe29e77(0x1f8)][_0xe29e77(0x1aa)],_0x42e0c4=rewriteUrdfMeshUris(_0x275277);_0x5bc7f5[_0xe29e77(0x1f8)][_0xe29e77(0x1aa)]=_0x42e0c4,_0x3a0af0=JSON[_0xe29e77(0x1e0)](_0x5bc7f5);}catch(_0x5ed2a6){console[_0xe29e77(0x1b5)](_0xe29e77(0x1b8),_0x5ed2a6);}}catch(_0x3dabca){console[_0xe29e77(0x214)](_0xe29e77(0x1e4),_0x3dabca[_0xe29e77(0x18c)]);}serverWs[_0xe29e77(0x1ea)](_0x3a0af0);}}),rosbridgeWs['on'](_0x3b0284(0x19e),()=>{const _0x44c9b7=_0x3b0284;console['log']('Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x44c9b7(0x229)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x3b0284(0x1b5),_0x16676f=>{const _0x550048=_0x3b0284;console[_0x550048(0x1b5)](_0x550048(0x18a),_0x16676f);});}catch(_0x36cec1){console['error']('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):',_0x36cec1),setTimeout(connectToRosbridge,0x1388);}}function a1_0x2e25(_0x2699d4,_0x5b3d36){const _0x294356=a1_0x2364();return a1_0x2e25=function(_0x19e648,_0x49fd82){_0x19e648=_0x19e648-0x169;let _0x23640c=_0x294356[_0x19e648];return _0x23640c;},a1_0x2e25(_0x2699d4,_0x5b3d36);}function connectToRosbridgeWebRTC(){const _0x11aea2=a1_0x8d0930;try{rosbridgeWebRTCWs=new WebSocket(config['rosbridge'][_0x11aea2(0x1d1)]),rosbridgeWebRTCWs['on'](_0x11aea2(0x1f3),()=>{const _0x37e393=_0x11aea2;console[_0x37e393(0x183)](_0x37e393(0x1a4)),webrtcService[_0x37e393(0x1ab)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on']('message',_0xcbfc00=>{}),rosbridgeWebRTCWs['on'](_0x11aea2(0x19e),()=>{const _0x33124a=_0x11aea2;console[_0x33124a(0x183)](_0x33124a(0x19b)),webrtcService['stopAllSessions'](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on']('error',_0x3a21c1=>{const _0x4de459=_0x11aea2;console[_0x4de459(0x1b5)]('ROSBridge\x20(WebRTC)\x20connection\x20error:',_0x3a21c1);});}catch(_0x4d59db){console[_0x11aea2(0x1b5)](_0x11aea2(0x1a2),_0x4d59db),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x52b24d=a1_0x8d0930;try{if(!registrationToken)throw new Error(_0x52b24d(0x1ed));const _0x253bbf=config[_0x52b24d(0x1ec)][_0x52b24d(0x1b3)](_0x52b24d(0x209),'ws')+_0x52b24d(0x1f5)+registrationToken;serverWs=new WebSocket(_0x253bbf),serverWs['on'](_0x52b24d(0x1f3),()=>{const _0x21254d=_0x52b24d;console[_0x21254d(0x183)](_0x21254d(0x16d)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x21254d(0x169)]===WebSocket['OPEN']&&webrtcService[_0x21254d(0x1ab)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x52b24d(0x18c),_0x12a115=>{const _0x43bdf3=_0x52b24d;if(rosbridgeWs&&rosbridgeWs[_0x43bdf3(0x169)]===WebSocket[_0x43bdf3(0x1b9)]){let _0x43c30e=_0x12a115[_0x43bdf3(0x178)]();try{const _0x4f5a58=JSON[_0x43bdf3(0x1c8)](_0x43c30e);if(webrtcService[_0x43bdf3(0x1bd)](_0x4f5a58))return;if(_0x4f5a58['op']==='get_urdf_param'&&typeof _0x4f5a58[_0x43bdf3(0x1d5)]===_0x43bdf3(0x16e)&&_0x4f5a58[_0x43bdf3(0x1da)])try{console[_0x43bdf3(0x183)]('[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20'+_0x4f5a58[_0x43bdf3(0x1d5)]);const _0x1c0660=execSync(_0x43bdf3(0x1c5)+_0x4f5a58[_0x43bdf3(0x1d5)],{'encoding':_0x43bdf3(0x20b)})['trim']();let _0x2a1055=_0x1c0660;_0x1c0660['startsWith'](_0x43bdf3(0x1a6))&&(_0x2a1055=_0x1c0660[_0x43bdf3(0x216)](_0x43bdf3(0x1a6)[_0x43bdf3(0x1f4)]()));_0x2a1055[_0x43bdf3(0x201)]('\x22')&&_0x2a1055[_0x43bdf3(0x1d4)]('\x22')&&(_0x2a1055=_0x2a1055['slice'](0x1,-0x1));_0x2a1055=_0x2a1055[_0x43bdf3(0x1b3)](/\\n/g,'\x0a')[_0x43bdf3(0x1b3)](/\\"/g,'\x22');const _0x905c98={'op':'urdf_param_data','request_id':_0x4f5a58['request_id'],'data':_0x2a1055};serverWs['send'](JSON[_0x43bdf3(0x1e0)](_0x905c98)),console[_0x43bdf3(0x183)](_0x43bdf3(0x1e3)+_0x4f5a58[_0x43bdf3(0x1d5)]);return;}catch(_0x4b2ef3){console[_0x43bdf3(0x1b5)](_0x43bdf3(0x1b6),_0x4b2ef3);const _0x33790b={'op':'urdf_param_data','request_id':_0x4f5a58['request_id'],'error':_0x4b2ef3['message']};serverWs[_0x43bdf3(0x1ea)](JSON[_0x43bdf3(0x1e0)](_0x33790b));return;}if(_0x4f5a58['op']===_0x43bdf3(0x1cd)&&typeof _0x4f5a58['uri']===_0x43bdf3(0x16e)&&_0x4f5a58[_0x43bdf3(0x1da)])try{const _0x101b24=_0x4f5a58['uri']['match'](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x101b24){const _0x423d04=_0x101b24[0x1],_0x1fb37b=_0x101b24[0x2],_0xbc7966=execSync(_0x43bdf3(0x20d)+_0x423d04,{'encoding':_0x43bdf3(0x20b)})[_0x43bdf3(0x1dd)](),_0x5f5a94=path[_0x43bdf3(0x1e7)](_0xbc7966,_0x43bdf3(0x221),_0x423d04,_0x1fb37b);if(!fs[_0x43bdf3(0x19a)](_0x5f5a94))throw new Error('Mesh\x20file\x20not\x20found:\x20'+_0x5f5a94);const _0x57d01b=fs['readFileSync'](_0x5f5a94),_0xf5233e={'op':_0x43bdf3(0x215),'request_id':_0x4f5a58['request_id'],'data':_0x57d01b[_0x43bdf3(0x178)]('base64')};serverWs['send'](JSON['stringify'](_0xf5233e)),console['log'](_0x43bdf3(0x207)+_0x4f5a58[_0x43bdf3(0x186)]+_0x43bdf3(0x1d0)+_0x5f5a94);return;}}catch(_0x3f6fab){console[_0x43bdf3(0x1b5)]('[MESH]\x20Error\x20serving\x20mesh:',_0x3f6fab);const _0xe53f80={'op':_0x43bdf3(0x215),'request_id':_0x4f5a58[_0x43bdf3(0x1da)],'error':_0x3f6fab[_0x43bdf3(0x18c)]};serverWs['send'](JSON[_0x43bdf3(0x1e0)](_0xe53f80));return;}rosbridgeWs['send'](_0x43c30e);}catch(_0x435953){rosbridgeWs[_0x43bdf3(0x1ea)](_0x43c30e);}}}),serverWs['on'](_0x52b24d(0x19e),(_0x482a7f,_0x562a13)=>{const _0x50a3e1=_0x52b24d;console[_0x50a3e1(0x183)]('Disconnected\x20from\x20server\x20('+_0x482a7f+':\x20'+_0x562a13+_0x50a3e1(0x1b4)),webrtcService['stopAllSessions'](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x52b24d(0x1b5),_0x33a06a=>{const _0x122b09=_0x52b24d;console[_0x122b09(0x1b5)](_0x122b09(0x1c3),_0x33a06a);});}catch(_0x3aeb56){console[_0x52b24d(0x1b5)](_0x52b24d(0x210),_0x3aeb56),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x17162b,_0x3f83f9,_0x2060d8)=>{const _0x4d3a0c=a1_0x8d0930;if(!authService['isAuthenticated']()){console[_0x4d3a0c(0x183)]('Attempting\x20to\x20login\x20to:',config[_0x4d3a0c(0x1ec)]);const _0x3c1520=await authService[_0x4d3a0c(0x197)]();if(!_0x3c1520)return _0x3f83f9[_0x4d3a0c(0x1a7)](0x191)[_0x4d3a0c(0x1f1)]({'error':_0x4d3a0c(0x1ad)});}_0x2060d8();};app['use']((_0xaddc51,_0x85519d,_0x4de23d)=>{const _0x3443b8=a1_0x8d0930;_0x85519d[_0x3443b8(0x16b)](_0x3443b8(0x1b1),'*'),_0x85519d[_0x3443b8(0x16b)](_0x3443b8(0x18d),_0x3443b8(0x20f)),_0x85519d[_0x3443b8(0x16b)](_0x3443b8(0x222),'Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization'),_0xaddc51['method']==='OPTIONS'?_0x85519d[_0x3443b8(0x22a)](0xc8):_0x4de23d();}),app[a1_0x8d0930(0x190)]('/',requireAuth,(_0x104260,_0x369476)=>{const _0x3b4dc8=a1_0x8d0930;_0x369476['send'](_0x3b4dc8(0x1ac));}),app[a1_0x8d0930(0x190)](a1_0x8d0930(0x1a0),async(_0x1d480f,_0xb5052)=>{const _0x1beda4=a1_0x8d0930,_0x4f85d0=authService['isAuthenticated'](),_0x1294a7=webrtcService[_0x1beda4(0x1a1)](),_0x1e0132=webrtcService[_0x1beda4(0x1e5)](),_0x12d70a=topicManager['getStatistics']();_0xb5052[_0x1beda4(0x1f1)]({'status':'ok','environment':process[_0x1beda4(0x1dc)][_0x1beda4(0x20a)]||_0x1beda4(0x21f),'backendUrl':config['serverUrl'],'rosbridgeUrl':config[_0x1beda4(0x20e)][_0x1beda4(0x1d1)],'proxyPort':port,'authenticated':_0x4f85d0,'topicManagement':{'discovered':_0x12d70a[_0x1beda4(0x19d)],'strategies':_0x12d70a[_0x1beda4(0x1f6)],'largeDataTopics':_0x12d70a[_0x1beda4(0x194)][_0x1beda4(0x1f4)],'largeTopicsList':_0x12d70a['largeDataTopics']},'webrtc':{'activeSessions':_0x1294a7['length'],'sharedVideoSources':_0x1e0132[_0x1beda4(0x1f4)],'sessions':_0x1294a7,'sharedSources':_0x1e0132}});});const getInitialPort=()=>{const _0x65b2cb=a1_0x8d0930;if(process[_0x65b2cb(0x1dc)][_0x65b2cb(0x1c9)])return parseInt(process[_0x65b2cb(0x1dc)]['PORT'],0xa);return config[_0x65b2cb(0x20e)][_0x65b2cb(0x1be)];};async function listenWithRetries(_0x18d3b9,_0x555552,_0x47544a=0xa){const _0x294516=a1_0x8d0930;let _0x37828f=_0x555552;for(let _0xa075d5=0x1;_0xa075d5<=_0x47544a;_0xa075d5++){try{return await new Promise((_0x15dc48,_0x2ff6f8)=>{const _0x365223=a1_0x2e25,_0x844798=_0x18d3b9[_0x365223(0x17c)](_0x37828f,()=>{const _0x2ff654=_0x365223;console[_0x2ff654(0x183)](_0x2ff654(0x171)+_0x37828f),_0x15dc48(_0x844798);});_0x844798['on']('error',_0x2e5e68=>{const _0x11ecd3=_0x365223;_0x2e5e68[_0x11ecd3(0x1df)]==='EADDRINUSE'?(console[_0x11ecd3(0x214)](_0x11ecd3(0x1f0)+_0x37828f+_0x11ecd3(0x219)),_0x2ff6f8(_0x2e5e68)):_0x2ff6f8(_0x2e5e68);});}),_0x37828f;}catch(_0x158b56){_0x37828f++;}}throw new Error(_0x294516(0x185)+_0x47544a+_0x294516(0x19c)+_0x555552);}const startApp=async()=>{const _0x54bfba=a1_0x8d0930;try{let _0x1f857d=await authService[_0x54bfba(0x197)]();while(!_0x1f857d){console[_0x54bfba(0x183)](_0x54bfba(0x170)),await promptForCredentials(),_0x1f857d=await authService['login']();}console[_0x54bfba(0x183)](_0x54bfba(0x179));!loadApplianceIdentity()&&console[_0x54bfba(0x183)](_0x54bfba(0x1d8));console['log'](_0x54bfba(0x196));const _0x3a3244=await registerWithServer();if(!_0x3a3244)throw new Error('Failed\x20to\x20register\x20with\x20server');connectToRosbridge(),connectToServer();const _0xe0ee8e=getInitialPort();await listenWithRetries(app,_0xe0ee8e,0xa);}catch(_0x579a67){console['error']('Failed\x20to\x20start\x20application:',_0x579a67),process['exit'](0x1);}};setInterval(async()=>{const _0x4bcc9e=a1_0x8d0930;try{if(robotId){const _0x3def39=authService[_0x4bcc9e(0x22b)]();await axios[_0x4bcc9e(0x1a9)](config[_0x4bcc9e(0x1ec)]+'/appliance/ping',{'robotId':robotId},{'headers':{'Authorization':'Bearer\x20'+_0x3def39,'Content-Type':_0x4bcc9e(0x1cf)}});}}catch(_0x436bfb){console['error'](_0x4bcc9e(0x1fa),_0x436bfb[_0x4bcc9e(0x18c)]);}},0x1388),startApp();