const a1_0x396c1f=a1_0xfd3e;function a1_0xfd3e(_0x3e2836,_0x2e8582){const _0x2b48cb=a1_0xfb50();return a1_0xfd3e=function(_0x23bd4e,_0x3a33da){_0x23bd4e=_0x23bd4e-0x166;let _0xfb5053=_0x2b48cb[_0x23bd4e];return _0xfb5053;},a1_0xfd3e(_0x3e2836,_0x2e8582);}(function(_0x79bd6a,_0x5badea){const _0xd581a7=a1_0xfd3e,_0x4f752e=_0x79bd6a();while(!![]){try{const _0x7ba702=-parseInt(_0xd581a7(0x213))/0x1+parseInt(_0xd581a7(0x1b2))/0x2*(parseInt(_0xd581a7(0x1a2))/0x3)+-parseInt(_0xd581a7(0x1c1))/0x4+parseInt(_0xd581a7(0x1be))/0x5+parseInt(_0xd581a7(0x191))/0x6*(-parseInt(_0xd581a7(0x1f6))/0x7)+-parseInt(_0xd581a7(0x1f8))/0x8+parseInt(_0xd581a7(0x170))/0x9;if(_0x7ba702===_0x5badea)break;else _0x4f752e['push'](_0x4f752e['shift']());}catch(_0x2aaad8){_0x4f752e['push'](_0x4f752e['shift']());}}}(a1_0xfb50,0xa4c07));const a1_0x3a33da=(function(){let _0x49c281=!![];return function(_0x2b57f8,_0x211846){const _0x2863ba=_0x49c281?function(){const _0x16b4b2=a1_0xfd3e;if(_0x211846){const _0x572807=_0x211846[_0x16b4b2(0x221)](_0x2b57f8,arguments);return _0x211846=null,_0x572807;}}:function(){};return _0x49c281=![],_0x2863ba;};}()),a1_0x23bd4e=a1_0x3a33da(this,function(){const _0x1dfb13=a1_0xfd3e;return a1_0x23bd4e[_0x1dfb13(0x194)]()[_0x1dfb13(0x17b)]('(((.+)+)+)+$')[_0x1dfb13(0x194)]()[_0x1dfb13(0x1ba)](a1_0x23bd4e)['search'](_0x1dfb13(0x214));});a1_0x23bd4e();const dotenv=require(a1_0x396c1f(0x1f3));dotenv[a1_0x396c1f(0x172)]();function a1_0xfb50(){const _0x3b154a=['getAttribute','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','trim','.env','samplingRate','15884784VdCzbZ','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','config','[URDF\x20REWRITE]\x20Rewrote\x20','readyState','topic','getTopicStrategy','Connected\x20to\x20ROSBridge\x20(WebRTC)','utf8','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','Bearer\x20','search','APP_USERNAME=','Access-Control-Allow-Headers','slice','String\x20value\x20is:\x20','urdf_param_data','exit','catch','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','Access-Control-Allow-Origin','env','get','totalTopics','application/json','string','roslib','getToken','writeFileSync','stringify','path','Connected\x20to\x20server','Registering\x20with\x20server...','387048RHLobY','credentials','topics','toString','reason','open','NOT\x20SET','getStatistics','WSL\x20Appliance','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','Enter\x20password:\x20','Server\x20connection\x20error:','/appliance/ping','toLowerCase','APPLIANCE_BASE_URL','stopAllSessions','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','532341gZaEOX','base64','values','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','ROSBridge\x20(main)\x20connection\x20error:','param_name','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','/appliance/register','axios','robot\x20not\x20found','join','call_service','error','ROSBridge\x20(WebRTC)\x20connection\x20error:','isAuthenticated','getSharedVideoSources','6dYlUpp','[MESH]\x20Error\x20serving\x20mesh:','response','login','./services/webrtcService','registration_token','discoverTopics','largeDataTopics','constructor','username','Loaded\x20credentials:','./services/TopicManager','4108095pTnWmy','Failed\x20to\x20start\x20application:','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','3347620VOwrVB','production','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','parse','\x20from\x20','data','service','status','/health','length','\x20attempts\x20starting\x20from\x20','express','APP_PASSWORD','\x20of\x20','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','endsWith','json','Authentication\x20required','password','text/xml','send','Failed\x20to\x20register\x20with\x20server:','types','prompt-sync','Proxy\x20listening\x20on\x20port:\x20','connection','Port\x20','strategies','Enter\x20username:\x20','Connected\x20to\x20ROSBridge\x20(main)','.appliance.json','forward','estimatedSize','uri','Failed\x20to\x20register\x20with\x20server','post','rosbridge','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','development','.stl','warn','mesh','NODE_ENV','existsSync','serializeToString','/robot_description','handleMessage','robotId','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','dotenv','Appliance\x20is\x20running\x20and\x20authenticated!','message','70cVsgrL','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','3557120oXKHYQ','map','service_response','Successfully\x20logged\x20in','/rosapi/topics','Failed\x20to\x20ping\x20server:','Loaded\x20appliance\x20identity:','PORT','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','filename','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','.dae','package://','use','readFileSync','Ros','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','mesh_data','initialize','hide','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','xmldom','request_id','Environment:\x20','code','Please\x20run:\x20./setup.sh\x20reconfigure','517488IktLRU','(((.+)+)+)+$','\x0aAPP_PASSWORD=','Access-Control-Allow-Methods','APP_USERNAME','unknown','OPTIONS','close','Successfully\x20registered\x20with\x20server','/rosbridge?type=appliance&token=','registrationToken','serverUrl','SET','Disconnected\x20from\x20server\x20(','apply','startsWith','header','name','msg','Mesh\x20file\x20not\x20found:\x20','replace','OPEN','strategy','ros2\x20param\x20get\x20','method','Initial\x20credentials\x20loaded\x20from\x20environment','proxyPort','Topic\x20discovery\x20failed:','log','parseFromString','wsEndpoint'];a1_0xfb50=function(){return _0x3b154a;};return a1_0xfb50();}const express=require(a1_0x396c1f(0x1cc)),config=require('./config');process['env'][a1_0x396c1f(0x217)]&&process[a1_0x396c1f(0x185)][a1_0x396c1f(0x1cd)]&&(config[a1_0x396c1f(0x192)][a1_0x396c1f(0x1bb)]=process[a1_0x396c1f(0x185)]['APP_USERNAME'],config[a1_0x396c1f(0x192)][a1_0x396c1f(0x1d4)]=process[a1_0x396c1f(0x185)][a1_0x396c1f(0x1cd)],console[a1_0x396c1f(0x166)](a1_0x396c1f(0x22c)));const authService=require('./services/auth'),webrtcService=require(a1_0x396c1f(0x1b6)),topicManager=require(a1_0x396c1f(0x1bd)),WebSocket=require('ws'),axios=require(a1_0x396c1f(0x1aa)),fs=require('fs'),prompt=require(a1_0x396c1f(0x1d9))({'sigint':!![]}),app=express(),port=process['env'][a1_0x396c1f(0x1ff)]||config[a1_0x396c1f(0x1e6)]['proxyPort'],APPLIANCE_FILE=a1_0x396c1f(0x1e0),{DOMParser,XMLSerializer}=require(a1_0x396c1f(0x20e)),path=require(a1_0x396c1f(0x18e)),{execSync}=require('child_process'),APPLIANCE_BASE_URL=process[a1_0x396c1f(0x185)][a1_0x396c1f(0x19f)]||'';console[a1_0x396c1f(0x166)](a1_0x396c1f(0x210)+(process['env'][a1_0x396c1f(0x1ec)]||a1_0x396c1f(0x1e8))),console['log']('Backend\x20Server\x20URL:\x20'+config[a1_0x396c1f(0x21e)]),console[a1_0x396c1f(0x166)]('ROSBridge\x20WebSocket\x20URL:\x20'+config[a1_0x396c1f(0x1e6)][a1_0x396c1f(0x168)]),console[a1_0x396c1f(0x166)](a1_0x396c1f(0x1da)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x5ccf6f,_0x5f4193){const _0x28c53d=a1_0x396c1f;fs[_0x28c53d(0x18c)](_0x28c53d(0x16e),_0x28c53d(0x17c)+_0x5ccf6f+_0x28c53d(0x215)+_0x5f4193+'\x0a');}function reloadEnv(){const _0x3711c6=a1_0x396c1f;dotenv['config']({'override':!![]}),config[_0x3711c6(0x192)][_0x3711c6(0x1bb)]=process['env']['APP_USERNAME'],config[_0x3711c6(0x192)][_0x3711c6(0x1d4)]=process['env'][_0x3711c6(0x1cd)],console[_0x3711c6(0x166)](_0x3711c6(0x1bc),{'username':config[_0x3711c6(0x192)]['username']?_0x3711c6(0x21f):_0x3711c6(0x197),'password':config[_0x3711c6(0x192)]['password']?_0x3711c6(0x21f):_0x3711c6(0x197)});}async function promptForCredentials(){const _0x304176=a1_0x396c1f;process[_0x304176(0x185)][_0x304176(0x1ec)]===_0x304176(0x1c2)&&(console[_0x304176(0x1ae)]('Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file'),console[_0x304176(0x1ae)](_0x304176(0x212)),process[_0x304176(0x181)](0x1));const _0x2decfb=prompt(_0x304176(0x1de)),_0x74f914=prompt[_0x304176(0x20c)](_0x304176(0x19b));updateEnvFile(_0x2decfb,_0x74f914),reloadEnv();}function loadApplianceIdentity(){const _0x26797e=a1_0x396c1f;if(fs[_0x26797e(0x1ed)](APPLIANCE_FILE))try{const _0xcf6b86=JSON[_0x26797e(0x1c4)](fs[_0x26797e(0x207)](APPLIANCE_FILE,'utf8'));if(_0xcf6b86[_0x26797e(0x1f1)]&&_0xcf6b86[_0x26797e(0x21d)])return robotId=_0xcf6b86['robotId'],registrationToken=_0xcf6b86[_0x26797e(0x21d)],console[_0x26797e(0x166)](_0x26797e(0x1fe),robotId),topicManager['loadConfig'](_0xcf6b86),!![];}catch(_0x1bc8fd){console[_0x26797e(0x1ae)](_0x26797e(0x1cf),_0x1bc8fd);}return![];}function saveApplianceIdentity(_0x5cd9ca,_0x7b40fb){const _0x3ea0a9=a1_0x396c1f;let _0x53742a={};if(fs[_0x3ea0a9(0x1ed)](APPLIANCE_FILE))try{_0x53742a=JSON['parse'](fs[_0x3ea0a9(0x207)](APPLIANCE_FILE,_0x3ea0a9(0x178)));}catch(_0x1ece22){_0x53742a={};}_0x53742a[_0x3ea0a9(0x1f1)]=_0x5cd9ca,_0x53742a[_0x3ea0a9(0x21d)]=_0x7b40fb,fs[_0x3ea0a9(0x18c)](APPLIANCE_FILE,JSON['stringify'](_0x53742a,null,0x2));}async function registerWithServer(){const _0x9ba2b6=a1_0x396c1f;try{const _0x155607=authService['getToken']();if(!_0x155607)throw new Error('Not\x20authenticated');let _0x360c7e,_0x3e3a32=![];while(!![]){try{robotId&&registrationToken?_0x360c7e=await axios[_0x9ba2b6(0x1e5)](config[_0x9ba2b6(0x21e)]+_0x9ba2b6(0x1a9),{'name':_0x9ba2b6(0x199),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':'Bearer\x20'+_0x155607,'Content-Type':_0x9ba2b6(0x188)}}):_0x360c7e=await axios['post'](config['serverUrl']+_0x9ba2b6(0x1a9),{'name':_0x9ba2b6(0x199)},{'headers':{'Authorization':_0x9ba2b6(0x17a)+_0x155607,'Content-Type':'application/json'}});break;}catch(_0x5e01b1){const _0x2cc675=_0x5e01b1?.[_0x9ba2b6(0x1b4)]?.[_0x9ba2b6(0x1c6)]?.[_0x9ba2b6(0x1ae)]||_0x5e01b1[_0x9ba2b6(0x1f5)];if(!_0x3e3a32&&_0x2cc675&&_0x2cc675[_0x9ba2b6(0x19e)]()['includes'](_0x9ba2b6(0x1ab))){console[_0x9ba2b6(0x1ea)](_0x9ba2b6(0x1d0));if(fs['existsSync'](APPLIANCE_FILE))fs['unlinkSync'](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x3e3a32=!![];continue;}throw _0x5e01b1;}}if(!_0x360c7e[_0x9ba2b6(0x1c6)]||!_0x360c7e[_0x9ba2b6(0x1c6)]['registration_token']||!_0x360c7e[_0x9ba2b6(0x1c6)]['id'])throw new Error(_0x9ba2b6(0x202));return registrationToken=_0x360c7e['data'][_0x9ba2b6(0x1b7)],robotId=_0x360c7e['data']['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x9ba2b6(0x166)](_0x9ba2b6(0x21b)),!![];}catch(_0x24c2f3){return console[_0x9ba2b6(0x1ae)](_0x9ba2b6(0x1d7),_0x24c2f3[_0x9ba2b6(0x1f5)]),![];}}function rewriteUrdfMeshUris(_0x532403){const _0xc6c3ea=a1_0x396c1f;try{const _0x52621e=new DOMParser(),_0x3d47d3=_0x52621e[_0xc6c3ea(0x167)](_0x532403,_0xc6c3ea(0x1d5));let _0x564422=0x0,_0x35ca7b=0x0;const _0x2e18d1=_0x3d47d3['getElementsByTagName'](_0xc6c3ea(0x1eb));for(let _0xfaaede=0x0;_0xfaaede<_0x2e18d1[_0xc6c3ea(0x1ca)];_0xfaaede++){const _0x80e70e=_0x2e18d1[_0xfaaede],_0x1b1b39=_0x80e70e[_0xc6c3ea(0x169)](_0xc6c3ea(0x201)),_0x4dca29=[_0xc6c3ea(0x1e9),_0xc6c3ea(0x204),'.obj','.ply','.mesh'],_0x415f9a=_0x4dca29['some'](_0x2dd82c=>_0x1b1b39[_0xc6c3ea(0x19e)]()[_0xc6c3ea(0x1d1)](_0x2dd82c));if(_0x1b1b39&&_0x1b1b39['startsWith'](_0xc6c3ea(0x205))&&_0x415f9a){_0x564422++;const _0x2bdc0b=APPLIANCE_BASE_URL+'/ros/mesh?uri='+encodeURIComponent(_0x1b1b39);_0x80e70e['setAttribute'](_0xc6c3ea(0x201),_0x2bdc0b),_0x35ca7b++,console['log'](_0xc6c3ea(0x16b)+_0x1b1b39+'\x20->\x20'+_0x2bdc0b);}}_0x564422>0x0?console['log'](_0xc6c3ea(0x173)+_0x35ca7b+_0xc6c3ea(0x1ce)+_0x564422+_0xc6c3ea(0x20d)):console[_0xc6c3ea(0x166)](_0xc6c3ea(0x179));const _0x14a00e=new XMLSerializer();return _0x14a00e[_0xc6c3ea(0x1ee)](_0x3d47d3);}catch(_0xdd9730){return console['error'](_0xc6c3ea(0x209),_0xdd9730),_0x532403;}}function connectToRosbridge(){const _0x595f38=a1_0x396c1f;try{rosbridgeWs=new WebSocket(config[_0x595f38(0x1e6)][_0x595f38(0x168)]),rosbridgeWs['on']('open',()=>{const _0x13fe8c=_0x595f38;console['log'](_0x13fe8c(0x1df));const _0x260d99=require(_0x13fe8c(0x18a)),_0x1980ae=new _0x260d99[(_0x13fe8c(0x208))]({'url':config[_0x13fe8c(0x1e6)]['wsEndpoint']});_0x1980ae['on'](_0x13fe8c(0x1db),()=>{setTimeout(()=>{const _0x10d8c1=a1_0xfd3e;topicManager[_0x10d8c1(0x1b8)](_0x1980ae)[_0x10d8c1(0x182)](_0x518985=>{const _0x18cd82=_0x10d8c1;console[_0x18cd82(0x1ae)](_0x18cd82(0x22e),_0x518985);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on']('message',_0x665250=>{const _0x3c454d=_0x595f38;if(serverWs&&serverWs[_0x3c454d(0x174)]===WebSocket[_0x3c454d(0x228)]){let _0x256832=_0x665250[_0x3c454d(0x194)]();try{const _0x53d469=JSON[_0x3c454d(0x1c4)](_0x256832);if(_0x53d469['op']==='publish'&&_0x53d469[_0x3c454d(0x175)]){const _0x3c1daa=topicManager[_0x3c454d(0x1f0)](_0x53d469);switch(_0x3c1daa['action']){case'sample_skip':return;case'webrtc_skip':return;case _0x3c454d(0x1e1):default:_0x256832=JSON[_0x3c454d(0x18d)](_0x3c1daa[_0x3c454d(0x1f5)]);break;}}if((_0x53d469['op']===_0x3c454d(0x1fa)||_0x53d469['op']===_0x3c454d(0x1ad))&&(_0x53d469[_0x3c454d(0x1c7)]===_0x3c454d(0x1fc)||_0x53d469['values']&&_0x53d469[_0x3c454d(0x1a4)][_0x3c454d(0x193)])){console[_0x3c454d(0x166)]('[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata');const _0x5e48ae=_0x53d469[_0x3c454d(0x1a4)]?.[_0x3c454d(0x193)]||[],_0x2815f8=_0x53d469[_0x3c454d(0x1a4)]?.[_0x3c454d(0x1d8)]||[],_0x216b7f=_0x5e48ae[_0x3c454d(0x1f9)]((_0x5c8f25,_0x36d179)=>{const _0x4d3e23=_0x3c454d,_0x5d34a0=topicManager[_0x4d3e23(0x176)](_0x5c8f25);return{'name':_0x5c8f25,'type':_0x2815f8[_0x36d179]||_0x4d3e23(0x218),'throttling':_0x5d34a0?{'isThrottled':_0x5d34a0[_0x4d3e23(0x229)]==='sample','strategy':_0x5d34a0['strategy'],'samplingRate':_0x5d34a0[_0x4d3e23(0x16f)],'reason':_0x5d34a0[_0x4d3e23(0x195)],'estimatedSize':_0x5d34a0[_0x4d3e23(0x1e2)]}:null};});_0x53d469[_0x3c454d(0x1a4)]={'topics':_0x216b7f['map'](_0x8f7960=>_0x8f7960[_0x3c454d(0x224)]),'types':_0x216b7f['map'](_0x29d2eb=>_0x29d2eb['type']),'throttling':_0x216b7f[_0x3c454d(0x1f9)](_0x54479c=>_0x54479c['throttling'])},_0x256832=JSON['stringify'](_0x53d469),console[_0x3c454d(0x166)](_0x3c454d(0x19a));}if(_0x53d469['op']==='publish'&&_0x53d469['topic']===_0x3c454d(0x1ef))try{const _0x5813e1=_0x53d469[_0x3c454d(0x225)][_0x3c454d(0x1c6)],_0x191e98=rewriteUrdfMeshUris(_0x5813e1);_0x53d469[_0x3c454d(0x225)][_0x3c454d(0x1c6)]=_0x191e98,_0x256832=JSON[_0x3c454d(0x18d)](_0x53d469);}catch(_0x43cddb){console[_0x3c454d(0x1ae)](_0x3c454d(0x1c0),_0x43cddb);}}catch(_0x31191e){console[_0x3c454d(0x1ea)](_0x3c454d(0x1e7),_0x31191e[_0x3c454d(0x1f5)]);}serverWs[_0x3c454d(0x1d6)](_0x256832);}}),rosbridgeWs['on'](_0x595f38(0x21a),()=>{const _0x376491=_0x595f38;console[_0x376491(0x166)](_0x376491(0x1a8)),webrtcService[_0x376491(0x1a0)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on']('error',_0x5e7165=>{const _0x4b0648=_0x595f38;console[_0x4b0648(0x1ae)](_0x4b0648(0x1a6),_0x5e7165);});}catch(_0x506e11){console[_0x595f38(0x1ae)](_0x595f38(0x1a5),_0x506e11),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x305200=a1_0x396c1f;try{rosbridgeWebRTCWs=new WebSocket(config[_0x305200(0x1e6)][_0x305200(0x168)]),rosbridgeWebRTCWs['on'](_0x305200(0x196),()=>{const _0x3f8d2d=_0x305200;console['log'](_0x3f8d2d(0x177)),webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on']('message',_0x3c664c=>{}),rosbridgeWebRTCWs['on']('close',()=>{const _0x3bc4c2=_0x305200;console['log'](_0x3bc4c2(0x203)),webrtcService[_0x3bc4c2(0x1a0)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x305200(0x1ae),_0x481d94=>{const _0x45250b=_0x305200;console[_0x45250b(0x1ae)](_0x45250b(0x1af),_0x481d94);});}catch(_0x1ceff1){console[_0x305200(0x1ae)](_0x305200(0x171),_0x1ceff1),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x3f92ec=a1_0x396c1f;try{if(!registrationToken)throw new Error(_0x3f92ec(0x183));const _0x6692c5=config[_0x3f92ec(0x21e)][_0x3f92ec(0x227)]('http','ws')+_0x3f92ec(0x21c)+registrationToken;serverWs=new WebSocket(_0x6692c5),serverWs['on']('open',()=>{const _0x3e2e37=_0x3f92ec;console[_0x3e2e37(0x166)](_0x3e2e37(0x18f)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs['readyState']===WebSocket[_0x3e2e37(0x228)]&&webrtcService[_0x3e2e37(0x20b)](rosbridgeWebRTCWs,serverWs);}),serverWs['on']('message',_0x4f982d=>{const _0xb425cf=_0x3f92ec;if(rosbridgeWs&&rosbridgeWs[_0xb425cf(0x174)]===WebSocket['OPEN']){let _0x5b47ed=_0x4f982d[_0xb425cf(0x194)]();try{const _0x18c8d8=JSON[_0xb425cf(0x1c4)](_0x5b47ed);if(webrtcService['handleMessage'](_0x18c8d8))return;if(_0x18c8d8['op']==='get_urdf_param'&&typeof _0x18c8d8[_0xb425cf(0x1a7)]===_0xb425cf(0x189)&&_0x18c8d8['request_id'])try{console[_0xb425cf(0x166)](_0xb425cf(0x1c3)+_0x18c8d8[_0xb425cf(0x1a7)]);const _0x12eb43=execSync(_0xb425cf(0x22a)+_0x18c8d8[_0xb425cf(0x1a7)],{'encoding':_0xb425cf(0x178)})[_0xb425cf(0x16d)]();let _0x7969ef=_0x12eb43;_0x12eb43['startsWith'](_0xb425cf(0x17f))&&(_0x7969ef=_0x12eb43['substring'](_0xb425cf(0x17f)[_0xb425cf(0x1ca)]()));_0x7969ef[_0xb425cf(0x222)]('\x22')&&_0x7969ef[_0xb425cf(0x1d1)]('\x22')&&(_0x7969ef=_0x7969ef[_0xb425cf(0x17e)](0x1,-0x1));_0x7969ef=_0x7969ef[_0xb425cf(0x227)](/\\n/g,'\x0a')['replace'](/\\"/g,'\x22');const _0x5e975d={'op':'urdf_param_data','request_id':_0x18c8d8[_0xb425cf(0x20f)],'data':_0x7969ef};serverWs[_0xb425cf(0x1d6)](JSON[_0xb425cf(0x18d)](_0x5e975d)),console[_0xb425cf(0x166)]('[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20'+_0x18c8d8[_0xb425cf(0x1a7)]);return;}catch(_0x15b746){console[_0xb425cf(0x1ae)]('[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:',_0x15b746);const _0x2cdcc8={'op':_0xb425cf(0x180),'request_id':_0x18c8d8[_0xb425cf(0x20f)],'error':_0x15b746[_0xb425cf(0x1f5)]};serverWs[_0xb425cf(0x1d6)](JSON[_0xb425cf(0x18d)](_0x2cdcc8));return;}if(_0x18c8d8['op']==='get_mesh'&&typeof _0x18c8d8[_0xb425cf(0x1e3)]===_0xb425cf(0x189)&&_0x18c8d8['request_id'])try{const _0xc5a730=_0x18c8d8[_0xb425cf(0x1e3)]['match'](/^package:\/\/([^\/]+)\/(.+)$/);if(_0xc5a730){const _0x5c76a0=_0xc5a730[0x1],_0x2e1b4d=_0xc5a730[0x2],_0x5dc0f5=execSync('ros2\x20pkg\x20prefix\x20'+_0x5c76a0,{'encoding':'utf8'})[_0xb425cf(0x16d)](),_0x2faa5e=path[_0xb425cf(0x1ac)](_0x5dc0f5,'share',_0x5c76a0,_0x2e1b4d);if(!fs[_0xb425cf(0x1ed)](_0x2faa5e))throw new Error(_0xb425cf(0x226)+_0x2faa5e);const _0x1100cc=fs[_0xb425cf(0x207)](_0x2faa5e),_0x5211cf={'op':_0xb425cf(0x20a),'request_id':_0x18c8d8[_0xb425cf(0x20f)],'data':_0x1100cc['toString'](_0xb425cf(0x1a3))};serverWs[_0xb425cf(0x1d6)](JSON[_0xb425cf(0x18d)](_0x5211cf)),console[_0xb425cf(0x166)]('[MESH]\x20Successfully\x20served\x20mesh:\x20'+_0x18c8d8[_0xb425cf(0x1e3)]+_0xb425cf(0x1c5)+_0x2faa5e);return;}}catch(_0x46c781){console[_0xb425cf(0x1ae)](_0xb425cf(0x1b3),_0x46c781);const _0x2197ce={'op':_0xb425cf(0x20a),'request_id':_0x18c8d8[_0xb425cf(0x20f)],'error':_0x46c781['message']};serverWs[_0xb425cf(0x1d6)](JSON['stringify'](_0x2197ce));return;}rosbridgeWs[_0xb425cf(0x1d6)](_0x5b47ed);}catch(_0x27e0e0){rosbridgeWs[_0xb425cf(0x1d6)](_0x5b47ed);}}}),serverWs['on'](_0x3f92ec(0x21a),(_0x1f1359,_0x3bb82a)=>{const _0x78df7=_0x3f92ec;console[_0x78df7(0x166)](_0x78df7(0x220)+_0x1f1359+':\x20'+_0x3bb82a+'),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x78df7(0x1a0)](),setTimeout(connectToServer,0x1388);}),serverWs['on']('error',_0x5c7a9b=>{const _0x491574=_0x3f92ec;console[_0x491574(0x1ae)](_0x491574(0x19c),_0x5c7a9b);});}catch(_0x36c119){console[_0x3f92ec(0x1ae)]('Failed\x20to\x20connect\x20to\x20server:',_0x36c119),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x31cb4c,_0xd5bff2,_0x50426f)=>{const _0x46c231=a1_0x396c1f;if(!authService[_0x46c231(0x1b0)]()){console[_0x46c231(0x166)]('Attempting\x20to\x20login\x20to:',config[_0x46c231(0x21e)]);const _0x2e8531=await authService[_0x46c231(0x1b5)]();if(!_0x2e8531)return _0xd5bff2[_0x46c231(0x1c8)](0x191)[_0x46c231(0x1d2)]({'error':_0x46c231(0x1d3)});}_0x50426f();};app[a1_0x396c1f(0x206)]((_0x47e933,_0x307940,_0x2db824)=>{const _0x29ebd1=a1_0x396c1f;_0x307940[_0x29ebd1(0x223)](_0x29ebd1(0x184),'*'),_0x307940[_0x29ebd1(0x223)](_0x29ebd1(0x216),_0x29ebd1(0x16a)),_0x307940['header'](_0x29ebd1(0x17d),_0x29ebd1(0x1f2)),_0x47e933[_0x29ebd1(0x22b)]===_0x29ebd1(0x219)?_0x307940['sendStatus'](0xc8):_0x2db824();}),app[a1_0x396c1f(0x186)]('/',requireAuth,(_0x1ae50a,_0x37a2f9)=>{const _0x3dd7cd=a1_0x396c1f;_0x37a2f9[_0x3dd7cd(0x1d6)](_0x3dd7cd(0x1f4));}),app[a1_0x396c1f(0x186)](a1_0x396c1f(0x1c9),async(_0x20bd66,_0x173c98)=>{const _0x19ba3b=a1_0x396c1f,_0x337c0=authService[_0x19ba3b(0x1b0)](),_0x308831=webrtcService['getActiveSessions'](),_0x4aab61=webrtcService[_0x19ba3b(0x1b1)](),_0x1ed858=topicManager[_0x19ba3b(0x198)]();_0x173c98['json']({'status':'ok','environment':process['env']['NODE_ENV']||_0x19ba3b(0x1e8),'backendUrl':config[_0x19ba3b(0x21e)],'rosbridgeUrl':config['rosbridge'][_0x19ba3b(0x168)],'proxyPort':port,'authenticated':_0x337c0,'topicManagement':{'discovered':_0x1ed858[_0x19ba3b(0x187)],'strategies':_0x1ed858[_0x19ba3b(0x1dd)],'largeDataTopics':_0x1ed858[_0x19ba3b(0x1b9)]['length'],'largeTopicsList':_0x1ed858[_0x19ba3b(0x1b9)]},'webrtc':{'activeSessions':_0x308831['length'],'sharedVideoSources':_0x4aab61[_0x19ba3b(0x1ca)],'sessions':_0x308831,'sharedSources':_0x4aab61}});});const getInitialPort=()=>{const _0x364271=a1_0x396c1f;if(process[_0x364271(0x185)][_0x364271(0x1ff)])return parseInt(process[_0x364271(0x185)][_0x364271(0x1ff)],0xa);return config['rosbridge'][_0x364271(0x22d)];};async function listenWithRetries(_0x116fc8,_0x3d6f2e,_0x419233=0xa){const _0x2db4dd=a1_0x396c1f;let _0x1a39a4=_0x3d6f2e;for(let _0x1d85ad=0x1;_0x1d85ad<=_0x419233;_0x1d85ad++){try{return await new Promise((_0x3a52c0,_0x165c83)=>{const _0x1a2a02=a1_0xfd3e,_0x4a4759=_0x116fc8['listen'](_0x1a39a4,()=>{const _0x25258c=a1_0xfd3e;console[_0x25258c(0x166)](_0x25258c(0x1a1)+_0x1a39a4),_0x3a52c0(_0x4a4759);});_0x4a4759['on'](_0x1a2a02(0x1ae),_0x4e8705=>{const _0x5a2e0a=_0x1a2a02;_0x4e8705[_0x5a2e0a(0x211)]==='EADDRINUSE'?(console['warn'](_0x5a2e0a(0x1dc)+_0x1a39a4+'\x20in\x20use,\x20trying\x20next\x20port...'),_0x165c83(_0x4e8705)):_0x165c83(_0x4e8705);});}),_0x1a39a4;}catch(_0x4d0c7e){_0x1a39a4++;}}throw new Error(_0x2db4dd(0x16c)+_0x419233+_0x2db4dd(0x1cb)+_0x3d6f2e);}const startApp=async()=>{const _0x5b36a9=a1_0x396c1f;try{reloadEnv();let _0x412f89=await authService[_0x5b36a9(0x1b5)]();while(!_0x412f89){console[_0x5b36a9(0x166)](_0x5b36a9(0x200)),await promptForCredentials(),_0x412f89=await authService[_0x5b36a9(0x1b5)]();}console[_0x5b36a9(0x166)](_0x5b36a9(0x1fb));!loadApplianceIdentity()&&console[_0x5b36a9(0x166)](_0x5b36a9(0x1f7));console[_0x5b36a9(0x166)](_0x5b36a9(0x190));const _0x3124df=await registerWithServer();if(!_0x3124df)throw new Error(_0x5b36a9(0x1e4));connectToRosbridge(),connectToServer();const _0x4f2337=getInitialPort();await listenWithRetries(app,_0x4f2337,0xa);}catch(_0x1c88de){console[_0x5b36a9(0x1ae)](_0x5b36a9(0x1bf),_0x1c88de),process['exit'](0x1);}};setInterval(async()=>{const _0x575b0e=a1_0x396c1f;try{if(robotId){const _0x4b74da=authService[_0x575b0e(0x18b)]();await axios[_0x575b0e(0x1e5)](config[_0x575b0e(0x21e)]+_0x575b0e(0x19d),{'robotId':robotId},{'headers':{'Authorization':_0x575b0e(0x17a)+_0x4b74da,'Content-Type':_0x575b0e(0x188)}});}}catch(_0x1a5c95){console[_0x575b0e(0x1ae)](_0x575b0e(0x1fd),_0x1a5c95[_0x575b0e(0x1f5)]);}},0x1388),startApp();