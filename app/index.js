const a1_0x26ba00=a1_0x2227;(function(_0x4bd4d4,_0x388b63){const _0x293bf0=a1_0x2227,_0x343988=_0x4bd4d4();while(!![]){try{const _0x7a107e=parseInt(_0x293bf0(0x95))/0x1+-parseInt(_0x293bf0(0x106))/0x2+-parseInt(_0x293bf0(0x140))/0x3*(parseInt(_0x293bf0(0x9a))/0x4)+parseInt(_0x293bf0(0xfd))/0x5*(parseInt(_0x293bf0(0xee))/0x6)+-parseInt(_0x293bf0(0xd5))/0x7+parseInt(_0x293bf0(0xe8))/0x8*(parseInt(_0x293bf0(0x117))/0x9)+-parseInt(_0x293bf0(0xd6))/0xa*(-parseInt(_0x293bf0(0xcf))/0xb);if(_0x7a107e===_0x388b63)break;else _0x343988['push'](_0x343988['shift']());}catch(_0x42378c){_0x343988['push'](_0x343988['shift']());}}}(a1_0x427b,0x6284f));const a1_0x42bbba=(function(){let _0x4b04ac=!![];return function(_0x11cd52,_0x1ecb1c){const _0x3f9748=_0x4b04ac?function(){const _0x5a6a8f=a1_0x2227;if(_0x1ecb1c){const _0x100170=_0x1ecb1c[_0x5a6a8f(0x153)](_0x11cd52,arguments);return _0x1ecb1c=null,_0x100170;}}:function(){};return _0x4b04ac=![],_0x3f9748;};}()),a1_0x42182a=a1_0x42bbba(this,function(){const _0x351c8d=a1_0x2227;return a1_0x42182a[_0x351c8d(0x107)]()[_0x351c8d(0x141)](_0x351c8d(0x151))[_0x351c8d(0x107)]()[_0x351c8d(0x142)](a1_0x42182a)[_0x351c8d(0x141)]('(((.+)+)+)+$');});a1_0x42182a();const dotenv=require(a1_0x26ba00(0xcd));dotenv['config']();const express=require(a1_0x26ba00(0x123)),config=require(a1_0x26ba00(0x116));process[a1_0x26ba00(0xfe)][a1_0x26ba00(0xfc)]&&process['env'][a1_0x26ba00(0x136)]&&(config[a1_0x26ba00(0x125)][a1_0x26ba00(0x158)]=process['env'][a1_0x26ba00(0xfc)],config[a1_0x26ba00(0x125)][a1_0x26ba00(0x97)]=process[a1_0x26ba00(0xfe)][a1_0x26ba00(0x136)],console['log'](a1_0x26ba00(0x157)));const authService=require('./services/auth'),webrtcService=require('./services/webrtcService'),topicManager=require(a1_0x26ba00(0x163)),WebSocket=require('ws'),axios=require(a1_0x26ba00(0x11b)),fs=require('fs'),prompt=require(a1_0x26ba00(0x15a))({'sigint':!![]}),app=express(),port=process[a1_0x26ba00(0xfe)][a1_0x26ba00(0x154)]||config[a1_0x26ba00(0xa3)]['proxyPort'],APPLIANCE_FILE=a1_0x26ba00(0xd7),{DOMParser,XMLSerializer}=require(a1_0x26ba00(0xa5)),path=require(a1_0x26ba00(0xe2)),{execSync}=require(a1_0x26ba00(0x160)),APPLIANCE_BASE_URL=process['env'][a1_0x26ba00(0x133)]||'';console[a1_0x26ba00(0x144)](a1_0x26ba00(0xf6)+(process[a1_0x26ba00(0xfe)][a1_0x26ba00(0x9c)]||a1_0x26ba00(0x92))),console[a1_0x26ba00(0x144)](a1_0x26ba00(0x13b)+config[a1_0x26ba00(0x9b)]),console[a1_0x26ba00(0x144)](a1_0x26ba00(0x111)+config[a1_0x26ba00(0xa3)][a1_0x26ba00(0x124)]),console[a1_0x26ba00(0x144)]('Proxy\x20listening\x20on\x20port:\x20'+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function a1_0x2227(_0x174d88,_0x46c7ca){const _0x10b97e=a1_0x427b();return a1_0x2227=function(_0x42182a,_0x42bbba){_0x42182a=_0x42182a-0x92;let _0x427b19=_0x10b97e[_0x42182a];return _0x427b19;},a1_0x2227(_0x174d88,_0x46c7ca);}function updateEnvFile(_0x3ecf98,_0x5202d0){const _0x4ca3c8=a1_0x26ba00;fs[_0x4ca3c8(0xb6)]('.env',_0x4ca3c8(0x156)+_0x3ecf98+_0x4ca3c8(0xe7)+_0x5202d0+'\x0a');}function reloadEnv(){const _0x3d7aa2=a1_0x26ba00;dotenv[_0x3d7aa2(0xef)]({'override':!![]}),config[_0x3d7aa2(0x125)][_0x3d7aa2(0x158)]=process[_0x3d7aa2(0xfe)][_0x3d7aa2(0xfc)],config[_0x3d7aa2(0x125)][_0x3d7aa2(0x97)]=process[_0x3d7aa2(0xfe)][_0x3d7aa2(0x136)],console['log'](_0x3d7aa2(0x101),{'username':config['credentials'][_0x3d7aa2(0x158)]?_0x3d7aa2(0xb2):_0x3d7aa2(0xf0),'password':config[_0x3d7aa2(0x125)][_0x3d7aa2(0x97)]?_0x3d7aa2(0xb2):_0x3d7aa2(0xf0)});}async function promptForCredentials(){const _0x195b28=a1_0x26ba00;process['env'][_0x195b28(0x9c)]===_0x195b28(0x15c)&&(console[_0x195b28(0xc6)](_0x195b28(0xca)),console['error'](_0x195b28(0x10b)),process[_0x195b28(0xf7)](0x1));const _0x475e57=prompt(_0x195b28(0xff)),_0x3cab7b=prompt[_0x195b28(0x166)](_0x195b28(0xa8));updateEnvFile(_0x475e57,_0x3cab7b),reloadEnv();}function loadApplianceIdentity(){const _0x510abf=a1_0x26ba00;if(fs['existsSync'](APPLIANCE_FILE))try{const _0x5cf10a=JSON[_0x510abf(0xa0)](fs[_0x510abf(0x113)](APPLIANCE_FILE,_0x510abf(0xb3)));if(_0x5cf10a[_0x510abf(0x155)]&&_0x5cf10a[_0x510abf(0x119)])return robotId=_0x5cf10a[_0x510abf(0x155)],registrationToken=_0x5cf10a[_0x510abf(0x119)],console['log']('Loaded\x20appliance\x20identity:',robotId),topicManager[_0x510abf(0x132)](_0x5cf10a),!![];}catch(_0x5ea1e9){console[_0x510abf(0xc6)]('Failed\x20to\x20parse\x20appliance\x20identity\x20file:',_0x5ea1e9);}return![];}function saveApplianceIdentity(_0x24c8c3,_0x11e300){const _0x32bda2=a1_0x26ba00;let _0x26f407={};if(fs['existsSync'](APPLIANCE_FILE))try{_0x26f407=JSON['parse'](fs[_0x32bda2(0x113)](APPLIANCE_FILE,_0x32bda2(0xb3)));}catch(_0x2210f7){_0x26f407={};}_0x26f407[_0x32bda2(0x155)]=_0x24c8c3,_0x26f407[_0x32bda2(0x119)]=_0x11e300,fs[_0x32bda2(0xb6)](APPLIANCE_FILE,JSON[_0x32bda2(0xc2)](_0x26f407,null,0x2));}async function registerWithServer(){const _0x15e22e=a1_0x26ba00;try{const _0x5c1990=authService[_0x15e22e(0xd2)]();if(!_0x5c1990)throw new Error(_0x15e22e(0xdd));let _0x132809,_0x40cdf5=![];while(!![]){try{robotId&&registrationToken?_0x132809=await axios[_0x15e22e(0x94)](config['serverUrl']+'/appliance/register',{'name':_0x15e22e(0x105),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x15e22e(0x167)+_0x5c1990,'Content-Type':_0x15e22e(0x13f)}}):_0x132809=await axios[_0x15e22e(0x94)](config['serverUrl']+_0x15e22e(0x11e),{'name':'WSL\x20Appliance'},{'headers':{'Authorization':_0x15e22e(0x167)+_0x5c1990,'Content-Type':_0x15e22e(0x13f)}});break;}catch(_0x1378a3){const _0x201bea=_0x1378a3?.['response']?.[_0x15e22e(0x14a)]?.[_0x15e22e(0xc6)]||_0x1378a3[_0x15e22e(0x9f)];if(!_0x40cdf5&&_0x201bea&&_0x201bea[_0x15e22e(0x99)]()[_0x15e22e(0xc5)](_0x15e22e(0xd9))){console[_0x15e22e(0xdb)](_0x15e22e(0x104));if(fs[_0x15e22e(0xa2)](APPLIANCE_FILE))fs[_0x15e22e(0xeb)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x40cdf5=!![];continue;}throw _0x1378a3;}}if(!_0x132809[_0x15e22e(0x14a)]||!_0x132809[_0x15e22e(0x14a)][_0x15e22e(0x14f)]||!_0x132809[_0x15e22e(0x14a)]['id'])throw new Error(_0x15e22e(0x135));return registrationToken=_0x132809[_0x15e22e(0x14a)][_0x15e22e(0x14f)],robotId=_0x132809['data']['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x15e22e(0x144)](_0x15e22e(0x12a)),!![];}catch(_0x2b3405){return console[_0x15e22e(0xc6)](_0x15e22e(0xdf),_0x2b3405[_0x15e22e(0x9f)]),![];}}function rewriteUrdfMeshUris(_0xe5a451){const _0x4742b3=a1_0x26ba00;try{const _0x2ce0b2=new DOMParser(),_0x26025f=_0x2ce0b2[_0x4742b3(0xac)](_0xe5a451,'text/xml');let _0x41c437=0x0,_0x7dcb77=0x0;const _0x10ad76=_0x26025f[_0x4742b3(0x12f)](_0x4742b3(0x12c));for(let _0x2e4050=0x0;_0x2e4050<_0x10ad76[_0x4742b3(0x15e)];_0x2e4050++){const _0x2d435d=_0x10ad76[_0x2e4050],_0x1d7725=_0x2d435d[_0x4742b3(0xa6)]('filename'),_0x3c3aed=[_0x4742b3(0x149),_0x4742b3(0xbc),_0x4742b3(0xe6),_0x4742b3(0x152),_0x4742b3(0xc0)],_0x2a38bb=_0x3c3aed[_0x4742b3(0xb1)](_0x23df99=>_0x1d7725[_0x4742b3(0x99)]()['endsWith'](_0x23df99));if(_0x1d7725&&_0x1d7725['startsWith'](_0x4742b3(0x138))&&_0x2a38bb){_0x41c437++;const _0x5a6a15=APPLIANCE_BASE_URL+'/ros/mesh?uri='+encodeURIComponent(_0x1d7725);_0x2d435d[_0x4742b3(0xea)](_0x4742b3(0xd4),_0x5a6a15),_0x7dcb77++,console[_0x4742b3(0x144)](_0x4742b3(0xe3)+_0x1d7725+'\x20->\x20'+_0x5a6a15);}}_0x41c437>0x0?console[_0x4742b3(0x144)](_0x4742b3(0x146)+_0x7dcb77+_0x4742b3(0x150)+_0x41c437+_0x4742b3(0xcb)):console['log']('[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF');const _0x5114ab=new XMLSerializer();return _0x5114ab[_0x4742b3(0xf3)](_0x26025f);}catch(_0x3ef301){return console[_0x4742b3(0xc6)](_0x4742b3(0xc8),_0x3ef301),_0xe5a451;}}function connectToRosbridge(){const _0x3ac7d7=a1_0x26ba00;try{rosbridgeWs=new WebSocket(config['rosbridge']['wsEndpoint']),rosbridgeWs['on']('open',()=>{const _0x57feef=a1_0x2227;console[_0x57feef(0x144)]('Connected\x20to\x20ROSBridge\x20(main)');const _0x481fde=require(_0x57feef(0x130)),_0x5bd5f1=new _0x481fde['Ros']({'url':config[_0x57feef(0xa3)][_0x57feef(0x124)]});_0x5bd5f1['on'](_0x57feef(0xc3),()=>{setTimeout(()=>{topicManager['discoverTopics'](_0x5bd5f1)['catch'](_0x5d2058=>{const _0x4d5c5b=a1_0x2227;console[_0x4d5c5b(0xc6)](_0x4d5c5b(0xb0),_0x5d2058);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x3ac7d7(0x9f),_0x32e7f2=>{const _0x2ff8ac=_0x3ac7d7;if(serverWs&&serverWs['readyState']===WebSocket[_0x2ff8ac(0xa9)]){let _0x48676b=_0x32e7f2[_0x2ff8ac(0x107)]();try{const _0x24eb6c=JSON['parse'](_0x48676b);if(_0x24eb6c['op']===_0x2ff8ac(0xad)&&_0x24eb6c[_0x2ff8ac(0x134)]){const _0x3bb52a=topicManager[_0x2ff8ac(0xaa)](_0x24eb6c);switch(_0x3bb52a[_0x2ff8ac(0x12d)]){case _0x2ff8ac(0xcc):return;case _0x2ff8ac(0x128):return;case _0x2ff8ac(0xce):default:_0x48676b=JSON[_0x2ff8ac(0xc2)](_0x3bb52a[_0x2ff8ac(0x9f)]);break;}}if((_0x24eb6c['op']===_0x2ff8ac(0xe5)||_0x24eb6c['op']===_0x2ff8ac(0x14c))&&(_0x24eb6c['service']===_0x2ff8ac(0x14d)||_0x24eb6c[_0x2ff8ac(0xda)]&&_0x24eb6c[_0x2ff8ac(0xda)][_0x2ff8ac(0xd3)])){console[_0x2ff8ac(0x144)](_0x2ff8ac(0xc1));const _0x4882c7=_0x24eb6c['values']?.[_0x2ff8ac(0xd3)]||[],_0x2d0d4c=_0x24eb6c[_0x2ff8ac(0xda)]?.['types']||[],_0x567a9c=_0x4882c7[_0x2ff8ac(0x10a)]((_0x10cb8a,_0x4b20c6)=>{const _0x56ceba=_0x2ff8ac,_0x313136=topicManager[_0x56ceba(0x14b)](_0x10cb8a);return{'name':_0x10cb8a,'type':_0x2d0d4c[_0x4b20c6]||_0x56ceba(0x115),'throttling':_0x313136?{'isThrottled':_0x313136[_0x56ceba(0x129)]==='sample','strategy':_0x313136[_0x56ceba(0x129)],'samplingRate':_0x313136[_0x56ceba(0x13a)],'reason':_0x313136['reason'],'estimatedSize':_0x313136[_0x56ceba(0xe0)]}:null};});_0x24eb6c[_0x2ff8ac(0xda)]={'topics':_0x567a9c[_0x2ff8ac(0x10a)](_0x9007c7=>_0x9007c7[_0x2ff8ac(0xc9)]),'types':_0x567a9c[_0x2ff8ac(0x10a)](_0xbdb27b=>_0xbdb27b[_0x2ff8ac(0x148)]),'throttling':_0x567a9c[_0x2ff8ac(0x10a)](_0x4ec613=>_0x4ec613['throttling'])},_0x48676b=JSON[_0x2ff8ac(0xc2)](_0x24eb6c),console[_0x2ff8ac(0x144)]('[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client');}if(_0x24eb6c['op']===_0x2ff8ac(0xad)&&_0x24eb6c[_0x2ff8ac(0x134)]==='/robot_description')try{const _0x320bb5=_0x24eb6c['msg'][_0x2ff8ac(0x14a)],_0x38ebfa=rewriteUrdfMeshUris(_0x320bb5);_0x24eb6c[_0x2ff8ac(0x110)]['data']=_0x38ebfa,_0x48676b=JSON['stringify'](_0x24eb6c);}catch(_0x41d274){console[_0x2ff8ac(0xc6)](_0x2ff8ac(0x10d),_0x41d274);}}catch(_0x418dd2){console[_0x2ff8ac(0xdb)]('[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:',_0x418dd2['message']);}serverWs['send'](_0x48676b);}}),rosbridgeWs['on'](_0x3ac7d7(0x96),()=>{const _0x2cbdd0=_0x3ac7d7;console[_0x2cbdd0(0x144)](_0x2cbdd0(0xd8)),webrtcService[_0x2cbdd0(0xed)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x3ac7d7(0xc6),_0x4a8895=>{const _0x4aa40b=_0x3ac7d7;console['error'](_0x4aa40b(0x10e),_0x4a8895);});}catch(_0x49fcb1){console[_0x3ac7d7(0xc6)](_0x3ac7d7(0xa4),_0x49fcb1),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x44beb6=a1_0x26ba00;try{rosbridgeWebRTCWs=new WebSocket(config[_0x44beb6(0xa3)][_0x44beb6(0x124)]),rosbridgeWebRTCWs['on'](_0x44beb6(0xaf),()=>{const _0x381440=_0x44beb6;console[_0x381440(0x144)](_0x381440(0xd0)),webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x44beb6(0x9f),_0xa0bad4=>{}),rosbridgeWebRTCWs['on'](_0x44beb6(0x96),()=>{const _0xa6e83e=_0x44beb6;console[_0xa6e83e(0x144)]('Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...'),webrtcService[_0xa6e83e(0xed)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on']('error',_0x1db4f7=>{const _0x476cff=_0x44beb6;console[_0x476cff(0xc6)](_0x476cff(0xa7),_0x1db4f7);});}catch(_0x470bc8){console[_0x44beb6(0xc6)](_0x44beb6(0x164),_0x470bc8),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x1ceafd=a1_0x26ba00;try{if(!registrationToken)throw new Error(_0x1ceafd(0xe1));const _0x1b33f1=config[_0x1ceafd(0x9b)]['replace'](_0x1ceafd(0x11c),'ws')+'/rosbridge?type=appliance&token='+registrationToken;serverWs=new WebSocket(_0x1b33f1),serverWs['on'](_0x1ceafd(0xaf),()=>{const _0x2bb959=_0x1ceafd;console[_0x2bb959(0x144)](_0x2bb959(0xbe)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x2bb959(0xf4)]===WebSocket[_0x2bb959(0xa9)]&&webrtcService[_0x2bb959(0xde)](rosbridgeWebRTCWs,serverWs);}),serverWs['on']('message',_0x19019e=>{const _0x357bd8=_0x1ceafd;if(rosbridgeWs&&rosbridgeWs[_0x357bd8(0xf4)]===WebSocket['OPEN']){let _0x9e73ca=_0x19019e[_0x357bd8(0x107)]();try{const _0xfb0ad4=JSON[_0x357bd8(0xa0)](_0x9e73ca);if(webrtcService[_0x357bd8(0xaa)](_0xfb0ad4))return;if(_0xfb0ad4['op']===_0x357bd8(0x162)&&typeof _0xfb0ad4[_0x357bd8(0x120)]===_0x357bd8(0xbb)&&_0xfb0ad4['request_id'])try{console[_0x357bd8(0x144)](_0x357bd8(0x12b)+_0xfb0ad4['param_name']);const _0x180e18=execSync(_0x357bd8(0x161)+_0xfb0ad4[_0x357bd8(0x120)],{'encoding':_0x357bd8(0xb3)})[_0x357bd8(0x9d)]();let _0x4c8b2b=_0x180e18;_0x180e18[_0x357bd8(0x143)](_0x357bd8(0x15f))&&(_0x4c8b2b=_0x180e18[_0x357bd8(0xbf)]('String\x20value\x20is:\x20'[_0x357bd8(0x15e)]()));_0x4c8b2b[_0x357bd8(0x143)]('\x22')&&_0x4c8b2b[_0x357bd8(0x137)]('\x22')&&(_0x4c8b2b=_0x4c8b2b['slice'](0x1,-0x1));_0x4c8b2b=_0x4c8b2b[_0x357bd8(0x145)](/\\n/g,'\x0a')[_0x357bd8(0x145)](/\\"/g,'\x22');const _0x13586a={'op':_0x357bd8(0xab),'request_id':_0xfb0ad4['request_id'],'data':_0x4c8b2b};serverWs[_0x357bd8(0xae)](JSON[_0x357bd8(0xc2)](_0x13586a)),console['log'](_0x357bd8(0xec)+_0xfb0ad4[_0x357bd8(0x120)]);return;}catch(_0x6aae8d){console[_0x357bd8(0xc6)](_0x357bd8(0xb8),_0x6aae8d);const _0x30a3ed={'op':'urdf_param_data','request_id':_0xfb0ad4[_0x357bd8(0x147)],'error':_0x6aae8d['message']};serverWs['send'](JSON['stringify'](_0x30a3ed));return;}if(_0xfb0ad4['op']==='get_mesh'&&typeof _0xfb0ad4[_0x357bd8(0xb9)]===_0x357bd8(0xbb)&&_0xfb0ad4['request_id'])try{const _0x453398=_0xfb0ad4['uri'][_0x357bd8(0x165)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x453398){const _0x2d16c0=_0x453398[0x1],_0x17c5c3=_0x453398[0x2],_0x3fbe8d=execSync(_0x357bd8(0xb7)+_0x2d16c0,{'encoding':'utf8'})[_0x357bd8(0x9d)](),_0x236f12=path[_0x357bd8(0x13e)](_0x3fbe8d,'share',_0x2d16c0,_0x17c5c3);if(!fs['existsSync'](_0x236f12))throw new Error(_0x357bd8(0x11d)+_0x236f12);const _0x5ad651=fs[_0x357bd8(0x113)](_0x236f12),_0x2dcae2={'op':_0x357bd8(0x159),'request_id':_0xfb0ad4[_0x357bd8(0x147)],'data':_0x5ad651['toString']('base64')};serverWs['send'](JSON[_0x357bd8(0xc2)](_0x2dcae2)),console[_0x357bd8(0x144)](_0x357bd8(0x98)+_0xfb0ad4[_0x357bd8(0xb9)]+_0x357bd8(0xb5)+_0x236f12);return;}}catch(_0x29a47c){console['error'](_0x357bd8(0xfa),_0x29a47c);const _0x46d49b={'op':_0x357bd8(0x159),'request_id':_0xfb0ad4[_0x357bd8(0x147)],'error':_0x29a47c['message']};serverWs[_0x357bd8(0xae)](JSON[_0x357bd8(0xc2)](_0x46d49b));return;}rosbridgeWs[_0x357bd8(0xae)](_0x9e73ca);}catch(_0x5dfd3f){rosbridgeWs[_0x357bd8(0xae)](_0x9e73ca);}}}),serverWs['on'](_0x1ceafd(0x96),(_0x5e2b88,_0x558f29)=>{const _0xdb4fa4=_0x1ceafd;console[_0xdb4fa4(0x144)](_0xdb4fa4(0x13c)+_0x5e2b88+':\x20'+_0x558f29+_0xdb4fa4(0x114)),webrtcService[_0xdb4fa4(0xed)](),setTimeout(connectToServer,0x1388);}),serverWs['on']('error',_0x5be695=>{const _0x4d0847=_0x1ceafd;console[_0x4d0847(0xc6)](_0x4d0847(0x127),_0x5be695);});}catch(_0x1d358b){console[_0x1ceafd(0xc6)](_0x1ceafd(0xc7),_0x1d358b),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x52b53a,_0x54c202,_0x6ea28a)=>{const _0x11f251=a1_0x26ba00;if(!authService[_0x11f251(0xd1)]()){console[_0x11f251(0x144)](_0x11f251(0x112),config[_0x11f251(0x9b)]);const _0x384a35=await authService['login']();if(!_0x384a35)return _0x54c202['status'](0x191)[_0x11f251(0x109)]({'error':_0x11f251(0x102)});}_0x6ea28a();};app[a1_0x26ba00(0xf8)]((_0x15ef4b,_0x33fb92,_0x7ac216)=>{const _0x16e6d5=a1_0x26ba00;_0x33fb92['header'](_0x16e6d5(0x121),'*'),_0x33fb92['header'](_0x16e6d5(0x103),_0x16e6d5(0x13d)),_0x33fb92[_0x16e6d5(0x10f)](_0x16e6d5(0x100),_0x16e6d5(0x139)),_0x15ef4b[_0x16e6d5(0x11f)]===_0x16e6d5(0x15b)?_0x33fb92[_0x16e6d5(0xa1)](0xc8):_0x7ac216();}),app[a1_0x26ba00(0xba)]('/',requireAuth,(_0x2e9cc3,_0x6293d9)=>{const _0x4fd473=a1_0x26ba00;_0x6293d9[_0x4fd473(0xae)](_0x4fd473(0x12e));}),app[a1_0x26ba00(0xba)](a1_0x26ba00(0xf1),async(_0x54286c,_0x21fbed)=>{const _0x1b65d0=a1_0x26ba00,_0x3c5cb0=authService[_0x1b65d0(0xd1)](),_0xb3727f=webrtcService[_0x1b65d0(0x118)](),_0x515cc3=webrtcService[_0x1b65d0(0x108)](),_0x404629=topicManager[_0x1b65d0(0xf2)]();_0x21fbed[_0x1b65d0(0x109)]({'status':'ok','environment':process[_0x1b65d0(0xfe)][_0x1b65d0(0x9c)]||_0x1b65d0(0x92),'backendUrl':config[_0x1b65d0(0x9b)],'rosbridgeUrl':config[_0x1b65d0(0xa3)][_0x1b65d0(0x124)],'proxyPort':port,'authenticated':_0x3c5cb0,'topicManagement':{'discovered':_0x404629[_0x1b65d0(0xc4)],'strategies':_0x404629['strategies'],'largeDataTopics':_0x404629[_0x1b65d0(0x15d)][_0x1b65d0(0x15e)],'largeTopicsList':_0x404629[_0x1b65d0(0x15d)]},'webrtc':{'activeSessions':_0xb3727f[_0x1b65d0(0x15e)],'sharedVideoSources':_0x515cc3[_0x1b65d0(0x15e)],'sessions':_0xb3727f,'sharedSources':_0x515cc3}});});const getInitialPort=()=>{const _0x5d2f5b=a1_0x26ba00;if(process[_0x5d2f5b(0xfe)][_0x5d2f5b(0x154)])return parseInt(process['env']['PORT'],0xa);return config[_0x5d2f5b(0xa3)]['proxyPort'];};async function listenWithRetries(_0x439af8,_0xef8f2c,_0x58e5af=0xa){const _0xc9c168=a1_0x26ba00;let _0x2076a0=_0xef8f2c;for(let _0x3a9712=0x1;_0x3a9712<=_0x58e5af;_0x3a9712++){try{return await new Promise((_0x49578a,_0x3b7ac7)=>{const _0x1a0a3e=a1_0x2227,_0x33f516=_0x439af8[_0x1a0a3e(0x10c)](_0x2076a0,()=>{const _0x52874f=_0x1a0a3e;console[_0x52874f(0x144)](_0x52874f(0x14e)+_0x2076a0),_0x49578a(_0x33f516);});_0x33f516['on'](_0x1a0a3e(0xc6),_0x50e9d3=>{const _0x9fb4f5=_0x1a0a3e;_0x50e9d3[_0x9fb4f5(0x11a)]===_0x9fb4f5(0xe9)?(console[_0x9fb4f5(0xdb)](_0x9fb4f5(0x126)+_0x2076a0+_0x9fb4f5(0xfb)),_0x3b7ac7(_0x50e9d3)):_0x3b7ac7(_0x50e9d3);});}),_0x2076a0;}catch(_0x401553){_0x2076a0++;}}throw new Error('Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20'+_0x58e5af+_0xc9c168(0xdc)+_0xef8f2c);}function a1_0x427b(){const _0x3bb1a7=['[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','stopAllSessions','18AesYOl','config','NOT\x20SET','/health','getStatistics','serializeToString','readyState','Failed\x20to\x20register\x20with\x20server','Environment:\x20','exit','use','login','[MESH]\x20Error\x20serving\x20mesh:','\x20in\x20use,\x20trying\x20next\x20port...','APP_USERNAME','1093205RPWacs','env','Enter\x20username:\x20','Access-Control-Allow-Headers','Loaded\x20credentials:','Authentication\x20required','Access-Control-Allow-Methods','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','WSL\x20Appliance','714480aajacL','toString','getSharedVideoSources','json','map','Please\x20run:\x20./setup.sh\x20reconfigure','listen','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','ROSBridge\x20(main)\x20connection\x20error:','header','msg','ROSBridge\x20WebSocket\x20URL:\x20','Attempting\x20to\x20login\x20to:','readFileSync','),\x20attempting\x20to\x20reconnect...','unknown','./config','16101dSdPFy','getActiveSessions','registrationToken','code','axios','http','Mesh\x20file\x20not\x20found:\x20','/appliance/register','method','param_name','Access-Control-Allow-Origin','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','express','wsEndpoint','credentials','Port\x20','Server\x20connection\x20error:','webrtc_skip','strategy','Successfully\x20registered\x20with\x20server','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','mesh','action','Appliance\x20is\x20running\x20and\x20authenticated!','getElementsByTagName','roslib','/appliance/ping','loadConfig','APPLIANCE_BASE_URL','topic','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','APP_PASSWORD','endsWith','package://','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','samplingRate','Backend\x20Server\x20URL:\x20','Disconnected\x20from\x20server\x20(','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','join','application/json','18PdJwzj','search','constructor','startsWith','log','replace','[URDF\x20REWRITE]\x20Rewrote\x20','request_id','type','.stl','data','getTopicStrategy','call_service','/rosapi/topics','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','registration_token','\x20of\x20','(((.+)+)+)+$','.ply','apply','PORT','robotId','APP_USERNAME=','Initial\x20credentials\x20loaded\x20from\x20environment','username','mesh_data','prompt-sync','OPTIONS','production','largeDataTopics','length','String\x20value\x20is:\x20','child_process','ros2\x20param\x20get\x20','get_urdf_param','./services/TopicManager','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','match','hide','Bearer\x20','development','Failed\x20to\x20ping\x20server:','post','223269WyGAOr','close','password','[MESH]\x20Successfully\x20served\x20mesh:\x20','toLowerCase','362172fLPjva','serverUrl','NODE_ENV','trim','Failed\x20to\x20start\x20application:','message','parse','sendStatus','existsSync','rosbridge','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','xmldom','getAttribute','ROSBridge\x20(WebRTC)\x20connection\x20error:','Enter\x20password:\x20','OPEN','handleMessage','urdf_param_data','parseFromString','publish','send','open','Topic\x20discovery\x20failed:','some','SET','utf8','Successfully\x20logged\x20in','\x20from\x20','writeFileSync','ros2\x20pkg\x20prefix\x20','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','uri','get','string','.dae','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','Connected\x20to\x20server','substring','.mesh','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','stringify','connection','totalTopics','includes','error','Failed\x20to\x20connect\x20to\x20server:','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','name','Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','sample_skip','dotenv','forward','10113323jLCdjJ','Connected\x20to\x20ROSBridge\x20(WebRTC)','isAuthenticated','getToken','topics','filename','3524479UjWtKB','10XvJAnq','.appliance.json','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','robot\x20not\x20found','values','warn','\x20attempts\x20starting\x20from\x20','Not\x20authenticated','initialize','Failed\x20to\x20register\x20with\x20server:','estimatedSize','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','path','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','Registering\x20with\x20server...','service_response','.obj','\x0aAPP_PASSWORD=','40QGToBm','EADDRINUSE','setAttribute','unlinkSync'];a1_0x427b=function(){return _0x3bb1a7;};return a1_0x427b();}const startApp=async()=>{const _0x3ccc93=a1_0x26ba00;try{reloadEnv();let _0x56ee23=await authService['login']();while(!_0x56ee23){console[_0x3ccc93(0x144)](_0x3ccc93(0x122)),await promptForCredentials(),_0x56ee23=await authService[_0x3ccc93(0xf9)]();}console[_0x3ccc93(0x144)](_0x3ccc93(0xb4));!loadApplianceIdentity()&&console['log'](_0x3ccc93(0xbd));console['log'](_0x3ccc93(0xe4));const _0x1f6624=await registerWithServer();if(!_0x1f6624)throw new Error(_0x3ccc93(0xf5));connectToRosbridge(),connectToServer();const _0x2dc012=getInitialPort();await listenWithRetries(app,_0x2dc012,0xa);}catch(_0x387792){console['error'](_0x3ccc93(0x9e),_0x387792),process[_0x3ccc93(0xf7)](0x1);}};setInterval(async()=>{const _0x3f41da=a1_0x26ba00;try{if(robotId){const _0x52a3b5=authService[_0x3f41da(0xd2)]();await axios[_0x3f41da(0x94)](config[_0x3f41da(0x9b)]+_0x3f41da(0x131),{'robotId':robotId},{'headers':{'Authorization':'Bearer\x20'+_0x52a3b5,'Content-Type':_0x3f41da(0x13f)}});}}catch(_0x5c6ae0){console[_0x3f41da(0xc6)](_0x3f41da(0x93),_0x5c6ae0['message']);}},0x1388),startApp();