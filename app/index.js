const a1_0x3e8fd9=a1_0xa1b9;function a1_0xa1b9(_0x102be6,_0x2719e1){const _0xab9bdb=a1_0x1654();return a1_0xa1b9=function(_0x292172,_0x20e489){_0x292172=_0x292172-0x69;let _0x1654f0=_0xab9bdb[_0x292172];return _0x1654f0;},a1_0xa1b9(_0x102be6,_0x2719e1);}(function(_0xc63627,_0x29cc31){const _0x4b7b8b=a1_0xa1b9,_0x34536c=_0xc63627();while(!![]){try{const _0x200f8d=parseInt(_0x4b7b8b(0x98))/0x1+-parseInt(_0x4b7b8b(0xb9))/0x2+parseInt(_0x4b7b8b(0x10a))/0x3*(parseInt(_0x4b7b8b(0x134))/0x4)+parseInt(_0x4b7b8b(0x105))/0x5*(-parseInt(_0x4b7b8b(0x9d))/0x6)+parseInt(_0x4b7b8b(0x79))/0x7*(parseInt(_0x4b7b8b(0x128))/0x8)+parseInt(_0x4b7b8b(0x95))/0x9*(parseInt(_0x4b7b8b(0x103))/0xa)+parseInt(_0x4b7b8b(0x108))/0xb*(parseInt(_0x4b7b8b(0x89))/0xc);if(_0x200f8d===_0x29cc31)break;else _0x34536c['push'](_0x34536c['shift']());}catch(_0x8cd203){_0x34536c['push'](_0x34536c['shift']());}}}(a1_0x1654,0xd96e9));const a1_0x20e489=(function(){let _0x3df676=!![];return function(_0x48cb6d,_0x3cf36d){const _0x4d4f93=_0x3df676?function(){const _0x2c6c16=a1_0xa1b9;if(_0x3cf36d){const _0x5aca0b=_0x3cf36d[_0x2c6c16(0x139)](_0x48cb6d,arguments);return _0x3cf36d=null,_0x5aca0b;}}:function(){};return _0x3df676=![],_0x4d4f93;};}()),a1_0x292172=a1_0x20e489(this,function(){const _0x59ed45=a1_0xa1b9;return a1_0x292172[_0x59ed45(0x11c)]()['search'](_0x59ed45(0xb2))[_0x59ed45(0x11c)]()['constructor'](a1_0x292172)[_0x59ed45(0xe3)](_0x59ed45(0xb2));});a1_0x292172();const express=require('express'),config=require(a1_0x3e8fd9(0x111)),authService=require('./services/auth'),webrtcService=require(a1_0x3e8fd9(0xcd)),topicManager=require(a1_0x3e8fd9(0xd0)),WebSocket=require('ws'),axios=require(a1_0x3e8fd9(0x11b)),fs=require('fs'),prompt=require('prompt-sync')({'sigint':!![]}),dotenv=require(a1_0x3e8fd9(0xe2)),app=express(),port=process['env'][a1_0x3e8fd9(0xf8)]||config[a1_0x3e8fd9(0x10b)]['proxyPort'],APPLIANCE_FILE='.appliance.json',{DOMParser,XMLSerializer}=require(a1_0x3e8fd9(0xfa)),path=require('path'),{execSync}=require(a1_0x3e8fd9(0xf0)),APPLIANCE_BASE_URL=process['env'][a1_0x3e8fd9(0x81)]||'';function a1_0x1654(){const _0x364891=['type','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','mesh_data','replace','Registering\x20with\x20server...','APP_USERNAME=','use','close','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','696bBHZXq','ROSBridge\x20(WebRTC)\x20connection\x20error:','sample','parseFromString','[MESH]\x20Successfully\x20served\x20mesh:\x20','apply','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','initialize','registrationToken','connection','handleMessage','largeDataTopics','serializeToString','strategy','Disconnected\x20from\x20server\x20(','text/xml','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','length','/ros/mesh?uri=','setAttribute','[MESH]\x20Error\x20serving\x20mesh:','\x20attempts\x20starting\x20from\x20','msg','7rZOpsf','map','OPTIONS','data','call_service','password','totalTopics','Appliance\x20is\x20running\x20and\x20authenticated!','APPLIANCE_BASE_URL','Port\x20','warn','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','Failed\x20to\x20start\x20application:','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','open','stopAllSessions','396HTAvJV','writeFileSync','throttling','get_urdf_param','Loaded\x20appliance\x20identity:','stringify','\x20->\x20','types','\x20of\x20','Access-Control-Allow-Origin','topic','NODE_ENV','9BGaGCI','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','1328170oxUaeV','ROSBridge\x20WebSocket\x20URL:\x20','Successfully\x20registered\x20with\x20server','readyState','getToken','978KsCcLX','username','topics','OPEN','getActiveSessions','Authentication\x20required','APP_PASSWORD','Access-Control-Allow-Methods','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','send','method','samplingRate','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','Environment:\x20','status','credentials','getAttribute','readFileSync','getSharedVideoSources','String\x20value\x20is:\x20','serverUrl','(((.+)+)+)+$','estimatedSize','header','publish','ROSBridge\x20(main)\x20connection\x20error:','.ply','share','1728314wwUVzz','getElementsByTagName','registration_token','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','code','.obj','/appliance/register','Attempting\x20to\x20login\x20to:','Successfully\x20logged\x20in','Failed\x20to\x20register\x20with\x20server','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','ros2\x20param\x20get\x20','response','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','robotId','WSL\x20Appliance','substring','urdf_param_data','Bearer\x20','Proxy\x20listening\x20on\x20port:\x20','./services/webrtcService','exit','values','./services/TopicManager','param_name','json','unknown','get','/rosbridge?type=appliance&token=','base64','Backend\x20Server\x20URL:\x20','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','.dae','getTopicStrategy','package://','isAuthenticated','),\x20attempting\x20to\x20reconnect...','hide','application/json','Topic\x20discovery\x20failed:','Enter\x20username:\x20','dotenv','search','\x20from\x20','Connected\x20to\x20ROSBridge\x20(main)','development','/robot_description','utf8','service_response','/appliance/ping','mesh','Connected\x20to\x20ROSBridge\x20(WebRTC)','/health','sample_skip','webrtc_skip','child_process','parse','endsWith','Connected\x20to\x20server','get_mesh','error','join','wsEndpoint','PORT','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','xmldom','getStatistics','startsWith','Not\x20authenticated','proxyPort','APP_USERNAME','some','string','post','6796390gKvAyY','\x20in\x20use,\x20trying\x20next\x20port...','51265RyzwPL','Failed\x20to\x20ping\x20server:','trim','24387ZNayJX','log','19038AmyTHG','rosbridge','Failed\x20to\x20connect\x20to\x20server:','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','ros2\x20pkg\x20prefix\x20','filename','.stl','./config','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','request_id','existsSync','uri','action','login','name','match','axios','toString','slice','message','/rosapi/topics','strategies','Enter\x20password:\x20','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','toLowerCase','Failed\x20to\x20register\x20with\x20server:','env','catch','config','1926584kddaRY','\x0aAPP_PASSWORD='];a1_0x1654=function(){return _0x364891;};return a1_0x1654();}console[a1_0x3e8fd9(0x109)](a1_0x3e8fd9(0xaa)+(process[a1_0x3e8fd9(0x125)][a1_0x3e8fd9(0x94)]||a1_0x3e8fd9(0xe6))),console[a1_0x3e8fd9(0x109)](a1_0x3e8fd9(0xd7)+config[a1_0x3e8fd9(0xb1)]),console[a1_0x3e8fd9(0x109)](a1_0x3e8fd9(0x99)+config[a1_0x3e8fd9(0x10b)][a1_0x3e8fd9(0xf7)]),console[a1_0x3e8fd9(0x109)](a1_0x3e8fd9(0xcc)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x582e1a,_0x3330fe){const _0x35f088=a1_0x3e8fd9;fs[_0x35f088(0x8a)]('.env',_0x35f088(0x130)+_0x582e1a+_0x35f088(0x129)+_0x3330fe+'\x0a');}function reloadEnv(){const _0x41bbda=a1_0x3e8fd9;dotenv[_0x41bbda(0x127)]({'override':!![]}),config[_0x41bbda(0xac)][_0x41bbda(0x9e)]=process['env'][_0x41bbda(0xff)],config[_0x41bbda(0xac)][_0x41bbda(0x7e)]=process[_0x41bbda(0x125)][_0x41bbda(0xa3)];}async function promptForCredentials(){const _0x596588=a1_0x3e8fd9,_0x252ab0=prompt(_0x596588(0xe1)),_0x1f78cc=prompt[_0x596588(0xde)](_0x596588(0x121));updateEnvFile(_0x252ab0,_0x1f78cc),reloadEnv();}function loadApplianceIdentity(){const _0xd16b28=a1_0x3e8fd9;if(fs[_0xd16b28(0x115)](APPLIANCE_FILE))try{const _0x2625f8=JSON['parse'](fs[_0xd16b28(0xae)](APPLIANCE_FILE,'utf8'));if(_0x2625f8[_0xd16b28(0xc7)]&&_0x2625f8[_0xd16b28(0x6a)])return robotId=_0x2625f8[_0xd16b28(0xc7)],registrationToken=_0x2625f8['registrationToken'],console[_0xd16b28(0x109)](_0xd16b28(0x8d),robotId),topicManager['loadConfig'](_0x2625f8),!![];}catch(_0x542f14){console[_0xd16b28(0xf5)](_0xd16b28(0xf9),_0x542f14);}return![];}function saveApplianceIdentity(_0x47c7aa,_0x2bf0ae){const _0x23dc92=a1_0x3e8fd9;let _0x2fed17={};if(fs[_0x23dc92(0x115)](APPLIANCE_FILE))try{_0x2fed17=JSON['parse'](fs['readFileSync'](APPLIANCE_FILE,_0x23dc92(0xe8)));}catch(_0x3faa64){_0x2fed17={};}_0x2fed17['robotId']=_0x47c7aa,_0x2fed17[_0x23dc92(0x6a)]=_0x2bf0ae,fs[_0x23dc92(0x8a)](APPLIANCE_FILE,JSON[_0x23dc92(0x8e)](_0x2fed17,null,0x2));}async function registerWithServer(){const _0x598a61=a1_0x3e8fd9;try{const _0x17c4c0=authService[_0x598a61(0x9c)]();if(!_0x17c4c0)throw new Error(_0x598a61(0xfd));let _0x656155,_0x193d4b=![];while(!![]){try{robotId&&registrationToken?_0x656155=await axios[_0x598a61(0x102)](config[_0x598a61(0xb1)]+_0x598a61(0xbf),{'name':_0x598a61(0xc8),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x598a61(0xcb)+_0x17c4c0,'Content-Type':_0x598a61(0xdf)}}):_0x656155=await axios[_0x598a61(0x102)](config['serverUrl']+_0x598a61(0xbf),{'name':_0x598a61(0xc8)},{'headers':{'Authorization':_0x598a61(0xcb)+_0x17c4c0,'Content-Type':_0x598a61(0xdf)}});break;}catch(_0x29699b){const _0x4023ef=_0x29699b?.[_0x598a61(0xc5)]?.[_0x598a61(0x7c)]?.[_0x598a61(0xf5)]||_0x29699b['message'];if(!_0x193d4b&&_0x4023ef&&_0x4023ef[_0x598a61(0x123)]()['includes']('robot\x20not\x20found')){console[_0x598a61(0x83)]('Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.');if(fs[_0x598a61(0x115)](APPLIANCE_FILE))fs['unlinkSync'](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x193d4b=!![];continue;}throw _0x29699b;}}if(!_0x656155[_0x598a61(0x7c)]||!_0x656155[_0x598a61(0x7c)][_0x598a61(0xbb)]||!_0x656155[_0x598a61(0x7c)]['id'])throw new Error(_0x598a61(0x84));return registrationToken=_0x656155[_0x598a61(0x7c)]['registration_token'],robotId=_0x656155[_0x598a61(0x7c)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x598a61(0x109)](_0x598a61(0x9a)),!![];}catch(_0x3fa19f){return console['error'](_0x598a61(0x124),_0x3fa19f[_0x598a61(0x11e)]),![];}}function rewriteUrdfMeshUris(_0x58df6e){const _0x35e68f=a1_0x3e8fd9;try{const _0x5e907f=new DOMParser(),_0x266356=_0x5e907f[_0x35e68f(0x137)](_0x58df6e,_0x35e68f(0x71));let _0x384b08=0x0,_0x3afccf=0x0;const _0x577fd4=_0x266356[_0x35e68f(0xba)](_0x35e68f(0xeb));for(let _0x2ef293=0x0;_0x2ef293<_0x577fd4[_0x35e68f(0x73)];_0x2ef293++){const _0x3e9c4f=_0x577fd4[_0x2ef293],_0x4af8b9=_0x3e9c4f[_0x35e68f(0xad)](_0x35e68f(0x10f)),_0x5f58b2=[_0x35e68f(0x110),_0x35e68f(0xd9),_0x35e68f(0xbe),_0x35e68f(0xb7),'.mesh'],_0x1fcfc8=_0x5f58b2[_0x35e68f(0x100)](_0x5d695e=>_0x4af8b9[_0x35e68f(0x123)]()[_0x35e68f(0xf2)](_0x5d695e));if(_0x4af8b9&&_0x4af8b9[_0x35e68f(0xfc)](_0x35e68f(0xdb))&&_0x1fcfc8){_0x384b08++;const _0x4c75b9=APPLIANCE_BASE_URL+_0x35e68f(0x74)+encodeURIComponent(_0x4af8b9);_0x3e9c4f[_0x35e68f(0x75)](_0x35e68f(0x10f),_0x4c75b9),_0x3afccf++,console[_0x35e68f(0x109)](_0x35e68f(0x13a)+_0x4af8b9+_0x35e68f(0x8f)+_0x4c75b9);}}_0x384b08>0x0?console['log']('[URDF\x20REWRITE]\x20Rewrote\x20'+_0x3afccf+_0x35e68f(0x91)+_0x384b08+_0x35e68f(0xa9)):console[_0x35e68f(0x109)](_0x35e68f(0xd8));const _0x3175a5=new XMLSerializer();return _0x3175a5[_0x35e68f(0x6e)](_0x266356);}catch(_0x5e1d6c){return console[_0x35e68f(0xf5)](_0x35e68f(0x113),_0x5e1d6c),_0x58df6e;}}function connectToRosbridge(){const _0x548b7e=a1_0x3e8fd9;try{rosbridgeWs=new WebSocket(config['rosbridge'][_0x548b7e(0xf7)]),rosbridgeWs['on'](_0x548b7e(0x87),()=>{const _0x1969ce=_0x548b7e;console[_0x1969ce(0x109)](_0x1969ce(0xe5));const _0x29fe39=require('roslib'),_0x22a526=new _0x29fe39['Ros']({'url':config[_0x1969ce(0x10b)][_0x1969ce(0xf7)]});_0x22a526['on'](_0x1969ce(0x6b),()=>{setTimeout(()=>{const _0x435c2e=a1_0xa1b9;topicManager['discoverTopics'](_0x22a526)[_0x435c2e(0x126)](_0x1a1500=>{const _0x254fdb=_0x435c2e;console[_0x254fdb(0xf5)](_0x254fdb(0xe0),_0x1a1500);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x548b7e(0x11e),_0x48cc46=>{const _0x5143de=_0x548b7e;if(serverWs&&serverWs[_0x5143de(0x9b)]===WebSocket[_0x5143de(0xa0)]){let _0x3c85fa=_0x48cc46[_0x5143de(0x11c)]();try{const _0x4d9ab1=JSON['parse'](_0x3c85fa);if(_0x4d9ab1['op']===_0x5143de(0xb5)&&_0x4d9ab1[_0x5143de(0x93)]){const _0x9d130=topicManager[_0x5143de(0x6c)](_0x4d9ab1);switch(_0x9d130[_0x5143de(0x117)]){case _0x5143de(0xee):return;case _0x5143de(0xef):return;case'forward':default:_0x3c85fa=JSON['stringify'](_0x9d130['message']);break;}}if((_0x4d9ab1['op']===_0x5143de(0xe9)||_0x4d9ab1['op']===_0x5143de(0x7d))&&(_0x4d9ab1['service']===_0x5143de(0x11f)||_0x4d9ab1[_0x5143de(0xcf)]&&_0x4d9ab1[_0x5143de(0xcf)][_0x5143de(0x9f)])){console[_0x5143de(0x109)]('[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata');const _0x4a0da1=_0x4d9ab1[_0x5143de(0xcf)]?.[_0x5143de(0x9f)]||[],_0x4a44e7=_0x4d9ab1[_0x5143de(0xcf)]?.[_0x5143de(0x90)]||[],_0x4dc559=_0x4a0da1[_0x5143de(0x7a)]((_0x57911c,_0x5bd1fc)=>{const _0xdf3d18=_0x5143de,_0x49263c=topicManager[_0xdf3d18(0xda)](_0x57911c);return{'name':_0x57911c,'type':_0x4a44e7[_0x5bd1fc]||_0xdf3d18(0xd3),'throttling':_0x49263c?{'isThrottled':_0x49263c[_0xdf3d18(0x6f)]===_0xdf3d18(0x136),'strategy':_0x49263c['strategy'],'samplingRate':_0x49263c[_0xdf3d18(0xa8)],'reason':_0x49263c['reason'],'estimatedSize':_0x49263c[_0xdf3d18(0xb3)]}:null};});_0x4d9ab1['values']={'topics':_0x4dc559['map'](_0x2eec82=>_0x2eec82[_0x5143de(0x119)]),'types':_0x4dc559[_0x5143de(0x7a)](_0x4db350=>_0x4db350[_0x5143de(0x12a)]),'throttling':_0x4dc559[_0x5143de(0x7a)](_0x37e2ca=>_0x37e2ca[_0x5143de(0x8b)])},_0x3c85fa=JSON[_0x5143de(0x8e)](_0x4d9ab1),console[_0x5143de(0x109)](_0x5143de(0x97));}if(_0x4d9ab1['op']===_0x5143de(0xb5)&&_0x4d9ab1[_0x5143de(0x93)]===_0x5143de(0xe7))try{const _0x7ff6f3=_0x4d9ab1[_0x5143de(0x78)][_0x5143de(0x7c)],_0x242823=rewriteUrdfMeshUris(_0x7ff6f3);_0x4d9ab1[_0x5143de(0x78)][_0x5143de(0x7c)]=_0x242823,_0x3c85fa=JSON['stringify'](_0x4d9ab1);}catch(_0x1674b9){console[_0x5143de(0xf5)](_0x5143de(0x133),_0x1674b9);}}catch(_0x175f3d){console[_0x5143de(0x83)](_0x5143de(0x12b),_0x175f3d[_0x5143de(0x11e)]);}serverWs[_0x5143de(0xa6)](_0x3c85fa);}}),rosbridgeWs['on']('close',()=>{const _0x1c8784=_0x548b7e;console['log'](_0x1c8784(0x10d)),webrtcService[_0x1c8784(0x88)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x548b7e(0xf5),_0x3b029c=>{const _0x3fdad3=_0x548b7e;console[_0x3fdad3(0xf5)](_0x3fdad3(0xb6),_0x3b029c);});}catch(_0x2bf589){console['error'](_0x548b7e(0xbc),_0x2bf589),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x11a6e5=a1_0x3e8fd9;try{rosbridgeWebRTCWs=new WebSocket(config[_0x11a6e5(0x10b)][_0x11a6e5(0xf7)]),rosbridgeWebRTCWs['on'](_0x11a6e5(0x87),()=>{const _0x504a3e=_0x11a6e5;console['log'](_0x504a3e(0xec)),webrtcService[_0x504a3e(0x69)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x11a6e5(0x11e),_0xa41514=>{}),rosbridgeWebRTCWs['on'](_0x11a6e5(0x132),()=>{const _0x1a6fe6=_0x11a6e5;console[_0x1a6fe6(0x109)](_0x1a6fe6(0x112)),webrtcService[_0x1a6fe6(0x88)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on']('error',_0x14d472=>{const _0x1872a6=_0x11a6e5;console[_0x1872a6(0xf5)](_0x1872a6(0x135),_0x14d472);});}catch(_0x51cdac){console[_0x11a6e5(0xf5)]('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):',_0x51cdac),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x187e9e=a1_0x3e8fd9;try{if(!registrationToken)throw new Error(_0x187e9e(0x122));const _0x476643=config[_0x187e9e(0xb1)][_0x187e9e(0x12e)]('http','ws')+_0x187e9e(0xd5)+registrationToken;serverWs=new WebSocket(_0x476643),serverWs['on']('open',()=>{const _0x1c8c62=_0x187e9e;console[_0x1c8c62(0x109)](_0x1c8c62(0xf3)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x1c8c62(0x9b)]===WebSocket[_0x1c8c62(0xa0)]&&webrtcService[_0x1c8c62(0x69)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x187e9e(0x11e),_0x17cd67=>{const _0x5e172d=_0x187e9e;if(rosbridgeWs&&rosbridgeWs[_0x5e172d(0x9b)]===WebSocket[_0x5e172d(0xa0)]){let _0x5e39cc=_0x17cd67[_0x5e172d(0x11c)]();try{const _0x538946=JSON[_0x5e172d(0xf1)](_0x5e39cc);if(webrtcService[_0x5e172d(0x6c)](_0x538946))return;if(_0x538946['op']===_0x5e172d(0x8c)&&typeof _0x538946['param_name']===_0x5e172d(0x101)&&_0x538946['request_id'])try{console['log'](_0x5e172d(0xa5)+_0x538946['param_name']);const _0x16eb0a=execSync(_0x5e172d(0xc4)+_0x538946[_0x5e172d(0xd1)],{'encoding':_0x5e172d(0xe8)})['trim']();let _0x3cc4e5=_0x16eb0a;_0x16eb0a['startsWith'](_0x5e172d(0xb0))&&(_0x3cc4e5=_0x16eb0a[_0x5e172d(0xc9)](_0x5e172d(0xb0)[_0x5e172d(0x73)]()));_0x3cc4e5['startsWith']('\x22')&&_0x3cc4e5[_0x5e172d(0xf2)]('\x22')&&(_0x3cc4e5=_0x3cc4e5[_0x5e172d(0x11d)](0x1,-0x1));_0x3cc4e5=_0x3cc4e5[_0x5e172d(0x12e)](/\\n/g,'\x0a')[_0x5e172d(0x12e)](/\\"/g,'\x22');const _0x19a09d={'op':_0x5e172d(0xca),'request_id':_0x538946['request_id'],'data':_0x3cc4e5};serverWs[_0x5e172d(0xa6)](JSON[_0x5e172d(0x8e)](_0x19a09d)),console[_0x5e172d(0x109)]('[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20'+_0x538946['param_name']);return;}catch(_0x209937){console[_0x5e172d(0xf5)](_0x5e172d(0x86),_0x209937);const _0x411330={'op':_0x5e172d(0xca),'request_id':_0x538946[_0x5e172d(0x114)],'error':_0x209937[_0x5e172d(0x11e)]};serverWs[_0x5e172d(0xa6)](JSON[_0x5e172d(0x8e)](_0x411330));return;}if(_0x538946['op']===_0x5e172d(0xf4)&&typeof _0x538946[_0x5e172d(0x116)]==='string'&&_0x538946[_0x5e172d(0x114)])try{const _0x194d43=_0x538946['uri'][_0x5e172d(0x11a)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x194d43){const _0x31b8c3=_0x194d43[0x1],_0x165609=_0x194d43[0x2],_0x2cbb2a=execSync(_0x5e172d(0x10e)+_0x31b8c3,{'encoding':'utf8'})[_0x5e172d(0x107)](),_0x3c8ecb=path[_0x5e172d(0xf6)](_0x2cbb2a,_0x5e172d(0xb8),_0x31b8c3,_0x165609);if(!fs['existsSync'](_0x3c8ecb))throw new Error('Mesh\x20file\x20not\x20found:\x20'+_0x3c8ecb);const _0x5e199b=fs['readFileSync'](_0x3c8ecb),_0x47ab8f={'op':_0x5e172d(0x12d),'request_id':_0x538946[_0x5e172d(0x114)],'data':_0x5e199b['toString'](_0x5e172d(0xd6))};serverWs['send'](JSON[_0x5e172d(0x8e)](_0x47ab8f)),console[_0x5e172d(0x109)](_0x5e172d(0x138)+_0x538946[_0x5e172d(0x116)]+_0x5e172d(0xe4)+_0x3c8ecb);return;}}catch(_0x3c2a2a){console[_0x5e172d(0xf5)](_0x5e172d(0x76),_0x3c2a2a);const _0x502ad6={'op':_0x5e172d(0x12d),'request_id':_0x538946[_0x5e172d(0x114)],'error':_0x3c2a2a['message']};serverWs[_0x5e172d(0xa6)](JSON[_0x5e172d(0x8e)](_0x502ad6));return;}rosbridgeWs[_0x5e172d(0xa6)](_0x5e39cc);}catch(_0x3bafdf){rosbridgeWs[_0x5e172d(0xa6)](_0x5e39cc);}}}),serverWs['on'](_0x187e9e(0x132),(_0x3c84e7,_0x553f35)=>{const _0x4cf0ef=_0x187e9e;console[_0x4cf0ef(0x109)](_0x4cf0ef(0x70)+_0x3c84e7+':\x20'+_0x553f35+_0x4cf0ef(0xdd)),webrtcService[_0x4cf0ef(0x88)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x187e9e(0xf5),_0x1feeb8=>{console['error']('Server\x20connection\x20error:',_0x1feeb8);});}catch(_0x17a2a9){console[_0x187e9e(0xf5)](_0x187e9e(0x10c),_0x17a2a9),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x19af28,_0xb391f7,_0x2ed297)=>{const _0x3a8d26=a1_0x3e8fd9;if(!authService[_0x3a8d26(0xdc)]()){console[_0x3a8d26(0x109)](_0x3a8d26(0xc0),config[_0x3a8d26(0xb1)]);const _0x1932dd=await authService[_0x3a8d26(0x118)]();if(!_0x1932dd)return _0xb391f7[_0x3a8d26(0xab)](0x191)[_0x3a8d26(0xd2)]({'error':_0x3a8d26(0xa2)});}_0x2ed297();};app[a1_0x3e8fd9(0x131)]((_0x3aae01,_0x3bf00f,_0x3fce71)=>{const _0x39335c=a1_0x3e8fd9;_0x3bf00f['header'](_0x39335c(0x92),'*'),_0x3bf00f[_0x39335c(0xb4)](_0x39335c(0xa4),_0x39335c(0xc6)),_0x3bf00f[_0x39335c(0xb4)]('Access-Control-Allow-Headers',_0x39335c(0x72)),_0x3aae01[_0x39335c(0xa7)]===_0x39335c(0x7b)?_0x3bf00f['sendStatus'](0xc8):_0x3fce71();}),app[a1_0x3e8fd9(0xd4)]('/',requireAuth,(_0x4c8334,_0x3c2994)=>{const _0x1055a2=a1_0x3e8fd9;_0x3c2994[_0x1055a2(0xa6)](_0x1055a2(0x80));}),app[a1_0x3e8fd9(0xd4)](a1_0x3e8fd9(0xed),async(_0x4e5ee0,_0xcffdb)=>{const _0x27ca70=a1_0x3e8fd9,_0x350905=authService[_0x27ca70(0xdc)](),_0x42ce3d=webrtcService[_0x27ca70(0xa1)](),_0x4b33a2=webrtcService[_0x27ca70(0xaf)](),_0x4aa747=topicManager[_0x27ca70(0xfb)]();_0xcffdb['json']({'status':'ok','environment':process[_0x27ca70(0x125)][_0x27ca70(0x94)]||_0x27ca70(0xe6),'backendUrl':config[_0x27ca70(0xb1)],'rosbridgeUrl':config['rosbridge'][_0x27ca70(0xf7)],'proxyPort':port,'authenticated':_0x350905,'topicManagement':{'discovered':_0x4aa747[_0x27ca70(0x7f)],'strategies':_0x4aa747[_0x27ca70(0x120)],'largeDataTopics':_0x4aa747[_0x27ca70(0x6d)][_0x27ca70(0x73)],'largeTopicsList':_0x4aa747[_0x27ca70(0x6d)]},'webrtc':{'activeSessions':_0x42ce3d[_0x27ca70(0x73)],'sharedVideoSources':_0x4b33a2[_0x27ca70(0x73)],'sessions':_0x42ce3d,'sharedSources':_0x4b33a2}});});const getInitialPort=()=>{const _0x25f2f9=a1_0x3e8fd9;if(process[_0x25f2f9(0x125)][_0x25f2f9(0xf8)])return parseInt(process[_0x25f2f9(0x125)][_0x25f2f9(0xf8)],0xa);return config[_0x25f2f9(0x10b)][_0x25f2f9(0xfe)];};async function listenWithRetries(_0xdb03dd,_0x513e47,_0x5e2f27=0xa){const _0x5f1082=a1_0x3e8fd9;let _0x5f0f01=_0x513e47;for(let _0x45c50c=0x1;_0x45c50c<=_0x5e2f27;_0x45c50c++){try{return await new Promise((_0xe456b1,_0x38c784)=>{const _0x39d6b5=a1_0xa1b9,_0x1617f4=_0xdb03dd['listen'](_0x5f0f01,()=>{const _0x52de54=a1_0xa1b9;console[_0x52de54(0x109)]('Appliance\x20server\x20started\x20successfully\x20on\x20port\x20'+_0x5f0f01),_0xe456b1(_0x1617f4);});_0x1617f4['on'](_0x39d6b5(0xf5),_0x5d330c=>{const _0x4e1f23=_0x39d6b5;_0x5d330c[_0x4e1f23(0xbd)]==='EADDRINUSE'?(console[_0x4e1f23(0x83)](_0x4e1f23(0x82)+_0x5f0f01+_0x4e1f23(0x104)),_0x38c784(_0x5d330c)):_0x38c784(_0x5d330c);});}),_0x5f0f01;}catch(_0x2f3a55){_0x5f0f01++;}}throw new Error(_0x5f1082(0x12c)+_0x5e2f27+_0x5f1082(0x77)+_0x513e47);}const startApp=async()=>{const _0x555375=a1_0x3e8fd9;try{let _0x29bfaf=await authService['login']();while(!_0x29bfaf){console[_0x555375(0x109)](_0x555375(0xc3)),await promptForCredentials(),_0x29bfaf=await authService[_0x555375(0x118)]();}console['log'](_0x555375(0xc1));!loadApplianceIdentity()&&console[_0x555375(0x109)](_0x555375(0x96));console[_0x555375(0x109)](_0x555375(0x12f));const _0x218053=await registerWithServer();if(!_0x218053)throw new Error(_0x555375(0xc2));connectToRosbridge(),connectToServer();const _0x182606=getInitialPort();await listenWithRetries(app,_0x182606,0xa);}catch(_0x10aab6){console[_0x555375(0xf5)](_0x555375(0x85),_0x10aab6),process[_0x555375(0xce)](0x1);}};setInterval(async()=>{const _0x2b4334=a1_0x3e8fd9;try{if(robotId){const _0x135deb=authService['getToken']();await axios[_0x2b4334(0x102)](config[_0x2b4334(0xb1)]+_0x2b4334(0xea),{'robotId':robotId},{'headers':{'Authorization':_0x2b4334(0xcb)+_0x135deb,'Content-Type':_0x2b4334(0xdf)}});}}catch(_0x33cb28){console[_0x2b4334(0xf5)](_0x2b4334(0x106),_0x33cb28[_0x2b4334(0x11e)]);}},0x1388),startApp();