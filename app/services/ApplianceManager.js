const a2_0x4b64d6=a2_0x2314;(function(_0x296685,_0x595867){const _0x172980=a2_0x2314,_0x5e1e87=_0x296685();while(!![]){try{const _0x4794e0=parseInt(_0x172980(0x11e))/0x1+-parseInt(_0x172980(0x120))/0x2*(parseInt(_0x172980(0xad))/0x3)+parseInt(_0x172980(0x127))/0x4*(parseInt(_0x172980(0xef))/0x5)+-parseInt(_0x172980(0xb4))/0x6*(-parseInt(_0x172980(0x11a))/0x7)+-parseInt(_0x172980(0x114))/0x8+parseInt(_0x172980(0xca))/0x9+parseInt(_0x172980(0xc7))/0xa*(-parseInt(_0x172980(0xe5))/0xb);if(_0x4794e0===_0x595867)break;else _0x5e1e87['push'](_0x5e1e87['shift']());}catch(_0xacc00e){_0x5e1e87['push'](_0x5e1e87['shift']());}}}(a2_0x2e26,0xc62c5));const a2_0x51a3cb=(function(){let _0x2c3a25=!![];return function(_0x1be49e,_0xf05b91){const _0x2c432f=_0x2c3a25?function(){const _0x4fee01=a2_0x2314;if(_0xf05b91){const _0x371268=_0xf05b91[_0x4fee01(0xe0)](_0x1be49e,arguments);return _0xf05b91=null,_0x371268;}}:function(){};return _0x2c3a25=![],_0x2c432f;};}()),a2_0x4e7680=a2_0x51a3cb(this,function(){const _0x1d1708=a2_0x2314;return a2_0x4e7680[_0x1d1708(0x11d)]()[_0x1d1708(0xec)]('(((.+)+)+)+$')[_0x1d1708(0x11d)]()[_0x1d1708(0xe1)](a2_0x4e7680)[_0x1d1708(0xec)]('(((.+)+)+)+$');});function a2_0x2314(_0x244ae3,_0x52547d){const _0x1a6cb=a2_0x2e26();return a2_0x2314=function(_0x4e7680,_0x51a3cb){_0x4e7680=_0x4e7680-0xa6;let _0x2e26c9=_0x1a6cb[_0x4e7680];return _0x2e26c9;},a2_0x2314(_0x244ae3,_0x52547d);}function a2_0x2e26(){const _0x509606=['Bearer\x20','login','promptForCredentials','registration_token','NOT\x20SET','length','PORT','initializeReverseProxy','totalTopics','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','reverseProxy','startServer','Environment:\x20','registrationToken','listen','Authentication\x20required','Stopping\x20appliance...','warn','getApp','connectToServer','pingInterval','startPingInterval','6545704gydJbO','Failed\x20to\x20start\x20appliance:','port','Not\x20authenticated','header','hide','1561IlYhRE','strategies','Port\x20','toString','598779mVpIhZ','loadApplianceIdentity','2908jPygwd','closeAllConnections','Please\x20run:\x20./setup.sh\x20reconfigure','authService','ReverseProxyService','OPTIONS','urdfService','3910932CPSLMh','getStatistics','rosbridge','status','method','username','reloadEnv','largeDataTopics','serverUrl','APP_USERNAME','registerWithServer','Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file','credentials','Proxy\x20listening\x20on\x20port:\x20','Initial\x20credentials\x20loaded\x20from\x20environment','response','Failed\x20to\x20register\x20with\x20server','1158eMZkOC','loadConfig','Attempting\x20to\x20login\x20to:','prompt-sync','APPLIANCE_FILE','/health','Appliance\x20is\x20running\x20and\x20authenticated!','23910qQnZuy','SET','NODE_ENV','server','Loaded\x20appliance\x20identity:','axios','stop','ROSBridge\x20WebSocket\x20URL:\x20','wsEndpoint','error','application/json','initialize','Appliance\x20started\x20successfully','/appliance/ping','env','development','topicManager','APP_PASSWORD','config','30QYAFzu','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','close','9621045wzjLsC','Failed\x20to\x20ping\x20server:','data','writeFileSync','existsSync','app','parse','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','get','getActiveSessions','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','setupExpressApp','getToken','WSL\x20Appliance','message','Loaded\x20credentials:','Failed\x20to\x20register\x20with\x20server:','Successfully\x20logged\x20in','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','getInitialPort','isAuthenticated','utf8','apply','constructor','dotenv','getConnectionStatus','Registering\x20with\x20server...','4924326culPhm','unlinkSync','webrtcService','readFileSync','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','toLowerCase','robotId','search','\x0aAPP_PASSWORD=','connectToRosbridge','5xnGKZf','getSharedVideoSources','EADDRINUSE','saveApplianceIdentity','send','Appliance\x20stopped','password','use','\x20in\x20use,\x20trying\x20next\x20port...','updateEnvFile','Backend\x20Server\x20URL:\x20','log','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','start','post'];a2_0x2e26=function(){return _0x509606;};return a2_0x2e26();}a2_0x4e7680();const dotenv=require(a2_0x4b64d6(0xe2)),express=require('express'),axios=require(a2_0x4b64d6(0xb9)),fs=require('fs'),prompt=require(a2_0x4b64d6(0xb0))({'sigint':!![]});class ApplianceManager{constructor(_0x10a147,_0x2da4ac,_0xeca956,_0x1efd0d,_0x88a3be,_0x33c7ae){const _0x3dfd89=a2_0x4b64d6;this[_0x3dfd89(0xc6)]=_0x10a147,this['authService']=_0x2da4ac,this[_0x3dfd89(0xe7)]=_0xeca956,this[_0x3dfd89(0xc4)]=_0x1efd0d,this[_0x3dfd89(0x126)]=_0x88a3be,this[_0x3dfd89(0x124)]=_0x33c7ae,this[_0x3dfd89(0xcf)]=express(),this['server']=null,this[_0x3dfd89(0x108)]=null,this[_0x3dfd89(0x10b)]=null,this[_0x3dfd89(0xeb)]=null,this[_0x3dfd89(0xb1)]='.appliance.json',this[_0x3dfd89(0x116)]=process['env'][_0x3dfd89(0x104)]||_0x10a147['rosbridge']['proxyPort'],this[_0x3dfd89(0x112)]=null;}[a2_0x4b64d6(0xbf)](){const _0x4d18a1=a2_0x4b64d6;dotenv[_0x4d18a1(0xc6)](),process[_0x4d18a1(0xc2)][_0x4d18a1(0x130)]&&process[_0x4d18a1(0xc2)][_0x4d18a1(0xc5)]&&(this[_0x4d18a1(0xc6)][_0x4d18a1(0xa8)][_0x4d18a1(0x12c)]=process[_0x4d18a1(0xc2)][_0x4d18a1(0x130)],this[_0x4d18a1(0xc6)][_0x4d18a1(0xa8)]['password']=process[_0x4d18a1(0xc2)][_0x4d18a1(0xc5)],console[_0x4d18a1(0xfa)](_0x4d18a1(0xaa))),console[_0x4d18a1(0xfa)](_0x4d18a1(0x10a)+(process[_0x4d18a1(0xc2)][_0x4d18a1(0xb6)]||_0x4d18a1(0xc3))),console[_0x4d18a1(0xfa)](_0x4d18a1(0xf9)+this[_0x4d18a1(0xc6)][_0x4d18a1(0x12f)]),console['log'](_0x4d18a1(0xbb)+this[_0x4d18a1(0xc6)][_0x4d18a1(0x129)][_0x4d18a1(0xbc)]),console['log'](_0x4d18a1(0xa9)+this[_0x4d18a1(0x116)]),this[_0x4d18a1(0xd5)]();}[a2_0x4b64d6(0xd5)](){const _0x5d0439=a2_0x4b64d6;this[_0x5d0439(0xcf)][_0x5d0439(0xf6)]((_0x42dee1,_0x40eed3,_0xf9cc7f)=>{const _0x33d841=_0x5d0439;_0x40eed3[_0x33d841(0x118)]('Access-Control-Allow-Origin','*'),_0x40eed3[_0x33d841(0x118)]('Access-Control-Allow-Methods',_0x33d841(0xd1)),_0x40eed3['header']('Access-Control-Allow-Headers','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization'),_0x42dee1[_0x33d841(0x12b)]===_0x33d841(0x125)?_0x40eed3['sendStatus'](0xc8):_0xf9cc7f();});const _0x439ef5=async(_0x28e0f2,_0x1a72b2,_0x599a64)=>{const _0x535da9=_0x5d0439;if(!this[_0x535da9(0x123)][_0x535da9(0xde)]()){console[_0x535da9(0xfa)](_0x535da9(0xaf),this[_0x535da9(0xc6)][_0x535da9(0x12f)]);const _0x31e37b=await this[_0x535da9(0x123)][_0x535da9(0xff)]();if(!_0x31e37b)return _0x1a72b2[_0x535da9(0x12a)](0x191)['json']({'error':_0x535da9(0x10d)});}_0x599a64();};this[_0x5d0439(0xcf)][_0x5d0439(0xd2)]('/',_0x439ef5,(_0x4990bd,_0x1c093e)=>{const _0x48dfe7=_0x5d0439;_0x1c093e[_0x48dfe7(0xf3)](_0x48dfe7(0xb3));}),this[_0x5d0439(0xcf)]['get'](_0x5d0439(0xb2),async(_0x38893e,_0x4fd110)=>{const _0x50361c=_0x5d0439,_0x31f91e=this[_0x50361c(0x123)][_0x50361c(0xde)](),_0x46286f=this['webrtcService'][_0x50361c(0xd3)](),_0x43d0dd=this[_0x50361c(0xe7)][_0x50361c(0xf0)](),_0xcb9880=this['topicManager'][_0x50361c(0x128)](),_0x55c38a=this['reverseProxy']?this[_0x50361c(0x108)][_0x50361c(0xe3)]():null;_0x4fd110['json']({'status':'ok','environment':process['env'][_0x50361c(0xb6)]||'development','backendUrl':this[_0x50361c(0xc6)][_0x50361c(0x12f)],'rosbridgeUrl':this['config'][_0x50361c(0x129)][_0x50361c(0xbc)],'proxyPort':this[_0x50361c(0x116)],'authenticated':_0x31f91e,'connections':_0x55c38a,'topicManagement':{'discovered':_0xcb9880[_0x50361c(0x106)],'strategies':_0xcb9880[_0x50361c(0x11b)],'largeDataTopics':_0xcb9880[_0x50361c(0x12e)][_0x50361c(0x103)],'largeTopicsList':_0xcb9880['largeDataTopics']},'webrtc':{'activeSessions':_0x46286f['length'],'sharedVideoSources':_0x43d0dd[_0x50361c(0x103)],'sessions':_0x46286f,'sharedSources':_0x43d0dd}});});}['updateEnvFile'](_0x86c531,_0x3bc625){const _0x518d5c=a2_0x4b64d6;fs[_0x518d5c(0xcd)]('.env','APP_USERNAME='+_0x86c531+_0x518d5c(0xed)+_0x3bc625+'\x0a');}[a2_0x4b64d6(0x12d)](){const _0x46e278=a2_0x4b64d6;dotenv[_0x46e278(0xc6)]({'override':!![]}),this[_0x46e278(0xc6)][_0x46e278(0xa8)][_0x46e278(0x12c)]=process['env'][_0x46e278(0x130)],this['config'][_0x46e278(0xa8)][_0x46e278(0xf5)]=process['env'][_0x46e278(0xc5)],console['log'](_0x46e278(0xd9),{'username':this[_0x46e278(0xc6)][_0x46e278(0xa8)][_0x46e278(0x12c)]?_0x46e278(0xb5):'NOT\x20SET','password':this[_0x46e278(0xc6)][_0x46e278(0xa8)]['password']?_0x46e278(0xb5):_0x46e278(0x102)});}async[a2_0x4b64d6(0x100)](){const _0x171e1d=a2_0x4b64d6;process[_0x171e1d(0xc2)][_0x171e1d(0xb6)]==='production'&&(console[_0x171e1d(0xbd)](_0x171e1d(0xa7)),console[_0x171e1d(0xbd)](_0x171e1d(0x122)),process['exit'](0x1));const _0x5c92d7=prompt('Enter\x20username:\x20'),_0x17697d=prompt[_0x171e1d(0x119)]('Enter\x20password:\x20');this[_0x171e1d(0xf8)](_0x5c92d7,_0x17697d),this[_0x171e1d(0x12d)]();}[a2_0x4b64d6(0x11f)](){const _0x370d33=a2_0x4b64d6;if(fs[_0x370d33(0xce)](this[_0x370d33(0xb1)]))try{const _0x37aca2=JSON[_0x370d33(0xd0)](fs[_0x370d33(0xe8)](this[_0x370d33(0xb1)],_0x370d33(0xdf)));if(_0x37aca2[_0x370d33(0xeb)]&&_0x37aca2[_0x370d33(0x10b)])return this[_0x370d33(0xeb)]=_0x37aca2[_0x370d33(0xeb)],this[_0x370d33(0x10b)]=_0x37aca2[_0x370d33(0x10b)],console[_0x370d33(0xfa)](_0x370d33(0xb8),this[_0x370d33(0xeb)]),this[_0x370d33(0xc4)][_0x370d33(0xae)](_0x37aca2),!![];}catch(_0x485832){console[_0x370d33(0xbd)](_0x370d33(0xc8),_0x485832);}return![];}[a2_0x4b64d6(0xf2)](_0x3ecd5a,_0x1fa83f){const _0x2b171f=a2_0x4b64d6;let _0x399c08={};if(fs[_0x2b171f(0xce)](this['APPLIANCE_FILE']))try{_0x399c08=JSON[_0x2b171f(0xd0)](fs[_0x2b171f(0xe8)](this[_0x2b171f(0xb1)],'utf8'));}catch(_0x128016){_0x399c08={};}_0x399c08[_0x2b171f(0xeb)]=_0x3ecd5a,_0x399c08[_0x2b171f(0x10b)]=_0x1fa83f,fs[_0x2b171f(0xcd)](this[_0x2b171f(0xb1)],JSON['stringify'](_0x399c08,null,0x2));}async['registerWithServer'](){const _0x4a5425=a2_0x4b64d6;try{const _0x524572=this[_0x4a5425(0x123)]['getToken']();if(!_0x524572)throw new Error(_0x4a5425(0x117));let _0x4afb97,_0xaed252=![];while(!![]){try{this[_0x4a5425(0xeb)]&&this[_0x4a5425(0x10b)]?_0x4afb97=await axios[_0x4a5425(0xfd)](this[_0x4a5425(0xc6)][_0x4a5425(0x12f)]+'/appliance/register',{'name':_0x4a5425(0xd7),'robotId':this[_0x4a5425(0xeb)],'registration_token':this[_0x4a5425(0x10b)]},{'headers':{'Authorization':_0x4a5425(0xfe)+_0x524572,'Content-Type':_0x4a5425(0xbe)}}):_0x4afb97=await axios[_0x4a5425(0xfd)](this[_0x4a5425(0xc6)]['serverUrl']+'/appliance/register',{'name':_0x4a5425(0xd7)},{'headers':{'Authorization':_0x4a5425(0xfe)+_0x524572,'Content-Type':'application/json'}});break;}catch(_0x3d7875){const _0x20a921=_0x3d7875?.[_0x4a5425(0xab)]?.[_0x4a5425(0xcc)]?.['error']||_0x3d7875[_0x4a5425(0xd8)];if(!_0xaed252&&_0x20a921&&_0x20a921[_0x4a5425(0xea)]()['includes']('robot\x20not\x20found')){console[_0x4a5425(0x10f)](_0x4a5425(0xdc));if(fs['existsSync'](this[_0x4a5425(0xb1)]))fs[_0x4a5425(0xe6)](this[_0x4a5425(0xb1)]);this[_0x4a5425(0xeb)]=null,this[_0x4a5425(0x10b)]=null,_0xaed252=!![];continue;}throw _0x3d7875;}}if(!_0x4afb97['data']||!_0x4afb97[_0x4a5425(0xcc)][_0x4a5425(0x101)]||!_0x4afb97[_0x4a5425(0xcc)]['id'])throw new Error('Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server');return this['registrationToken']=_0x4afb97[_0x4a5425(0xcc)][_0x4a5425(0x101)],this[_0x4a5425(0xeb)]=_0x4afb97[_0x4a5425(0xcc)]['id'],this['saveApplianceIdentity'](this[_0x4a5425(0xeb)],this[_0x4a5425(0x10b)]),console['log']('Successfully\x20registered\x20with\x20server'),!![];}catch(_0x4c370b){return console[_0x4a5425(0xbd)](_0x4a5425(0xda),_0x4c370b['message']),![];}}[a2_0x4b64d6(0x105)](){const _0x396a4a=a2_0x4b64d6;this[_0x396a4a(0x108)]=new this[(_0x396a4a(0x124))](this[_0x396a4a(0xc6)],this[_0x396a4a(0x123)],this['webrtcService'],this[_0x396a4a(0xc4)],this[_0x396a4a(0x126)]),this[_0x396a4a(0x108)][_0x396a4a(0xbf)](this[_0x396a4a(0xeb)],this['registrationToken']),this['reverseProxy'][_0x396a4a(0xee)](),this[_0x396a4a(0x108)][_0x396a4a(0x111)]();}[a2_0x4b64d6(0xdd)](){const _0x57b604=a2_0x4b64d6;if(process[_0x57b604(0xc2)][_0x57b604(0x104)])return parseInt(process[_0x57b604(0xc2)]['PORT'],0xa);return this[_0x57b604(0xc6)][_0x57b604(0x129)]['proxyPort'];}async[a2_0x4b64d6(0x109)](_0x3f1703=0xa){const _0x5cfbc6=a2_0x4b64d6;let _0x4e44d7=this['getInitialPort']();for(let _0x3cb337=0x1;_0x3cb337<=_0x3f1703;_0x3cb337++){try{await new Promise((_0x2cb369,_0x5b7e93)=>{const _0x36a791=a2_0x2314;this[_0x36a791(0xb7)]=this['app'][_0x36a791(0x10c)](_0x4e44d7,()=>{const _0x46b9c1=_0x36a791;console[_0x46b9c1(0xfa)](_0x46b9c1(0xe9)+_0x4e44d7),this[_0x46b9c1(0x116)]=_0x4e44d7,_0x2cb369();}),this[_0x36a791(0xb7)]['on']('error',_0x58a1b9=>{const _0x5bb4ff=_0x36a791;_0x58a1b9['code']===_0x5bb4ff(0xf1)?(console[_0x5bb4ff(0x10f)](_0x5bb4ff(0x11c)+_0x4e44d7+_0x5bb4ff(0xf7)),_0x5b7e93(_0x58a1b9)):_0x5b7e93(_0x58a1b9);});});return;}catch(_0x3d2aef){_0x4e44d7++;}}throw new Error(_0x5cfbc6(0x107)+_0x3f1703+'\x20attempts\x20starting\x20from\x20'+this[_0x5cfbc6(0xdd)]());}[a2_0x4b64d6(0x113)](){const _0x22b1fc=a2_0x4b64d6;this[_0x22b1fc(0x112)]=setInterval(async()=>{const _0x73bfeb=_0x22b1fc;try{if(this['robotId']){const _0x47fba1=this[_0x73bfeb(0x123)][_0x73bfeb(0xd6)]();await axios[_0x73bfeb(0xfd)](this[_0x73bfeb(0xc6)][_0x73bfeb(0x12f)]+_0x73bfeb(0xc1),{'robotId':this['robotId']},{'headers':{'Authorization':_0x73bfeb(0xfe)+_0x47fba1,'Content-Type':_0x73bfeb(0xbe)}});}}catch(_0x26f0b4){console[_0x73bfeb(0xbd)](_0x73bfeb(0xcb),_0x26f0b4['message']);}},0x1388);}async[a2_0x4b64d6(0xfc)](){const _0x542423=a2_0x4b64d6;try{this[_0x542423(0x12d)]();let _0x10a9e7=await this[_0x542423(0x123)][_0x542423(0xff)]();while(!_0x10a9e7){console[_0x542423(0xfa)](_0x542423(0xfb)),await this['promptForCredentials'](),_0x10a9e7=await this[_0x542423(0x123)][_0x542423(0xff)]();}console[_0x542423(0xfa)](_0x542423(0xdb));!this[_0x542423(0x11f)]()&&console[_0x542423(0xfa)](_0x542423(0xd4));console[_0x542423(0xfa)](_0x542423(0xe4));const _0x31876e=await this[_0x542423(0xa6)]();if(!_0x31876e)throw new Error(_0x542423(0xac));this[_0x542423(0x105)](),await this[_0x542423(0x109)](),this['startPingInterval'](),console[_0x542423(0xfa)](_0x542423(0xc0));}catch(_0x4b6b01){console['error'](_0x542423(0x115),_0x4b6b01);throw _0x4b6b01;}}async[a2_0x4b64d6(0xba)](){const _0x3b4e4f=a2_0x4b64d6;console['log'](_0x3b4e4f(0x10e)),this[_0x3b4e4f(0x112)]&&(clearInterval(this[_0x3b4e4f(0x112)]),this['pingInterval']=null),this[_0x3b4e4f(0x108)]&&this[_0x3b4e4f(0x108)][_0x3b4e4f(0x121)](),this[_0x3b4e4f(0xb7)]&&this['server'][_0x3b4e4f(0xc9)](),console['log'](_0x3b4e4f(0xf4));}[a2_0x4b64d6(0x110)](){const _0x2f5ea4=a2_0x4b64d6;return this[_0x2f5ea4(0xcf)];}['getPort'](){return this['port'];}}module['exports']=ApplianceManager;