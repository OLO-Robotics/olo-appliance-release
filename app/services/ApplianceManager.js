const a2_0x3530d9=a2_0x1ff9;function a2_0x1ff9(_0x1b1f20,_0x513d19){const _0xa6e322=a2_0xe602();return a2_0x1ff9=function(_0x5bcf44,_0x36b3ea){_0x5bcf44=_0x5bcf44-0xca;let _0xe60267=_0xa6e322[_0x5bcf44];return _0xe60267;},a2_0x1ff9(_0x1b1f20,_0x513d19);}function a2_0xe602(){const _0x19980a=['Environment:\x20','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','APP_PASSWORD','response','isAuthenticated','loadApplianceIdentity','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','log','apply','Loaded\x20credentials:','updateEnvFile','get','SET','toString','promptForCredentials','topicManager','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','Access-Control-Allow-Headers','registration_token','2344MTUfct','password','error','connectToServer','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','post','Successfully\x20registered\x20with\x20server','warn','startPingInterval','strategies','wsEndpoint','Access-Control-Allow-Methods','\x0aAPP_PASSWORD=','existsSync','config','NODE_ENV','Enter\x20password:\x20','getActiveSessions','prompt-sync','.env','code','start','210ZxjTXR','244328zhBubn','largeDataTopics','1008220rTILtP','PORT','port','stop','sendStatus','authService','length','APPLIANCE_FILE','exports','startServer','Enter\x20username:\x20','serverUrl','server','Appliance\x20stopped','initializeReverseProxy','/appliance/register','pingInterval','Bearer\x20','(((.+)+)+)+$','hide','closeAllConnections','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','utf8','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','loadConfig','registerWithServer','toLowerCase','Failed\x20to\x20ping\x20server:','.appliance.json','Proxy\x20listening\x20on\x20port:\x20','message','use','Failed\x20to\x20register\x20with\x20server','readFileSync','Failed\x20to\x20start\x20appliance:','close','constructor','1076115DaoRkT','Appliance\x20is\x20running\x20and\x20authenticated!','includes','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','stringify','getSharedVideoSources','Authentication\x20required','getInitialPort','Successfully\x20logged\x20in','APP_USERNAME','reverseProxy','Failed\x20to\x20register\x20with\x20server:','status','Loaded\x20appliance\x20identity:','ROSBridge\x20WebSocket\x20URL:\x20','send','login','Attempting\x20to\x20login\x20to:','robot\x20not\x20found','NOT\x20SET','header','39033GAgyzu','getConnectionStatus','Initial\x20credentials\x20loaded\x20from\x20environment','urdfService','parse','setupExpressApp','data','Registering\x20with\x20server...','listen','env','161758NrAOLf','json','robotId','getPort','initialize','application/json','Access-Control-Allow-Origin','search','ReverseProxyService','getApp','production','getToken','saveApplianceIdentity','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','app','development','registrationToken','username','webrtcService','credentials','proxyPort','method','920190gWVtal','rosbridge','writeFileSync','connectToRosbridge','reloadEnv','Port\x20','WSL\x20Appliance','dotenv','413hpKvao','/appliance/ping','5TLboxx','/health','unlinkSync'];a2_0xe602=function(){return _0x19980a;};return a2_0xe602();}(function(_0x3fb1ed,_0x4f1d4e){const _0x4faf50=a2_0x1ff9,_0x4a0303=_0x3fb1ed();while(!![]){try{const _0x40bfb9=parseInt(_0x4faf50(0xe1))/0x1+-parseInt(_0x4faf50(0x127))/0x2+parseInt(_0x4faf50(0x108))/0x3+-parseInt(_0x4faf50(0xe3))/0x4*(parseInt(_0x4faf50(0x147))/0x5)+-parseInt(_0x4faf50(0x13d))/0x6+-parseInt(_0x4faf50(0x145))/0x7*(parseInt(_0x4faf50(0xca))/0x8)+parseInt(_0x4faf50(0x11d))/0x9*(parseInt(_0x4faf50(0xe0))/0xa);if(_0x40bfb9===_0x4f1d4e)break;else _0x4a0303['push'](_0x4a0303['shift']());}catch(_0x9b2e3c){_0x4a0303['push'](_0x4a0303['shift']());}}}(a2_0xe602,0x2e83c));const a2_0x36b3ea=(function(){let _0xee0cfb=!![];return function(_0x4b4d09,_0x4b13f4){const _0xd3f5e=_0xee0cfb?function(){const _0x37b4e9=a2_0x1ff9;if(_0x4b13f4){const _0x404bff=_0x4b13f4[_0x37b4e9(0x152)](_0x4b4d09,arguments);return _0x4b13f4=null,_0x404bff;}}:function(){};return _0xee0cfb=![],_0xd3f5e;};}()),a2_0x5bcf44=a2_0x36b3ea(this,function(){const _0x5536f5=a2_0x1ff9;return a2_0x5bcf44[_0x5536f5(0x157)]()[_0x5536f5(0x12e)](_0x5536f5(0xf5))[_0x5536f5(0x157)]()[_0x5536f5(0x107)](a2_0x5bcf44)[_0x5536f5(0x12e)](_0x5536f5(0xf5));});a2_0x5bcf44();const dotenv=require(a2_0x3530d9(0x144)),express=require('express'),axios=require('axios'),fs=require('fs'),prompt=require(a2_0x3530d9(0xdc))({'sigint':!![]});class ApplianceManager{constructor(_0x51dce7,_0x2b543d,_0x760812,_0x142004,_0x57d8fd,_0x21a75b){const _0x345d0e=a2_0x3530d9;this['config']=_0x51dce7,this[_0x345d0e(0xe8)]=_0x2b543d,this[_0x345d0e(0x139)]=_0x760812,this[_0x345d0e(0x159)]=_0x142004,this['urdfService']=_0x57d8fd,this[_0x345d0e(0x12f)]=_0x21a75b,this['app']=express(),this[_0x345d0e(0xef)]=null,this[_0x345d0e(0x112)]=null,this['registrationToken']=null,this[_0x345d0e(0x129)]=null,this[_0x345d0e(0xea)]=_0x345d0e(0xff),this[_0x345d0e(0xe5)]=process[_0x345d0e(0x126)][_0x345d0e(0xe4)]||_0x51dce7[_0x345d0e(0x13e)]['proxyPort'],this[_0x345d0e(0xf3)]=null;}[a2_0x3530d9(0x12b)](){const _0x3fe6fc=a2_0x3530d9;dotenv[_0x3fe6fc(0xd8)](),process[_0x3fe6fc(0x126)][_0x3fe6fc(0x111)]&&process[_0x3fe6fc(0x126)][_0x3fe6fc(0x14c)]&&(this['config'][_0x3fe6fc(0x13a)][_0x3fe6fc(0x138)]=process[_0x3fe6fc(0x126)]['APP_USERNAME'],this[_0x3fe6fc(0xd8)][_0x3fe6fc(0x13a)][_0x3fe6fc(0xcb)]=process[_0x3fe6fc(0x126)]['APP_PASSWORD'],console[_0x3fe6fc(0x151)](_0x3fe6fc(0x11f))),console[_0x3fe6fc(0x151)](_0x3fe6fc(0x14a)+(process['env']['NODE_ENV']||_0x3fe6fc(0x136))),console[_0x3fe6fc(0x151)]('Backend\x20Server\x20URL:\x20'+this[_0x3fe6fc(0xd8)][_0x3fe6fc(0xee)]),console[_0x3fe6fc(0x151)](_0x3fe6fc(0x116)+this['config'][_0x3fe6fc(0x13e)][_0x3fe6fc(0xd4)]),console[_0x3fe6fc(0x151)](_0x3fe6fc(0x100)+this[_0x3fe6fc(0xe5)]),this[_0x3fe6fc(0x122)]();}['setupExpressApp'](){const _0x3229d1=a2_0x3530d9;this[_0x3229d1(0x135)][_0x3229d1(0x102)]((_0x1c19d7,_0x441e05,_0xab54c9)=>{const _0x3c5d6d=_0x3229d1;_0x441e05['header'](_0x3c5d6d(0x12d),'*'),_0x441e05[_0x3c5d6d(0x11c)](_0x3c5d6d(0xd5),'GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS'),_0x441e05[_0x3c5d6d(0x11c)](_0x3c5d6d(0x15b),_0x3c5d6d(0xfa)),_0x1c19d7[_0x3c5d6d(0x13c)]==='OPTIONS'?_0x441e05[_0x3c5d6d(0xe7)](0xc8):_0xab54c9();});const _0x39f8d9=async(_0x2e8541,_0x186c89,_0x4cfe69)=>{const _0xf7b336=_0x3229d1;if(!this[_0xf7b336(0xe8)][_0xf7b336(0x14e)]()){console[_0xf7b336(0x151)](_0xf7b336(0x119),this[_0xf7b336(0xd8)]['serverUrl']);const _0x2ce7ee=await this[_0xf7b336(0xe8)]['login']();if(!_0x2ce7ee)return _0x186c89[_0xf7b336(0x114)](0x191)[_0xf7b336(0x128)]({'error':_0xf7b336(0x10e)});}_0x4cfe69();};this[_0x3229d1(0x135)][_0x3229d1(0x155)]('/',_0x39f8d9,(_0x4c9f24,_0x3ad96d)=>{const _0x3faab6=_0x3229d1;_0x3ad96d[_0x3faab6(0x117)](_0x3faab6(0x109));}),this[_0x3229d1(0x135)][_0x3229d1(0x155)](_0x3229d1(0x148),async(_0x23a04b,_0x42766e)=>{const _0x30834e=_0x3229d1,_0x47ebcc=this['authService'][_0x30834e(0x14e)](),_0x233ae5=this[_0x30834e(0x139)][_0x30834e(0xdb)](),_0x20661f=this[_0x30834e(0x139)][_0x30834e(0x10d)](),_0x2ab61a=this['topicManager']['getStatistics'](),_0x44a612=this[_0x30834e(0x112)]?this[_0x30834e(0x112)][_0x30834e(0x11e)]():null;_0x42766e[_0x30834e(0x128)]({'status':'ok','environment':process['env'][_0x30834e(0xd9)]||_0x30834e(0x136),'backendUrl':this['config'][_0x30834e(0xee)],'rosbridgeUrl':this[_0x30834e(0xd8)][_0x30834e(0x13e)][_0x30834e(0xd4)],'proxyPort':this[_0x30834e(0xe5)],'authenticated':_0x47ebcc,'connections':_0x44a612,'topicManagement':{'discovered':_0x2ab61a['totalTopics'],'strategies':_0x2ab61a[_0x30834e(0xd3)],'largeDataTopics':_0x2ab61a[_0x30834e(0xe2)][_0x30834e(0xe9)],'largeTopicsList':_0x2ab61a['largeDataTopics']},'webrtc':{'activeSessions':_0x233ae5[_0x30834e(0xe9)],'sharedVideoSources':_0x20661f['length'],'sessions':_0x233ae5,'sharedSources':_0x20661f}});});}[a2_0x3530d9(0x154)](_0x4c200f,_0x3441b0){const _0x4aa1a5=a2_0x3530d9;fs[_0x4aa1a5(0x13f)](_0x4aa1a5(0xdd),'APP_USERNAME='+_0x4c200f+_0x4aa1a5(0xd6)+_0x3441b0+'\x0a');}[a2_0x3530d9(0x141)](){const _0x5f3580=a2_0x3530d9;dotenv[_0x5f3580(0xd8)]({'override':!![]}),this[_0x5f3580(0xd8)][_0x5f3580(0x13a)][_0x5f3580(0x138)]=process[_0x5f3580(0x126)][_0x5f3580(0x111)],this[_0x5f3580(0xd8)][_0x5f3580(0x13a)][_0x5f3580(0xcb)]=process['env']['APP_PASSWORD'],console[_0x5f3580(0x151)](_0x5f3580(0x153),{'username':this['config'][_0x5f3580(0x13a)][_0x5f3580(0x138)]?_0x5f3580(0x156):_0x5f3580(0x11b),'password':this[_0x5f3580(0xd8)][_0x5f3580(0x13a)][_0x5f3580(0xcb)]?_0x5f3580(0x156):_0x5f3580(0x11b)});}async[a2_0x3530d9(0x158)](){const _0x5493a0=a2_0x3530d9;process[_0x5493a0(0x126)][_0x5493a0(0xd9)]===_0x5493a0(0x131)&&(console['error']('Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file'),console[_0x5493a0(0xcc)]('Please\x20run:\x20./setup.sh\x20reconfigure'),process['exit'](0x1));const _0x564701=prompt(_0x5493a0(0xed)),_0x1ba9dd=prompt[_0x5493a0(0xf6)](_0x5493a0(0xda));this[_0x5493a0(0x154)](_0x564701,_0x1ba9dd),this[_0x5493a0(0x141)]();}[a2_0x3530d9(0x14f)](){const _0xe208e8=a2_0x3530d9;if(fs['existsSync'](this[_0xe208e8(0xea)]))try{const _0x289109=JSON[_0xe208e8(0x121)](fs[_0xe208e8(0x104)](this[_0xe208e8(0xea)],_0xe208e8(0xf9)));if(_0x289109[_0xe208e8(0x129)]&&_0x289109[_0xe208e8(0x137)])return this[_0xe208e8(0x129)]=_0x289109[_0xe208e8(0x129)],this[_0xe208e8(0x137)]=_0x289109[_0xe208e8(0x137)],console[_0xe208e8(0x151)](_0xe208e8(0x115),this[_0xe208e8(0x129)]),this[_0xe208e8(0x159)][_0xe208e8(0xfb)](_0x289109),!![];}catch(_0x5bde56){console[_0xe208e8(0xcc)](_0xe208e8(0xf8),_0x5bde56);}return![];}[a2_0x3530d9(0x133)](_0x490218,_0x1df267){const _0x40ed0f=a2_0x3530d9;let _0x39d502={};if(fs['existsSync'](this[_0x40ed0f(0xea)]))try{_0x39d502=JSON[_0x40ed0f(0x121)](fs['readFileSync'](this[_0x40ed0f(0xea)],_0x40ed0f(0xf9)));}catch(_0x29ba9d){_0x39d502={};}_0x39d502[_0x40ed0f(0x129)]=_0x490218,_0x39d502[_0x40ed0f(0x137)]=_0x1df267,fs['writeFileSync'](this[_0x40ed0f(0xea)],JSON[_0x40ed0f(0x10c)](_0x39d502,null,0x2));}async['registerWithServer'](){const _0x3e14d2=a2_0x3530d9;try{const _0xa0f29c=this[_0x3e14d2(0xe8)][_0x3e14d2(0x132)]();if(!_0xa0f29c)throw new Error('Not\x20authenticated');let _0x4dc525,_0x113c0b=![];while(!![]){try{this[_0x3e14d2(0x129)]&&this['registrationToken']?_0x4dc525=await axios['post'](this[_0x3e14d2(0xd8)][_0x3e14d2(0xee)]+_0x3e14d2(0xf2),{'name':_0x3e14d2(0x143),'robotId':this[_0x3e14d2(0x129)],'registration_token':this[_0x3e14d2(0x137)]},{'headers':{'Authorization':'Bearer\x20'+_0xa0f29c,'Content-Type':'application/json'}}):_0x4dc525=await axios[_0x3e14d2(0xcf)](this[_0x3e14d2(0xd8)]['serverUrl']+_0x3e14d2(0xf2),{'name':'WSL\x20Appliance'},{'headers':{'Authorization':_0x3e14d2(0xf4)+_0xa0f29c,'Content-Type':_0x3e14d2(0x12c)}});break;}catch(_0x41c3c3){const _0x5d83fb=_0x41c3c3?.[_0x3e14d2(0x14d)]?.[_0x3e14d2(0x123)]?.[_0x3e14d2(0xcc)]||_0x41c3c3[_0x3e14d2(0x101)];if(!_0x113c0b&&_0x5d83fb&&_0x5d83fb[_0x3e14d2(0xfd)]()[_0x3e14d2(0x10a)](_0x3e14d2(0x11a))){console[_0x3e14d2(0xd1)](_0x3e14d2(0x10b));if(fs[_0x3e14d2(0xd7)](this[_0x3e14d2(0xea)]))fs[_0x3e14d2(0x149)](this[_0x3e14d2(0xea)]);this['robotId']=null,this[_0x3e14d2(0x137)]=null,_0x113c0b=!![];continue;}throw _0x41c3c3;}}if(!_0x4dc525[_0x3e14d2(0x123)]||!_0x4dc525[_0x3e14d2(0x123)][_0x3e14d2(0x15c)]||!_0x4dc525[_0x3e14d2(0x123)]['id'])throw new Error(_0x3e14d2(0x134));return this[_0x3e14d2(0x137)]=_0x4dc525[_0x3e14d2(0x123)]['registration_token'],this[_0x3e14d2(0x129)]=_0x4dc525[_0x3e14d2(0x123)]['id'],this['saveApplianceIdentity'](this[_0x3e14d2(0x129)],this[_0x3e14d2(0x137)]),console[_0x3e14d2(0x151)](_0x3e14d2(0xd0)),!![];}catch(_0x52ec7c){return console[_0x3e14d2(0xcc)](_0x3e14d2(0x113),_0x52ec7c[_0x3e14d2(0x101)]),![];}}[a2_0x3530d9(0xf1)](){const _0x1a3cca=a2_0x3530d9;this[_0x1a3cca(0x112)]=new this[(_0x1a3cca(0x12f))](this[_0x1a3cca(0xd8)],this['authService'],this[_0x1a3cca(0x139)],this[_0x1a3cca(0x159)],this[_0x1a3cca(0x120)]),this[_0x1a3cca(0x112)][_0x1a3cca(0x12b)](this[_0x1a3cca(0x129)],this[_0x1a3cca(0x137)]),this[_0x1a3cca(0x112)][_0x1a3cca(0x140)](),this[_0x1a3cca(0x112)][_0x1a3cca(0xcd)]();}['getInitialPort'](){const _0x298ec4=a2_0x3530d9;if(process['env'][_0x298ec4(0xe4)])return parseInt(process['env']['PORT'],0xa);return this['config'][_0x298ec4(0x13e)][_0x298ec4(0x13b)];}async[a2_0x3530d9(0xec)](_0x187140=0xa){const _0x27b9fb=a2_0x3530d9;let _0x3c9432=this[_0x27b9fb(0x10f)]();for(let _0x3d2fd4=0x1;_0x3d2fd4<=_0x187140;_0x3d2fd4++){try{await new Promise((_0x4b809a,_0x560957)=>{const _0x3f9d3d=_0x27b9fb;this[_0x3f9d3d(0xef)]=this[_0x3f9d3d(0x135)][_0x3f9d3d(0x125)](_0x3c9432,()=>{const _0x201214=_0x3f9d3d;console['log'](_0x201214(0x150)+_0x3c9432),this[_0x201214(0xe5)]=_0x3c9432,_0x4b809a();}),this['server']['on']('error',_0x474fc8=>{const _0x5fa12c=_0x3f9d3d;_0x474fc8[_0x5fa12c(0xde)]==='EADDRINUSE'?(console[_0x5fa12c(0xd1)](_0x5fa12c(0x142)+_0x3c9432+'\x20in\x20use,\x20trying\x20next\x20port...'),_0x560957(_0x474fc8)):_0x560957(_0x474fc8);});});return;}catch(_0x3ada60){_0x3c9432++;}}throw new Error(_0x27b9fb(0x14b)+_0x187140+'\x20attempts\x20starting\x20from\x20'+this[_0x27b9fb(0x10f)]());}[a2_0x3530d9(0xd2)](){const _0x429f5a=a2_0x3530d9;this[_0x429f5a(0xf3)]=setInterval(async()=>{const _0x438d2f=_0x429f5a;try{if(this[_0x438d2f(0x129)]){const _0x20c2b6=this['authService'][_0x438d2f(0x132)]();await axios[_0x438d2f(0xcf)](this['config'][_0x438d2f(0xee)]+_0x438d2f(0x146),{'robotId':this[_0x438d2f(0x129)]},{'headers':{'Authorization':_0x438d2f(0xf4)+_0x20c2b6,'Content-Type':_0x438d2f(0x12c)}});}}catch(_0xf0ccf7){console['error'](_0x438d2f(0xfe),_0xf0ccf7[_0x438d2f(0x101)]);}},0x1388);}async[a2_0x3530d9(0xdf)](){const _0x434fd9=a2_0x3530d9;try{this['reloadEnv']();let _0x39ce76=await this[_0x434fd9(0xe8)]['login']();while(!_0x39ce76){console[_0x434fd9(0x151)](_0x434fd9(0x15a)),await this[_0x434fd9(0x158)](),_0x39ce76=await this['authService'][_0x434fd9(0x118)]();}console[_0x434fd9(0x151)](_0x434fd9(0x110));!this[_0x434fd9(0x14f)]()&&console[_0x434fd9(0x151)](_0x434fd9(0xce));console['log'](_0x434fd9(0x124));const _0x4aaeeb=await this[_0x434fd9(0xfc)]();if(!_0x4aaeeb)throw new Error(_0x434fd9(0x103));this[_0x434fd9(0xf1)](),await this[_0x434fd9(0xec)](),this['startPingInterval'](),console[_0x434fd9(0x151)]('Appliance\x20started\x20successfully');}catch(_0x535f40){console[_0x434fd9(0xcc)](_0x434fd9(0x105),_0x535f40);throw _0x535f40;}}async[a2_0x3530d9(0xe6)](){const _0x579405=a2_0x3530d9;console[_0x579405(0x151)]('Stopping\x20appliance...'),this[_0x579405(0xf3)]&&(clearInterval(this[_0x579405(0xf3)]),this[_0x579405(0xf3)]=null),this[_0x579405(0x112)]&&this[_0x579405(0x112)][_0x579405(0xf7)](),this['server']&&this[_0x579405(0xef)][_0x579405(0x106)](),console[_0x579405(0x151)](_0x579405(0xf0));}[a2_0x3530d9(0x130)](){const _0x2925e9=a2_0x3530d9;return this[_0x2925e9(0x135)];}[a2_0x3530d9(0x12a)](){const _0x2f2100=a2_0x3530d9;return this[_0x2f2100(0xe5)];}}module[a2_0x3530d9(0xeb)]=ApplianceManager;