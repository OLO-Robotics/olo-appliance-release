const a2_0x50e773=a2_0x7cc1;(function(_0x4112d8,_0x5d33b5){const _0x2f4d31=a2_0x7cc1,_0xb4bb9a=_0x4112d8();while(!![]){try{const _0x9812d0=-parseInt(_0x2f4d31(0xba))/0x1+-parseInt(_0x2f4d31(0x9a))/0x2+parseInt(_0x2f4d31(0x108))/0x3*(-parseInt(_0x2f4d31(0x9e))/0x4)+-parseInt(_0x2f4d31(0xd5))/0x5+-parseInt(_0x2f4d31(0xf1))/0x6+parseInt(_0x2f4d31(0xbd))/0x7*(parseInt(_0x2f4d31(0x115))/0x8)+parseInt(_0x2f4d31(0xc9))/0x9;if(_0x9812d0===_0x5d33b5)break;else _0xb4bb9a['push'](_0xb4bb9a['shift']());}catch(_0x4a3dcd){_0xb4bb9a['push'](_0xb4bb9a['shift']());}}}(a2_0x491c,0x53b1e));const a2_0xdf2213=(function(){let _0x26712b=!![];return function(_0x27f05f,_0x3c52f7){const _0x3084cb=_0x26712b?function(){const _0x319b7d=a2_0x7cc1;if(_0x3c52f7){const _0x500d95=_0x3c52f7[_0x319b7d(0xc0)](_0x27f05f,arguments);return _0x3c52f7=null,_0x500d95;}}:function(){};return _0x26712b=![],_0x3084cb;};}()),a2_0xc0d43c=a2_0xdf2213(this,function(){const _0x2471cd=a2_0x7cc1;return a2_0xc0d43c[_0x2471cd(0xd1)]()['search'](_0x2471cd(0x111))[_0x2471cd(0xd1)]()[_0x2471cd(0x8f)](a2_0xc0d43c)[_0x2471cd(0xd2)](_0x2471cd(0x111));});a2_0xc0d43c();function a2_0x491c(){const _0x5c6156=['Environment:\x20','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','largeDataTopics','Please\x20run:\x20./setup.sh\x20reconfigure','loadConfig','getSharedVideoSources','getActiveSessions','606084QwxzvT','WSL\x20Appliance','Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','Not\x20authenticated','/appliance/ping','credentials','ROSBridge\x20WebSocket\x20URL:\x20','startPingInterval','config','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','serverUrl','registration_token','hide','SET','Failed\x20to\x20register\x20with\x20server','Loaded\x20credentials:','readFileSync','listen','warn','unlinkSync','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','updateEnvFile','3PfORaI','EADDRINUSE','Access-Control-Allow-Headers','proxyPort','isAuthenticated','app','Enter\x20password:\x20','writeFileSync','env','(((.+)+)+)+$','development','exports','toLowerCase','16KzwaFp','Appliance\x20started\x20successfully','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','NODE_ENV','Proxy\x20listening\x20on\x20port:\x20','authService','topicManager','stop','/appliance/register','exit','constructor','promptForCredentials','Successfully\x20logged\x20in','totalTopics','production','wsEndpoint','login','post','getInitialPort','Stopping\x20appliance...','PORT','838328OdoMVa','json','includes','axios','1814044tGhvdI','urdfService','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','server','APP_PASSWORD','loadApplianceIdentity','port','log','NOT\x20SET','getPort','dotenv','response','pingInterval','startServer','Initial\x20credentials\x20loaded\x20from\x20environment','APP_USERNAME','Access-Control-Allow-Origin','Failed\x20to\x20start\x20appliance:','Access-Control-Allow-Methods','closeAllConnections','registerWithServer','reverseProxy','Backend\x20Server\x20URL:\x20','APP_USERNAME=','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','application/json','error','getApp','385806gBSDLF','saveApplianceIdentity','reloadEnv','436478TWbavT','status','data','apply','registrationToken','\x0aAPP_PASSWORD=','sendStatus','Failed\x20to\x20ping\x20server:','code','ReverseProxyService','initialize','.env','15102036pbMXIV','Authentication\x20required','initializeReverseProxy','message','header','getConnectionStatus','getStatistics','connectToRosbridge','toString','search','rosbridge','prompt-sync','502015DYmtCy','express','robotId','get','Port\x20','robot\x20not\x20found','.appliance.json','password','getToken','length','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','webrtcService','send','utf8','parse','existsSync','APPLIANCE_FILE','Loaded\x20appliance\x20identity:','username','\x20attempts\x20starting\x20from\x20','Bearer\x20'];a2_0x491c=function(){return _0x5c6156;};return a2_0x491c();}const dotenv=require(a2_0x50e773(0xa8)),express=require(a2_0x50e773(0xd6)),axios=require(a2_0x50e773(0x9d)),fs=require('fs'),prompt=require(a2_0x50e773(0xd4))({'sigint':!![]});function a2_0x7cc1(_0x119e93,_0x35b72b){const _0x530c21=a2_0x491c();return a2_0x7cc1=function(_0xc0d43c,_0xdf2213){_0xc0d43c=_0xc0d43c-0x8c;let _0x491ccf=_0x530c21[_0xc0d43c];return _0x491ccf;},a2_0x7cc1(_0x119e93,_0x35b72b);}class ApplianceManager{constructor(_0x4b74d8,_0x301bf2,_0x4ca15d,_0x516a76,_0x52685c,_0x5ceaf7){const _0x4fefc1=a2_0x50e773;this['config']=_0x4b74d8,this[_0x4fefc1(0x11a)]=_0x301bf2,this['webrtcService']=_0x4ca15d,this[_0x4fefc1(0x11b)]=_0x516a76,this[_0x4fefc1(0x9f)]=_0x52685c,this[_0x4fefc1(0xc6)]=_0x5ceaf7,this['app']=express(),this[_0x4fefc1(0xa1)]=null,this['reverseProxy']=null,this[_0x4fefc1(0xc1)]=null,this[_0x4fefc1(0xd7)]=null,this[_0x4fefc1(0xe5)]=_0x4fefc1(0xdb),this[_0x4fefc1(0xa4)]=process['env'][_0x4fefc1(0x99)]||_0x4b74d8[_0x4fefc1(0xd3)]['proxyPort'],this[_0x4fefc1(0xaa)]=null;}[a2_0x50e773(0xc7)](){const _0x53d8e7=a2_0x50e773;dotenv[_0x53d8e7(0xfa)](),process['env'][_0x53d8e7(0xad)]&&process[_0x53d8e7(0x110)][_0x53d8e7(0xa2)]&&(this[_0x53d8e7(0xfa)][_0x53d8e7(0xf7)][_0x53d8e7(0xe7)]=process[_0x53d8e7(0x110)][_0x53d8e7(0xad)],this['config'][_0x53d8e7(0xf7)][_0x53d8e7(0xdc)]=process[_0x53d8e7(0x110)][_0x53d8e7(0xa2)],console[_0x53d8e7(0xa5)](_0x53d8e7(0xac))),console['log'](_0x53d8e7(0xea)+(process[_0x53d8e7(0x110)][_0x53d8e7(0x118)]||'development')),console['log'](_0x53d8e7(0xb4)+this['config']['serverUrl']),console[_0x53d8e7(0xa5)](_0x53d8e7(0xf8)+this['config'][_0x53d8e7(0xd3)][_0x53d8e7(0x94)]),console[_0x53d8e7(0xa5)](_0x53d8e7(0x119)+this[_0x53d8e7(0xa4)]),this['setupExpressApp']();}['setupExpressApp'](){const _0x5a6e8d=a2_0x50e773;this[_0x5a6e8d(0x10d)]['use']((_0x549b3c,_0x5718b2,_0x2f4340)=>{const _0x2844a7=_0x5a6e8d;_0x5718b2['header'](_0x2844a7(0xae),'*'),_0x5718b2['header'](_0x2844a7(0xb0),_0x2844a7(0xdf)),_0x5718b2[_0x2844a7(0xcd)](_0x2844a7(0x10a),_0x2844a7(0xf4)),_0x549b3c['method']==='OPTIONS'?_0x5718b2[_0x2844a7(0xc3)](0xc8):_0x2f4340();});const _0x5500d7=async(_0x178043,_0x489b86,_0x479128)=>{const _0x17d1a6=_0x5a6e8d;if(!this[_0x17d1a6(0x11a)]['isAuthenticated']()){console[_0x17d1a6(0xa5)]('Attempting\x20to\x20login\x20to:',this['config'][_0x17d1a6(0xfc)]);const _0x4c89f6=await this[_0x17d1a6(0x11a)][_0x17d1a6(0x95)]();if(!_0x4c89f6)return _0x489b86[_0x17d1a6(0xbe)](0x191)[_0x17d1a6(0x9b)]({'error':_0x17d1a6(0xca)});}_0x479128();};this['app'][_0x5a6e8d(0xd8)]('/',_0x5500d7,(_0x496e14,_0x5619e3)=>{const _0x18e863=_0x5a6e8d;_0x5619e3[_0x18e863(0xe1)]('Appliance\x20is\x20running\x20and\x20authenticated!');}),this['app'][_0x5a6e8d(0xd8)]('/health',async(_0x132470,_0x5dcc2d)=>{const _0x7cf6db=_0x5a6e8d,_0x1efd7a=this[_0x7cf6db(0x11a)][_0x7cf6db(0x10c)](),_0x573060=this[_0x7cf6db(0xe0)][_0x7cf6db(0xf0)](),_0x6f4e11=this[_0x7cf6db(0xe0)][_0x7cf6db(0xef)](),_0x2e6927=this[_0x7cf6db(0x11b)][_0x7cf6db(0xcf)](),_0x1618ae=this[_0x7cf6db(0xb3)]?this[_0x7cf6db(0xb3)][_0x7cf6db(0xce)]():null;_0x5dcc2d[_0x7cf6db(0x9b)]({'status':'ok','environment':process[_0x7cf6db(0x110)][_0x7cf6db(0x118)]||_0x7cf6db(0x112),'backendUrl':this[_0x7cf6db(0xfa)][_0x7cf6db(0xfc)],'rosbridgeUrl':this[_0x7cf6db(0xfa)][_0x7cf6db(0xd3)][_0x7cf6db(0x94)],'proxyPort':this[_0x7cf6db(0xa4)],'authenticated':_0x1efd7a,'connections':_0x1618ae,'topicManagement':{'discovered':_0x2e6927[_0x7cf6db(0x92)],'strategies':_0x2e6927['strategies'],'largeDataTopics':_0x2e6927[_0x7cf6db(0xec)][_0x7cf6db(0xde)],'largeTopicsList':_0x2e6927[_0x7cf6db(0xec)]},'webrtc':{'activeSessions':_0x573060[_0x7cf6db(0xde)],'sharedVideoSources':_0x6f4e11['length'],'sessions':_0x573060,'sharedSources':_0x6f4e11}});});}['updateEnvFile'](_0x7a2601,_0xbd0a6e){const _0x3f2046=a2_0x50e773;fs[_0x3f2046(0x10f)](_0x3f2046(0xc8),_0x3f2046(0xb5)+_0x7a2601+_0x3f2046(0xc2)+_0xbd0a6e+'\x0a');}['reloadEnv'](){const _0x3e76fd=a2_0x50e773;dotenv[_0x3e76fd(0xfa)]({'override':!![]}),this[_0x3e76fd(0xfa)][_0x3e76fd(0xf7)][_0x3e76fd(0xe7)]=process['env'][_0x3e76fd(0xad)],this['config'][_0x3e76fd(0xf7)][_0x3e76fd(0xdc)]=process['env']['APP_PASSWORD'],console['log'](_0x3e76fd(0x101),{'username':this[_0x3e76fd(0xfa)][_0x3e76fd(0xf7)][_0x3e76fd(0xe7)]?'SET':_0x3e76fd(0xa6),'password':this[_0x3e76fd(0xfa)][_0x3e76fd(0xf7)][_0x3e76fd(0xdc)]?_0x3e76fd(0xff):_0x3e76fd(0xa6)});}async[a2_0x50e773(0x90)](){const _0xcd82f2=a2_0x50e773;process[_0xcd82f2(0x110)][_0xcd82f2(0x118)]===_0xcd82f2(0x93)&&(console[_0xcd82f2(0xb8)](_0xcd82f2(0xf3)),console[_0xcd82f2(0xb8)](_0xcd82f2(0xed)),process[_0xcd82f2(0x8e)](0x1));const _0x448eae=prompt('Enter\x20username:\x20'),_0x457dc7=prompt[_0xcd82f2(0xfe)](_0xcd82f2(0x10e));this[_0xcd82f2(0x107)](_0x448eae,_0x457dc7),this[_0xcd82f2(0xbc)]();}[a2_0x50e773(0xa3)](){const _0xe85023=a2_0x50e773;if(fs[_0xe85023(0xe4)](this[_0xe85023(0xe5)]))try{const _0x851038=JSON['parse'](fs['readFileSync'](this['APPLIANCE_FILE'],'utf8'));if(_0x851038[_0xe85023(0xd7)]&&_0x851038[_0xe85023(0xc1)])return this[_0xe85023(0xd7)]=_0x851038['robotId'],this[_0xe85023(0xc1)]=_0x851038[_0xe85023(0xc1)],console['log'](_0xe85023(0xe6),this[_0xe85023(0xd7)]),this['topicManager'][_0xe85023(0xee)](_0x851038),!![];}catch(_0x7dbfcb){console[_0xe85023(0xb8)](_0xe85023(0xfb),_0x7dbfcb);}return![];}[a2_0x50e773(0xbb)](_0x5d9773,_0x375000){const _0x2cbc85=a2_0x50e773;let _0x1d95c7={};if(fs['existsSync'](this[_0x2cbc85(0xe5)]))try{_0x1d95c7=JSON[_0x2cbc85(0xe3)](fs[_0x2cbc85(0x102)](this[_0x2cbc85(0xe5)],_0x2cbc85(0xe2)));}catch(_0x3d9c6c){_0x1d95c7={};}_0x1d95c7['robotId']=_0x5d9773,_0x1d95c7['registrationToken']=_0x375000,fs['writeFileSync'](this['APPLIANCE_FILE'],JSON['stringify'](_0x1d95c7,null,0x2));}async[a2_0x50e773(0xb2)](){const _0x41b410=a2_0x50e773;try{const _0x1b7475=this[_0x41b410(0x11a)][_0x41b410(0xdd)]();if(!_0x1b7475)throw new Error(_0x41b410(0xf5));let _0x3f5aa4,_0x50cb8e=![];while(!![]){try{this[_0x41b410(0xd7)]&&this[_0x41b410(0xc1)]?_0x3f5aa4=await axios[_0x41b410(0x96)](this[_0x41b410(0xfa)]['serverUrl']+_0x41b410(0x8d),{'name':_0x41b410(0xf2),'robotId':this['robotId'],'registration_token':this[_0x41b410(0xc1)]},{'headers':{'Authorization':'Bearer\x20'+_0x1b7475,'Content-Type':'application/json'}}):_0x3f5aa4=await axios[_0x41b410(0x96)](this[_0x41b410(0xfa)][_0x41b410(0xfc)]+_0x41b410(0x8d),{'name':'WSL\x20Appliance'},{'headers':{'Authorization':_0x41b410(0xe9)+_0x1b7475,'Content-Type':_0x41b410(0xb7)}});break;}catch(_0x45c820){const _0x3b1058=_0x45c820?.[_0x41b410(0xa9)]?.[_0x41b410(0xbf)]?.['error']||_0x45c820['message'];if(!_0x50cb8e&&_0x3b1058&&_0x3b1058[_0x41b410(0x114)]()[_0x41b410(0x9c)](_0x41b410(0xda))){console[_0x41b410(0x104)](_0x41b410(0xb6));if(fs['existsSync'](this[_0x41b410(0xe5)]))fs[_0x41b410(0x105)](this[_0x41b410(0xe5)]);this[_0x41b410(0xd7)]=null,this['registrationToken']=null,_0x50cb8e=!![];continue;}throw _0x45c820;}}if(!_0x3f5aa4[_0x41b410(0xbf)]||!_0x3f5aa4[_0x41b410(0xbf)][_0x41b410(0xfd)]||!_0x3f5aa4[_0x41b410(0xbf)]['id'])throw new Error(_0x41b410(0x117));return this[_0x41b410(0xc1)]=_0x3f5aa4[_0x41b410(0xbf)][_0x41b410(0xfd)],this[_0x41b410(0xd7)]=_0x3f5aa4[_0x41b410(0xbf)]['id'],this['saveApplianceIdentity'](this['robotId'],this[_0x41b410(0xc1)]),console['log']('Successfully\x20registered\x20with\x20server'),!![];}catch(_0x31a087){return console[_0x41b410(0xb8)]('Failed\x20to\x20register\x20with\x20server:',_0x31a087[_0x41b410(0xcc)]),![];}}[a2_0x50e773(0xcb)](){const _0x1a2266=a2_0x50e773;this[_0x1a2266(0xb3)]=new this[(_0x1a2266(0xc6))](this[_0x1a2266(0xfa)],this[_0x1a2266(0x11a)],this[_0x1a2266(0xe0)],this[_0x1a2266(0x11b)],this[_0x1a2266(0x9f)]),this[_0x1a2266(0xb3)]['initialize'](this[_0x1a2266(0xd7)],this[_0x1a2266(0xc1)]),this[_0x1a2266(0xb3)][_0x1a2266(0xd0)](),this['reverseProxy']['connectToServer']();}[a2_0x50e773(0x97)](){const _0x493fd7=a2_0x50e773;if(process[_0x493fd7(0x110)][_0x493fd7(0x99)])return parseInt(process[_0x493fd7(0x110)][_0x493fd7(0x99)],0xa);return this[_0x493fd7(0xfa)][_0x493fd7(0xd3)][_0x493fd7(0x10b)];}async[a2_0x50e773(0xab)](_0x4c35fc=0xa){const _0x55b07d=a2_0x50e773;let _0x307ed0=this[_0x55b07d(0x97)]();for(let _0xe801fb=0x1;_0xe801fb<=_0x4c35fc;_0xe801fb++){try{await new Promise((_0x454e7c,_0x560d04)=>{const _0x27ca57=_0x55b07d;this[_0x27ca57(0xa1)]=this[_0x27ca57(0x10d)][_0x27ca57(0x103)](_0x307ed0,()=>{const _0x5aa110=_0x27ca57;console[_0x5aa110(0xa5)](_0x5aa110(0xeb)+_0x307ed0),this['port']=_0x307ed0,_0x454e7c();}),this['server']['on'](_0x27ca57(0xb8),_0x35458a=>{const _0x211338=_0x27ca57;_0x35458a[_0x211338(0xc5)]===_0x211338(0x109)?(console[_0x211338(0x104)](_0x211338(0xd9)+_0x307ed0+'\x20in\x20use,\x20trying\x20next\x20port...'),_0x560d04(_0x35458a)):_0x560d04(_0x35458a);});});return;}catch(_0x4fa378){_0x307ed0++;}}throw new Error(_0x55b07d(0x106)+_0x4c35fc+_0x55b07d(0xe8)+this['getInitialPort']());}[a2_0x50e773(0xf9)](){const _0xaecaa1=a2_0x50e773;this[_0xaecaa1(0xaa)]=setInterval(async()=>{const _0x3e0061=_0xaecaa1;try{if(this[_0x3e0061(0xd7)]){const _0x5d1cca=this[_0x3e0061(0x11a)]['getToken']();await axios['post'](this[_0x3e0061(0xfa)][_0x3e0061(0xfc)]+_0x3e0061(0xf6),{'robotId':this[_0x3e0061(0xd7)]},{'headers':{'Authorization':_0x3e0061(0xe9)+_0x5d1cca,'Content-Type':_0x3e0061(0xb7)}});}}catch(_0x5516f4){console[_0x3e0061(0xb8)](_0x3e0061(0xc4),_0x5516f4[_0x3e0061(0xcc)]);}},0x1388);}async['start'](){const _0x4eb62c=a2_0x50e773;try{this['reloadEnv']();let _0x3d006f=await this['authService'][_0x4eb62c(0x95)]();while(!_0x3d006f){console[_0x4eb62c(0xa5)]('Login\x20failed.\x20Please\x20enter\x20credentials\x20again.'),await this[_0x4eb62c(0x90)](),_0x3d006f=await this[_0x4eb62c(0x11a)][_0x4eb62c(0x95)]();}console[_0x4eb62c(0xa5)](_0x4eb62c(0x91));!this[_0x4eb62c(0xa3)]()&&console[_0x4eb62c(0xa5)](_0x4eb62c(0xa0));console['log']('Registering\x20with\x20server...');const _0x5aa7b1=await this[_0x4eb62c(0xb2)]();if(!_0x5aa7b1)throw new Error(_0x4eb62c(0x100));this['initializeReverseProxy'](),await this[_0x4eb62c(0xab)](),this[_0x4eb62c(0xf9)](),console[_0x4eb62c(0xa5)](_0x4eb62c(0x116));}catch(_0x252493){console[_0x4eb62c(0xb8)](_0x4eb62c(0xaf),_0x252493);throw _0x252493;}}async[a2_0x50e773(0x8c)](){const _0x37024e=a2_0x50e773;console[_0x37024e(0xa5)](_0x37024e(0x98)),this['pingInterval']&&(clearInterval(this[_0x37024e(0xaa)]),this['pingInterval']=null),this[_0x37024e(0xb3)]&&this['reverseProxy'][_0x37024e(0xb1)](),this[_0x37024e(0xa1)]&&this[_0x37024e(0xa1)]['close'](),console['log']('Appliance\x20stopped');}[a2_0x50e773(0xb9)](){return this['app'];}[a2_0x50e773(0xa7)](){const _0x1eaa43=a2_0x50e773;return this[_0x1eaa43(0xa4)];}}module[a2_0x50e773(0x113)]=ApplianceManager;