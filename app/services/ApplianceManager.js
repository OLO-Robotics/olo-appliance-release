const a2_0x3482cf=a2_0x5a48;(function(_0x249c91,_0x5c5fb2){const _0x5b3a23=a2_0x5a48,_0x25d28c=_0x249c91();while(!![]){try{const _0x2a2281=parseInt(_0x5b3a23(0x15e))/0x1*(parseInt(_0x5b3a23(0x153))/0x2)+parseInt(_0x5b3a23(0x185))/0x3+-parseInt(_0x5b3a23(0x14c))/0x4*(-parseInt(_0x5b3a23(0x140))/0x5)+parseInt(_0x5b3a23(0x188))/0x6*(parseInt(_0x5b3a23(0x172))/0x7)+parseInt(_0x5b3a23(0x195))/0x8+-parseInt(_0x5b3a23(0x17b))/0x9+-parseInt(_0x5b3a23(0x127))/0xa*(parseInt(_0x5b3a23(0x11a))/0xb);if(_0x2a2281===_0x5c5fb2)break;else _0x25d28c['push'](_0x25d28c['shift']());}catch(_0x5aabb9){_0x25d28c['push'](_0x25d28c['shift']());}}}(a2_0x7c3c,0x1f925));const a2_0x3449ea=(function(){let _0x18fab4=!![];return function(_0x2e11ba,_0x2a22cc){const _0x4641f1=_0x18fab4?function(){if(_0x2a22cc){const _0x579dbd=_0x2a22cc['apply'](_0x2e11ba,arguments);return _0x2a22cc=null,_0x579dbd;}}:function(){};return _0x18fab4=![],_0x4641f1;};}()),a2_0x13c238=a2_0x3449ea(this,function(){const _0x28fa51=a2_0x5a48;return a2_0x13c238['toString']()[_0x28fa51(0x17a)](_0x28fa51(0x16d))[_0x28fa51(0x154)]()['constructor'](a2_0x13c238)[_0x28fa51(0x17a)](_0x28fa51(0x16d));});a2_0x13c238();const dotenv=require(a2_0x3482cf(0x14a)),express=require(a2_0x3482cf(0x151)),axios=require(a2_0x3482cf(0x173)),fs=require('fs'),prompt=require(a2_0x3482cf(0x114))({'sigint':!![]});class ApplianceManager{constructor(_0x5d6616,_0x4bde7e,_0x438ee3,_0x36ce57,_0x530b03,_0x309227){const _0x50d65a=a2_0x3482cf;this[_0x50d65a(0x134)]=_0x5d6616,this[_0x50d65a(0x13d)]=_0x4bde7e,this['webrtcService']=_0x438ee3,this['topicManager']=_0x36ce57,this[_0x50d65a(0x193)]=_0x530b03,this[_0x50d65a(0x130)]=_0x309227,this['app']=express(),this[_0x50d65a(0x156)]=null,this[_0x50d65a(0x128)]=null,this[_0x50d65a(0x198)]=null,this[_0x50d65a(0x180)]=null,this[_0x50d65a(0x143)]='.appliance.json',this['port']=process['env'][_0x50d65a(0x16c)]||_0x5d6616['rosbridge'][_0x50d65a(0x150)],this[_0x50d65a(0x186)]=null;}['initialize'](){const _0x3cf525=a2_0x3482cf;dotenv[_0x3cf525(0x134)](),process['env'][_0x3cf525(0x19c)]&&process[_0x3cf525(0x149)][_0x3cf525(0x181)]&&(this['config']['credentials'][_0x3cf525(0x129)]=process['env'][_0x3cf525(0x19c)],this[_0x3cf525(0x134)][_0x3cf525(0x194)][_0x3cf525(0x16e)]=process['env'][_0x3cf525(0x181)],console[_0x3cf525(0x15a)](_0x3cf525(0x13b))),console[_0x3cf525(0x15a)](_0x3cf525(0x15b)+(process[_0x3cf525(0x149)][_0x3cf525(0x168)]||_0x3cf525(0x136))),console[_0x3cf525(0x15a)]('Backend\x20Server\x20URL:\x20'+this[_0x3cf525(0x134)][_0x3cf525(0x19e)]),console[_0x3cf525(0x15a)](_0x3cf525(0x11d)+this['config'][_0x3cf525(0x13c)][_0x3cf525(0x166)]),console[_0x3cf525(0x15a)](_0x3cf525(0x138)+this[_0x3cf525(0x139)]),this[_0x3cf525(0x141)]();}[a2_0x3482cf(0x141)](){const _0x28821d=a2_0x3482cf;this[_0x28821d(0x145)][_0x28821d(0x13e)]((_0x109453,_0x430928,_0x55e0d1)=>{const _0x2d91a5=_0x28821d;_0x430928[_0x2d91a5(0x133)](_0x2d91a5(0x18b),'*'),_0x430928[_0x2d91a5(0x133)](_0x2d91a5(0x182),_0x2d91a5(0x159)),_0x430928[_0x2d91a5(0x133)](_0x2d91a5(0x184),_0x2d91a5(0x189)),_0x109453[_0x2d91a5(0x123)]===_0x2d91a5(0x17c)?_0x430928[_0x2d91a5(0x196)](0xc8):_0x55e0d1();});const _0x5aaf3d=async(_0x4a0609,_0x48c08b,_0x1fbc93)=>{const _0x3716e6=_0x28821d;if(!this[_0x3716e6(0x13d)]['isAuthenticated']()){console[_0x3716e6(0x15a)](_0x3716e6(0x16a),this[_0x3716e6(0x134)]['serverUrl']);const _0x49cddc=await this[_0x3716e6(0x13d)]['login']();if(!_0x49cddc)return _0x48c08b['status'](0x191)['json']({'error':'Authentication\x20required'});}_0x1fbc93();};this[_0x28821d(0x145)]['get']('/',_0x5aaf3d,(_0x3c910e,_0xb21500)=>{const _0x26ad5c=_0x28821d;_0xb21500[_0x26ad5c(0x12b)]('Appliance\x20is\x20running\x20and\x20authenticated!');}),this['app'][_0x28821d(0x117)](_0x28821d(0x12e),async(_0x42fb40,_0x4407c8)=>{const _0x40f4bc=_0x28821d,_0x57d57b=this[_0x40f4bc(0x13d)][_0x40f4bc(0x17d)](),_0xf06f09=this[_0x40f4bc(0x113)][_0x40f4bc(0x15f)](),_0x30a65b=this['webrtcService'][_0x40f4bc(0x14d)](),_0x51f01d=this[_0x40f4bc(0x158)][_0x40f4bc(0x119)](),_0x4e1b35=this[_0x40f4bc(0x128)]?this[_0x40f4bc(0x128)][_0x40f4bc(0x137)]():null;_0x4407c8[_0x40f4bc(0x19f)]({'status':'ok','environment':process[_0x40f4bc(0x149)][_0x40f4bc(0x168)]||_0x40f4bc(0x136),'backendUrl':this[_0x40f4bc(0x134)]['serverUrl'],'rosbridgeUrl':this[_0x40f4bc(0x134)][_0x40f4bc(0x13c)][_0x40f4bc(0x166)],'proxyPort':this['port'],'authenticated':_0x57d57b,'connections':_0x4e1b35,'topicManagement':{'discovered':_0x51f01d[_0x40f4bc(0x12f)],'strategies':_0x51f01d[_0x40f4bc(0x12c)],'largeDataTopics':_0x51f01d[_0x40f4bc(0x110)][_0x40f4bc(0x190)],'largeTopicsList':_0x51f01d[_0x40f4bc(0x110)]},'webrtc':{'activeSessions':_0xf06f09[_0x40f4bc(0x190)],'sharedVideoSources':_0x30a65b[_0x40f4bc(0x190)],'sessions':_0xf06f09,'sharedSources':_0x30a65b}});});}[a2_0x3482cf(0x15d)](_0x159edc,_0x3194f8){const _0x328c32=a2_0x3482cf;fs[_0x328c32(0x178)](_0x328c32(0x197),_0x328c32(0x11b)+_0x159edc+'\x0aAPP_PASSWORD='+_0x3194f8+'\x0a');}[a2_0x3482cf(0x13a)](){const _0x53ec4f=a2_0x3482cf;dotenv[_0x53ec4f(0x134)]({'override':!![]}),this[_0x53ec4f(0x134)][_0x53ec4f(0x194)]['username']=process[_0x53ec4f(0x149)][_0x53ec4f(0x19c)],this[_0x53ec4f(0x134)][_0x53ec4f(0x194)][_0x53ec4f(0x16e)]=process[_0x53ec4f(0x149)][_0x53ec4f(0x181)],console[_0x53ec4f(0x15a)]('Loaded\x20credentials:',{'username':this[_0x53ec4f(0x134)][_0x53ec4f(0x194)][_0x53ec4f(0x129)]?_0x53ec4f(0x157):_0x53ec4f(0x155),'password':this[_0x53ec4f(0x134)][_0x53ec4f(0x194)]['password']?_0x53ec4f(0x157):_0x53ec4f(0x155)});}async['promptForCredentials'](){const _0x40b4fb=a2_0x3482cf;process[_0x40b4fb(0x149)]['NODE_ENV']===_0x40b4fb(0x18e)&&(console['error'](_0x40b4fb(0x187)),console[_0x40b4fb(0x176)]('Please\x20run:\x20./setup.sh\x20reconfigure'),process[_0x40b4fb(0x135)](0x1));const _0x433b1d=prompt(_0x40b4fb(0x19a)),_0x4b8177=prompt['hide'](_0x40b4fb(0x13f));this[_0x40b4fb(0x15d)](_0x433b1d,_0x4b8177),this[_0x40b4fb(0x13a)]();}['loadApplianceIdentity'](){const _0x5f56fb=a2_0x3482cf;if(fs['existsSync'](this['APPLIANCE_FILE']))try{const _0x4003d1=JSON['parse'](fs[_0x5f56fb(0x16f)](this[_0x5f56fb(0x143)],_0x5f56fb(0x120)));if(_0x4003d1[_0x5f56fb(0x180)]&&_0x4003d1[_0x5f56fb(0x198)])return this[_0x5f56fb(0x180)]=_0x4003d1[_0x5f56fb(0x180)],this[_0x5f56fb(0x198)]=_0x4003d1['registrationToken'],console[_0x5f56fb(0x15a)](_0x5f56fb(0x124),this[_0x5f56fb(0x180)]),this[_0x5f56fb(0x158)]['loadConfig'](_0x4003d1),!![];}catch(_0x233802){console[_0x5f56fb(0x176)](_0x5f56fb(0x175),_0x233802);}return![];}['saveApplianceIdentity'](_0x2c8f44,_0x57f0f9){const _0x3dc363=a2_0x3482cf;let _0x415828={};if(fs[_0x3dc363(0x164)](this[_0x3dc363(0x143)]))try{_0x415828=JSON[_0x3dc363(0x1a0)](fs[_0x3dc363(0x16f)](this[_0x3dc363(0x143)],_0x3dc363(0x120)));}catch(_0x76a271){_0x415828={};}_0x415828['robotId']=_0x2c8f44,_0x415828['registrationToken']=_0x57f0f9,fs[_0x3dc363(0x178)](this['APPLIANCE_FILE'],JSON['stringify'](_0x415828,null,0x2));}async[a2_0x3482cf(0x179)](){const _0x381a47=a2_0x3482cf;try{const _0x5e6837=this[_0x381a47(0x13d)][_0x381a47(0x14f)]();if(!_0x5e6837)throw new Error('Not\x20authenticated');let _0x14ab32,_0x1a0e6d=![];while(!![]){try{this[_0x381a47(0x180)]&&this[_0x381a47(0x198)]?_0x14ab32=await axios[_0x381a47(0x19b)](this['config'][_0x381a47(0x19e)]+_0x381a47(0x131),{'name':_0x381a47(0x177),'robotId':this[_0x381a47(0x180)],'registration_token':this[_0x381a47(0x198)]},{'headers':{'Authorization':_0x381a47(0x161)+_0x5e6837,'Content-Type':_0x381a47(0x125)}}):_0x14ab32=await axios['post'](this[_0x381a47(0x134)][_0x381a47(0x19e)]+'/appliance/register',{'name':_0x381a47(0x177)},{'headers':{'Authorization':_0x381a47(0x161)+_0x5e6837,'Content-Type':'application/json'}});break;}catch(_0x108206){const _0xdb6c59=_0x108206?.[_0x381a47(0x142)]?.[_0x381a47(0x169)]?.[_0x381a47(0x176)]||_0x108206[_0x381a47(0x16b)];if(!_0x1a0e6d&&_0xdb6c59&&_0xdb6c59[_0x381a47(0x122)]()[_0x381a47(0x12d)](_0x381a47(0x115))){console[_0x381a47(0x12a)](_0x381a47(0x17f));if(fs['existsSync'](this['APPLIANCE_FILE']))fs[_0x381a47(0x183)](this[_0x381a47(0x143)]);this[_0x381a47(0x180)]=null,this[_0x381a47(0x198)]=null,_0x1a0e6d=!![];continue;}throw _0x108206;}}if(!_0x14ab32['data']||!_0x14ab32[_0x381a47(0x169)][_0x381a47(0x126)]||!_0x14ab32[_0x381a47(0x169)]['id'])throw new Error('Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server');return this[_0x381a47(0x198)]=_0x14ab32[_0x381a47(0x169)][_0x381a47(0x126)],this['robotId']=_0x14ab32[_0x381a47(0x169)]['id'],this[_0x381a47(0x18c)](this[_0x381a47(0x180)],this[_0x381a47(0x198)]),console['log'](_0x381a47(0x19d)),!![];}catch(_0x199251){return console['error'](_0x381a47(0x165),_0x199251[_0x381a47(0x16b)]),![];}}[a2_0x3482cf(0x199)](){const _0x522de5=a2_0x3482cf;this[_0x522de5(0x128)]=new this['ReverseProxyService'](this[_0x522de5(0x134)],this[_0x522de5(0x13d)],this['webrtcService'],this[_0x522de5(0x158)],this[_0x522de5(0x193)]),this[_0x522de5(0x128)][_0x522de5(0x118)](this[_0x522de5(0x180)],this[_0x522de5(0x198)]),this[_0x522de5(0x128)][_0x522de5(0x146)](),this['reverseProxy'][_0x522de5(0x18a)]();}['getInitialPort'](){const _0x298c0d=a2_0x3482cf;if(process[_0x298c0d(0x149)][_0x298c0d(0x16c)])return parseInt(process[_0x298c0d(0x149)][_0x298c0d(0x16c)],0xa);return this[_0x298c0d(0x134)]['rosbridge'][_0x298c0d(0x150)];}async['startServer'](_0x3a72bd=0xa){const _0x5a21ed=a2_0x3482cf;let _0x47a3f0=this['getInitialPort']();for(let _0x21e1e5=0x1;_0x21e1e5<=_0x3a72bd;_0x21e1e5++){try{await new Promise((_0x1ba6ed,_0x113065)=>{const _0x3c527a=a2_0x5a48;this[_0x3c527a(0x156)]=this[_0x3c527a(0x145)][_0x3c527a(0x192)](_0x47a3f0,()=>{const _0x455bd8=_0x3c527a;console[_0x455bd8(0x15a)](_0x455bd8(0x11f)+_0x47a3f0),this[_0x455bd8(0x139)]=_0x47a3f0,_0x1ba6ed();}),this['server']['on']('error',_0x3ea114=>{const _0x12557e=_0x3c527a;_0x3ea114[_0x12557e(0x15c)]===_0x12557e(0x144)?(console['warn'](_0x12557e(0x171)+_0x47a3f0+'\x20in\x20use,\x20trying\x20next\x20port...'),_0x113065(_0x3ea114)):_0x113065(_0x3ea114);});});return;}catch(_0x25d0a1){_0x47a3f0++;}}throw new Error(_0x5a21ed(0x148)+_0x3a72bd+_0x5a21ed(0x11c)+this[_0x5a21ed(0x170)]());}[a2_0x3482cf(0x160)](){const _0x1ab978=a2_0x3482cf;this[_0x1ab978(0x186)]=setInterval(async()=>{const _0x206746=_0x1ab978;try{if(this[_0x206746(0x180)]){const _0x4554c0=this[_0x206746(0x13d)][_0x206746(0x14f)]();await axios[_0x206746(0x19b)](this[_0x206746(0x134)][_0x206746(0x19e)]+_0x206746(0x18f),{'robotId':this['robotId']},{'headers':{'Authorization':_0x206746(0x161)+_0x4554c0,'Content-Type':_0x206746(0x125)}});}}catch(_0x19c921){console[_0x206746(0x176)](_0x206746(0x163),_0x19c921[_0x206746(0x16b)]);}},0x1388);}async[a2_0x3482cf(0x14e)](){const _0x31c93f=a2_0x3482cf;try{this[_0x31c93f(0x13a)]();let _0xd83078=await this[_0x31c93f(0x13d)][_0x31c93f(0x14b)]();while(!_0xd83078){console['log']('Login\x20failed.\x20Please\x20enter\x20credentials\x20again.'),await this['promptForCredentials'](),_0xd83078=await this['authService'][_0x31c93f(0x14b)]();}console['log'](_0x31c93f(0x18d));!this[_0x31c93f(0x162)]()&&console[_0x31c93f(0x15a)](_0x31c93f(0x191));console[_0x31c93f(0x15a)](_0x31c93f(0x167));const _0x5d8c40=await this[_0x31c93f(0x179)]();if(!_0x5d8c40)throw new Error(_0x31c93f(0x174));this[_0x31c93f(0x199)](),await this[_0x31c93f(0x17e)](),this['startPingInterval'](),console[_0x31c93f(0x15a)](_0x31c93f(0x112));}catch(_0xee64a0){console[_0x31c93f(0x176)]('Failed\x20to\x20start\x20appliance:',_0xee64a0);throw _0xee64a0;}}async[a2_0x3482cf(0x121)](){const _0x189a71=a2_0x3482cf;console[_0x189a71(0x15a)](_0x189a71(0x147)),this['pingInterval']&&(clearInterval(this[_0x189a71(0x186)]),this[_0x189a71(0x186)]=null),this['reverseProxy']&&this[_0x189a71(0x128)][_0x189a71(0x132)](),this[_0x189a71(0x156)]&&this['server'][_0x189a71(0x116)](),console[_0x189a71(0x15a)](_0x189a71(0x11e));}[a2_0x3482cf(0x111)](){const _0x27a4b6=a2_0x3482cf;return this[_0x27a4b6(0x145)];}['getPort'](){const _0x504c65=a2_0x3482cf;return this[_0x504c65(0x139)];}}module[a2_0x3482cf(0x152)]=ApplianceManager;function a2_0x5a48(_0xc55d83,_0x55f27f){const _0x1c1051=a2_0x7c3c();return a2_0x5a48=function(_0x13c238,_0x3449ea){_0x13c238=_0x13c238-0x110;let _0x7c3cf6=_0x1c1051[_0x13c238];return _0x7c3cf6;},a2_0x5a48(_0xc55d83,_0x55f27f);}function a2_0x7c3c(){const _0x428c48=['APP_USERNAME','Successfully\x20registered\x20with\x20server','serverUrl','json','parse','largeDataTopics','getApp','Appliance\x20started\x20successfully','webrtcService','prompt-sync','robot\x20not\x20found','close','get','initialize','getStatistics','18997ETmfxm','APP_USERNAME=','\x20attempts\x20starting\x20from\x20','ROSBridge\x20WebSocket\x20URL:\x20','Appliance\x20stopped','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','utf8','stop','toLowerCase','method','Loaded\x20appliance\x20identity:','application/json','registration_token','2730XHtxNt','reverseProxy','username','warn','send','strategies','includes','/health','totalTopics','ReverseProxyService','/appliance/register','closeAllConnections','header','config','exit','development','getConnectionStatus','Proxy\x20listening\x20on\x20port:\x20','port','reloadEnv','Initial\x20credentials\x20loaded\x20from\x20environment','rosbridge','authService','use','Enter\x20password:\x20','1745ZYVCQA','setupExpressApp','response','APPLIANCE_FILE','EADDRINUSE','app','connectToRosbridge','Stopping\x20appliance...','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','env','dotenv','login','2768zrkckz','getSharedVideoSources','start','getToken','proxyPort','express','exports','14pAwBUc','toString','NOT\x20SET','server','SET','topicManager','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','log','Environment:\x20','code','updateEnvFile','4012kHjQNS','getActiveSessions','startPingInterval','Bearer\x20','loadApplianceIdentity','Failed\x20to\x20ping\x20server:','existsSync','Failed\x20to\x20register\x20with\x20server:','wsEndpoint','Registering\x20with\x20server...','NODE_ENV','data','Attempting\x20to\x20login\x20to:','message','PORT','(((.+)+)+)+$','password','readFileSync','getInitialPort','Port\x20','357385HXFVtD','axios','Failed\x20to\x20register\x20with\x20server','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','error','WSL\x20Appliance','writeFileSync','registerWithServer','search','1060578lnqYAg','OPTIONS','isAuthenticated','startServer','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','robotId','APP_PASSWORD','Access-Control-Allow-Methods','unlinkSync','Access-Control-Allow-Headers','745794GNXqwE','pingInterval','Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file','6TURSVL','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','connectToServer','Access-Control-Allow-Origin','saveApplianceIdentity','Successfully\x20logged\x20in','production','/appliance/ping','length','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','listen','urdfService','credentials','1195080mMWRxW','sendStatus','.env','registrationToken','initializeReverseProxy','Enter\x20username:\x20','post'];a2_0x7c3c=function(){return _0x428c48;};return a2_0x7c3c();}