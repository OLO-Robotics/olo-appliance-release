const a2_0x2d93d0=a2_0x5bfb;(function(_0x155d1e,_0x2b116f){const _0x5e45dc=a2_0x5bfb,_0x251419=_0x155d1e();while(!![]){try{const _0x10beda=-parseInt(_0x5e45dc(0x176))/0x1*(parseInt(_0x5e45dc(0x186))/0x2)+parseInt(_0x5e45dc(0x16d))/0x3+-parseInt(_0x5e45dc(0x153))/0x4+-parseInt(_0x5e45dc(0x18c))/0x5*(-parseInt(_0x5e45dc(0x1a1))/0x6)+-parseInt(_0x5e45dc(0x198))/0x7+parseInt(_0x5e45dc(0x16c))/0x8+parseInt(_0x5e45dc(0x15f))/0x9*(parseInt(_0x5e45dc(0x13e))/0xa);if(_0x10beda===_0x2b116f)break;else _0x251419['push'](_0x251419['shift']());}catch(_0x5b6128){_0x251419['push'](_0x251419['shift']());}}}(a2_0x3f69,0x49edd));const a2_0x429296=(function(){let _0x6f9e31=!![];return function(_0x21aee0,_0x299b04){const _0x1ee554=_0x6f9e31?function(){const _0x346283=a2_0x5bfb;if(_0x299b04){const _0x4d5a69=_0x299b04[_0x346283(0x12b)](_0x21aee0,arguments);return _0x299b04=null,_0x4d5a69;}}:function(){};return _0x6f9e31=![],_0x1ee554;};}()),a2_0x55ad6e=a2_0x429296(this,function(){const _0x358cdc=a2_0x5bfb;return a2_0x55ad6e[_0x358cdc(0x122)]()[_0x358cdc(0x160)](_0x358cdc(0x17d))['toString']()[_0x358cdc(0x151)](a2_0x55ad6e)[_0x358cdc(0x160)](_0x358cdc(0x17d));});a2_0x55ad6e();const dotenv=require(a2_0x2d93d0(0x157)),express=require(a2_0x2d93d0(0x129)),axios=require(a2_0x2d93d0(0x140)),fs=require('fs'),prompt=require(a2_0x2d93d0(0x133))({'sigint':!![]});function a2_0x3f69(){const _0x209d40=['totalTopics','Proxy\x20listening\x20on\x20port:\x20','Successfully\x20registered\x20with\x20server','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','5MyYSAJ','Backend\x20Server\x20URL:\x20','Failed\x20to\x20start\x20appliance:','Access-Control-Allow-Methods','warn','WSL\x20Appliance','app','getConnectionStatus','login','.appliance.json','Enter\x20password:\x20','Production\x20mode:\x20Credentials\x20must\x20be\x20provided\x20in\x20.env\x20file','2030630wrfyZQ','topicManager','message','Please\x20run:\x20./setup.sh\x20reconfigure','setupExpressApp','NODE_ENV','json','Stopping\x20appliance...','APP_USERNAME=','75732yvEhdn','loadApplianceIdentity','\x20in\x20use,\x20trying\x20next\x20port...','Authentication\x20required','Enter\x20username:\x20','start','ReverseProxyService','updateEnvFile','startPingInterval','send','Port\x20','startServer','robotId','Access-Control-Allow-Origin','credentials','response','username','promptForCredentials','header','toString','SET','application/json','status','getStatistics','APPLIANCE_FILE','getPort','express','use','apply','hide','APP_USERNAME','webrtcService','\x0aAPP_PASSWORD=','error','stringify','development','prompt-sync','urdfService','exit','EADDRINUSE','readFileSync','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','Appliance\x20is\x20running\x20and\x20authenticated!','strategies','.env','connectToServer','Failed\x20to\x20ping\x20server:','2181420PBxApD','wsEndpoint','axios','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','password','registerWithServer','isAuthenticated','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','getActiveSessions','utf8','\x20attempts\x20starting\x20from\x20','unlinkSync','sendStatus','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','length','env','code','reloadEnv','constructor','/appliance/ping','1357856wqzYUn','close','server','stop','dotenv','log','method','Appliance\x20stopped','Registering\x20with\x20server...','getToken','Bearer\x20','closeAllConnections','27RedsNZ','search','post','get','Loaded\x20appliance\x20identity:','/health','initialize','existsSync','pingInterval','parse','registrationToken','getInitialPort','port','1179232ymVGtx','1522530TTmaoJ','listen','connectToRosbridge','production','toLowerCase','OPTIONS','authService','Successfully\x20logged\x20in','registration_token','285oQpTlZ','serverUrl','reverseProxy','config','/appliance/register','ROSBridge\x20WebSocket\x20URL:\x20','saveApplianceIdentity','(((.+)+)+)+$','largeDataTopics','exports','proxyPort','APP_PASSWORD','rosbridge','Access-Control-Allow-Headers','data','includes','2734RpZGXZ','NOT\x20SET'];a2_0x3f69=function(){return _0x209d40;};return a2_0x3f69();}class ApplianceManager{constructor(_0x207ce8,_0x48648f,_0x992d38,_0x494906,_0x3182c1,_0xcbab2a){const _0x417cf2=a2_0x2d93d0;this[_0x417cf2(0x179)]=_0x207ce8,this[_0x417cf2(0x173)]=_0x48648f,this[_0x417cf2(0x12e)]=_0x992d38,this[_0x417cf2(0x199)]=_0x494906,this[_0x417cf2(0x134)]=_0x3182c1,this[_0x417cf2(0x115)]=_0xcbab2a,this[_0x417cf2(0x192)]=express(),this[_0x417cf2(0x155)]=null,this[_0x417cf2(0x178)]=null,this[_0x417cf2(0x169)]=null,this[_0x417cf2(0x11b)]=null,this[_0x417cf2(0x127)]=_0x417cf2(0x195),this['port']=process[_0x417cf2(0x14e)]['PORT']||_0x207ce8[_0x417cf2(0x182)][_0x417cf2(0x180)],this[_0x417cf2(0x167)]=null;}['initialize'](){const _0x15390b=a2_0x2d93d0;dotenv[_0x15390b(0x179)](),process[_0x15390b(0x14e)][_0x15390b(0x12d)]&&process['env']['APP_PASSWORD']&&(this['config']['credentials'][_0x15390b(0x11f)]=process['env']['APP_USERNAME'],this[_0x15390b(0x179)]['credentials'][_0x15390b(0x142)]=process[_0x15390b(0x14e)][_0x15390b(0x181)],console[_0x15390b(0x158)]('Initial\x20credentials\x20loaded\x20from\x20environment')),console[_0x15390b(0x158)]('Environment:\x20'+(process[_0x15390b(0x14e)][_0x15390b(0x19d)]||_0x15390b(0x132))),console[_0x15390b(0x158)](_0x15390b(0x18d)+this['config'][_0x15390b(0x177)]),console[_0x15390b(0x158)](_0x15390b(0x17b)+this[_0x15390b(0x179)][_0x15390b(0x182)][_0x15390b(0x13f)]),console[_0x15390b(0x158)](_0x15390b(0x189)+this[_0x15390b(0x16b)]),this['setupExpressApp']();}[a2_0x2d93d0(0x19c)](){const _0x18c152=a2_0x2d93d0;this[_0x18c152(0x192)][_0x18c152(0x12a)]((_0x1549a8,_0x317560,_0xa23b3a)=>{const _0x499b71=_0x18c152;_0x317560[_0x499b71(0x121)](_0x499b71(0x11c),'*'),_0x317560[_0x499b71(0x121)](_0x499b71(0x18f),_0x499b71(0x14b)),_0x317560[_0x499b71(0x121)](_0x499b71(0x183),'Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization'),_0x1549a8[_0x499b71(0x159)]===_0x499b71(0x172)?_0x317560[_0x499b71(0x14a)](0xc8):_0xa23b3a();});const _0x156ed2=async(_0x22cb95,_0x2569f7,_0x2e5d6b)=>{const _0x48c870=_0x18c152;if(!this[_0x48c870(0x173)][_0x48c870(0x144)]()){console[_0x48c870(0x158)]('Attempting\x20to\x20login\x20to:',this[_0x48c870(0x179)][_0x48c870(0x177)]);const _0x5b58f6=await this[_0x48c870(0x173)][_0x48c870(0x194)]();if(!_0x5b58f6)return _0x2569f7[_0x48c870(0x125)](0x191)[_0x48c870(0x19e)]({'error':_0x48c870(0x1a4)});}_0x2e5d6b();};this[_0x18c152(0x192)][_0x18c152(0x162)]('/',_0x156ed2,(_0x39bfb7,_0x5b9d81)=>{const _0x289f70=_0x18c152;_0x5b9d81[_0x289f70(0x118)](_0x289f70(0x139));}),this[_0x18c152(0x192)][_0x18c152(0x162)](_0x18c152(0x164),async(_0xa493ce,_0x5981c6)=>{const _0x28a94a=_0x18c152,_0xf38bef=this['authService'][_0x28a94a(0x144)](),_0x1769a4=this[_0x28a94a(0x12e)][_0x28a94a(0x146)](),_0x3624e6=this[_0x28a94a(0x12e)]['getSharedVideoSources'](),_0x28455b=this['topicManager'][_0x28a94a(0x126)](),_0x30bc77=this[_0x28a94a(0x178)]?this[_0x28a94a(0x178)][_0x28a94a(0x193)]():null;_0x5981c6[_0x28a94a(0x19e)]({'status':'ok','environment':process[_0x28a94a(0x14e)][_0x28a94a(0x19d)]||_0x28a94a(0x132),'backendUrl':this['config']['serverUrl'],'rosbridgeUrl':this[_0x28a94a(0x179)][_0x28a94a(0x182)][_0x28a94a(0x13f)],'proxyPort':this['port'],'authenticated':_0xf38bef,'connections':_0x30bc77,'topicManagement':{'discovered':_0x28455b[_0x28a94a(0x188)],'strategies':_0x28455b[_0x28a94a(0x13a)],'largeDataTopics':_0x28455b['largeDataTopics'][_0x28a94a(0x14d)],'largeTopicsList':_0x28455b[_0x28a94a(0x17e)]},'webrtc':{'activeSessions':_0x1769a4['length'],'sharedVideoSources':_0x3624e6[_0x28a94a(0x14d)],'sessions':_0x1769a4,'sharedSources':_0x3624e6}});});}[a2_0x2d93d0(0x116)](_0x1ff617,_0x2fc3a3){const _0x5bbe27=a2_0x2d93d0;fs['writeFileSync'](_0x5bbe27(0x13b),_0x5bbe27(0x1a0)+_0x1ff617+_0x5bbe27(0x12f)+_0x2fc3a3+'\x0a');}[a2_0x2d93d0(0x150)](){const _0x2c784c=a2_0x2d93d0;dotenv['config']({'override':!![]}),this[_0x2c784c(0x179)][_0x2c784c(0x11d)][_0x2c784c(0x11f)]=process[_0x2c784c(0x14e)][_0x2c784c(0x12d)],this[_0x2c784c(0x179)]['credentials'][_0x2c784c(0x142)]=process[_0x2c784c(0x14e)]['APP_PASSWORD'],console[_0x2c784c(0x158)]('Loaded\x20credentials:',{'username':this[_0x2c784c(0x179)][_0x2c784c(0x11d)]['username']?'SET':_0x2c784c(0x187),'password':this[_0x2c784c(0x179)][_0x2c784c(0x11d)][_0x2c784c(0x142)]?_0x2c784c(0x123):'NOT\x20SET'});}async[a2_0x2d93d0(0x120)](){const _0x361d04=a2_0x2d93d0;process[_0x361d04(0x14e)][_0x361d04(0x19d)]===_0x361d04(0x170)&&(console[_0x361d04(0x130)](_0x361d04(0x197)),console[_0x361d04(0x130)](_0x361d04(0x19b)),process[_0x361d04(0x135)](0x1));const _0xf949ee=prompt(_0x361d04(0x1a5)),_0x14446b=prompt[_0x361d04(0x12c)](_0x361d04(0x196));this[_0x361d04(0x116)](_0xf949ee,_0x14446b),this[_0x361d04(0x150)]();}[a2_0x2d93d0(0x1a2)](){const _0x23ff09=a2_0x2d93d0;if(fs[_0x23ff09(0x166)](this[_0x23ff09(0x127)]))try{const _0x35ac5b=JSON[_0x23ff09(0x168)](fs[_0x23ff09(0x137)](this['APPLIANCE_FILE'],_0x23ff09(0x147)));if(_0x35ac5b[_0x23ff09(0x11b)]&&_0x35ac5b['registrationToken'])return this[_0x23ff09(0x11b)]=_0x35ac5b[_0x23ff09(0x11b)],this[_0x23ff09(0x169)]=_0x35ac5b['registrationToken'],console[_0x23ff09(0x158)](_0x23ff09(0x163),this[_0x23ff09(0x11b)]),this[_0x23ff09(0x199)]['loadConfig'](_0x35ac5b),!![];}catch(_0x324f50){console[_0x23ff09(0x130)]('Failed\x20to\x20parse\x20appliance\x20identity\x20file:',_0x324f50);}return![];}[a2_0x2d93d0(0x17c)](_0x15ca3b,_0x5c6221){const _0xdd5d6c=a2_0x2d93d0;let _0x25bc22={};if(fs['existsSync'](this[_0xdd5d6c(0x127)]))try{_0x25bc22=JSON[_0xdd5d6c(0x168)](fs['readFileSync'](this[_0xdd5d6c(0x127)],_0xdd5d6c(0x147)));}catch(_0x2e51bc){_0x25bc22={};}_0x25bc22['robotId']=_0x15ca3b,_0x25bc22[_0xdd5d6c(0x169)]=_0x5c6221,fs['writeFileSync'](this[_0xdd5d6c(0x127)],JSON[_0xdd5d6c(0x131)](_0x25bc22,null,0x2));}async[a2_0x2d93d0(0x143)](){const _0x38ba19=a2_0x2d93d0;try{const _0x2d2c5a=this[_0x38ba19(0x173)][_0x38ba19(0x15c)]();if(!_0x2d2c5a)throw new Error('Not\x20authenticated');let _0x1a5f74,_0x24e377=![];while(!![]){try{this[_0x38ba19(0x11b)]&&this[_0x38ba19(0x169)]?_0x1a5f74=await axios['post'](this[_0x38ba19(0x179)]['serverUrl']+_0x38ba19(0x17a),{'name':_0x38ba19(0x191),'robotId':this[_0x38ba19(0x11b)],'registration_token':this['registrationToken']},{'headers':{'Authorization':'Bearer\x20'+_0x2d2c5a,'Content-Type':_0x38ba19(0x124)}}):_0x1a5f74=await axios[_0x38ba19(0x161)](this['config'][_0x38ba19(0x177)]+_0x38ba19(0x17a),{'name':_0x38ba19(0x191)},{'headers':{'Authorization':_0x38ba19(0x15d)+_0x2d2c5a,'Content-Type':_0x38ba19(0x124)}});break;}catch(_0x103ce6){const _0x25de43=_0x103ce6?.[_0x38ba19(0x11e)]?.[_0x38ba19(0x184)]?.[_0x38ba19(0x130)]||_0x103ce6[_0x38ba19(0x19a)];if(!_0x24e377&&_0x25de43&&_0x25de43[_0x38ba19(0x171)]()[_0x38ba19(0x185)]('robot\x20not\x20found')){console[_0x38ba19(0x190)](_0x38ba19(0x145));if(fs[_0x38ba19(0x166)](this[_0x38ba19(0x127)]))fs[_0x38ba19(0x149)](this['APPLIANCE_FILE']);this[_0x38ba19(0x11b)]=null,this['registrationToken']=null,_0x24e377=!![];continue;}throw _0x103ce6;}}if(!_0x1a5f74[_0x38ba19(0x184)]||!_0x1a5f74['data'][_0x38ba19(0x175)]||!_0x1a5f74[_0x38ba19(0x184)]['id'])throw new Error(_0x38ba19(0x14c));return this['registrationToken']=_0x1a5f74['data']['registration_token'],this['robotId']=_0x1a5f74[_0x38ba19(0x184)]['id'],this[_0x38ba19(0x17c)](this[_0x38ba19(0x11b)],this['registrationToken']),console[_0x38ba19(0x158)](_0x38ba19(0x18a)),!![];}catch(_0x11d265){return console[_0x38ba19(0x130)]('Failed\x20to\x20register\x20with\x20server:',_0x11d265[_0x38ba19(0x19a)]),![];}}['initializeReverseProxy'](){const _0x59924f=a2_0x2d93d0;this[_0x59924f(0x178)]=new this[(_0x59924f(0x115))](this[_0x59924f(0x179)],this['authService'],this[_0x59924f(0x12e)],this[_0x59924f(0x199)],this[_0x59924f(0x134)]),this[_0x59924f(0x178)][_0x59924f(0x165)](this[_0x59924f(0x11b)],this['registrationToken']),this['reverseProxy'][_0x59924f(0x16f)](),this[_0x59924f(0x178)][_0x59924f(0x13c)]();}['getInitialPort'](){const _0xc7a19=a2_0x2d93d0;if(process[_0xc7a19(0x14e)]['PORT'])return parseInt(process[_0xc7a19(0x14e)]['PORT'],0xa);return this[_0xc7a19(0x179)]['rosbridge'][_0xc7a19(0x180)];}async[a2_0x2d93d0(0x11a)](_0x57e5d5=0xa){const _0x26e802=a2_0x2d93d0;let _0x3ddbba=this['getInitialPort']();for(let _0x4560a4=0x1;_0x4560a4<=_0x57e5d5;_0x4560a4++){try{await new Promise((_0x2db323,_0x31c61c)=>{const _0x5d437a=a2_0x5bfb;this[_0x5d437a(0x155)]=this[_0x5d437a(0x192)][_0x5d437a(0x16e)](_0x3ddbba,()=>{const _0x2acce4=_0x5d437a;console[_0x2acce4(0x158)](_0x2acce4(0x18b)+_0x3ddbba),this['port']=_0x3ddbba,_0x2db323();}),this['server']['on'](_0x5d437a(0x130),_0xa7dfa6=>{const _0x37527b=_0x5d437a;_0xa7dfa6[_0x37527b(0x14f)]===_0x37527b(0x136)?(console[_0x37527b(0x190)](_0x37527b(0x119)+_0x3ddbba+_0x37527b(0x1a3)),_0x31c61c(_0xa7dfa6)):_0x31c61c(_0xa7dfa6);});});return;}catch(_0x1ed626){_0x3ddbba++;}}throw new Error(_0x26e802(0x138)+_0x57e5d5+_0x26e802(0x148)+this[_0x26e802(0x16a)]());}[a2_0x2d93d0(0x117)](){const _0x396531=a2_0x2d93d0;this[_0x396531(0x167)]=setInterval(async()=>{const _0xc415c9=_0x396531;try{if(this['robotId']){const _0x3af090=this[_0xc415c9(0x173)][_0xc415c9(0x15c)]();await axios['post'](this[_0xc415c9(0x179)][_0xc415c9(0x177)]+_0xc415c9(0x152),{'robotId':this[_0xc415c9(0x11b)]},{'headers':{'Authorization':_0xc415c9(0x15d)+_0x3af090,'Content-Type':'application/json'}});}}catch(_0x1ef883){console[_0xc415c9(0x130)](_0xc415c9(0x13d),_0x1ef883['message']);}},0x1388);}async[a2_0x2d93d0(0x114)](){const _0x279ad8=a2_0x2d93d0;try{this[_0x279ad8(0x150)]();let _0x559f9d=await this[_0x279ad8(0x173)][_0x279ad8(0x194)]();while(!_0x559f9d){console[_0x279ad8(0x158)]('Login\x20failed.\x20Please\x20enter\x20credentials\x20again.'),await this[_0x279ad8(0x120)](),_0x559f9d=await this['authService'][_0x279ad8(0x194)]();}console['log'](_0x279ad8(0x174));!this[_0x279ad8(0x1a2)]()&&console['log'](_0x279ad8(0x141));console[_0x279ad8(0x158)](_0x279ad8(0x15b));const _0x1794a5=await this['registerWithServer']();if(!_0x1794a5)throw new Error('Failed\x20to\x20register\x20with\x20server');this['initializeReverseProxy'](),await this['startServer'](),this['startPingInterval'](),console['log']('Appliance\x20started\x20successfully');}catch(_0x21d1e5){console['error'](_0x279ad8(0x18e),_0x21d1e5);throw _0x21d1e5;}}async[a2_0x2d93d0(0x156)](){const _0x2a6ec1=a2_0x2d93d0;console[_0x2a6ec1(0x158)](_0x2a6ec1(0x19f)),this[_0x2a6ec1(0x167)]&&(clearInterval(this['pingInterval']),this[_0x2a6ec1(0x167)]=null),this[_0x2a6ec1(0x178)]&&this[_0x2a6ec1(0x178)][_0x2a6ec1(0x15e)](),this[_0x2a6ec1(0x155)]&&this['server'][_0x2a6ec1(0x154)](),console[_0x2a6ec1(0x158)](_0x2a6ec1(0x15a));}['getApp'](){const _0xf8671c=a2_0x2d93d0;return this[_0xf8671c(0x192)];}[a2_0x2d93d0(0x128)](){return this['port'];}}function a2_0x5bfb(_0xadebfc,_0x2b1e1a){const _0x5c21c0=a2_0x3f69();return a2_0x5bfb=function(_0x55ad6e,_0x429296){_0x55ad6e=_0x55ad6e-0x114;let _0x3f69e1=_0x5c21c0[_0x55ad6e];return _0x3f69e1;},a2_0x5bfb(_0xadebfc,_0x2b1e1a);}module[a2_0x2d93d0(0x17f)]=ApplianceManager;