const a9_0x4fe597=a9_0x2fba;(function(_0x161479,_0x5d6c4f){const _0x47d9cd=a9_0x2fba,_0x41b7ea=_0x161479();while(!![]){try{const _0x143ffb=parseInt(_0x47d9cd(0x15e))/0x1*(-parseInt(_0x47d9cd(0x17f))/0x2)+parseInt(_0x47d9cd(0x1e6))/0x3*(-parseInt(_0x47d9cd(0x19d))/0x4)+parseInt(_0x47d9cd(0x199))/0x5+-parseInt(_0x47d9cd(0x1e0))/0x6*(parseInt(_0x47d9cd(0x18f))/0x7)+parseInt(_0x47d9cd(0x148))/0x8+-parseInt(_0x47d9cd(0x17a))/0x9*(-parseInt(_0x47d9cd(0x1c5))/0xa)+-parseInt(_0x47d9cd(0x12b))/0xb;if(_0x143ffb===_0x5d6c4f)break;else _0x41b7ea['push'](_0x41b7ea['shift']());}catch(_0x56358a){_0x41b7ea['push'](_0x41b7ea['shift']());}}}(a9_0x157d,0x7fafa));function a9_0x2fba(_0x4e6f2d,_0x343e4c){const _0x35398f=a9_0x157d();return a9_0x2fba=function(_0x31863e,_0x2d5497){_0x31863e=_0x31863e-0x11d;let _0x157da9=_0x35398f[_0x31863e];return _0x157da9;},a9_0x2fba(_0x4e6f2d,_0x343e4c);}const a9_0x2d5497=(function(){let _0x3cce6e=!![];return function(_0x52f4fa,_0x35af0c){const _0x19a116=_0x3cce6e?function(){const _0x3805a7=a9_0x2fba;if(_0x35af0c){const _0x5d5ebb=_0x35af0c[_0x3805a7(0x1e9)](_0x52f4fa,arguments);return _0x35af0c=null,_0x5d5ebb;}}:function(){};return _0x3cce6e=![],_0x19a116;};}()),a9_0x31863e=a9_0x2d5497(this,function(){const _0x5e40ce=a9_0x2fba;return a9_0x31863e['toString']()[_0x5e40ce(0x1ad)](_0x5e40ce(0x1d8))[_0x5e40ce(0x163)]()[_0x5e40ce(0x13b)](a9_0x31863e)[_0x5e40ce(0x1ad)]('(((.+)+)+)+$');});a9_0x31863e();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require('wrtc'),sharp=require(a9_0x4fe597(0x181)),config=require(a9_0x4fe597(0x1c4)),DepthImageProcessor=require(a9_0x4fe597(0x11f)),turnCredentialsService=require('./turnCredentialsService');class ApplianceWebRTCService{constructor(){const _0x79ab90=a9_0x4fe597;this['activeSessions']=new Map(),this[_0x79ab90(0x19e)]=new Map(),this[_0x79ab90(0x137)]=new Map(),this[_0x79ab90(0x158)]=null,this[_0x79ab90(0x16a)]=null,this[_0x79ab90(0x1ea)]=new DepthImageProcessor(),this[_0x79ab90(0x135)]={'iceServers':[{'urls':_0x79ab90(0x1eb)},{'urls':_0x79ab90(0x11d)}]};}[a9_0x4fe597(0x171)](_0x396409,_0x253718){const _0x1fd278=a9_0x4fe597;this[_0x1fd278(0x158)]=_0x396409,this['serverWs']=_0x253718,turnCredentialsService['initialize'](config['serverUrl']),this['updateTurnCredentials'](),console['log'](_0x1fd278(0x1df));}async[a9_0x4fe597(0x1a3)](){const _0x2f38b8=a9_0x4fe597;try{console[_0x2f38b8(0x12e)](_0x2f38b8(0x1ba));const _0x49237c=await turnCredentialsService[_0x2f38b8(0x18e)]();this['rtcConfig']['iceServers']=_0x49237c,console[_0x2f38b8(0x12e)]('[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully');}catch(_0x520c37){console[_0x2f38b8(0x14d)]('[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:',_0x520c37),console['log'](_0x2f38b8(0x124));}}[a9_0x4fe597(0x1d6)](_0x116d07){const _0x3ea581=a9_0x4fe597;if(!_0x116d07['op']||!_0x116d07['op'][_0x3ea581(0x161)](_0x3ea581(0x1a4)))return![];console[_0x3ea581(0x12e)](_0x3ea581(0x1b0)+_0x116d07['op']);switch(_0x116d07['op']){case'webrtc_init_session':this['initializeSession'](_0x116d07[_0x3ea581(0x132)],_0x116d07[_0x3ea581(0x1b3)]);return!![];case _0x3ea581(0x197):this['handleOffer'](_0x116d07['session_id'],_0x116d07[_0x3ea581(0x12f)]);return!![];case _0x3ea581(0x178):this[_0x3ea581(0x13c)](_0x116d07['session_id'],_0x116d07[_0x3ea581(0x151)]);return!![];case _0x3ea581(0x13a):this[_0x3ea581(0x169)](_0x116d07[_0x3ea581(0x132)]);return!![];default:console[_0x3ea581(0x1b4)](_0x3ea581(0x141)+_0x116d07['op']);return![];}}[a9_0x4fe597(0x17c)](_0x476364){const _0x4f29a8=a9_0x4fe597;if(this[_0x4f29a8(0x137)][_0x4f29a8(0x1c6)](_0x476364)){const _0x198887=this['sharedVideoSources'][_0x4f29a8(0x123)](_0x476364);return _0x198887[_0x4f29a8(0x150)]++,console[_0x4f29a8(0x12e)](_0x4f29a8(0x191)+_0x476364+'\x20('+_0x198887[_0x4f29a8(0x150)]+_0x4f29a8(0x153)),_0x198887;}console[_0x4f29a8(0x12e)]('[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x476364);const {createCanvas:_0x2d1d0b}=require(_0x4f29a8(0x19c)),_0x5d8b88=_0x2d1d0b(config[_0x4f29a8(0x170)][_0x4f29a8(0x1e8)][_0x4f29a8(0x133)],config[_0x4f29a8(0x170)][_0x4f29a8(0x1e8)][_0x4f29a8(0x134)]),_0xfe6b02=_0x5d8b88[_0x4f29a8(0x15c)]('2d');this[_0x4f29a8(0x143)](_0x5d8b88,_0xfe6b02);const {RTCVideoSource:_0x38572e}=nonstandard,_0xa295f6=new _0x38572e();let _0x2acaaa=0x0;const _0x4e9f0a=0x3e8/config['webrtc'][_0x4f29a8(0x1e8)]['framerate'],_0x460633=this['subscribeToROSTopic'](_0x476364,_0x23c41c=>{const _0x43a4f0=_0x4f29a8,_0x154e05=Date['now']();_0x154e05-_0x2acaaa>=_0x4e9f0a&&(_0x2acaaa=_0x154e05,this[_0x43a4f0(0x1cf)](_0x5d8b88,_0xfe6b02,_0x23c41c,_0x476364,_0xa295f6));}),_0x1652ef={'videoSource':_0xa295f6,'canvas':_0x5d8b88,'rosSubscriber':_0x460633,'frameCount':0x1,'topic':_0x476364};return this[_0x4f29a8(0x137)][_0x4f29a8(0x1a8)](_0x476364,_0x1652ef),_0x1652ef;}[a9_0x4fe597(0x19b)](_0x718f20){const _0x3727d8=a9_0x4fe597,_0x51eae5=this[_0x3727d8(0x137)][_0x3727d8(0x123)](_0x718f20);if(!_0x51eae5)return;_0x51eae5[_0x3727d8(0x150)]--,console[_0x3727d8(0x12e)](_0x3727d8(0x1e2)+_0x718f20+'\x20('+_0x51eae5[_0x3727d8(0x150)]+_0x3727d8(0x1a9)),_0x51eae5[_0x3727d8(0x150)]<=0x0&&(console[_0x3727d8(0x12e)](_0x3727d8(0x1e7)+_0x718f20+_0x3727d8(0x190)),_0x51eae5[_0x3727d8(0x1d5)]&&(_0x51eae5[_0x3727d8(0x1d5)]=null),_0x51eae5[_0x3727d8(0x1f0)]&&_0x51eae5[_0x3727d8(0x1f0)][_0x3727d8(0x16c)](),this['sharedVideoSources'][_0x3727d8(0x187)](_0x718f20));}async[a9_0x4fe597(0x1ef)](_0x326d75,_0x3882da){const _0x21e21b=a9_0x4fe597;try{console[_0x21e21b(0x12e)](_0x21e21b(0x1bf)+_0x326d75+'\x20for\x20topic\x20'+_0x3882da);const _0x1544bf=this[_0x21e21b(0x17c)](_0x3882da),_0x5c6fd3=new RTCPeerConnection(this[_0x21e21b(0x135)]),_0x404053=_0x1544bf[_0x21e21b(0x1d5)]['createTrack']({'width':config[_0x21e21b(0x170)][_0x21e21b(0x1e8)][_0x21e21b(0x133)],'height':config['webrtc'][_0x21e21b(0x1e8)][_0x21e21b(0x134)],'framerate':config[_0x21e21b(0x170)][_0x21e21b(0x1e8)][_0x21e21b(0x160)]});console['log']('[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20'+_0x326d75);const {MediaStream:_0xd6df15}=require(_0x21e21b(0x1d1)),_0x5b8147=new _0xd6df15([_0x404053]);_0x5c6fd3[_0x21e21b(0x1a0)](_0x404053,_0x5b8147),this[_0x21e21b(0x1de)](_0x1544bf['videoSource'],_0x1544bf[_0x21e21b(0x19c)]),_0x5c6fd3[_0x21e21b(0x154)]=_0x36ba79=>{const _0x1d19a9=_0x21e21b;if(_0x36ba79[_0x1d19a9(0x151)]&&this['serverWs'])console[_0x1d19a9(0x12e)](_0x1d19a9(0x165)+_0x326d75+':',{'type':_0x36ba79['candidate']['type'],'protocol':_0x36ba79['candidate'][_0x1d19a9(0x1ce)],'address':_0x36ba79[_0x1d19a9(0x151)][_0x1d19a9(0x11e)],'port':_0x36ba79['candidate'][_0x1d19a9(0x1b1)]}),this['serverWs'][_0x1d19a9(0x16f)](JSON['stringify']({'op':_0x1d19a9(0x178),'session_id':_0x326d75,'candidate':_0x36ba79[_0x1d19a9(0x151)]}));else!_0x36ba79[_0x1d19a9(0x151)]&&console[_0x1d19a9(0x12e)]('[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20'+_0x326d75);},_0x5c6fd3['onconnectionstatechange']=()=>{const _0x1678a4=_0x21e21b;console[_0x1678a4(0x12e)](_0x1678a4(0x195)+_0x326d75+_0x1678a4(0x1ec)+_0x5c6fd3['connectionState']);if(_0x5c6fd3[_0x1678a4(0x1b7)]===_0x1678a4(0x12c))console[_0x1678a4(0x12e)](_0x1678a4(0x195)+_0x326d75+_0x1678a4(0x144));else{if(_0x5c6fd3['connectionState']===_0x1678a4(0x182))console[_0x1678a4(0x12e)](_0x1678a4(0x195)+_0x326d75+_0x1678a4(0x16d)),this[_0x1678a4(0x169)](_0x326d75);else _0x5c6fd3[_0x1678a4(0x1b7)]===_0x1678a4(0x1b5)&&(console[_0x1678a4(0x12e)](_0x1678a4(0x195)+_0x326d75+_0x1678a4(0x168)),this[_0x1678a4(0x18d)](_0x326d75));}},this[_0x21e21b(0x18b)][_0x21e21b(0x1a8)](_0x326d75,{'peerConnection':_0x5c6fd3,'topic':_0x3882da,'videoTrack':_0x404053,'mediaStream':_0x5b8147,'status':_0x21e21b(0x183)}),!this[_0x21e21b(0x19e)][_0x21e21b(0x1c6)](_0x3882da)&&this[_0x21e21b(0x19e)][_0x21e21b(0x1a8)](_0x3882da,new Set()),this['topicSessions'][_0x21e21b(0x123)](_0x3882da)[_0x21e21b(0x1a5)](_0x326d75),console[_0x21e21b(0x12e)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x326d75+'\x20initialized\x20successfully'),console[_0x21e21b(0x12e)]('[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20'+_0x3882da+':\x20'+this['topicSessions']['get'](_0x3882da)['size']);}catch(_0x17472e){console['error'](_0x21e21b(0x1d4)+_0x326d75+':',_0x17472e),this[_0x21e21b(0x169)](_0x326d75);}}async[a9_0x4fe597(0x1cb)](_0x221440,_0x4e1f17){const _0xd3856d=a9_0x4fe597,_0x1e9885=this[_0xd3856d(0x18b)][_0xd3856d(0x123)](_0x221440);if(!_0x1e9885){console[_0xd3856d(0x14d)](_0xd3856d(0x19a)+_0x221440);return;}try{console[_0xd3856d(0x12e)](_0xd3856d(0x1d7)+_0x221440),await _0x1e9885[_0xd3856d(0x1c1)]['setRemoteDescription'](new RTCSessionDescription(_0x4e1f17)),console[_0xd3856d(0x12e)](_0xd3856d(0x14e));const _0x5bdb58=await _0x1e9885['peerConnection'][_0xd3856d(0x1aa)]();console['log'](_0xd3856d(0x1ac)),await _0x1e9885[_0xd3856d(0x1c1)]['setLocalDescription'](_0x5bdb58),console['log'](_0xd3856d(0x177)),this['serverWs']&&(this[_0xd3856d(0x16a)][_0xd3856d(0x16f)](JSON[_0xd3856d(0x196)]({'op':_0xd3856d(0x1ae),'session_id':_0x221440,'answer':_0x5bdb58})),console[_0xd3856d(0x12e)](_0xd3856d(0x1c2)+_0x221440));}catch(_0x46fc03){console[_0xd3856d(0x14d)](_0xd3856d(0x186)+_0x221440+':',_0x46fc03),this['stopSession'](_0x221440);}}async[a9_0x4fe597(0x13c)](_0x4fbebb,_0x28933c){const _0x319a9d=a9_0x4fe597,_0x11eaf7=this['activeSessions']['get'](_0x4fbebb);if(!_0x11eaf7){console[_0x319a9d(0x14d)](_0x319a9d(0x184)+_0x4fbebb);return;}try{await _0x11eaf7[_0x319a9d(0x1c1)][_0x319a9d(0x146)](new RTCIceCandidate(_0x28933c)),console[_0x319a9d(0x12e)](_0x319a9d(0x1c0)+_0x4fbebb);}catch(_0x4e4f77){console[_0x319a9d(0x14d)](_0x319a9d(0x1e5)+_0x4fbebb+':',_0x4e4f77);}}[a9_0x4fe597(0x179)](_0x2aede1,_0x4d01ef){const _0x37bdf5=a9_0x4fe597;if(!this[_0x37bdf5(0x158)]||this['rosbridgeWs']['readyState']!==this['rosbridgeWs'][_0x37bdf5(0x166)])return console[_0x37bdf5(0x14d)](_0x37bdf5(0x185)),null;console[_0x37bdf5(0x12e)](_0x37bdf5(0x1b8)+_0x2aede1);const _0x569757=_0x2aede1['includes'](_0x37bdf5(0x121)),_0x36b6fa=_0x2aede1[_0x37bdf5(0x175)](_0x37bdf5(0x17b))||_0x2aede1['includes'](_0x37bdf5(0x142));let _0x2323c5=[];_0x569757?_0x36b6fa?_0x2323c5=[_0x37bdf5(0x147),_0x37bdf5(0x152),_0x37bdf5(0x156),_0x37bdf5(0x1ed)]:_0x2323c5=[_0x37bdf5(0x1ed),_0x37bdf5(0x1ee),'sensor_msgs/CompressedImage']:_0x2323c5=[_0x37bdf5(0x147),'sensor_msgs/msg/CompressedImage',_0x37bdf5(0x1ed)];console[_0x37bdf5(0x12e)](_0x37bdf5(0x18c)+_0x2aede1+_0x37bdf5(0x1cd)+(_0x569757?'depth':_0x37bdf5(0x18a))+_0x37bdf5(0x1b2),_0x2323c5);const _0x284814=[];let _0x4cf303=![];const _0x542484=_0x246433=>{return _0x5f5da9=>{const _0x14831c=a9_0x2fba;try{const _0x2055e5=JSON[_0x14831c(0x1cc)](_0x5f5da9[_0x14831c(0x15a)]);_0x2055e5['op']===_0x14831c(0x14f)&&_0x2055e5[_0x14831c(0x1b3)]===_0x2aede1&&_0x2055e5[_0x14831c(0x14b)]&&(!_0x4cf303&&(console[_0x14831c(0x12e)](_0x14831c(0x1da)+_0x2aede1+_0x14831c(0x131)+_0x246433),_0x4cf303=!![]),_0x4d01ef(_0x2055e5[_0x14831c(0x14b)]));}catch(_0x2912cf){console[_0x14831c(0x14d)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x2912cf);}};};for(const _0x4f1dc6 of _0x2323c5){const _0x1eb2ee={'op':'subscribe','topic':_0x2aede1,'type':_0x4f1dc6};console['log']('[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20'+_0x4f1dc6),this[_0x37bdf5(0x158)][_0x37bdf5(0x16f)](JSON[_0x37bdf5(0x196)](_0x1eb2ee));const _0x4e565c=_0x542484(_0x4f1dc6);this[_0x37bdf5(0x158)][_0x37bdf5(0x1a7)](_0x37bdf5(0x1e4),_0x4e565c),_0x284814[_0x37bdf5(0x126)]({'handler':_0x4e565c,'type':_0x4f1dc6});}return _0x569757&&_0x36b6fa&&setTimeout(()=>{const _0x4cd794=_0x37bdf5;if(!_0x4cf303){console[_0x4cd794(0x12e)](_0x4cd794(0x128)+_0x2aede1+',\x20trying\x20alternative\x20depth\x20topics');const _0x27d14c=_0x2aede1['replace'](_0x4cd794(0x1c8),'')['replace'](_0x4cd794(0x198),''),_0x5bf2e4=[_0x27d14c+_0x4cd794(0x130),_0x27d14c+_0x4cd794(0x140),_0x27d14c];for(const _0x276482 of _0x5bf2e4){console[_0x4cd794(0x12e)](_0x4cd794(0x139)+_0x276482);const _0x231ffa={'op':_0x4cd794(0x180),'topic':_0x276482,'type':_0x4cd794(0x1ed)};this[_0x4cd794(0x158)][_0x4cd794(0x16f)](JSON['stringify'](_0x231ffa));const _0x644ba9=_0x4c97f0=>{const _0x8ff52e=_0x4cd794;try{const _0x351642=JSON[_0x8ff52e(0x1cc)](_0x4c97f0[_0x8ff52e(0x15a)]);_0x351642['op']===_0x8ff52e(0x14f)&&_0x351642['topic']===_0x276482&&_0x351642[_0x8ff52e(0x14b)]&&(console[_0x8ff52e(0x12e)]('[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20'+_0x276482+_0x8ff52e(0x1e3)),_0x351642['msg'][_0x8ff52e(0x15a)]&&!_0x351642['msg'][_0x8ff52e(0x15a)][_0x8ff52e(0x161)]('/9j/')&&_0x4d01ef(_0x351642[_0x8ff52e(0x14b)]));}catch(_0x4d4e4d){console[_0x8ff52e(0x14d)](_0x8ff52e(0x1b6),_0x4d4e4d);}};this['rosbridgeWs'][_0x4cd794(0x1a7)](_0x4cd794(0x1e4),_0x644ba9),_0x284814['push']({'handler':_0x644ba9,'type':_0x4cd794(0x1ed),'topic':_0x276482});}}},0xbb8),{'unsubscribe':()=>{const _0x23d979=_0x37bdf5;for(const {handler:_0x253d23,type:_0x285aef,topic:_0x49b519}of _0x284814){this[_0x23d979(0x158)][_0x23d979(0x1dd)](_0x23d979(0x1e4),_0x253d23),this[_0x23d979(0x158)][_0x23d979(0x1a6)]===this[_0x23d979(0x158)]['OPEN']&&this[_0x23d979(0x158)][_0x23d979(0x16f)](JSON[_0x23d979(0x196)]({'op':_0x23d979(0x16c),'topic':_0x49b519||_0x2aede1}));}}};}[a9_0x4fe597(0x143)](_0x46a4f8,_0x5920f){const _0x3c44e1=a9_0x4fe597;_0x5920f[_0x3c44e1(0x164)]=_0x3c44e1(0x1dc),_0x5920f[_0x3c44e1(0x120)](0x0,0x0,_0x46a4f8['width'],_0x46a4f8['height']),_0x5920f[_0x3c44e1(0x164)]=_0x3c44e1(0x1b9),_0x5920f[_0x3c44e1(0x1c3)]=_0x3c44e1(0x192),_0x5920f[_0x3c44e1(0x125)]=_0x3c44e1(0x1d0),_0x5920f[_0x3c44e1(0x149)](_0x3c44e1(0x15b),_0x46a4f8[_0x3c44e1(0x133)]/0x2,_0x46a4f8[_0x3c44e1(0x134)]/0x2-0x14),_0x5920f[_0x3c44e1(0x164)]='#ffffff',_0x5920f['font']=_0x3c44e1(0x129),_0x5920f[_0x3c44e1(0x149)](_0x3c44e1(0x176),_0x46a4f8['width']/0x2,_0x46a4f8['height']/0x2+0x14);const _0x4502c3=Date[_0x3c44e1(0x15d)]()/0x3e8;for(let _0x37aba1=0x0;_0x37aba1<0x3;_0x37aba1++){const _0x20e574=(Math[_0x3c44e1(0x17e)](_0x4502c3*0x2+_0x37aba1*0.5)+0x1)/0x2;_0x5920f[_0x3c44e1(0x164)]=_0x3c44e1(0x188)+_0x20e574*0.5+')',_0x5920f[_0x3c44e1(0x155)](),_0x5920f[_0x3c44e1(0x1a2)](_0x46a4f8[_0x3c44e1(0x133)]/0x2-0x28+_0x37aba1*0x28,_0x46a4f8['height']/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x5920f[_0x3c44e1(0x1d9)]();}}[a9_0x4fe597(0x1de)](_0x2b4204,_0x4426ac){const _0x2c5a1d=a9_0x4fe597;try{if(!_0x2b4204||!_0x4426ac)return;const _0x2c00d1=_0x4426ac['getContext']('2d'),_0x21691c=_0x2c00d1[_0x2c5a1d(0x1ab)](0x0,0x0,_0x4426ac[_0x2c5a1d(0x133)],_0x4426ac[_0x2c5a1d(0x134)]),_0x3dab91=this[_0x2c5a1d(0x1d3)](_0x21691c['data'],_0x4426ac[_0x2c5a1d(0x133)],_0x4426ac['height']),_0x336575={'width':_0x4426ac['width'],'height':_0x4426ac[_0x2c5a1d(0x134)],'data':_0x3dab91};typeof _0x2b4204['onFrame']===_0x2c5a1d(0x167)&&_0x2b4204[_0x2c5a1d(0x1ca)](_0x336575);}catch(_0x39e0c2){console[_0x2c5a1d(0x14d)]('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x39e0c2);}}[a9_0x4fe597(0x1d3)](_0x3f4192,_0x42f611,_0xbb8456){const _0x439f2c=a9_0x4fe597,_0x269665=_0x42f611*_0xbb8456,_0x2d37f4=_0x42f611*_0xbb8456/0x4,_0xc9d59d=new Uint8Array(_0x269665+_0x2d37f4*0x2);let _0x375e5f=0x0,_0x3dab0e=_0x269665,_0x366dba=_0x269665+_0x2d37f4;for(let _0x5162fe=0x0;_0x5162fe<_0xbb8456;_0x5162fe++){for(let _0xf5d543=0x0;_0xf5d543<_0x42f611;_0xf5d543++){const _0x90437f=(_0x5162fe*_0x42f611+_0xf5d543)*0x4,_0x4313ab=_0x3f4192[_0x90437f],_0x342c62=_0x3f4192[_0x90437f+0x1],_0xc14ee2=_0x3f4192[_0x90437f+0x2],_0x4ebf02=Math['round'](0.299*_0x4313ab+0.587*_0x342c62+0.114*_0xc14ee2);_0xc9d59d[_0x375e5f++]=_0x4ebf02;if(_0x5162fe%0x2===0x0&&_0xf5d543%0x2===0x0){const _0x214845=Math[_0x439f2c(0x193)](-0.169*_0x4313ab-0.331*_0x342c62+0.5*_0xc14ee2+0x80),_0x35cdd1=Math[_0x439f2c(0x193)](0.5*_0x4313ab-0.419*_0x342c62-0.081*_0xc14ee2+0x80);_0xc9d59d[_0x3dab0e++]=Math['max'](0x0,Math[_0x439f2c(0x19f)](0xff,_0x214845)),_0xc9d59d[_0x366dba++]=Math[_0x439f2c(0x1be)](0x0,Math[_0x439f2c(0x19f)](0xff,_0x35cdd1));}}}return _0xc9d59d;}async[a9_0x4fe597(0x1cf)](_0x354f07,_0x2d23f1,_0x4fd59b,_0x7c66d0,_0x1c19d3){const _0x14f10d=a9_0x4fe597;try{if(!_0x4fd59b||!_0x4fd59b['data'])return;Math[_0x14f10d(0x122)]()<0.01&&console[_0x14f10d(0x12e)](_0x14f10d(0x136)+_0x7c66d0+_0x14f10d(0x1c9)+_0x4fd59b['data'][_0x14f10d(0x189)]+_0x14f10d(0x1db));const _0x5d28d2=Buffer[_0x14f10d(0x174)](_0x4fd59b[_0x14f10d(0x15a)],_0x14f10d(0x13f)),_0x55e597=this[_0x14f10d(0x1ea)][_0x14f10d(0x159)](_0x7c66d0);let _0x3562e8;_0x55e597?_0x3562e8=await this[_0x14f10d(0x1ea)][_0x14f10d(0x173)](_0x5d28d2,_0x354f07,_0x2d23f1,_0x7c66d0):_0x3562e8=await this[_0x14f10d(0x1ea)][_0x14f10d(0x12a)](_0x5d28d2,_0x354f07,_0x2d23f1),_0x2d23f1[_0x14f10d(0x15f)](_0x3562e8,0x0,0x0),_0x2d23f1['fillStyle']=_0x14f10d(0x172),_0x2d23f1[_0x14f10d(0x120)](0xa,0xa,0xdc,0x32),_0x2d23f1[_0x14f10d(0x164)]=_0x55e597?'#00ffff':_0x14f10d(0x157),_0x2d23f1[_0x14f10d(0x1c3)]='12px\x20monospace',_0x2d23f1[_0x14f10d(0x149)]((_0x55e597?'ðŸ”\x20Depth':_0x14f10d(0x145))+':\x20'+new Date()[_0x14f10d(0x14c)](),0xf,0x1c),_0x2d23f1[_0x14f10d(0x164)]=_0x14f10d(0x162),_0x2d23f1[_0x14f10d(0x1c3)]=_0x14f10d(0x1d2),_0x2d23f1[_0x14f10d(0x149)](_0x14f10d(0x1f1)+_0x7c66d0[_0x14f10d(0x1c7)]('/')[_0x14f10d(0x13d)](),0xf,0x2d),this['sendFrameToVideoSource'](_0x1c19d3,_0x354f07);}catch(_0xf2df4e){console[_0x14f10d(0x1b4)](_0x14f10d(0x1bb)+_0x7c66d0+':',_0xf2df4e[_0x14f10d(0x1e4)]);_0x7c66d0['includes'](_0x14f10d(0x121))&&Math[_0x14f10d(0x122)]()<0.1&&console[_0x14f10d(0x1b4)](_0x14f10d(0x1af)+_0x7c66d0[_0x14f10d(0x16b)]('/compressedDepth',_0x14f10d(0x130)));_0x2d23f1['fillStyle']='#1a1a1a',_0x2d23f1[_0x14f10d(0x120)](0x0,0x0,_0x354f07[_0x14f10d(0x133)],_0x354f07[_0x14f10d(0x134)]),_0x2d23f1[_0x14f10d(0x164)]=_0x14f10d(0x17d),_0x2d23f1['font']=_0x14f10d(0x129),_0x2d23f1['textAlign']=_0x14f10d(0x1d0);const _0x289ec6=_0x7c66d0[_0x14f10d(0x175)](_0x14f10d(0x121))?'ðŸ”\x20Processing\x20depth...':'ðŸ“¹\x20Processing\x20video...';_0x2d23f1[_0x14f10d(0x149)](_0x289ec6,_0x354f07[_0x14f10d(0x133)]/0x2,_0x354f07['height']/0x2),_0x2d23f1[_0x14f10d(0x164)]='#666',_0x2d23f1[_0x14f10d(0x1c3)]=_0x14f10d(0x1bc),_0x2d23f1[_0x14f10d(0x149)]('Topic:\x20'+_0x7c66d0[_0x14f10d(0x1c7)]('/')[_0x14f10d(0x13d)](),_0x354f07[_0x14f10d(0x133)]/0x2,_0x354f07[_0x14f10d(0x134)]/0x2+0x19),this[_0x14f10d(0x1de)](_0x1c19d3,_0x354f07);}}[a9_0x4fe597(0x169)](_0x5caa40){const _0x5786d8=a9_0x4fe597,_0x371d85=this[_0x5786d8(0x18b)][_0x5786d8(0x123)](_0x5caa40);if(!_0x371d85){console['warn'](_0x5786d8(0x1a1)+_0x5caa40);return;}console[_0x5786d8(0x12e)]('[WebRTC\x20Appliance]\x20Stopping\x20session:\x20'+_0x5caa40+'\x20for\x20topic:\x20'+_0x371d85['topic']);try{this['serverWs']&&this[_0x5786d8(0x16a)][_0x5786d8(0x1a6)]===this[_0x5786d8(0x16a)][_0x5786d8(0x166)]&&this[_0x5786d8(0x16a)]['send'](JSON[_0x5786d8(0x196)]({'op':_0x5786d8(0x13a),'session_id':_0x5caa40})),_0x371d85[_0x5786d8(0x1e1)]&&_0x371d85[_0x5786d8(0x1e1)]['stop'](),_0x371d85[_0x5786d8(0x1c1)]&&_0x371d85[_0x5786d8(0x1c1)]['close']();}catch(_0x143aea){console['error'](_0x5786d8(0x1bd)+_0x143aea);}this['cleanupSession'](_0x5caa40);}[a9_0x4fe597(0x18d)](_0x3f2fe3){const _0x321c2a=a9_0x4fe597,_0x4721b1=this[_0x321c2a(0x18b)][_0x321c2a(0x123)](_0x3f2fe3);if(_0x4721b1){const _0x1fc772=this['topicSessions'][_0x321c2a(0x123)](_0x4721b1[_0x321c2a(0x1b3)]);_0x1fc772&&(_0x1fc772[_0x321c2a(0x187)](_0x3f2fe3),_0x1fc772['size']===0x0&&this[_0x321c2a(0x19e)][_0x321c2a(0x187)](_0x4721b1[_0x321c2a(0x1b3)])),this[_0x321c2a(0x19b)](_0x4721b1[_0x321c2a(0x1b3)]);}this[_0x321c2a(0x18b)][_0x321c2a(0x187)](_0x3f2fe3),console[_0x321c2a(0x12e)](_0x321c2a(0x127)+_0x3f2fe3);}[a9_0x4fe597(0x13e)](){const _0xbeecfa=a9_0x4fe597;console[_0xbeecfa(0x12e)](_0xbeecfa(0x16e));const _0xa4e096=Array[_0xbeecfa(0x174)](this[_0xbeecfa(0x18b)][_0xbeecfa(0x194)]());_0xa4e096[_0xbeecfa(0x12d)](_0x41a28e=>this[_0xbeecfa(0x169)](_0x41a28e));}[a9_0x4fe597(0x138)](){const _0x3dcfe3=a9_0x4fe597,_0x36f15c=[];for(const [_0x40d1a8,_0x305f4f]of this[_0x3dcfe3(0x18b)]){_0x36f15c[_0x3dcfe3(0x126)]({'sessionId':_0x40d1a8,'topic':_0x305f4f[_0x3dcfe3(0x1b3)],'connectionState':_0x305f4f[_0x3dcfe3(0x1c1)]?.['connectionState']||'unknown','hasVideoTrack':!!_0x305f4f[_0x3dcfe3(0x1e1)]});}return _0x36f15c;}[a9_0x4fe597(0x14a)](){const _0x5551d0=a9_0x4fe597,_0x51d41b=[];for(const [_0x2eaa4c,_0x4fc80d]of this['sharedVideoSources']){_0x51d41b[_0x5551d0(0x126)]({'topic':_0x2eaa4c,'frameCount':_0x4fc80d[_0x5551d0(0x150)],'hasVideoSource':!!_0x4fc80d[_0x5551d0(0x1d5)],'hasRosSubscriber':!!_0x4fc80d[_0x5551d0(0x1f0)]});}return _0x51d41b;}}module['exports']=new ApplianceWebRTCService();function a9_0x157d(){const _0x2c434d=['wrtc','10px\x20monospace','convertRGBAtoI420','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','videoSource','handleMessage','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','(((.+)+)+)+$','fill','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','\x20bytes','#1a1a1a','removeEventListener','sendFrameToVideoSource','[WebRTC\x20Appliance]\x20Service\x20initialized','114rNVGgF','videoTrack','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20',',\x20converting\x20to\x20base64...','message','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','1902koCURR','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','video','apply','depthProcessor','stun:stun.l.google.com:19302','\x20connection\x20state:\x20','sensor_msgs/Image','sensor_msgs/msg/Image','initializeSession','rosSubscriber','Topic:\x20','stun:stun1.l.google.com:19302','address','./DepthImageProcessor','fillRect','depth','random','get','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','textAlign','push','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','16px\x20Arial','processColorImage','1352802GWbrsX','connected','forEach','log','offer','/image_raw','\x20with\x20message\x20type\x20','session_id','width','height','rtcConfig','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','sharedVideoSources','getActiveSessions','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','webrtc_stop_session','constructor','handleIceCandidate','pop','stopAllSessions','base64','/image','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','compressedDepth','drawLoadingPattern','\x20successfully\x20connected!','ðŸ“¹\x20Color','addIceCandidate','sensor_msgs/CompressedImage','8299752JNCTKn','fillText','getSharedVideoSources','msg','toLocaleTimeString','error','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','publish','frameCount','candidate','sensor_msgs/msg/CompressedImage','\x20sessions)','onicecandidate','beginPath','compressed_depth_image_transport/CompressedDepthImage','#00ff00','rosbridgeWs','isDepthTopic','data','ðŸ¤–\x20Robot\x20Camera','getContext','now','557ucmTCh','putImageData','framerate','startsWith','#ffffff','toString','fillStyle','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','OPEN','function','\x20connection\x20closed,\x20cleaning\x20up','stopSession','serverWs','replace','unsubscribe','\x20connection\x20failed,\x20stopping\x20session','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','send','webrtc','initialize','rgba(0,\x200,\x200,\x200.7)','processDepthImage','from','includes','Waiting\x20for\x20ROS\x20image\x20data...','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','webrtc_ice_candidate','subscribeToROSTopic','648hifFhn','compressed','getOrCreateSharedVideoSource','#888','sin','1444uqffoN','subscribe','sharp','failed','initializing','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','delete','rgba(0,\x20170,\x20255,\x20','length','color','activeSessions','[WebRTC\x20Appliance]\x20Topic\x20','cleanupSession','getIceServers','215579DNFeyT',',\x20cleaning\x20up\x20shared\x20resources','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','24px\x20Arial','round','keys','[WebRTC\x20Appliance]\x20Session\x20','stringify','webrtc_offer','/compressed','2391590rhpMPV','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','releaseSharedVideoSource','canvas','1252fvnKDi','topicSessions','min','addTrack','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','arc','updateTurnCredentials','webrtc_','add','readyState','addEventListener','set','\x20sessions\x20remaining)','createAnswer','getImageData','[WebRTC\x20Appliance]\x20Created\x20answer','search','webrtc_answer','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','port','\x20image,\x20trying\x20message\x20types:','topic','warn','closed','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','connectionState','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','#00aaff','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','12px\x20Arial','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','max','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','peerConnection','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','font','../config','43880QkaDeS','has','split','/compressedDepth',',\x20size:\x20','onFrame','handleOffer','parse','\x20detected\x20as\x20','protocol','updateCanvasWithImageData','center'];a9_0x157d=function(){return _0x2c434d;};return a9_0x157d();}