const a6_0xf09f0b=a6_0x23d4;(function(_0x8ea1a2,_0x2f3bbc){const _0x401579=a6_0x23d4,_0x52f7e5=_0x8ea1a2();while(!![]){try{const _0x425083=parseInt(_0x401579(0x243))/0x1*(parseInt(_0x401579(0x24b))/0x2)+parseInt(_0x401579(0x1ea))/0x3*(-parseInt(_0x401579(0x252))/0x4)+parseInt(_0x401579(0x1c9))/0x5*(-parseInt(_0x401579(0x1c8))/0x6)+-parseInt(_0x401579(0x194))/0x7*(parseInt(_0x401579(0x251))/0x8)+-parseInt(_0x401579(0x198))/0x9*(-parseInt(_0x401579(0x230))/0xa)+-parseInt(_0x401579(0x1dc))/0xb+parseInt(_0x401579(0x23f))/0xc;if(_0x425083===_0x2f3bbc)break;else _0x52f7e5['push'](_0x52f7e5['shift']());}catch(_0x51ab57){_0x52f7e5['push'](_0x52f7e5['shift']());}}}(a6_0x2285,0x7abdd));const a6_0x402158=(function(){let _0x531cd3=!![];return function(_0x3a2b7f,_0x54490d){const _0x250805=_0x531cd3?function(){const _0x517672=a6_0x23d4;if(_0x54490d){const _0x252835=_0x54490d[_0x517672(0x249)](_0x3a2b7f,arguments);return _0x54490d=null,_0x252835;}}:function(){};return _0x531cd3=![],_0x250805;};}()),a6_0x3fa4ea=a6_0x402158(this,function(){const _0xa83be8=a6_0x23d4;return a6_0x3fa4ea['toString']()[_0xa83be8(0x23c)]('(((.+)+)+)+$')['toString']()[_0xa83be8(0x213)](a6_0x3fa4ea)['search'](_0xa83be8(0x1ac));});function a6_0x23d4(_0x25525a,_0x316ed5){const _0x413340=a6_0x2285();return a6_0x23d4=function(_0x3fa4ea,_0x402158){_0x3fa4ea=_0x3fa4ea-0x18f;let _0x228541=_0x413340[_0x3fa4ea];return _0x228541;},a6_0x23d4(_0x25525a,_0x316ed5);}a6_0x3fa4ea();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0xf09f0b(0x26a)),sharp=require(a6_0xf09f0b(0x1fc)),config=require(a6_0xf09f0b(0x22f)),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require(a6_0xf09f0b(0x1d0));class ApplianceWebRTCService{constructor(){const _0x32fcfc=a6_0xf09f0b;this[_0x32fcfc(0x191)]=new Map(),this['topicSessions']=new Map(),this[_0x32fcfc(0x1b2)]=new Map(),this[_0x32fcfc(0x200)]=null,this[_0x32fcfc(0x24e)]=null,this['depthProcessor']=new DepthImageProcessor(),this['rtcConfig']={'iceServers':[{'urls':_0x32fcfc(0x209)},{'urls':'stun:stun1.l.google.com:19302'}]};}[a6_0xf09f0b(0x19c)](_0x41dbf2,_0x11a3ab){const _0x2e2243=a6_0xf09f0b;this[_0x2e2243(0x200)]=_0x41dbf2,this['serverWs']=_0x11a3ab,turnCredentialsService[_0x2e2243(0x19c)](config['serverUrl']),this[_0x2e2243(0x22a)](),console[_0x2e2243(0x20e)](_0x2e2243(0x1d4));}async[a6_0xf09f0b(0x22a)](){const _0x454e8d=a6_0xf09f0b;try{console[_0x454e8d(0x20e)](_0x454e8d(0x217));const _0x5df665=await turnCredentialsService[_0x454e8d(0x1b9)]();this['rtcConfig'][_0x454e8d(0x19a)]=_0x5df665,console[_0x454e8d(0x20e)](_0x454e8d(0x1ed));}catch(_0x1c64c0){console[_0x454e8d(0x20b)](_0x454e8d(0x1ca),_0x1c64c0),console[_0x454e8d(0x20e)](_0x454e8d(0x1fd));}}[a6_0xf09f0b(0x233)](_0xe03abb){const _0xb5ecfa=a6_0xf09f0b;if(!_0xe03abb['op']||!_0xe03abb['op'][_0xb5ecfa(0x222)]('webrtc_'))return![];console['log']('[WebRTC\x20Appliance]\x20Handling\x20message:\x20'+_0xe03abb['op']);switch(_0xe03abb['op']){case _0xb5ecfa(0x1c5):this['initializeSession'](_0xe03abb[_0xb5ecfa(0x25f)],_0xe03abb[_0xb5ecfa(0x1d8)]);return!![];case _0xb5ecfa(0x1de):this[_0xb5ecfa(0x211)](_0xe03abb[_0xb5ecfa(0x25f)],_0xe03abb[_0xb5ecfa(0x20a)]);return!![];case _0xb5ecfa(0x1b3):this[_0xb5ecfa(0x269)](_0xe03abb[_0xb5ecfa(0x25f)],_0xe03abb[_0xb5ecfa(0x23e)]);return!![];case'webrtc_stop_session':this[_0xb5ecfa(0x24f)](_0xe03abb[_0xb5ecfa(0x25f)]);return!![];default:console[_0xb5ecfa(0x21d)](_0xb5ecfa(0x1c7)+_0xe03abb['op']);return![];}}[a6_0xf09f0b(0x1e9)](_0x42604d){const _0x6e4c1e=a6_0xf09f0b;if(this[_0x6e4c1e(0x1b2)][_0x6e4c1e(0x210)](_0x42604d)){const _0x49090f=this[_0x6e4c1e(0x1b2)][_0x6e4c1e(0x1cd)](_0x42604d);return _0x49090f['frameCount']++,console['log'](_0x6e4c1e(0x1e5)+_0x42604d+'\x20('+_0x49090f[_0x6e4c1e(0x221)]+_0x6e4c1e(0x199)),_0x49090f;}console[_0x6e4c1e(0x20e)]('[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x42604d);const {createCanvas:_0x8074a5}=require(_0x6e4c1e(0x238)),_0x489cdd=_0x8074a5(config[_0x6e4c1e(0x22d)][_0x6e4c1e(0x1d9)][_0x6e4c1e(0x232)],config[_0x6e4c1e(0x22d)][_0x6e4c1e(0x1d9)][_0x6e4c1e(0x26c)]),_0x57231e=_0x489cdd[_0x6e4c1e(0x236)]('2d');this['drawLoadingPattern'](_0x489cdd,_0x57231e);const {RTCVideoSource:_0x3d4128}=nonstandard,_0x49bcc4=new _0x3d4128();let _0x10424c=0x0;const _0x10ddb6=0x3e8/config['webrtc'][_0x6e4c1e(0x1d9)][_0x6e4c1e(0x258)],_0x296e20=this[_0x6e4c1e(0x19e)](_0x42604d,_0x13ddf7=>{const _0x2c2850=_0x6e4c1e,_0x175c69=Date['now']();_0x175c69-_0x10424c>=_0x10ddb6&&(_0x10424c=_0x175c69,this[_0x2c2850(0x1c2)](_0x489cdd,_0x57231e,_0x13ddf7,_0x42604d,_0x49bcc4));}),_0x1e77c4={'videoSource':_0x49bcc4,'canvas':_0x489cdd,'rosSubscriber':_0x296e20,'frameCount':0x1,'topic':_0x42604d};return this['sharedVideoSources'][_0x6e4c1e(0x1cc)](_0x42604d,_0x1e77c4),_0x1e77c4;}['releaseSharedVideoSource'](_0x1ecfeb){const _0x58880=a6_0xf09f0b,_0x3360c2=this[_0x58880(0x1b2)][_0x58880(0x1cd)](_0x1ecfeb);if(!_0x3360c2)return;_0x3360c2[_0x58880(0x221)]--,console[_0x58880(0x20e)](_0x58880(0x1c3)+_0x1ecfeb+'\x20('+_0x3360c2['frameCount']+_0x58880(0x1f8)),_0x3360c2[_0x58880(0x221)]<=0x0&&(console['log'](_0x58880(0x1da)+_0x1ecfeb+_0x58880(0x248)),_0x3360c2[_0x58880(0x262)]&&(_0x3360c2[_0x58880(0x262)]=null),_0x3360c2[_0x58880(0x26d)]&&_0x3360c2['rosSubscriber'][_0x58880(0x240)](),this[_0x58880(0x1b2)][_0x58880(0x22c)](_0x1ecfeb));}async[a6_0xf09f0b(0x1cb)](_0x242cc8,_0xf16d05){const _0x4fc6b4=a6_0xf09f0b;try{console['log'](_0x4fc6b4(0x1ec)+_0x242cc8+_0x4fc6b4(0x1f9)+_0xf16d05);const _0x27e9e5=this[_0x4fc6b4(0x1e9)](_0xf16d05),_0x214d27=new RTCPeerConnection(this[_0x4fc6b4(0x220)]),_0x165063=_0x27e9e5[_0x4fc6b4(0x262)][_0x4fc6b4(0x1eb)]({'width':config[_0x4fc6b4(0x22d)][_0x4fc6b4(0x1d9)][_0x4fc6b4(0x232)],'height':config[_0x4fc6b4(0x22d)][_0x4fc6b4(0x1d9)]['height'],'framerate':config[_0x4fc6b4(0x22d)][_0x4fc6b4(0x1d9)][_0x4fc6b4(0x258)]});console[_0x4fc6b4(0x20e)](_0x4fc6b4(0x1f5)+_0x242cc8);const {MediaStream:_0x583493}=require(_0x4fc6b4(0x26a)),_0x30cb90=new _0x583493([_0x165063]);_0x214d27[_0x4fc6b4(0x207)](_0x165063,_0x30cb90),this[_0x4fc6b4(0x1a1)](_0x27e9e5[_0x4fc6b4(0x262)],_0x27e9e5[_0x4fc6b4(0x238)]),_0x214d27[_0x4fc6b4(0x264)]=_0x1d932a=>{const _0x1c145f=_0x4fc6b4;if(_0x1d932a[_0x1c145f(0x23e)]&&this[_0x1c145f(0x24e)])console[_0x1c145f(0x20e)](_0x1c145f(0x263)+_0x242cc8+':',{'type':_0x1d932a['candidate']['type'],'protocol':_0x1d932a[_0x1c145f(0x23e)][_0x1c145f(0x267)],'address':_0x1d932a[_0x1c145f(0x23e)]['address'],'port':_0x1d932a['candidate'][_0x1c145f(0x21a)]}),this[_0x1c145f(0x24e)][_0x1c145f(0x266)](JSON[_0x1c145f(0x250)]({'op':_0x1c145f(0x1b3),'session_id':_0x242cc8,'candidate':_0x1d932a[_0x1c145f(0x23e)]}));else!_0x1d932a[_0x1c145f(0x23e)]&&console[_0x1c145f(0x20e)](_0x1c145f(0x1e4)+_0x242cc8);},_0x214d27['onconnectionstatechange']=()=>{const _0x10ad39=_0x4fc6b4;console[_0x10ad39(0x20e)](_0x10ad39(0x1fe)+_0x242cc8+_0x10ad39(0x1cf)+_0x214d27['connectionState']);if(_0x214d27[_0x10ad39(0x227)]==='connected')console['log'](_0x10ad39(0x1fe)+_0x242cc8+_0x10ad39(0x205));else{if(_0x214d27[_0x10ad39(0x227)]===_0x10ad39(0x1d2))console[_0x10ad39(0x20e)](_0x10ad39(0x1fe)+_0x242cc8+_0x10ad39(0x259)),this[_0x10ad39(0x24f)](_0x242cc8);else _0x214d27['connectionState']===_0x10ad39(0x231)&&(console[_0x10ad39(0x20e)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x242cc8+_0x10ad39(0x1bc)),this[_0x10ad39(0x1ab)](_0x242cc8));}},this[_0x4fc6b4(0x191)][_0x4fc6b4(0x1cc)](_0x242cc8,{'peerConnection':_0x214d27,'topic':_0xf16d05,'videoTrack':_0x165063,'mediaStream':_0x30cb90,'status':_0x4fc6b4(0x1f6)}),!this['topicSessions'][_0x4fc6b4(0x210)](_0xf16d05)&&this[_0x4fc6b4(0x1d7)][_0x4fc6b4(0x1cc)](_0xf16d05,new Set()),this[_0x4fc6b4(0x1d7)][_0x4fc6b4(0x1cd)](_0xf16d05)[_0x4fc6b4(0x21c)](_0x242cc8),console[_0x4fc6b4(0x20e)](_0x4fc6b4(0x1fe)+_0x242cc8+_0x4fc6b4(0x225)),console[_0x4fc6b4(0x20e)]('[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20'+_0xf16d05+':\x20'+this[_0x4fc6b4(0x1d7)][_0x4fc6b4(0x1cd)](_0xf16d05)[_0x4fc6b4(0x1bd)]);}catch(_0x387e53){console['error'](_0x4fc6b4(0x25e)+_0x242cc8+':',_0x387e53),this[_0x4fc6b4(0x24f)](_0x242cc8);}}async[a6_0xf09f0b(0x211)](_0x4b6e3f,_0x3b49b1){const _0xf63d1=a6_0xf09f0b,_0x32c2c9=this['activeSessions'][_0xf63d1(0x1cd)](_0x4b6e3f);if(!_0x32c2c9){console['error'](_0xf63d1(0x1e6)+_0x4b6e3f);return;}try{console[_0xf63d1(0x20e)](_0xf63d1(0x1bb)+_0x4b6e3f),await _0x32c2c9['peerConnection'][_0xf63d1(0x197)](new RTCSessionDescription(_0x3b49b1)),console[_0xf63d1(0x20e)]('[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)');const _0x2ca7bd=await _0x32c2c9[_0xf63d1(0x1b1)]['createAnswer']();console['log'](_0xf63d1(0x1a9)),await _0x32c2c9[_0xf63d1(0x1b1)]['setLocalDescription'](_0x2ca7bd),console[_0xf63d1(0x20e)](_0xf63d1(0x1ba)),this[_0xf63d1(0x24e)]&&(this['serverWs']['send'](JSON[_0xf63d1(0x250)]({'op':_0xf63d1(0x1f4),'session_id':_0x4b6e3f,'answer':_0x2ca7bd})),console[_0xf63d1(0x20e)](_0xf63d1(0x1e1)+_0x4b6e3f));}catch(_0x3183ca){console[_0xf63d1(0x20b)](_0xf63d1(0x1a4)+_0x4b6e3f+':',_0x3183ca),this[_0xf63d1(0x24f)](_0x4b6e3f);}}async[a6_0xf09f0b(0x269)](_0x225875,_0x4b70e9){const _0xbfeb17=a6_0xf09f0b,_0x2267a3=this['activeSessions'][_0xbfeb17(0x1cd)](_0x225875);if(!_0x2267a3){console[_0xbfeb17(0x20b)](_0xbfeb17(0x239)+_0x225875);return;}try{await _0x2267a3[_0xbfeb17(0x1b1)][_0xbfeb17(0x229)](new RTCIceCandidate(_0x4b70e9)),console[_0xbfeb17(0x20e)]('[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20'+_0x225875);}catch(_0x23051b){console[_0xbfeb17(0x20b)](_0xbfeb17(0x254)+_0x225875+':',_0x23051b);}}[a6_0xf09f0b(0x19e)](_0x231cef,_0x4e7448){const _0x5cc4ef=a6_0xf09f0b;if(!this[_0x5cc4ef(0x200)]||this[_0x5cc4ef(0x200)]['readyState']!==this[_0x5cc4ef(0x200)][_0x5cc4ef(0x228)])return console['error'](_0x5cc4ef(0x1f0)),null;console[_0x5cc4ef(0x20e)](_0x5cc4ef(0x196)+_0x231cef);const _0x2862a9=_0x231cef[_0x5cc4ef(0x234)](_0x5cc4ef(0x1ff)),_0x8531cd=_0x231cef['includes'](_0x5cc4ef(0x1e2))||_0x231cef['includes'](_0x5cc4ef(0x18f));let _0x8a443=[];_0x2862a9?_0x8531cd?_0x8a443=[_0x5cc4ef(0x193),_0x5cc4ef(0x216),_0x5cc4ef(0x1c1),'sensor_msgs/Image']:_0x8a443=['sensor_msgs/Image','sensor_msgs/msg/Image',_0x5cc4ef(0x193)]:_0x8a443=[_0x5cc4ef(0x193),'sensor_msgs/msg/CompressedImage','sensor_msgs/Image'];console[_0x5cc4ef(0x20e)](_0x5cc4ef(0x25d)+_0x231cef+_0x5cc4ef(0x1b6)+(_0x2862a9?_0x5cc4ef(0x1ff):_0x5cc4ef(0x20f))+_0x5cc4ef(0x235),_0x8a443);const _0x299923=[];let _0x489f5b=![];const _0x2b79b7=_0x2de61e=>{return _0x3400fb=>{const _0x13cdc4=a6_0x23d4;try{const _0x36edd7=JSON[_0x13cdc4(0x21f)](_0x3400fb['data']);_0x36edd7['op']==='publish'&&_0x36edd7['topic']===_0x231cef&&_0x36edd7['msg']&&(!_0x489f5b&&(console[_0x13cdc4(0x20e)](_0x13cdc4(0x1d3)+_0x231cef+_0x13cdc4(0x24c)+_0x2de61e),_0x489f5b=!![]),_0x4e7448(_0x36edd7[_0x13cdc4(0x1ee)]));}catch(_0x5802e1){console[_0x13cdc4(0x20b)](_0x13cdc4(0x246),_0x5802e1);}};};for(const _0x52f1db of _0x8a443){const _0x249628={'op':_0x5cc4ef(0x1a0),'topic':_0x231cef,'type':_0x52f1db};console['log'](_0x5cc4ef(0x255)+_0x52f1db),this['rosbridgeWs'][_0x5cc4ef(0x266)](JSON[_0x5cc4ef(0x250)](_0x249628));const _0x2c7dc5=_0x2b79b7(_0x52f1db);this[_0x5cc4ef(0x200)][_0x5cc4ef(0x24a)](_0x5cc4ef(0x268),_0x2c7dc5),_0x299923[_0x5cc4ef(0x237)]({'handler':_0x2c7dc5,'type':_0x52f1db});}return _0x2862a9&&_0x8531cd&&setTimeout(()=>{const _0x13d22e=_0x5cc4ef;if(!_0x489f5b){console['log'](_0x13d22e(0x206)+_0x231cef+',\x20trying\x20alternative\x20depth\x20topics');const _0x1bb323=_0x231cef[_0x13d22e(0x1e7)](_0x13d22e(0x25b),'')['replace'](_0x13d22e(0x25c),''),_0x2ee94d=[_0x1bb323+_0x13d22e(0x1a3),_0x1bb323+'/image',_0x1bb323];for(const _0x45b7bd of _0x2ee94d){console[_0x13d22e(0x20e)](_0x13d22e(0x1ad)+_0x45b7bd);const _0x990649={'op':_0x13d22e(0x1a0),'topic':_0x45b7bd,'type':_0x13d22e(0x223)};this['rosbridgeWs'][_0x13d22e(0x266)](JSON['stringify'](_0x990649));const _0x418858=_0x65c550=>{const _0x473ac4=_0x13d22e;try{const _0x2b5b60=JSON[_0x473ac4(0x21f)](_0x65c550[_0x473ac4(0x201)]);_0x2b5b60['op']===_0x473ac4(0x1ef)&&_0x2b5b60[_0x473ac4(0x1d8)]===_0x45b7bd&&_0x2b5b60[_0x473ac4(0x1ee)]&&(console['log'](_0x473ac4(0x208)+_0x45b7bd+_0x473ac4(0x212)),_0x2b5b60[_0x473ac4(0x1ee)][_0x473ac4(0x201)]&&!_0x2b5b60['msg'][_0x473ac4(0x201)]['startsWith']('/9j/')&&_0x4e7448(_0x2b5b60[_0x473ac4(0x1ee)]));}catch(_0x304f05){console['error'](_0x473ac4(0x1a2),_0x304f05);}};this[_0x13d22e(0x200)][_0x13d22e(0x24a)](_0x13d22e(0x268),_0x418858),_0x299923[_0x13d22e(0x237)]({'handler':_0x418858,'type':_0x13d22e(0x223),'topic':_0x45b7bd});}}},0xbb8),{'unsubscribe':()=>{const _0x3bbf68=_0x5cc4ef;for(const {handler:_0x531f2e,type:_0x1bc8ef,topic:_0xa050f9}of _0x299923){this[_0x3bbf68(0x200)][_0x3bbf68(0x1ae)](_0x3bbf68(0x268),_0x531f2e),this['rosbridgeWs'][_0x3bbf68(0x245)]===this[_0x3bbf68(0x200)][_0x3bbf68(0x228)]&&this[_0x3bbf68(0x200)][_0x3bbf68(0x266)](JSON[_0x3bbf68(0x250)]({'op':_0x3bbf68(0x240),'topic':_0xa050f9||_0x231cef}));}}};}[a6_0xf09f0b(0x226)](_0x4b530d,_0x10f30c){const _0x2cb476=a6_0xf09f0b;_0x10f30c[_0x2cb476(0x1c4)]=_0x2cb476(0x1b4),_0x10f30c[_0x2cb476(0x19f)](0x0,0x0,_0x4b530d['width'],_0x4b530d[_0x2cb476(0x26c)]),_0x10f30c[_0x2cb476(0x1c4)]=_0x2cb476(0x1a5),_0x10f30c[_0x2cb476(0x247)]=_0x2cb476(0x219),_0x10f30c['textAlign']=_0x2cb476(0x23b),_0x10f30c[_0x2cb476(0x23a)](_0x2cb476(0x244),_0x4b530d[_0x2cb476(0x232)]/0x2,_0x4b530d[_0x2cb476(0x26c)]/0x2-0x14),_0x10f30c[_0x2cb476(0x1c4)]=_0x2cb476(0x1e3),_0x10f30c[_0x2cb476(0x247)]=_0x2cb476(0x1b0),_0x10f30c[_0x2cb476(0x23a)](_0x2cb476(0x224),_0x4b530d[_0x2cb476(0x232)]/0x2,_0x4b530d[_0x2cb476(0x26c)]/0x2+0x14);const _0x412445=Date[_0x2cb476(0x195)]()/0x3e8;for(let _0x526104=0x0;_0x526104<0x3;_0x526104++){const _0xdf26ec=(Math[_0x2cb476(0x260)](_0x412445*0x2+_0x526104*0.5)+0x1)/0x2;_0x10f30c[_0x2cb476(0x1c4)]=_0x2cb476(0x1b8)+_0xdf26ec*0.5+')',_0x10f30c['beginPath'](),_0x10f30c[_0x2cb476(0x1d5)](_0x4b530d[_0x2cb476(0x232)]/0x2-0x28+_0x526104*0x28,_0x4b530d['height']/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x10f30c[_0x2cb476(0x265)]();}}[a6_0xf09f0b(0x1a1)](_0xda6cc0,_0x5a4073){const _0x2e9e05=a6_0xf09f0b;try{if(!_0xda6cc0||!_0x5a4073)return;const _0x396e92=_0x5a4073['getContext']('2d'),_0x528972=_0x396e92[_0x2e9e05(0x19d)](0x0,0x0,_0x5a4073[_0x2e9e05(0x232)],_0x5a4073[_0x2e9e05(0x26c)]),_0xbd38fd=this[_0x2e9e05(0x1a7)](_0x528972[_0x2e9e05(0x201)],_0x5a4073[_0x2e9e05(0x232)],_0x5a4073['height']),_0x4efd91={'width':_0x5a4073[_0x2e9e05(0x232)],'height':_0x5a4073['height'],'data':_0xbd38fd};typeof _0xda6cc0[_0x2e9e05(0x24d)]==='function'&&_0xda6cc0['onFrame'](_0x4efd91);}catch(_0x964c40){console['error'](_0x2e9e05(0x256),_0x964c40);}}[a6_0xf09f0b(0x1a7)](_0x323dad,_0x177295,_0x4f93d8){const _0x480ba5=a6_0xf09f0b,_0x234228=_0x177295*_0x4f93d8,_0x1ceec4=_0x177295*_0x4f93d8/0x4,_0xadea2b=new Uint8Array(_0x234228+_0x1ceec4*0x2);let _0x5da239=0x0,_0x50ef18=_0x234228,_0xb6ad57=_0x234228+_0x1ceec4;for(let _0x22a324=0x0;_0x22a324<_0x4f93d8;_0x22a324++){for(let _0x32553d=0x0;_0x32553d<_0x177295;_0x32553d++){const _0x15ff5e=(_0x22a324*_0x177295+_0x32553d)*0x4,_0x3efc50=_0x323dad[_0x15ff5e],_0x143c4d=_0x323dad[_0x15ff5e+0x1],_0xf9d057=_0x323dad[_0x15ff5e+0x2],_0xf4255=Math[_0x480ba5(0x1dd)](0.299*_0x3efc50+0.587*_0x143c4d+0.114*_0xf9d057);_0xadea2b[_0x5da239++]=_0xf4255;if(_0x22a324%0x2===0x0&&_0x32553d%0x2===0x0){const _0x159022=Math[_0x480ba5(0x1dd)](-0.169*_0x3efc50-0.331*_0x143c4d+0.5*_0xf9d057+0x80),_0x288a4c=Math[_0x480ba5(0x1dd)](0.5*_0x3efc50-0.419*_0x143c4d-0.081*_0xf9d057+0x80);_0xadea2b[_0x50ef18++]=Math['max'](0x0,Math[_0x480ba5(0x1d6)](0xff,_0x159022)),_0xadea2b[_0xb6ad57++]=Math[_0x480ba5(0x1f1)](0x0,Math['min'](0xff,_0x288a4c));}}}return _0xadea2b;}async['updateCanvasWithImageData'](_0x32be09,_0x2113ee,_0x1b4cec,_0x2dc836,_0x310b64){const _0x2eeab1=a6_0xf09f0b;try{if(!_0x1b4cec||!_0x1b4cec[_0x2eeab1(0x201)])return;Math['random']()<0.01&&console[_0x2eeab1(0x20e)](_0x2eeab1(0x1b5)+_0x2dc836+_0x2eeab1(0x1af)+_0x1b4cec['data'][_0x2eeab1(0x204)]+_0x2eeab1(0x1d1));const _0x3b3b64=Buffer[_0x2eeab1(0x1b7)](_0x1b4cec[_0x2eeab1(0x201)],_0x2eeab1(0x21b)),_0x12bc49=this['depthProcessor'][_0x2eeab1(0x19b)](_0x2dc836);let _0x5107bc;_0x12bc49?_0x5107bc=await this[_0x2eeab1(0x192)]['processDepthImage'](_0x3b3b64,_0x32be09,_0x2113ee,_0x2dc836):_0x5107bc=await this[_0x2eeab1(0x192)][_0x2eeab1(0x1c0)](_0x3b3b64,_0x32be09,_0x2113ee),_0x2113ee[_0x2eeab1(0x1f3)](_0x5107bc,0x0,0x0),_0x2113ee['fillStyle']=_0x2eeab1(0x1c6),_0x2113ee[_0x2eeab1(0x19f)](0xa,0xa,0xdc,0x32),_0x2113ee['fillStyle']=_0x12bc49?_0x2eeab1(0x1ce):'#00ff00',_0x2113ee[_0x2eeab1(0x247)]=_0x2eeab1(0x1bf),_0x2113ee[_0x2eeab1(0x23a)]((_0x12bc49?_0x2eeab1(0x1a8):_0x2eeab1(0x253))+':\x20'+new Date()[_0x2eeab1(0x257)](),0xf,0x1c),_0x2113ee[_0x2eeab1(0x1c4)]=_0x2eeab1(0x1e3),_0x2113ee['font']=_0x2eeab1(0x1aa),_0x2113ee[_0x2eeab1(0x23a)](_0x2eeab1(0x214)+_0x2dc836[_0x2eeab1(0x1be)]('/')[_0x2eeab1(0x242)](),0xf,0x2d),this[_0x2eeab1(0x1a1)](_0x310b64,_0x32be09);}catch(_0x2151df){console[_0x2eeab1(0x21d)](_0x2eeab1(0x1a6)+_0x2dc836+':',_0x2151df[_0x2eeab1(0x268)]);_0x2dc836[_0x2eeab1(0x234)](_0x2eeab1(0x1ff))&&Math[_0x2eeab1(0x1f7)]()<0.1&&console[_0x2eeab1(0x21d)]('[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20'+_0x2dc836['replace']('/compressedDepth',_0x2eeab1(0x1a3)));_0x2113ee[_0x2eeab1(0x1c4)]=_0x2eeab1(0x1b4),_0x2113ee['fillRect'](0x0,0x0,_0x32be09[_0x2eeab1(0x232)],_0x32be09[_0x2eeab1(0x26c)]),_0x2113ee['fillStyle']=_0x2eeab1(0x1e0),_0x2113ee[_0x2eeab1(0x247)]=_0x2eeab1(0x1b0),_0x2113ee[_0x2eeab1(0x1df)]=_0x2eeab1(0x23b);const _0x6c56bc=_0x2dc836[_0x2eeab1(0x234)](_0x2eeab1(0x1ff))?_0x2eeab1(0x261):_0x2eeab1(0x22e);_0x2113ee[_0x2eeab1(0x23a)](_0x6c56bc,_0x32be09['width']/0x2,_0x32be09[_0x2eeab1(0x26c)]/0x2),_0x2113ee[_0x2eeab1(0x1c4)]=_0x2eeab1(0x1f2),_0x2113ee[_0x2eeab1(0x247)]=_0x2eeab1(0x21e),_0x2113ee['fillText'](_0x2eeab1(0x214)+_0x2dc836[_0x2eeab1(0x1be)]('/')[_0x2eeab1(0x242)](),_0x32be09[_0x2eeab1(0x232)]/0x2,_0x32be09[_0x2eeab1(0x26c)]/0x2+0x19),this[_0x2eeab1(0x1a1)](_0x310b64,_0x32be09);}}['stopSession'](_0x56a486){const _0x439e7d=a6_0xf09f0b,_0x2cfe10=this[_0x439e7d(0x191)][_0x439e7d(0x1cd)](_0x56a486);if(!_0x2cfe10){console[_0x439e7d(0x21d)](_0x439e7d(0x1fb)+_0x56a486);return;}console[_0x439e7d(0x20e)](_0x439e7d(0x1fa)+_0x56a486+_0x439e7d(0x1db)+_0x2cfe10[_0x439e7d(0x1d8)]);try{this[_0x439e7d(0x24e)]&&this[_0x439e7d(0x24e)][_0x439e7d(0x245)]===this[_0x439e7d(0x24e)][_0x439e7d(0x228)]&&this[_0x439e7d(0x24e)]['send'](JSON[_0x439e7d(0x250)]({'op':_0x439e7d(0x203),'session_id':_0x56a486})),_0x2cfe10[_0x439e7d(0x218)]&&_0x2cfe10[_0x439e7d(0x218)][_0x439e7d(0x23d)](),_0x2cfe10[_0x439e7d(0x1b1)]&&_0x2cfe10[_0x439e7d(0x1b1)][_0x439e7d(0x215)]();}catch(_0x4a223a){console['error'](_0x439e7d(0x26b)+_0x4a223a);}this[_0x439e7d(0x1ab)](_0x56a486);}[a6_0xf09f0b(0x1ab)](_0x2c8968){const _0xbdfbd7=a6_0xf09f0b,_0x6dae2b=this[_0xbdfbd7(0x191)]['get'](_0x2c8968);if(_0x6dae2b){const _0xfcc3da=this[_0xbdfbd7(0x1d7)][_0xbdfbd7(0x1cd)](_0x6dae2b['topic']);_0xfcc3da&&(_0xfcc3da[_0xbdfbd7(0x22c)](_0x2c8968),_0xfcc3da['size']===0x0&&this[_0xbdfbd7(0x1d7)][_0xbdfbd7(0x22c)](_0x6dae2b[_0xbdfbd7(0x1d8)])),this['releaseSharedVideoSource'](_0x6dae2b[_0xbdfbd7(0x1d8)]);}this[_0xbdfbd7(0x191)][_0xbdfbd7(0x22c)](_0x2c8968),console[_0xbdfbd7(0x20e)](_0xbdfbd7(0x190)+_0x2c8968);}[a6_0xf09f0b(0x20d)](){const _0x130759=a6_0xf09f0b;console[_0x130759(0x20e)](_0x130759(0x22b));const _0x34c80f=Array[_0x130759(0x1b7)](this[_0x130759(0x191)][_0x130759(0x20c)]());_0x34c80f[_0x130759(0x1e8)](_0x41b0c8=>this[_0x130759(0x24f)](_0x41b0c8));}[a6_0xf09f0b(0x25a)](){const _0x530930=a6_0xf09f0b,_0x5addc5=[];for(const [_0x11b459,_0x3e4ada]of this['activeSessions']){_0x5addc5[_0x530930(0x237)]({'sessionId':_0x11b459,'topic':_0x3e4ada[_0x530930(0x1d8)],'connectionState':_0x3e4ada[_0x530930(0x1b1)]?.[_0x530930(0x227)]||_0x530930(0x241),'hasVideoTrack':!!_0x3e4ada['videoTrack']});}return _0x5addc5;}[a6_0xf09f0b(0x202)](){const _0x39bfc2=a6_0xf09f0b,_0x27be83=[];for(const [_0x4c0bb8,_0x1740d0]of this[_0x39bfc2(0x1b2)]){_0x27be83[_0x39bfc2(0x237)]({'topic':_0x4c0bb8,'frameCount':_0x1740d0['frameCount'],'hasVideoSource':!!_0x1740d0['videoSource'],'hasRosSubscriber':!!_0x1740d0[_0x39bfc2(0x26d)]});}return _0x27be83;}}function a6_0x2285(){const _0x514f9c=['[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','initializeSession','set','get','#00ffff','\x20connection\x20state:\x20','./turnCredentialsService','\x20bytes','failed','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','[WebRTC\x20Appliance]\x20Service\x20initialized','arc','min','topicSessions','topic','video','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','\x20for\x20topic:\x20','4493324zlwfBM','round','webrtc_offer','textAlign','#888','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','compressed','#ffffff','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','replace','forEach','getOrCreateSharedVideoSource','64491KXBNJA','createTrack','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','msg','publish','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','max','#666','putImageData','webrtc_answer','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','initializing','random','\x20sessions\x20remaining)','\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','sharp','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','[WebRTC\x20Appliance]\x20Session\x20','depth','rosbridgeWs','data','getSharedVideoSources','webrtc_stop_session','length','\x20successfully\x20connected!','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','addTrack','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','stun:stun.l.google.com:19302','offer','error','keys','stopAllSessions','log','color','has','handleOffer',',\x20converting\x20to\x20base64...','constructor','Topic:\x20','close','sensor_msgs/msg/CompressedImage','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','videoTrack','24px\x20Arial','port','base64','add','warn','12px\x20Arial','parse','rtcConfig','frameCount','startsWith','sensor_msgs/Image','Waiting\x20for\x20ROS\x20image\x20data...','\x20initialized\x20successfully','drawLoadingPattern','connectionState','OPEN','addIceCandidate','updateTurnCredentials','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','delete','webrtc','📹\x20Processing\x20video...','../config','10EXLnPo','closed','width','handleMessage','includes','\x20image,\x20trying\x20message\x20types:','getContext','push','canvas','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','fillText','center','search','stop','candidate','6693984YnHUsL','unsubscribe','unknown','pop','130551uOzEzF','🤖\x20Robot\x20Camera','readyState','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','font',',\x20cleaning\x20up\x20shared\x20resources','apply','addEventListener','14gbaIYD','\x20with\x20message\x20type\x20','onFrame','serverWs','stopSession','stringify','6112904xHenUZ','4fsYiDv','📹\x20Color','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','toLocaleTimeString','framerate','\x20connection\x20failed,\x20stopping\x20session','getActiveSessions','/compressedDepth','/compressed','[WebRTC\x20Appliance]\x20Topic\x20','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','session_id','sin','🔍\x20Processing\x20depth...','videoSource','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','onicecandidate','fill','send','protocol','message','handleIceCandidate','wrtc','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','height','rosSubscriber','compressedDepth','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','activeSessions','depthProcessor','sensor_msgs/CompressedImage','7rDYqbE','now','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','setRemoteDescription','5451453ZksaDh','\x20sessions)','iceServers','isDepthTopic','initialize','getImageData','subscribeToROSTopic','fillRect','subscribe','sendFrameToVideoSource','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','/image_raw','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','#00aaff','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','convertRGBAtoI420','🔍\x20Depth','[WebRTC\x20Appliance]\x20Created\x20answer','10px\x20monospace','cleanupSession','(((.+)+)+)+$','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','removeEventListener',',\x20size:\x20','16px\x20Arial','peerConnection','sharedVideoSources','webrtc_ice_candidate','#1a1a1a','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','\x20detected\x20as\x20','from','rgba(0,\x20170,\x20255,\x20','getIceServers','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','\x20connection\x20closed,\x20cleaning\x20up','size','split','12px\x20monospace','processColorImage','compressed_depth_image_transport/CompressedDepthImage','updateCanvasWithImageData','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','fillStyle','webrtc_init_session','rgba(0,\x200,\x200,\x200.7)','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','2283378NondaG','5GnQiAQ'];a6_0x2285=function(){return _0x514f9c;};return a6_0x2285();}module['exports']=new ApplianceWebRTCService();