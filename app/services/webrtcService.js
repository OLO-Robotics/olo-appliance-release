const a6_0x32886b=a6_0x1c01;(function(_0x64742b,_0x16f04b){const _0x1ef4d9=a6_0x1c01,_0x479b84=_0x64742b();while(!![]){try{const _0x2b523f=parseInt(_0x1ef4d9(0x117))/0x1+parseInt(_0x1ef4d9(0x157))/0x2+parseInt(_0x1ef4d9(0x10e))/0x3+-parseInt(_0x1ef4d9(0x1b3))/0x4*(parseInt(_0x1ef4d9(0x1b1))/0x5)+parseInt(_0x1ef4d9(0x17f))/0x6*(-parseInt(_0x1ef4d9(0x1cd))/0x7)+parseInt(_0x1ef4d9(0x1b8))/0x8+-parseInt(_0x1ef4d9(0x1b9))/0x9;if(_0x2b523f===_0x16f04b)break;else _0x479b84['push'](_0x479b84['shift']());}catch(_0x45d87b){_0x479b84['push'](_0x479b84['shift']());}}}(a6_0x2133,0xcb984));function a6_0x2133(){const _0x4feb84=['[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','setRemoteDescription','constructor','push','subscribeToROSTopic','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','textAlign','getImageData','initialize','type','onFrame',',\x20converting\x20to\x20base64...','fillStyle','replace','rosbridgeWs','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','handleOffer','stun:stun.l.google.com:19302','topic','convertRGBAtoI420','message','[WebRTC\x20Appliance]\x20Session\x20','webrtc_offer','webrtc_ice_candidate','#1a1a1a','removeEventListener','session_id','\x20initialized\x20successfully','compressedDepth','serverWs','../config','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','frameCount','send','readyState','length','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','sensor_msgs/msg/Image','webrtc_answer','parse','set','addIceCandidate','msg','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','data','handleIceCandidate','Topic:\x20','stringify','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','now','video','pop','sin','updateCanvasWithImageData','[WebRTC\x20Appliance]\x20Created\x20answer','1719974rzlRKa','addTrack','handleMessage','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','wrtc','rtcConfig','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','stopSession','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','unsubscribe','fill','max','log','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','fillText','10px\x20monospace','\x20successfully\x20connected!','size','sharp','keys','from','videoSource','/image','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','publish','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','warn','includes','onconnectionstatechange','\x20detected\x20as\x20','#00aaff','cleanupSession','16px\x20Arial','getActiveSessions','sharedVideoSources','ðŸ“¹\x20Color','search','sensor_msgs/msg/CompressedImage','get','peerConnection','822jUKNIy','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','isDepthTopic','activeSessions','\x20with\x20message\x20type\x20','./turnCredentialsService','round','ðŸ¤–\x20Robot\x20Camera','drawLoadingPattern','getOrCreateSharedVideoSource','updateTurnCredentials','webrtc_init_session','putImageData','protocol','toLocaleTimeString','fillRect','#666','./DepthImageProcessor','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','iceServers','offer','/image_raw',',\x20trying\x20alternative\x20depth\x20topics','error','port','ðŸ”\x20Processing\x20depth...','(((.+)+)+)+$','\x20for\x20topic\x20','getSharedVideoSources','forEach','createTrack','compressed_depth_image_transport/CompressedDepthImage','depthProcessor','closed','[WebRTC\x20Appliance]\x20Topic\x20','getContext','\x20bytes','processDepthImage','width','onicecandidate','Waiting\x20for\x20ROS\x20image\x20data...','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','#ffffff','#00ff00','color','height','stopAllSessions','toString','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','9595dGUMVj','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','960mDYUan','subscribe','font','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','\x20connection\x20state:\x20','8768480XCzLKV','16388532YAtIie','\x20image,\x20trying\x20message\x20types:','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','min','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','framerate','processColorImage','canvas','webrtc','address','center','getIceServers','#00ffff','random','stop','\x20connection\x20failed,\x20stopping\x20session','videoTrack','initializeSession','49945aJmSHM','connected','sendFrameToVideoSource','connectionState','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','delete','startsWith','/compressedDepth','sensor_msgs/CompressedImage','sensor_msgs/Image','apply','depth',',\x20size:\x20','3858342LxpMTO','close','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','arc','addEventListener','webrtc_stop_session','ðŸ”\x20Depth','OPEN','candidate','850766znRHNL','rosSubscriber','failed','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','createAnswer','topicSessions','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','rgba(0,\x20170,\x20255,\x20','releaseSharedVideoSource'];a6_0x2133=function(){return _0x4feb84;};return a6_0x2133();}const a6_0x376c4f=(function(){let _0x58de26=!![];return function(_0x49e156,_0x5c948f){const _0x550daf=_0x58de26?function(){const _0x2bbe58=a6_0x1c01;if(_0x5c948f){const _0x55d4b3=_0x5c948f[_0x2bbe58(0x10b)](_0x49e156,arguments);return _0x5c948f=null,_0x55d4b3;}}:function(){};return _0x58de26=![],_0x550daf;};}()),a6_0x4049b2=a6_0x376c4f(this,function(){const _0xdc01cb=a6_0x1c01;return a6_0x4049b2[_0xdc01cb(0x1af)]()[_0xdc01cb(0x17b)](_0xdc01cb(0x199))[_0xdc01cb(0x1af)]()[_0xdc01cb(0x122)](a6_0x4049b2)[_0xdc01cb(0x17b)]('(((.+)+)+)+$');});a6_0x4049b2();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x32886b(0x15b)),sharp=require(a6_0x32886b(0x169)),config=require(a6_0x32886b(0x13e)),DepthImageProcessor=require(a6_0x32886b(0x190)),turnCredentialsService=require(a6_0x32886b(0x184));function a6_0x1c01(_0x59f8cc,_0x3dad04){const _0x42cfc0=a6_0x2133();return a6_0x1c01=function(_0x4049b2,_0x376c4f){_0x4049b2=_0x4049b2-0x107;let _0x21335e=_0x42cfc0[_0x4049b2];return _0x21335e;},a6_0x1c01(_0x59f8cc,_0x3dad04);}class ApplianceWebRTCService{constructor(){const _0x39105a=a6_0x32886b;this[_0x39105a(0x182)]=new Map(),this[_0x39105a(0x11c)]=new Map(),this[_0x39105a(0x179)]=new Map(),this['rosbridgeWs']=null,this[_0x39105a(0x13d)]=null,this[_0x39105a(0x19f)]=new DepthImageProcessor(),this[_0x39105a(0x15c)]={'iceServers':[{'urls':_0x39105a(0x131)},{'urls':'stun:stun1.l.google.com:19302'}]};}[a6_0x32886b(0x128)](_0x539905,_0xa8921d){const _0x8ead0=a6_0x32886b;this[_0x8ead0(0x12e)]=_0x539905,this[_0x8ead0(0x13d)]=_0xa8921d,turnCredentialsService[_0x8ead0(0x128)](config['serverUrl']),this[_0x8ead0(0x189)](),console[_0x8ead0(0x163)]('[WebRTC\x20Appliance]\x20Service\x20initialized');}async[a6_0x32886b(0x189)](){const _0x66646=a6_0x32886b;try{console['log'](_0x66646(0x1bd));const _0x4256df=await turnCredentialsService[_0x66646(0x1c6)]();this[_0x66646(0x15c)][_0x66646(0x192)]=_0x4256df,console[_0x66646(0x163)]('[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully');}catch(_0x26402c){console['error'](_0x66646(0x191),_0x26402c),console[_0x66646(0x163)](_0x66646(0x11d));}}[a6_0x32886b(0x159)](_0x5f574b){const _0x6366a6=a6_0x32886b;if(!_0x5f574b['op']||!_0x5f574b['op'][_0x6366a6(0x107)]('webrtc_'))return![];console[_0x6366a6(0x163)](_0x6366a6(0x13f)+_0x5f574b['op']);switch(_0x5f574b['op']){case _0x6366a6(0x18a):this[_0x6366a6(0x1cc)](_0x5f574b[_0x6366a6(0x13a)],_0x5f574b[_0x6366a6(0x132)]);return!![];case _0x6366a6(0x136):this[_0x6366a6(0x130)](_0x5f574b[_0x6366a6(0x13a)],_0x5f574b[_0x6366a6(0x193)]);return!![];case _0x6366a6(0x137):this[_0x6366a6(0x14d)](_0x5f574b[_0x6366a6(0x13a)],_0x5f574b[_0x6366a6(0x116)]);return!![];case _0x6366a6(0x113):this['stopSession'](_0x5f574b[_0x6366a6(0x13a)]);return!![];default:console[_0x6366a6(0x171)](_0x6366a6(0x110)+_0x5f574b['op']);return![];}}[a6_0x32886b(0x188)](_0x15da18){const _0x3f7561=a6_0x32886b;if(this[_0x3f7561(0x179)]['has'](_0x15da18)){const _0x11146a=this['sharedVideoSources']['get'](_0x15da18);return _0x11146a[_0x3f7561(0x140)]++,console[_0x3f7561(0x163)]('[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x15da18+'\x20('+_0x11146a[_0x3f7561(0x140)]+'\x20sessions)'),_0x11146a;}console['log']('[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x15da18);const {createCanvas:_0x24b484}=require(_0x3f7561(0x1c2)),_0x5d4fd1=_0x24b484(config[_0x3f7561(0x1c3)][_0x3f7561(0x152)][_0x3f7561(0x1a5)],config[_0x3f7561(0x1c3)][_0x3f7561(0x152)]['height']),_0x124bf5=_0x5d4fd1[_0x3f7561(0x1a2)]('2d');this[_0x3f7561(0x187)](_0x5d4fd1,_0x124bf5);const {RTCVideoSource:_0x18e238}=nonstandard,_0x5b8f9b=new _0x18e238();let _0x5cf254=0x0;const _0x216f5b=0x3e8/config[_0x3f7561(0x1c3)][_0x3f7561(0x152)][_0x3f7561(0x1c0)],_0x32a23c=this[_0x3f7561(0x124)](_0x15da18,_0xea70be=>{const _0x18f0c3=_0x3f7561,_0x100ae8=Date[_0x18f0c3(0x151)]();_0x100ae8-_0x5cf254>=_0x216f5b&&(_0x5cf254=_0x100ae8,this[_0x18f0c3(0x155)](_0x5d4fd1,_0x124bf5,_0xea70be,_0x15da18,_0x5b8f9b));}),_0x19aa9b={'videoSource':_0x5b8f9b,'canvas':_0x5d4fd1,'rosSubscriber':_0x32a23c,'frameCount':0x1,'topic':_0x15da18};return this[_0x3f7561(0x179)]['set'](_0x15da18,_0x19aa9b),_0x19aa9b;}['releaseSharedVideoSource'](_0x262ee3){const _0x123005=a6_0x32886b,_0xe8e75d=this[_0x123005(0x179)]['get'](_0x262ee3);if(!_0xe8e75d)return;_0xe8e75d[_0x123005(0x140)]--,console[_0x123005(0x163)](_0x123005(0x1d1)+_0x262ee3+'\x20('+_0xe8e75d[_0x123005(0x140)]+'\x20sessions\x20remaining)'),_0xe8e75d[_0x123005(0x140)]<=0x0&&(console[_0x123005(0x163)](_0x123005(0x180)+_0x262ee3+',\x20cleaning\x20up\x20shared\x20resources'),_0xe8e75d[_0x123005(0x16c)]&&(_0xe8e75d[_0x123005(0x16c)]=null),_0xe8e75d['rosSubscriber']&&_0xe8e75d[_0x123005(0x118)]['unsubscribe'](),this[_0x123005(0x179)][_0x123005(0x1d3)](_0x262ee3));}async[a6_0x32886b(0x1cc)](_0x57bd71,_0x3a3b92){const _0x1ef2ab=a6_0x32886b;try{console['log'](_0x1ef2ab(0x14b)+_0x57bd71+_0x1ef2ab(0x19a)+_0x3a3b92);const _0x43c5ae=this[_0x1ef2ab(0x188)](_0x3a3b92),_0x296196=new RTCPeerConnection(this[_0x1ef2ab(0x15c)]),_0x459e38=_0x43c5ae['videoSource'][_0x1ef2ab(0x19d)]({'width':config[_0x1ef2ab(0x1c3)][_0x1ef2ab(0x152)][_0x1ef2ab(0x1a5)],'height':config[_0x1ef2ab(0x1c3)][_0x1ef2ab(0x152)][_0x1ef2ab(0x1ad)],'framerate':config[_0x1ef2ab(0x1c3)][_0x1ef2ab(0x152)][_0x1ef2ab(0x1c0)]});console[_0x1ef2ab(0x163)](_0x1ef2ab(0x15d)+_0x57bd71);const {MediaStream:_0x5d94f0}=require('wrtc'),_0x34f916=new _0x5d94f0([_0x459e38]);_0x296196[_0x1ef2ab(0x158)](_0x459e38,_0x34f916),this[_0x1ef2ab(0x1cf)](_0x43c5ae[_0x1ef2ab(0x16c)],_0x43c5ae[_0x1ef2ab(0x1c2)]),_0x296196[_0x1ef2ab(0x1a6)]=_0x5482ea=>{const _0x432c44=_0x1ef2ab;if(_0x5482ea[_0x432c44(0x116)]&&this[_0x432c44(0x13d)])console[_0x432c44(0x163)]('[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20'+_0x57bd71+':',{'type':_0x5482ea['candidate'][_0x432c44(0x129)],'protocol':_0x5482ea[_0x432c44(0x116)][_0x432c44(0x18c)],'address':_0x5482ea['candidate'][_0x432c44(0x1c4)],'port':_0x5482ea[_0x432c44(0x116)][_0x432c44(0x197)]}),this[_0x432c44(0x13d)][_0x432c44(0x141)](JSON[_0x432c44(0x14f)]({'op':_0x432c44(0x137),'session_id':_0x57bd71,'candidate':_0x5482ea[_0x432c44(0x116)]}));else!_0x5482ea[_0x432c44(0x116)]&&console[_0x432c44(0x163)](_0x432c44(0x120)+_0x57bd71);},_0x296196[_0x1ef2ab(0x173)]=()=>{const _0x53c87c=_0x1ef2ab;console[_0x53c87c(0x163)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x57bd71+_0x53c87c(0x1b7)+_0x296196['connectionState']);if(_0x296196[_0x53c87c(0x1d0)]===_0x53c87c(0x1ce))console[_0x53c87c(0x163)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x57bd71+_0x53c87c(0x167));else{if(_0x296196['connectionState']===_0x53c87c(0x119))console[_0x53c87c(0x163)](_0x53c87c(0x135)+_0x57bd71+_0x53c87c(0x1ca)),this[_0x53c87c(0x15e)](_0x57bd71);else _0x296196[_0x53c87c(0x1d0)]===_0x53c87c(0x1a0)&&(console['log'](_0x53c87c(0x135)+_0x57bd71+'\x20connection\x20closed,\x20cleaning\x20up'),this[_0x53c87c(0x176)](_0x57bd71));}},this[_0x1ef2ab(0x182)][_0x1ef2ab(0x148)](_0x57bd71,{'peerConnection':_0x296196,'topic':_0x3a3b92,'videoTrack':_0x459e38,'mediaStream':_0x34f916,'status':'initializing'}),!this[_0x1ef2ab(0x11c)]['has'](_0x3a3b92)&&this[_0x1ef2ab(0x11c)]['set'](_0x3a3b92,new Set()),this[_0x1ef2ab(0x11c)][_0x1ef2ab(0x17d)](_0x3a3b92)['add'](_0x57bd71),console['log'](_0x1ef2ab(0x135)+_0x57bd71+_0x1ef2ab(0x13b)),console['log'](_0x1ef2ab(0x15f)+_0x3a3b92+':\x20'+this[_0x1ef2ab(0x11c)]['get'](_0x3a3b92)[_0x1ef2ab(0x168)]);}catch(_0x476095){console[_0x1ef2ab(0x196)](_0x1ef2ab(0x1b6)+_0x57bd71+':',_0x476095),this[_0x1ef2ab(0x15e)](_0x57bd71);}}async[a6_0x32886b(0x130)](_0x40b5e7,_0xb0516b){const _0x7d41f1=a6_0x32886b,_0x288d69=this['activeSessions'][_0x7d41f1(0x17d)](_0x40b5e7);if(!_0x288d69){console[_0x7d41f1(0x196)](_0x7d41f1(0x1d2)+_0x40b5e7);return;}try{console[_0x7d41f1(0x163)](_0x7d41f1(0x15a)+_0x40b5e7),await _0x288d69[_0x7d41f1(0x17e)][_0x7d41f1(0x121)](new RTCSessionDescription(_0xb0516b)),console[_0x7d41f1(0x163)](_0x7d41f1(0x1a9));const _0x2a4709=await _0x288d69[_0x7d41f1(0x17e)][_0x7d41f1(0x11b)]();console[_0x7d41f1(0x163)](_0x7d41f1(0x156)),await _0x288d69[_0x7d41f1(0x17e)]['setLocalDescription'](_0x2a4709),console['log'](_0x7d41f1(0x1b2)),this['serverWs']&&(this[_0x7d41f1(0x13d)]['send'](JSON[_0x7d41f1(0x14f)]({'op':_0x7d41f1(0x146),'session_id':_0x40b5e7,'answer':_0x2a4709})),console['log'](_0x7d41f1(0x12f)+_0x40b5e7));}catch(_0x59843e){console[_0x7d41f1(0x196)]('[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20'+_0x40b5e7+':',_0x59843e),this[_0x7d41f1(0x15e)](_0x40b5e7);}}async[a6_0x32886b(0x14d)](_0x3207ab,_0x3c442a){const _0x11173e=a6_0x32886b,_0x16d9e4=this[_0x11173e(0x182)]['get'](_0x3207ab);if(!_0x16d9e4){console[_0x11173e(0x196)](_0x11173e(0x1bf)+_0x3207ab);return;}try{await _0x16d9e4['peerConnection'][_0x11173e(0x149)](new RTCIceCandidate(_0x3c442a)),console[_0x11173e(0x163)]('[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20'+_0x3207ab);}catch(_0x2f8d05){console[_0x11173e(0x196)](_0x11173e(0x11a)+_0x3207ab+':',_0x2f8d05);}}['subscribeToROSTopic'](_0x273b14,_0x38ddae){const _0x4fd04c=a6_0x32886b;if(!this[_0x4fd04c(0x12e)]||this[_0x4fd04c(0x12e)][_0x4fd04c(0x142)]!==this[_0x4fd04c(0x12e)][_0x4fd04c(0x115)])return console[_0x4fd04c(0x196)](_0x4fd04c(0x16e)),null;console['log'](_0x4fd04c(0x1a8)+_0x273b14);const _0x479544=_0x273b14['includes'](_0x4fd04c(0x10c)),_0x2e40b2=_0x273b14[_0x4fd04c(0x172)]('compressed')||_0x273b14['includes'](_0x4fd04c(0x13c));let _0xd418b9=[];_0x479544?_0x2e40b2?_0xd418b9=[_0x4fd04c(0x109),_0x4fd04c(0x17c),_0x4fd04c(0x19e),_0x4fd04c(0x10a)]:_0xd418b9=[_0x4fd04c(0x10a),_0x4fd04c(0x145),_0x4fd04c(0x109)]:_0xd418b9=[_0x4fd04c(0x109),_0x4fd04c(0x17c),_0x4fd04c(0x10a)];console['log'](_0x4fd04c(0x1a1)+_0x273b14+_0x4fd04c(0x174)+(_0x479544?'depth':_0x4fd04c(0x1ac))+_0x4fd04c(0x1ba),_0xd418b9);const _0x40d274=[];let _0x5727c4=![];const _0x2e366c=_0xb5577b=>{return _0x339267=>{const _0x7148f2=a6_0x1c01;try{const _0x34bc23=JSON[_0x7148f2(0x147)](_0x339267['data']);_0x34bc23['op']===_0x7148f2(0x16f)&&_0x34bc23[_0x7148f2(0x132)]===_0x273b14&&_0x34bc23[_0x7148f2(0x14a)]&&(!_0x5727c4&&(console['log'](_0x7148f2(0x164)+_0x273b14+_0x7148f2(0x183)+_0xb5577b),_0x5727c4=!![]),_0x38ddae(_0x34bc23[_0x7148f2(0x14a)]));}catch(_0x472d12){console[_0x7148f2(0x196)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x472d12);}};};for(const _0x2e2395 of _0xd418b9){const _0x187eed={'op':_0x4fd04c(0x1b4),'topic':_0x273b14,'type':_0x2e2395};console[_0x4fd04c(0x163)]('[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20'+_0x2e2395),this[_0x4fd04c(0x12e)]['send'](JSON[_0x4fd04c(0x14f)](_0x187eed));const _0x39f51d=_0x2e366c(_0x2e2395);this[_0x4fd04c(0x12e)][_0x4fd04c(0x112)]('message',_0x39f51d),_0x40d274[_0x4fd04c(0x123)]({'handler':_0x39f51d,'type':_0x2e2395});}return _0x479544&&_0x2e40b2&&setTimeout(()=>{const _0x525a38=_0x4fd04c;if(!_0x5727c4){console[_0x525a38(0x163)](_0x525a38(0x1b0)+_0x273b14+_0x525a38(0x195));const _0x77694e=_0x273b14[_0x525a38(0x12d)](_0x525a38(0x108),'')[_0x525a38(0x12d)]('/compressed',''),_0x385b72=[_0x77694e+'/image_raw',_0x77694e+_0x525a38(0x16d),_0x77694e];for(const _0x31624b of _0x385b72){console[_0x525a38(0x163)]('[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20'+_0x31624b);const _0x173805={'op':'subscribe','topic':_0x31624b,'type':_0x525a38(0x10a)};this[_0x525a38(0x12e)][_0x525a38(0x141)](JSON[_0x525a38(0x14f)](_0x173805));const _0x374b9d=_0x522f7a=>{const _0x158519=_0x525a38;try{const _0x4860a9=JSON['parse'](_0x522f7a[_0x158519(0x14c)]);_0x4860a9['op']===_0x158519(0x16f)&&_0x4860a9[_0x158519(0x132)]===_0x31624b&&_0x4860a9[_0x158519(0x14a)]&&(console[_0x158519(0x163)](_0x158519(0x150)+_0x31624b+_0x158519(0x12b)),_0x4860a9[_0x158519(0x14a)][_0x158519(0x14c)]&&!_0x4860a9[_0x158519(0x14a)][_0x158519(0x14c)]['startsWith']('/9j/')&&_0x38ddae(_0x4860a9['msg']));}catch(_0x2ca8e4){console[_0x158519(0x196)](_0x158519(0x170),_0x2ca8e4);}};this[_0x525a38(0x12e)][_0x525a38(0x112)](_0x525a38(0x134),_0x374b9d),_0x40d274[_0x525a38(0x123)]({'handler':_0x374b9d,'type':_0x525a38(0x10a),'topic':_0x31624b});}}},0xbb8),{'unsubscribe':()=>{const _0x17867e=_0x4fd04c;for(const {handler:_0x879945,type:_0x7c943b,topic:_0x49a038}of _0x40d274){this[_0x17867e(0x12e)][_0x17867e(0x139)](_0x17867e(0x134),_0x879945),this[_0x17867e(0x12e)][_0x17867e(0x142)]===this[_0x17867e(0x12e)][_0x17867e(0x115)]&&this[_0x17867e(0x12e)][_0x17867e(0x141)](JSON[_0x17867e(0x14f)]({'op':_0x17867e(0x160),'topic':_0x49a038||_0x273b14}));}}};}[a6_0x32886b(0x187)](_0x3418bb,_0xb15f81){const _0x4a7c1e=a6_0x32886b;_0xb15f81[_0x4a7c1e(0x12c)]='#1a1a1a',_0xb15f81[_0x4a7c1e(0x18e)](0x0,0x0,_0x3418bb[_0x4a7c1e(0x1a5)],_0x3418bb[_0x4a7c1e(0x1ad)]),_0xb15f81['fillStyle']=_0x4a7c1e(0x175),_0xb15f81['font']='24px\x20Arial',_0xb15f81[_0x4a7c1e(0x126)]='center',_0xb15f81[_0x4a7c1e(0x165)](_0x4a7c1e(0x186),_0x3418bb['width']/0x2,_0x3418bb[_0x4a7c1e(0x1ad)]/0x2-0x14),_0xb15f81['fillStyle']=_0x4a7c1e(0x1aa),_0xb15f81[_0x4a7c1e(0x1b5)]=_0x4a7c1e(0x177),_0xb15f81[_0x4a7c1e(0x165)](_0x4a7c1e(0x1a7),_0x3418bb[_0x4a7c1e(0x1a5)]/0x2,_0x3418bb[_0x4a7c1e(0x1ad)]/0x2+0x14);const _0x3c202f=Date['now']()/0x3e8;for(let _0x163b5a=0x0;_0x163b5a<0x3;_0x163b5a++){const _0x2301bf=(Math[_0x4a7c1e(0x154)](_0x3c202f*0x2+_0x163b5a*0.5)+0x1)/0x2;_0xb15f81[_0x4a7c1e(0x12c)]=_0x4a7c1e(0x11e)+_0x2301bf*0.5+')',_0xb15f81['beginPath'](),_0xb15f81[_0x4a7c1e(0x111)](_0x3418bb[_0x4a7c1e(0x1a5)]/0x2-0x28+_0x163b5a*0x28,_0x3418bb[_0x4a7c1e(0x1ad)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0xb15f81[_0x4a7c1e(0x161)]();}}[a6_0x32886b(0x1cf)](_0x6b45a2,_0x1ac1ee){const _0x422cfe=a6_0x32886b;try{if(!_0x6b45a2||!_0x1ac1ee)return;const _0x28fb1e=_0x1ac1ee[_0x422cfe(0x1a2)]('2d'),_0xae992e=_0x28fb1e[_0x422cfe(0x127)](0x0,0x0,_0x1ac1ee[_0x422cfe(0x1a5)],_0x1ac1ee['height']),_0x13b31a=this[_0x422cfe(0x133)](_0xae992e[_0x422cfe(0x14c)],_0x1ac1ee[_0x422cfe(0x1a5)],_0x1ac1ee[_0x422cfe(0x1ad)]),_0x32b733={'width':_0x1ac1ee[_0x422cfe(0x1a5)],'height':_0x1ac1ee[_0x422cfe(0x1ad)],'data':_0x13b31a};typeof _0x6b45a2[_0x422cfe(0x12a)]==='function'&&_0x6b45a2['onFrame'](_0x32b733);}catch(_0x1ccce7){console[_0x422cfe(0x196)]('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x1ccce7);}}[a6_0x32886b(0x133)](_0x83cdb6,_0x30dae0,_0x4872db){const _0x12fc3b=a6_0x32886b,_0x457846=_0x30dae0*_0x4872db,_0x4a9e2c=_0x30dae0*_0x4872db/0x4,_0x3633df=new Uint8Array(_0x457846+_0x4a9e2c*0x2);let _0x1a8ebd=0x0,_0x1b4860=_0x457846,_0x1c5256=_0x457846+_0x4a9e2c;for(let _0x4665e0=0x0;_0x4665e0<_0x4872db;_0x4665e0++){for(let _0x225969=0x0;_0x225969<_0x30dae0;_0x225969++){const _0x1a91e3=(_0x4665e0*_0x30dae0+_0x225969)*0x4,_0x3f6ed3=_0x83cdb6[_0x1a91e3],_0x30f3fd=_0x83cdb6[_0x1a91e3+0x1],_0x1dae51=_0x83cdb6[_0x1a91e3+0x2],_0x56f22c=Math[_0x12fc3b(0x185)](0.299*_0x3f6ed3+0.587*_0x30f3fd+0.114*_0x1dae51);_0x3633df[_0x1a8ebd++]=_0x56f22c;if(_0x4665e0%0x2===0x0&&_0x225969%0x2===0x0){const _0x56b007=Math[_0x12fc3b(0x185)](-0.169*_0x3f6ed3-0.331*_0x30f3fd+0.5*_0x1dae51+0x80),_0x134e27=Math[_0x12fc3b(0x185)](0.5*_0x3f6ed3-0.419*_0x30f3fd-0.081*_0x1dae51+0x80);_0x3633df[_0x1b4860++]=Math[_0x12fc3b(0x162)](0x0,Math[_0x12fc3b(0x1bc)](0xff,_0x56b007)),_0x3633df[_0x1c5256++]=Math['max'](0x0,Math[_0x12fc3b(0x1bc)](0xff,_0x134e27));}}}return _0x3633df;}async['updateCanvasWithImageData'](_0x197b81,_0x396359,_0x4e3a52,_0x38278d,_0x49e71b){const _0x540712=a6_0x32886b;try{if(!_0x4e3a52||!_0x4e3a52[_0x540712(0x14c)])return;Math[_0x540712(0x1c8)]()<0.01&&console[_0x540712(0x163)]('[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20'+_0x38278d+_0x540712(0x10d)+_0x4e3a52[_0x540712(0x14c)][_0x540712(0x143)]+_0x540712(0x1a3));const _0x3f5e73=Buffer[_0x540712(0x16b)](_0x4e3a52[_0x540712(0x14c)],'base64'),_0x1679b2=this[_0x540712(0x19f)][_0x540712(0x181)](_0x38278d);let _0x995018;_0x1679b2?_0x995018=await this[_0x540712(0x19f)][_0x540712(0x1a4)](_0x3f5e73,_0x197b81,_0x396359,_0x38278d):_0x995018=await this[_0x540712(0x19f)][_0x540712(0x1c1)](_0x3f5e73,_0x197b81,_0x396359),_0x396359[_0x540712(0x18b)](_0x995018,0x0,0x0),_0x396359[_0x540712(0x12c)]='rgba(0,\x200,\x200,\x200.7)',_0x396359[_0x540712(0x18e)](0xa,0xa,0xdc,0x32),_0x396359[_0x540712(0x12c)]=_0x1679b2?_0x540712(0x1c7):_0x540712(0x1ab),_0x396359[_0x540712(0x1b5)]='12px\x20monospace',_0x396359[_0x540712(0x165)]((_0x1679b2?_0x540712(0x114):_0x540712(0x17a))+':\x20'+new Date()[_0x540712(0x18d)](),0xf,0x1c),_0x396359[_0x540712(0x12c)]=_0x540712(0x1aa),_0x396359[_0x540712(0x1b5)]=_0x540712(0x166),_0x396359[_0x540712(0x165)](_0x540712(0x14e)+_0x38278d['split']('/')[_0x540712(0x153)](),0xf,0x2d),this[_0x540712(0x1cf)](_0x49e71b,_0x197b81);}catch(_0x5a5034){console[_0x540712(0x171)](_0x540712(0x125)+_0x38278d+':',_0x5a5034['message']);_0x38278d[_0x540712(0x172)]('depth')&&Math[_0x540712(0x1c8)]()<0.1&&console['warn']('[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20'+_0x38278d['replace']('/compressedDepth',_0x540712(0x194)));_0x396359[_0x540712(0x12c)]=_0x540712(0x138),_0x396359[_0x540712(0x18e)](0x0,0x0,_0x197b81[_0x540712(0x1a5)],_0x197b81[_0x540712(0x1ad)]),_0x396359['fillStyle']='#888',_0x396359[_0x540712(0x1b5)]='16px\x20Arial',_0x396359[_0x540712(0x126)]=_0x540712(0x1c5);const _0x42c68d=_0x38278d[_0x540712(0x172)](_0x540712(0x10c))?_0x540712(0x198):'ðŸ“¹\x20Processing\x20video...';_0x396359['fillText'](_0x42c68d,_0x197b81[_0x540712(0x1a5)]/0x2,_0x197b81['height']/0x2),_0x396359[_0x540712(0x12c)]=_0x540712(0x18f),_0x396359[_0x540712(0x1b5)]='12px\x20Arial',_0x396359[_0x540712(0x165)](_0x540712(0x14e)+_0x38278d['split']('/')[_0x540712(0x153)](),_0x197b81[_0x540712(0x1a5)]/0x2,_0x197b81[_0x540712(0x1ad)]/0x2+0x19),this[_0x540712(0x1cf)](_0x49e71b,_0x197b81);}}[a6_0x32886b(0x15e)](_0x4ed39f){const _0x755e19=a6_0x32886b,_0xa40c73=this[_0x755e19(0x182)][_0x755e19(0x17d)](_0x4ed39f);if(!_0xa40c73){console[_0x755e19(0x171)]('[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20'+_0x4ed39f);return;}console[_0x755e19(0x163)](_0x755e19(0x1be)+_0x4ed39f+'\x20for\x20topic:\x20'+_0xa40c73['topic']);try{this[_0x755e19(0x13d)]&&this['serverWs'][_0x755e19(0x142)]===this['serverWs'][_0x755e19(0x115)]&&this[_0x755e19(0x13d)][_0x755e19(0x141)](JSON[_0x755e19(0x14f)]({'op':'webrtc_stop_session','session_id':_0x4ed39f})),_0xa40c73[_0x755e19(0x1cb)]&&_0xa40c73[_0x755e19(0x1cb)][_0x755e19(0x1c9)](),_0xa40c73[_0x755e19(0x17e)]&&_0xa40c73[_0x755e19(0x17e)][_0x755e19(0x10f)]();}catch(_0x3001bc){console[_0x755e19(0x196)](_0x755e19(0x1bb)+_0x3001bc);}this[_0x755e19(0x176)](_0x4ed39f);}[a6_0x32886b(0x176)](_0x24fb31){const _0xd1e017=a6_0x32886b,_0x21c157=this[_0xd1e017(0x182)][_0xd1e017(0x17d)](_0x24fb31);if(_0x21c157){const _0x2687b8=this['topicSessions'][_0xd1e017(0x17d)](_0x21c157[_0xd1e017(0x132)]);_0x2687b8&&(_0x2687b8['delete'](_0x24fb31),_0x2687b8[_0xd1e017(0x168)]===0x0&&this[_0xd1e017(0x11c)][_0xd1e017(0x1d3)](_0x21c157[_0xd1e017(0x132)])),this[_0xd1e017(0x11f)](_0x21c157[_0xd1e017(0x132)]);}this[_0xd1e017(0x182)][_0xd1e017(0x1d3)](_0x24fb31),console[_0xd1e017(0x163)](_0xd1e017(0x144)+_0x24fb31);}[a6_0x32886b(0x1ae)](){const _0x3d2478=a6_0x32886b;console['log']('[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions');const _0x3bc7b5=Array[_0x3d2478(0x16b)](this['activeSessions'][_0x3d2478(0x16a)]());_0x3bc7b5[_0x3d2478(0x19c)](_0x20feaf=>this[_0x3d2478(0x15e)](_0x20feaf));}[a6_0x32886b(0x178)](){const _0x5a2117=a6_0x32886b,_0x4be775=[];for(const [_0x55ef4e,_0xe01963]of this[_0x5a2117(0x182)]){_0x4be775[_0x5a2117(0x123)]({'sessionId':_0x55ef4e,'topic':_0xe01963[_0x5a2117(0x132)],'connectionState':_0xe01963[_0x5a2117(0x17e)]?.[_0x5a2117(0x1d0)]||'unknown','hasVideoTrack':!!_0xe01963[_0x5a2117(0x1cb)]});}return _0x4be775;}[a6_0x32886b(0x19b)](){const _0x4c8816=a6_0x32886b,_0x258fbb=[];for(const [_0x4cd910,_0x2da58c]of this['sharedVideoSources']){_0x258fbb[_0x4c8816(0x123)]({'topic':_0x4cd910,'frameCount':_0x2da58c[_0x4c8816(0x140)],'hasVideoSource':!!_0x2da58c[_0x4c8816(0x16c)],'hasRosSubscriber':!!_0x2da58c[_0x4c8816(0x118)]});}return _0x258fbb;}}module['exports']=new ApplianceWebRTCService();