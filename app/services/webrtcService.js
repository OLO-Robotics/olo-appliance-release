const a6_0x420910=a6_0x1cf0;(function(_0x330a02,_0x40219a){const _0x271cad=a6_0x1cf0,_0xe28d51=_0x330a02();while(!![]){try{const _0xc1f8e4=-parseInt(_0x271cad(0x9e))/0x1*(-parseInt(_0x271cad(0x93))/0x2)+parseInt(_0x271cad(0x10c))/0x3+-parseInt(_0x271cad(0x8e))/0x4+-parseInt(_0x271cad(0xac))/0x5*(parseInt(_0x271cad(0xa3))/0x6)+-parseInt(_0x271cad(0xb8))/0x7*(parseInt(_0x271cad(0xf2))/0x8)+parseInt(_0x271cad(0x132))/0x9*(-parseInt(_0x271cad(0xfd))/0xa)+parseInt(_0x271cad(0x11e))/0xb;if(_0xc1f8e4===_0x40219a)break;else _0xe28d51['push'](_0xe28d51['shift']());}catch(_0x5950a8){_0xe28d51['push'](_0xe28d51['shift']());}}}(a6_0xbf0e,0xe756e));const a6_0x476dc4=(function(){let _0x5345c3=!![];return function(_0x11615e,_0x21deb1){const _0x4b127d=_0x5345c3?function(){const _0x4155af=a6_0x1cf0;if(_0x21deb1){const _0x436deb=_0x21deb1[_0x4155af(0x11c)](_0x11615e,arguments);return _0x21deb1=null,_0x436deb;}}:function(){};return _0x5345c3=![],_0x4b127d;};}()),a6_0x50c44b=a6_0x476dc4(this,function(){const _0x54e21b=a6_0x1cf0;return a6_0x50c44b[_0x54e21b(0x10b)]()['search'](_0x54e21b(0x87))['toString']()[_0x54e21b(0x11a)](a6_0x50c44b)[_0x54e21b(0xba)]('(((.+)+)+)+$');});function a6_0xbf0e(){const _0x2d85da=['depthProcessor','topicSessions','frameCount','rosSubscriber','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','/9j/','initialize','ðŸ¤–\x20Robot\x20Camera','color','constructor','framerate','apply','videoTrack','24086876OgjxyL','videoSource','\x20successfully\x20connected!','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','base64','width','handleMessage','type','12px\x20monospace','fillText','\x20sessions\x20remaining)','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','serverWs','\x20detected\x20as\x20','iceServers','sensor_msgs/msg/CompressedImage','onconnectionstatechange','startsWith','center','webrtc_stop_session','99jMakFh','topic','Waiting\x20for\x20ROS\x20image\x20data...','get','compressedDepth','updateCanvasWithImageData','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','rtcConfig','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','\x20connection\x20state:\x20','#1a1a1a','fillStyle','createAnswer','canvas','arc','from','sensor_msgs/CompressedImage','connectionState','webrtc_offer','initializing','rosbridgeWs','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:',',\x20converting\x20to\x20base64...','activeSessions','depth','readyState','has','sensor_msgs/Image','addTrack','sensor_msgs/msg/Image','max','function','setRemoteDescription','delete','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','cleanupSession','webrtc','textAlign','(((.+)+)+)+$','error','subscribeToROSTopic','warn','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','split','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','1535060WSgaif','log','message','[WebRTC\x20Appliance]\x20Created\x20answer','parse','28Nvbsbz','includes','webrtc_answer','round','port','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','send','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','85034VpDdIY','fill','releaseSharedVideoSource','subscribe','onicecandidate','12noqfBk','webrtc_init_session','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','data','push','#ffffff','rgba(0,\x20170,\x20255,\x20','sin','[WebRTC\x20Appliance]\x20Service\x20initialized','1510825BewMEG','removeEventListener','setLocalDescription','getImageData','beginPath','stun:stun.l.google.com:19302','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','/image','unknown','unsubscribe','size','getIceServers','138117UfJcCq','getOrCreateSharedVideoSource','search','convertRGBAtoI420','session_id','ðŸ“¹\x20Processing\x20video...','compressed','processColorImage','getActiveSessions','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','pop','ðŸ”\x20Depth','Topic:\x20','webrtc_ice_candidate','random','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','msg','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','16px\x20Arial','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','font','drawLoadingPattern','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','sharp','compressed_depth_image_transport/CompressedDepthImage','min','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','stopSession','initializeSession','/image_raw','handleOffer','onFrame','ðŸ”\x20Processing\x20depth...','updateTurnCredentials','candidate','addEventListener','sendFrameToVideoSource','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','rgba(0,\x200,\x200,\x200.7)','now','sharedVideoSources','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','\x20with\x20message\x20type\x20','OPEN','\x20image,\x20trying\x20message\x20types:','stopAllSessions','#00aaff','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','/compressedDepth','connected','offer','isDepthTopic','\x20connection\x20failed,\x20stopping\x20session','replace','fillRect','processDepthImage','[WebRTC\x20Appliance]\x20Topic\x20','set','488emPaUn','../config','putImageData','stringify','publish','height','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','getContext','wrtc','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','stun:stun1.l.google.com:19302','274310OJPeTs','getSharedVideoSources','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','peerConnection','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Session\x20','handleIceCandidate','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers',',\x20cleaning\x20up\x20shared\x20resources','video','\x20sessions)','/compressed','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','toString','182403pJmPHQ','failed','addIceCandidate','address','ðŸ“¹\x20Color'];a6_0xbf0e=function(){return _0x2d85da;};return a6_0xbf0e();}a6_0x50c44b();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x420910(0xfa)),sharp=require(a6_0x420910(0xcf)),config=require(a6_0x420910(0xf3)),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require('./turnCredentialsService');function a6_0x1cf0(_0x57a576,_0x32b808){const _0xec1d64=a6_0xbf0e();return a6_0x1cf0=function(_0x50c44b,_0x476dc4){_0x50c44b=_0x50c44b-0x68;let _0xbf0efb=_0xec1d64[_0x50c44b];return _0xbf0efb;},a6_0x1cf0(_0x57a576,_0x32b808);}class ApplianceWebRTCService{constructor(){const _0x5e7dd7=a6_0x420910;this[_0x5e7dd7(0x78)]=new Map(),this['topicSessions']=new Map(),this['sharedVideoSources']=new Map(),this[_0x5e7dd7(0x75)]=null,this[_0x5e7dd7(0x12a)]=null,this['depthProcessor']=new DepthImageProcessor(),this['rtcConfig']={'iceServers':[{'urls':_0x5e7dd7(0xb1)},{'urls':_0x5e7dd7(0xfc)}]};}['initialize'](_0x5d1278,_0x446e39){const _0x5380a4=a6_0x420910;this[_0x5380a4(0x75)]=_0x5d1278,this[_0x5380a4(0x12a)]=_0x446e39,turnCredentialsService[_0x5380a4(0x117)](config['serverUrl']),this[_0x5380a4(0xd9)](),console[_0x5380a4(0x8f)](_0x5380a4(0xab));}async[a6_0x420910(0xd9)](){const _0x3e5b99=a6_0x420910;try{console[_0x3e5b99(0x8f)]('[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...');const _0x4a71a9=await turnCredentialsService[_0x3e5b99(0xb7)]();this[_0x3e5b99(0x68)][_0x3e5b99(0x12c)]=_0x4a71a9,console[_0x3e5b99(0x8f)](_0x3e5b99(0xb2));}catch(_0x2a8b6c){console[_0x3e5b99(0x88)](_0x3e5b99(0x76),_0x2a8b6c),console[_0x3e5b99(0x8f)](_0x3e5b99(0x104));}}[a6_0x420910(0x124)](_0x35da5b){const _0x533cb7=a6_0x420910;if(!_0x35da5b['op']||!_0x35da5b['op'][_0x533cb7(0x12f)]('webrtc_'))return![];console[_0x533cb7(0x8f)]('[WebRTC\x20Appliance]\x20Handling\x20message:\x20'+_0x35da5b['op']);switch(_0x35da5b['op']){case _0x533cb7(0xa4):this[_0x533cb7(0xd4)](_0x35da5b[_0x533cb7(0xbc)],_0x35da5b[_0x533cb7(0x133)]);return!![];case _0x533cb7(0x73):this['handleOffer'](_0x35da5b[_0x533cb7(0xbc)],_0x35da5b[_0x533cb7(0xea)]);return!![];case _0x533cb7(0xc5):this['handleIceCandidate'](_0x35da5b[_0x533cb7(0xbc)],_0x35da5b['candidate']);return!![];case _0x533cb7(0x131):this[_0x533cb7(0xd3)](_0x35da5b[_0x533cb7(0xbc)]);return!![];default:console['warn'](_0x533cb7(0xc7)+_0x35da5b['op']);return![];}}[a6_0x420910(0xb9)](_0x2f44f6){const _0x2175f4=a6_0x420910;if(this[_0x2175f4(0xe0)]['has'](_0x2f44f6)){const _0x32fcf5=this[_0x2175f4(0xe0)]['get'](_0x2f44f6);return _0x32fcf5['frameCount']++,console[_0x2175f4(0x8f)]('[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x2f44f6+'\x20('+_0x32fcf5['frameCount']+_0x2175f4(0x107)),_0x32fcf5;}console['log'](_0x2175f4(0x9a)+_0x2f44f6);const {createCanvas:_0x15fe0c}=require(_0x2175f4(0x6e)),_0x4c4632=_0x15fe0c(config[_0x2175f4(0x85)][_0x2175f4(0x106)][_0x2175f4(0x123)],config[_0x2175f4(0x85)][_0x2175f4(0x106)][_0x2175f4(0xf7)]),_0x389429=_0x4c4632[_0x2175f4(0xf9)]('2d');this['drawLoadingPattern'](_0x4c4632,_0x389429);const {RTCVideoSource:_0x469972}=nonstandard,_0x5b965e=new _0x469972();let _0x5685d7=0x0;const _0x7fccf8=0x3e8/config['webrtc'][_0x2175f4(0x106)][_0x2175f4(0x11b)],_0x1657ea=this[_0x2175f4(0x89)](_0x2f44f6,_0x125d60=>{const _0x40734e=_0x2175f4,_0x25baa7=Date[_0x40734e(0xdf)]();_0x25baa7-_0x5685d7>=_0x7fccf8&&(_0x5685d7=_0x25baa7,this[_0x40734e(0x137)](_0x4c4632,_0x389429,_0x125d60,_0x2f44f6,_0x5b965e));}),_0x2f1cd0={'videoSource':_0x5b965e,'canvas':_0x4c4632,'rosSubscriber':_0x1657ea,'frameCount':0x1,'topic':_0x2f44f6};return this[_0x2175f4(0xe0)][_0x2175f4(0xf1)](_0x2f44f6,_0x2f1cd0),_0x2f1cd0;}[a6_0x420910(0xa0)](_0x1d1701){const _0x2ac122=a6_0x420910,_0x10f9fb=this[_0x2ac122(0xe0)][_0x2ac122(0x135)](_0x1d1701);if(!_0x10f9fb)return;_0x10f9fb[_0x2ac122(0x113)]--,console[_0x2ac122(0x8f)](_0x2ac122(0x69)+_0x1d1701+'\x20('+_0x10f9fb[_0x2ac122(0x113)]+_0x2ac122(0x128)),_0x10f9fb[_0x2ac122(0x113)]<=0x0&&(console[_0x2ac122(0x8f)](_0x2ac122(0xf8)+_0x1d1701+_0x2ac122(0x105)),_0x10f9fb[_0x2ac122(0x11f)]&&(_0x10f9fb[_0x2ac122(0x11f)]=null),_0x10f9fb[_0x2ac122(0x114)]&&_0x10f9fb[_0x2ac122(0x114)][_0x2ac122(0xb5)](),this[_0x2ac122(0xe0)][_0x2ac122(0x82)](_0x1d1701));}async[a6_0x420910(0xd4)](_0x4ff319,_0x4fd387){const _0x11f3d6=a6_0x420910;try{console[_0x11f3d6(0x8f)]('[WebRTC\x20Appliance]\x20Initializing\x20session\x20'+_0x4ff319+'\x20for\x20topic\x20'+_0x4fd387);const _0x3325d8=this[_0x11f3d6(0xb9)](_0x4fd387),_0x3eb49b=new RTCPeerConnection(this['rtcConfig']),_0x2d466a=_0x3325d8[_0x11f3d6(0x11f)]['createTrack']({'width':config['webrtc'][_0x11f3d6(0x106)]['width'],'height':config[_0x11f3d6(0x85)][_0x11f3d6(0x106)][_0x11f3d6(0xf7)],'framerate':config[_0x11f3d6(0x85)][_0x11f3d6(0x106)][_0x11f3d6(0x11b)]});console[_0x11f3d6(0x8f)](_0x11f3d6(0xd2)+_0x4ff319);const {MediaStream:_0xd42761}=require(_0x11f3d6(0xfa)),_0x589930=new _0xd42761([_0x2d466a]);_0x3eb49b[_0x11f3d6(0x7d)](_0x2d466a,_0x589930),this[_0x11f3d6(0xdc)](_0x3325d8[_0x11f3d6(0x11f)],_0x3325d8[_0x11f3d6(0x6e)]),_0x3eb49b[_0x11f3d6(0xa2)]=_0x4cbbb7=>{const _0x4adc8e=_0x11f3d6;if(_0x4cbbb7[_0x4adc8e(0xda)]&&this[_0x4adc8e(0x12a)])console[_0x4adc8e(0x8f)](_0x4adc8e(0x138)+_0x4ff319+':',{'type':_0x4cbbb7[_0x4adc8e(0xda)][_0x4adc8e(0x125)],'protocol':_0x4cbbb7[_0x4adc8e(0xda)]['protocol'],'address':_0x4cbbb7[_0x4adc8e(0xda)][_0x4adc8e(0x10f)],'port':_0x4cbbb7[_0x4adc8e(0xda)][_0x4adc8e(0x97)]}),this[_0x4adc8e(0x12a)]['send'](JSON[_0x4adc8e(0xf5)]({'op':_0x4adc8e(0xc5),'session_id':_0x4ff319,'candidate':_0x4cbbb7[_0x4adc8e(0xda)]}));else!_0x4cbbb7[_0x4adc8e(0xda)]&&console[_0x4adc8e(0x8f)](_0x4adc8e(0x115)+_0x4ff319);},_0x3eb49b[_0x11f3d6(0x12e)]=()=>{const _0x3023b2=_0x11f3d6;console[_0x3023b2(0x8f)](_0x3023b2(0x102)+_0x4ff319+_0x3023b2(0x6a)+_0x3eb49b[_0x3023b2(0x72)]);if(_0x3eb49b[_0x3023b2(0x72)]===_0x3023b2(0xe9))console[_0x3023b2(0x8f)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x4ff319+_0x3023b2(0x120));else{if(_0x3eb49b['connectionState']===_0x3023b2(0x10d))console[_0x3023b2(0x8f)](_0x3023b2(0x102)+_0x4ff319+_0x3023b2(0xec)),this[_0x3023b2(0xd3)](_0x4ff319);else _0x3eb49b[_0x3023b2(0x72)]==='closed'&&(console['log']('[WebRTC\x20Appliance]\x20Session\x20'+_0x4ff319+'\x20connection\x20closed,\x20cleaning\x20up'),this[_0x3023b2(0x84)](_0x4ff319));}},this[_0x11f3d6(0x78)][_0x11f3d6(0xf1)](_0x4ff319,{'peerConnection':_0x3eb49b,'topic':_0x4fd387,'videoTrack':_0x2d466a,'mediaStream':_0x589930,'status':_0x11f3d6(0x74)}),!this[_0x11f3d6(0x112)][_0x11f3d6(0x7b)](_0x4fd387)&&this[_0x11f3d6(0x112)][_0x11f3d6(0xf1)](_0x4fd387,new Set()),this[_0x11f3d6(0x112)][_0x11f3d6(0x135)](_0x4fd387)['add'](_0x4ff319),console['log'](_0x11f3d6(0x102)+_0x4ff319+'\x20initialized\x20successfully'),console['log'](_0x11f3d6(0x109)+_0x4fd387+':\x20'+this[_0x11f3d6(0x112)][_0x11f3d6(0x135)](_0x4fd387)[_0x11f3d6(0xb6)]);}catch(_0x5a07d9){console[_0x11f3d6(0x88)](_0x11f3d6(0xcb)+_0x4ff319+':',_0x5a07d9),this['stopSession'](_0x4ff319);}}async[a6_0x420910(0xd6)](_0xdd043f,_0x50a007){const _0x2336e9=a6_0x420910,_0x15689a=this[_0x2336e9(0x78)][_0x2336e9(0x135)](_0xdd043f);if(!_0x15689a){console[_0x2336e9(0x88)](_0x2336e9(0x129)+_0xdd043f);return;}try{console[_0x2336e9(0x8f)]('[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20'+_0xdd043f),await _0x15689a[_0x2336e9(0x100)][_0x2336e9(0x81)](new RTCSessionDescription(_0x50a007)),console[_0x2336e9(0x8f)]('[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)');const _0xce9b5e=await _0x15689a[_0x2336e9(0x100)][_0x2336e9(0x6d)]();console[_0x2336e9(0x8f)](_0x2336e9(0x91)),await _0x15689a[_0x2336e9(0x100)][_0x2336e9(0xae)](_0xce9b5e),console[_0x2336e9(0x8f)](_0x2336e9(0xff)),this[_0x2336e9(0x12a)]&&(this[_0x2336e9(0x12a)]['send'](JSON[_0x2336e9(0xf5)]({'op':_0x2336e9(0x95),'session_id':_0xdd043f,'answer':_0xce9b5e})),console[_0x2336e9(0x8f)](_0x2336e9(0x9d)+_0xdd043f));}catch(_0x435496){console[_0x2336e9(0x88)](_0x2336e9(0xc9)+_0xdd043f+':',_0x435496),this[_0x2336e9(0xd3)](_0xdd043f);}}async[a6_0x420910(0x103)](_0x515c22,_0x5a8c99){const _0x21322e=a6_0x420910,_0x4a925f=this[_0x21322e(0x78)]['get'](_0x515c22);if(!_0x4a925f){console['error']('[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20'+_0x515c22);return;}try{await _0x4a925f[_0x21322e(0x100)][_0x21322e(0x10e)](new RTCIceCandidate(_0x5a8c99)),console[_0x21322e(0x8f)](_0x21322e(0x121)+_0x515c22);}catch(_0x26abf7){console[_0x21322e(0x88)](_0x21322e(0x9c)+_0x515c22+':',_0x26abf7);}}[a6_0x420910(0x89)](_0x54c3f3,_0x311f5a){const _0x40ac29=a6_0x420910;if(!this[_0x40ac29(0x75)]||this[_0x40ac29(0x75)][_0x40ac29(0x7a)]!==this[_0x40ac29(0x75)][_0x40ac29(0xe3)])return console[_0x40ac29(0x88)]('[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected'),null;console[_0x40ac29(0x8f)](_0x40ac29(0x9b)+_0x54c3f3);const _0x22c1a8=_0x54c3f3[_0x40ac29(0x94)](_0x40ac29(0x79)),_0x28ff05=_0x54c3f3[_0x40ac29(0x94)](_0x40ac29(0xbe))||_0x54c3f3[_0x40ac29(0x94)](_0x40ac29(0x136));let _0x216c74=[];_0x22c1a8?_0x28ff05?_0x216c74=[_0x40ac29(0x71),_0x40ac29(0x12d),_0x40ac29(0xd0),_0x40ac29(0x7c)]:_0x216c74=[_0x40ac29(0x7c),_0x40ac29(0x7e),_0x40ac29(0x71)]:_0x216c74=[_0x40ac29(0x71),_0x40ac29(0x12d),'sensor_msgs/Image'];console[_0x40ac29(0x8f)](_0x40ac29(0xf0)+_0x54c3f3+_0x40ac29(0x12b)+(_0x22c1a8?'depth':_0x40ac29(0x119))+_0x40ac29(0xe4),_0x216c74);const _0x267509=[];let _0x51e3bc=![];const _0x21af23=_0x4d26a3=>{return _0x2385ed=>{const _0xed42b=a6_0x1cf0;try{const _0x47e627=JSON[_0xed42b(0x92)](_0x2385ed[_0xed42b(0xa6)]);_0x47e627['op']==='publish'&&_0x47e627[_0xed42b(0x133)]===_0x54c3f3&&_0x47e627[_0xed42b(0xc8)]&&(!_0x51e3bc&&(console['log'](_0xed42b(0xa5)+_0x54c3f3+_0xed42b(0xe2)+_0x4d26a3),_0x51e3bc=!![]),_0x311f5a(_0x47e627['msg']));}catch(_0x28d34a){console[_0xed42b(0x88)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x28d34a);}};};for(const _0x5682f5 of _0x216c74){const _0x57ffb9={'op':'subscribe','topic':_0x54c3f3,'type':_0x5682f5};console['log'](_0x40ac29(0xfb)+_0x5682f5),this['rosbridgeWs'][_0x40ac29(0x99)](JSON[_0x40ac29(0xf5)](_0x57ffb9));const _0x224f3e=_0x21af23(_0x5682f5);this[_0x40ac29(0x75)][_0x40ac29(0xdb)](_0x40ac29(0x90),_0x224f3e),_0x267509[_0x40ac29(0xa7)]({'handler':_0x224f3e,'type':_0x5682f5});}return _0x22c1a8&&_0x28ff05&&setTimeout(()=>{const _0x4546ad=_0x40ac29;if(!_0x51e3bc){console['log'](_0x4546ad(0x8d)+_0x54c3f3+',\x20trying\x20alternative\x20depth\x20topics');const _0x4d56cd=_0x54c3f3[_0x4546ad(0xed)](_0x4546ad(0xe8),'')['replace'](_0x4546ad(0x108),''),_0x95e965=[_0x4d56cd+_0x4546ad(0xd5),_0x4d56cd+_0x4546ad(0xb3),_0x4d56cd];for(const _0x292366 of _0x95e965){console[_0x4546ad(0x8f)](_0x4546ad(0xce)+_0x292366);const _0x2b7659={'op':_0x4546ad(0xa1),'topic':_0x292366,'type':_0x4546ad(0x7c)};this[_0x4546ad(0x75)]['send'](JSON[_0x4546ad(0xf5)](_0x2b7659));const _0x59d37d=_0x1b3cd0=>{const _0x5ff242=_0x4546ad;try{const _0x2ea207=JSON[_0x5ff242(0x92)](_0x1b3cd0[_0x5ff242(0xa6)]);_0x2ea207['op']===_0x5ff242(0xf6)&&_0x2ea207[_0x5ff242(0x133)]===_0x292366&&_0x2ea207[_0x5ff242(0xc8)]&&(console[_0x5ff242(0x8f)](_0x5ff242(0xe7)+_0x292366+_0x5ff242(0x77)),_0x2ea207[_0x5ff242(0xc8)][_0x5ff242(0xa6)]&&!_0x2ea207[_0x5ff242(0xc8)][_0x5ff242(0xa6)][_0x5ff242(0x12f)](_0x5ff242(0x116))&&_0x311f5a(_0x2ea207[_0x5ff242(0xc8)]));}catch(_0x2f0547){console[_0x5ff242(0x88)](_0x5ff242(0xe1),_0x2f0547);}};this['rosbridgeWs'][_0x4546ad(0xdb)](_0x4546ad(0x90),_0x59d37d),_0x267509[_0x4546ad(0xa7)]({'handler':_0x59d37d,'type':_0x4546ad(0x7c),'topic':_0x292366});}}},0xbb8),{'unsubscribe':()=>{const _0x4bce5e=_0x40ac29;for(const {handler:_0xc17b11,type:_0xf75919,topic:_0x2c4ba5}of _0x267509){this[_0x4bce5e(0x75)][_0x4bce5e(0xad)](_0x4bce5e(0x90),_0xc17b11),this['rosbridgeWs'][_0x4bce5e(0x7a)]===this[_0x4bce5e(0x75)]['OPEN']&&this[_0x4bce5e(0x75)]['send'](JSON['stringify']({'op':_0x4bce5e(0xb5),'topic':_0x2c4ba5||_0x54c3f3}));}}};}[a6_0x420910(0xcd)](_0x5eb34b,_0x2a821b){const _0x5a3ee4=a6_0x420910;_0x2a821b[_0x5a3ee4(0x6c)]=_0x5a3ee4(0x6b),_0x2a821b[_0x5a3ee4(0xee)](0x0,0x0,_0x5eb34b['width'],_0x5eb34b['height']),_0x2a821b[_0x5a3ee4(0x6c)]=_0x5a3ee4(0xe6),_0x2a821b[_0x5a3ee4(0xcc)]='24px\x20Arial',_0x2a821b[_0x5a3ee4(0x86)]=_0x5a3ee4(0x130),_0x2a821b['fillText'](_0x5a3ee4(0x118),_0x5eb34b[_0x5a3ee4(0x123)]/0x2,_0x5eb34b[_0x5a3ee4(0xf7)]/0x2-0x14),_0x2a821b[_0x5a3ee4(0x6c)]=_0x5a3ee4(0xa8),_0x2a821b[_0x5a3ee4(0xcc)]='16px\x20Arial',_0x2a821b[_0x5a3ee4(0x127)](_0x5a3ee4(0x134),_0x5eb34b[_0x5a3ee4(0x123)]/0x2,_0x5eb34b[_0x5a3ee4(0xf7)]/0x2+0x14);const _0xebcdc2=Date[_0x5a3ee4(0xdf)]()/0x3e8;for(let _0x58d737=0x0;_0x58d737<0x3;_0x58d737++){const _0x6f16b3=(Math[_0x5a3ee4(0xaa)](_0xebcdc2*0x2+_0x58d737*0.5)+0x1)/0x2;_0x2a821b['fillStyle']=_0x5a3ee4(0xa9)+_0x6f16b3*0.5+')',_0x2a821b[_0x5a3ee4(0xb0)](),_0x2a821b[_0x5a3ee4(0x6f)](_0x5eb34b[_0x5a3ee4(0x123)]/0x2-0x28+_0x58d737*0x28,_0x5eb34b[_0x5a3ee4(0xf7)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x2a821b[_0x5a3ee4(0x9f)]();}}[a6_0x420910(0xdc)](_0x289290,_0x3d6a4b){const _0x33ef9c=a6_0x420910;try{if(!_0x289290||!_0x3d6a4b)return;const _0x2c41e7=_0x3d6a4b['getContext']('2d'),_0xe0bce0=_0x2c41e7[_0x33ef9c(0xaf)](0x0,0x0,_0x3d6a4b[_0x33ef9c(0x123)],_0x3d6a4b[_0x33ef9c(0xf7)]),_0x2452bd=this[_0x33ef9c(0xbb)](_0xe0bce0[_0x33ef9c(0xa6)],_0x3d6a4b[_0x33ef9c(0x123)],_0x3d6a4b[_0x33ef9c(0xf7)]),_0x585409={'width':_0x3d6a4b[_0x33ef9c(0x123)],'height':_0x3d6a4b[_0x33ef9c(0xf7)],'data':_0x2452bd};typeof _0x289290['onFrame']===_0x33ef9c(0x80)&&_0x289290[_0x33ef9c(0xd7)](_0x585409);}catch(_0x43425c){console[_0x33ef9c(0x88)](_0x33ef9c(0x8b),_0x43425c);}}[a6_0x420910(0xbb)](_0x330fb5,_0x4669cd,_0x7d339b){const _0x4fceda=a6_0x420910,_0x9d3dd4=_0x4669cd*_0x7d339b,_0xf8d704=_0x4669cd*_0x7d339b/0x4,_0x1ea03a=new Uint8Array(_0x9d3dd4+_0xf8d704*0x2);let _0x54d9f6=0x0,_0x3e89f6=_0x9d3dd4,_0x125cde=_0x9d3dd4+_0xf8d704;for(let _0x2f8630=0x0;_0x2f8630<_0x7d339b;_0x2f8630++){for(let _0x460e22=0x0;_0x460e22<_0x4669cd;_0x460e22++){const _0x2c6436=(_0x2f8630*_0x4669cd+_0x460e22)*0x4,_0x47bf67=_0x330fb5[_0x2c6436],_0x48fd82=_0x330fb5[_0x2c6436+0x1],_0x2c06e6=_0x330fb5[_0x2c6436+0x2],_0x3709ba=Math[_0x4fceda(0x96)](0.299*_0x47bf67+0.587*_0x48fd82+0.114*_0x2c06e6);_0x1ea03a[_0x54d9f6++]=_0x3709ba;if(_0x2f8630%0x2===0x0&&_0x460e22%0x2===0x0){const _0x142f1=Math['round'](-0.169*_0x47bf67-0.331*_0x48fd82+0.5*_0x2c06e6+0x80),_0x5ecf12=Math[_0x4fceda(0x96)](0.5*_0x47bf67-0.419*_0x48fd82-0.081*_0x2c06e6+0x80);_0x1ea03a[_0x3e89f6++]=Math[_0x4fceda(0x7f)](0x0,Math[_0x4fceda(0xd1)](0xff,_0x142f1)),_0x1ea03a[_0x125cde++]=Math['max'](0x0,Math[_0x4fceda(0xd1)](0xff,_0x5ecf12));}}}return _0x1ea03a;}async[a6_0x420910(0x137)](_0x3c8ac0,_0x1301e1,_0x5c6327,_0x4974c6,_0x58856b){const _0x2efcb5=a6_0x420910;try{if(!_0x5c6327||!_0x5c6327['data'])return;Math[_0x2efcb5(0xc6)]()<0.01&&console[_0x2efcb5(0x8f)]('[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20'+_0x4974c6+',\x20size:\x20'+_0x5c6327[_0x2efcb5(0xa6)]['length']+'\x20bytes');const _0x19136c=Buffer[_0x2efcb5(0x70)](_0x5c6327[_0x2efcb5(0xa6)],_0x2efcb5(0x122)),_0x24bd49=this[_0x2efcb5(0x111)][_0x2efcb5(0xeb)](_0x4974c6);let _0x2f110e;_0x24bd49?_0x2f110e=await this['depthProcessor'][_0x2efcb5(0xef)](_0x19136c,_0x3c8ac0,_0x1301e1,_0x4974c6):_0x2f110e=await this[_0x2efcb5(0x111)][_0x2efcb5(0xbf)](_0x19136c,_0x3c8ac0,_0x1301e1),_0x1301e1[_0x2efcb5(0xf4)](_0x2f110e,0x0,0x0),_0x1301e1[_0x2efcb5(0x6c)]=_0x2efcb5(0xde),_0x1301e1['fillRect'](0xa,0xa,0xdc,0x32),_0x1301e1[_0x2efcb5(0x6c)]=_0x24bd49?'#00ffff':'#00ff00',_0x1301e1[_0x2efcb5(0xcc)]=_0x2efcb5(0x126),_0x1301e1[_0x2efcb5(0x127)]((_0x24bd49?_0x2efcb5(0xc3):_0x2efcb5(0x110))+':\x20'+new Date()['toLocaleTimeString'](),0xf,0x1c),_0x1301e1[_0x2efcb5(0x6c)]=_0x2efcb5(0xa8),_0x1301e1['font']='10px\x20monospace',_0x1301e1[_0x2efcb5(0x127)](_0x2efcb5(0xc4)+_0x4974c6[_0x2efcb5(0x8c)]('/')[_0x2efcb5(0xc2)](),0xf,0x2d),this[_0x2efcb5(0xdc)](_0x58856b,_0x3c8ac0);}catch(_0x409d0f){console[_0x2efcb5(0x8a)](_0x2efcb5(0x101)+_0x4974c6+':',_0x409d0f[_0x2efcb5(0x90)]);_0x4974c6[_0x2efcb5(0x94)](_0x2efcb5(0x79))&&Math['random']()<0.1&&console[_0x2efcb5(0x8a)](_0x2efcb5(0x83)+_0x4974c6['replace'](_0x2efcb5(0xe8),_0x2efcb5(0xd5)));_0x1301e1[_0x2efcb5(0x6c)]='#1a1a1a',_0x1301e1['fillRect'](0x0,0x0,_0x3c8ac0[_0x2efcb5(0x123)],_0x3c8ac0[_0x2efcb5(0xf7)]),_0x1301e1[_0x2efcb5(0x6c)]='#888',_0x1301e1[_0x2efcb5(0xcc)]=_0x2efcb5(0xca),_0x1301e1[_0x2efcb5(0x86)]=_0x2efcb5(0x130);const _0x3f47ef=_0x4974c6[_0x2efcb5(0x94)](_0x2efcb5(0x79))?_0x2efcb5(0xd8):_0x2efcb5(0xbd);_0x1301e1['fillText'](_0x3f47ef,_0x3c8ac0['width']/0x2,_0x3c8ac0[_0x2efcb5(0xf7)]/0x2),_0x1301e1['fillStyle']='#666',_0x1301e1['font']='12px\x20Arial',_0x1301e1[_0x2efcb5(0x127)](_0x2efcb5(0xc4)+_0x4974c6[_0x2efcb5(0x8c)]('/')['pop'](),_0x3c8ac0[_0x2efcb5(0x123)]/0x2,_0x3c8ac0[_0x2efcb5(0xf7)]/0x2+0x19),this[_0x2efcb5(0xdc)](_0x58856b,_0x3c8ac0);}}['stopSession'](_0x2ad4bb){const _0x5d69fb=a6_0x420910,_0x40e7da=this[_0x5d69fb(0x78)][_0x5d69fb(0x135)](_0x2ad4bb);if(!_0x40e7da){console[_0x5d69fb(0x8a)](_0x5d69fb(0x98)+_0x2ad4bb);return;}console[_0x5d69fb(0x8f)](_0x5d69fb(0x10a)+_0x2ad4bb+'\x20for\x20topic:\x20'+_0x40e7da[_0x5d69fb(0x133)]);try{this[_0x5d69fb(0x12a)]&&this[_0x5d69fb(0x12a)][_0x5d69fb(0x7a)]===this['serverWs'][_0x5d69fb(0xe3)]&&this['serverWs']['send'](JSON[_0x5d69fb(0xf5)]({'op':_0x5d69fb(0x131),'session_id':_0x2ad4bb})),_0x40e7da[_0x5d69fb(0x11d)]&&_0x40e7da['videoTrack']['stop'](),_0x40e7da[_0x5d69fb(0x100)]&&_0x40e7da[_0x5d69fb(0x100)]['close']();}catch(_0x1996b1){console['error'](_0x5d69fb(0xdd)+_0x1996b1);}this[_0x5d69fb(0x84)](_0x2ad4bb);}[a6_0x420910(0x84)](_0x4d7854){const _0x1eeff7=a6_0x420910,_0xe21f91=this[_0x1eeff7(0x78)][_0x1eeff7(0x135)](_0x4d7854);if(_0xe21f91){const _0xf16980=this[_0x1eeff7(0x112)][_0x1eeff7(0x135)](_0xe21f91[_0x1eeff7(0x133)]);_0xf16980&&(_0xf16980[_0x1eeff7(0x82)](_0x4d7854),_0xf16980[_0x1eeff7(0xb6)]===0x0&&this[_0x1eeff7(0x112)][_0x1eeff7(0x82)](_0xe21f91['topic'])),this[_0x1eeff7(0xa0)](_0xe21f91['topic']);}this[_0x1eeff7(0x78)][_0x1eeff7(0x82)](_0x4d7854),console[_0x1eeff7(0x8f)](_0x1eeff7(0xc1)+_0x4d7854);}[a6_0x420910(0xe5)](){const _0x1e47fd=a6_0x420910;console[_0x1e47fd(0x8f)]('[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions');const _0x4eb453=Array['from'](this['activeSessions']['keys']());_0x4eb453['forEach'](_0x1bc7f2=>this['stopSession'](_0x1bc7f2));}[a6_0x420910(0xc0)](){const _0x5a8eb8=a6_0x420910,_0x19f7c2=[];for(const [_0x36a457,_0x1bd3f4]of this[_0x5a8eb8(0x78)]){_0x19f7c2[_0x5a8eb8(0xa7)]({'sessionId':_0x36a457,'topic':_0x1bd3f4[_0x5a8eb8(0x133)],'connectionState':_0x1bd3f4[_0x5a8eb8(0x100)]?.[_0x5a8eb8(0x72)]||_0x5a8eb8(0xb4),'hasVideoTrack':!!_0x1bd3f4[_0x5a8eb8(0x11d)]});}return _0x19f7c2;}[a6_0x420910(0xfe)](){const _0x10ef55=a6_0x420910,_0x50d08e=[];for(const [_0x337420,_0x3014e6]of this[_0x10ef55(0xe0)]){_0x50d08e[_0x10ef55(0xa7)]({'topic':_0x337420,'frameCount':_0x3014e6[_0x10ef55(0x113)],'hasVideoSource':!!_0x3014e6[_0x10ef55(0x11f)],'hasRosSubscriber':!!_0x3014e6[_0x10ef55(0x114)]});}return _0x50d08e;}}module['exports']=new ApplianceWebRTCService();