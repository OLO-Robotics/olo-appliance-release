const a9_0x1e383c=a9_0x5df9;(function(_0x1e8699,_0x43aa48){const _0x97f65a=a9_0x5df9,_0x21efcd=_0x1e8699();while(!![]){try{const _0xf15a7d=-parseInt(_0x97f65a(0x25b))/0x1+-parseInt(_0x97f65a(0x1f3))/0x2*(parseInt(_0x97f65a(0x206))/0x3)+parseInt(_0x97f65a(0x1f5))/0x4+-parseInt(_0x97f65a(0x1fd))/0x5+-parseInt(_0x97f65a(0x29a))/0x6*(parseInt(_0x97f65a(0x246))/0x7)+-parseInt(_0x97f65a(0x261))/0x8*(parseInt(_0x97f65a(0x225))/0x9)+parseInt(_0x97f65a(0x1f1))/0xa*(parseInt(_0x97f65a(0x267))/0xb);if(_0xf15a7d===_0x43aa48)break;else _0x21efcd['push'](_0x21efcd['shift']());}catch(_0x5a8924){_0x21efcd['push'](_0x21efcd['shift']());}}}(a9_0x4b92,0xc7460));function a9_0x5df9(_0x5630a4,_0x3182c7){const _0x586401=a9_0x4b92();return a9_0x5df9=function(_0x518eae,_0x1215ca){_0x518eae=_0x518eae-0x1ec;let _0x4b920a=_0x586401[_0x518eae];return _0x4b920a;},a9_0x5df9(_0x5630a4,_0x3182c7);}const a9_0x1215ca=(function(){let _0x59c942=!![];return function(_0x189ad9,_0x4e92ac){const _0x2903dd=_0x59c942?function(){const _0x38d710=a9_0x5df9;if(_0x4e92ac){const _0x2817e6=_0x4e92ac[_0x38d710(0x256)](_0x189ad9,arguments);return _0x4e92ac=null,_0x2817e6;}}:function(){};return _0x59c942=![],_0x2903dd;};}()),a9_0x518eae=a9_0x1215ca(this,function(){const _0x21132b=a9_0x5df9;return a9_0x518eae[_0x21132b(0x247)]()['search'](_0x21132b(0x23e))[_0x21132b(0x247)]()[_0x21132b(0x2a2)](a9_0x518eae)[_0x21132b(0x283)](_0x21132b(0x23e));});a9_0x518eae();function a9_0x4b92(){const _0x22f6cd=['10px\x20monospace','#00aaff','./turnCredentialsService','getIceServers',',\x20cleaning\x20up\x20shared\x20resources','4618161prFWxQ','set','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','drawLoadingPattern','#666','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','fill','now','sharp','sensor_msgs/CompressedImage','exports','webrtc_offer','/image_raw','handleMessage','rosSubscriber','publish','port','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','ðŸ“¹\x20Processing\x20video...','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','onicecandidate','#1a1a1a','stopSession','(((.+)+)+)+$','Topic:\x20','sharedVideoSources','rtcConfig','replace','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','log','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','7LecsAq','toString','send','wrtc','updateCanvasWithImageData','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','protocol','createTrack','connectionState','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','min','cleanupSession','pop','createAnswer',',\x20trying\x20alternative\x20depth\x20topics','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','apply','webrtc_stop_session','sendFrameToVideoSource','video','topicSessions','1095506JBVLQZ','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','subscribeToROSTopic','framerate','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','ðŸ“¹\x20Color','8hZJDjS','updateTurnCredentials','warn','\x20connection\x20state:\x20','iceServers','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','4026nOkDOe','addIceCandidate','stun:stun.l.google.com:19302','offer','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','\x20sessions)','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','fillText','error','/image','canvas','delete','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','toLocaleTimeString','height','convertRGBAtoI420','sensor_msgs/msg/Image','rgba(0,\x20170,\x20255,\x20','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','candidate','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','unsubscribe','includes','stop','parse','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','webrtc_ice_candidate','frameCount','search','random','getContext','address','getImageData','#ffffff','\x20with\x20message\x20type\x20','size','readyState','depthProcessor','initializing','peerConnection','from','push','[WebRTC\x20Appliance]\x20Service\x20initialized','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','/compressedDepth','message','subscribe','serverWs','fillStyle','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','processColorImage','1611678rWqohm','color','removeEventListener','../config','[WebRTC\x20Appliance]\x20Topic\x20','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','\x20detected\x20as\x20','activeSessions','constructor','ðŸ”\x20Depth','has','ðŸ”\x20Processing\x20depth...','\x20connection\x20closed,\x20cleaning\x20up',',\x20size:\x20','startsWith','onFrame','depth','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','webrtc_init_session','max','add','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','width','#00ffff','addEventListener','\x20for\x20topic\x20','beginPath','\x20bytes','setRemoteDescription','\x20image,\x20trying\x20message\x20types:','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','handleOffer','failed','isDepthTopic','stringify','putImageData','center','ðŸ¤–\x20Robot\x20Camera','rosbridgeWs',',\x20converting\x20to\x20base64...','sin','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','107890LiYXsW','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','2438914ObfRWJ','closed','5646380fQNEJD','session_id','videoTrack','textAlign','stun:stun1.l.google.com:19302','unknown','12px\x20monospace','function','7237200VeiOjn','sensor_msgs/Image','sensor_msgs/msg/CompressedImage','initializeSession','split','24px\x20Arial','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','3oplAVD','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','msg','topic','releaseSharedVideoSource','[WebRTC\x20Appliance]\x20Created\x20answer','round','length','initialize','keys','webrtc_answer','get','Waiting\x20for\x20ROS\x20image\x20data...','compressedDepth','webrtc','videoSource','type','16px\x20Arial','OPEN','font','serverUrl','getOrCreateSharedVideoSource','#888','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','data','[WebRTC\x20Appliance]\x20Session\x20'];a9_0x4b92=function(){return _0x22f6cd;};return a9_0x4b92();}const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require('wrtc'),sharp=require(a9_0x1e383c(0x22e)),config=require(a9_0x1e383c(0x29d)),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require(a9_0x1e383c(0x222));class ApplianceWebRTCService{constructor(){const _0xa3e247=a9_0x1e383c;this[_0xa3e247(0x2a1)]=new Map(),this[_0xa3e247(0x25a)]=new Map(),this[_0xa3e247(0x240)]=new Map(),this[_0xa3e247(0x1ed)]=null,this[_0xa3e247(0x296)]=null,this[_0xa3e247(0x28c)]=new DepthImageProcessor(),this['rtcConfig']={'iceServers':[{'urls':_0xa3e247(0x269)},{'urls':_0xa3e247(0x1f9)}]};}[a9_0x1e383c(0x20e)](_0x18469a,_0x5f66db){const _0x65c8cb=a9_0x1e383c;this[_0x65c8cb(0x1ed)]=_0x18469a,this[_0x65c8cb(0x296)]=_0x5f66db,turnCredentialsService[_0x65c8cb(0x20e)](config[_0x65c8cb(0x21a)]),this[_0x65c8cb(0x262)](),console['log'](_0x65c8cb(0x291));}async[a9_0x1e383c(0x262)](){const _0x1ee0ef=a9_0x1e383c;try{console[_0x1ee0ef(0x244)](_0x1ee0ef(0x280));const _0x4ba0fd=await turnCredentialsService[_0x1ee0ef(0x223)]();this[_0x1ee0ef(0x241)][_0x1ee0ef(0x265)]=_0x4ba0fd,console[_0x1ee0ef(0x244)](_0x1ee0ef(0x21d));}catch(_0x4bd11f){console['error'](_0x1ee0ef(0x266),_0x4bd11f),console[_0x1ee0ef(0x244)](_0x1ee0ef(0x24b));}}[a9_0x1e383c(0x233)](_0x1f4d41){const _0x55f101=a9_0x1e383c;if(!_0x1f4d41['op']||!_0x1f4d41['op'][_0x55f101(0x2a8)]('webrtc_'))return![];console['log'](_0x55f101(0x298)+_0x1f4d41['op']);switch(_0x1f4d41['op']){case _0x55f101(0x2ac):this[_0x55f101(0x200)](_0x1f4d41[_0x55f101(0x1f6)],_0x1f4d41[_0x55f101(0x209)]);return!![];case _0x55f101(0x231):this['handleOffer'](_0x1f4d41['session_id'],_0x1f4d41[_0x55f101(0x26a)]);return!![];case'webrtc_ice_candidate':this['handleIceCandidate'](_0x1f4d41[_0x55f101(0x1f6)],_0x1f4d41[_0x55f101(0x27a)]);return!![];case'webrtc_stop_session':this[_0x55f101(0x23d)](_0x1f4d41[_0x55f101(0x1f6)]);return!![];default:console['warn'](_0x55f101(0x26d)+_0x1f4d41['op']);return![];}}['getOrCreateSharedVideoSource'](_0x2ad88a){const _0x227593=a9_0x1e383c;if(this[_0x227593(0x240)][_0x227593(0x2a4)](_0x2ad88a)){const _0x21f942=this[_0x227593(0x240)][_0x227593(0x211)](_0x2ad88a);return _0x21f942['frameCount']++,console[_0x227593(0x244)](_0x227593(0x227)+_0x2ad88a+'\x20('+_0x21f942['frameCount']+_0x227593(0x26c)),_0x21f942;}console[_0x227593(0x244)](_0x227593(0x25f)+_0x2ad88a);const {createCanvas:_0x2b525d}=require('canvas'),_0x5333f2=_0x2b525d(config[_0x227593(0x214)][_0x227593(0x259)][_0x227593(0x2b0)],config[_0x227593(0x214)][_0x227593(0x259)][_0x227593(0x275)]),_0x19adb5=_0x5333f2['getContext']('2d');this[_0x227593(0x228)](_0x5333f2,_0x19adb5);const {RTCVideoSource:_0x147c8d}=nonstandard,_0x29ef6c=new _0x147c8d();let _0x3d7368=0x0;const _0x1a278d=0x3e8/config['webrtc'][_0x227593(0x259)][_0x227593(0x25e)],_0x299e96=this[_0x227593(0x25d)](_0x2ad88a,_0x213ecf=>{const _0x4c11e8=_0x227593,_0x1cf227=Date[_0x4c11e8(0x22d)]();_0x1cf227-_0x3d7368>=_0x1a278d&&(_0x3d7368=_0x1cf227,this[_0x4c11e8(0x24a)](_0x5333f2,_0x19adb5,_0x213ecf,_0x2ad88a,_0x29ef6c));}),_0x1e9968={'videoSource':_0x29ef6c,'canvas':_0x5333f2,'rosSubscriber':_0x299e96,'frameCount':0x1,'topic':_0x2ad88a};return this[_0x227593(0x240)][_0x227593(0x226)](_0x2ad88a,_0x1e9968),_0x1e9968;}[a9_0x1e383c(0x20a)](_0x16ed2e){const _0xa175f8=a9_0x1e383c,_0x4c76aa=this[_0xa175f8(0x240)][_0xa175f8(0x211)](_0x16ed2e);if(!_0x4c76aa)return;_0x4c76aa['frameCount']--,console[_0xa175f8(0x244)](_0xa175f8(0x292)+_0x16ed2e+'\x20('+_0x4c76aa[_0xa175f8(0x282)]+'\x20sessions\x20remaining)'),_0x4c76aa[_0xa175f8(0x282)]<=0x0&&(console[_0xa175f8(0x244)](_0xa175f8(0x1f2)+_0x16ed2e+_0xa175f8(0x224)),_0x4c76aa[_0xa175f8(0x215)]&&(_0x4c76aa[_0xa175f8(0x215)]=null),_0x4c76aa[_0xa175f8(0x234)]&&_0x4c76aa[_0xa175f8(0x234)]['unsubscribe'](),this[_0xa175f8(0x240)][_0xa175f8(0x272)](_0x16ed2e));}async[a9_0x1e383c(0x200)](_0x2e9c55,_0x428e85){const _0x4f3e2d=a9_0x1e383c;try{console[_0x4f3e2d(0x244)](_0x4f3e2d(0x203)+_0x2e9c55+_0x4f3e2d(0x2b3)+_0x428e85);const _0x1166de=this[_0x4f3e2d(0x21b)](_0x428e85),_0x383720=new RTCPeerConnection(this[_0x4f3e2d(0x241)]),_0x221940=_0x1166de[_0x4f3e2d(0x215)][_0x4f3e2d(0x24d)]({'width':config[_0x4f3e2d(0x214)][_0x4f3e2d(0x259)][_0x4f3e2d(0x2b0)],'height':config[_0x4f3e2d(0x214)][_0x4f3e2d(0x259)]['height'],'framerate':config[_0x4f3e2d(0x214)][_0x4f3e2d(0x259)][_0x4f3e2d(0x25e)]});console['log'](_0x4f3e2d(0x273)+_0x2e9c55);const {MediaStream:_0x27274a}=require(_0x4f3e2d(0x249)),_0x33385d=new _0x27274a([_0x221940]);_0x383720['addTrack'](_0x221940,_0x33385d),this[_0x4f3e2d(0x258)](_0x1166de['videoSource'],_0x1166de[_0x4f3e2d(0x271)]),_0x383720[_0x4f3e2d(0x23b)]=_0xccf03f=>{const _0xf2163c=_0x4f3e2d;if(_0xccf03f[_0xf2163c(0x27a)]&&this[_0xf2163c(0x296)])console[_0xf2163c(0x244)]('[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20'+_0x2e9c55+':',{'type':_0xccf03f[_0xf2163c(0x27a)][_0xf2163c(0x216)],'protocol':_0xccf03f[_0xf2163c(0x27a)][_0xf2163c(0x24c)],'address':_0xccf03f[_0xf2163c(0x27a)][_0xf2163c(0x286)],'port':_0xccf03f['candidate'][_0xf2163c(0x236)]}),this[_0xf2163c(0x296)][_0xf2163c(0x248)](JSON[_0xf2163c(0x2bd)]({'op':_0xf2163c(0x281),'session_id':_0x2e9c55,'candidate':_0xccf03f[_0xf2163c(0x27a)]}));else!_0xccf03f[_0xf2163c(0x27a)]&&console[_0xf2163c(0x244)](_0xf2163c(0x207)+_0x2e9c55);},_0x383720['onconnectionstatechange']=()=>{const _0x58de7e=_0x4f3e2d;console[_0x58de7e(0x244)](_0x58de7e(0x21f)+_0x2e9c55+_0x58de7e(0x264)+_0x383720[_0x58de7e(0x24e)]);if(_0x383720['connectionState']==='connected')console[_0x58de7e(0x244)](_0x58de7e(0x21f)+_0x2e9c55+'\x20successfully\x20connected!');else{if(_0x383720[_0x58de7e(0x24e)]===_0x58de7e(0x2bb))console[_0x58de7e(0x244)](_0x58de7e(0x21f)+_0x2e9c55+'\x20connection\x20failed,\x20stopping\x20session'),this['stopSession'](_0x2e9c55);else _0x383720[_0x58de7e(0x24e)]===_0x58de7e(0x1f4)&&(console['log'](_0x58de7e(0x21f)+_0x2e9c55+_0x58de7e(0x2a6)),this[_0x58de7e(0x251)](_0x2e9c55));}},this[_0x4f3e2d(0x2a1)][_0x4f3e2d(0x226)](_0x2e9c55,{'peerConnection':_0x383720,'topic':_0x428e85,'videoTrack':_0x221940,'mediaStream':_0x33385d,'status':_0x4f3e2d(0x28d)}),!this[_0x4f3e2d(0x25a)][_0x4f3e2d(0x2a4)](_0x428e85)&&this[_0x4f3e2d(0x25a)]['set'](_0x428e85,new Set()),this[_0x4f3e2d(0x25a)]['get'](_0x428e85)[_0x4f3e2d(0x2ae)](_0x2e9c55),console[_0x4f3e2d(0x244)](_0x4f3e2d(0x21f)+_0x2e9c55+'\x20initialized\x20successfully'),console[_0x4f3e2d(0x244)](_0x4f3e2d(0x25c)+_0x428e85+':\x20'+this[_0x4f3e2d(0x25a)][_0x4f3e2d(0x211)](_0x428e85)[_0x4f3e2d(0x28a)]);}catch(_0xe7c728){console[_0x4f3e2d(0x26f)]('[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20'+_0x2e9c55+':',_0xe7c728),this['stopSession'](_0x2e9c55);}}async[a9_0x1e383c(0x2ba)](_0x5d5251,_0x1f0b73){const _0x183586=a9_0x1e383c,_0x4ee59b=this[_0x183586(0x2a1)]['get'](_0x5d5251);if(!_0x4ee59b){console[_0x183586(0x26f)](_0x183586(0x27b)+_0x5d5251);return;}try{console[_0x183586(0x244)](_0x183586(0x29f)+_0x5d5251),await _0x4ee59b['peerConnection'][_0x183586(0x2b6)](new RTCSessionDescription(_0x1f0b73)),console[_0x183586(0x244)](_0x183586(0x2ab));const _0x5e3084=await _0x4ee59b['peerConnection'][_0x183586(0x253)]();console['log'](_0x183586(0x20b)),await _0x4ee59b[_0x183586(0x28e)]['setLocalDescription'](_0x5e3084),console[_0x183586(0x244)](_0x183586(0x23a)),this[_0x183586(0x296)]&&(this[_0x183586(0x296)][_0x183586(0x248)](JSON[_0x183586(0x2bd)]({'op':_0x183586(0x210),'session_id':_0x5d5251,'answer':_0x5e3084})),console[_0x183586(0x244)]('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0x5d5251));}catch(_0xd54947){console[_0x183586(0x26f)](_0x183586(0x24f)+_0x5d5251+':',_0xd54947),this[_0x183586(0x23d)](_0x5d5251);}}async['handleIceCandidate'](_0x5eed27,_0x14acb3){const _0x44dc1e=a9_0x1e383c,_0x3f0df6=this[_0x44dc1e(0x2a1)]['get'](_0x5eed27);if(!_0x3f0df6){console[_0x44dc1e(0x26f)](_0x44dc1e(0x2b8)+_0x5eed27);return;}try{await _0x3f0df6[_0x44dc1e(0x28e)][_0x44dc1e(0x268)](new RTCIceCandidate(_0x14acb3)),console[_0x44dc1e(0x244)]('[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20'+_0x5eed27);}catch(_0x51bee6){console[_0x44dc1e(0x26f)]('[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20'+_0x5eed27+':',_0x51bee6);}}[a9_0x1e383c(0x25d)](_0x2f9fe7,_0x49df5c){const _0x2d540d=a9_0x1e383c;if(!this[_0x2d540d(0x1ed)]||this[_0x2d540d(0x1ed)]['readyState']!==this['rosbridgeWs'][_0x2d540d(0x218)])return console[_0x2d540d(0x26f)](_0x2d540d(0x237)),null;console[_0x2d540d(0x244)](_0x2d540d(0x2af)+_0x2f9fe7);const _0xb68705=_0x2f9fe7[_0x2d540d(0x27d)](_0x2d540d(0x2aa)),_0x143714=_0x2f9fe7[_0x2d540d(0x27d)]('compressed')||_0x2f9fe7[_0x2d540d(0x27d)](_0x2d540d(0x213));let _0x521e4a=[];_0xb68705?_0x143714?_0x521e4a=[_0x2d540d(0x22f),_0x2d540d(0x1ff),'compressed_depth_image_transport/CompressedDepthImage','sensor_msgs/Image']:_0x521e4a=[_0x2d540d(0x1fe),_0x2d540d(0x277),'sensor_msgs/CompressedImage']:_0x521e4a=['sensor_msgs/CompressedImage',_0x2d540d(0x1ff),_0x2d540d(0x1fe)];console[_0x2d540d(0x244)](_0x2d540d(0x29e)+_0x2f9fe7+_0x2d540d(0x2a0)+(_0xb68705?_0x2d540d(0x2aa):_0x2d540d(0x29b))+_0x2d540d(0x2b7),_0x521e4a);const _0x5b9dfb=[];let _0x5f23cd=![];const _0x4d1d52=_0x4b9215=>{return _0x5f3844=>{const _0x4c348a=a9_0x5df9;try{const _0x1ea78d=JSON[_0x4c348a(0x27f)](_0x5f3844[_0x4c348a(0x21e)]);_0x1ea78d['op']===_0x4c348a(0x235)&&_0x1ea78d[_0x4c348a(0x209)]===_0x2f9fe7&&_0x1ea78d['msg']&&(!_0x5f23cd&&(console[_0x4c348a(0x244)](_0x4c348a(0x22b)+_0x2f9fe7+_0x4c348a(0x289)+_0x4b9215),_0x5f23cd=!![]),_0x49df5c(_0x1ea78d[_0x4c348a(0x208)]));}catch(_0x5aaca9){console[_0x4c348a(0x26f)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x5aaca9);}};};for(const _0x4af763 of _0x521e4a){const _0x3b5af5={'op':_0x2d540d(0x295),'topic':_0x2f9fe7,'type':_0x4af763};console[_0x2d540d(0x244)](_0x2d540d(0x205)+_0x4af763),this[_0x2d540d(0x1ed)]['send'](JSON[_0x2d540d(0x2bd)](_0x3b5af5));const _0xfb3ca9=_0x4d1d52(_0x4af763);this[_0x2d540d(0x1ed)][_0x2d540d(0x2b2)]('message',_0xfb3ca9),_0x5b9dfb[_0x2d540d(0x290)]({'handler':_0xfb3ca9,'type':_0x4af763});}return _0xb68705&&_0x143714&&setTimeout(()=>{const _0x4a6f93=_0x2d540d;if(!_0x5f23cd){console[_0x4a6f93(0x244)](_0x4a6f93(0x26b)+_0x2f9fe7+_0x4a6f93(0x254));const _0x2ef68a=_0x2f9fe7[_0x4a6f93(0x242)](_0x4a6f93(0x293),'')[_0x4a6f93(0x242)]('/compressed',''),_0x256baa=[_0x2ef68a+_0x4a6f93(0x232),_0x2ef68a+_0x4a6f93(0x270),_0x2ef68a];for(const _0x583a7e of _0x256baa){console[_0x4a6f93(0x244)]('[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20'+_0x583a7e);const _0x197925={'op':_0x4a6f93(0x295),'topic':_0x583a7e,'type':_0x4a6f93(0x1fe)};this[_0x4a6f93(0x1ed)][_0x4a6f93(0x248)](JSON[_0x4a6f93(0x2bd)](_0x197925));const _0x3286ef=_0x5e0922=>{const _0x34c138=_0x4a6f93;try{const _0x5e72eb=JSON[_0x34c138(0x27f)](_0x5e0922[_0x34c138(0x21e)]);_0x5e72eb['op']===_0x34c138(0x235)&&_0x5e72eb['topic']===_0x583a7e&&_0x5e72eb[_0x34c138(0x208)]&&(console[_0x34c138(0x244)](_0x34c138(0x245)+_0x583a7e+_0x34c138(0x1ee)),_0x5e72eb[_0x34c138(0x208)]['data']&&!_0x5e72eb['msg'][_0x34c138(0x21e)]['startsWith']('/9j/')&&_0x49df5c(_0x5e72eb[_0x34c138(0x208)]));}catch(_0x18532f){console[_0x34c138(0x26f)](_0x34c138(0x279),_0x18532f);}};this['rosbridgeWs'][_0x4a6f93(0x2b2)](_0x4a6f93(0x294),_0x3286ef),_0x5b9dfb[_0x4a6f93(0x290)]({'handler':_0x3286ef,'type':_0x4a6f93(0x1fe),'topic':_0x583a7e});}}},0xbb8),{'unsubscribe':()=>{const _0x4ec27f=_0x2d540d;for(const {handler:_0x19f809,type:_0xb0b00,topic:_0x20a8ca}of _0x5b9dfb){this['rosbridgeWs'][_0x4ec27f(0x29c)](_0x4ec27f(0x294),_0x19f809),this[_0x4ec27f(0x1ed)][_0x4ec27f(0x28b)]===this[_0x4ec27f(0x1ed)][_0x4ec27f(0x218)]&&this[_0x4ec27f(0x1ed)][_0x4ec27f(0x248)](JSON[_0x4ec27f(0x2bd)]({'op':_0x4ec27f(0x27c),'topic':_0x20a8ca||_0x2f9fe7}));}}};}[a9_0x1e383c(0x228)](_0x3c31f2,_0x5f2226){const _0x551fb3=a9_0x1e383c;_0x5f2226['fillStyle']=_0x551fb3(0x23c),_0x5f2226['fillRect'](0x0,0x0,_0x3c31f2[_0x551fb3(0x2b0)],_0x3c31f2['height']),_0x5f2226[_0x551fb3(0x297)]=_0x551fb3(0x221),_0x5f2226[_0x551fb3(0x219)]=_0x551fb3(0x202),_0x5f2226['textAlign']=_0x551fb3(0x2bf),_0x5f2226[_0x551fb3(0x26e)](_0x551fb3(0x1ec),_0x3c31f2['width']/0x2,_0x3c31f2[_0x551fb3(0x275)]/0x2-0x14),_0x5f2226[_0x551fb3(0x297)]=_0x551fb3(0x288),_0x5f2226['font']=_0x551fb3(0x217),_0x5f2226[_0x551fb3(0x26e)](_0x551fb3(0x212),_0x3c31f2[_0x551fb3(0x2b0)]/0x2,_0x3c31f2[_0x551fb3(0x275)]/0x2+0x14);const _0x2870ae=Date[_0x551fb3(0x22d)]()/0x3e8;for(let _0x1aba35=0x0;_0x1aba35<0x3;_0x1aba35++){const _0x4f49a2=(Math[_0x551fb3(0x1ef)](_0x2870ae*0x2+_0x1aba35*0.5)+0x1)/0x2;_0x5f2226['fillStyle']=_0x551fb3(0x278)+_0x4f49a2*0.5+')',_0x5f2226[_0x551fb3(0x2b4)](),_0x5f2226['arc'](_0x3c31f2[_0x551fb3(0x2b0)]/0x2-0x28+_0x1aba35*0x28,_0x3c31f2[_0x551fb3(0x275)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x5f2226[_0x551fb3(0x22c)]();}}[a9_0x1e383c(0x258)](_0x35e312,_0x3c3c68){const _0x12f4f3=a9_0x1e383c;try{if(!_0x35e312||!_0x3c3c68)return;const _0x1d6549=_0x3c3c68[_0x12f4f3(0x285)]('2d'),_0x8884a8=_0x1d6549[_0x12f4f3(0x287)](0x0,0x0,_0x3c3c68[_0x12f4f3(0x2b0)],_0x3c3c68['height']),_0x59fb10=this[_0x12f4f3(0x276)](_0x8884a8['data'],_0x3c3c68[_0x12f4f3(0x2b0)],_0x3c3c68['height']),_0x39cf97={'width':_0x3c3c68[_0x12f4f3(0x2b0)],'height':_0x3c3c68['height'],'data':_0x59fb10};typeof _0x35e312[_0x12f4f3(0x2a9)]===_0x12f4f3(0x1fc)&&_0x35e312[_0x12f4f3(0x2a9)](_0x39cf97);}catch(_0x4af914){console[_0x12f4f3(0x26f)]('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x4af914);}}[a9_0x1e383c(0x276)](_0x310bd1,_0x502d97,_0x25e845){const _0x392fe9=a9_0x1e383c,_0x10c39f=_0x502d97*_0x25e845,_0x373a70=_0x502d97*_0x25e845/0x4,_0xa0b633=new Uint8Array(_0x10c39f+_0x373a70*0x2);let _0x541252=0x0,_0x4af79d=_0x10c39f,_0x33248f=_0x10c39f+_0x373a70;for(let _0x4f1409=0x0;_0x4f1409<_0x25e845;_0x4f1409++){for(let _0x404bbb=0x0;_0x404bbb<_0x502d97;_0x404bbb++){const _0x447441=(_0x4f1409*_0x502d97+_0x404bbb)*0x4,_0x1724c9=_0x310bd1[_0x447441],_0x4e1645=_0x310bd1[_0x447441+0x1],_0x287eb4=_0x310bd1[_0x447441+0x2],_0x833d97=Math[_0x392fe9(0x20c)](0.299*_0x1724c9+0.587*_0x4e1645+0.114*_0x287eb4);_0xa0b633[_0x541252++]=_0x833d97;if(_0x4f1409%0x2===0x0&&_0x404bbb%0x2===0x0){const _0x5b3a5e=Math[_0x392fe9(0x20c)](-0.169*_0x1724c9-0.331*_0x4e1645+0.5*_0x287eb4+0x80),_0x325615=Math['round'](0.5*_0x1724c9-0.419*_0x4e1645-0.081*_0x287eb4+0x80);_0xa0b633[_0x4af79d++]=Math['max'](0x0,Math[_0x392fe9(0x250)](0xff,_0x5b3a5e)),_0xa0b633[_0x33248f++]=Math[_0x392fe9(0x2ad)](0x0,Math[_0x392fe9(0x250)](0xff,_0x325615));}}}return _0xa0b633;}async[a9_0x1e383c(0x24a)](_0x255144,_0x2c0207,_0x4dad6c,_0x54f4b8,_0x5eac93){const _0x5c7a88=a9_0x1e383c;try{if(!_0x4dad6c||!_0x4dad6c['data'])return;Math[_0x5c7a88(0x284)]()<0.01&&console['log']('[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20'+_0x54f4b8+_0x5c7a88(0x2a7)+_0x4dad6c[_0x5c7a88(0x21e)][_0x5c7a88(0x20d)]+_0x5c7a88(0x2b5));const _0x4ba2a8=Buffer[_0x5c7a88(0x28f)](_0x4dad6c['data'],'base64'),_0x173f31=this[_0x5c7a88(0x28c)][_0x5c7a88(0x2bc)](_0x54f4b8);let _0x1071f9;_0x173f31?_0x1071f9=await this['depthProcessor']['processDepthImage'](_0x4ba2a8,_0x255144,_0x2c0207,_0x54f4b8):_0x1071f9=await this[_0x5c7a88(0x28c)][_0x5c7a88(0x299)](_0x4ba2a8,_0x255144,_0x2c0207),_0x2c0207[_0x5c7a88(0x2be)](_0x1071f9,0x0,0x0),_0x2c0207[_0x5c7a88(0x297)]='rgba(0,\x200,\x200,\x200.7)',_0x2c0207['fillRect'](0xa,0xa,0xdc,0x32),_0x2c0207[_0x5c7a88(0x297)]=_0x173f31?_0x5c7a88(0x2b1):'#00ff00',_0x2c0207[_0x5c7a88(0x219)]=_0x5c7a88(0x1fb),_0x2c0207['fillText']((_0x173f31?_0x5c7a88(0x2a3):_0x5c7a88(0x260))+':\x20'+new Date()[_0x5c7a88(0x274)](),0xf,0x1c),_0x2c0207['fillStyle']=_0x5c7a88(0x288),_0x2c0207['font']=_0x5c7a88(0x220),_0x2c0207['fillText'](_0x5c7a88(0x23f)+_0x54f4b8[_0x5c7a88(0x201)]('/')[_0x5c7a88(0x252)](),0xf,0x2d),this[_0x5c7a88(0x258)](_0x5eac93,_0x255144);}catch(_0x4f48ea){console[_0x5c7a88(0x263)](_0x5c7a88(0x22a)+_0x54f4b8+':',_0x4f48ea[_0x5c7a88(0x294)]);_0x54f4b8[_0x5c7a88(0x27d)](_0x5c7a88(0x2aa))&&Math[_0x5c7a88(0x284)]()<0.1&&console[_0x5c7a88(0x263)](_0x5c7a88(0x255)+_0x54f4b8['replace'](_0x5c7a88(0x293),_0x5c7a88(0x232)));_0x2c0207[_0x5c7a88(0x297)]=_0x5c7a88(0x23c),_0x2c0207['fillRect'](0x0,0x0,_0x255144[_0x5c7a88(0x2b0)],_0x255144[_0x5c7a88(0x275)]),_0x2c0207[_0x5c7a88(0x297)]=_0x5c7a88(0x21c),_0x2c0207[_0x5c7a88(0x219)]=_0x5c7a88(0x217),_0x2c0207[_0x5c7a88(0x1f8)]='center';const _0x198c99=_0x54f4b8['includes']('depth')?_0x5c7a88(0x2a5):_0x5c7a88(0x239);_0x2c0207[_0x5c7a88(0x26e)](_0x198c99,_0x255144[_0x5c7a88(0x2b0)]/0x2,_0x255144['height']/0x2),_0x2c0207['fillStyle']=_0x5c7a88(0x229),_0x2c0207[_0x5c7a88(0x219)]='12px\x20Arial',_0x2c0207[_0x5c7a88(0x26e)]('Topic:\x20'+_0x54f4b8[_0x5c7a88(0x201)]('/')['pop'](),_0x255144['width']/0x2,_0x255144[_0x5c7a88(0x275)]/0x2+0x19),this['sendFrameToVideoSource'](_0x5eac93,_0x255144);}}[a9_0x1e383c(0x23d)](_0x430daf){const _0x5182ef=a9_0x1e383c,_0xae700b=this['activeSessions'][_0x5182ef(0x211)](_0x430daf);if(!_0xae700b){console[_0x5182ef(0x263)](_0x5182ef(0x2b9)+_0x430daf);return;}console[_0x5182ef(0x244)](_0x5182ef(0x1f0)+_0x430daf+'\x20for\x20topic:\x20'+_0xae700b[_0x5182ef(0x209)]);try{this[_0x5182ef(0x296)]&&this[_0x5182ef(0x296)][_0x5182ef(0x28b)]===this[_0x5182ef(0x296)]['OPEN']&&this[_0x5182ef(0x296)][_0x5182ef(0x248)](JSON[_0x5182ef(0x2bd)]({'op':_0x5182ef(0x257),'session_id':_0x430daf})),_0xae700b[_0x5182ef(0x1f7)]&&_0xae700b[_0x5182ef(0x1f7)][_0x5182ef(0x27e)](),_0xae700b[_0x5182ef(0x28e)]&&_0xae700b[_0x5182ef(0x28e)]['close']();}catch(_0x1ddb2e){console[_0x5182ef(0x26f)](_0x5182ef(0x243)+_0x1ddb2e);}this[_0x5182ef(0x251)](_0x430daf);}[a9_0x1e383c(0x251)](_0x209a57){const _0x23a058=a9_0x1e383c,_0x38b158=this[_0x23a058(0x2a1)][_0x23a058(0x211)](_0x209a57);if(_0x38b158){const _0x402d51=this[_0x23a058(0x25a)][_0x23a058(0x211)](_0x38b158['topic']);_0x402d51&&(_0x402d51[_0x23a058(0x272)](_0x209a57),_0x402d51[_0x23a058(0x28a)]===0x0&&this[_0x23a058(0x25a)][_0x23a058(0x272)](_0x38b158['topic'])),this['releaseSharedVideoSource'](_0x38b158[_0x23a058(0x209)]);}this['activeSessions']['delete'](_0x209a57),console[_0x23a058(0x244)](_0x23a058(0x238)+_0x209a57);}['stopAllSessions'](){const _0x161516=a9_0x1e383c;console[_0x161516(0x244)](_0x161516(0x204));const _0x2322ff=Array[_0x161516(0x28f)](this[_0x161516(0x2a1)][_0x161516(0x20f)]());_0x2322ff['forEach'](_0x57bddb=>this[_0x161516(0x23d)](_0x57bddb));}['getActiveSessions'](){const _0x3950e4=a9_0x1e383c,_0x43b3ca=[];for(const [_0x16cd31,_0x5dc74d]of this[_0x3950e4(0x2a1)]){_0x43b3ca['push']({'sessionId':_0x16cd31,'topic':_0x5dc74d[_0x3950e4(0x209)],'connectionState':_0x5dc74d[_0x3950e4(0x28e)]?.[_0x3950e4(0x24e)]||_0x3950e4(0x1fa),'hasVideoTrack':!!_0x5dc74d[_0x3950e4(0x1f7)]});}return _0x43b3ca;}['getSharedVideoSources'](){const _0x235cf1=a9_0x1e383c,_0x2f349f=[];for(const [_0x17bb8e,_0x5c7fd7]of this[_0x235cf1(0x240)]){_0x2f349f[_0x235cf1(0x290)]({'topic':_0x17bb8e,'frameCount':_0x5c7fd7[_0x235cf1(0x282)],'hasVideoSource':!!_0x5c7fd7[_0x235cf1(0x215)],'hasRosSubscriber':!!_0x5c7fd7[_0x235cf1(0x234)]});}return _0x2f349f;}}module[a9_0x1e383c(0x230)]=new ApplianceWebRTCService();