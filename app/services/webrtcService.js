const a6_0x184951=a6_0x4094;function a6_0x3a79(){const _0xa68e99=['fillRect','function','processDepthImage','textAlign','canvas','./DepthImageProcessor','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','unsubscribe','stringify','cleanupSession','pop','message','add','compressed','setLocalDescription','font','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','readyState','\x20bytes','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','sharedVideoSources','#00ffff','frameCount','16px\x20Arial','drawLoadingPattern','12px\x20Arial','\x20for\x20topic\x20','max','addEventListener','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','toLocaleTimeString','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','\x20image,\x20trying\x20message\x20types:','webrtc_stop_session','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','warn','Waiting\x20for\x20ROS\x20image\x20data...','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','/compressed','/image','1655391arwzfh','type','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','startsWith','onFrame','\x20with\x20message\x20type\x20','rosbridgeWs','publish','5207916hmPsOW','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','compressedDepth','data','depthProcessor','addTrack','rosSubscriber','sharp','videoSource','\x20sessions)','compressed_depth_image_transport/CompressedDepthImage','protocol','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','[WebRTC\x20Appliance]\x20Topic\x20','depth','includes','videoTrack','3121860PPBaye','video','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','./turnCredentialsService','center','putImageData','size','handleIceCandidate','parse','fillText','log','topic','error','#00aaff','offer','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20',',\x20size:\x20','length','initializing','topicSessions','unknown','[WebRTC\x20Appliance]\x20Created\x20answer','handleMessage','webrtc','iceServers','\x20connection\x20state:\x20','activeSessions','exports','stun:stun.l.google.com:19302','replace','32601150qpemWF','[WebRTC\x20Appliance]\x20Session\x20','peerConnection','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','sendFrameToVideoSource','rtcConfig','serverUrl','delete','createTrack','\x20detected\x20as\x20','webrtc_','serverWs','\x20connection\x20failed,\x20stopping\x20session','subscribe','msg','updateTurnCredentials',',\x20cleaning\x20up\x20shared\x20resources','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','webrtc_ice_candidate','subscribeToROSTopic','now','get','address','addIceCandidate','\x20successfully\x20connected!','#ffffff','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','random','beginPath','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','failed','toString','getOrCreateSharedVideoSource','269038ahPaNB','send','Topic:\x20','width','24px\x20Arial','/compressedDepth','10px\x20monospace','releaseSharedVideoSource','ðŸ¤–\x20Robot\x20Camera','sensor_msgs/msg/CompressedImage','/image_raw','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','stopAllSessions','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','convertRGBAtoI420','push','close','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','apply','initializeSession','connectionState','getContext','wrtc','session_id','\x20sessions\x20remaining)','split','stop','isDepthTopic','264661nTtmUu','ðŸ“¹\x20Processing\x20video...','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','candidate','OPEN','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','initialize','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','fillStyle','handleOffer','setRemoteDescription','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','round','rgba(0,\x200,\x200,\x200.7)','4iLrLxR','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','stopSession','from','rgba(0,\x20170,\x20255,\x20','48YNxacu','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','constructor','sensor_msgs/msg/Image','sensor_msgs/Image','getSharedVideoSources','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20',',\x20converting\x20to\x20base64...','height','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','1986822hBZNBO','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','createAnswer','updateCanvasWithImageData','min','has','onicecandidate','set','#1a1a1a','sensor_msgs/CompressedImage'];a6_0x3a79=function(){return _0xa68e99;};return a6_0x3a79();}(function(_0x481ab1,_0x3adc69){const _0x1a5f60=a6_0x4094,_0x35a44d=_0x481ab1();while(!![]){try{const _0x9cdeb0=-parseInt(_0x1a5f60(0xd8))/0x1+-parseInt(_0x1a5f60(0xf7))/0x2+parseInt(_0x1a5f60(0x129))/0x3*(-parseInt(_0x1a5f60(0xe8))/0x4)+-parseInt(_0x1a5f60(0x143))/0x5+-parseInt(_0x1a5f60(0x131))/0x6+-parseInt(_0x1a5f60(0x182))/0x7*(-parseInt(_0x1a5f60(0xed))/0x8)+parseInt(_0x1a5f60(0x161))/0x9;if(_0x9cdeb0===_0x3adc69)break;else _0x35a44d['push'](_0x35a44d['shift']());}catch(_0x2a8b40){_0x35a44d['push'](_0x35a44d['shift']());}}}(a6_0x3a79,0x86747));const a6_0x3acc54=(function(){let _0x579603=!![];return function(_0x2d25fd,_0x1e5e6e){const _0x41accd=_0x579603?function(){const _0x39b69a=a6_0x4094;if(_0x1e5e6e){const _0x303337=_0x1e5e6e[_0x39b69a(0x194)](_0x2d25fd,arguments);return _0x1e5e6e=null,_0x303337;}}:function(){};return _0x579603=![],_0x41accd;};}()),a6_0x31f5e2=a6_0x3acc54(this,function(){const _0x209956=a6_0x4094;return a6_0x31f5e2['toString']()['search']('(((.+)+)+)+$')[_0x209956(0x180)]()[_0x209956(0xef)](a6_0x31f5e2)['search']('(((.+)+)+)+$');});a6_0x31f5e2();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require('wrtc'),sharp=require(a6_0x184951(0x138)),config=require('../config'),DepthImageProcessor=require(a6_0x184951(0x106)),turnCredentialsService=require(a6_0x184951(0x146));class ApplianceWebRTCService{constructor(){const _0x556609=a6_0x184951;this['activeSessions']=new Map(),this[_0x556609(0x156)]=new Map(),this[_0x556609(0x115)]=new Map(),this[_0x556609(0x12f)]=null,this[_0x556609(0x16c)]=null,this[_0x556609(0x135)]=new DepthImageProcessor(),this[_0x556609(0x166)]={'iceServers':[{'urls':_0x556609(0x15f)},{'urls':'stun:stun1.l.google.com:19302'}]};}[a6_0x184951(0xde)](_0x341542,_0xc4c198){const _0x34423e=a6_0x184951;this['rosbridgeWs']=_0x341542,this[_0x34423e(0x16c)]=_0xc4c198,turnCredentialsService[_0x34423e(0xde)](config[_0x34423e(0x167)]),this['updateTurnCredentials'](),console['log']('[WebRTC\x20Appliance]\x20Service\x20initialized');}async[a6_0x184951(0x170)](){const _0x2472d4=a6_0x184951;try{console[_0x2472d4(0x14d)](_0x2472d4(0xe5));const _0x13dd8d=await turnCredentialsService['getIceServers']();this[_0x2472d4(0x166)][_0x2472d4(0x15b)]=_0x13dd8d,console[_0x2472d4(0x14d)](_0x2472d4(0x132));}catch(_0x39d90a){console['error']('[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:',_0x39d90a),console['log']('[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers');}}[a6_0x184951(0x159)](_0x5c4afe){const _0x4b345f=a6_0x184951;if(!_0x5c4afe['op']||!_0x5c4afe['op']['startsWith'](_0x4b345f(0x16b)))return![];console[_0x4b345f(0x14d)](_0x4b345f(0xdd)+_0x5c4afe['op']);switch(_0x5c4afe['op']){case'webrtc_init_session':this[_0x4b345f(0x195)](_0x5c4afe['session_id'],_0x5c4afe[_0x4b345f(0x14e)]);return!![];case'webrtc_offer':this[_0x4b345f(0xe3)](_0x5c4afe[_0x4b345f(0x199)],_0x5c4afe[_0x4b345f(0x151)]);return!![];case _0x4b345f(0x173):this[_0x4b345f(0x14a)](_0x5c4afe['session_id'],_0x5c4afe[_0x4b345f(0xdb)]);return!![];case _0x4b345f(0x122):this[_0x4b345f(0xea)](_0x5c4afe[_0x4b345f(0x199)]);return!![];default:console['warn'](_0x4b345f(0xdf)+_0x5c4afe['op']);return![];}}[a6_0x184951(0x181)](_0x1a940f){const _0x2643b4=a6_0x184951;if(this[_0x2643b4(0x115)]['has'](_0x1a940f)){const _0x358111=this['sharedVideoSources'][_0x2643b4(0x176)](_0x1a940f);return _0x358111[_0x2643b4(0x117)]++,console[_0x2643b4(0x14d)](_0x2643b4(0x13d)+_0x1a940f+'\x20('+_0x358111[_0x2643b4(0x117)]+_0x2643b4(0x13a)),_0x358111;}console[_0x2643b4(0x14d)](_0x2643b4(0x172)+_0x1a940f);const {createCanvas:_0x395b70}=require(_0x2643b4(0x105)),_0x3e77f7=_0x395b70(config[_0x2643b4(0x15a)]['video'][_0x2643b4(0x185)],config[_0x2643b4(0x15a)]['video'][_0x2643b4(0xf5)]),_0x78b92f=_0x3e77f7[_0x2643b4(0x197)]('2d');this[_0x2643b4(0x119)](_0x3e77f7,_0x78b92f);const {RTCVideoSource:_0x139c50}=nonstandard,_0x41b0a0=new _0x139c50();let _0x5b75c8=0x0;const _0x4de91e=0x3e8/config[_0x2643b4(0x15a)]['video']['framerate'],_0x29788e=this[_0x2643b4(0x174)](_0x1a940f,_0x2d43f4=>{const _0x2d1acd=_0x2643b4,_0x40c5c5=Date[_0x2d1acd(0x175)]();_0x40c5c5-_0x5b75c8>=_0x4de91e&&(_0x5b75c8=_0x40c5c5,this[_0x2d1acd(0xfa)](_0x3e77f7,_0x78b92f,_0x2d43f4,_0x1a940f,_0x41b0a0));}),_0x677e60={'videoSource':_0x41b0a0,'canvas':_0x3e77f7,'rosSubscriber':_0x29788e,'frameCount':0x1,'topic':_0x1a940f};return this[_0x2643b4(0x115)]['set'](_0x1a940f,_0x677e60),_0x677e60;}[a6_0x184951(0x189)](_0x4a5fd4){const _0x5220b9=a6_0x184951,_0x47b7c6=this['sharedVideoSources'][_0x5220b9(0x176)](_0x4a5fd4);if(!_0x47b7c6)return;_0x47b7c6[_0x5220b9(0x117)]--,console[_0x5220b9(0x14d)]('[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x4a5fd4+'\x20('+_0x47b7c6['frameCount']+_0x5220b9(0x19a)),_0x47b7c6[_0x5220b9(0x117)]<=0x0&&(console[_0x5220b9(0x14d)](_0x5220b9(0x164)+_0x4a5fd4+_0x5220b9(0x171)),_0x47b7c6['videoSource']&&(_0x47b7c6[_0x5220b9(0x139)]=null),_0x47b7c6[_0x5220b9(0x137)]&&_0x47b7c6[_0x5220b9(0x137)][_0x5220b9(0x108)](),this[_0x5220b9(0x115)][_0x5220b9(0x168)](_0x4a5fd4));}async['initializeSession'](_0x2b540e,_0x37e837){const _0x731752=a6_0x184951;try{console[_0x731752(0x14d)]('[WebRTC\x20Appliance]\x20Initializing\x20session\x20'+_0x2b540e+_0x731752(0x11b)+_0x37e837);const _0x4ae0c9=this[_0x731752(0x181)](_0x37e837),_0x1c2819=new RTCPeerConnection(this['rtcConfig']),_0x283d73=_0x4ae0c9[_0x731752(0x139)][_0x731752(0x169)]({'width':config['webrtc']['video']['width'],'height':config['webrtc'][_0x731752(0x144)][_0x731752(0xf5)],'framerate':config[_0x731752(0x15a)][_0x731752(0x144)]['framerate']});console[_0x731752(0x14d)](_0x731752(0xe0)+_0x2b540e);const {MediaStream:_0x142ac1}=require(_0x731752(0x198)),_0x5846c4=new _0x142ac1([_0x283d73]);_0x1c2819[_0x731752(0x136)](_0x283d73,_0x5846c4),this[_0x731752(0x165)](_0x4ae0c9['videoSource'],_0x4ae0c9[_0x731752(0x105)]),_0x1c2819[_0x731752(0xfd)]=_0x59877b=>{const _0x15793a=_0x731752;if(_0x59877b[_0x15793a(0xdb)]&&this['serverWs'])console[_0x15793a(0x14d)]('[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20'+_0x2b540e+':',{'type':_0x59877b[_0x15793a(0xdb)][_0x15793a(0x12a)],'protocol':_0x59877b[_0x15793a(0xdb)][_0x15793a(0x13c)],'address':_0x59877b[_0x15793a(0xdb)][_0x15793a(0x177)],'port':_0x59877b[_0x15793a(0xdb)]['port']}),this[_0x15793a(0x16c)][_0x15793a(0x183)](JSON['stringify']({'op':_0x15793a(0x173),'session_id':_0x2b540e,'candidate':_0x59877b[_0x15793a(0xdb)]}));else!_0x59877b[_0x15793a(0xdb)]&&console[_0x15793a(0x14d)](_0x15793a(0xe1)+_0x2b540e);},_0x1c2819['onconnectionstatechange']=()=>{const _0x37dee3=_0x731752;console[_0x37dee3(0x14d)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x2b540e+_0x37dee3(0x15c)+_0x1c2819[_0x37dee3(0x196)]);if(_0x1c2819[_0x37dee3(0x196)]==='connected')console[_0x37dee3(0x14d)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x2b540e+_0x37dee3(0x179));else{if(_0x1c2819['connectionState']===_0x37dee3(0x17f))console['log'](_0x37dee3(0x162)+_0x2b540e+_0x37dee3(0x16d)),this[_0x37dee3(0xea)](_0x2b540e);else _0x1c2819[_0x37dee3(0x196)]==='closed'&&(console[_0x37dee3(0x14d)](_0x37dee3(0x162)+_0x2b540e+'\x20connection\x20closed,\x20cleaning\x20up'),this[_0x37dee3(0x10a)](_0x2b540e));}},this['activeSessions'][_0x731752(0xfe)](_0x2b540e,{'peerConnection':_0x1c2819,'topic':_0x37e837,'videoTrack':_0x283d73,'mediaStream':_0x5846c4,'status':_0x731752(0x155)}),!this[_0x731752(0x156)][_0x731752(0xfc)](_0x37e837)&&this['topicSessions'][_0x731752(0xfe)](_0x37e837,new Set()),this[_0x731752(0x156)]['get'](_0x37e837)[_0x731752(0x10d)](_0x2b540e),console[_0x731752(0x14d)](_0x731752(0x162)+_0x2b540e+'\x20initialized\x20successfully'),console[_0x731752(0x14d)](_0x731752(0x126)+_0x37e837+':\x20'+this['topicSessions'][_0x731752(0x176)](_0x37e837)[_0x731752(0x149)]);}catch(_0x111854){console[_0x731752(0x14f)](_0x731752(0x152)+_0x2b540e+':',_0x111854),this['stopSession'](_0x2b540e);}}async[a6_0x184951(0xe3)](_0x6c0c5,_0x400300){const _0x402736=a6_0x184951,_0x358afe=this['activeSessions'][_0x402736(0x176)](_0x6c0c5);if(!_0x358afe){console['error'](_0x402736(0x107)+_0x6c0c5);return;}try{console[_0x402736(0x14d)](_0x402736(0xee)+_0x6c0c5),await _0x358afe['peerConnection'][_0x402736(0xe4)](new RTCSessionDescription(_0x400300)),console[_0x402736(0x14d)](_0x402736(0x120));const _0x235b20=await _0x358afe[_0x402736(0x163)][_0x402736(0xf9)]();console['log'](_0x402736(0x158)),await _0x358afe[_0x402736(0x163)][_0x402736(0x10f)](_0x235b20),console[_0x402736(0x14d)]('[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)'),this[_0x402736(0x16c)]&&(this[_0x402736(0x16c)][_0x402736(0x183)](JSON[_0x402736(0x109)]({'op':'webrtc_answer','session_id':_0x6c0c5,'answer':_0x235b20})),console[_0x402736(0x14d)]('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0x6c0c5));}catch(_0x476572){console['error'](_0x402736(0x114)+_0x6c0c5+':',_0x476572),this[_0x402736(0xea)](_0x6c0c5);}}async[a6_0x184951(0x14a)](_0x1754e8,_0x1329a9){const _0x726715=a6_0x184951,_0x398260=this[_0x726715(0x15d)][_0x726715(0x176)](_0x1754e8);if(!_0x398260){console[_0x726715(0x14f)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20'+_0x1754e8);return;}try{await _0x398260[_0x726715(0x163)][_0x726715(0x178)](new RTCIceCandidate(_0x1329a9)),console['log'](_0x726715(0x111)+_0x1754e8);}catch(_0x502d1a){console[_0x726715(0x14f)]('[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20'+_0x1754e8+':',_0x502d1a);}}[a6_0x184951(0x174)](_0x450865,_0x1f98a1){const _0x272a9a=a6_0x184951;if(!this[_0x272a9a(0x12f)]||this['rosbridgeWs'][_0x272a9a(0x112)]!==this[_0x272a9a(0x12f)][_0x272a9a(0xdc)])return console[_0x272a9a(0x14f)](_0x272a9a(0xda)),null;console[_0x272a9a(0x14d)]('[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20'+_0x450865);const _0x20046f=_0x450865[_0x272a9a(0x141)]('depth'),_0x5a2b1f=_0x450865[_0x272a9a(0x141)](_0x272a9a(0x10e))||_0x450865['includes'](_0x272a9a(0x133));let _0x153749=[];_0x20046f?_0x5a2b1f?_0x153749=['sensor_msgs/CompressedImage',_0x272a9a(0x18b),_0x272a9a(0x13b),_0x272a9a(0xf1)]:_0x153749=[_0x272a9a(0xf1),_0x272a9a(0xf0),_0x272a9a(0x100)]:_0x153749=[_0x272a9a(0x100),_0x272a9a(0x18b),_0x272a9a(0xf1)];console[_0x272a9a(0x14d)](_0x272a9a(0x13f)+_0x450865+_0x272a9a(0x16a)+(_0x20046f?_0x272a9a(0x140):'color')+_0x272a9a(0x121),_0x153749);const _0x47db8a=[];let _0x17f4a4=![];const _0x2bc139=_0x159ba5=>{return _0xe11330=>{const _0x389fdf=a6_0x4094;try{const _0x32827e=JSON['parse'](_0xe11330[_0x389fdf(0x134)]);_0x32827e['op']===_0x389fdf(0x130)&&_0x32827e[_0x389fdf(0x14e)]===_0x450865&&_0x32827e[_0x389fdf(0x16f)]&&(!_0x17f4a4&&(console[_0x389fdf(0x14d)](_0x389fdf(0xe9)+_0x450865+_0x389fdf(0x12e)+_0x159ba5),_0x17f4a4=!![]),_0x1f98a1(_0x32827e[_0x389fdf(0x16f)]));}catch(_0x976eee){console[_0x389fdf(0x14f)](_0x389fdf(0x17b),_0x976eee);}};};for(const _0x3bcb4c of _0x153749){const _0x10e579={'op':_0x272a9a(0x16e),'topic':_0x450865,'type':_0x3bcb4c};console[_0x272a9a(0x14d)](_0x272a9a(0x145)+_0x3bcb4c),this['rosbridgeWs'][_0x272a9a(0x183)](JSON['stringify'](_0x10e579));const _0x5eeba3=_0x2bc139(_0x3bcb4c);this[_0x272a9a(0x12f)][_0x272a9a(0x11d)](_0x272a9a(0x10c),_0x5eeba3),_0x47db8a['push']({'handler':_0x5eeba3,'type':_0x3bcb4c});}return _0x20046f&&_0x5a2b1f&&setTimeout(()=>{const _0x53052e=_0x272a9a;if(!_0x17f4a4){console[_0x53052e(0x14d)](_0x53052e(0x13e)+_0x450865+',\x20trying\x20alternative\x20depth\x20topics');const _0x486e22=_0x450865[_0x53052e(0x160)](_0x53052e(0x187),'')[_0x53052e(0x160)](_0x53052e(0x127),''),_0x181485=[_0x486e22+_0x53052e(0x18c),_0x486e22+_0x53052e(0x128),_0x486e22];for(const _0x22c3ea of _0x181485){console['log'](_0x53052e(0x17e)+_0x22c3ea);const _0x286225={'op':_0x53052e(0x16e),'topic':_0x22c3ea,'type':'sensor_msgs/Image'};this[_0x53052e(0x12f)][_0x53052e(0x183)](JSON[_0x53052e(0x109)](_0x286225));const _0x12a3b0=_0x1bcc05=>{const _0x13b904=_0x53052e;try{const _0x1f54d6=JSON[_0x13b904(0x14b)](_0x1bcc05['data']);_0x1f54d6['op']===_0x13b904(0x130)&&_0x1f54d6[_0x13b904(0x14e)]===_0x22c3ea&&_0x1f54d6[_0x13b904(0x16f)]&&(console[_0x13b904(0x14d)](_0x13b904(0x123)+_0x22c3ea+_0x13b904(0xf4)),_0x1f54d6[_0x13b904(0x16f)][_0x13b904(0x134)]&&!_0x1f54d6[_0x13b904(0x16f)][_0x13b904(0x134)][_0x13b904(0x12c)]('/9j/')&&_0x1f98a1(_0x1f54d6[_0x13b904(0x16f)]));}catch(_0x36ef26){console[_0x13b904(0x14f)](_0x13b904(0x12b),_0x36ef26);}};this[_0x53052e(0x12f)][_0x53052e(0x11d)](_0x53052e(0x10c),_0x12a3b0),_0x47db8a[_0x53052e(0x191)]({'handler':_0x12a3b0,'type':'sensor_msgs/Image','topic':_0x22c3ea});}}},0xbb8),{'unsubscribe':()=>{const _0x823880=_0x272a9a;for(const {handler:_0x4829c5,type:_0x5ba0f7,topic:_0x14341d}of _0x47db8a){this['rosbridgeWs']['removeEventListener'](_0x823880(0x10c),_0x4829c5),this[_0x823880(0x12f)][_0x823880(0x112)]===this[_0x823880(0x12f)][_0x823880(0xdc)]&&this['rosbridgeWs'][_0x823880(0x183)](JSON[_0x823880(0x109)]({'op':_0x823880(0x108),'topic':_0x14341d||_0x450865}));}}};}[a6_0x184951(0x119)](_0x2e4879,_0xa59137){const _0x6ef229=a6_0x184951;_0xa59137[_0x6ef229(0xe2)]=_0x6ef229(0xff),_0xa59137[_0x6ef229(0x101)](0x0,0x0,_0x2e4879['width'],_0x2e4879[_0x6ef229(0xf5)]),_0xa59137['fillStyle']=_0x6ef229(0x150),_0xa59137[_0x6ef229(0x110)]=_0x6ef229(0x186),_0xa59137[_0x6ef229(0x104)]='center',_0xa59137[_0x6ef229(0x14c)](_0x6ef229(0x18a),_0x2e4879[_0x6ef229(0x185)]/0x2,_0x2e4879[_0x6ef229(0xf5)]/0x2-0x14),_0xa59137[_0x6ef229(0xe2)]=_0x6ef229(0x17a),_0xa59137['font']=_0x6ef229(0x118),_0xa59137[_0x6ef229(0x14c)](_0x6ef229(0x125),_0x2e4879[_0x6ef229(0x185)]/0x2,_0x2e4879[_0x6ef229(0xf5)]/0x2+0x14);const _0x4a7db0=Date[_0x6ef229(0x175)]()/0x3e8;for(let _0x584cef=0x0;_0x584cef<0x3;_0x584cef++){const _0x4079dd=(Math['sin'](_0x4a7db0*0x2+_0x584cef*0.5)+0x1)/0x2;_0xa59137[_0x6ef229(0xe2)]=_0x6ef229(0xec)+_0x4079dd*0.5+')',_0xa59137[_0x6ef229(0x17d)](),_0xa59137['arc'](_0x2e4879[_0x6ef229(0x185)]/0x2-0x28+_0x584cef*0x28,_0x2e4879['height']/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0xa59137['fill']();}}[a6_0x184951(0x165)](_0x37c5f1,_0x444b4e){const _0xa52ca6=a6_0x184951;try{if(!_0x37c5f1||!_0x444b4e)return;const _0x37b786=_0x444b4e[_0xa52ca6(0x197)]('2d'),_0x3d3436=_0x37b786['getImageData'](0x0,0x0,_0x444b4e[_0xa52ca6(0x185)],_0x444b4e['height']),_0x1854d5=this[_0xa52ca6(0x190)](_0x3d3436['data'],_0x444b4e[_0xa52ca6(0x185)],_0x444b4e[_0xa52ca6(0xf5)]),_0x3bed4d={'width':_0x444b4e[_0xa52ca6(0x185)],'height':_0x444b4e['height'],'data':_0x1854d5};typeof _0x37c5f1[_0xa52ca6(0x12d)]===_0xa52ca6(0x102)&&_0x37c5f1[_0xa52ca6(0x12d)](_0x3bed4d);}catch(_0x2f6f11){console[_0xa52ca6(0x14f)](_0xa52ca6(0xf6),_0x2f6f11);}}['convertRGBAtoI420'](_0x254645,_0x2385af,_0x37ddc6){const _0x5c854f=a6_0x184951,_0x5bf8e0=_0x2385af*_0x37ddc6,_0x29db35=_0x2385af*_0x37ddc6/0x4,_0xf60636=new Uint8Array(_0x5bf8e0+_0x29db35*0x2);let _0xbcec25=0x0,_0x345a4c=_0x5bf8e0,_0x4c23d7=_0x5bf8e0+_0x29db35;for(let _0xadfd12=0x0;_0xadfd12<_0x37ddc6;_0xadfd12++){for(let _0x27ea36=0x0;_0x27ea36<_0x2385af;_0x27ea36++){const _0x5d8fa6=(_0xadfd12*_0x2385af+_0x27ea36)*0x4,_0x899859=_0x254645[_0x5d8fa6],_0x10937c=_0x254645[_0x5d8fa6+0x1],_0x12e48a=_0x254645[_0x5d8fa6+0x2],_0x1d1540=Math['round'](0.299*_0x899859+0.587*_0x10937c+0.114*_0x12e48a);_0xf60636[_0xbcec25++]=_0x1d1540;if(_0xadfd12%0x2===0x0&&_0x27ea36%0x2===0x0){const _0x26dc96=Math[_0x5c854f(0xe6)](-0.169*_0x899859-0.331*_0x10937c+0.5*_0x12e48a+0x80),_0x4dba29=Math['round'](0.5*_0x899859-0.419*_0x10937c-0.081*_0x12e48a+0x80);_0xf60636[_0x345a4c++]=Math[_0x5c854f(0x11c)](0x0,Math['min'](0xff,_0x26dc96)),_0xf60636[_0x4c23d7++]=Math['max'](0x0,Math[_0x5c854f(0xfb)](0xff,_0x4dba29));}}}return _0xf60636;}async['updateCanvasWithImageData'](_0x5f455a,_0x3116e3,_0x6d0a25,_0x1a9eaf,_0x4e2539){const _0x2af541=a6_0x184951;try{if(!_0x6d0a25||!_0x6d0a25[_0x2af541(0x134)])return;Math[_0x2af541(0x17c)]()<0.01&&console[_0x2af541(0x14d)](_0x2af541(0xf8)+_0x1a9eaf+_0x2af541(0x153)+_0x6d0a25[_0x2af541(0x134)][_0x2af541(0x154)]+_0x2af541(0x113));const _0x12833a=Buffer['from'](_0x6d0a25['data'],'base64'),_0x3e8d23=this[_0x2af541(0x135)][_0x2af541(0xd7)](_0x1a9eaf);let _0x241e60;_0x3e8d23?_0x241e60=await this[_0x2af541(0x135)][_0x2af541(0x103)](_0x12833a,_0x5f455a,_0x3116e3,_0x1a9eaf):_0x241e60=await this[_0x2af541(0x135)]['processColorImage'](_0x12833a,_0x5f455a,_0x3116e3),_0x3116e3[_0x2af541(0x148)](_0x241e60,0x0,0x0),_0x3116e3[_0x2af541(0xe2)]=_0x2af541(0xe7),_0x3116e3[_0x2af541(0x101)](0xa,0xa,0xdc,0x32),_0x3116e3[_0x2af541(0xe2)]=_0x3e8d23?_0x2af541(0x116):'#00ff00',_0x3116e3[_0x2af541(0x110)]='12px\x20monospace',_0x3116e3[_0x2af541(0x14c)]((_0x3e8d23?'ðŸ”\x20Depth':'ðŸ“¹\x20Color')+':\x20'+new Date()[_0x2af541(0x11f)](),0xf,0x1c),_0x3116e3[_0x2af541(0xe2)]='#ffffff',_0x3116e3[_0x2af541(0x110)]=_0x2af541(0x188),_0x3116e3[_0x2af541(0x14c)]('Topic:\x20'+_0x1a9eaf['split']('/')['pop'](),0xf,0x2d),this[_0x2af541(0x165)](_0x4e2539,_0x5f455a);}catch(_0x4defd5){console[_0x2af541(0x124)]('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x1a9eaf+':',_0x4defd5['message']);_0x1a9eaf[_0x2af541(0x141)]('depth')&&Math['random']()<0.1&&console[_0x2af541(0x124)](_0x2af541(0xf3)+_0x1a9eaf['replace'](_0x2af541(0x187),'/image_raw'));_0x3116e3[_0x2af541(0xe2)]=_0x2af541(0xff),_0x3116e3['fillRect'](0x0,0x0,_0x5f455a['width'],_0x5f455a['height']),_0x3116e3['fillStyle']='#888',_0x3116e3[_0x2af541(0x110)]=_0x2af541(0x118),_0x3116e3['textAlign']=_0x2af541(0x147);const _0x5ebc3a=_0x1a9eaf[_0x2af541(0x141)]('depth')?'ðŸ”\x20Processing\x20depth...':_0x2af541(0xd9);_0x3116e3[_0x2af541(0x14c)](_0x5ebc3a,_0x5f455a[_0x2af541(0x185)]/0x2,_0x5f455a[_0x2af541(0xf5)]/0x2),_0x3116e3[_0x2af541(0xe2)]='#666',_0x3116e3[_0x2af541(0x110)]=_0x2af541(0x11a),_0x3116e3[_0x2af541(0x14c)](_0x2af541(0x184)+_0x1a9eaf[_0x2af541(0x19b)]('/')[_0x2af541(0x10b)](),_0x5f455a[_0x2af541(0x185)]/0x2,_0x5f455a[_0x2af541(0xf5)]/0x2+0x19),this[_0x2af541(0x165)](_0x4e2539,_0x5f455a);}}[a6_0x184951(0xea)](_0x47cbf7){const _0x50ceb5=a6_0x184951,_0x38a98b=this[_0x50ceb5(0x15d)][_0x50ceb5(0x176)](_0x47cbf7);if(!_0x38a98b){console['warn'](_0x50ceb5(0x18f)+_0x47cbf7);return;}console[_0x50ceb5(0x14d)](_0x50ceb5(0x18d)+_0x47cbf7+'\x20for\x20topic:\x20'+_0x38a98b[_0x50ceb5(0x14e)]);try{this['serverWs']&&this[_0x50ceb5(0x16c)]['readyState']===this[_0x50ceb5(0x16c)][_0x50ceb5(0xdc)]&&this[_0x50ceb5(0x16c)][_0x50ceb5(0x183)](JSON[_0x50ceb5(0x109)]({'op':_0x50ceb5(0x122),'session_id':_0x47cbf7})),_0x38a98b[_0x50ceb5(0x142)]&&_0x38a98b[_0x50ceb5(0x142)][_0x50ceb5(0x19c)](),_0x38a98b[_0x50ceb5(0x163)]&&_0x38a98b['peerConnection'][_0x50ceb5(0x192)]();}catch(_0x5d4229){console[_0x50ceb5(0x14f)]('[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20'+_0x5d4229);}this[_0x50ceb5(0x10a)](_0x47cbf7);}['cleanupSession'](_0x591e13){const _0x82e220=a6_0x184951,_0xdfa536=this[_0x82e220(0x15d)]['get'](_0x591e13);if(_0xdfa536){const _0x315127=this['topicSessions']['get'](_0xdfa536['topic']);_0x315127&&(_0x315127[_0x82e220(0x168)](_0x591e13),_0x315127[_0x82e220(0x149)]===0x0&&this['topicSessions']['delete'](_0xdfa536['topic'])),this[_0x82e220(0x189)](_0xdfa536[_0x82e220(0x14e)]);}this[_0x82e220(0x15d)][_0x82e220(0x168)](_0x591e13),console[_0x82e220(0x14d)](_0x82e220(0x193)+_0x591e13);}[a6_0x184951(0x18e)](){const _0x181839=a6_0x184951;console[_0x181839(0x14d)](_0x181839(0x11e));const _0xee4731=Array[_0x181839(0xeb)](this[_0x181839(0x15d)]['keys']());_0xee4731['forEach'](_0x49a737=>this[_0x181839(0xea)](_0x49a737));}['getActiveSessions'](){const _0x12516d=a6_0x184951,_0x32ccd4=[];for(const [_0x22da08,_0x321cb1]of this['activeSessions']){_0x32ccd4[_0x12516d(0x191)]({'sessionId':_0x22da08,'topic':_0x321cb1['topic'],'connectionState':_0x321cb1[_0x12516d(0x163)]?.[_0x12516d(0x196)]||_0x12516d(0x157),'hasVideoTrack':!!_0x321cb1[_0x12516d(0x142)]});}return _0x32ccd4;}[a6_0x184951(0xf2)](){const _0x2ed943=a6_0x184951,_0x58c3a1=[];for(const [_0x8d6f67,_0x1dfa8a]of this[_0x2ed943(0x115)]){_0x58c3a1[_0x2ed943(0x191)]({'topic':_0x8d6f67,'frameCount':_0x1dfa8a[_0x2ed943(0x117)],'hasVideoSource':!!_0x1dfa8a[_0x2ed943(0x139)],'hasRosSubscriber':!!_0x1dfa8a['rosSubscriber']});}return _0x58c3a1;}}function a6_0x4094(_0x50ff7b,_0x47f8df){const _0x2eecf3=a6_0x3a79();return a6_0x4094=function(_0x31f5e2,_0x3acc54){_0x31f5e2=_0x31f5e2-0xd7;let _0x3a797d=_0x2eecf3[_0x31f5e2];return _0x3a797d;},a6_0x4094(_0x50ff7b,_0x47f8df);}module[a6_0x184951(0x15e)]=new ApplianceWebRTCService();