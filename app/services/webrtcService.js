const a6_0x2274f0=a6_0x1beb;(function(_0x69db90,_0x4d5304){const _0x336fe8=a6_0x1beb,_0x31d6db=_0x69db90();while(!![]){try{const _0x5a344c=-parseInt(_0x336fe8(0x117))/0x1*(-parseInt(_0x336fe8(0x184))/0x2)+parseInt(_0x336fe8(0x188))/0x3+-parseInt(_0x336fe8(0xfe))/0x4+-parseInt(_0x336fe8(0x179))/0x5+parseInt(_0x336fe8(0x10b))/0x6+parseInt(_0x336fe8(0x197))/0x7+-parseInt(_0x336fe8(0x116))/0x8;if(_0x5a344c===_0x4d5304)break;else _0x31d6db['push'](_0x31d6db['shift']());}catch(_0x3aa6f5){_0x31d6db['push'](_0x31d6db['shift']());}}}(a6_0x323a,0xba3db));function a6_0x1beb(_0x508683,_0xa854bc){const _0x2f4d8a=a6_0x323a();return a6_0x1beb=function(_0x5976f3,_0x3572f1){_0x5976f3=_0x5976f3-0xec;let _0x323a8c=_0x2f4d8a[_0x5976f3];return _0x323a8c;},a6_0x1beb(_0x508683,_0xa854bc);}const a6_0x3572f1=(function(){let _0x5c3caa=!![];return function(_0x22a8ef,_0x90fede){const _0x55fa38=_0x5c3caa?function(){const _0x5a68ea=a6_0x1beb;if(_0x90fede){const _0x3324c9=_0x90fede[_0x5a68ea(0xf2)](_0x22a8ef,arguments);return _0x90fede=null,_0x3324c9;}}:function(){};return _0x5c3caa=![],_0x55fa38;};}()),a6_0x5976f3=a6_0x3572f1(this,function(){const _0x1c92a9=a6_0x1beb;return a6_0x5976f3[_0x1c92a9(0x174)]()[_0x1c92a9(0x175)](_0x1c92a9(0x16d))['toString']()['constructor'](a6_0x5976f3)[_0x1c92a9(0x175)](_0x1c92a9(0x16d));});a6_0x5976f3();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x2274f0(0x112)),sharp=require('sharp'),config=require(a6_0x2274f0(0x172)),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require(a6_0x2274f0(0x17f));class ApplianceWebRTCService{constructor(){const _0x1d689d=a6_0x2274f0;this[_0x1d689d(0x17e)]=new Map(),this['topicSessions']=new Map(),this[_0x1d689d(0x107)]=new Map(),this['rosbridgeWs']=null,this[_0x1d689d(0x16b)]=null,this[_0x1d689d(0x14a)]=new DepthImageProcessor(),this[_0x1d689d(0x1b1)]={'iceServers':[{'urls':_0x1d689d(0x183)},{'urls':_0x1d689d(0x12f)}]};}[a6_0x2274f0(0x164)](_0x4b0e37,_0x158e59){const _0x526954=a6_0x2274f0;this[_0x526954(0x131)]=_0x4b0e37,this['serverWs']=_0x158e59,turnCredentialsService[_0x526954(0x164)](config[_0x526954(0x1a7)]),this[_0x526954(0x11d)](),console[_0x526954(0x111)](_0x526954(0x1af));}async[a6_0x2274f0(0x11d)](){const _0x329401=a6_0x2274f0;try{console['log'](_0x329401(0x102));const _0x53a978=await turnCredentialsService[_0x329401(0x127)]();this[_0x329401(0x1b1)][_0x329401(0x19e)]=_0x53a978,console[_0x329401(0x111)](_0x329401(0x132));}catch(_0x17250f){console[_0x329401(0x120)](_0x329401(0x118),_0x17250f),console['log'](_0x329401(0x176));}}['handleMessage'](_0x252655){const _0x57fc4a=a6_0x2274f0;if(!_0x252655['op']||!_0x252655['op'][_0x57fc4a(0x103)](_0x57fc4a(0xf4)))return![];console['log'](_0x57fc4a(0x13e)+_0x252655['op']);switch(_0x252655['op']){case'webrtc_init_session':this[_0x57fc4a(0x13c)](_0x252655[_0x57fc4a(0xef)],_0x252655['topic']);return!![];case _0x57fc4a(0x193):this['handleOffer'](_0x252655[_0x57fc4a(0xef)],_0x252655['offer']);return!![];case _0x57fc4a(0x1a3):this[_0x57fc4a(0x15d)](_0x252655[_0x57fc4a(0xef)],_0x252655[_0x57fc4a(0xee)]);return!![];case _0x57fc4a(0x16a):this[_0x57fc4a(0x158)](_0x252655[_0x57fc4a(0xef)]);return!![];default:console[_0x57fc4a(0x13b)]('[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20'+_0x252655['op']);return![];}}['getOrCreateSharedVideoSource'](_0x3dac8b){const _0x5b6e38=a6_0x2274f0;if(this[_0x5b6e38(0x107)][_0x5b6e38(0x11c)](_0x3dac8b)){const _0x422dd3=this[_0x5b6e38(0x107)][_0x5b6e38(0x122)](_0x3dac8b);return _0x422dd3['frameCount']++,console[_0x5b6e38(0x111)](_0x5b6e38(0x17b)+_0x3dac8b+'\x20('+_0x422dd3['frameCount']+'\x20sessions)'),_0x422dd3;}console[_0x5b6e38(0x111)](_0x5b6e38(0x18f)+_0x3dac8b);const {createCanvas:_0x2bfcff}=require(_0x5b6e38(0x159)),_0x4a6fc8=_0x2bfcff(config[_0x5b6e38(0xfd)][_0x5b6e38(0x162)][_0x5b6e38(0x16f)],config[_0x5b6e38(0xfd)][_0x5b6e38(0x162)]['height']),_0x2c6ffb=_0x4a6fc8[_0x5b6e38(0x163)]('2d');this[_0x5b6e38(0x106)](_0x4a6fc8,_0x2c6ffb);const {RTCVideoSource:_0x18ac90}=nonstandard,_0x49d990=new _0x18ac90();let _0x3c1543=0x0;const _0x3e873f=0x3e8/config[_0x5b6e38(0xfd)][_0x5b6e38(0x162)][_0x5b6e38(0x140)],_0x183afe=this['subscribeToROSTopic'](_0x3dac8b,_0x23b88a=>{const _0x4a4b5d=_0x5b6e38,_0x32a72c=Date[_0x4a4b5d(0xfa)]();_0x32a72c-_0x3c1543>=_0x3e873f&&(_0x3c1543=_0x32a72c,this['updateCanvasWithImageData'](_0x4a6fc8,_0x2c6ffb,_0x23b88a,_0x3dac8b,_0x49d990));}),_0x4e5435={'videoSource':_0x49d990,'canvas':_0x4a6fc8,'rosSubscriber':_0x183afe,'frameCount':0x1,'topic':_0x3dac8b};return this[_0x5b6e38(0x107)][_0x5b6e38(0x136)](_0x3dac8b,_0x4e5435),_0x4e5435;}[a6_0x2274f0(0x154)](_0x3cc82c){const _0x15fdf3=a6_0x2274f0,_0xadc351=this[_0x15fdf3(0x107)][_0x15fdf3(0x122)](_0x3cc82c);if(!_0xadc351)return;_0xadc351[_0x15fdf3(0x151)]--,console[_0x15fdf3(0x111)]('[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x3cc82c+'\x20('+_0xadc351['frameCount']+_0x15fdf3(0x115)),_0xadc351[_0x15fdf3(0x151)]<=0x0&&(console[_0x15fdf3(0x111)](_0x15fdf3(0x15b)+_0x3cc82c+_0x15fdf3(0x19b)),_0xadc351['videoSource']&&(_0xadc351[_0x15fdf3(0xfc)]=null),_0xadc351['rosSubscriber']&&_0xadc351['rosSubscriber'][_0x15fdf3(0x155)](),this['sharedVideoSources']['delete'](_0x3cc82c));}async['initializeSession'](_0xe39f49,_0xaf5f0){const _0x472469=a6_0x2274f0;try{console[_0x472469(0x111)]('[WebRTC\x20Appliance]\x20Initializing\x20session\x20'+_0xe39f49+_0x472469(0xf1)+_0xaf5f0);const _0x3ab6a1=this[_0x472469(0x126)](_0xaf5f0),_0xedcb42=new RTCPeerConnection(this[_0x472469(0x1b1)]),_0x2f5569=_0x3ab6a1[_0x472469(0xfc)][_0x472469(0x104)]({'width':config[_0x472469(0xfd)][_0x472469(0x162)][_0x472469(0x16f)],'height':config[_0x472469(0xfd)][_0x472469(0x162)][_0x472469(0x1b0)],'framerate':config[_0x472469(0xfd)][_0x472469(0x162)][_0x472469(0x140)]});console['log']('[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20'+_0xe39f49);const {MediaStream:_0x5900a5}=require(_0x472469(0x112)),_0x235c85=new _0x5900a5([_0x2f5569]);_0xedcb42[_0x472469(0x173)](_0x2f5569,_0x235c85),this['sendFrameToVideoSource'](_0x3ab6a1[_0x472469(0xfc)],_0x3ab6a1[_0x472469(0x159)]),_0xedcb42['onicecandidate']=_0x4b211f=>{const _0x4b15c7=_0x472469;if(_0x4b211f[_0x4b15c7(0xee)]&&this['serverWs'])console['log']('[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20'+_0xe39f49+':',{'type':_0x4b211f[_0x4b15c7(0xee)]['type'],'protocol':_0x4b211f[_0x4b15c7(0xee)][_0x4b15c7(0x14c)],'address':_0x4b211f[_0x4b15c7(0xee)][_0x4b15c7(0x11a)],'port':_0x4b211f['candidate'][_0x4b15c7(0x195)]}),this[_0x4b15c7(0x16b)][_0x4b15c7(0x10c)](JSON['stringify']({'op':'webrtc_ice_candidate','session_id':_0xe39f49,'candidate':_0x4b211f[_0x4b15c7(0xee)]}));else!_0x4b211f[_0x4b15c7(0xee)]&&console[_0x4b15c7(0x111)](_0x4b15c7(0x191)+_0xe39f49);},_0xedcb42['onconnectionstatechange']=()=>{const _0x262b12=_0x472469;console[_0x262b12(0x111)](_0x262b12(0xf9)+_0xe39f49+'\x20connection\x20state:\x20'+_0xedcb42[_0x262b12(0x18b)]);if(_0xedcb42[_0x262b12(0x18b)]==='connected')console[_0x262b12(0x111)]('[WebRTC\x20Appliance]\x20Session\x20'+_0xe39f49+'\x20successfully\x20connected!');else{if(_0xedcb42[_0x262b12(0x18b)]===_0x262b12(0x17d))console[_0x262b12(0x111)]('[WebRTC\x20Appliance]\x20Session\x20'+_0xe39f49+_0x262b12(0x189)),this[_0x262b12(0x158)](_0xe39f49);else _0xedcb42[_0x262b12(0x18b)]==='closed'&&(console[_0x262b12(0x111)](_0x262b12(0xf9)+_0xe39f49+_0x262b12(0xf5)),this['cleanupSession'](_0xe39f49));}},this[_0x472469(0x17e)]['set'](_0xe39f49,{'peerConnection':_0xedcb42,'topic':_0xaf5f0,'videoTrack':_0x2f5569,'mediaStream':_0x235c85,'status':_0x472469(0x1aa)}),!this[_0x472469(0x19c)][_0x472469(0x11c)](_0xaf5f0)&&this['topicSessions'][_0x472469(0x136)](_0xaf5f0,new Set()),this[_0x472469(0x19c)][_0x472469(0x122)](_0xaf5f0)['add'](_0xe39f49),console[_0x472469(0x111)](_0x472469(0xf9)+_0xe39f49+_0x472469(0x161)),console[_0x472469(0x111)](_0x472469(0x14f)+_0xaf5f0+':\x20'+this['topicSessions'][_0x472469(0x122)](_0xaf5f0)[_0x472469(0x1b2)]);}catch(_0x38acfe){console['error'](_0x472469(0xf7)+_0xe39f49+':',_0x38acfe),this[_0x472469(0x158)](_0xe39f49);}}async[a6_0x2274f0(0x1ab)](_0x572f9e,_0x2c425e){const _0x1e0efd=a6_0x2274f0,_0x28b0b5=this[_0x1e0efd(0x17e)][_0x1e0efd(0x122)](_0x572f9e);if(!_0x28b0b5){console[_0x1e0efd(0x120)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20'+_0x572f9e);return;}try{console[_0x1e0efd(0x111)]('[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20'+_0x572f9e),await _0x28b0b5[_0x1e0efd(0xf6)]['setRemoteDescription'](new RTCSessionDescription(_0x2c425e)),console[_0x1e0efd(0x111)](_0x1e0efd(0x11f));const _0x1799c5=await _0x28b0b5[_0x1e0efd(0xf6)][_0x1e0efd(0x178)]();console[_0x1e0efd(0x111)]('[WebRTC\x20Appliance]\x20Created\x20answer'),await _0x28b0b5[_0x1e0efd(0xf6)][_0x1e0efd(0x119)](_0x1799c5),console[_0x1e0efd(0x111)](_0x1e0efd(0x194)),this[_0x1e0efd(0x16b)]&&(this[_0x1e0efd(0x16b)][_0x1e0efd(0x10c)](JSON[_0x1e0efd(0x16c)]({'op':_0x1e0efd(0x17c),'session_id':_0x572f9e,'answer':_0x1799c5})),console['log'](_0x1e0efd(0x15c)+_0x572f9e));}catch(_0x463676){console['error'](_0x1e0efd(0x134)+_0x572f9e+':',_0x463676),this[_0x1e0efd(0x158)](_0x572f9e);}}async[a6_0x2274f0(0x15d)](_0xf7c971,_0x2c9045){const _0xb3379a=a6_0x2274f0,_0x5566e2=this[_0xb3379a(0x17e)][_0xb3379a(0x122)](_0xf7c971);if(!_0x5566e2){console[_0xb3379a(0x120)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20'+_0xf7c971);return;}try{await _0x5566e2[_0xb3379a(0xf6)][_0xb3379a(0xed)](new RTCIceCandidate(_0x2c9045)),console['log']('[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20'+_0xf7c971);}catch(_0x59587d){console[_0xb3379a(0x120)]('[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20'+_0xf7c971+':',_0x59587d);}}[a6_0x2274f0(0x13d)](_0x1ee4c7,_0x2f3ede){const _0x56b134=a6_0x2274f0;if(!this[_0x56b134(0x131)]||this[_0x56b134(0x131)][_0x56b134(0x11e)]!==this[_0x56b134(0x131)]['OPEN'])return console['error'](_0x56b134(0x171)),null;console['log'](_0x56b134(0x14b)+_0x1ee4c7);const _0x1067a3=_0x1ee4c7['includes'](_0x56b134(0x138)),_0x12de18=_0x1ee4c7[_0x56b134(0x156)]('compressed')||_0x1ee4c7['includes'](_0x56b134(0x100));let _0x2dc3a0=[];_0x1067a3?_0x12de18?_0x2dc3a0=['sensor_msgs/CompressedImage','sensor_msgs/msg/CompressedImage','compressed_depth_image_transport/CompressedDepthImage','sensor_msgs/Image']:_0x2dc3a0=[_0x56b134(0x1a4),'sensor_msgs/msg/Image',_0x56b134(0x105)]:_0x2dc3a0=['sensor_msgs/CompressedImage',_0x56b134(0x185),_0x56b134(0x1a4)];console[_0x56b134(0x111)](_0x56b134(0x1a2)+_0x1ee4c7+_0x56b134(0x10e)+(_0x1067a3?_0x56b134(0x138):_0x56b134(0x139))+_0x56b134(0x196),_0x2dc3a0);const _0x5ad00a=[];let _0x33a866=![];const _0x3ba4b9=_0x446d1e=>{return _0xdad98d=>{const _0x4f03ba=a6_0x1beb;try{const _0x1e22fd=JSON[_0x4f03ba(0xf8)](_0xdad98d['data']);_0x1e22fd['op']===_0x4f03ba(0x160)&&_0x1e22fd['topic']===_0x1ee4c7&&_0x1e22fd['msg']&&(!_0x33a866&&(console['log']('[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20'+_0x1ee4c7+_0x4f03ba(0x180)+_0x446d1e),_0x33a866=!![]),_0x2f3ede(_0x1e22fd[_0x4f03ba(0x17a)]));}catch(_0x214bba){console[_0x4f03ba(0x120)](_0x4f03ba(0x11b),_0x214bba);}};};for(const _0x544621 of _0x2dc3a0){const _0xf026c={'op':_0x56b134(0x18d),'topic':_0x1ee4c7,'type':_0x544621};console[_0x56b134(0x111)](_0x56b134(0x12d)+_0x544621),this[_0x56b134(0x131)][_0x56b134(0x10c)](JSON[_0x56b134(0x16c)](_0xf026c));const _0x169765=_0x3ba4b9(_0x544621);this[_0x56b134(0x131)][_0x56b134(0x170)](_0x56b134(0x143),_0x169765),_0x5ad00a[_0x56b134(0x182)]({'handler':_0x169765,'type':_0x544621});}return _0x1067a3&&_0x12de18&&setTimeout(()=>{const _0xf83a15=_0x56b134;if(!_0x33a866){console[_0xf83a15(0x111)]('[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20'+_0x1ee4c7+_0xf83a15(0x177));const _0x517045=_0x1ee4c7[_0xf83a15(0x181)](_0xf83a15(0x130),'')['replace']('/compressed',''),_0xe51d6c=[_0x517045+_0xf83a15(0x147),_0x517045+_0xf83a15(0x165),_0x517045];for(const _0x391ac0 of _0xe51d6c){console['log'](_0xf83a15(0x14d)+_0x391ac0);const _0x47f58d={'op':'subscribe','topic':_0x391ac0,'type':_0xf83a15(0x1a4)};this[_0xf83a15(0x131)][_0xf83a15(0x10c)](JSON[_0xf83a15(0x16c)](_0x47f58d));const _0x2721c8=_0x11155d=>{const _0x2ca4d9=_0xf83a15;try{const _0x1842d2=JSON[_0x2ca4d9(0xf8)](_0x11155d['data']);_0x1842d2['op']===_0x2ca4d9(0x160)&&_0x1842d2['topic']===_0x391ac0&&_0x1842d2[_0x2ca4d9(0x17a)]&&(console[_0x2ca4d9(0x111)](_0x2ca4d9(0x18e)+_0x391ac0+_0x2ca4d9(0x1a5)),_0x1842d2[_0x2ca4d9(0x17a)][_0x2ca4d9(0x124)]&&!_0x1842d2[_0x2ca4d9(0x17a)]['data'][_0x2ca4d9(0x103)](_0x2ca4d9(0x14e))&&_0x2f3ede(_0x1842d2['msg']));}catch(_0x273296){console['error'](_0x2ca4d9(0x153),_0x273296);}};this[_0xf83a15(0x131)][_0xf83a15(0x170)](_0xf83a15(0x143),_0x2721c8),_0x5ad00a[_0xf83a15(0x182)]({'handler':_0x2721c8,'type':'sensor_msgs/Image','topic':_0x391ac0});}}},0xbb8),{'unsubscribe':()=>{const _0x265111=_0x56b134;for(const {handler:_0x1b056f,type:_0x539e01,topic:_0x411b38}of _0x5ad00a){this[_0x265111(0x131)][_0x265111(0x1ae)](_0x265111(0x143),_0x1b056f),this[_0x265111(0x131)][_0x265111(0x11e)]===this[_0x265111(0x131)][_0x265111(0xff)]&&this[_0x265111(0x131)][_0x265111(0x10c)](JSON[_0x265111(0x16c)]({'op':'unsubscribe','topic':_0x411b38||_0x1ee4c7}));}}};}[a6_0x2274f0(0x106)](_0x54b5bf,_0x1a2555){const _0x622a77=a6_0x2274f0;_0x1a2555[_0x622a77(0xfb)]=_0x622a77(0xf0),_0x1a2555[_0x622a77(0x113)](0x0,0x0,_0x54b5bf['width'],_0x54b5bf[_0x622a77(0x1b0)]),_0x1a2555['fillStyle']=_0x622a77(0x157),_0x1a2555['font']='24px\x20Arial',_0x1a2555[_0x622a77(0x125)]='center',_0x1a2555['fillText']('🤖\x20Robot\x20Camera',_0x54b5bf[_0x622a77(0x16f)]/0x2,_0x54b5bf['height']/0x2-0x14),_0x1a2555[_0x622a77(0xfb)]=_0x622a77(0x114),_0x1a2555['font']=_0x622a77(0x1a6),_0x1a2555[_0x622a77(0x199)]('Waiting\x20for\x20ROS\x20image\x20data...',_0x54b5bf[_0x622a77(0x16f)]/0x2,_0x54b5bf[_0x622a77(0x1b0)]/0x2+0x14);const _0x4f1315=Date[_0x622a77(0xfa)]()/0x3e8;for(let _0x486e36=0x0;_0x486e36<0x3;_0x486e36++){const _0x18d830=(Math[_0x622a77(0x149)](_0x4f1315*0x2+_0x486e36*0.5)+0x1)/0x2;_0x1a2555[_0x622a77(0xfb)]=_0x622a77(0x15a)+_0x18d830*0.5+')',_0x1a2555[_0x622a77(0x168)](),_0x1a2555[_0x622a77(0x18a)](_0x54b5bf[_0x622a77(0x16f)]/0x2-0x28+_0x486e36*0x28,_0x54b5bf[_0x622a77(0x1b0)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x1a2555[_0x622a77(0x192)]();}}['sendFrameToVideoSource'](_0x56d68b,_0x4758ae){const _0x2995ba=a6_0x2274f0;try{if(!_0x56d68b||!_0x4758ae)return;const _0x361645=_0x4758ae[_0x2995ba(0x163)]('2d'),_0x7cf2c3=_0x361645[_0x2995ba(0x10d)](0x0,0x0,_0x4758ae[_0x2995ba(0x16f)],_0x4758ae[_0x2995ba(0x1b0)]),_0x2df41e=this['convertRGBAtoI420'](_0x7cf2c3['data'],_0x4758ae[_0x2995ba(0x16f)],_0x4758ae[_0x2995ba(0x1b0)]),_0x4ac8aa={'width':_0x4758ae['width'],'height':_0x4758ae[_0x2995ba(0x1b0)],'data':_0x2df41e};typeof _0x56d68b[_0x2995ba(0x135)]===_0x2995ba(0x15e)&&_0x56d68b[_0x2995ba(0x135)](_0x4ac8aa);}catch(_0x134f6e){console['error']('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x134f6e);}}[a6_0x2274f0(0x186)](_0x2285f9,_0x47bf59,_0x2b5822){const _0x276a8f=a6_0x2274f0,_0x4006c3=_0x47bf59*_0x2b5822,_0x309fe7=_0x47bf59*_0x2b5822/0x4,_0x6e2bc4=new Uint8Array(_0x4006c3+_0x309fe7*0x2);let _0x4d86cb=0x0,_0x1a6e45=_0x4006c3,_0x1ded37=_0x4006c3+_0x309fe7;for(let _0x195c46=0x0;_0x195c46<_0x2b5822;_0x195c46++){for(let _0x170f27=0x0;_0x170f27<_0x47bf59;_0x170f27++){const _0x357d98=(_0x195c46*_0x47bf59+_0x170f27)*0x4,_0xf0a5cb=_0x2285f9[_0x357d98],_0x5e83cf=_0x2285f9[_0x357d98+0x1],_0x2e0151=_0x2285f9[_0x357d98+0x2],_0x1b39fc=Math['round'](0.299*_0xf0a5cb+0.587*_0x5e83cf+0.114*_0x2e0151);_0x6e2bc4[_0x4d86cb++]=_0x1b39fc;if(_0x195c46%0x2===0x0&&_0x170f27%0x2===0x0){const _0x4321ce=Math['round'](-0.169*_0xf0a5cb-0.331*_0x5e83cf+0.5*_0x2e0151+0x80),_0x5bbb38=Math[_0x276a8f(0x12e)](0.5*_0xf0a5cb-0.419*_0x5e83cf-0.081*_0x2e0151+0x80);_0x6e2bc4[_0x1a6e45++]=Math['max'](0x0,Math['min'](0xff,_0x4321ce)),_0x6e2bc4[_0x1ded37++]=Math['max'](0x0,Math[_0x276a8f(0x169)](0xff,_0x5bbb38));}}}return _0x6e2bc4;}async['updateCanvasWithImageData'](_0x50fe64,_0xf23431,_0xd3757e,_0x5c60cc,_0x2ccb4e){const _0x47a338=a6_0x2274f0;try{if(!_0xd3757e||!_0xd3757e[_0x47a338(0x124)])return;Math[_0x47a338(0x152)]()<0.01&&console['log'](_0x47a338(0x145)+_0x5c60cc+_0x47a338(0x12c)+_0xd3757e['data'][_0x47a338(0x19f)]+_0x47a338(0x18c));const _0x137175=Buffer['from'](_0xd3757e['data'],'base64'),_0x61d127=this[_0x47a338(0x14a)][_0x47a338(0x167)](_0x5c60cc);let _0x2e6870;_0x61d127?_0x2e6870=await this[_0x47a338(0x14a)][_0x47a338(0x12a)](_0x137175,_0x50fe64,_0xf23431,_0x5c60cc):_0x2e6870=await this[_0x47a338(0x14a)]['processColorImage'](_0x137175,_0x50fe64,_0xf23431),_0xf23431[_0x47a338(0x129)](_0x2e6870,0x0,0x0),_0xf23431[_0x47a338(0xfb)]=_0x47a338(0x1ac),_0xf23431['fillRect'](0xa,0xa,0xdc,0x32),_0xf23431[_0x47a338(0xfb)]=_0x61d127?_0x47a338(0x166):'#00ff00',_0xf23431[_0x47a338(0x13a)]=_0x47a338(0x198),_0xf23431[_0x47a338(0x199)]((_0x61d127?_0x47a338(0x101):_0x47a338(0x110))+':\x20'+new Date()[_0x47a338(0x121)](),0xf,0x1c),_0xf23431['fillStyle']=_0x47a338(0x114),_0xf23431['font']=_0x47a338(0x141),_0xf23431[_0x47a338(0x199)](_0x47a338(0x142)+_0x5c60cc['split']('/')[_0x47a338(0x109)](),0xf,0x2d),this[_0x47a338(0x133)](_0x2ccb4e,_0x50fe64);}catch(_0x6b4306){console[_0x47a338(0x13b)](_0x47a338(0x137)+_0x5c60cc+':',_0x6b4306[_0x47a338(0x143)]);_0x5c60cc['includes']('depth')&&Math[_0x47a338(0x152)]()<0.1&&console['warn'](_0x47a338(0x13f)+_0x5c60cc[_0x47a338(0x181)](_0x47a338(0x130),_0x47a338(0x147)));_0xf23431[_0x47a338(0xfb)]=_0x47a338(0xf0),_0xf23431[_0x47a338(0x113)](0x0,0x0,_0x50fe64['width'],_0x50fe64['height']),_0xf23431[_0x47a338(0xfb)]=_0x47a338(0xf3),_0xf23431[_0x47a338(0x13a)]=_0x47a338(0x1a6),_0xf23431['textAlign']=_0x47a338(0x1a0);const _0x1b8107=_0x5c60cc[_0x47a338(0x156)](_0x47a338(0x138))?_0x47a338(0x10f):_0x47a338(0x144);_0xf23431[_0x47a338(0x199)](_0x1b8107,_0x50fe64[_0x47a338(0x16f)]/0x2,_0x50fe64['height']/0x2),_0xf23431[_0x47a338(0xfb)]=_0x47a338(0x19a),_0xf23431[_0x47a338(0x13a)]=_0x47a338(0x187),_0xf23431[_0x47a338(0x199)](_0x47a338(0x142)+_0x5c60cc[_0x47a338(0x123)]('/')[_0x47a338(0x109)](),_0x50fe64[_0x47a338(0x16f)]/0x2,_0x50fe64[_0x47a338(0x1b0)]/0x2+0x19),this['sendFrameToVideoSource'](_0x2ccb4e,_0x50fe64);}}['stopSession'](_0x4ca179){const _0x46818f=a6_0x2274f0,_0x1a8eb7=this[_0x46818f(0x17e)]['get'](_0x4ca179);if(!_0x1a8eb7){console['warn'](_0x46818f(0x1a9)+_0x4ca179);return;}console['log'](_0x46818f(0x108)+_0x4ca179+'\x20for\x20topic:\x20'+_0x1a8eb7[_0x46818f(0x148)]);try{this['serverWs']&&this['serverWs'][_0x46818f(0x11e)]===this[_0x46818f(0x16b)][_0x46818f(0xff)]&&this[_0x46818f(0x16b)][_0x46818f(0x10c)](JSON[_0x46818f(0x16c)]({'op':_0x46818f(0x16a),'session_id':_0x4ca179})),_0x1a8eb7[_0x46818f(0x146)]&&_0x1a8eb7[_0x46818f(0x146)][_0x46818f(0x16e)](),_0x1a8eb7[_0x46818f(0xf6)]&&_0x1a8eb7[_0x46818f(0xf6)][_0x46818f(0x15f)]();}catch(_0x532e00){console[_0x46818f(0x120)]('[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20'+_0x532e00);}this['cleanupSession'](_0x4ca179);}[a6_0x2274f0(0x1ad)](_0x407b37){const _0x4db4ba=a6_0x2274f0,_0x176b60=this['activeSessions'][_0x4db4ba(0x122)](_0x407b37);if(_0x176b60){const _0x57fbf1=this[_0x4db4ba(0x19c)][_0x4db4ba(0x122)](_0x176b60[_0x4db4ba(0x148)]);_0x57fbf1&&(_0x57fbf1[_0x4db4ba(0x1a1)](_0x407b37),_0x57fbf1['size']===0x0&&this[_0x4db4ba(0x19c)][_0x4db4ba(0x1a1)](_0x176b60['topic'])),this[_0x4db4ba(0x154)](_0x176b60[_0x4db4ba(0x148)]);}this[_0x4db4ba(0x17e)][_0x4db4ba(0x1a1)](_0x407b37),console[_0x4db4ba(0x111)]('[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20'+_0x407b37);}[a6_0x2274f0(0x12b)](){const _0x582db7=a6_0x2274f0;console[_0x582db7(0x111)](_0x582db7(0xec));const _0x51c6b8=Array[_0x582db7(0x150)](this[_0x582db7(0x17e)][_0x582db7(0x128)]());_0x51c6b8[_0x582db7(0x190)](_0x228f73=>this[_0x582db7(0x158)](_0x228f73));}['getActiveSessions'](){const _0x331d7d=a6_0x2274f0,_0x4e4e68=[];for(const [_0xe16ac8,_0x1b84ec]of this[_0x331d7d(0x17e)]){_0x4e4e68[_0x331d7d(0x182)]({'sessionId':_0xe16ac8,'topic':_0x1b84ec[_0x331d7d(0x148)],'connectionState':_0x1b84ec[_0x331d7d(0xf6)]?.['connectionState']||_0x331d7d(0x1a8),'hasVideoTrack':!!_0x1b84ec[_0x331d7d(0x146)]});}return _0x4e4e68;}['getSharedVideoSources'](){const _0x423fb2=a6_0x2274f0,_0x125b95=[];for(const [_0x195c85,_0x4997a4]of this[_0x423fb2(0x107)]){_0x125b95[_0x423fb2(0x182)]({'topic':_0x195c85,'frameCount':_0x4997a4[_0x423fb2(0x151)],'hasVideoSource':!!_0x4997a4[_0x423fb2(0xfc)],'hasRosSubscriber':!!_0x4997a4[_0x423fb2(0x10a)]});}return _0x125b95;}}function a6_0x323a(){const _0x12da23=['push','stun:stun.l.google.com:19302','2eWmGtC','sensor_msgs/msg/CompressedImage','convertRGBAtoI420','12px\x20Arial','1664715KwrhBO','\x20connection\x20failed,\x20stopping\x20session','arc','connectionState','\x20bytes','subscribe','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','forEach','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','fill','webrtc_offer','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','port','\x20image,\x20trying\x20message\x20types:','5223358YJdXSM','12px\x20monospace','fillText','#666',',\x20cleaning\x20up\x20shared\x20resources','topicSessions','exports','iceServers','length','center','delete','[WebRTC\x20Appliance]\x20Topic\x20','webrtc_ice_candidate','sensor_msgs/Image',',\x20converting\x20to\x20base64...','16px\x20Arial','serverUrl','unknown','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','initializing','handleOffer','rgba(0,\x200,\x200,\x200.7)','cleanupSession','removeEventListener','[WebRTC\x20Appliance]\x20Service\x20initialized','height','rtcConfig','size','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','addIceCandidate','candidate','session_id','#1a1a1a','\x20for\x20topic\x20','apply','#888','webrtc_','\x20connection\x20closed,\x20cleaning\x20up','peerConnection','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','parse','[WebRTC\x20Appliance]\x20Session\x20','now','fillStyle','videoSource','webrtc','2532352QRRfIU','OPEN','compressedDepth','🔍\x20Depth','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','startsWith','createTrack','sensor_msgs/CompressedImage','drawLoadingPattern','sharedVideoSources','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','pop','rosSubscriber','8764794BuFbRp','send','getImageData','\x20detected\x20as\x20','🔍\x20Processing\x20depth...','📹\x20Color','log','wrtc','fillRect','#ffffff','\x20sessions\x20remaining)','12876128GMmKsa','1381486hieqIl','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','setLocalDescription','address','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','has','updateTurnCredentials','readyState','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','error','toLocaleTimeString','get','split','data','textAlign','getOrCreateSharedVideoSource','getIceServers','keys','putImageData','processDepthImage','stopAllSessions',',\x20size:\x20','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','round','stun:stun1.l.google.com:19302','/compressedDepth','rosbridgeWs','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','sendFrameToVideoSource','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','onFrame','set','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','depth','color','font','warn','initializeSession','subscribeToROSTopic','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','framerate','10px\x20monospace','Topic:\x20','message','📹\x20Processing\x20video...','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','videoTrack','/image_raw','topic','sin','depthProcessor','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','protocol','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','/9j/','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','from','frameCount','random','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','releaseSharedVideoSource','unsubscribe','includes','#00aaff','stopSession','canvas','rgba(0,\x20170,\x20255,\x20','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','handleIceCandidate','function','close','publish','\x20initialized\x20successfully','video','getContext','initialize','/image','#00ffff','isDepthTopic','beginPath','min','webrtc_stop_session','serverWs','stringify','(((.+)+)+)+$','stop','width','addEventListener','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','../config','addTrack','toString','search','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers',',\x20trying\x20alternative\x20depth\x20topics','createAnswer','5689685QUueel','msg','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','webrtc_answer','failed','activeSessions','./turnCredentialsService','\x20with\x20message\x20type\x20','replace'];a6_0x323a=function(){return _0x12da23;};return a6_0x323a();}module[a6_0x2274f0(0x19d)]=new ApplianceWebRTCService();