const a6_0x246b64=a6_0x1980;(function(_0xe730b,_0x3c3b66){const _0x2e79fa=a6_0x1980,_0x55a4c8=_0xe730b();while(!![]){try{const _0x4b9946=parseInt(_0x2e79fa(0x247))/0x1+parseInt(_0x2e79fa(0x269))/0x2*(-parseInt(_0x2e79fa(0x1e0))/0x3)+-parseInt(_0x2e79fa(0x278))/0x4*(-parseInt(_0x2e79fa(0x24a))/0x5)+-parseInt(_0x2e79fa(0x1f8))/0x6*(-parseInt(_0x2e79fa(0x22d))/0x7)+parseInt(_0x2e79fa(0x26e))/0x8*(parseInt(_0x2e79fa(0x227))/0x9)+parseInt(_0x2e79fa(0x22a))/0xa*(parseInt(_0x2e79fa(0x251))/0xb)+-parseInt(_0x2e79fa(0x27f))/0xc;if(_0x4b9946===_0x3c3b66)break;else _0x55a4c8['push'](_0x55a4c8['shift']());}catch(_0x501c75){_0x55a4c8['push'](_0x55a4c8['shift']());}}}(a6_0x2e3b,0x1b64c));const a6_0x1dbb54=(function(){let _0x122cc5=!![];return function(_0xcde572,_0x6c27b9){const _0x5a87b5=_0x122cc5?function(){const _0x520cb9=a6_0x1980;if(_0x6c27b9){const _0x1d3f4e=_0x6c27b9[_0x520cb9(0x1ef)](_0xcde572,arguments);return _0x6c27b9=null,_0x1d3f4e;}}:function(){};return _0x122cc5=![],_0x5a87b5;};}()),a6_0xbd99b3=a6_0x1dbb54(this,function(){const _0x1227db=a6_0x1980;return a6_0xbd99b3['toString']()[_0x1227db(0x236)](_0x1227db(0x1f9))['toString']()[_0x1227db(0x1f4)](a6_0xbd99b3)[_0x1227db(0x236)](_0x1227db(0x1f9));});a6_0xbd99b3();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x246b64(0x23f)),sharp=require(a6_0x246b64(0x224)),config=require(a6_0x246b64(0x242)),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require('./turnCredentialsService');class ApplianceWebRTCService{constructor(){const _0x2b3a45=a6_0x246b64;this[_0x2b3a45(0x1f7)]=new Map(),this[_0x2b3a45(0x27e)]=new Map(),this[_0x2b3a45(0x28f)]=new Map(),this[_0x2b3a45(0x1e3)]=null,this[_0x2b3a45(0x263)]=null,this[_0x2b3a45(0x1db)]=new DepthImageProcessor(),this[_0x2b3a45(0x231)]={'iceServers':[{'urls':_0x2b3a45(0x237)},{'urls':_0x2b3a45(0x28e)}]};}[a6_0x246b64(0x23e)](_0x506874,_0x452ade){const _0x2bb818=a6_0x246b64;this[_0x2bb818(0x1e3)]=_0x506874,this[_0x2bb818(0x263)]=_0x452ade,turnCredentialsService['initialize'](config[_0x2bb818(0x280)]),this[_0x2bb818(0x261)](),console[_0x2bb818(0x1d9)](_0x2bb818(0x219));}async[a6_0x246b64(0x261)](){const _0x587f67=a6_0x246b64;try{console[_0x587f67(0x1d9)](_0x587f67(0x26c));const _0x55d461=await turnCredentialsService[_0x587f67(0x285)]();this[_0x587f67(0x231)]['iceServers']=_0x55d461,console[_0x587f67(0x1d9)]('[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully');}catch(_0x2f024d){console['error'](_0x587f67(0x230),_0x2f024d),console['log']('[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers');}}['handleMessage'](_0x410ebc){const _0x48a3d5=a6_0x246b64;if(!_0x410ebc['op']||!_0x410ebc['op'][_0x48a3d5(0x244)](_0x48a3d5(0x292)))return![];console[_0x48a3d5(0x1d9)](_0x48a3d5(0x243)+_0x410ebc['op']);switch(_0x410ebc['op']){case _0x48a3d5(0x276):this[_0x48a3d5(0x222)](_0x410ebc[_0x48a3d5(0x214)],_0x410ebc[_0x48a3d5(0x1d2)]);return!![];case _0x48a3d5(0x21a):this[_0x48a3d5(0x1e8)](_0x410ebc['session_id'],_0x410ebc[_0x48a3d5(0x206)]);return!![];case'webrtc_ice_candidate':this[_0x48a3d5(0x218)](_0x410ebc[_0x48a3d5(0x214)],_0x410ebc[_0x48a3d5(0x256)]);return!![];case _0x48a3d5(0x225):this['stopSession'](_0x410ebc[_0x48a3d5(0x214)]);return!![];default:console[_0x48a3d5(0x293)](_0x48a3d5(0x271)+_0x410ebc['op']);return![];}}[a6_0x246b64(0x1fe)](_0x54227e){const _0x328ced=a6_0x246b64;if(this[_0x328ced(0x28f)]['has'](_0x54227e)){const _0x46d063=this['sharedVideoSources'][_0x328ced(0x1cc)](_0x54227e);return _0x46d063['frameCount']++,console[_0x328ced(0x1d9)]('[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x54227e+'\x20('+_0x46d063[_0x328ced(0x23c)]+_0x328ced(0x209)),_0x46d063;}console['log']('[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x54227e);const {createCanvas:_0x4e1ef1}=require(_0x328ced(0x266)),_0x42befe=_0x4e1ef1(config[_0x328ced(0x216)]['video'][_0x328ced(0x1fc)],config[_0x328ced(0x216)]['video'][_0x328ced(0x25e)]),_0x579429=_0x42befe[_0x328ced(0x1f2)]('2d');this[_0x328ced(0x27c)](_0x42befe,_0x579429);const {RTCVideoSource:_0x5c6610}=nonstandard,_0x20a13f=new _0x5c6610();let _0x462e15=0x0;const _0x550155=0x3e8/config['webrtc'][_0x328ced(0x1ff)][_0x328ced(0x257)],_0x31df5e=this[_0x328ced(0x1f0)](_0x54227e,_0x2436f0=>{const _0x594346=_0x328ced,_0x2ced28=Date[_0x594346(0x1e4)]();_0x2ced28-_0x462e15>=_0x550155&&(_0x462e15=_0x2ced28,this[_0x594346(0x1d8)](_0x42befe,_0x579429,_0x2436f0,_0x54227e,_0x20a13f));}),_0x1d262f={'videoSource':_0x20a13f,'canvas':_0x42befe,'rosSubscriber':_0x31df5e,'frameCount':0x1,'topic':_0x54227e};return this[_0x328ced(0x28f)]['set'](_0x54227e,_0x1d262f),_0x1d262f;}[a6_0x246b64(0x26f)](_0x2934a0){const _0x205ecd=a6_0x246b64,_0x242408=this[_0x205ecd(0x28f)][_0x205ecd(0x1cc)](_0x2934a0);if(!_0x242408)return;_0x242408['frameCount']--,console[_0x205ecd(0x1d9)](_0x205ecd(0x207)+_0x2934a0+'\x20('+_0x242408[_0x205ecd(0x23c)]+'\x20sessions\x20remaining)'),_0x242408[_0x205ecd(0x23c)]<=0x0&&(console[_0x205ecd(0x1d9)](_0x205ecd(0x284)+_0x2934a0+_0x205ecd(0x273)),_0x242408[_0x205ecd(0x1e1)]&&(_0x242408[_0x205ecd(0x1e1)]=null),_0x242408[_0x205ecd(0x24d)]&&_0x242408[_0x205ecd(0x24d)][_0x205ecd(0x24b)](),this[_0x205ecd(0x28f)][_0x205ecd(0x260)](_0x2934a0));}async[a6_0x246b64(0x222)](_0x11cf21,_0x5a8d97){const _0x3218b6=a6_0x246b64;try{console[_0x3218b6(0x1d9)](_0x3218b6(0x233)+_0x11cf21+'\x20for\x20topic\x20'+_0x5a8d97);const _0x5431a2=this['getOrCreateSharedVideoSource'](_0x5a8d97),_0x30e9fb=new RTCPeerConnection(this[_0x3218b6(0x231)]),_0x156fc0=_0x5431a2['videoSource']['createTrack']({'width':config[_0x3218b6(0x216)]['video'][_0x3218b6(0x1fc)],'height':config[_0x3218b6(0x216)]['video'][_0x3218b6(0x25e)],'framerate':config[_0x3218b6(0x216)][_0x3218b6(0x1ff)]['framerate']});console[_0x3218b6(0x1d9)](_0x3218b6(0x274)+_0x11cf21);const {MediaStream:_0x103602}=require(_0x3218b6(0x23f)),_0x2628b5=new _0x103602([_0x156fc0]);_0x30e9fb['addTrack'](_0x156fc0,_0x2628b5),this[_0x3218b6(0x287)](_0x5431a2[_0x3218b6(0x1e1)],_0x5431a2[_0x3218b6(0x266)]),_0x30e9fb[_0x3218b6(0x249)]=_0x1a24c1=>{const _0x50fb7e=_0x3218b6;if(_0x1a24c1[_0x50fb7e(0x256)]&&this[_0x50fb7e(0x263)])console[_0x50fb7e(0x1d9)]('[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20'+_0x11cf21+':',{'type':_0x1a24c1[_0x50fb7e(0x256)][_0x50fb7e(0x229)],'protocol':_0x1a24c1['candidate'][_0x50fb7e(0x28a)],'address':_0x1a24c1['candidate']['address'],'port':_0x1a24c1['candidate']['port']}),this[_0x50fb7e(0x263)][_0x50fb7e(0x240)](JSON['stringify']({'op':_0x50fb7e(0x213),'session_id':_0x11cf21,'candidate':_0x1a24c1[_0x50fb7e(0x256)]}));else!_0x1a24c1['candidate']&&console[_0x50fb7e(0x1d9)](_0x50fb7e(0x26d)+_0x11cf21);},_0x30e9fb[_0x3218b6(0x248)]=()=>{const _0x428ed8=_0x3218b6;console['log'](_0x428ed8(0x208)+_0x11cf21+_0x428ed8(0x20b)+_0x30e9fb['connectionState']);if(_0x30e9fb[_0x428ed8(0x1d7)]===_0x428ed8(0x28d))console[_0x428ed8(0x1d9)](_0x428ed8(0x208)+_0x11cf21+_0x428ed8(0x21c));else{if(_0x30e9fb[_0x428ed8(0x1d7)]===_0x428ed8(0x211))console[_0x428ed8(0x1d9)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x11cf21+_0x428ed8(0x275)),this[_0x428ed8(0x28b)](_0x11cf21);else _0x30e9fb[_0x428ed8(0x1d7)]===_0x428ed8(0x1ee)&&(console[_0x428ed8(0x1d9)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x11cf21+_0x428ed8(0x23b)),this[_0x428ed8(0x281)](_0x11cf21));}},this[_0x3218b6(0x1f7)][_0x3218b6(0x20d)](_0x11cf21,{'peerConnection':_0x30e9fb,'topic':_0x5a8d97,'videoTrack':_0x156fc0,'mediaStream':_0x2628b5,'status':_0x3218b6(0x217)}),!this[_0x3218b6(0x27e)][_0x3218b6(0x21d)](_0x5a8d97)&&this[_0x3218b6(0x27e)][_0x3218b6(0x20d)](_0x5a8d97,new Set()),this[_0x3218b6(0x27e)][_0x3218b6(0x1cc)](_0x5a8d97)['add'](_0x11cf21),console[_0x3218b6(0x1d9)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x11cf21+_0x3218b6(0x26a)),console['log'](_0x3218b6(0x290)+_0x5a8d97+':\x20'+this[_0x3218b6(0x27e)][_0x3218b6(0x1cc)](_0x5a8d97)[_0x3218b6(0x220)]);}catch(_0x3f3c70){console[_0x3218b6(0x25b)]('[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20'+_0x11cf21+':',_0x3f3c70),this['stopSession'](_0x11cf21);}}async[a6_0x246b64(0x1e8)](_0x15ef52,_0x5091c5){const _0x347439=a6_0x246b64,_0x1da106=this[_0x347439(0x1f7)][_0x347439(0x1cc)](_0x15ef52);if(!_0x1da106){console[_0x347439(0x25b)](_0x347439(0x272)+_0x15ef52);return;}try{console[_0x347439(0x1d9)]('[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20'+_0x15ef52),await _0x1da106[_0x347439(0x1df)][_0x347439(0x270)](new RTCSessionDescription(_0x5091c5)),console[_0x347439(0x1d9)]('[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)');const _0x11b806=await _0x1da106['peerConnection'][_0x347439(0x203)]();console[_0x347439(0x1d9)](_0x347439(0x268)),await _0x1da106[_0x347439(0x1df)][_0x347439(0x234)](_0x11b806),console['log'](_0x347439(0x294)),this[_0x347439(0x263)]&&(this[_0x347439(0x263)][_0x347439(0x240)](JSON[_0x347439(0x27d)]({'op':_0x347439(0x20f),'session_id':_0x15ef52,'answer':_0x11b806})),console[_0x347439(0x1d9)](_0x347439(0x1e5)+_0x15ef52));}catch(_0x261426){console[_0x347439(0x25b)](_0x347439(0x1f5)+_0x15ef52+':',_0x261426),this[_0x347439(0x28b)](_0x15ef52);}}async[a6_0x246b64(0x218)](_0x49a56b,_0x30875f){const _0x1ff05b=a6_0x246b64,_0x1850f6=this[_0x1ff05b(0x1f7)][_0x1ff05b(0x1cc)](_0x49a56b);if(!_0x1850f6){console[_0x1ff05b(0x25b)](_0x1ff05b(0x1c9)+_0x49a56b);return;}try{await _0x1850f6[_0x1ff05b(0x1df)][_0x1ff05b(0x1d5)](new RTCIceCandidate(_0x30875f)),console[_0x1ff05b(0x1d9)]('[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20'+_0x49a56b);}catch(_0xcfaa5e){console[_0x1ff05b(0x25b)](_0x1ff05b(0x22c)+_0x49a56b+':',_0xcfaa5e);}}['subscribeToROSTopic'](_0x4faa1f,_0x2d840a){const _0x5b87a8=a6_0x246b64;if(!this[_0x5b87a8(0x1e3)]||this['rosbridgeWs'][_0x5b87a8(0x250)]!==this[_0x5b87a8(0x1e3)][_0x5b87a8(0x27b)])return console[_0x5b87a8(0x25b)](_0x5b87a8(0x23a)),null;console[_0x5b87a8(0x1d9)](_0x5b87a8(0x20e)+_0x4faa1f);const _0x1a3882=_0x4faa1f[_0x5b87a8(0x264)](_0x5b87a8(0x221)),_0x561cc1=_0x4faa1f[_0x5b87a8(0x264)](_0x5b87a8(0x277))||_0x4faa1f[_0x5b87a8(0x264)]('compressedDepth');let _0x4c3a98=[];_0x1a3882?_0x561cc1?_0x4c3a98=[_0x5b87a8(0x1fd),_0x5b87a8(0x252),_0x5b87a8(0x22e),_0x5b87a8(0x1e6)]:_0x4c3a98=[_0x5b87a8(0x1e6),_0x5b87a8(0x24e),'sensor_msgs/CompressedImage']:_0x4c3a98=[_0x5b87a8(0x1fd),'sensor_msgs/msg/CompressedImage',_0x5b87a8(0x1e6)];console[_0x5b87a8(0x1d9)](_0x5b87a8(0x25d)+_0x4faa1f+'\x20detected\x20as\x20'+(_0x1a3882?'depth':_0x5b87a8(0x1cd))+_0x5b87a8(0x291),_0x4c3a98);const _0x57a758=[];let _0x2a6b6c=![];const _0x4e7798=_0x1ff4be=>{return _0x1577ba=>{const _0x70dbe0=a6_0x1980;try{const _0x4ccb1d=JSON[_0x70dbe0(0x232)](_0x1577ba[_0x70dbe0(0x223)]);_0x4ccb1d['op']==='publish'&&_0x4ccb1d[_0x70dbe0(0x1d2)]===_0x4faa1f&&_0x4ccb1d[_0x70dbe0(0x1cf)]&&(!_0x2a6b6c&&(console[_0x70dbe0(0x1d9)]('[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20'+_0x4faa1f+'\x20with\x20message\x20type\x20'+_0x1ff4be),_0x2a6b6c=!![]),_0x2d840a(_0x4ccb1d[_0x70dbe0(0x1cf)]));}catch(_0x4f645f){console[_0x70dbe0(0x25b)](_0x70dbe0(0x1ca),_0x4f645f);}};};for(const _0x2fb8d3 of _0x4c3a98){const _0x3ffb84={'op':_0x5b87a8(0x279),'topic':_0x4faa1f,'type':_0x2fb8d3};console[_0x5b87a8(0x1d9)](_0x5b87a8(0x25a)+_0x2fb8d3),this['rosbridgeWs'][_0x5b87a8(0x240)](JSON[_0x5b87a8(0x27d)](_0x3ffb84));const _0x4883ac=_0x4e7798(_0x2fb8d3);this[_0x5b87a8(0x1e3)][_0x5b87a8(0x200)](_0x5b87a8(0x1dd),_0x4883ac),_0x57a758[_0x5b87a8(0x1fa)]({'handler':_0x4883ac,'type':_0x2fb8d3});}return _0x1a3882&&_0x561cc1&&setTimeout(()=>{const _0x7011f5=_0x5b87a8;if(!_0x2a6b6c){console['log']('[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20'+_0x4faa1f+_0x7011f5(0x20c));const _0x3459c4=_0x4faa1f[_0x7011f5(0x212)](_0x7011f5(0x1cb),'')['replace'](_0x7011f5(0x1eb),''),_0x2e83b2=[_0x3459c4+_0x7011f5(0x1ec),_0x3459c4+_0x7011f5(0x239),_0x3459c4];for(const _0x46fd5c of _0x2e83b2){console[_0x7011f5(0x1d9)](_0x7011f5(0x1dc)+_0x46fd5c);const _0x5d9e4={'op':_0x7011f5(0x279),'topic':_0x46fd5c,'type':'sensor_msgs/Image'};this[_0x7011f5(0x1e3)]['send'](JSON[_0x7011f5(0x27d)](_0x5d9e4));const _0x1d763b=_0x5dcc29=>{const _0x209c98=_0x7011f5;try{const _0x5450e6=JSON[_0x209c98(0x232)](_0x5dcc29['data']);_0x5450e6['op']===_0x209c98(0x286)&&_0x5450e6['topic']===_0x46fd5c&&_0x5450e6[_0x209c98(0x1cf)]&&(console[_0x209c98(0x1d9)](_0x209c98(0x28c)+_0x46fd5c+',\x20converting\x20to\x20base64...'),_0x5450e6['msg']['data']&&!_0x5450e6['msg'][_0x209c98(0x223)]['startsWith'](_0x209c98(0x238))&&_0x2d840a(_0x5450e6[_0x209c98(0x1cf)]));}catch(_0x2b0116){console[_0x209c98(0x25b)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:',_0x2b0116);}};this['rosbridgeWs']['addEventListener'](_0x7011f5(0x1dd),_0x1d763b),_0x57a758[_0x7011f5(0x1fa)]({'handler':_0x1d763b,'type':'sensor_msgs/Image','topic':_0x46fd5c});}}},0xbb8),{'unsubscribe':()=>{const _0x3e7bba=_0x5b87a8;for(const {handler:_0x27affa,type:_0x5962d3,topic:_0x3ccfae}of _0x57a758){this[_0x3e7bba(0x1e3)][_0x3e7bba(0x210)]('message',_0x27affa),this[_0x3e7bba(0x1e3)][_0x3e7bba(0x250)]===this['rosbridgeWs']['OPEN']&&this[_0x3e7bba(0x1e3)][_0x3e7bba(0x240)](JSON[_0x3e7bba(0x27d)]({'op':_0x3e7bba(0x24b),'topic':_0x3ccfae||_0x4faa1f}));}}};}[a6_0x246b64(0x27c)](_0x1f34bc,_0x412913){const _0x175fe3=a6_0x246b64;_0x412913[_0x175fe3(0x259)]=_0x175fe3(0x258),_0x412913['fillRect'](0x0,0x0,_0x1f34bc[_0x175fe3(0x1fc)],_0x1f34bc[_0x175fe3(0x25e)]),_0x412913['fillStyle']=_0x175fe3(0x1ea),_0x412913[_0x175fe3(0x25c)]=_0x175fe3(0x235),_0x412913[_0x175fe3(0x24c)]='center',_0x412913[_0x175fe3(0x22b)]('🤖\x20Robot\x20Camera',_0x1f34bc[_0x175fe3(0x1fc)]/0x2,_0x1f34bc[_0x175fe3(0x25e)]/0x2-0x14),_0x412913['fillStyle']=_0x175fe3(0x21e),_0x412913[_0x175fe3(0x25c)]='16px\x20Arial',_0x412913[_0x175fe3(0x22b)](_0x175fe3(0x24f),_0x1f34bc['width']/0x2,_0x1f34bc[_0x175fe3(0x25e)]/0x2+0x14);const _0x48589e=Date[_0x175fe3(0x1e4)]()/0x3e8;for(let _0x50e360=0x0;_0x50e360<0x3;_0x50e360++){const _0x559ce8=(Math['sin'](_0x48589e*0x2+_0x50e360*0.5)+0x1)/0x2;_0x412913[_0x175fe3(0x259)]=_0x175fe3(0x289)+_0x559ce8*0.5+')',_0x412913[_0x175fe3(0x205)](),_0x412913['arc'](_0x1f34bc[_0x175fe3(0x1fc)]/0x2-0x28+_0x50e360*0x28,_0x1f34bc[_0x175fe3(0x25e)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x412913['fill']();}}[a6_0x246b64(0x287)](_0x585811,_0x1e569e){const _0x309db=a6_0x246b64;try{if(!_0x585811||!_0x1e569e)return;const _0x4746c4=_0x1e569e[_0x309db(0x1f2)]('2d'),_0xfecfee=_0x4746c4[_0x309db(0x21b)](0x0,0x0,_0x1e569e[_0x309db(0x1fc)],_0x1e569e[_0x309db(0x25e)]),_0x41fc5c=this['convertRGBAtoI420'](_0xfecfee[_0x309db(0x223)],_0x1e569e['width'],_0x1e569e[_0x309db(0x25e)]),_0x4f41aa={'width':_0x1e569e[_0x309db(0x1fc)],'height':_0x1e569e[_0x309db(0x25e)],'data':_0x41fc5c};typeof _0x585811[_0x309db(0x265)]==='function'&&_0x585811[_0x309db(0x265)](_0x4f41aa);}catch(_0x3b2d32){console[_0x309db(0x25b)](_0x309db(0x1ed),_0x3b2d32);}}[a6_0x246b64(0x253)](_0x496021,_0x2eb781,_0x1df6e5){const _0x147fb9=a6_0x246b64,_0x3389ad=_0x2eb781*_0x1df6e5,_0x12485b=_0x2eb781*_0x1df6e5/0x4,_0x263c87=new Uint8Array(_0x3389ad+_0x12485b*0x2);let _0x57685a=0x0,_0xd631d=_0x3389ad,_0x3eb039=_0x3389ad+_0x12485b;for(let _0x599e68=0x0;_0x599e68<_0x1df6e5;_0x599e68++){for(let _0x18bf7a=0x0;_0x18bf7a<_0x2eb781;_0x18bf7a++){const _0xa2abd9=(_0x599e68*_0x2eb781+_0x18bf7a)*0x4,_0xc6a9e1=_0x496021[_0xa2abd9],_0x419faf=_0x496021[_0xa2abd9+0x1],_0xd9f486=_0x496021[_0xa2abd9+0x2],_0x1158cb=Math[_0x147fb9(0x1d6)](0.299*_0xc6a9e1+0.587*_0x419faf+0.114*_0xd9f486);_0x263c87[_0x57685a++]=_0x1158cb;if(_0x599e68%0x2===0x0&&_0x18bf7a%0x2===0x0){const _0x41b6b0=Math['round'](-0.169*_0xc6a9e1-0.331*_0x419faf+0.5*_0xd9f486+0x80),_0x5e4a55=Math['round'](0.5*_0xc6a9e1-0.419*_0x419faf-0.081*_0xd9f486+0x80);_0x263c87[_0xd631d++]=Math['max'](0x0,Math['min'](0xff,_0x41b6b0)),_0x263c87[_0x3eb039++]=Math['max'](0x0,Math[_0x147fb9(0x295)](0xff,_0x5e4a55));}}}return _0x263c87;}async[a6_0x246b64(0x1d8)](_0x3ac67b,_0x466200,_0x4c9ff3,_0x2ccf85,_0x45d313){const _0x2e1ca7=a6_0x246b64;try{if(!_0x4c9ff3||!_0x4c9ff3[_0x2e1ca7(0x223)])return;Math['random']()<0.01&&console[_0x2e1ca7(0x1d9)](_0x2e1ca7(0x20a)+_0x2ccf85+',\x20size:\x20'+_0x4c9ff3[_0x2e1ca7(0x223)][_0x2e1ca7(0x241)]+_0x2e1ca7(0x21f));const _0x4b2464=Buffer[_0x2e1ca7(0x23d)](_0x4c9ff3[_0x2e1ca7(0x223)],_0x2e1ca7(0x1f1)),_0x4f9e62=this['depthProcessor'][_0x2e1ca7(0x26b)](_0x2ccf85);let _0x4a8673;_0x4f9e62?_0x4a8673=await this[_0x2e1ca7(0x1db)][_0x2e1ca7(0x226)](_0x4b2464,_0x3ac67b,_0x466200,_0x2ccf85):_0x4a8673=await this[_0x2e1ca7(0x1db)][_0x2e1ca7(0x245)](_0x4b2464,_0x3ac67b,_0x466200),_0x466200['putImageData'](_0x4a8673,0x0,0x0),_0x466200[_0x2e1ca7(0x259)]=_0x2e1ca7(0x296),_0x466200[_0x2e1ca7(0x1ce)](0xa,0xa,0xdc,0x32),_0x466200[_0x2e1ca7(0x259)]=_0x4f9e62?_0x2e1ca7(0x202):_0x2e1ca7(0x25f),_0x466200[_0x2e1ca7(0x25c)]='12px\x20monospace',_0x466200['fillText']((_0x4f9e62?_0x2e1ca7(0x228):_0x2e1ca7(0x1d4))+':\x20'+new Date()[_0x2e1ca7(0x204)](),0xf,0x1c),_0x466200['fillStyle']=_0x2e1ca7(0x21e),_0x466200[_0x2e1ca7(0x25c)]=_0x2e1ca7(0x1d0),_0x466200[_0x2e1ca7(0x22b)](_0x2e1ca7(0x283)+_0x2ccf85[_0x2e1ca7(0x1e2)]('/')[_0x2e1ca7(0x1e7)](),0xf,0x2d),this['sendFrameToVideoSource'](_0x45d313,_0x3ac67b);}catch(_0x238bec){console[_0x2e1ca7(0x293)]('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x2ccf85+':',_0x238bec[_0x2e1ca7(0x1dd)]);_0x2ccf85[_0x2e1ca7(0x264)]('depth')&&Math[_0x2e1ca7(0x1f3)]()<0.1&&console[_0x2e1ca7(0x293)](_0x2e1ca7(0x215)+_0x2ccf85[_0x2e1ca7(0x212)](_0x2e1ca7(0x1cb),_0x2e1ca7(0x1ec)));_0x466200[_0x2e1ca7(0x259)]='#1a1a1a',_0x466200[_0x2e1ca7(0x1ce)](0x0,0x0,_0x3ac67b[_0x2e1ca7(0x1fc)],_0x3ac67b[_0x2e1ca7(0x25e)]),_0x466200[_0x2e1ca7(0x259)]=_0x2e1ca7(0x22f),_0x466200[_0x2e1ca7(0x25c)]=_0x2e1ca7(0x282),_0x466200[_0x2e1ca7(0x24c)]=_0x2e1ca7(0x1d1);const _0x5802f3=_0x2ccf85[_0x2e1ca7(0x264)]('depth')?'🔍\x20Processing\x20depth...':_0x2e1ca7(0x246);_0x466200[_0x2e1ca7(0x22b)](_0x5802f3,_0x3ac67b[_0x2e1ca7(0x1fc)]/0x2,_0x3ac67b[_0x2e1ca7(0x25e)]/0x2),_0x466200[_0x2e1ca7(0x259)]=_0x2e1ca7(0x27a),_0x466200[_0x2e1ca7(0x25c)]=_0x2e1ca7(0x1de),_0x466200['fillText'](_0x2e1ca7(0x283)+_0x2ccf85[_0x2e1ca7(0x1e2)]('/')[_0x2e1ca7(0x1e7)](),_0x3ac67b['width']/0x2,_0x3ac67b[_0x2e1ca7(0x25e)]/0x2+0x19),this[_0x2e1ca7(0x287)](_0x45d313,_0x3ac67b);}}[a6_0x246b64(0x28b)](_0x1b2612){const _0x1e3562=a6_0x246b64,_0x5d16fb=this['activeSessions'][_0x1e3562(0x1cc)](_0x1b2612);if(!_0x5d16fb){console['warn'](_0x1e3562(0x262)+_0x1b2612);return;}console[_0x1e3562(0x1d9)]('[WebRTC\x20Appliance]\x20Stopping\x20session:\x20'+_0x1b2612+_0x1e3562(0x1f6)+_0x5d16fb['topic']);try{this[_0x1e3562(0x263)]&&this[_0x1e3562(0x263)][_0x1e3562(0x250)]===this['serverWs'][_0x1e3562(0x27b)]&&this[_0x1e3562(0x263)][_0x1e3562(0x240)](JSON[_0x1e3562(0x27d)]({'op':'webrtc_stop_session','session_id':_0x1b2612})),_0x5d16fb[_0x1e3562(0x201)]&&_0x5d16fb[_0x1e3562(0x201)]['stop'](),_0x5d16fb[_0x1e3562(0x1df)]&&_0x5d16fb[_0x1e3562(0x1df)][_0x1e3562(0x267)]();}catch(_0x2b6ca5){console[_0x1e3562(0x25b)](_0x1e3562(0x1e9)+_0x2b6ca5);}this['cleanupSession'](_0x1b2612);}['cleanupSession'](_0x2d39e9){const _0x1afbf4=a6_0x246b64,_0x23ec3b=this[_0x1afbf4(0x1f7)][_0x1afbf4(0x1cc)](_0x2d39e9);if(_0x23ec3b){const _0x3684cb=this['topicSessions'][_0x1afbf4(0x1cc)](_0x23ec3b[_0x1afbf4(0x1d2)]);_0x3684cb&&(_0x3684cb[_0x1afbf4(0x260)](_0x2d39e9),_0x3684cb[_0x1afbf4(0x220)]===0x0&&this[_0x1afbf4(0x27e)][_0x1afbf4(0x260)](_0x23ec3b[_0x1afbf4(0x1d2)])),this[_0x1afbf4(0x26f)](_0x23ec3b[_0x1afbf4(0x1d2)]);}this[_0x1afbf4(0x1f7)][_0x1afbf4(0x260)](_0x2d39e9),console[_0x1afbf4(0x1d9)](_0x1afbf4(0x1fb)+_0x2d39e9);}[a6_0x246b64(0x1da)](){const _0x4f6210=a6_0x246b64;console[_0x4f6210(0x1d9)]('[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions');const _0x2c3f80=Array['from'](this[_0x4f6210(0x1f7)][_0x4f6210(0x255)]());_0x2c3f80[_0x4f6210(0x288)](_0x3195b1=>this[_0x4f6210(0x28b)](_0x3195b1));}[a6_0x246b64(0x254)](){const _0x101e59=a6_0x246b64,_0x51bbaa=[];for(const [_0x15846b,_0x44015f]of this[_0x101e59(0x1f7)]){_0x51bbaa[_0x101e59(0x1fa)]({'sessionId':_0x15846b,'topic':_0x44015f[_0x101e59(0x1d2)],'connectionState':_0x44015f[_0x101e59(0x1df)]?.[_0x101e59(0x1d7)]||_0x101e59(0x1d3),'hasVideoTrack':!!_0x44015f[_0x101e59(0x201)]});}return _0x51bbaa;}['getSharedVideoSources'](){const _0x2c39b8=a6_0x246b64,_0x18048c=[];for(const [_0x4c6253,_0x3d4655]of this[_0x2c39b8(0x28f)]){_0x18048c[_0x2c39b8(0x1fa)]({'topic':_0x4c6253,'frameCount':_0x3d4655[_0x2c39b8(0x23c)],'hasVideoSource':!!_0x3d4655[_0x2c39b8(0x1e1)],'hasRosSubscriber':!!_0x3d4655[_0x2c39b8(0x24d)]});}return _0x18048c;}}function a6_0x2e3b(){const _0x18aee1=['framerate','#1a1a1a','fillStyle','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','error','font','[WebRTC\x20Appliance]\x20Topic\x20','height','#00ff00','delete','updateTurnCredentials','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','serverWs','includes','onFrame','canvas','close','[WebRTC\x20Appliance]\x20Created\x20answer','11294iyhySY','\x20initialized\x20successfully','isDepthTopic','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','514496lxiJCr','releaseSharedVideoSource','setRemoteDescription','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20',',\x20cleaning\x20up\x20shared\x20resources','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','\x20connection\x20failed,\x20stopping\x20session','webrtc_init_session','compressed','539384DePIzS','subscribe','#666','OPEN','drawLoadingPattern','stringify','topicSessions','5062356tigtuA','serverUrl','cleanupSession','16px\x20Arial','Topic:\x20','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','getIceServers','publish','sendFrameToVideoSource','forEach','rgba(0,\x20170,\x20255,\x20','protocol','stopSession','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','connected','stun:stun1.l.google.com:19302','sharedVideoSources','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','\x20image,\x20trying\x20message\x20types:','webrtc_','warn','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','min','rgba(0,\x200,\x200,\x200.7)','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','/compressedDepth','get','color','fillRect','msg','10px\x20monospace','center','topic','unknown','📹\x20Color','addIceCandidate','round','connectionState','updateCanvasWithImageData','log','stopAllSessions','depthProcessor','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','message','12px\x20Arial','peerConnection','75PdZqhD','videoSource','split','rosbridgeWs','now','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','sensor_msgs/Image','pop','handleOffer','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','#00aaff','/compressed','/image_raw','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','closed','apply','subscribeToROSTopic','base64','getContext','random','constructor','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','\x20for\x20topic:\x20','activeSessions','980298gsJjWR','(((.+)+)+)+$','push','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','width','sensor_msgs/CompressedImage','getOrCreateSharedVideoSource','video','addEventListener','videoTrack','#00ffff','createAnswer','toLocaleTimeString','beginPath','offer','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Session\x20','\x20sessions)','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','\x20connection\x20state:\x20',',\x20trying\x20alternative\x20depth\x20topics','set','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','webrtc_answer','removeEventListener','failed','replace','webrtc_ice_candidate','session_id','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','webrtc','initializing','handleIceCandidate','[WebRTC\x20Appliance]\x20Service\x20initialized','webrtc_offer','getImageData','\x20successfully\x20connected!','has','#ffffff','\x20bytes','size','depth','initializeSession','data','sharp','webrtc_stop_session','processDepthImage','18IQKtDb','🔍\x20Depth','type','620qubLeA','fillText','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','7lZBLWm','compressed_depth_image_transport/CompressedDepthImage','#888','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','rtcConfig','parse','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','setLocalDescription','24px\x20Arial','search','stun:stun.l.google.com:19302','/9j/','/image','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','\x20connection\x20closed,\x20cleaning\x20up','frameCount','from','initialize','wrtc','send','length','../config','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','startsWith','processColorImage','📹\x20Processing\x20video...','92955BnxYcf','onconnectionstatechange','onicecandidate','5SqXlHC','unsubscribe','textAlign','rosSubscriber','sensor_msgs/msg/Image','Waiting\x20for\x20ROS\x20image\x20data...','readyState','27577EniFsI','sensor_msgs/msg/CompressedImage','convertRGBAtoI420','getActiveSessions','keys','candidate'];a6_0x2e3b=function(){return _0x18aee1;};return a6_0x2e3b();}function a6_0x1980(_0x2cf303,_0x2971df){const _0x2261b2=a6_0x2e3b();return a6_0x1980=function(_0xbd99b3,_0x1dbb54){_0xbd99b3=_0xbd99b3-0x1c9;let _0x2e3b66=_0x2261b2[_0xbd99b3];return _0x2e3b66;},a6_0x1980(_0x2cf303,_0x2971df);}module['exports']=new ApplianceWebRTCService();