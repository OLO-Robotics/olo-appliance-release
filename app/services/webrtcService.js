function a6_0x5ca1(_0x254461,_0x3e8faf){const _0x39ccc4=a6_0x27fa();return a6_0x5ca1=function(_0x290e1c,_0x488571){_0x290e1c=_0x290e1c-0x157;let _0x27fa1e=_0x39ccc4[_0x290e1c];return _0x27fa1e;},a6_0x5ca1(_0x254461,_0x3e8faf);}const a6_0x5ad088=a6_0x5ca1;(function(_0x4ee1eb,_0x435d77){const _0x49a8c9=a6_0x5ca1,_0x512950=_0x4ee1eb();while(!![]){try{const _0xa9c63a=-parseInt(_0x49a8c9(0x15f))/0x1*(-parseInt(_0x49a8c9(0x1e3))/0x2)+-parseInt(_0x49a8c9(0x1b6))/0x3+parseInt(_0x49a8c9(0x216))/0x4+parseInt(_0x49a8c9(0x1ea))/0x5+-parseInt(_0x49a8c9(0x202))/0x6+-parseInt(_0x49a8c9(0x179))/0x7+parseInt(_0x49a8c9(0x1b3))/0x8*(parseInt(_0x49a8c9(0x20b))/0x9);if(_0xa9c63a===_0x435d77)break;else _0x512950['push'](_0x512950['shift']());}catch(_0x534d88){_0x512950['push'](_0x512950['shift']());}}}(a6_0x27fa,0x59397));function a6_0x27fa(){const _0x1e3606=['[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','webrtc_offer','push','center','rosSubscriber','\x20connection\x20closed,\x20cleaning\x20up','\x20successfully\x20connected!','data','min','stun:stun1.l.google.com:19302','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','candidate','color','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','sendFrameToVideoSource','fillStyle','videoTrack','delete','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)',',\x20converting\x20to\x20base64...','publish','stopAllSessions','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','unsubscribe','onconnectionstatechange','type','function','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','\x20initialized\x20successfully','set','setLocalDescription','sensor_msgs/CompressedImage','ðŸ“¹\x20Processing\x20video...','unknown','onFrame','exports','onicecandidate','webrtc_init_session','width','initializeSession','toString','125776wkTwWa','msg','12px\x20monospace','247776GdJzDP','port',',\x20trying\x20alternative\x20depth\x20topics','#00aaff','16px\x20Arial','handleMessage','video','addEventListener','webrtc_ice_candidate','get','startsWith','readyState','ðŸ¤–\x20Robot\x20Camera','/compressedDepth','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','constructor','initialize','depth','[WebRTC\x20Appliance]\x20Created\x20answer','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','peerConnection','search','#888','processDepthImage','address','\x20connection\x20state:\x20','warn','length','add','apply','message','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','webrtc_','close','failed','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','updateCanvasWithImageData','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','addIceCandidate','height','[WebRTC\x20Appliance]\x20Session\x20','Topic:\x20','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','processColorImage','16JqyTdb','\x20image,\x20trying\x20message\x20types:','sharedVideoSources','\x20sessions)','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','\x20connection\x20failed,\x20stopping\x20session','298710rRYMCt','serverUrl','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','stun:stun.l.google.com:19302','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','compressed','getContext','topicSessions','activeSessions','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','rtcConfig','updateTurnCredentials','replace','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','font','handleIceCandidate','drawLoadingPattern','convertRGBAtoI420','connectionState','/image_raw','\x20for\x20topic:\x20','(((.+)+)+)+$','pop','3028530gFPUbE','rgba(0,\x20170,\x20255,\x20','arc','now','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','rosbridgeWs','random','#ffffff','fillText','306rGViIs','compressedDepth','forEach','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','stringify','frameCount','getIceServers','serverWs','/image','includes','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','2583604cBPUSi','wrtc','24px\x20Arial','webrtc_answer','textAlign','releaseSharedVideoSource','framerate','/9j/','initializing',',\x20size:\x20','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20',',\x20cleaning\x20up\x20shared\x20resources','videoSource','#00ffff','stopSession','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','ðŸ”\x20Depth','fill','round','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','log','fillRect','has','isDepthTopic','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','iceServers','toLocaleTimeString','setRemoteDescription','Waiting\x20for\x20ROS\x20image\x20data...','parse','from','size','22009uZwDYD','getOrCreateSharedVideoSource','subscribeToROSTopic','OPEN','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','sensor_msgs/msg/CompressedImage','sharp','cleanupSession','error','send','sensor_msgs/msg/Image','handleOffer','createAnswer','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','topic','canvas','./turnCredentialsService','rgba(0,\x200,\x200,\x200.7)','split','#1a1a1a','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','webrtc','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','stop','\x20with\x20message\x20type\x20','depthProcessor','3244171RuADsd','../config','webrtc_stop_session','putImageData','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','max','session_id','\x20sessions\x20remaining)','[WebRTC\x20Appliance]\x20Topic\x20','base64','sensor_msgs/Image','12px\x20Arial','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','subscribe','\x20bytes'];a6_0x27fa=function(){return _0x1e3606;};return a6_0x27fa();}const a6_0x488571=(function(){let _0x562475=!![];return function(_0x7b605a,_0x3faef9){const _0x2310dc=_0x562475?function(){const _0xc2e58a=a6_0x5ca1;if(_0x3faef9){const _0x3df59f=_0x3faef9[_0xc2e58a(0x1d3)](_0x7b605a,arguments);return _0x3faef9=null,_0x3df59f;}}:function(){};return _0x562475=![],_0x2310dc;};}()),a6_0x290e1c=a6_0x488571(this,function(){const _0x523801=a6_0x5ca1;return a6_0x290e1c['toString']()[_0x523801(0x1cb)](_0x523801(0x200))[_0x523801(0x1b2)]()[_0x523801(0x1c5)](a6_0x290e1c)['search'](_0x523801(0x200));});a6_0x290e1c();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x5ad088(0x217)),sharp=require(a6_0x5ad088(0x165)),config=require(a6_0x5ad088(0x17a)),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require(a6_0x5ad088(0x16f));class ApplianceWebRTCService{constructor(){const _0x3a154f=a6_0x5ad088;this[_0x3a154f(0x1f2)]=new Map(),this['topicSessions']=new Map(),this[_0x3a154f(0x1e5)]=new Map(),this[_0x3a154f(0x207)]=null,this[_0x3a154f(0x212)]=null,this['depthProcessor']=new DepthImageProcessor(),this['rtcConfig']={'iceServers':[{'urls':_0x3a154f(0x1ed)},{'urls':_0x3a154f(0x191)}]};}[a6_0x5ad088(0x1c6)](_0x104bc0,_0x4dbfd8){const _0xcf510f=a6_0x5ad088;this['rosbridgeWs']=_0x104bc0,this[_0xcf510f(0x212)]=_0x4dbfd8,turnCredentialsService['initialize'](config[_0xcf510f(0x1eb)]),this[_0xcf510f(0x1f5)](),console['log']('[WebRTC\x20Appliance]\x20Service\x20initialized');}async['updateTurnCredentials'](){const _0x198339=a6_0x5ad088;try{console[_0x198339(0x22a)](_0x198339(0x1ec));const _0x2cbb22=await turnCredentialsService[_0x198339(0x211)]();this['rtcConfig'][_0x198339(0x158)]=_0x2cbb22,console[_0x198339(0x22a)](_0x198339(0x16c));}catch(_0x2c6ac8){console[_0x198339(0x167)](_0x198339(0x1c9),_0x2c6ac8),console[_0x198339(0x22a)](_0x198339(0x196));}}[a6_0x5ad088(0x1bb)](_0x4d0b5a){const _0x3ddee5=a6_0x5ad088;if(!_0x4d0b5a['op']||!_0x4d0b5a['op'][_0x3ddee5(0x1c0)](_0x3ddee5(0x1d7)))return![];console['log'](_0x3ddee5(0x1e1)+_0x4d0b5a['op']);switch(_0x4d0b5a['op']){case _0x3ddee5(0x1af):this['initializeSession'](_0x4d0b5a[_0x3ddee5(0x17f)],_0x4d0b5a['topic']);return!![];case _0x3ddee5(0x189):this[_0x3ddee5(0x16a)](_0x4d0b5a[_0x3ddee5(0x17f)],_0x4d0b5a['offer']);return!![];case _0x3ddee5(0x1be):this[_0x3ddee5(0x1fa)](_0x4d0b5a[_0x3ddee5(0x17f)],_0x4d0b5a['candidate']);return!![];case _0x3ddee5(0x17b):this[_0x3ddee5(0x224)](_0x4d0b5a[_0x3ddee5(0x17f)]);return!![];default:console[_0x3ddee5(0x1d0)](_0x3ddee5(0x229)+_0x4d0b5a['op']);return![];}}[a6_0x5ad088(0x160)](_0x18e82c){const _0x59f9e8=a6_0x5ad088;if(this[_0x59f9e8(0x1e5)][_0x59f9e8(0x22c)](_0x18e82c)){const _0x10812f=this[_0x59f9e8(0x1e5)][_0x59f9e8(0x1bf)](_0x18e82c);return _0x10812f['frameCount']++,console['log'](_0x59f9e8(0x1d6)+_0x18e82c+'\x20('+_0x10812f[_0x59f9e8(0x210)]+_0x59f9e8(0x1e6)),_0x10812f;}console[_0x59f9e8(0x22a)]('[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x18e82c);const {createCanvas:_0x42ad30}=require('canvas'),_0x1a4662=_0x42ad30(config[_0x59f9e8(0x174)][_0x59f9e8(0x1bc)]['width'],config[_0x59f9e8(0x174)][_0x59f9e8(0x1bc)]['height']),_0x2580df=_0x1a4662[_0x59f9e8(0x1f0)]('2d');this[_0x59f9e8(0x1fb)](_0x1a4662,_0x2580df);const {RTCVideoSource:_0x684007}=nonstandard,_0x3b3e3e=new _0x684007();let _0x3cd97b=0x0;const _0x504594=0x3e8/config['webrtc'][_0x59f9e8(0x1bc)][_0x59f9e8(0x21c)],_0x4ff939=this[_0x59f9e8(0x161)](_0x18e82c,_0x493838=>{const _0x384e40=_0x59f9e8,_0x7e7bf4=Date[_0x384e40(0x205)]();_0x7e7bf4-_0x3cd97b>=_0x504594&&(_0x3cd97b=_0x7e7bf4,this[_0x384e40(0x1db)](_0x1a4662,_0x2580df,_0x493838,_0x18e82c,_0x3b3e3e));}),_0x4d691f={'videoSource':_0x3b3e3e,'canvas':_0x1a4662,'rosSubscriber':_0x4ff939,'frameCount':0x1,'topic':_0x18e82c};return this[_0x59f9e8(0x1e5)][_0x59f9e8(0x1a7)](_0x18e82c,_0x4d691f),_0x4d691f;}[a6_0x5ad088(0x21b)](_0x59f240){const _0x2874b6=a6_0x5ad088,_0x4eae25=this[_0x2874b6(0x1e5)][_0x2874b6(0x1bf)](_0x59f240);if(!_0x4eae25)return;_0x4eae25['frameCount']--,console[_0x2874b6(0x22a)](_0x2874b6(0x1a5)+_0x59f240+'\x20('+_0x4eae25[_0x2874b6(0x210)]+_0x2874b6(0x180)),_0x4eae25[_0x2874b6(0x210)]<=0x0&&(console['log'](_0x2874b6(0x175)+_0x59f240+_0x2874b6(0x221)),_0x4eae25[_0x2874b6(0x222)]&&(_0x4eae25['videoSource']=null),_0x4eae25[_0x2874b6(0x18c)]&&_0x4eae25[_0x2874b6(0x18c)][_0x2874b6(0x1a1)](),this[_0x2874b6(0x1e5)]['delete'](_0x59f240));}async[a6_0x5ad088(0x1b1)](_0x1b7998,_0x39ab2e){const _0x818418=a6_0x5ad088;try{console[_0x818418(0x22a)](_0x818418(0x1f7)+_0x1b7998+'\x20for\x20topic\x20'+_0x39ab2e);const _0x33c453=this['getOrCreateSharedVideoSource'](_0x39ab2e),_0x3bb90f=new RTCPeerConnection(this[_0x818418(0x1f4)]),_0x4e261f=_0x33c453[_0x818418(0x222)]['createTrack']({'width':config[_0x818418(0x174)]['video']['width'],'height':config['webrtc'][_0x818418(0x1bc)][_0x818418(0x1de)],'framerate':config[_0x818418(0x174)][_0x818418(0x1bc)]['framerate']});console['log']('[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20'+_0x1b7998);const {MediaStream:_0x5a9b3b}=require('wrtc'),_0x4566f1=new _0x5a9b3b([_0x4e261f]);_0x3bb90f['addTrack'](_0x4e261f,_0x4566f1),this[_0x818418(0x198)](_0x33c453[_0x818418(0x222)],_0x33c453[_0x818418(0x16e)]),_0x3bb90f[_0x818418(0x1ae)]=_0x1c041d=>{const _0x2b7408=_0x818418;if(_0x1c041d[_0x2b7408(0x193)]&&this['serverWs'])console[_0x2b7408(0x22a)](_0x2b7408(0x1f3)+_0x1b7998+':',{'type':_0x1c041d[_0x2b7408(0x193)][_0x2b7408(0x1a3)],'protocol':_0x1c041d[_0x2b7408(0x193)]['protocol'],'address':_0x1c041d[_0x2b7408(0x193)][_0x2b7408(0x1ce)],'port':_0x1c041d[_0x2b7408(0x193)][_0x2b7408(0x1b7)]}),this[_0x2b7408(0x212)][_0x2b7408(0x168)](JSON[_0x2b7408(0x20f)]({'op':'webrtc_ice_candidate','session_id':_0x1b7998,'candidate':_0x1c041d['candidate']}));else!_0x1c041d[_0x2b7408(0x193)]&&console[_0x2b7408(0x22a)]('[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20'+_0x1b7998);},_0x3bb90f[_0x818418(0x1a2)]=()=>{const _0x24becd=_0x818418;console[_0x24becd(0x22a)](_0x24becd(0x1df)+_0x1b7998+_0x24becd(0x1cf)+_0x3bb90f['connectionState']);if(_0x3bb90f[_0x24becd(0x1fd)]==='connected')console[_0x24becd(0x22a)](_0x24becd(0x1df)+_0x1b7998+_0x24becd(0x18e));else{if(_0x3bb90f[_0x24becd(0x1fd)]===_0x24becd(0x1d9))console[_0x24becd(0x22a)](_0x24becd(0x1df)+_0x1b7998+_0x24becd(0x1e9)),this[_0x24becd(0x224)](_0x1b7998);else _0x3bb90f[_0x24becd(0x1fd)]==='closed'&&(console[_0x24becd(0x22a)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x1b7998+_0x24becd(0x18d)),this[_0x24becd(0x166)](_0x1b7998));}},this[_0x818418(0x1f2)][_0x818418(0x1a7)](_0x1b7998,{'peerConnection':_0x3bb90f,'topic':_0x39ab2e,'videoTrack':_0x4e261f,'mediaStream':_0x4566f1,'status':_0x818418(0x21e)}),!this[_0x818418(0x1f1)]['has'](_0x39ab2e)&&this[_0x818418(0x1f1)]['set'](_0x39ab2e,new Set()),this[_0x818418(0x1f1)][_0x818418(0x1bf)](_0x39ab2e)[_0x818418(0x1d2)](_0x1b7998),console[_0x818418(0x22a)](_0x818418(0x1df)+_0x1b7998+_0x818418(0x1a6)),console[_0x818418(0x22a)](_0x818418(0x1f8)+_0x39ab2e+':\x20'+this['topicSessions']['get'](_0x39ab2e)['size']);}catch(_0x3ea0cb){console[_0x818418(0x167)](_0x818418(0x225)+_0x1b7998+':',_0x3ea0cb),this[_0x818418(0x224)](_0x1b7998);}}async[a6_0x5ad088(0x16a)](_0x3157c3,_0x24c578){const _0x377c9b=a6_0x5ad088,_0x2b10b9=this[_0x377c9b(0x1f2)]['get'](_0x3157c3);if(!_0x2b10b9){console[_0x377c9b(0x167)](_0x377c9b(0x1a0)+_0x3157c3);return;}try{console[_0x377c9b(0x22a)](_0x377c9b(0x20e)+_0x3157c3),await _0x2b10b9['peerConnection'][_0x377c9b(0x15a)](new RTCSessionDescription(_0x24c578)),console[_0x377c9b(0x22a)]('[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)');const _0x2bc760=await _0x2b10b9[_0x377c9b(0x1ca)][_0x377c9b(0x16b)]();console['log'](_0x377c9b(0x1c8)),await _0x2b10b9[_0x377c9b(0x1ca)][_0x377c9b(0x1a8)](_0x2bc760),console['log'](_0x377c9b(0x19c)),this['serverWs']&&(this[_0x377c9b(0x212)][_0x377c9b(0x168)](JSON[_0x377c9b(0x20f)]({'op':_0x377c9b(0x219),'session_id':_0x3157c3,'answer':_0x2bc760})),console['log'](_0x377c9b(0x188)+_0x3157c3));}catch(_0x5c7e46){console[_0x377c9b(0x167)](_0x377c9b(0x195)+_0x3157c3+':',_0x5c7e46),this[_0x377c9b(0x224)](_0x3157c3);}}async[a6_0x5ad088(0x1fa)](_0x461e3a,_0x5f170e){const _0x1f6f66=a6_0x5ad088,_0x269c58=this[_0x1f6f66(0x1f2)][_0x1f6f66(0x1bf)](_0x461e3a);if(!_0x269c58){console[_0x1f6f66(0x167)](_0x1f6f66(0x1e7)+_0x461e3a);return;}try{await _0x269c58[_0x1f6f66(0x1ca)][_0x1f6f66(0x1dd)](new RTCIceCandidate(_0x5f170e)),console[_0x1f6f66(0x22a)]('[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20'+_0x461e3a);}catch(_0x221421){console[_0x1f6f66(0x167)](_0x1f6f66(0x1e8)+_0x461e3a+':',_0x221421);}}[a6_0x5ad088(0x161)](_0x48c14f,_0x242e4a){const _0x2d2443=a6_0x5ad088;if(!this['rosbridgeWs']||this['rosbridgeWs']['readyState']!==this[_0x2d2443(0x207)][_0x2d2443(0x162)])return console[_0x2d2443(0x167)](_0x2d2443(0x1ee)),null;console[_0x2d2443(0x22a)](_0x2d2443(0x206)+_0x48c14f);const _0x465937=_0x48c14f[_0x2d2443(0x214)](_0x2d2443(0x1c7)),_0x1a31e0=_0x48c14f[_0x2d2443(0x214)](_0x2d2443(0x1ef))||_0x48c14f[_0x2d2443(0x214)](_0x2d2443(0x20c));let _0x4e485c=[];_0x465937?_0x1a31e0?_0x4e485c=['sensor_msgs/CompressedImage',_0x2d2443(0x164),'compressed_depth_image_transport/CompressedDepthImage',_0x2d2443(0x183)]:_0x4e485c=['sensor_msgs/Image',_0x2d2443(0x169),_0x2d2443(0x1a9)]:_0x4e485c=['sensor_msgs/CompressedImage','sensor_msgs/msg/CompressedImage','sensor_msgs/Image'];console[_0x2d2443(0x22a)](_0x2d2443(0x181)+_0x48c14f+'\x20detected\x20as\x20'+(_0x465937?_0x2d2443(0x1c7):_0x2d2443(0x194))+_0x2d2443(0x1e4),_0x4e485c);const _0x3d0d6c=[];let _0x59403f=![];const _0x297161=_0x417d97=>{return _0x36551a=>{const _0x491b04=a6_0x5ca1;try{const _0x3f963d=JSON[_0x491b04(0x15c)](_0x36551a['data']);_0x3f963d['op']==='publish'&&_0x3f963d[_0x491b04(0x16d)]===_0x48c14f&&_0x3f963d[_0x491b04(0x1b4)]&&(!_0x59403f&&(console[_0x491b04(0x22a)](_0x491b04(0x185)+_0x48c14f+_0x491b04(0x177)+_0x417d97),_0x59403f=!![]),_0x242e4a(_0x3f963d[_0x491b04(0x1b4)]));}catch(_0x2c525b){console[_0x491b04(0x167)](_0x491b04(0x157),_0x2c525b);}};};for(const _0xba7fbc of _0x4e485c){const _0x2d5005={'op':'subscribe','topic':_0x48c14f,'type':_0xba7fbc};console[_0x2d2443(0x22a)](_0x2d2443(0x17d)+_0xba7fbc),this['rosbridgeWs'][_0x2d2443(0x168)](JSON[_0x2d2443(0x20f)](_0x2d5005));const _0x244737=_0x297161(_0xba7fbc);this['rosbridgeWs'][_0x2d2443(0x1bd)]('message',_0x244737),_0x3d0d6c[_0x2d2443(0x18a)]({'handler':_0x244737,'type':_0xba7fbc});}return _0x465937&&_0x1a31e0&&setTimeout(()=>{const _0x56801c=_0x2d2443;if(!_0x59403f){console[_0x56801c(0x22a)](_0x56801c(0x1da)+_0x48c14f+_0x56801c(0x1b8));const _0x28b406=_0x48c14f[_0x56801c(0x1f6)](_0x56801c(0x1c3),'')[_0x56801c(0x1f6)]('/compressed',''),_0x6a6b7=[_0x28b406+'/image_raw',_0x28b406+_0x56801c(0x213),_0x28b406];for(const _0x424e67 of _0x6a6b7){console[_0x56801c(0x22a)](_0x56801c(0x163)+_0x424e67);const _0x2a07b3={'op':_0x56801c(0x186),'topic':_0x424e67,'type':_0x56801c(0x183)};this[_0x56801c(0x207)][_0x56801c(0x168)](JSON[_0x56801c(0x20f)](_0x2a07b3));const _0x3db329=_0x216262=>{const _0x5cbc27=_0x56801c;try{const _0x2ddf86=JSON[_0x5cbc27(0x15c)](_0x216262[_0x5cbc27(0x18f)]);_0x2ddf86['op']===_0x5cbc27(0x19e)&&_0x2ddf86[_0x5cbc27(0x16d)]===_0x424e67&&_0x2ddf86[_0x5cbc27(0x1b4)]&&(console[_0x5cbc27(0x22a)](_0x5cbc27(0x220)+_0x424e67+_0x5cbc27(0x19d)),_0x2ddf86[_0x5cbc27(0x1b4)]['data']&&!_0x2ddf86['msg'][_0x5cbc27(0x18f)][_0x5cbc27(0x1c0)](_0x5cbc27(0x21d))&&_0x242e4a(_0x2ddf86['msg']));}catch(_0x3e0810){console[_0x5cbc27(0x167)](_0x5cbc27(0x1c4),_0x3e0810);}};this[_0x56801c(0x207)][_0x56801c(0x1bd)](_0x56801c(0x1d4),_0x3db329),_0x3d0d6c['push']({'handler':_0x3db329,'type':_0x56801c(0x183),'topic':_0x424e67});}}},0xbb8),{'unsubscribe':()=>{const _0x2d2262=_0x2d2443;for(const {handler:_0x481148,type:_0x7ff1a5,topic:_0xcb018b}of _0x3d0d6c){this[_0x2d2262(0x207)]['removeEventListener']('message',_0x481148),this[_0x2d2262(0x207)][_0x2d2262(0x1c1)]===this['rosbridgeWs'][_0x2d2262(0x162)]&&this[_0x2d2262(0x207)][_0x2d2262(0x168)](JSON[_0x2d2262(0x20f)]({'op':_0x2d2262(0x1a1),'topic':_0xcb018b||_0x48c14f}));}}};}[a6_0x5ad088(0x1fb)](_0x2819e3,_0x550838){const _0x2d8daa=a6_0x5ad088;_0x550838['fillStyle']=_0x2d8daa(0x172),_0x550838[_0x2d8daa(0x22b)](0x0,0x0,_0x2819e3[_0x2d8daa(0x1b0)],_0x2819e3[_0x2d8daa(0x1de)]),_0x550838[_0x2d8daa(0x199)]=_0x2d8daa(0x1b9),_0x550838[_0x2d8daa(0x1f9)]=_0x2d8daa(0x218),_0x550838['textAlign']=_0x2d8daa(0x18b),_0x550838[_0x2d8daa(0x20a)](_0x2d8daa(0x1c2),_0x2819e3[_0x2d8daa(0x1b0)]/0x2,_0x2819e3['height']/0x2-0x14),_0x550838['fillStyle']=_0x2d8daa(0x209),_0x550838['font']=_0x2d8daa(0x1ba),_0x550838['fillText'](_0x2d8daa(0x15b),_0x2819e3[_0x2d8daa(0x1b0)]/0x2,_0x2819e3[_0x2d8daa(0x1de)]/0x2+0x14);const _0x25492f=Date[_0x2d8daa(0x205)]()/0x3e8;for(let _0x287cc6=0x0;_0x287cc6<0x3;_0x287cc6++){const _0x2199fa=(Math['sin'](_0x25492f*0x2+_0x287cc6*0.5)+0x1)/0x2;_0x550838[_0x2d8daa(0x199)]=_0x2d8daa(0x203)+_0x2199fa*0.5+')',_0x550838['beginPath'](),_0x550838[_0x2d8daa(0x204)](_0x2819e3[_0x2d8daa(0x1b0)]/0x2-0x28+_0x287cc6*0x28,_0x2819e3[_0x2d8daa(0x1de)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x550838[_0x2d8daa(0x227)]();}}[a6_0x5ad088(0x198)](_0x494792,_0x1eafc1){const _0x5c8c6b=a6_0x5ad088;try{if(!_0x494792||!_0x1eafc1)return;const _0x1cccd4=_0x1eafc1[_0x5c8c6b(0x1f0)]('2d'),_0x3c9456=_0x1cccd4['getImageData'](0x0,0x0,_0x1eafc1[_0x5c8c6b(0x1b0)],_0x1eafc1[_0x5c8c6b(0x1de)]),_0x3d398a=this['convertRGBAtoI420'](_0x3c9456[_0x5c8c6b(0x18f)],_0x1eafc1[_0x5c8c6b(0x1b0)],_0x1eafc1[_0x5c8c6b(0x1de)]),_0x269f88={'width':_0x1eafc1[_0x5c8c6b(0x1b0)],'height':_0x1eafc1[_0x5c8c6b(0x1de)],'data':_0x3d398a};typeof _0x494792[_0x5c8c6b(0x1ac)]===_0x5c8c6b(0x1a4)&&_0x494792[_0x5c8c6b(0x1ac)](_0x269f88);}catch(_0x2b6661){console[_0x5c8c6b(0x167)](_0x5c8c6b(0x1d5),_0x2b6661);}}[a6_0x5ad088(0x1fc)](_0x2b4305,_0x44adae,_0x3b2bc6){const _0x164350=a6_0x5ad088,_0x471021=_0x44adae*_0x3b2bc6,_0x189d9c=_0x44adae*_0x3b2bc6/0x4,_0x4940e5=new Uint8Array(_0x471021+_0x189d9c*0x2);let _0x1f6d19=0x0,_0x5a5f42=_0x471021,_0x23db73=_0x471021+_0x189d9c;for(let _0x59b379=0x0;_0x59b379<_0x3b2bc6;_0x59b379++){for(let _0x3dfd5f=0x0;_0x3dfd5f<_0x44adae;_0x3dfd5f++){const _0x24f340=(_0x59b379*_0x44adae+_0x3dfd5f)*0x4,_0x332ba6=_0x2b4305[_0x24f340],_0x561d1e=_0x2b4305[_0x24f340+0x1],_0xda70fd=_0x2b4305[_0x24f340+0x2],_0x9deed4=Math[_0x164350(0x228)](0.299*_0x332ba6+0.587*_0x561d1e+0.114*_0xda70fd);_0x4940e5[_0x1f6d19++]=_0x9deed4;if(_0x59b379%0x2===0x0&&_0x3dfd5f%0x2===0x0){const _0x5277ad=Math[_0x164350(0x228)](-0.169*_0x332ba6-0.331*_0x561d1e+0.5*_0xda70fd+0x80),_0x1572b5=Math[_0x164350(0x228)](0.5*_0x332ba6-0.419*_0x561d1e-0.081*_0xda70fd+0x80);_0x4940e5[_0x5a5f42++]=Math['max'](0x0,Math[_0x164350(0x190)](0xff,_0x5277ad)),_0x4940e5[_0x23db73++]=Math[_0x164350(0x17e)](0x0,Math['min'](0xff,_0x1572b5));}}}return _0x4940e5;}async['updateCanvasWithImageData'](_0x3d2126,_0x30e35f,_0x4eb4fb,_0x126874,_0xcd3860){const _0x4a4067=a6_0x5ad088;try{if(!_0x4eb4fb||!_0x4eb4fb[_0x4a4067(0x18f)])return;Math['random']()<0.01&&console[_0x4a4067(0x22a)](_0x4a4067(0x192)+_0x126874+_0x4a4067(0x21f)+_0x4eb4fb[_0x4a4067(0x18f)][_0x4a4067(0x1d1)]+_0x4a4067(0x187));const _0x54f199=Buffer[_0x4a4067(0x15d)](_0x4eb4fb[_0x4a4067(0x18f)],_0x4a4067(0x182)),_0x4ac92e=this['depthProcessor'][_0x4a4067(0x22d)](_0x126874);let _0x5a6cd9;_0x4ac92e?_0x5a6cd9=await this[_0x4a4067(0x178)][_0x4a4067(0x1cd)](_0x54f199,_0x3d2126,_0x30e35f,_0x126874):_0x5a6cd9=await this['depthProcessor'][_0x4a4067(0x1e2)](_0x54f199,_0x3d2126,_0x30e35f),_0x30e35f[_0x4a4067(0x17c)](_0x5a6cd9,0x0,0x0),_0x30e35f[_0x4a4067(0x199)]=_0x4a4067(0x170),_0x30e35f[_0x4a4067(0x22b)](0xa,0xa,0xdc,0x32),_0x30e35f[_0x4a4067(0x199)]=_0x4ac92e?_0x4a4067(0x223):'#00ff00',_0x30e35f[_0x4a4067(0x1f9)]=_0x4a4067(0x1b5),_0x30e35f[_0x4a4067(0x20a)]((_0x4ac92e?_0x4a4067(0x226):'ðŸ“¹\x20Color')+':\x20'+new Date()[_0x4a4067(0x159)](),0xf,0x1c),_0x30e35f[_0x4a4067(0x199)]='#ffffff',_0x30e35f['font']='10px\x20monospace',_0x30e35f[_0x4a4067(0x20a)](_0x4a4067(0x1e0)+_0x126874[_0x4a4067(0x171)]('/')[_0x4a4067(0x201)](),0xf,0x2d),this['sendFrameToVideoSource'](_0xcd3860,_0x3d2126);}catch(_0xb7ce6e){console[_0x4a4067(0x1d0)](_0x4a4067(0x215)+_0x126874+':',_0xb7ce6e[_0x4a4067(0x1d4)]);_0x126874['includes'](_0x4a4067(0x1c7))&&Math[_0x4a4067(0x208)]()<0.1&&console[_0x4a4067(0x1d0)](_0x4a4067(0x197)+_0x126874['replace'](_0x4a4067(0x1c3),_0x4a4067(0x1fe)));_0x30e35f[_0x4a4067(0x199)]=_0x4a4067(0x172),_0x30e35f[_0x4a4067(0x22b)](0x0,0x0,_0x3d2126[_0x4a4067(0x1b0)],_0x3d2126[_0x4a4067(0x1de)]),_0x30e35f[_0x4a4067(0x199)]=_0x4a4067(0x1cc),_0x30e35f[_0x4a4067(0x1f9)]=_0x4a4067(0x1ba),_0x30e35f[_0x4a4067(0x21a)]='center';const _0x1a6700=_0x126874[_0x4a4067(0x214)](_0x4a4067(0x1c7))?'ðŸ”\x20Processing\x20depth...':_0x4a4067(0x1aa);_0x30e35f['fillText'](_0x1a6700,_0x3d2126[_0x4a4067(0x1b0)]/0x2,_0x3d2126[_0x4a4067(0x1de)]/0x2),_0x30e35f[_0x4a4067(0x199)]='#666',_0x30e35f[_0x4a4067(0x1f9)]=_0x4a4067(0x184),_0x30e35f[_0x4a4067(0x20a)](_0x4a4067(0x1e0)+_0x126874['split']('/')[_0x4a4067(0x201)](),_0x3d2126[_0x4a4067(0x1b0)]/0x2,_0x3d2126[_0x4a4067(0x1de)]/0x2+0x19),this['sendFrameToVideoSource'](_0xcd3860,_0x3d2126);}}[a6_0x5ad088(0x224)](_0x15e5a7){const _0x34afb8=a6_0x5ad088,_0x2f19d8=this[_0x34afb8(0x1f2)][_0x34afb8(0x1bf)](_0x15e5a7);if(!_0x2f19d8){console[_0x34afb8(0x1d0)](_0x34afb8(0x173)+_0x15e5a7);return;}console[_0x34afb8(0x22a)]('[WebRTC\x20Appliance]\x20Stopping\x20session:\x20'+_0x15e5a7+_0x34afb8(0x1ff)+_0x2f19d8[_0x34afb8(0x16d)]);try{this[_0x34afb8(0x212)]&&this[_0x34afb8(0x212)][_0x34afb8(0x1c1)]===this[_0x34afb8(0x212)][_0x34afb8(0x162)]&&this[_0x34afb8(0x212)][_0x34afb8(0x168)](JSON[_0x34afb8(0x20f)]({'op':_0x34afb8(0x17b),'session_id':_0x15e5a7})),_0x2f19d8[_0x34afb8(0x19a)]&&_0x2f19d8[_0x34afb8(0x19a)][_0x34afb8(0x176)](),_0x2f19d8[_0x34afb8(0x1ca)]&&_0x2f19d8[_0x34afb8(0x1ca)][_0x34afb8(0x1d8)]();}catch(_0x1f43c2){console[_0x34afb8(0x167)]('[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20'+_0x1f43c2);}this[_0x34afb8(0x166)](_0x15e5a7);}['cleanupSession'](_0x11ef41){const _0x3fe3e1=a6_0x5ad088,_0x247c6f=this[_0x3fe3e1(0x1f2)][_0x3fe3e1(0x1bf)](_0x11ef41);if(_0x247c6f){const _0x40d3cd=this[_0x3fe3e1(0x1f1)][_0x3fe3e1(0x1bf)](_0x247c6f[_0x3fe3e1(0x16d)]);_0x40d3cd&&(_0x40d3cd['delete'](_0x11ef41),_0x40d3cd[_0x3fe3e1(0x15e)]===0x0&&this['topicSessions'][_0x3fe3e1(0x19b)](_0x247c6f[_0x3fe3e1(0x16d)])),this[_0x3fe3e1(0x21b)](_0x247c6f[_0x3fe3e1(0x16d)]);}this[_0x3fe3e1(0x1f2)][_0x3fe3e1(0x19b)](_0x11ef41),console[_0x3fe3e1(0x22a)]('[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20'+_0x11ef41);}[a6_0x5ad088(0x19f)](){const _0x367deb=a6_0x5ad088;console[_0x367deb(0x22a)](_0x367deb(0x1dc));const _0x28d518=Array[_0x367deb(0x15d)](this[_0x367deb(0x1f2)]['keys']());_0x28d518[_0x367deb(0x20d)](_0xcdd3b3=>this[_0x367deb(0x224)](_0xcdd3b3));}['getActiveSessions'](){const _0x4e66d5=a6_0x5ad088,_0x5018e4=[];for(const [_0x367901,_0x10d533]of this[_0x4e66d5(0x1f2)]){_0x5018e4[_0x4e66d5(0x18a)]({'sessionId':_0x367901,'topic':_0x10d533[_0x4e66d5(0x16d)],'connectionState':_0x10d533[_0x4e66d5(0x1ca)]?.[_0x4e66d5(0x1fd)]||_0x4e66d5(0x1ab),'hasVideoTrack':!!_0x10d533['videoTrack']});}return _0x5018e4;}['getSharedVideoSources'](){const _0x2a6e6c=a6_0x5ad088,_0x4d8790=[];for(const [_0x39f33b,_0x5afa30]of this[_0x2a6e6c(0x1e5)]){_0x4d8790[_0x2a6e6c(0x18a)]({'topic':_0x39f33b,'frameCount':_0x5afa30[_0x2a6e6c(0x210)],'hasVideoSource':!!_0x5afa30['videoSource'],'hasRosSubscriber':!!_0x5afa30[_0x2a6e6c(0x18c)]});}return _0x4d8790;}}module[a6_0x5ad088(0x1ad)]=new ApplianceWebRTCService();