const a6_0xefe446=a6_0x3d2d;(function(_0x3868c3,_0x107f14){const _0x4b6e08=a6_0x3d2d,_0x389ece=_0x3868c3();while(!![]){try{const _0x12b7a9=-parseInt(_0x4b6e08(0xcb))/0x1*(-parseInt(_0x4b6e08(0x174))/0x2)+parseInt(_0x4b6e08(0x119))/0x3*(-parseInt(_0x4b6e08(0xe4))/0x4)+-parseInt(_0x4b6e08(0xe5))/0x5*(-parseInt(_0x4b6e08(0x120))/0x6)+-parseInt(_0x4b6e08(0x157))/0x7*(-parseInt(_0x4b6e08(0x132))/0x8)+-parseInt(_0x4b6e08(0xc0))/0x9+-parseInt(_0x4b6e08(0x172))/0xa*(-parseInt(_0x4b6e08(0x164))/0xb)+parseInt(_0x4b6e08(0x131))/0xc*(-parseInt(_0x4b6e08(0x190))/0xd);if(_0x12b7a9===_0x107f14)break;else _0x389ece['push'](_0x389ece['shift']());}catch(_0x3111d6){_0x389ece['push'](_0x389ece['shift']());}}}(a6_0x4b17,0xad421));function a6_0x3d2d(_0xc5cea5,_0x210431){const _0x474b01=a6_0x4b17();return a6_0x3d2d=function(_0x1f1d54,_0x1245cb){_0x1f1d54=_0x1f1d54-0xbf;let _0x4b17bf=_0x474b01[_0x1f1d54];return _0x4b17bf;},a6_0x3d2d(_0xc5cea5,_0x210431);}const a6_0x1245cb=(function(){let _0x5c7601=!![];return function(_0x596d09,_0x59776e){const _0x455e6e=_0x5c7601?function(){const _0x416f8a=a6_0x3d2d;if(_0x59776e){const _0x447d77=_0x59776e[_0x416f8a(0xea)](_0x596d09,arguments);return _0x59776e=null,_0x447d77;}}:function(){};return _0x5c7601=![],_0x455e6e;};}()),a6_0x1f1d54=a6_0x1245cb(this,function(){const _0x2bfef2=a6_0x3d2d;return a6_0x1f1d54['toString']()['search'](_0x2bfef2(0x181))[_0x2bfef2(0x17c)]()[_0x2bfef2(0xee)](a6_0x1f1d54)[_0x2bfef2(0x108)]('(((.+)+)+)+$');});a6_0x1f1d54();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0xefe446(0x17f)),sharp=require(a6_0xefe446(0x133)),config=require(a6_0xefe446(0xd4)),DepthImageProcessor=require(a6_0xefe446(0xdf)),turnCredentialsService=require('./turnCredentialsService');class ApplianceWebRTCService{constructor(){const _0x49e40d=a6_0xefe446;this[_0x49e40d(0xfd)]=new Map(),this['topicSessions']=new Map(),this['sharedVideoSources']=new Map(),this[_0x49e40d(0x135)]=null,this['serverWs']=null,this[_0x49e40d(0x15f)]=new DepthImageProcessor(),this[_0x49e40d(0x145)]={'iceServers':[{'urls':_0x49e40d(0xd7)},{'urls':_0x49e40d(0x16c)}]};}['initialize'](_0xd1307f,_0x3b05ae){const _0xfa6b14=a6_0xefe446;this['rosbridgeWs']=_0xd1307f,this['serverWs']=_0x3b05ae,turnCredentialsService[_0xfa6b14(0x125)](config[_0xfa6b14(0x13f)]),this['updateTurnCredentials'](),console[_0xfa6b14(0x18c)](_0xfa6b14(0xc2));}async[a6_0xefe446(0x118)](){const _0xcbc04e=a6_0xefe446;try{console[_0xcbc04e(0x18c)]('[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...');const _0x16f6cf=await turnCredentialsService['getIceServers']();this['rtcConfig']['iceServers']=_0x16f6cf,console[_0xcbc04e(0x18c)](_0xcbc04e(0xc9));}catch(_0x304c26){console[_0xcbc04e(0xd5)]('[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:',_0x304c26),console[_0xcbc04e(0x18c)](_0xcbc04e(0x137));}}[a6_0xefe446(0xe0)](_0x196cc6){const _0x21f90b=a6_0xefe446;if(!_0x196cc6['op']||!_0x196cc6['op'][_0x21f90b(0x182)]('webrtc_'))return![];console[_0x21f90b(0x18c)]('[WebRTC\x20Appliance]\x20Handling\x20message:\x20'+_0x196cc6['op']);switch(_0x196cc6['op']){case _0x21f90b(0xcf):this[_0x21f90b(0xcd)](_0x196cc6[_0x21f90b(0x17b)],_0x196cc6[_0x21f90b(0xf6)]);return!![];case'webrtc_offer':this['handleOffer'](_0x196cc6['session_id'],_0x196cc6['offer']);return!![];case _0x21f90b(0xf8):this[_0x21f90b(0x144)](_0x196cc6[_0x21f90b(0x17b)],_0x196cc6[_0x21f90b(0xde)]);return!![];case _0x21f90b(0x124):this[_0x21f90b(0x165)](_0x196cc6['session_id']);return!![];default:console[_0x21f90b(0xc8)](_0x21f90b(0x18f)+_0x196cc6['op']);return![];}}[a6_0xefe446(0x191)](_0x5c9c31){const _0x499d10=a6_0xefe446;if(this[_0x499d10(0xe7)]['has'](_0x5c9c31)){const _0x1aedb0=this[_0x499d10(0xe7)][_0x499d10(0xe9)](_0x5c9c31);return _0x1aedb0['frameCount']++,console['log'](_0x499d10(0x185)+_0x5c9c31+'\x20('+_0x1aedb0[_0x499d10(0x18a)]+_0x499d10(0xfb)),_0x1aedb0;}console[_0x499d10(0x18c)](_0x499d10(0xd2)+_0x5c9c31);const {createCanvas:_0x284af6}=require('canvas'),_0x51dc6a=_0x284af6(config[_0x499d10(0xc6)][_0x499d10(0x11f)][_0x499d10(0xc1)],config[_0x499d10(0xc6)][_0x499d10(0x11f)]['height']),_0x174701=_0x51dc6a[_0x499d10(0x177)]('2d');this['drawLoadingPattern'](_0x51dc6a,_0x174701);const {RTCVideoSource:_0x52a026}=nonstandard,_0x54c732=new _0x52a026();let _0x17794e=0x0;const _0xf7abe7=0x3e8/config[_0x499d10(0xc6)][_0x499d10(0x11f)][_0x499d10(0x10e)],_0x59eac9=this[_0x499d10(0xfa)](_0x5c9c31,_0x72097b=>{const _0x2c319b=_0x499d10,_0x15501f=Date[_0x2c319b(0x14b)]();_0x15501f-_0x17794e>=_0xf7abe7&&(_0x17794e=_0x15501f,this[_0x2c319b(0x147)](_0x51dc6a,_0x174701,_0x72097b,_0x5c9c31,_0x54c732));}),_0x42506f={'videoSource':_0x54c732,'canvas':_0x51dc6a,'rosSubscriber':_0x59eac9,'frameCount':0x1,'topic':_0x5c9c31};return this[_0x499d10(0xe7)]['set'](_0x5c9c31,_0x42506f),_0x42506f;}['releaseSharedVideoSource'](_0x468764){const _0x189913=a6_0xefe446,_0x29d94d=this['sharedVideoSources']['get'](_0x468764);if(!_0x29d94d)return;_0x29d94d[_0x189913(0x18a)]--,console['log'](_0x189913(0x110)+_0x468764+'\x20('+_0x29d94d['frameCount']+_0x189913(0x168)),_0x29d94d[_0x189913(0x18a)]<=0x0&&(console['log'](_0x189913(0x104)+_0x468764+_0x189913(0x13d)),_0x29d94d[_0x189913(0xd6)]&&(_0x29d94d['videoSource']=null),_0x29d94d[_0x189913(0x138)]&&_0x29d94d[_0x189913(0x138)]['unsubscribe'](),this[_0x189913(0xe7)][_0x189913(0x10c)](_0x468764));}async[a6_0xefe446(0xcd)](_0x3d7b99,_0x2ef40b){const _0x519a98=a6_0xefe446;try{console[_0x519a98(0x18c)]('[WebRTC\x20Appliance]\x20Initializing\x20session\x20'+_0x3d7b99+_0x519a98(0x13b)+_0x2ef40b);const _0x4fbea8=this[_0x519a98(0x191)](_0x2ef40b),_0x5bf8a2=new RTCPeerConnection(this[_0x519a98(0x145)]),_0x105fdb=_0x4fbea8[_0x519a98(0xd6)][_0x519a98(0x11c)]({'width':config[_0x519a98(0xc6)][_0x519a98(0x11f)][_0x519a98(0xc1)],'height':config[_0x519a98(0xc6)][_0x519a98(0x11f)]['height'],'framerate':config['webrtc'][_0x519a98(0x11f)][_0x519a98(0x10e)]});console[_0x519a98(0x18c)](_0x519a98(0xd0)+_0x3d7b99);const {MediaStream:_0xbcf3e}=require(_0x519a98(0x17f)),_0x5725d1=new _0xbcf3e([_0x105fdb]);_0x5bf8a2['addTrack'](_0x105fdb,_0x5725d1),this[_0x519a98(0x154)](_0x4fbea8[_0x519a98(0xd6)],_0x4fbea8['canvas']),_0x5bf8a2['onicecandidate']=_0xc01358=>{const _0x220886=_0x519a98;if(_0xc01358[_0x220886(0xde)]&&this['serverWs'])console[_0x220886(0x18c)](_0x220886(0x161)+_0x3d7b99+':',{'type':_0xc01358[_0x220886(0xde)]['type'],'protocol':_0xc01358[_0x220886(0xde)][_0x220886(0x122)],'address':_0xc01358[_0x220886(0xde)]['address'],'port':_0xc01358[_0x220886(0xde)][_0x220886(0x153)]}),this[_0x220886(0x102)]['send'](JSON['stringify']({'op':'webrtc_ice_candidate','session_id':_0x3d7b99,'candidate':_0xc01358['candidate']}));else!_0xc01358[_0x220886(0xde)]&&console['log']('[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20'+_0x3d7b99);},_0x5bf8a2['onconnectionstatechange']=()=>{const _0x5cc1ce=_0x519a98;console[_0x5cc1ce(0x18c)](_0x5cc1ce(0x16f)+_0x3d7b99+_0x5cc1ce(0x112)+_0x5bf8a2[_0x5cc1ce(0x15b)]);if(_0x5bf8a2[_0x5cc1ce(0x15b)]===_0x5cc1ce(0xe3))console['log'](_0x5cc1ce(0x16f)+_0x3d7b99+_0x5cc1ce(0xdd));else{if(_0x5bf8a2['connectionState']==='failed')console[_0x5cc1ce(0x18c)](_0x5cc1ce(0x16f)+_0x3d7b99+_0x5cc1ce(0x113)),this['stopSession'](_0x3d7b99);else _0x5bf8a2[_0x5cc1ce(0x15b)]===_0x5cc1ce(0x16d)&&(console[_0x5cc1ce(0x18c)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x3d7b99+_0x5cc1ce(0x178)),this[_0x5cc1ce(0x175)](_0x3d7b99));}},this['activeSessions'][_0x519a98(0xd8)](_0x3d7b99,{'peerConnection':_0x5bf8a2,'topic':_0x2ef40b,'videoTrack':_0x105fdb,'mediaStream':_0x5725d1,'status':_0x519a98(0xdc)}),!this['topicSessions'][_0x519a98(0x188)](_0x2ef40b)&&this[_0x519a98(0x148)][_0x519a98(0xd8)](_0x2ef40b,new Set()),this['topicSessions'][_0x519a98(0xe9)](_0x2ef40b)['add'](_0x3d7b99),console[_0x519a98(0x18c)](_0x519a98(0x16f)+_0x3d7b99+'\x20initialized\x20successfully'),console[_0x519a98(0x18c)](_0x519a98(0x100)+_0x2ef40b+':\x20'+this['topicSessions'][_0x519a98(0xe9)](_0x2ef40b)[_0x519a98(0x111)]);}catch(_0x589066){console[_0x519a98(0xd5)](_0x519a98(0xf3)+_0x3d7b99+':',_0x589066),this[_0x519a98(0x165)](_0x3d7b99);}}async[a6_0xefe446(0x155)](_0x253e7e,_0x1ff536){const _0x10604d=a6_0xefe446,_0x31da43=this[_0x10604d(0xfd)][_0x10604d(0xe9)](_0x253e7e);if(!_0x31da43){console[_0x10604d(0xd5)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20'+_0x253e7e);return;}try{console[_0x10604d(0x18c)](_0x10604d(0x18b)+_0x253e7e),await _0x31da43[_0x10604d(0x169)]['setRemoteDescription'](new RTCSessionDescription(_0x1ff536)),console['log'](_0x10604d(0xca));const _0x4cabd6=await _0x31da43[_0x10604d(0x169)]['createAnswer']();console[_0x10604d(0x18c)](_0x10604d(0x11e)),await _0x31da43[_0x10604d(0x169)]['setLocalDescription'](_0x4cabd6),console['log'](_0x10604d(0x116)),this[_0x10604d(0x102)]&&(this['serverWs']['send'](JSON[_0x10604d(0x107)]({'op':_0x10604d(0xc3),'session_id':_0x253e7e,'answer':_0x4cabd6})),console[_0x10604d(0x18c)]('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0x253e7e));}catch(_0xa08b3a){console['error'](_0x10604d(0xd3)+_0x253e7e+':',_0xa08b3a),this[_0x10604d(0x165)](_0x253e7e);}}async['handleIceCandidate'](_0x2cf174,_0x49eee1){const _0x581239=a6_0xefe446,_0xa363a5=this[_0x581239(0xfd)][_0x581239(0xe9)](_0x2cf174);if(!_0xa363a5){console[_0x581239(0xd5)](_0x581239(0x12a)+_0x2cf174);return;}try{await _0xa363a5['peerConnection'][_0x581239(0xfc)](new RTCIceCandidate(_0x49eee1)),console['log']('[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20'+_0x2cf174);}catch(_0x4d41a9){console[_0x581239(0xd5)](_0x581239(0x179)+_0x2cf174+':',_0x4d41a9);}}[a6_0xefe446(0xfa)](_0x1f0196,_0x3663e6){const _0x169f04=a6_0xefe446;if(!this['rosbridgeWs']||this[_0x169f04(0x135)][_0x169f04(0x10f)]!==this[_0x169f04(0x135)][_0x169f04(0xda)])return console[_0x169f04(0xd5)](_0x169f04(0x187)),null;console[_0x169f04(0x18c)](_0x169f04(0x12c)+_0x1f0196);const _0x2a785e=_0x1f0196[_0x169f04(0x15a)](_0x169f04(0x16b)),_0x4741ed=_0x1f0196['includes']('compressed')||_0x1f0196[_0x169f04(0x15a)](_0x169f04(0x127));let _0x5e1248=[];_0x2a785e?_0x4741ed?_0x5e1248=[_0x169f04(0xed),_0x169f04(0x136),_0x169f04(0x13c),_0x169f04(0x10b)]:_0x5e1248=[_0x169f04(0x10b),'sensor_msgs/msg/Image',_0x169f04(0xed)]:_0x5e1248=['sensor_msgs/CompressedImage','sensor_msgs/msg/CompressedImage',_0x169f04(0x10b)];console['log'](_0x169f04(0x170)+_0x1f0196+'\x20detected\x20as\x20'+(_0x2a785e?_0x169f04(0x16b):_0x169f04(0x15d))+'\x20image,\x20trying\x20message\x20types:',_0x5e1248);const _0x33e218=[];let _0x32072d=![];const _0xe38e0=_0x29a3a5=>{return _0x52454b=>{const _0x5d6eab=a6_0x3d2d;try{const _0x4ffced=JSON[_0x5d6eab(0xcc)](_0x52454b[_0x5d6eab(0x14d)]);_0x4ffced['op']===_0x5d6eab(0x105)&&_0x4ffced[_0x5d6eab(0xf6)]===_0x1f0196&&_0x4ffced[_0x5d6eab(0x189)]&&(!_0x32072d&&(console[_0x5d6eab(0x18c)](_0x5d6eab(0xbf)+_0x1f0196+_0x5d6eab(0xc7)+_0x29a3a5),_0x32072d=!![]),_0x3663e6(_0x4ffced['msg']));}catch(_0x1d1e87){console[_0x5d6eab(0xd5)](_0x5d6eab(0x10a),_0x1d1e87);}};};for(const _0x136dd2 of _0x5e1248){const _0x4c4f1f={'op':'subscribe','topic':_0x1f0196,'type':_0x136dd2};console[_0x169f04(0x18c)](_0x169f04(0x183)+_0x136dd2),this['rosbridgeWs']['send'](JSON[_0x169f04(0x107)](_0x4c4f1f));const _0x4d78ed=_0xe38e0(_0x136dd2);this['rosbridgeWs'][_0x169f04(0x14f)](_0x169f04(0x162),_0x4d78ed),_0x33e218[_0x169f04(0xc4)]({'handler':_0x4d78ed,'type':_0x136dd2});}return _0x2a785e&&_0x4741ed&&setTimeout(()=>{const _0x36de92=_0x169f04;if(!_0x32072d){console[_0x36de92(0x18c)](_0x36de92(0x139)+_0x1f0196+_0x36de92(0x134));const _0x5a9237=_0x1f0196[_0x36de92(0x114)](_0x36de92(0xe2),'')['replace'](_0x36de92(0xf5),''),_0x48512b=[_0x5a9237+_0x36de92(0x13e),_0x5a9237+_0x36de92(0x117),_0x5a9237];for(const _0xda2f43 of _0x48512b){console[_0x36de92(0x18c)](_0x36de92(0x12e)+_0xda2f43);const _0x598874={'op':'subscribe','topic':_0xda2f43,'type':_0x36de92(0x10b)};this[_0x36de92(0x135)][_0x36de92(0x13a)](JSON[_0x36de92(0x107)](_0x598874));const _0x2b1840=_0x7416c9=>{const _0x43e3b3=_0x36de92;try{const _0xb5066b=JSON[_0x43e3b3(0xcc)](_0x7416c9[_0x43e3b3(0x14d)]);_0xb5066b['op']==='publish'&&_0xb5066b[_0x43e3b3(0xf6)]===_0xda2f43&&_0xb5066b[_0x43e3b3(0x189)]&&(console[_0x43e3b3(0x18c)]('[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20'+_0xda2f43+_0x43e3b3(0x123)),_0xb5066b[_0x43e3b3(0x189)][_0x43e3b3(0x14d)]&&!_0xb5066b['msg'][_0x43e3b3(0x14d)][_0x43e3b3(0x182)](_0x43e3b3(0x18e))&&_0x3663e6(_0xb5066b['msg']));}catch(_0xa5c0c2){console[_0x43e3b3(0xd5)](_0x43e3b3(0x146),_0xa5c0c2);}};this[_0x36de92(0x135)][_0x36de92(0x14f)](_0x36de92(0x162),_0x2b1840),_0x33e218[_0x36de92(0xc4)]({'handler':_0x2b1840,'type':_0x36de92(0x10b),'topic':_0xda2f43});}}},0xbb8),{'unsubscribe':()=>{const _0x421680=_0x169f04;for(const {handler:_0x478a82,type:_0x39194a,topic:_0x11d3f7}of _0x33e218){this[_0x421680(0x135)][_0x421680(0x18d)]('message',_0x478a82),this[_0x421680(0x135)][_0x421680(0x10f)]===this['rosbridgeWs'][_0x421680(0xda)]&&this[_0x421680(0x135)]['send'](JSON[_0x421680(0x107)]({'op':_0x421680(0x173),'topic':_0x11d3f7||_0x1f0196}));}}};}[a6_0xefe446(0xef)](_0x42061f,_0x351a57){const _0x502a1b=a6_0xefe446;_0x351a57[_0x502a1b(0x160)]=_0x502a1b(0x129),_0x351a57[_0x502a1b(0x12f)](0x0,0x0,_0x42061f[_0x502a1b(0xc1)],_0x42061f[_0x502a1b(0x141)]),_0x351a57[_0x502a1b(0x160)]=_0x502a1b(0x130),_0x351a57[_0x502a1b(0x11b)]=_0x502a1b(0xfe),_0x351a57['textAlign']=_0x502a1b(0x15e),_0x351a57[_0x502a1b(0x16e)](_0x502a1b(0x156),_0x42061f['width']/0x2,_0x42061f[_0x502a1b(0x141)]/0x2-0x14),_0x351a57[_0x502a1b(0x160)]=_0x502a1b(0x12b),_0x351a57[_0x502a1b(0x11b)]=_0x502a1b(0x115),_0x351a57[_0x502a1b(0x16e)](_0x502a1b(0x163),_0x42061f[_0x502a1b(0xc1)]/0x2,_0x42061f['height']/0x2+0x14);const _0x56f7bd=Date[_0x502a1b(0x14b)]()/0x3e8;for(let _0x49651c=0x0;_0x49651c<0x3;_0x49651c++){const _0x49405c=(Math[_0x502a1b(0x159)](_0x56f7bd*0x2+_0x49651c*0.5)+0x1)/0x2;_0x351a57['fillStyle']='rgba(0,\x20170,\x20255,\x20'+_0x49405c*0.5+')',_0x351a57[_0x502a1b(0x17e)](),_0x351a57['arc'](_0x42061f[_0x502a1b(0xc1)]/0x2-0x28+_0x49651c*0x28,_0x42061f[_0x502a1b(0x141)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x351a57[_0x502a1b(0x143)]();}}[a6_0xefe446(0x154)](_0x5d2afc,_0x4814a2){const _0x468d22=a6_0xefe446;try{if(!_0x5d2afc||!_0x4814a2)return;const _0x2d94d1=_0x4814a2[_0x468d22(0x177)]('2d'),_0x518fd5=_0x2d94d1['getImageData'](0x0,0x0,_0x4814a2['width'],_0x4814a2[_0x468d22(0x141)]),_0x4e26e5=this[_0x468d22(0x171)](_0x518fd5[_0x468d22(0x14d)],_0x4814a2['width'],_0x4814a2[_0x468d22(0x141)]),_0x6bde5a={'width':_0x4814a2[_0x468d22(0xc1)],'height':_0x4814a2[_0x468d22(0x141)],'data':_0x4e26e5};typeof _0x5d2afc[_0x468d22(0xf1)]===_0x468d22(0x16a)&&_0x5d2afc[_0x468d22(0xf1)](_0x6bde5a);}catch(_0x5f1f8e){console[_0x468d22(0xd5)](_0x468d22(0x101),_0x5f1f8e);}}[a6_0xefe446(0x171)](_0x1d9cfd,_0x1f03ca,_0x55a874){const _0x301e52=a6_0xefe446,_0x4efcd0=_0x1f03ca*_0x55a874,_0x406e13=_0x1f03ca*_0x55a874/0x4,_0x12c8b6=new Uint8Array(_0x4efcd0+_0x406e13*0x2);let _0x5e4980=0x0,_0x5af6ba=_0x4efcd0,_0x574bc0=_0x4efcd0+_0x406e13;for(let _0x193fe3=0x0;_0x193fe3<_0x55a874;_0x193fe3++){for(let _0x3f0c4b=0x0;_0x3f0c4b<_0x1f03ca;_0x3f0c4b++){const _0x4616f2=(_0x193fe3*_0x1f03ca+_0x3f0c4b)*0x4,_0x3f1396=_0x1d9cfd[_0x4616f2],_0x3e3b87=_0x1d9cfd[_0x4616f2+0x1],_0x3fb155=_0x1d9cfd[_0x4616f2+0x2],_0x593f3d=Math[_0x301e52(0xe1)](0.299*_0x3f1396+0.587*_0x3e3b87+0.114*_0x3fb155);_0x12c8b6[_0x5e4980++]=_0x593f3d;if(_0x193fe3%0x2===0x0&&_0x3f0c4b%0x2===0x0){const _0x2325de=Math[_0x301e52(0xe1)](-0.169*_0x3f1396-0.331*_0x3e3b87+0.5*_0x3fb155+0x80),_0x5907b4=Math[_0x301e52(0xe1)](0.5*_0x3f1396-0.419*_0x3e3b87-0.081*_0x3fb155+0x80);_0x12c8b6[_0x5af6ba++]=Math['max'](0x0,Math[_0x301e52(0xff)](0xff,_0x2325de)),_0x12c8b6[_0x574bc0++]=Math[_0x301e52(0x167)](0x0,Math[_0x301e52(0xff)](0xff,_0x5907b4));}}}return _0x12c8b6;}async['updateCanvasWithImageData'](_0x17d1b8,_0x4d98d2,_0x36a6e5,_0x4a35c8,_0x1b01ef){const _0x5a7a94=a6_0xefe446;try{if(!_0x36a6e5||!_0x36a6e5['data'])return;Math[_0x5a7a94(0x12d)]()<0.01&&console[_0x5a7a94(0x18c)](_0x5a7a94(0x106)+_0x4a35c8+_0x5a7a94(0x14c)+_0x36a6e5['data'][_0x5a7a94(0x103)]+_0x5a7a94(0x158));const _0x38fa6e=Buffer[_0x5a7a94(0x17a)](_0x36a6e5[_0x5a7a94(0x14d)],_0x5a7a94(0xe6)),_0x15eda4=this[_0x5a7a94(0x15f)][_0x5a7a94(0xf0)](_0x4a35c8);let _0x42196d;_0x15eda4?_0x42196d=await this[_0x5a7a94(0x15f)][_0x5a7a94(0xf4)](_0x38fa6e,_0x17d1b8,_0x4d98d2,_0x4a35c8):_0x42196d=await this[_0x5a7a94(0x15f)][_0x5a7a94(0x126)](_0x38fa6e,_0x17d1b8,_0x4d98d2),_0x4d98d2[_0x5a7a94(0xeb)](_0x42196d,0x0,0x0),_0x4d98d2[_0x5a7a94(0x160)]=_0x5a7a94(0xec),_0x4d98d2[_0x5a7a94(0x12f)](0xa,0xa,0xdc,0x32),_0x4d98d2['fillStyle']=_0x15eda4?_0x5a7a94(0x149):_0x5a7a94(0xd1),_0x4d98d2['font']=_0x5a7a94(0x166),_0x4d98d2['fillText']((_0x15eda4?_0x5a7a94(0x11a):_0x5a7a94(0xf2))+':\x20'+new Date()[_0x5a7a94(0xf9)](),0xf,0x1c),_0x4d98d2['fillStyle']=_0x5a7a94(0x12b),_0x4d98d2[_0x5a7a94(0x11b)]='10px\x20monospace',_0x4d98d2[_0x5a7a94(0x16e)](_0x5a7a94(0xc5)+_0x4a35c8[_0x5a7a94(0x140)]('/')[_0x5a7a94(0x151)](),0xf,0x2d),this[_0x5a7a94(0x154)](_0x1b01ef,_0x17d1b8);}catch(_0x1dcb42){console['warn']('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x4a35c8+':',_0x1dcb42[_0x5a7a94(0x162)]);_0x4a35c8['includes']('depth')&&Math[_0x5a7a94(0x12d)]()<0.1&&console[_0x5a7a94(0xc8)]('[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20'+_0x4a35c8['replace'](_0x5a7a94(0xe2),_0x5a7a94(0x13e)));_0x4d98d2[_0x5a7a94(0x160)]=_0x5a7a94(0x129),_0x4d98d2[_0x5a7a94(0x12f)](0x0,0x0,_0x17d1b8[_0x5a7a94(0xc1)],_0x17d1b8[_0x5a7a94(0x141)]),_0x4d98d2[_0x5a7a94(0x160)]=_0x5a7a94(0x180),_0x4d98d2[_0x5a7a94(0x11b)]='16px\x20Arial',_0x4d98d2[_0x5a7a94(0x152)]=_0x5a7a94(0x15e);const _0x2a8755=_0x4a35c8[_0x5a7a94(0x15a)](_0x5a7a94(0x16b))?_0x5a7a94(0x11d):_0x5a7a94(0x121);_0x4d98d2[_0x5a7a94(0x16e)](_0x2a8755,_0x17d1b8[_0x5a7a94(0xc1)]/0x2,_0x17d1b8[_0x5a7a94(0x141)]/0x2),_0x4d98d2[_0x5a7a94(0x160)]=_0x5a7a94(0xd9),_0x4d98d2['font']=_0x5a7a94(0x142),_0x4d98d2[_0x5a7a94(0x16e)](_0x5a7a94(0xc5)+_0x4a35c8[_0x5a7a94(0x140)]('/')['pop'](),_0x17d1b8['width']/0x2,_0x17d1b8[_0x5a7a94(0x141)]/0x2+0x19),this['sendFrameToVideoSource'](_0x1b01ef,_0x17d1b8);}}['stopSession'](_0x3ffa1e){const _0x45d712=a6_0xefe446,_0x8c4e85=this[_0x45d712(0xfd)][_0x45d712(0xe9)](_0x3ffa1e);if(!_0x8c4e85){console[_0x45d712(0xc8)](_0x45d712(0xf7)+_0x3ffa1e);return;}console[_0x45d712(0x18c)](_0x45d712(0x128)+_0x3ffa1e+_0x45d712(0x17d)+_0x8c4e85[_0x45d712(0xf6)]);try{this[_0x45d712(0x102)]&&this['serverWs']['readyState']===this[_0x45d712(0x102)]['OPEN']&&this[_0x45d712(0x102)][_0x45d712(0x13a)](JSON[_0x45d712(0x107)]({'op':_0x45d712(0x124),'session_id':_0x3ffa1e})),_0x8c4e85[_0x45d712(0x150)]&&_0x8c4e85[_0x45d712(0x150)][_0x45d712(0x14a)](),_0x8c4e85[_0x45d712(0x169)]&&_0x8c4e85['peerConnection'][_0x45d712(0x15c)]();}catch(_0x47a540){console[_0x45d712(0xd5)]('[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20'+_0x47a540);}this[_0x45d712(0x175)](_0x3ffa1e);}['cleanupSession'](_0x43dfaa){const _0x2915ff=a6_0xefe446,_0x47e613=this['activeSessions'][_0x2915ff(0xe9)](_0x43dfaa);if(_0x47e613){const _0x58f129=this[_0x2915ff(0x148)]['get'](_0x47e613[_0x2915ff(0xf6)]);_0x58f129&&(_0x58f129[_0x2915ff(0x10c)](_0x43dfaa),_0x58f129[_0x2915ff(0x111)]===0x0&&this[_0x2915ff(0x148)][_0x2915ff(0x10c)](_0x47e613[_0x2915ff(0xf6)])),this[_0x2915ff(0xdb)](_0x47e613[_0x2915ff(0xf6)]);}this[_0x2915ff(0xfd)][_0x2915ff(0x10c)](_0x43dfaa),console[_0x2915ff(0x18c)](_0x2915ff(0xe8)+_0x43dfaa);}[a6_0xefe446(0x109)](){const _0x5422f6=a6_0xefe446;console[_0x5422f6(0x18c)](_0x5422f6(0x186));const _0x39d205=Array[_0x5422f6(0x17a)](this[_0x5422f6(0xfd)][_0x5422f6(0x10d)]());_0x39d205[_0x5422f6(0x14e)](_0x32fb4b=>this['stopSession'](_0x32fb4b));}[a6_0xefe446(0xce)](){const _0x13f58b=a6_0xefe446,_0x4f69f6=[];for(const [_0x532751,_0x2d7188]of this[_0x13f58b(0xfd)]){_0x4f69f6[_0x13f58b(0xc4)]({'sessionId':_0x532751,'topic':_0x2d7188[_0x13f58b(0xf6)],'connectionState':_0x2d7188[_0x13f58b(0x169)]?.['connectionState']||_0x13f58b(0x176),'hasVideoTrack':!!_0x2d7188['videoTrack']});}return _0x4f69f6;}[a6_0xefe446(0x184)](){const _0x416e15=a6_0xefe446,_0x4bb8ae=[];for(const [_0x37c12d,_0x1efbc8]of this[_0x416e15(0xe7)]){_0x4bb8ae[_0x416e15(0xc4)]({'topic':_0x37c12d,'frameCount':_0x1efbc8[_0x416e15(0x18a)],'hasVideoSource':!!_0x1efbc8[_0x416e15(0xd6)],'hasRosSubscriber':!!_0x1efbc8['rosSubscriber']});}return _0x4bb8ae;}}function a6_0x4b17(){const _0x158ea2=['[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','updateCanvasWithImageData','topicSessions','#00ffff','stop','now',',\x20size:\x20','data','forEach','addEventListener','videoTrack','pop','textAlign','port','sendFrameToVideoSource','handleOffer','🤖\x20Robot\x20Camera','6504638eKszWX','\x20bytes','sin','includes','connectionState','close','color','center','depthProcessor','fillStyle','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','message','Waiting\x20for\x20ROS\x20image\x20data...','34551WjHIpu','stopSession','12px\x20monospace','max','\x20sessions\x20remaining)','peerConnection','function','depth','stun:stun1.l.google.com:19302','closed','fillText','[WebRTC\x20Appliance]\x20Session\x20','[WebRTC\x20Appliance]\x20Topic\x20','convertRGBAtoI420','4090pbprnB','unsubscribe','1002CTbVkz','cleanupSession','unknown','getContext','\x20connection\x20closed,\x20cleaning\x20up','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','from','session_id','toString','\x20for\x20topic:\x20','beginPath','wrtc','#888','(((.+)+)+)+$','startsWith','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','getSharedVideoSources','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','has','msg','frameCount','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','log','removeEventListener','/9j/','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','117QScWeP','getOrCreateSharedVideoSource','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','4495464dLUHDO','width','[WebRTC\x20Appliance]\x20Service\x20initialized','webrtc_answer','push','Topic:\x20','webrtc','\x20with\x20message\x20type\x20','warn','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','2154zvztka','parse','initializeSession','getActiveSessions','webrtc_init_session','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','#00ff00','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','../config','error','videoSource','stun:stun.l.google.com:19302','set','#666','OPEN','releaseSharedVideoSource','initializing','\x20successfully\x20connected!','candidate','./DepthImageProcessor','handleMessage','round','/compressedDepth','connected','660AnqWUN','75OFKWaf','base64','sharedVideoSources','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','get','apply','putImageData','rgba(0,\x200,\x200,\x200.7)','sensor_msgs/CompressedImage','constructor','drawLoadingPattern','isDepthTopic','onFrame','📹\x20Color','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','processDepthImage','/compressed','topic','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','webrtc_ice_candidate','toLocaleTimeString','subscribeToROSTopic','\x20sessions)','addIceCandidate','activeSessions','24px\x20Arial','min','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','serverWs','length','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','publish','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','stringify','search','stopAllSessions','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','sensor_msgs/Image','delete','keys','framerate','readyState','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','size','\x20connection\x20state:\x20','\x20connection\x20failed,\x20stopping\x20session','replace','16px\x20Arial','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','/image','updateTurnCredentials','5826CeNFdL','🔍\x20Depth','font','createTrack','🔍\x20Processing\x20depth...','[WebRTC\x20Appliance]\x20Created\x20answer','video','149934oWrpPT','📹\x20Processing\x20video...','protocol',',\x20converting\x20to\x20base64...','webrtc_stop_session','initialize','processColorImage','compressedDepth','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','#1a1a1a','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','#ffffff','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','random','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','fillRect','#00aaff','2851068wFeOCA','8SpPHAj','sharp',',\x20trying\x20alternative\x20depth\x20topics','rosbridgeWs','sensor_msgs/msg/CompressedImage','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','rosSubscriber','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','send','\x20for\x20topic\x20','compressed_depth_image_transport/CompressedDepthImage',',\x20cleaning\x20up\x20shared\x20resources','/image_raw','serverUrl','split','height','12px\x20Arial','fill','handleIceCandidate','rtcConfig'];a6_0x4b17=function(){return _0x158ea2;};return a6_0x4b17();}module['exports']=new ApplianceWebRTCService();