const a6_0x2761fd=a6_0x4e96;(function(_0x225a2f,_0x2d32dd){const _0xe8f207=a6_0x4e96,_0x486963=_0x225a2f();while(!![]){try{const _0x1f1c85=parseInt(_0xe8f207(0x209))/0x1+parseInt(_0xe8f207(0x1c9))/0x2+-parseInt(_0xe8f207(0x17e))/0x3*(parseInt(_0xe8f207(0x1d5))/0x4)+parseInt(_0xe8f207(0x15d))/0x5*(-parseInt(_0xe8f207(0x207))/0x6)+parseInt(_0xe8f207(0x198))/0x7*(parseInt(_0xe8f207(0x1da))/0x8)+parseInt(_0xe8f207(0x199))/0x9+-parseInt(_0xe8f207(0x1c6))/0xa;if(_0x1f1c85===_0x2d32dd)break;else _0x486963['push'](_0x486963['shift']());}catch(_0x2f5893){_0x486963['push'](_0x486963['shift']());}}}(a6_0xe967,0x89bde));const a6_0x3114a1=(function(){let _0x365e09=!![];return function(_0x5a816b,_0x505bd8){const _0x260cec=_0x365e09?function(){const _0x4b7902=a6_0x4e96;if(_0x505bd8){const _0x54b674=_0x505bd8[_0x4b7902(0x1a7)](_0x5a816b,arguments);return _0x505bd8=null,_0x54b674;}}:function(){};return _0x365e09=![],_0x260cec;};}()),a6_0x552a6f=a6_0x3114a1(this,function(){const _0x3c9414=a6_0x4e96;return a6_0x552a6f[_0x3c9414(0x1e3)]()[_0x3c9414(0x18e)](_0x3c9414(0x169))[_0x3c9414(0x1e3)]()[_0x3c9414(0x21b)](a6_0x552a6f)['search']('(((.+)+)+)+$');});a6_0x552a6f();function a6_0xe967(){const _0x7df3f2=['fillStyle','\x20successfully\x20connected!','669356VBfgNp','convertRGBAtoI420','\x20image,\x20trying\x20message\x20types:','stun:stun.l.google.com:19302','[WebRTC\x20Appliance]\x20Topic\x20','8LLhnCp','rosSubscriber','unsubscribe','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','readyState','handleIceCandidate','font','drawLoadingPattern','topic','toString','iceServers','ðŸ”\x20Processing\x20depth...','activeSessions','12px\x20Arial','videoTrack','sharp','sendFrameToVideoSource','fillText','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','./turnCredentialsService','stringify','12px\x20monospace','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','push','sensor_msgs/CompressedImage','data','offer','unknown','compressed','textAlign','center','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','serverWs','initializeSession','webrtc_stop_session','stopSession','from','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','compressedDepth','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','fillRect','addEventListener','address','sensor_msgs/Image','updateTurnCredentials','42MnBJCS','split','300900TbOwor','webrtc','connectionState','#00ff00','rosbridgeWs','/9j/','failed','rtcConfig','getContext','random','fill','get','onconnectionstatechange','max','min','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','getActiveSessions','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','constructor','rgba(0,\x200,\x200,\x200.7)','set','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','sensor_msgs/msg/CompressedImage','session_id','depthProcessor','./DepthImageProcessor','sharedVideoSources','sensor_msgs/msg/Image','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','round','595465bzVIQT','24px\x20Arial','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','includes','startsWith','length','\x20connection\x20closed,\x20cleaning\x20up','pop','stun:stun1.l.google.com:19302','\x20for\x20topic:\x20','log','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','(((.+)+)+)+$','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','forEach',',\x20trying\x20alternative\x20depth\x20topics','height','type','processColorImage','ðŸ”\x20Depth','exports','add','beginPath',',\x20size:\x20','onFrame','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','now','webrtc_ice_candidate','videoSource','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','msg','stopAllSessions','../config','9eIULjI',',\x20converting\x20to\x20base64...','warn','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','parse','releaseSharedVideoSource','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','serverUrl','subscribe','function','replace','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','sin','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','getIceServers','search','putImageData','publish','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','base64','\x20sessions)','initializing','getOrCreateSharedVideoSource','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','4453778pCVpgF','2957319obYxHJ','#ffffff','delete','[WebRTC\x20Appliance]\x20Created\x20answer','topicSessions','\x20bytes','size','10px\x20monospace','\x20sessions\x20remaining)','canvas','depth','subscribeToROSTopic','rgba(0,\x20170,\x20255,\x20','\x20connection\x20state:\x20','apply','\x20with\x20message\x20type\x20','updateCanvasWithImageData','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','Topic:\x20','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','frameCount','webrtc_init_session','#1a1a1a','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','video','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','/image_raw','/compressedDepth','16px\x20Arial','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','peerConnection','wrtc','\x20connection\x20failed,\x20stopping\x20session','color','setLocalDescription','protocol','width','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','handleMessage','\x20for\x20topic\x20','error','send','candidate','toLocaleTimeString','webrtc_answer','410050AHbMhe','has','port','1350236LiptvX','OPEN','/image','cleanupSession','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','message','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','setRemoteDescription','[WebRTC\x20Appliance]\x20Session\x20','arc'];a6_0xe967=function(){return _0x7df3f2;};return a6_0xe967();}const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x2761fd(0x1b8)),sharp=require(a6_0x2761fd(0x1e9)),config=require(a6_0x2761fd(0x17d)),DepthImageProcessor=require(a6_0x2761fd(0x158)),turnCredentialsService=require(a6_0x2761fd(0x1ed));function a6_0x4e96(_0x59f25c,_0x1165fe){const _0x4fa380=a6_0xe967();return a6_0x4e96=function(_0x552a6f,_0x3114a1){_0x552a6f=_0x552a6f-0x158;let _0xe967a9=_0x4fa380[_0x552a6f];return _0xe967a9;},a6_0x4e96(_0x59f25c,_0x1165fe);}class ApplianceWebRTCService{constructor(){const _0x5a3fd9=a6_0x2761fd;this[_0x5a3fd9(0x1e6)]=new Map(),this[_0x5a3fd9(0x19d)]=new Map(),this[_0x5a3fd9(0x159)]=new Map(),this['rosbridgeWs']=null,this['serverWs']=null,this[_0x5a3fd9(0x221)]=new DepthImageProcessor(),this[_0x5a3fd9(0x210)]={'iceServers':[{'urls':_0x5a3fd9(0x1d8)},{'urls':_0x5a3fd9(0x165)}]};}['initialize'](_0x54bcfd,_0x24ea23){const _0x550b82=a6_0x2761fd;this['rosbridgeWs']=_0x54bcfd,this[_0x550b82(0x1fa)]=_0x24ea23,turnCredentialsService['initialize'](config[_0x550b82(0x186)]),this['updateTurnCredentials'](),console['log']('[WebRTC\x20Appliance]\x20Service\x20initialized');}async[a6_0x2761fd(0x206)](){const _0xe04df4=a6_0x2761fd;try{console[_0xe04df4(0x167)]('[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...');const _0x595f3c=await turnCredentialsService[_0xe04df4(0x18d)]();this[_0xe04df4(0x210)][_0xe04df4(0x1e4)]=_0x595f3c,console[_0xe04df4(0x167)]('[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully');}catch(_0x34f899){console[_0xe04df4(0x1c1)](_0xe04df4(0x182),_0x34f899),console[_0xe04df4(0x167)](_0xe04df4(0x218));}}[a6_0x2761fd(0x1bf)](_0x6aae69){const _0x56dde2=a6_0x2761fd;if(!_0x6aae69['op']||!_0x6aae69['op'][_0x56dde2(0x161)]('webrtc_'))return![];console['log'](_0x56dde2(0x201)+_0x6aae69['op']);switch(_0x6aae69['op']){case _0x56dde2(0x1ae):this[_0x56dde2(0x1fb)](_0x6aae69[_0x56dde2(0x220)],_0x6aae69['topic']);return!![];case'webrtc_offer':this['handleOffer'](_0x6aae69[_0x56dde2(0x220)],_0x6aae69[_0x56dde2(0x1f4)]);return!![];case _0x56dde2(0x178):this[_0x56dde2(0x1df)](_0x6aae69['session_id'],_0x6aae69[_0x56dde2(0x1c3)]);return!![];case _0x56dde2(0x1fc):this[_0x56dde2(0x1fd)](_0x6aae69[_0x56dde2(0x220)]);return!![];default:console[_0x56dde2(0x180)](_0x56dde2(0x21e)+_0x6aae69['op']);return![];}}['getOrCreateSharedVideoSource'](_0x72ee68){const _0x54b77b=a6_0x2761fd;if(this[_0x54b77b(0x159)]['has'](_0x72ee68)){const _0x57faad=this['sharedVideoSources'][_0x54b77b(0x214)](_0x72ee68);return _0x57faad[_0x54b77b(0x1ad)]++,console[_0x54b77b(0x167)](_0x54b77b(0x15f)+_0x72ee68+'\x20('+_0x57faad[_0x54b77b(0x1ad)]+_0x54b77b(0x194)),_0x57faad;}console[_0x54b77b(0x167)](_0x54b77b(0x18a)+_0x72ee68);const {createCanvas:_0x4e58dc}=require(_0x54b77b(0x1a2)),_0x4d79cf=_0x4e58dc(config['webrtc'][_0x54b77b(0x1b1)][_0x54b77b(0x1bd)],config[_0x54b77b(0x20a)][_0x54b77b(0x1b1)][_0x54b77b(0x16d)]),_0x240f67=_0x4d79cf[_0x54b77b(0x211)]('2d');this['drawLoadingPattern'](_0x4d79cf,_0x240f67);const {RTCVideoSource:_0x53852d}=nonstandard,_0x12a2c4=new _0x53852d();let _0x1ce169=0x0;const _0x206bfa=0x3e8/config[_0x54b77b(0x20a)][_0x54b77b(0x1b1)]['framerate'],_0x4d2086=this[_0x54b77b(0x1a4)](_0x72ee68,_0x318523=>{const _0x5e9776=_0x54b77b,_0x14846a=Date[_0x5e9776(0x177)]();_0x14846a-_0x1ce169>=_0x206bfa&&(_0x1ce169=_0x14846a,this[_0x5e9776(0x1a9)](_0x4d79cf,_0x240f67,_0x318523,_0x72ee68,_0x12a2c4));}),_0x5139b6={'videoSource':_0x12a2c4,'canvas':_0x4d79cf,'rosSubscriber':_0x4d2086,'frameCount':0x1,'topic':_0x72ee68};return this[_0x54b77b(0x159)][_0x54b77b(0x21d)](_0x72ee68,_0x5139b6),_0x5139b6;}[a6_0x2761fd(0x184)](_0x590391){const _0x3a62ee=a6_0x2761fd,_0x11ee37=this[_0x3a62ee(0x159)][_0x3a62ee(0x214)](_0x590391);if(!_0x11ee37)return;_0x11ee37[_0x3a62ee(0x1ad)]--,console[_0x3a62ee(0x167)](_0x3a62ee(0x185)+_0x590391+'\x20('+_0x11ee37[_0x3a62ee(0x1ad)]+_0x3a62ee(0x1a1)),_0x11ee37[_0x3a62ee(0x1ad)]<=0x0&&(console[_0x3a62ee(0x167)]('[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20'+_0x590391+',\x20cleaning\x20up\x20shared\x20resources'),_0x11ee37['videoSource']&&(_0x11ee37[_0x3a62ee(0x179)]=null),_0x11ee37['rosSubscriber']&&_0x11ee37[_0x3a62ee(0x1db)][_0x3a62ee(0x1dc)](),this[_0x3a62ee(0x159)]['delete'](_0x590391));}async['initializeSession'](_0xef1f4c,_0x5c1a2e){const _0x4f323c=a6_0x2761fd;try{console['log'](_0x4f323c(0x1cd)+_0xef1f4c+_0x4f323c(0x1c0)+_0x5c1a2e);const _0x5ea85e=this[_0x4f323c(0x196)](_0x5c1a2e),_0x139d65=new RTCPeerConnection(this['rtcConfig']),_0x379912=_0x5ea85e[_0x4f323c(0x179)]['createTrack']({'width':config['webrtc'][_0x4f323c(0x1b1)][_0x4f323c(0x1bd)],'height':config['webrtc'][_0x4f323c(0x1b1)][_0x4f323c(0x16d)],'framerate':config['webrtc'][_0x4f323c(0x1b1)]['framerate']});console[_0x4f323c(0x167)](_0x4f323c(0x1ec)+_0xef1f4c);const {MediaStream:_0xf51773}=require('wrtc'),_0x2bfa54=new _0xf51773([_0x379912]);_0x139d65['addTrack'](_0x379912,_0x2bfa54),this[_0x4f323c(0x1ea)](_0x5ea85e[_0x4f323c(0x179)],_0x5ea85e[_0x4f323c(0x1a2)]),_0x139d65['onicecandidate']=_0xe84372=>{const _0x319198=_0x4f323c;if(_0xe84372[_0x319198(0x1c3)]&&this['serverWs'])console[_0x319198(0x167)](_0x319198(0x192)+_0xef1f4c+':',{'type':_0xe84372[_0x319198(0x1c3)][_0x319198(0x16e)],'protocol':_0xe84372[_0x319198(0x1c3)][_0x319198(0x1bc)],'address':_0xe84372[_0x319198(0x1c3)][_0x319198(0x204)],'port':_0xe84372[_0x319198(0x1c3)][_0x319198(0x1c8)]}),this[_0x319198(0x1fa)][_0x319198(0x1c2)](JSON[_0x319198(0x1ee)]({'op':_0x319198(0x178),'session_id':_0xef1f4c,'candidate':_0xe84372['candidate']}));else!_0xe84372[_0x319198(0x1c3)]&&console[_0x319198(0x167)](_0x319198(0x191)+_0xef1f4c);},_0x139d65[_0x4f323c(0x215)]=()=>{const _0x777737=_0x4f323c;console[_0x777737(0x167)](_0x777737(0x1d1)+_0xef1f4c+_0x777737(0x1a6)+_0x139d65[_0x777737(0x20b)]);if(_0x139d65[_0x777737(0x20b)]==='connected')console[_0x777737(0x167)]('[WebRTC\x20Appliance]\x20Session\x20'+_0xef1f4c+_0x777737(0x1d4));else{if(_0x139d65[_0x777737(0x20b)]===_0x777737(0x20f))console['log']('[WebRTC\x20Appliance]\x20Session\x20'+_0xef1f4c+_0x777737(0x1b9)),this[_0x777737(0x1fd)](_0xef1f4c);else _0x139d65[_0x777737(0x20b)]==='closed'&&(console[_0x777737(0x167)](_0x777737(0x1d1)+_0xef1f4c+_0x777737(0x163)),this['cleanupSession'](_0xef1f4c));}},this[_0x4f323c(0x1e6)][_0x4f323c(0x21d)](_0xef1f4c,{'peerConnection':_0x139d65,'topic':_0x5c1a2e,'videoTrack':_0x379912,'mediaStream':_0x2bfa54,'status':_0x4f323c(0x195)}),!this[_0x4f323c(0x19d)][_0x4f323c(0x1c7)](_0x5c1a2e)&&this[_0x4f323c(0x19d)][_0x4f323c(0x21d)](_0x5c1a2e,new Set()),this[_0x4f323c(0x19d)][_0x4f323c(0x214)](_0x5c1a2e)[_0x4f323c(0x172)](_0xef1f4c),console['log']('[WebRTC\x20Appliance]\x20Session\x20'+_0xef1f4c+'\x20initialized\x20successfully'),console[_0x4f323c(0x167)](_0x4f323c(0x1dd)+_0x5c1a2e+':\x20'+this['topicSessions'][_0x4f323c(0x214)](_0x5c1a2e)[_0x4f323c(0x19f)]);}catch(_0x4165eb){console[_0x4f323c(0x1c1)](_0x4f323c(0x1cf)+_0xef1f4c+':',_0x4165eb),this['stopSession'](_0xef1f4c);}}async['handleOffer'](_0x6685b5,_0x2be07f){const _0x43e866=a6_0x2761fd,_0x1db7a6=this[_0x43e866(0x1e6)][_0x43e866(0x214)](_0x6685b5);if(!_0x1db7a6){console[_0x43e866(0x1c1)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20'+_0x6685b5);return;}try{console['log'](_0x43e866(0x1f0)+_0x6685b5),await _0x1db7a6['peerConnection'][_0x43e866(0x1d0)](new RTCSessionDescription(_0x2be07f)),console[_0x43e866(0x167)](_0x43e866(0x1aa));const _0x4f60c5=await _0x1db7a6[_0x43e866(0x1b7)]['createAnswer']();console[_0x43e866(0x167)](_0x43e866(0x19c)),await _0x1db7a6[_0x43e866(0x1b7)][_0x43e866(0x1bb)](_0x4f60c5),console['log'](_0x43e866(0x1ff)),this[_0x43e866(0x1fa)]&&(this['serverWs'][_0x43e866(0x1c2)](JSON['stringify']({'op':_0x43e866(0x1c5),'session_id':_0x6685b5,'answer':_0x4f60c5})),console[_0x43e866(0x167)]('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0x6685b5));}catch(_0x42724b){console[_0x43e866(0x1c1)]('[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20'+_0x6685b5+':',_0x42724b),this[_0x43e866(0x1fd)](_0x6685b5);}}async[a6_0x2761fd(0x1df)](_0x28a1b5,_0x76d75a){const _0x42344a=a6_0x2761fd,_0x3e6f70=this['activeSessions'][_0x42344a(0x214)](_0x28a1b5);if(!_0x3e6f70){console['error'](_0x42344a(0x18c)+_0x28a1b5);return;}try{await _0x3e6f70[_0x42344a(0x1b7)]['addIceCandidate'](new RTCIceCandidate(_0x76d75a)),console[_0x42344a(0x167)]('[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20'+_0x28a1b5);}catch(_0x4146f7){console[_0x42344a(0x1c1)]('[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20'+_0x28a1b5+':',_0x4146f7);}}['subscribeToROSTopic'](_0x140f2b,_0x3364b3){const _0x203677=a6_0x2761fd;if(!this[_0x203677(0x20d)]||this[_0x203677(0x20d)][_0x203677(0x1de)]!==this[_0x203677(0x20d)][_0x203677(0x1ca)])return console[_0x203677(0x1c1)](_0x203677(0x1f9)),null;console[_0x203677(0x167)](_0x203677(0x1b0)+_0x140f2b);const _0x39f419=_0x140f2b[_0x203677(0x160)](_0x203677(0x1a3)),_0x387bc2=_0x140f2b[_0x203677(0x160)](_0x203677(0x1f6))||_0x140f2b['includes'](_0x203677(0x200));let _0x21cff9=[];_0x39f419?_0x387bc2?_0x21cff9=[_0x203677(0x1f2),_0x203677(0x21f),'compressed_depth_image_transport/CompressedDepthImage',_0x203677(0x205)]:_0x21cff9=[_0x203677(0x205),_0x203677(0x15a),_0x203677(0x1f2)]:_0x21cff9=[_0x203677(0x1f2),_0x203677(0x21f),_0x203677(0x205)];console['log'](_0x203677(0x1d9)+_0x140f2b+'\x20detected\x20as\x20'+(_0x39f419?_0x203677(0x1a3):_0x203677(0x1ba))+_0x203677(0x1d7),_0x21cff9);const _0x1bab6f=[];let _0x1fbe33=![];const _0x443636=_0x8235e1=>{return _0x3a0836=>{const _0x34d5fb=a6_0x4e96;try{const _0x490c90=JSON[_0x34d5fb(0x183)](_0x3a0836[_0x34d5fb(0x1f3)]);_0x490c90['op']===_0x34d5fb(0x190)&&_0x490c90['topic']===_0x140f2b&&_0x490c90['msg']&&(!_0x1fbe33&&(console['log'](_0x34d5fb(0x1be)+_0x140f2b+_0x34d5fb(0x1a8)+_0x8235e1),_0x1fbe33=!![]),_0x3364b3(_0x490c90['msg']));}catch(_0x5de795){console[_0x34d5fb(0x1c1)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x5de795);}};};for(const _0x34a817 of _0x21cff9){const _0x4ebfc5={'op':_0x203677(0x187),'topic':_0x140f2b,'type':_0x34a817};console[_0x203677(0x167)](_0x203677(0x1b6)+_0x34a817),this[_0x203677(0x20d)][_0x203677(0x1c2)](JSON[_0x203677(0x1ee)](_0x4ebfc5));const _0x222631=_0x443636(_0x34a817);this[_0x203677(0x20d)]['addEventListener']('message',_0x222631),_0x1bab6f[_0x203677(0x1f1)]({'handler':_0x222631,'type':_0x34a817});}return _0x39f419&&_0x387bc2&&setTimeout(()=>{const _0x1a29c2=_0x203677;if(!_0x1fbe33){console[_0x1a29c2(0x167)](_0x1a29c2(0x181)+_0x140f2b+_0x1a29c2(0x16c));const _0xc782ff=_0x140f2b[_0x1a29c2(0x189)](_0x1a29c2(0x1b4),'')['replace']('/compressed',''),_0x33320e=[_0xc782ff+_0x1a29c2(0x1b3),_0xc782ff+_0x1a29c2(0x1cb),_0xc782ff];for(const _0x289ba4 of _0x33320e){console[_0x1a29c2(0x167)](_0x1a29c2(0x15b)+_0x289ba4);const _0x31d9cf={'op':_0x1a29c2(0x187),'topic':_0x289ba4,'type':'sensor_msgs/Image'};this[_0x1a29c2(0x20d)][_0x1a29c2(0x1c2)](JSON['stringify'](_0x31d9cf));const _0x46a7a2=_0x2a8042=>{const _0x20b5ec=_0x1a29c2;try{const _0x58e8e2=JSON[_0x20b5ec(0x183)](_0x2a8042[_0x20b5ec(0x1f3)]);_0x58e8e2['op']===_0x20b5ec(0x190)&&_0x58e8e2[_0x20b5ec(0x1e2)]===_0x289ba4&&_0x58e8e2[_0x20b5ec(0x17b)]&&(console[_0x20b5ec(0x167)](_0x20b5ec(0x1b2)+_0x289ba4+_0x20b5ec(0x17f)),_0x58e8e2[_0x20b5ec(0x17b)]['data']&&!_0x58e8e2[_0x20b5ec(0x17b)][_0x20b5ec(0x1f3)][_0x20b5ec(0x161)](_0x20b5ec(0x20e))&&_0x3364b3(_0x58e8e2[_0x20b5ec(0x17b)]));}catch(_0x2708c3){console[_0x20b5ec(0x1c1)](_0x20b5ec(0x17a),_0x2708c3);}};this[_0x1a29c2(0x20d)][_0x1a29c2(0x203)](_0x1a29c2(0x1ce),_0x46a7a2),_0x1bab6f[_0x1a29c2(0x1f1)]({'handler':_0x46a7a2,'type':_0x1a29c2(0x205),'topic':_0x289ba4});}}},0xbb8),{'unsubscribe':()=>{const _0x1e8c65=_0x203677;for(const {handler:_0x4eb34e,type:_0x4a7be6,topic:_0x1a5e63}of _0x1bab6f){this[_0x1e8c65(0x20d)]['removeEventListener'](_0x1e8c65(0x1ce),_0x4eb34e),this[_0x1e8c65(0x20d)][_0x1e8c65(0x1de)]===this[_0x1e8c65(0x20d)][_0x1e8c65(0x1ca)]&&this[_0x1e8c65(0x20d)]['send'](JSON[_0x1e8c65(0x1ee)]({'op':_0x1e8c65(0x1dc),'topic':_0x1a5e63||_0x140f2b}));}}};}[a6_0x2761fd(0x1e1)](_0x5385da,_0x3ae96d){const _0x211f8c=a6_0x2761fd;_0x3ae96d[_0x211f8c(0x1d3)]=_0x211f8c(0x1af),_0x3ae96d[_0x211f8c(0x202)](0x0,0x0,_0x5385da['width'],_0x5385da[_0x211f8c(0x16d)]),_0x3ae96d[_0x211f8c(0x1d3)]='#00aaff',_0x3ae96d[_0x211f8c(0x1e0)]=_0x211f8c(0x15e),_0x3ae96d[_0x211f8c(0x1f7)]=_0x211f8c(0x1f8),_0x3ae96d[_0x211f8c(0x1eb)]('ðŸ¤–\x20Robot\x20Camera',_0x5385da[_0x211f8c(0x1bd)]/0x2,_0x5385da['height']/0x2-0x14),_0x3ae96d[_0x211f8c(0x1d3)]=_0x211f8c(0x19a),_0x3ae96d['font']=_0x211f8c(0x1b5),_0x3ae96d['fillText']('Waiting\x20for\x20ROS\x20image\x20data...',_0x5385da[_0x211f8c(0x1bd)]/0x2,_0x5385da[_0x211f8c(0x16d)]/0x2+0x14);const _0x2d9937=Date[_0x211f8c(0x177)]()/0x3e8;for(let _0x2beed2=0x0;_0x2beed2<0x3;_0x2beed2++){const _0x464b67=(Math[_0x211f8c(0x18b)](_0x2d9937*0x2+_0x2beed2*0.5)+0x1)/0x2;_0x3ae96d[_0x211f8c(0x1d3)]=_0x211f8c(0x1a5)+_0x464b67*0.5+')',_0x3ae96d[_0x211f8c(0x173)](),_0x3ae96d[_0x211f8c(0x1d2)](_0x5385da[_0x211f8c(0x1bd)]/0x2-0x28+_0x2beed2*0x28,_0x5385da[_0x211f8c(0x16d)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x3ae96d[_0x211f8c(0x213)]();}}[a6_0x2761fd(0x1ea)](_0xa0364b,_0x33a3f6){const _0x2e8ae0=a6_0x2761fd;try{if(!_0xa0364b||!_0x33a3f6)return;const _0x36bc75=_0x33a3f6[_0x2e8ae0(0x211)]('2d'),_0x4d8314=_0x36bc75['getImageData'](0x0,0x0,_0x33a3f6[_0x2e8ae0(0x1bd)],_0x33a3f6[_0x2e8ae0(0x16d)]),_0x3f4e36=this[_0x2e8ae0(0x1d6)](_0x4d8314[_0x2e8ae0(0x1f3)],_0x33a3f6[_0x2e8ae0(0x1bd)],_0x33a3f6[_0x2e8ae0(0x16d)]),_0x45881d={'width':_0x33a3f6['width'],'height':_0x33a3f6['height'],'data':_0x3f4e36};typeof _0xa0364b['onFrame']===_0x2e8ae0(0x188)&&_0xa0364b[_0x2e8ae0(0x175)](_0x45881d);}catch(_0x283286){console['error']('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x283286);}}[a6_0x2761fd(0x1d6)](_0x522f94,_0x1f3949,_0x825997){const _0x3a5d4c=a6_0x2761fd,_0x30835a=_0x1f3949*_0x825997,_0x5a84a9=_0x1f3949*_0x825997/0x4,_0x902846=new Uint8Array(_0x30835a+_0x5a84a9*0x2);let _0x136438=0x0,_0x582bce=_0x30835a,_0x5bc26f=_0x30835a+_0x5a84a9;for(let _0x5e792a=0x0;_0x5e792a<_0x825997;_0x5e792a++){for(let _0xa901f2=0x0;_0xa901f2<_0x1f3949;_0xa901f2++){const _0x3e496a=(_0x5e792a*_0x1f3949+_0xa901f2)*0x4,_0x175a5b=_0x522f94[_0x3e496a],_0x391ae8=_0x522f94[_0x3e496a+0x1],_0xe6f15d=_0x522f94[_0x3e496a+0x2],_0x319431=Math['round'](0.299*_0x175a5b+0.587*_0x391ae8+0.114*_0xe6f15d);_0x902846[_0x136438++]=_0x319431;if(_0x5e792a%0x2===0x0&&_0xa901f2%0x2===0x0){const _0x527e9d=Math[_0x3a5d4c(0x15c)](-0.169*_0x175a5b-0.331*_0x391ae8+0.5*_0xe6f15d+0x80),_0x2eb788=Math[_0x3a5d4c(0x15c)](0.5*_0x175a5b-0.419*_0x391ae8-0.081*_0xe6f15d+0x80);_0x902846[_0x582bce++]=Math[_0x3a5d4c(0x216)](0x0,Math[_0x3a5d4c(0x217)](0xff,_0x527e9d)),_0x902846[_0x5bc26f++]=Math[_0x3a5d4c(0x216)](0x0,Math[_0x3a5d4c(0x217)](0xff,_0x2eb788));}}}return _0x902846;}async[a6_0x2761fd(0x1a9)](_0xd2bd7,_0x14a8e3,_0x33938a,_0x5b1223,_0x126ae6){const _0x441284=a6_0x2761fd;try{if(!_0x33938a||!_0x33938a[_0x441284(0x1f3)])return;Math['random']()<0.01&&console[_0x441284(0x167)](_0x441284(0x1ac)+_0x5b1223+_0x441284(0x174)+_0x33938a['data'][_0x441284(0x162)]+_0x441284(0x19e));const _0x24fbbb=Buffer[_0x441284(0x1fe)](_0x33938a[_0x441284(0x1f3)],_0x441284(0x193)),_0x4f7bcc=this[_0x441284(0x221)]['isDepthTopic'](_0x5b1223);let _0x3249b0;_0x4f7bcc?_0x3249b0=await this[_0x441284(0x221)]['processDepthImage'](_0x24fbbb,_0xd2bd7,_0x14a8e3,_0x5b1223):_0x3249b0=await this['depthProcessor'][_0x441284(0x16f)](_0x24fbbb,_0xd2bd7,_0x14a8e3),_0x14a8e3[_0x441284(0x18f)](_0x3249b0,0x0,0x0),_0x14a8e3['fillStyle']=_0x441284(0x21c),_0x14a8e3[_0x441284(0x202)](0xa,0xa,0xdc,0x32),_0x14a8e3[_0x441284(0x1d3)]=_0x4f7bcc?'#00ffff':_0x441284(0x20c),_0x14a8e3[_0x441284(0x1e0)]=_0x441284(0x1ef),_0x14a8e3[_0x441284(0x1eb)]((_0x4f7bcc?_0x441284(0x170):'ðŸ“¹\x20Color')+':\x20'+new Date()[_0x441284(0x1c4)](),0xf,0x1c),_0x14a8e3[_0x441284(0x1d3)]=_0x441284(0x19a),_0x14a8e3[_0x441284(0x1e0)]=_0x441284(0x1a0),_0x14a8e3[_0x441284(0x1eb)](_0x441284(0x1ab)+_0x5b1223[_0x441284(0x208)]('/')[_0x441284(0x164)](),0xf,0x2d),this['sendFrameToVideoSource'](_0x126ae6,_0xd2bd7);}catch(_0x17b3b6){console[_0x441284(0x180)](_0x441284(0x21a)+_0x5b1223+':',_0x17b3b6['message']);_0x5b1223[_0x441284(0x160)](_0x441284(0x1a3))&&Math[_0x441284(0x212)]()<0.1&&console[_0x441284(0x180)]('[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20'+_0x5b1223[_0x441284(0x189)](_0x441284(0x1b4),'/image_raw'));_0x14a8e3[_0x441284(0x1d3)]=_0x441284(0x1af),_0x14a8e3[_0x441284(0x202)](0x0,0x0,_0xd2bd7['width'],_0xd2bd7[_0x441284(0x16d)]),_0x14a8e3[_0x441284(0x1d3)]='#888',_0x14a8e3['font']=_0x441284(0x1b5),_0x14a8e3['textAlign']=_0x441284(0x1f8);const _0x14f848=_0x5b1223[_0x441284(0x160)]('depth')?_0x441284(0x1e5):'ðŸ“¹\x20Processing\x20video...';_0x14a8e3[_0x441284(0x1eb)](_0x14f848,_0xd2bd7[_0x441284(0x1bd)]/0x2,_0xd2bd7[_0x441284(0x16d)]/0x2),_0x14a8e3[_0x441284(0x1d3)]='#666',_0x14a8e3[_0x441284(0x1e0)]=_0x441284(0x1e7),_0x14a8e3[_0x441284(0x1eb)]('Topic:\x20'+_0x5b1223[_0x441284(0x208)]('/')[_0x441284(0x164)](),_0xd2bd7['width']/0x2,_0xd2bd7['height']/0x2+0x19),this['sendFrameToVideoSource'](_0x126ae6,_0xd2bd7);}}[a6_0x2761fd(0x1fd)](_0xb25b6d){const _0x14b799=a6_0x2761fd,_0x57dccc=this[_0x14b799(0x1e6)]['get'](_0xb25b6d);if(!_0x57dccc){console[_0x14b799(0x180)]('[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20'+_0xb25b6d);return;}console[_0x14b799(0x167)](_0x14b799(0x168)+_0xb25b6d+_0x14b799(0x166)+_0x57dccc[_0x14b799(0x1e2)]);try{this[_0x14b799(0x1fa)]&&this['serverWs']['readyState']===this['serverWs'][_0x14b799(0x1ca)]&&this[_0x14b799(0x1fa)]['send'](JSON[_0x14b799(0x1ee)]({'op':_0x14b799(0x1fc),'session_id':_0xb25b6d})),_0x57dccc['videoTrack']&&_0x57dccc[_0x14b799(0x1e8)]['stop'](),_0x57dccc[_0x14b799(0x1b7)]&&_0x57dccc[_0x14b799(0x1b7)]['close']();}catch(_0x1b5613){console[_0x14b799(0x1c1)](_0x14b799(0x197)+_0x1b5613);}this[_0x14b799(0x1cc)](_0xb25b6d);}[a6_0x2761fd(0x1cc)](_0x42f80f){const _0x42a974=a6_0x2761fd,_0x4f2121=this[_0x42a974(0x1e6)][_0x42a974(0x214)](_0x42f80f);if(_0x4f2121){const _0x2cae0f=this['topicSessions'][_0x42a974(0x214)](_0x4f2121['topic']);_0x2cae0f&&(_0x2cae0f[_0x42a974(0x19b)](_0x42f80f),_0x2cae0f['size']===0x0&&this[_0x42a974(0x19d)][_0x42a974(0x19b)](_0x4f2121['topic'])),this[_0x42a974(0x184)](_0x4f2121[_0x42a974(0x1e2)]);}this['activeSessions'][_0x42a974(0x19b)](_0x42f80f),console[_0x42a974(0x167)](_0x42a974(0x16a)+_0x42f80f);}[a6_0x2761fd(0x17c)](){const _0x2ededb=a6_0x2761fd;console[_0x2ededb(0x167)](_0x2ededb(0x176));const _0x3557f4=Array[_0x2ededb(0x1fe)](this['activeSessions']['keys']());_0x3557f4[_0x2ededb(0x16b)](_0x23f454=>this['stopSession'](_0x23f454));}[a6_0x2761fd(0x219)](){const _0x1859d5=a6_0x2761fd,_0x4a5997=[];for(const [_0x150672,_0x23fc5e]of this[_0x1859d5(0x1e6)]){_0x4a5997['push']({'sessionId':_0x150672,'topic':_0x23fc5e[_0x1859d5(0x1e2)],'connectionState':_0x23fc5e['peerConnection']?.[_0x1859d5(0x20b)]||_0x1859d5(0x1f5),'hasVideoTrack':!!_0x23fc5e[_0x1859d5(0x1e8)]});}return _0x4a5997;}['getSharedVideoSources'](){const _0x10bfd8=a6_0x2761fd,_0x347b97=[];for(const [_0x1ade0d,_0x1a6a29]of this[_0x10bfd8(0x159)]){_0x347b97[_0x10bfd8(0x1f1)]({'topic':_0x1ade0d,'frameCount':_0x1a6a29[_0x10bfd8(0x1ad)],'hasVideoSource':!!_0x1a6a29[_0x10bfd8(0x179)],'hasRosSubscriber':!!_0x1a6a29[_0x10bfd8(0x1db)]});}return _0x347b97;}}module[a6_0x2761fd(0x171)]=new ApplianceWebRTCService();