function a6_0x51b0(){const _0x4902a1=['readyState','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','989155AAVIxo','type','apply','handleMessage','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','videoSource','/image_raw','fillStyle','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','width','max','🔍\x20Processing\x20depth...','subscribe','stun:stun1.l.google.com:19302','stopSession','initialize','rosSubscriber','getOrCreateSharedVideoSource','1502450FtPeKa','sin','warn','#888','webrtc_ice_candidate','round','rgba(0,\x20170,\x20255,\x20','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','base64','addIceCandidate','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','sharp','87458ilMtaz','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','onicecandidate','Waiting\x20for\x20ROS\x20image\x20data...','releaseSharedVideoSource','./DepthImageProcessor','handleIceCandidate','12px\x20Arial','video','drawLoadingPattern','now','closed','height','/image','size','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','sensor_msgs/Image','1854396JrKtGE','sensor_msgs/msg/CompressedImage','min','framerate','../config','initializing','forEach','startsWith','search','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','createAnswer','4MHeqwL','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','getSharedVideoSources','\x20for\x20topic:\x20','[WebRTC\x20Appliance]\x20Topic\x20','rtcConfig','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','1179783sNwWkR','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','\x20connection\x20closed,\x20cleaning\x20up','close','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','42AjykQM','push','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','#00ffff','sensor_msgs/CompressedImage','get','log','onFrame','has','rgba(0,\x200,\x200,\x200.7)','send','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','🔍\x20Depth','set','createTrack','/compressed','putImageData','font','getImageData','669042pQlssX','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','stopAllSessions','#00ff00','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','exports','fillRect','length','videoTrack','📹\x20Color','\x20sessions\x20remaining)','\x20detected\x20as\x20','connectionState','session_id','offer','removeEventListener','protocol','canvas','topic','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','fillText','beginPath','webrtc_stop_session','peerConnection','10px\x20monospace','topicSessions','data','addEventListener','/compressedDepth','depthProcessor','msg','textAlign',',\x20converting\x20to\x20base64...','stringify','compressedDepth','rosbridgeWs','unsubscribe','connected','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','updateTurnCredentials','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','color','depth','fill','handleOffer','add','[WebRTC\x20Appliance]\x20Session\x20','failed','16px\x20Arial','processColorImage','serverWs','candidate',',\x20size:\x20','compressed_depth_image_transport/CompressedDepthImage','\x20connection\x20failed,\x20stopping\x20session','random','onconnectionstatechange','replace','toLocaleTimeString','Topic:\x20','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','OPEN','split','address','\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','serverUrl','sharedVideoSources','includes','setLocalDescription','arc','getIceServers','getActiveSessions','iceServers','updateCanvasWithImageData','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','sendFrameToVideoSource','\x20image,\x20trying\x20message\x20types:','🤖\x20Robot\x20Camera','center','#666','publish','function','pop',',\x20trying\x20alternative\x20depth\x20topics','#1a1a1a','webrtc','unknown','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20',',\x20cleaning\x20up\x20shared\x20resources','webrtc_answer','24px\x20Arial','toString','keys','frameCount','./turnCredentialsService','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','[WebRTC\x20Appliance]\x20Created\x20answer','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','\x20successfully\x20connected!','\x20initialized\x20successfully','stun:stun.l.google.com:19302','[WebRTC\x20Appliance]\x20Service\x20initialized','initializeSession','convertRGBAtoI420','\x20sessions)','getContext','cleanupSession','160GJFoIa','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','parse','message','setRemoteDescription','port','activeSessions','error','#ffffff','4967vjwrkY','delete'];a6_0x51b0=function(){return _0x4902a1;};return a6_0x51b0();}const a6_0xd953c5=a6_0x2a6a;(function(_0x302ecc,_0x441c12){const _0x173cd2=a6_0x2a6a,_0x160bdf=_0x302ecc();while(!![]){try{const _0xc715bc=parseInt(_0x173cd2(0x12f))/0x1*(parseInt(_0x173cd2(0x17c))/0x2)+parseInt(_0x173cd2(0x18f))/0x3+parseInt(_0x173cd2(0x170))/0x4*(-parseInt(_0x173cd2(0x133))/0x5)+parseInt(_0x173cd2(0x165))/0x6+-parseInt(_0x173cd2(0x153))/0x7*(parseInt(_0x173cd2(0x126))/0x8)+parseInt(_0x173cd2(0x177))/0x9+-parseInt(_0x173cd2(0x145))/0xa;if(_0xc715bc===_0x441c12)break;else _0x160bdf['push'](_0x160bdf['shift']());}catch(_0x3537a4){_0x160bdf['push'](_0x160bdf['shift']());}}}(a6_0x51b0,0x2962e));const a6_0x822910=(function(){let _0x1387bc=!![];return function(_0xb93161,_0x1de126){const _0x4564a8=_0x1387bc?function(){const _0x20f9db=a6_0x2a6a;if(_0x1de126){const _0x4e47ba=_0x1de126[_0x20f9db(0x135)](_0xb93161,arguments);return _0x1de126=null,_0x4e47ba;}}:function(){};return _0x1387bc=![],_0x4564a8;};}()),a6_0x49fe93=a6_0x822910(this,function(){const _0x49f03b=a6_0x2a6a;return a6_0x49fe93[_0x49f03b(0x115)]()[_0x49f03b(0x16d)]('(((.+)+)+)+$')['toString']()['constructor'](a6_0x49fe93)[_0x49f03b(0x16d)]('(((.+)+)+)+$');});a6_0x49fe93();function a6_0x2a6a(_0x2aeb44,_0x36209c){const _0x532c0d=a6_0x51b0();return a6_0x2a6a=function(_0x49fe93,_0x822910){_0x49fe93=_0x49fe93-0xe6;let _0x51b0f3=_0x532c0d[_0x49fe93];return _0x51b0f3;},a6_0x2a6a(_0x2aeb44,_0x36209c);}const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require('wrtc'),sharp=require(a6_0xd953c5(0x152)),config=require(a6_0xd953c5(0x169)),DepthImageProcessor=require(a6_0xd953c5(0x159)),turnCredentialsService=require(a6_0xd953c5(0x118));class ApplianceWebRTCService{constructor(){const _0x262492=a6_0xd953c5;this[_0x262492(0x12c)]=new Map(),this[_0x262492(0x1aa)]=new Map(),this[_0x262492(0xfc)]=new Map(),this['rosbridgeWs']=null,this[_0x262492(0xea)]=null,this[_0x262492(0x1ae)]=new DepthImageProcessor(),this[_0x262492(0x175)]={'iceServers':[{'urls':_0x262492(0x11f)},{'urls':_0x262492(0x140)}]};}[a6_0xd953c5(0x142)](_0x3730b1,_0x1d5c11){const _0x513b4b=a6_0xd953c5;this[_0x513b4b(0x1b4)]=_0x3730b1,this[_0x513b4b(0xea)]=_0x1d5c11,turnCredentialsService[_0x513b4b(0x142)](config[_0x513b4b(0xfb)]),this[_0x513b4b(0x1b8)](),console[_0x513b4b(0x182)](_0x513b4b(0x120));}async[a6_0xd953c5(0x1b8)](){const _0x536a86=a6_0xd953c5;try{console[_0x536a86(0x182)](_0x536a86(0x151));const _0x51b618=await turnCredentialsService[_0x536a86(0x100)]();this[_0x536a86(0x175)][_0x536a86(0x102)]=_0x51b618,console[_0x536a86(0x182)](_0x536a86(0x155));}catch(_0x327279){console[_0x536a86(0x12d)](_0x536a86(0x1b7),_0x327279),console[_0x536a86(0x182)]('[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers');}}[a6_0xd953c5(0x136)](_0x54cf3e){const _0x4b8df2=a6_0xd953c5;if(!_0x54cf3e['op']||!_0x54cf3e['op'][_0x4b8df2(0x16c)]('webrtc_'))return![];console[_0x4b8df2(0x182)](_0x4b8df2(0x1b9)+_0x54cf3e['op']);switch(_0x54cf3e['op']){case'webrtc_init_session':this[_0x4b8df2(0x121)](_0x54cf3e['session_id'],_0x54cf3e['topic']);return!![];case'webrtc_offer':this['handleOffer'](_0x54cf3e['session_id'],_0x54cf3e[_0x4b8df2(0x19d)]);return!![];case _0x4b8df2(0x149):this[_0x4b8df2(0x15a)](_0x54cf3e[_0x4b8df2(0x19c)],_0x54cf3e[_0x4b8df2(0xeb)]);return!![];case'webrtc_stop_session':this[_0x4b8df2(0x141)](_0x54cf3e[_0x4b8df2(0x19c)]);return!![];default:console[_0x4b8df2(0x147)](_0x4b8df2(0x14f)+_0x54cf3e['op']);return![];}}[a6_0xd953c5(0x144)](_0x1f24e3){const _0x5c60f4=a6_0xd953c5;if(this[_0x5c60f4(0xfc)][_0x5c60f4(0x184)](_0x1f24e3)){const _0x41cded=this['sharedVideoSources'][_0x5c60f4(0x181)](_0x1f24e3);return _0x41cded[_0x5c60f4(0x117)]++,console['log'](_0x5c60f4(0x104)+_0x1f24e3+'\x20('+_0x41cded[_0x5c60f4(0x117)]+_0x5c60f4(0x123)),_0x41cded;}console['log']('[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x1f24e3);const {createCanvas:_0x3e3b3a}=require('canvas'),_0x88ca3=_0x3e3b3a(config[_0x5c60f4(0x10f)][_0x5c60f4(0x15c)][_0x5c60f4(0x13c)],config[_0x5c60f4(0x10f)]['video'][_0x5c60f4(0x160)]),_0x2b54cb=_0x88ca3['getContext']('2d');this[_0x5c60f4(0x15d)](_0x88ca3,_0x2b54cb);const {RTCVideoSource:_0x17a8d5}=nonstandard,_0x4ad711=new _0x17a8d5();let _0x3cdb61=0x0;const _0x5246f7=0x3e8/config['webrtc'][_0x5c60f4(0x15c)][_0x5c60f4(0x168)],_0x691483=this['subscribeToROSTopic'](_0x1f24e3,_0x30e450=>{const _0x54ff24=_0x5c60f4,_0x87cee9=Date[_0x54ff24(0x15e)]();_0x87cee9-_0x3cdb61>=_0x5246f7&&(_0x3cdb61=_0x87cee9,this[_0x54ff24(0x103)](_0x88ca3,_0x2b54cb,_0x30e450,_0x1f24e3,_0x4ad711));}),_0x382f62={'videoSource':_0x4ad711,'canvas':_0x88ca3,'rosSubscriber':_0x691483,'frameCount':0x1,'topic':_0x1f24e3};return this['sharedVideoSources'][_0x5c60f4(0x189)](_0x1f24e3,_0x382f62),_0x382f62;}['releaseSharedVideoSource'](_0x511672){const _0x3c23f1=a6_0xd953c5,_0x527249=this[_0x3c23f1(0xfc)][_0x3c23f1(0x181)](_0x511672);if(!_0x527249)return;_0x527249[_0x3c23f1(0x117)]--,console[_0x3c23f1(0x182)](_0x3c23f1(0x178)+_0x511672+'\x20('+_0x527249[_0x3c23f1(0x117)]+_0x3c23f1(0x199)),_0x527249['frameCount']<=0x0&&(console[_0x3c23f1(0x182)](_0x3c23f1(0x127)+_0x511672+_0x3c23f1(0x112)),_0x527249[_0x3c23f1(0x138)]&&(_0x527249[_0x3c23f1(0x138)]=null),_0x527249[_0x3c23f1(0x143)]&&_0x527249[_0x3c23f1(0x143)][_0x3c23f1(0x1b5)](),this['sharedVideoSources']['delete'](_0x511672));}async[a6_0xd953c5(0x121)](_0x2cce39,_0x341ae2){const _0x3c2218=a6_0xd953c5;try{console[_0x3c2218(0x182)](_0x3c2218(0x11c)+_0x2cce39+_0x3c2218(0xf9)+_0x341ae2);const _0x52fcff=this[_0x3c2218(0x144)](_0x341ae2),_0x3d4f78=new RTCPeerConnection(this['rtcConfig']),_0x16e1cd=_0x52fcff[_0x3c2218(0x138)][_0x3c2218(0x18a)]({'width':config['webrtc'][_0x3c2218(0x15c)][_0x3c2218(0x13c)],'height':config[_0x3c2218(0x10f)]['video'][_0x3c2218(0x160)],'framerate':config['webrtc'][_0x3c2218(0x15c)]['framerate']});console[_0x3c2218(0x182)](_0x3c2218(0x132)+_0x2cce39);const {MediaStream:_0x482b3e}=require('wrtc'),_0x5d8e8e=new _0x482b3e([_0x16e1cd]);_0x3d4f78['addTrack'](_0x16e1cd,_0x5d8e8e),this[_0x3c2218(0x105)](_0x52fcff[_0x3c2218(0x138)],_0x52fcff[_0x3c2218(0x1a0)]),_0x3d4f78[_0x3c2218(0x156)]=_0x2cac40=>{const _0x317d65=_0x3c2218;if(_0x2cac40['candidate']&&this['serverWs'])console[_0x317d65(0x182)](_0x317d65(0x1a4)+_0x2cce39+':',{'type':_0x2cac40[_0x317d65(0xeb)][_0x317d65(0x134)],'protocol':_0x2cac40['candidate'][_0x317d65(0x19f)],'address':_0x2cac40['candidate'][_0x317d65(0xf8)],'port':_0x2cac40[_0x317d65(0xeb)][_0x317d65(0x12b)]}),this[_0x317d65(0xea)][_0x317d65(0x186)](JSON[_0x317d65(0x1b2)]({'op':_0x317d65(0x149),'session_id':_0x2cce39,'candidate':_0x2cac40[_0x317d65(0xeb)]}));else!_0x2cac40[_0x317d65(0xeb)]&&console[_0x317d65(0x182)](_0x317d65(0x163)+_0x2cce39);},_0x3d4f78[_0x3c2218(0xf0)]=()=>{const _0x28c424=_0x3c2218;console[_0x28c424(0x182)](_0x28c424(0xe6)+_0x2cce39+'\x20connection\x20state:\x20'+_0x3d4f78[_0x28c424(0x19b)]);if(_0x3d4f78[_0x28c424(0x19b)]===_0x28c424(0x1b6))console[_0x28c424(0x182)](_0x28c424(0xe6)+_0x2cce39+_0x28c424(0x11d));else{if(_0x3d4f78[_0x28c424(0x19b)]===_0x28c424(0xe7))console[_0x28c424(0x182)](_0x28c424(0xe6)+_0x2cce39+_0x28c424(0xee)),this[_0x28c424(0x141)](_0x2cce39);else _0x3d4f78[_0x28c424(0x19b)]===_0x28c424(0x15f)&&(console[_0x28c424(0x182)](_0x28c424(0xe6)+_0x2cce39+_0x28c424(0x179)),this['cleanupSession'](_0x2cce39));}},this[_0x3c2218(0x12c)][_0x3c2218(0x189)](_0x2cce39,{'peerConnection':_0x3d4f78,'topic':_0x341ae2,'videoTrack':_0x16e1cd,'mediaStream':_0x5d8e8e,'status':_0x3c2218(0x16a)}),!this[_0x3c2218(0x1aa)]['has'](_0x341ae2)&&this[_0x3c2218(0x1aa)][_0x3c2218(0x189)](_0x341ae2,new Set()),this[_0x3c2218(0x1aa)][_0x3c2218(0x181)](_0x341ae2)[_0x3c2218(0x1be)](_0x2cce39),console[_0x3c2218(0x182)](_0x3c2218(0xe6)+_0x2cce39+_0x3c2218(0x11e)),console[_0x3c2218(0x182)](_0x3c2218(0x16e)+_0x341ae2+':\x20'+this['topicSessions'][_0x3c2218(0x181)](_0x341ae2)[_0x3c2218(0x162)]);}catch(_0x257319){console['error'](_0x3c2218(0x190)+_0x2cce39+':',_0x257319),this[_0x3c2218(0x141)](_0x2cce39);}}async[a6_0xd953c5(0x1bd)](_0x461fba,_0x38066f){const _0x5c9bb9=a6_0xd953c5,_0x202478=this[_0x5c9bb9(0x12c)][_0x5c9bb9(0x181)](_0x461fba);if(!_0x202478){console[_0x5c9bb9(0x12d)](_0x5c9bb9(0x14c)+_0x461fba);return;}try{console[_0x5c9bb9(0x182)]('[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20'+_0x461fba),await _0x202478[_0x5c9bb9(0x1a8)][_0x5c9bb9(0x12a)](new RTCSessionDescription(_0x38066f)),console[_0x5c9bb9(0x182)]('[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)');const _0xecc695=await _0x202478['peerConnection'][_0x5c9bb9(0x16f)]();console[_0x5c9bb9(0x182)](_0x5c9bb9(0x11a)),await _0x202478[_0x5c9bb9(0x1a8)][_0x5c9bb9(0xfe)](_0xecc695),console['log'](_0x5c9bb9(0xf5)),this['serverWs']&&(this[_0x5c9bb9(0xea)][_0x5c9bb9(0x186)](JSON['stringify']({'op':_0x5c9bb9(0x113),'session_id':_0x461fba,'answer':_0xecc695})),console[_0x5c9bb9(0x182)](_0x5c9bb9(0x187)+_0x461fba));}catch(_0x12c053){console[_0x5c9bb9(0x12d)](_0x5c9bb9(0x150)+_0x461fba+':',_0x12c053),this['stopSession'](_0x461fba);}}async['handleIceCandidate'](_0x21c21a,_0x388966){const _0x259557=a6_0xd953c5,_0x4c1124=this[_0x259557(0x12c)][_0x259557(0x181)](_0x21c21a);if(!_0x4c1124){console[_0x259557(0x12d)](_0x259557(0xfa)+_0x21c21a);return;}try{await _0x4c1124[_0x259557(0x1a8)][_0x259557(0x14e)](new RTCIceCandidate(_0x388966)),console['log']('[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20'+_0x21c21a);}catch(_0x360c31){console[_0x259557(0x12d)](_0x259557(0x111)+_0x21c21a+':',_0x360c31);}}['subscribeToROSTopic'](_0x1660a4,_0x305e84){const _0x3c2dfb=a6_0xd953c5;if(!this[_0x3c2dfb(0x1b4)]||this[_0x3c2dfb(0x1b4)][_0x3c2dfb(0x131)]!==this['rosbridgeWs'][_0x3c2dfb(0xf6)])return console[_0x3c2dfb(0x12d)]('[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected'),null;console['log'](_0x3c2dfb(0x119)+_0x1660a4);const _0x2d708c=_0x1660a4['includes'](_0x3c2dfb(0x1bb)),_0x5cbe41=_0x1660a4[_0x3c2dfb(0xfd)]('compressed')||_0x1660a4[_0x3c2dfb(0xfd)](_0x3c2dfb(0x1b3));let _0x1072a9=[];_0x2d708c?_0x5cbe41?_0x1072a9=[_0x3c2dfb(0x180),_0x3c2dfb(0x166),_0x3c2dfb(0xed),_0x3c2dfb(0x164)]:_0x1072a9=[_0x3c2dfb(0x164),'sensor_msgs/msg/Image',_0x3c2dfb(0x180)]:_0x1072a9=[_0x3c2dfb(0x180),_0x3c2dfb(0x166),_0x3c2dfb(0x164)];console[_0x3c2dfb(0x182)](_0x3c2dfb(0x174)+_0x1660a4+_0x3c2dfb(0x19a)+(_0x2d708c?_0x3c2dfb(0x1bb):_0x3c2dfb(0x1ba))+_0x3c2dfb(0x106),_0x1072a9);const _0x16f161=[];let _0x331906=![];const _0x589b09=_0x28b782=>{return _0x42294b=>{const _0x2dcd02=a6_0x2a6a;try{const _0x1f5284=JSON['parse'](_0x42294b[_0x2dcd02(0x1ab)]);_0x1f5284['op']===_0x2dcd02(0x10a)&&_0x1f5284[_0x2dcd02(0x1a1)]===_0x1660a4&&_0x1f5284[_0x2dcd02(0x1af)]&&(!_0x331906&&(console[_0x2dcd02(0x182)]('[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20'+_0x1660a4+'\x20with\x20message\x20type\x20'+_0x28b782),_0x331906=!![]),_0x305e84(_0x1f5284[_0x2dcd02(0x1af)]));}catch(_0x1a2cb1){console[_0x2dcd02(0x12d)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x1a2cb1);}};};for(const _0x504425 of _0x1072a9){const _0x3f92b7={'op':_0x3c2dfb(0x13f),'topic':_0x1660a4,'type':_0x504425};console[_0x3c2dfb(0x182)](_0x3c2dfb(0x17b)+_0x504425),this[_0x3c2dfb(0x1b4)]['send'](JSON[_0x3c2dfb(0x1b2)](_0x3f92b7));const _0x2fda1a=_0x589b09(_0x504425);this[_0x3c2dfb(0x1b4)]['addEventListener'](_0x3c2dfb(0x129),_0x2fda1a),_0x16f161[_0x3c2dfb(0x17d)]({'handler':_0x2fda1a,'type':_0x504425});}return _0x2d708c&&_0x5cbe41&&setTimeout(()=>{const _0xe8f869=_0x3c2dfb;if(!_0x331906){console[_0xe8f869(0x182)](_0xe8f869(0x193)+_0x1660a4+_0xe8f869(0x10d));const _0x464c54=_0x1660a4[_0xe8f869(0xf1)](_0xe8f869(0x1ad),'')[_0xe8f869(0xf1)](_0xe8f869(0x18b),''),_0x2a3235=[_0x464c54+_0xe8f869(0x139),_0x464c54+_0xe8f869(0x161),_0x464c54];for(const _0x50cb48 of _0x2a3235){console['log'](_0xe8f869(0xf4)+_0x50cb48);const _0x4130a9={'op':'subscribe','topic':_0x50cb48,'type':'sensor_msgs/Image'};this[_0xe8f869(0x1b4)]['send'](JSON['stringify'](_0x4130a9));const _0x174601=_0x13e4b9=>{const _0x4fe8bd=_0xe8f869;try{const _0x228376=JSON[_0x4fe8bd(0x128)](_0x13e4b9['data']);_0x228376['op']===_0x4fe8bd(0x10a)&&_0x228376[_0x4fe8bd(0x1a1)]===_0x50cb48&&_0x228376['msg']&&(console['log'](_0x4fe8bd(0x1a2)+_0x50cb48+_0x4fe8bd(0x1b1)),_0x228376[_0x4fe8bd(0x1af)][_0x4fe8bd(0x1ab)]&&!_0x228376[_0x4fe8bd(0x1af)][_0x4fe8bd(0x1ab)]['startsWith']('/9j/')&&_0x305e84(_0x228376[_0x4fe8bd(0x1af)]));}catch(_0x540d71){console[_0x4fe8bd(0x12d)](_0x4fe8bd(0x17e),_0x540d71);}};this['rosbridgeWs'][_0xe8f869(0x1ac)](_0xe8f869(0x129),_0x174601),_0x16f161[_0xe8f869(0x17d)]({'handler':_0x174601,'type':'sensor_msgs/Image','topic':_0x50cb48});}}},0xbb8),{'unsubscribe':()=>{const _0x3378ba=_0x3c2dfb;for(const {handler:_0x127db3,type:_0x2404f7,topic:_0x42d84b}of _0x16f161){this[_0x3378ba(0x1b4)][_0x3378ba(0x19e)](_0x3378ba(0x129),_0x127db3),this[_0x3378ba(0x1b4)][_0x3378ba(0x131)]===this['rosbridgeWs']['OPEN']&&this[_0x3378ba(0x1b4)][_0x3378ba(0x186)](JSON[_0x3378ba(0x1b2)]({'op':_0x3378ba(0x1b5),'topic':_0x42d84b||_0x1660a4}));}}};}[a6_0xd953c5(0x15d)](_0x4fc7b5,_0x17a72b){const _0x4aed22=a6_0xd953c5;_0x17a72b[_0x4aed22(0x13a)]=_0x4aed22(0x10e),_0x17a72b[_0x4aed22(0x195)](0x0,0x0,_0x4fc7b5[_0x4aed22(0x13c)],_0x4fc7b5[_0x4aed22(0x160)]),_0x17a72b[_0x4aed22(0x13a)]='#00aaff',_0x17a72b[_0x4aed22(0x18d)]=_0x4aed22(0x114),_0x17a72b[_0x4aed22(0x1b0)]=_0x4aed22(0x108),_0x17a72b['fillText'](_0x4aed22(0x107),_0x4fc7b5[_0x4aed22(0x13c)]/0x2,_0x4fc7b5[_0x4aed22(0x160)]/0x2-0x14),_0x17a72b['fillStyle']=_0x4aed22(0x12e),_0x17a72b[_0x4aed22(0x18d)]='16px\x20Arial',_0x17a72b[_0x4aed22(0x1a5)](_0x4aed22(0x157),_0x4fc7b5['width']/0x2,_0x4fc7b5[_0x4aed22(0x160)]/0x2+0x14);const _0x185e03=Date[_0x4aed22(0x15e)]()/0x3e8;for(let _0x2d9828=0x0;_0x2d9828<0x3;_0x2d9828++){const _0x1ca822=(Math[_0x4aed22(0x146)](_0x185e03*0x2+_0x2d9828*0.5)+0x1)/0x2;_0x17a72b[_0x4aed22(0x13a)]=_0x4aed22(0x14b)+_0x1ca822*0.5+')',_0x17a72b[_0x4aed22(0x1a6)](),_0x17a72b[_0x4aed22(0xff)](_0x4fc7b5[_0x4aed22(0x13c)]/0x2-0x28+_0x2d9828*0x28,_0x4fc7b5[_0x4aed22(0x160)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x17a72b[_0x4aed22(0x1bc)]();}}[a6_0xd953c5(0x105)](_0x4a12e7,_0x4e0b29){const _0xe0721f=a6_0xd953c5;try{if(!_0x4a12e7||!_0x4e0b29)return;const _0x2cb680=_0x4e0b29[_0xe0721f(0x124)]('2d'),_0x5d6b64=_0x2cb680[_0xe0721f(0x18e)](0x0,0x0,_0x4e0b29['width'],_0x4e0b29[_0xe0721f(0x160)]),_0x1dcbd4=this[_0xe0721f(0x122)](_0x5d6b64[_0xe0721f(0x1ab)],_0x4e0b29['width'],_0x4e0b29[_0xe0721f(0x160)]),_0x4ff58f={'width':_0x4e0b29[_0xe0721f(0x13c)],'height':_0x4e0b29[_0xe0721f(0x160)],'data':_0x1dcbd4};typeof _0x4a12e7['onFrame']===_0xe0721f(0x10b)&&_0x4a12e7[_0xe0721f(0x183)](_0x4ff58f);}catch(_0xbfe5be){console[_0xe0721f(0x12d)](_0xe0721f(0x154),_0xbfe5be);}}[a6_0xd953c5(0x122)](_0x282264,_0x4af80a,_0x2e602b){const _0x1539b3=a6_0xd953c5,_0x5e432a=_0x4af80a*_0x2e602b,_0x453ca7=_0x4af80a*_0x2e602b/0x4,_0x26ba3f=new Uint8Array(_0x5e432a+_0x453ca7*0x2);let _0x318b84=0x0,_0x267b30=_0x5e432a,_0x3c8f5e=_0x5e432a+_0x453ca7;for(let _0x4fda72=0x0;_0x4fda72<_0x2e602b;_0x4fda72++){for(let _0x4ae865=0x0;_0x4ae865<_0x4af80a;_0x4ae865++){const _0x156126=(_0x4fda72*_0x4af80a+_0x4ae865)*0x4,_0x232482=_0x282264[_0x156126],_0x123229=_0x282264[_0x156126+0x1],_0xc9039a=_0x282264[_0x156126+0x2],_0x3755fe=Math[_0x1539b3(0x14a)](0.299*_0x232482+0.587*_0x123229+0.114*_0xc9039a);_0x26ba3f[_0x318b84++]=_0x3755fe;if(_0x4fda72%0x2===0x0&&_0x4ae865%0x2===0x0){const _0x387434=Math[_0x1539b3(0x14a)](-0.169*_0x232482-0.331*_0x123229+0.5*_0xc9039a+0x80),_0x41f572=Math[_0x1539b3(0x14a)](0.5*_0x232482-0.419*_0x123229-0.081*_0xc9039a+0x80);_0x26ba3f[_0x267b30++]=Math[_0x1539b3(0x13d)](0x0,Math[_0x1539b3(0x167)](0xff,_0x387434)),_0x26ba3f[_0x3c8f5e++]=Math[_0x1539b3(0x13d)](0x0,Math['min'](0xff,_0x41f572));}}}return _0x26ba3f;}async[a6_0xd953c5(0x103)](_0x2753bf,_0x4ccc4e,_0x470784,_0x3a81f1,_0x4e4c21){const _0x298185=a6_0xd953c5;try{if(!_0x470784||!_0x470784[_0x298185(0x1ab)])return;Math[_0x298185(0xef)]()<0.01&&console[_0x298185(0x182)](_0x298185(0x171)+_0x3a81f1+_0x298185(0xec)+_0x470784[_0x298185(0x1ab)][_0x298185(0x196)]+'\x20bytes');const _0x458d72=Buffer['from'](_0x470784['data'],_0x298185(0x14d)),_0x5a57da=this[_0x298185(0x1ae)]['isDepthTopic'](_0x3a81f1);let _0x340c8d;_0x5a57da?_0x340c8d=await this[_0x298185(0x1ae)]['processDepthImage'](_0x458d72,_0x2753bf,_0x4ccc4e,_0x3a81f1):_0x340c8d=await this['depthProcessor'][_0x298185(0xe9)](_0x458d72,_0x2753bf,_0x4ccc4e),_0x4ccc4e[_0x298185(0x18c)](_0x340c8d,0x0,0x0),_0x4ccc4e['fillStyle']=_0x298185(0x185),_0x4ccc4e[_0x298185(0x195)](0xa,0xa,0xdc,0x32),_0x4ccc4e['fillStyle']=_0x5a57da?_0x298185(0x17f):_0x298185(0x192),_0x4ccc4e[_0x298185(0x18d)]='12px\x20monospace',_0x4ccc4e[_0x298185(0x1a5)]((_0x5a57da?_0x298185(0x188):_0x298185(0x198))+':\x20'+new Date()[_0x298185(0xf2)](),0xf,0x1c),_0x4ccc4e[_0x298185(0x13a)]=_0x298185(0x12e),_0x4ccc4e[_0x298185(0x18d)]=_0x298185(0x1a9),_0x4ccc4e[_0x298185(0x1a5)](_0x298185(0xf3)+_0x3a81f1['split']('/')['pop'](),0xf,0x2d),this[_0x298185(0x105)](_0x4e4c21,_0x2753bf);}catch(_0x5325b9){console['warn']('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x3a81f1+':',_0x5325b9[_0x298185(0x129)]);_0x3a81f1[_0x298185(0xfd)](_0x298185(0x1bb))&&Math[_0x298185(0xef)]()<0.1&&console[_0x298185(0x147)](_0x298185(0x1a3)+_0x3a81f1[_0x298185(0xf1)](_0x298185(0x1ad),'/image_raw'));_0x4ccc4e[_0x298185(0x13a)]='#1a1a1a',_0x4ccc4e['fillRect'](0x0,0x0,_0x2753bf[_0x298185(0x13c)],_0x2753bf[_0x298185(0x160)]),_0x4ccc4e[_0x298185(0x13a)]=_0x298185(0x148),_0x4ccc4e[_0x298185(0x18d)]=_0x298185(0xe8),_0x4ccc4e[_0x298185(0x1b0)]=_0x298185(0x108);const _0x406192=_0x3a81f1[_0x298185(0xfd)]('depth')?_0x298185(0x13e):'📹\x20Processing\x20video...';_0x4ccc4e[_0x298185(0x1a5)](_0x406192,_0x2753bf[_0x298185(0x13c)]/0x2,_0x2753bf[_0x298185(0x160)]/0x2),_0x4ccc4e[_0x298185(0x13a)]=_0x298185(0x109),_0x4ccc4e[_0x298185(0x18d)]=_0x298185(0x15b),_0x4ccc4e[_0x298185(0x1a5)]('Topic:\x20'+_0x3a81f1[_0x298185(0xf7)]('/')[_0x298185(0x10c)](),_0x2753bf['width']/0x2,_0x2753bf[_0x298185(0x160)]/0x2+0x19),this[_0x298185(0x105)](_0x4e4c21,_0x2753bf);}}[a6_0xd953c5(0x141)](_0x17ba6d){const _0x277da4=a6_0xd953c5,_0x436345=this[_0x277da4(0x12c)][_0x277da4(0x181)](_0x17ba6d);if(!_0x436345){console[_0x277da4(0x147)](_0x277da4(0x13b)+_0x17ba6d);return;}console['log'](_0x277da4(0x176)+_0x17ba6d+_0x277da4(0x173)+_0x436345[_0x277da4(0x1a1)]);try{this[_0x277da4(0xea)]&&this[_0x277da4(0xea)][_0x277da4(0x131)]===this[_0x277da4(0xea)]['OPEN']&&this['serverWs'][_0x277da4(0x186)](JSON['stringify']({'op':_0x277da4(0x1a7),'session_id':_0x17ba6d})),_0x436345[_0x277da4(0x197)]&&_0x436345[_0x277da4(0x197)]['stop'](),_0x436345[_0x277da4(0x1a8)]&&_0x436345[_0x277da4(0x1a8)][_0x277da4(0x17a)]();}catch(_0x1d19bf){console[_0x277da4(0x12d)]('[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20'+_0x1d19bf);}this[_0x277da4(0x125)](_0x17ba6d);}[a6_0xd953c5(0x125)](_0x526867){const _0x2a5c4c=a6_0xd953c5,_0x18edd0=this[_0x2a5c4c(0x12c)][_0x2a5c4c(0x181)](_0x526867);if(_0x18edd0){const _0x3436f1=this[_0x2a5c4c(0x1aa)][_0x2a5c4c(0x181)](_0x18edd0[_0x2a5c4c(0x1a1)]);_0x3436f1&&(_0x3436f1[_0x2a5c4c(0x130)](_0x526867),_0x3436f1[_0x2a5c4c(0x162)]===0x0&&this['topicSessions'][_0x2a5c4c(0x130)](_0x18edd0[_0x2a5c4c(0x1a1)])),this[_0x2a5c4c(0x158)](_0x18edd0[_0x2a5c4c(0x1a1)]);}this[_0x2a5c4c(0x12c)][_0x2a5c4c(0x130)](_0x526867),console[_0x2a5c4c(0x182)](_0x2a5c4c(0x11b)+_0x526867);}[a6_0xd953c5(0x191)](){const _0x27139e=a6_0xd953c5;console[_0x27139e(0x182)](_0x27139e(0x137));const _0x42f61=Array['from'](this[_0x27139e(0x12c)][_0x27139e(0x116)]());_0x42f61[_0x27139e(0x16b)](_0x254e3e=>this['stopSession'](_0x254e3e));}[a6_0xd953c5(0x101)](){const _0x11b1ac=a6_0xd953c5,_0x50f8a4=[];for(const [_0xcbfab4,_0x5ee8ef]of this[_0x11b1ac(0x12c)]){_0x50f8a4[_0x11b1ac(0x17d)]({'sessionId':_0xcbfab4,'topic':_0x5ee8ef[_0x11b1ac(0x1a1)],'connectionState':_0x5ee8ef[_0x11b1ac(0x1a8)]?.[_0x11b1ac(0x19b)]||_0x11b1ac(0x110),'hasVideoTrack':!!_0x5ee8ef[_0x11b1ac(0x197)]});}return _0x50f8a4;}[a6_0xd953c5(0x172)](){const _0x545efe=a6_0xd953c5,_0x4ef447=[];for(const [_0x46bcd6,_0x4b1b7b]of this[_0x545efe(0xfc)]){_0x4ef447[_0x545efe(0x17d)]({'topic':_0x46bcd6,'frameCount':_0x4b1b7b[_0x545efe(0x117)],'hasVideoSource':!!_0x4b1b7b['videoSource'],'hasRosSubscriber':!!_0x4b1b7b[_0x545efe(0x143)]});}return _0x4ef447;}}module[a6_0xd953c5(0x194)]=new ApplianceWebRTCService();