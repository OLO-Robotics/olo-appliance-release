const a6_0xb9373c=a6_0x4fb1;function a6_0x4fb1(_0x139140,_0x21df86){const _0x565c9c=a6_0xe9a8();return a6_0x4fb1=function(_0x4e2b31,_0x5a0b67){_0x4e2b31=_0x4e2b31-0x7b;let _0xe9a8cf=_0x565c9c[_0x4e2b31];return _0xe9a8cf;},a6_0x4fb1(_0x139140,_0x21df86);}(function(_0x3f7e7d,_0x29f618){const _0x92c95b=a6_0x4fb1,_0x4a00d4=_0x3f7e7d();while(!![]){try{const _0x4bb629=-parseInt(_0x92c95b(0x12c))/0x1*(parseInt(_0x92c95b(0x144))/0x2)+-parseInt(_0x92c95b(0xa1))/0x3+parseInt(_0x92c95b(0x91))/0x4+-parseInt(_0x92c95b(0x82))/0x5+parseInt(_0x92c95b(0x143))/0x6*(parseInt(_0x92c95b(0xff))/0x7)+-parseInt(_0x92c95b(0xe2))/0x8+parseInt(_0x92c95b(0x152))/0x9;if(_0x4bb629===_0x29f618)break;else _0x4a00d4['push'](_0x4a00d4['shift']());}catch(_0xc0d2e8){_0x4a00d4['push'](_0x4a00d4['shift']());}}}(a6_0xe9a8,0xb79bb));const a6_0x5a0b67=(function(){let _0x477605=!![];return function(_0x2d5bd9,_0x17f948){const _0x303b63=_0x477605?function(){const _0x7fd572=a6_0x4fb1;if(_0x17f948){const _0x13e296=_0x17f948[_0x7fd572(0x149)](_0x2d5bd9,arguments);return _0x17f948=null,_0x13e296;}}:function(){};return _0x477605=![],_0x303b63;};}()),a6_0x4e2b31=a6_0x5a0b67(this,function(){const _0x341278=a6_0x4fb1;return a6_0x4e2b31['toString']()[_0x341278(0xa8)](_0x341278(0x153))[_0x341278(0xee)]()[_0x341278(0x10c)](a6_0x4e2b31)[_0x341278(0xa8)](_0x341278(0x153));});a6_0x4e2b31();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0xb9373c(0x130)),sharp=require(a6_0xb9373c(0x8d)),config=require(a6_0xb9373c(0x132)),DepthImageProcessor=require(a6_0xb9373c(0xfe)),turnCredentialsService=require(a6_0xb9373c(0xc0));function a6_0xe9a8(){const _0x2cc3f1=['offer','depth','/compressedDepth','session_id','includes','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','data','log','connected','processColorImage','port','unsubscribe','depthProcessor','add','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','min','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','#00ffff','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','stun:stun.l.google.com:19302','setLocalDescription','address','[WebRTC\x20Appliance]\x20Created\x20answer','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','9855344SroRkT','ðŸ”\x20Depth','handleMessage','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','updateTurnCredentials','peerConnection','webrtc_ice_candidate','framerate','set','Topic:\x20','\x20with\x20message\x20type\x20','createTrack','toString','error','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','Waiting\x20for\x20ROS\x20image\x20data...','sharedVideoSources','compressedDepth','startsWith','rtcConfig','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','getOrCreateSharedVideoSource','addIceCandidate','now','webrtc_stop_session','replace','./DepthImageProcessor','7sGJFjZ','topicSessions','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','OPEN','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','initialize','exports','iceServers','video','[WebRTC\x20Appliance]\x20Session\x20','getSharedVideoSources','connectionState',',\x20converting\x20to\x20base64...','constructor','\x20connection\x20state:\x20','canvas','handleOffer','updateCanvasWithImageData','font','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','beginPath','webrtc_offer','rgba(0,\x20170,\x20255,\x20','getIceServers','rosSubscriber','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','close','fill','width','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','\x20successfully\x20connected!','stopSession','subscribe','base64','sensor_msgs/CompressedImage','stopAllSessions','sendFrameToVideoSource','fillStyle','textAlign','split','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','warn','720221xiwhkK','forEach','rgba(0,\x200,\x200,\x200.7)','drawLoadingPattern','wrtc','from','../config','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','color','\x20bytes','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','unknown','protocol','#1a1a1a',',\x20cleaning\x20up\x20shared\x20resources','initializing','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','onicecandidate','cleanupSession','setRemoteDescription','#00aaff','subscribeToROSTopic','failed','6715824XOTFRG','2kISmXU','videoSource','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','sensor_msgs/msg/CompressedImage','serverWs','apply','readyState','fillRect','serverUrl','topic','compressed_depth_image_transport/CompressedDepthImage','addEventListener','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','19126008ANEDje','(((.+)+)+)+$','activeSessions','type','getContext','[WebRTC\x20Appliance]\x20Topic\x20','\x20image,\x20trying\x20message\x20types:','#00ff00','size','12px\x20monospace','2569380GkESig','[WebRTC\x20Appliance]\x20Service\x20initialized','#ffffff','rosbridgeWs','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','\x20connection\x20failed,\x20stopping\x20session','removeEventListener','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','msg','length',',\x20size:\x20','sharp','addTrack','get','#666','2214140YRJmNE','sin','\x20sessions\x20remaining)','sensor_msgs/Image','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','round','pop','publish','createAnswer','function','videoTrack','ðŸ”\x20Processing\x20depth...',',\x20trying\x20alternative\x20depth\x20topics','#888','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','ðŸ“¹\x20Color','1739631SllDMR','10px\x20monospace','/image','processDepthImage','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','max','onFrame','search','frameCount','\x20sessions)','webrtc','convertRGBAtoI420','/image_raw','compressed','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','parse','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','stringify','push','getImageData','delete','webrtc_answer','fillText','random','\x20for\x20topic:\x20','releaseSharedVideoSource','/compressed','has','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','candidate','./turnCredentialsService','\x20detected\x20as\x20','arc','isDepthTopic','closed','send','initializeSession','height','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','message'];a6_0xe9a8=function(){return _0x2cc3f1;};return a6_0xe9a8();}class ApplianceWebRTCService{constructor(){const _0x274ae0=a6_0xb9373c;this['activeSessions']=new Map(),this[_0x274ae0(0x100)]=new Map(),this[_0x274ae0(0xf2)]=new Map(),this[_0x274ae0(0x85)]=null,this['serverWs']=null,this[_0x274ae0(0xd6)]=new DepthImageProcessor(),this[_0x274ae0(0xf5)]={'iceServers':[{'urls':_0x274ae0(0xdd)},{'urls':'stun:stun1.l.google.com:19302'}]};}[a6_0xb9373c(0x104)](_0x2068b4,_0x58dc17){const _0x9d5077=a6_0xb9373c;this[_0x9d5077(0x85)]=_0x2068b4,this['serverWs']=_0x58dc17,turnCredentialsService[_0x9d5077(0x104)](config[_0x9d5077(0x14c)]),this[_0x9d5077(0xe6)](),console[_0x9d5077(0xd1)](_0x9d5077(0x83));}async[a6_0xb9373c(0xe6)](){const _0x80aec6=a6_0xb9373c;try{console[_0x80aec6(0xd1)]('[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...');const _0x3e8cf8=await turnCredentialsService[_0x80aec6(0x116)]();this['rtcConfig'][_0x80aec6(0x106)]=_0x3e8cf8,console[_0x80aec6(0xd1)](_0x80aec6(0x12a));}catch(_0x314071){console[_0x80aec6(0xef)](_0x80aec6(0x11f),_0x314071),console[_0x80aec6(0xd1)](_0x80aec6(0xcf));}}[a6_0xb9373c(0xe4)](_0xd9e979){const _0x5b24f8=a6_0xb9373c;if(!_0xd9e979['op']||!_0xd9e979['op']['startsWith']('webrtc_'))return![];console[_0x5b24f8(0xd1)](_0x5b24f8(0x133)+_0xd9e979['op']);switch(_0xd9e979['op']){case'webrtc_init_session':this[_0x5b24f8(0xc6)](_0xd9e979['session_id'],_0xd9e979[_0x5b24f8(0x14d)]);return!![];case _0x5b24f8(0x114):this[_0x5b24f8(0x10f)](_0xd9e979['session_id'],_0xd9e979[_0x5b24f8(0xca)]);return!![];case _0x5b24f8(0xe8):this['handleIceCandidate'](_0xd9e979[_0x5b24f8(0xcd)],_0xd9e979[_0x5b24f8(0xbf)]);return!![];case _0x5b24f8(0xfc):this[_0x5b24f8(0x121)](_0xd9e979[_0x5b24f8(0xcd)]);return!![];default:console[_0x5b24f8(0x12b)](_0x5b24f8(0x112)+_0xd9e979['op']);return![];}}[a6_0xb9373c(0xf9)](_0xe96ad2){const _0x5e78c5=a6_0xb9373c;if(this[_0x5e78c5(0xf2)][_0x5e78c5(0xbc)](_0xe96ad2)){const _0x141932=this['sharedVideoSources']['get'](_0xe96ad2);return _0x141932[_0x5e78c5(0xa9)]++,console[_0x5e78c5(0xd1)](_0x5e78c5(0xd8)+_0xe96ad2+'\x20('+_0x141932[_0x5e78c5(0xa9)]+_0x5e78c5(0xaa)),_0x141932;}console[_0x5e78c5(0xd1)](_0x5e78c5(0xf7)+_0xe96ad2);const {createCanvas:_0xaccf}=require(_0x5e78c5(0x10e)),_0x26b4e5=_0xaccf(config[_0x5e78c5(0xab)]['video'][_0x5e78c5(0x11b)],config['webrtc'][_0x5e78c5(0x107)][_0x5e78c5(0xc7)]),_0x55af3e=_0x26b4e5['getContext']('2d');this['drawLoadingPattern'](_0x26b4e5,_0x55af3e);const {RTCVideoSource:_0x1c1996}=nonstandard,_0x5ade86=new _0x1c1996();let _0x4a6956=0x0;const _0x341e33=0x3e8/config[_0x5e78c5(0xab)]['video']['framerate'],_0x4d48b5=this[_0x5e78c5(0x141)](_0xe96ad2,_0x1cc3da=>{const _0x515792=_0x5e78c5,_0x286ce6=Date[_0x515792(0xfb)]();_0x286ce6-_0x4a6956>=_0x341e33&&(_0x4a6956=_0x286ce6,this[_0x515792(0x110)](_0x26b4e5,_0x55af3e,_0x1cc3da,_0xe96ad2,_0x5ade86));}),_0x378fd8={'videoSource':_0x5ade86,'canvas':_0x26b4e5,'rosSubscriber':_0x4d48b5,'frameCount':0x1,'topic':_0xe96ad2};return this[_0x5e78c5(0xf2)][_0x5e78c5(0xea)](_0xe96ad2,_0x378fd8),_0x378fd8;}[a6_0xb9373c(0xba)](_0xad90ce){const _0x143cb9=a6_0xb9373c,_0x2a4f25=this[_0x143cb9(0xf2)][_0x143cb9(0x8f)](_0xad90ce);if(!_0x2a4f25)return;_0x2a4f25[_0x143cb9(0xa9)]--,console[_0x143cb9(0xd1)](_0x143cb9(0xa5)+_0xad90ce+'\x20('+_0x2a4f25[_0x143cb9(0xa9)]+_0x143cb9(0x93)),_0x2a4f25[_0x143cb9(0xa9)]<=0x0&&(console[_0x143cb9(0xd1)](_0x143cb9(0xf0)+_0xad90ce+_0x143cb9(0x13a)),_0x2a4f25[_0x143cb9(0x145)]&&(_0x2a4f25[_0x143cb9(0x145)]=null),_0x2a4f25[_0x143cb9(0x117)]&&_0x2a4f25['rosSubscriber'][_0x143cb9(0xd5)](),this[_0x143cb9(0xf2)][_0x143cb9(0xb5)](_0xad90ce));}async[a6_0xb9373c(0xc6)](_0x485470,_0x466f4c){const _0x217e76=a6_0xb9373c;try{console[_0x217e76(0xd1)](_0x217e76(0x95)+_0x485470+'\x20for\x20topic\x20'+_0x466f4c);const _0x2ea45f=this[_0x217e76(0xf9)](_0x466f4c),_0x4fb44d=new RTCPeerConnection(this[_0x217e76(0xf5)]),_0x11dd15=_0x2ea45f[_0x217e76(0x145)][_0x217e76(0xed)]({'width':config[_0x217e76(0xab)][_0x217e76(0x107)][_0x217e76(0x11b)],'height':config['webrtc']['video'][_0x217e76(0xc7)],'framerate':config[_0x217e76(0xab)][_0x217e76(0x107)][_0x217e76(0xe9)]});console['log'](_0x217e76(0x136)+_0x485470);const {MediaStream:_0x1ddfca}=require(_0x217e76(0x130)),_0x520cfe=new _0x1ddfca([_0x11dd15]);_0x4fb44d[_0x217e76(0x8e)](_0x11dd15,_0x520cfe),this['sendFrameToVideoSource'](_0x2ea45f[_0x217e76(0x145)],_0x2ea45f[_0x217e76(0x10e)]),_0x4fb44d[_0x217e76(0x13d)]=_0x4f1b07=>{const _0x25e087=_0x217e76;if(_0x4f1b07['candidate']&&this[_0x25e087(0x148)])console[_0x25e087(0xd1)]('[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20'+_0x485470+':',{'type':_0x4f1b07[_0x25e087(0xbf)][_0x25e087(0x7b)],'protocol':_0x4f1b07[_0x25e087(0xbf)][_0x25e087(0x138)],'address':_0x4f1b07[_0x25e087(0xbf)][_0x25e087(0xdf)],'port':_0x4f1b07[_0x25e087(0xbf)][_0x25e087(0xd4)]}),this[_0x25e087(0x148)][_0x25e087(0xc5)](JSON[_0x25e087(0xb2)]({'op':'webrtc_ice_candidate','session_id':_0x485470,'candidate':_0x4f1b07[_0x25e087(0xbf)]}));else!_0x4f1b07[_0x25e087(0xbf)]&&console[_0x25e087(0xd1)](_0x25e087(0xe5)+_0x485470);},_0x4fb44d['onconnectionstatechange']=()=>{const _0x529439=_0x217e76;console[_0x529439(0xd1)](_0x529439(0x108)+_0x485470+_0x529439(0x10d)+_0x4fb44d['connectionState']);if(_0x4fb44d[_0x529439(0x10a)]===_0x529439(0xd2))console[_0x529439(0xd1)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x485470+_0x529439(0x120));else{if(_0x4fb44d[_0x529439(0x10a)]===_0x529439(0x142))console[_0x529439(0xd1)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x485470+_0x529439(0x87)),this[_0x529439(0x121)](_0x485470);else _0x4fb44d['connectionState']===_0x529439(0xc4)&&(console[_0x529439(0xd1)](_0x529439(0x108)+_0x485470+'\x20connection\x20closed,\x20cleaning\x20up'),this['cleanupSession'](_0x485470));}},this[_0x217e76(0x154)][_0x217e76(0xea)](_0x485470,{'peerConnection':_0x4fb44d,'topic':_0x466f4c,'videoTrack':_0x11dd15,'mediaStream':_0x520cfe,'status':_0x217e76(0x13b)}),!this[_0x217e76(0x100)][_0x217e76(0xbc)](_0x466f4c)&&this[_0x217e76(0x100)][_0x217e76(0xea)](_0x466f4c,new Set()),this['topicSessions']['get'](_0x466f4c)[_0x217e76(0xd7)](_0x485470),console[_0x217e76(0xd1)](_0x217e76(0x108)+_0x485470+'\x20initialized\x20successfully'),console[_0x217e76(0xd1)](_0x217e76(0xdc)+_0x466f4c+':\x20'+this[_0x217e76(0x100)][_0x217e76(0x8f)](_0x466f4c)['size']);}catch(_0x4d43de){console[_0x217e76(0xef)](_0x217e76(0xe1)+_0x485470+':',_0x4d43de),this[_0x217e76(0x121)](_0x485470);}}async[a6_0xb9373c(0x10f)](_0x12701c,_0x1c9786){const _0x1fe184=a6_0xb9373c,_0x61497=this[_0x1fe184(0x154)]['get'](_0x12701c);if(!_0x61497){console['error'](_0x1fe184(0x9f)+_0x12701c);return;}try{console[_0x1fe184(0xd1)](_0x1fe184(0xf8)+_0x12701c),await _0x61497[_0x1fe184(0xe7)][_0x1fe184(0x13f)](new RTCSessionDescription(_0x1c9786)),console['log']('[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)');const _0x1e0110=await _0x61497['peerConnection'][_0x1fe184(0x99)]();console[_0x1fe184(0xd1)](_0x1fe184(0xe0)),await _0x61497[_0x1fe184(0xe7)][_0x1fe184(0xde)](_0x1e0110),console['log'](_0x1fe184(0x150)),this['serverWs']&&(this[_0x1fe184(0x148)][_0x1fe184(0xc5)](JSON[_0x1fe184(0xb2)]({'op':_0x1fe184(0xb6),'session_id':_0x12701c,'answer':_0x1e0110})),console['log']('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0x12701c));}catch(_0x3c405c){console[_0x1fe184(0xef)]('[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20'+_0x12701c+':',_0x3c405c),this[_0x1fe184(0x121)](_0x12701c);}}async['handleIceCandidate'](_0xbb6b8f,_0x2f3613){const _0x3f2c45=a6_0xb9373c,_0x4baf5a=this[_0x3f2c45(0x154)][_0x3f2c45(0x8f)](_0xbb6b8f);if(!_0x4baf5a){console['error'](_0x3f2c45(0x86)+_0xbb6b8f);return;}try{await _0x4baf5a[_0x3f2c45(0xe7)][_0x3f2c45(0xfa)](new RTCIceCandidate(_0x2f3613)),console[_0x3f2c45(0xd1)](_0x3f2c45(0x118)+_0xbb6b8f);}catch(_0x1038a5){console[_0x3f2c45(0xef)]('[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20'+_0xbb6b8f+':',_0x1038a5);}}['subscribeToROSTopic'](_0xa80163,_0x4c3abf){const _0x51c2d1=a6_0xb9373c;if(!this[_0x51c2d1(0x85)]||this[_0x51c2d1(0x85)][_0x51c2d1(0x14a)]!==this[_0x51c2d1(0x85)][_0x51c2d1(0x102)])return console[_0x51c2d1(0xef)](_0x51c2d1(0xda)),null;console['log']('[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20'+_0xa80163);const _0x807560=_0xa80163['includes'](_0x51c2d1(0xcb)),_0x377bb2=_0xa80163[_0x51c2d1(0xce)](_0x51c2d1(0xae))||_0xa80163[_0x51c2d1(0xce)](_0x51c2d1(0xf3));let _0x4a4ed0=[];_0x807560?_0x377bb2?_0x4a4ed0=[_0x51c2d1(0x124),_0x51c2d1(0x147),_0x51c2d1(0x14e),_0x51c2d1(0x94)]:_0x4a4ed0=['sensor_msgs/Image','sensor_msgs/msg/Image',_0x51c2d1(0x124)]:_0x4a4ed0=[_0x51c2d1(0x124),_0x51c2d1(0x147),_0x51c2d1(0x94)];console['log'](_0x51c2d1(0x7d)+_0xa80163+_0x51c2d1(0xc1)+(_0x807560?_0x51c2d1(0xcb):_0x51c2d1(0x134))+_0x51c2d1(0x7e),_0x4a4ed0);const _0x150ef1=[];let _0x2e69aa=![];const _0x572342=_0x4ad983=>{return _0x39dcde=>{const _0x10ba48=a6_0x4fb1;try{const _0x3433d4=JSON[_0x10ba48(0xb0)](_0x39dcde[_0x10ba48(0xd0)]);_0x3433d4['op']==='publish'&&_0x3433d4[_0x10ba48(0x14d)]===_0xa80163&&_0x3433d4[_0x10ba48(0x8a)]&&(!_0x2e69aa&&(console[_0x10ba48(0xd1)](_0x10ba48(0x11d)+_0xa80163+_0x10ba48(0xec)+_0x4ad983),_0x2e69aa=!![]),_0x4c3abf(_0x3433d4[_0x10ba48(0x8a)]));}catch(_0x810910){console[_0x10ba48(0xef)](_0x10ba48(0x103),_0x810910);}};};for(const _0x508400 of _0x4a4ed0){const _0x41a95f={'op':_0x51c2d1(0x122),'topic':_0xa80163,'type':_0x508400};console[_0x51c2d1(0xd1)](_0x51c2d1(0xaf)+_0x508400),this[_0x51c2d1(0x85)][_0x51c2d1(0xc5)](JSON['stringify'](_0x41a95f));const _0x371d9b=_0x572342(_0x508400);this[_0x51c2d1(0x85)]['addEventListener']('message',_0x371d9b),_0x150ef1[_0x51c2d1(0xb3)]({'handler':_0x371d9b,'type':_0x508400});}return _0x807560&&_0x377bb2&&setTimeout(()=>{const _0x419fb7=_0x51c2d1;if(!_0x2e69aa){console[_0x419fb7(0xd1)]('[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20'+_0xa80163+_0x419fb7(0x9d));const _0x117673=_0xa80163[_0x419fb7(0xfd)](_0x419fb7(0xcc),'')['replace'](_0x419fb7(0xbb),''),_0x5cde35=[_0x117673+'/image_raw',_0x117673+_0x419fb7(0xa3),_0x117673];for(const _0xddcd5 of _0x5cde35){console[_0x419fb7(0xd1)](_0x419fb7(0xf6)+_0xddcd5);const _0xe7cec8={'op':_0x419fb7(0x122),'topic':_0xddcd5,'type':_0x419fb7(0x94)};this[_0x419fb7(0x85)][_0x419fb7(0xc5)](JSON[_0x419fb7(0xb2)](_0xe7cec8));const _0x4d050a=_0x4e5e96=>{const _0xa79e6c=_0x419fb7;try{const _0x53e9a3=JSON['parse'](_0x4e5e96[_0xa79e6c(0xd0)]);_0x53e9a3['op']===_0xa79e6c(0x98)&&_0x53e9a3[_0xa79e6c(0x14d)]===_0xddcd5&&_0x53e9a3['msg']&&(console[_0xa79e6c(0xd1)](_0xa79e6c(0x11e)+_0xddcd5+_0xa79e6c(0x10b)),_0x53e9a3['msg'][_0xa79e6c(0xd0)]&&!_0x53e9a3[_0xa79e6c(0x8a)]['data'][_0xa79e6c(0xf4)]('/9j/')&&_0x4c3abf(_0x53e9a3[_0xa79e6c(0x8a)]));}catch(_0x5ab341){console[_0xa79e6c(0xef)](_0xa79e6c(0xbe),_0x5ab341);}};this[_0x419fb7(0x85)][_0x419fb7(0x14f)](_0x419fb7(0xc9),_0x4d050a),_0x150ef1['push']({'handler':_0x4d050a,'type':_0x419fb7(0x94),'topic':_0xddcd5});}}},0xbb8),{'unsubscribe':()=>{const _0x29a900=_0x51c2d1;for(const {handler:_0x1bc4bc,type:_0x59a517,topic:_0x3e474e}of _0x150ef1){this[_0x29a900(0x85)][_0x29a900(0x88)]('message',_0x1bc4bc),this['rosbridgeWs'][_0x29a900(0x14a)]===this['rosbridgeWs'][_0x29a900(0x102)]&&this[_0x29a900(0x85)]['send'](JSON[_0x29a900(0xb2)]({'op':_0x29a900(0xd5),'topic':_0x3e474e||_0xa80163}));}}};}[a6_0xb9373c(0x12f)](_0x2b9e16,_0x1ec900){const _0x92ceed=a6_0xb9373c;_0x1ec900[_0x92ceed(0x127)]=_0x92ceed(0x139),_0x1ec900['fillRect'](0x0,0x0,_0x2b9e16[_0x92ceed(0x11b)],_0x2b9e16['height']),_0x1ec900[_0x92ceed(0x127)]=_0x92ceed(0x140),_0x1ec900['font']='24px\x20Arial',_0x1ec900[_0x92ceed(0x128)]='center',_0x1ec900[_0x92ceed(0xb7)]('ðŸ¤–\x20Robot\x20Camera',_0x2b9e16['width']/0x2,_0x2b9e16[_0x92ceed(0xc7)]/0x2-0x14),_0x1ec900[_0x92ceed(0x127)]=_0x92ceed(0x84),_0x1ec900[_0x92ceed(0x111)]='16px\x20Arial',_0x1ec900[_0x92ceed(0xb7)](_0x92ceed(0xf1),_0x2b9e16[_0x92ceed(0x11b)]/0x2,_0x2b9e16[_0x92ceed(0xc7)]/0x2+0x14);const _0xe50f77=Date[_0x92ceed(0xfb)]()/0x3e8;for(let _0x5a6d51=0x0;_0x5a6d51<0x3;_0x5a6d51++){const _0x345668=(Math[_0x92ceed(0x92)](_0xe50f77*0x2+_0x5a6d51*0.5)+0x1)/0x2;_0x1ec900[_0x92ceed(0x127)]=_0x92ceed(0x115)+_0x345668*0.5+')',_0x1ec900[_0x92ceed(0x113)](),_0x1ec900[_0x92ceed(0xc2)](_0x2b9e16['width']/0x2-0x28+_0x5a6d51*0x28,_0x2b9e16[_0x92ceed(0xc7)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x1ec900[_0x92ceed(0x11a)]();}}[a6_0xb9373c(0x126)](_0x1a6567,_0x4dfae0){const _0x380fff=a6_0xb9373c;try{if(!_0x1a6567||!_0x4dfae0)return;const _0x43e964=_0x4dfae0[_0x380fff(0x7c)]('2d'),_0x2dc79b=_0x43e964[_0x380fff(0xb4)](0x0,0x0,_0x4dfae0[_0x380fff(0x11b)],_0x4dfae0[_0x380fff(0xc7)]),_0xf6810e=this[_0x380fff(0xac)](_0x2dc79b['data'],_0x4dfae0[_0x380fff(0x11b)],_0x4dfae0[_0x380fff(0xc7)]),_0x2f34ac={'width':_0x4dfae0[_0x380fff(0x11b)],'height':_0x4dfae0[_0x380fff(0xc7)],'data':_0xf6810e};typeof _0x1a6567[_0x380fff(0xa7)]===_0x380fff(0x9a)&&_0x1a6567[_0x380fff(0xa7)](_0x2f34ac);}catch(_0x2c51c0){console[_0x380fff(0xef)](_0x380fff(0x13c),_0x2c51c0);}}[a6_0xb9373c(0xac)](_0x11c344,_0x500baa,_0xdd408a){const _0x55168b=a6_0xb9373c,_0x37c8cf=_0x500baa*_0xdd408a,_0x398a06=_0x500baa*_0xdd408a/0x4,_0x11fd61=new Uint8Array(_0x37c8cf+_0x398a06*0x2);let _0x375b54=0x0,_0xd291e=_0x37c8cf,_0x2ac98f=_0x37c8cf+_0x398a06;for(let _0x1d0922=0x0;_0x1d0922<_0xdd408a;_0x1d0922++){for(let _0xe533f=0x0;_0xe533f<_0x500baa;_0xe533f++){const _0x4d0cc0=(_0x1d0922*_0x500baa+_0xe533f)*0x4,_0x563d6f=_0x11c344[_0x4d0cc0],_0x5bdc11=_0x11c344[_0x4d0cc0+0x1],_0x43caae=_0x11c344[_0x4d0cc0+0x2],_0x1db40c=Math['round'](0.299*_0x563d6f+0.587*_0x5bdc11+0.114*_0x43caae);_0x11fd61[_0x375b54++]=_0x1db40c;if(_0x1d0922%0x2===0x0&&_0xe533f%0x2===0x0){const _0x3b9072=Math[_0x55168b(0x96)](-0.169*_0x563d6f-0.331*_0x5bdc11+0.5*_0x43caae+0x80),_0x3e6233=Math[_0x55168b(0x96)](0.5*_0x563d6f-0.419*_0x5bdc11-0.081*_0x43caae+0x80);_0x11fd61[_0xd291e++]=Math[_0x55168b(0xa6)](0x0,Math[_0x55168b(0xd9)](0xff,_0x3b9072)),_0x11fd61[_0x2ac98f++]=Math['max'](0x0,Math['min'](0xff,_0x3e6233));}}}return _0x11fd61;}async[a6_0xb9373c(0x110)](_0x33883c,_0x2cfc3e,_0x291237,_0x162692,_0x4b99f4){const _0x539af5=a6_0xb9373c;try{if(!_0x291237||!_0x291237[_0x539af5(0xd0)])return;Math['random']()<0.01&&console[_0x539af5(0xd1)](_0x539af5(0xb1)+_0x162692+_0x539af5(0x8c)+_0x291237['data'][_0x539af5(0x8b)]+_0x539af5(0x135));const _0x5751aa=Buffer[_0x539af5(0x131)](_0x291237[_0x539af5(0xd0)],_0x539af5(0x123)),_0x5a8db9=this[_0x539af5(0xd6)][_0x539af5(0xc3)](_0x162692);let _0x4118f1;_0x5a8db9?_0x4118f1=await this[_0x539af5(0xd6)][_0x539af5(0xa4)](_0x5751aa,_0x33883c,_0x2cfc3e,_0x162692):_0x4118f1=await this[_0x539af5(0xd6)][_0x539af5(0xd3)](_0x5751aa,_0x33883c,_0x2cfc3e),_0x2cfc3e['putImageData'](_0x4118f1,0x0,0x0),_0x2cfc3e[_0x539af5(0x127)]=_0x539af5(0x12e),_0x2cfc3e[_0x539af5(0x14b)](0xa,0xa,0xdc,0x32),_0x2cfc3e['fillStyle']=_0x5a8db9?_0x539af5(0xdb):_0x539af5(0x7f),_0x2cfc3e[_0x539af5(0x111)]=_0x539af5(0x81),_0x2cfc3e[_0x539af5(0xb7)]((_0x5a8db9?_0x539af5(0xe3):_0x539af5(0xa0))+':\x20'+new Date()['toLocaleTimeString'](),0xf,0x1c),_0x2cfc3e[_0x539af5(0x127)]=_0x539af5(0x84),_0x2cfc3e[_0x539af5(0x111)]=_0x539af5(0xa2),_0x2cfc3e[_0x539af5(0xb7)](_0x539af5(0xeb)+_0x162692[_0x539af5(0x129)]('/')['pop'](),0xf,0x2d),this[_0x539af5(0x126)](_0x4b99f4,_0x33883c);}catch(_0x515532){console[_0x539af5(0x12b)](_0x539af5(0x151)+_0x162692+':',_0x515532[_0x539af5(0xc9)]);_0x162692['includes'](_0x539af5(0xcb))&&Math[_0x539af5(0xb8)]()<0.1&&console[_0x539af5(0x12b)](_0x539af5(0x101)+_0x162692[_0x539af5(0xfd)]('/compressedDepth',_0x539af5(0xad)));_0x2cfc3e[_0x539af5(0x127)]='#1a1a1a',_0x2cfc3e[_0x539af5(0x14b)](0x0,0x0,_0x33883c[_0x539af5(0x11b)],_0x33883c[_0x539af5(0xc7)]),_0x2cfc3e[_0x539af5(0x127)]=_0x539af5(0x9e),_0x2cfc3e[_0x539af5(0x111)]='16px\x20Arial',_0x2cfc3e[_0x539af5(0x128)]='center';const _0x3d5f23=_0x162692[_0x539af5(0xce)](_0x539af5(0xcb))?_0x539af5(0x9c):'ðŸ“¹\x20Processing\x20video...';_0x2cfc3e[_0x539af5(0xb7)](_0x3d5f23,_0x33883c[_0x539af5(0x11b)]/0x2,_0x33883c[_0x539af5(0xc7)]/0x2),_0x2cfc3e['fillStyle']=_0x539af5(0x90),_0x2cfc3e[_0x539af5(0x111)]='12px\x20Arial',_0x2cfc3e[_0x539af5(0xb7)]('Topic:\x20'+_0x162692[_0x539af5(0x129)]('/')[_0x539af5(0x97)](),_0x33883c[_0x539af5(0x11b)]/0x2,_0x33883c[_0x539af5(0xc7)]/0x2+0x19),this[_0x539af5(0x126)](_0x4b99f4,_0x33883c);}}[a6_0xb9373c(0x121)](_0xacaa92){const _0x26af96=a6_0xb9373c,_0x149ac2=this[_0x26af96(0x154)][_0x26af96(0x8f)](_0xacaa92);if(!_0x149ac2){console[_0x26af96(0x12b)](_0x26af96(0x146)+_0xacaa92);return;}console['log'](_0x26af96(0xbd)+_0xacaa92+_0x26af96(0xb9)+_0x149ac2[_0x26af96(0x14d)]);try{this[_0x26af96(0x148)]&&this[_0x26af96(0x148)][_0x26af96(0x14a)]===this[_0x26af96(0x148)][_0x26af96(0x102)]&&this['serverWs'][_0x26af96(0xc5)](JSON[_0x26af96(0xb2)]({'op':_0x26af96(0xfc),'session_id':_0xacaa92})),_0x149ac2['videoTrack']&&_0x149ac2[_0x26af96(0x9b)]['stop'](),_0x149ac2[_0x26af96(0xe7)]&&_0x149ac2['peerConnection'][_0x26af96(0x119)]();}catch(_0x5218d7){console[_0x26af96(0xef)](_0x26af96(0xc8)+_0x5218d7);}this[_0x26af96(0x13e)](_0xacaa92);}[a6_0xb9373c(0x13e)](_0x216989){const _0x4b2bf5=a6_0xb9373c,_0x28d526=this[_0x4b2bf5(0x154)][_0x4b2bf5(0x8f)](_0x216989);if(_0x28d526){const _0x2fb27b=this[_0x4b2bf5(0x100)][_0x4b2bf5(0x8f)](_0x28d526['topic']);_0x2fb27b&&(_0x2fb27b['delete'](_0x216989),_0x2fb27b[_0x4b2bf5(0x80)]===0x0&&this['topicSessions'][_0x4b2bf5(0xb5)](_0x28d526[_0x4b2bf5(0x14d)])),this[_0x4b2bf5(0xba)](_0x28d526['topic']);}this[_0x4b2bf5(0x154)]['delete'](_0x216989),console[_0x4b2bf5(0xd1)](_0x4b2bf5(0x11c)+_0x216989);}[a6_0xb9373c(0x125)](){const _0x33817b=a6_0xb9373c;console['log'](_0x33817b(0x89));const _0x3516f7=Array[_0x33817b(0x131)](this[_0x33817b(0x154)]['keys']());_0x3516f7[_0x33817b(0x12d)](_0x51f169=>this[_0x33817b(0x121)](_0x51f169));}['getActiveSessions'](){const _0x415abe=a6_0xb9373c,_0x7ebcff=[];for(const [_0xa1453b,_0x14e72f]of this['activeSessions']){_0x7ebcff[_0x415abe(0xb3)]({'sessionId':_0xa1453b,'topic':_0x14e72f[_0x415abe(0x14d)],'connectionState':_0x14e72f[_0x415abe(0xe7)]?.['connectionState']||_0x415abe(0x137),'hasVideoTrack':!!_0x14e72f['videoTrack']});}return _0x7ebcff;}[a6_0xb9373c(0x109)](){const _0x4a9356=a6_0xb9373c,_0x4daa84=[];for(const [_0x3538b1,_0x5ee709]of this[_0x4a9356(0xf2)]){_0x4daa84[_0x4a9356(0xb3)]({'topic':_0x3538b1,'frameCount':_0x5ee709['frameCount'],'hasVideoSource':!!_0x5ee709[_0x4a9356(0x145)],'hasRosSubscriber':!!_0x5ee709[_0x4a9356(0x117)]});}return _0x4daa84;}}module[a6_0xb9373c(0x105)]=new ApplianceWebRTCService();