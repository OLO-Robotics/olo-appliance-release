const a9_0x458ada=a9_0x160b;(function(_0x3aad79,_0x2d7f38){const _0xf5dfb6=a9_0x160b,_0x4d18cb=_0x3aad79();while(!![]){try{const _0x56b469=parseInt(_0xf5dfb6(0xca))/0x1*(-parseInt(_0xf5dfb6(0xb5))/0x2)+-parseInt(_0xf5dfb6(0x12a))/0x3*(-parseInt(_0xf5dfb6(0x14c))/0x4)+-parseInt(_0xf5dfb6(0xba))/0x5*(parseInt(_0xf5dfb6(0xfb))/0x6)+parseInt(_0xf5dfb6(0x117))/0x7*(-parseInt(_0xf5dfb6(0x11e))/0x8)+-parseInt(_0xf5dfb6(0xce))/0x9+parseInt(_0xf5dfb6(0x13e))/0xa*(-parseInt(_0xf5dfb6(0xee))/0xb)+parseInt(_0xf5dfb6(0x122))/0xc*(parseInt(_0xf5dfb6(0xbf))/0xd);if(_0x56b469===_0x2d7f38)break;else _0x4d18cb['push'](_0x4d18cb['shift']());}catch(_0x11a4eb){_0x4d18cb['push'](_0x4d18cb['shift']());}}}(a9_0x14f6,0x63745));const a9_0x190b7f=(function(){let _0xffb246=!![];return function(_0x3153fd,_0x3652f3){const _0xee20fa=_0xffb246?function(){const _0x19ca39=a9_0x160b;if(_0x3652f3){const _0x41d7c4=_0x3652f3[_0x19ca39(0xda)](_0x3153fd,arguments);return _0x3652f3=null,_0x41d7c4;}}:function(){};return _0xffb246=![],_0xee20fa;};}()),a9_0xfe2001=a9_0x190b7f(this,function(){const _0x3596a7=a9_0x160b;return a9_0xfe2001[_0x3596a7(0xd6)]()[_0x3596a7(0xcd)](_0x3596a7(0xef))[_0x3596a7(0xd6)]()[_0x3596a7(0x131)](a9_0xfe2001)[_0x3596a7(0xcd)](_0x3596a7(0xef));});a9_0xfe2001();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a9_0x458ada(0x11d)),sharp=require(a9_0x458ada(0xf0)),config=require('../config'),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require(a9_0x458ada(0xed));class ApplianceWebRTCService{constructor(){const _0x415194=a9_0x458ada;this[_0x415194(0x179)]=new Map(),this[_0x415194(0x120)]=new Map(),this['sharedVideoSources']=new Map(),this[_0x415194(0xe2)]=null,this[_0x415194(0xc4)]=null,this[_0x415194(0x17f)]=new DepthImageProcessor(),this[_0x415194(0x17e)]={'iceServers':[{'urls':_0x415194(0x11a)},{'urls':_0x415194(0x172)}]};}[a9_0x458ada(0xf4)](_0x208e64,_0x58a2dc){const _0x1148b8=a9_0x458ada;this[_0x1148b8(0xe2)]=_0x208e64,this[_0x1148b8(0xc4)]=_0x58a2dc,turnCredentialsService[_0x1148b8(0xf4)](config[_0x1148b8(0x12e)]),this[_0x1148b8(0x185)](),console[_0x1148b8(0xb3)](_0x1148b8(0xcf));}async['updateTurnCredentials'](){const _0x1607fa=a9_0x458ada;try{console[_0x1607fa(0xb3)]('[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...');const _0x2f45b1=await turnCredentialsService[_0x1607fa(0xde)]();this[_0x1607fa(0x17e)][_0x1607fa(0xbe)]=_0x2f45b1,console[_0x1607fa(0xb3)](_0x1607fa(0x152));}catch(_0xeebfda){console[_0x1607fa(0x123)]('[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:',_0xeebfda),console[_0x1607fa(0xb3)](_0x1607fa(0x13d));}}[a9_0x458ada(0x129)](_0xe6219d){const _0x2a8709=a9_0x458ada;if(!_0xe6219d['op']||!_0xe6219d['op']['startsWith'](_0x2a8709(0x15f)))return![];console[_0x2a8709(0xb3)]('[WebRTC\x20Appliance]\x20Handling\x20message:\x20'+_0xe6219d['op']);switch(_0xe6219d['op']){case _0x2a8709(0xf7):this[_0x2a8709(0xb4)](_0xe6219d['session_id'],_0xe6219d['topic']);return!![];case _0x2a8709(0x136):this[_0x2a8709(0x14b)](_0xe6219d['session_id'],_0xe6219d[_0x2a8709(0x130)]);return!![];case _0x2a8709(0x16a):this[_0x2a8709(0xdb)](_0xe6219d['session_id'],_0xe6219d['candidate']);return!![];case _0x2a8709(0x153):this['stopSession'](_0xe6219d[_0x2a8709(0x119)]);return!![];default:console['warn'](_0x2a8709(0x13a)+_0xe6219d['op']);return![];}}[a9_0x458ada(0x14e)](_0x59afdc){const _0x2835be=a9_0x458ada;if(this[_0x2835be(0x169)][_0x2835be(0x160)](_0x59afdc)){const _0x5b6a28=this[_0x2835be(0x169)][_0x2835be(0x184)](_0x59afdc);return _0x5b6a28[_0x2835be(0xb9)]++,console[_0x2835be(0xb3)](_0x2835be(0xc3)+_0x59afdc+'\x20('+_0x5b6a28[_0x2835be(0xb9)]+_0x2835be(0x186)),_0x5b6a28;}console[_0x2835be(0xb3)](_0x2835be(0xe7)+_0x59afdc);const {createCanvas:_0x1d9c1e}=require(_0x2835be(0x165)),_0x54d4b1=_0x1d9c1e(config['webrtc']['video'][_0x2835be(0x140)],config[_0x2835be(0x177)][_0x2835be(0x173)]['height']),_0xd0c9fc=_0x54d4b1['getContext']('2d');this[_0x2835be(0x163)](_0x54d4b1,_0xd0c9fc);const {RTCVideoSource:_0x7dcee1}=nonstandard,_0x5bff25=new _0x7dcee1();let _0x4a938d=0x0;const _0x5b1bda=0x3e8/config[_0x2835be(0x177)][_0x2835be(0x173)][_0x2835be(0xf5)],_0x4e5870=this['subscribeToROSTopic'](_0x59afdc,_0x2616c2=>{const _0x42c348=Date['now']();_0x42c348-_0x4a938d>=_0x5b1bda&&(_0x4a938d=_0x42c348,this['updateCanvasWithImageData'](_0x54d4b1,_0xd0c9fc,_0x2616c2,_0x59afdc,_0x5bff25));}),_0x152d33={'videoSource':_0x5bff25,'canvas':_0x54d4b1,'rosSubscriber':_0x4e5870,'frameCount':0x1,'topic':_0x59afdc};return this[_0x2835be(0x169)][_0x2835be(0x124)](_0x59afdc,_0x152d33),_0x152d33;}[a9_0x458ada(0x128)](_0x125de4){const _0x22ab84=a9_0x458ada,_0x346881=this[_0x22ab84(0x169)][_0x22ab84(0x184)](_0x125de4);if(!_0x346881)return;_0x346881[_0x22ab84(0xb9)]--,console['log'](_0x22ab84(0xc9)+_0x125de4+'\x20('+_0x346881['frameCount']+_0x22ab84(0x13b)),_0x346881[_0x22ab84(0xb9)]<=0x0&&(console[_0x22ab84(0xb3)](_0x22ab84(0x10d)+_0x125de4+_0x22ab84(0xc1)),_0x346881['videoSource']&&(_0x346881[_0x22ab84(0x14a)]=null),_0x346881['rosSubscriber']&&_0x346881[_0x22ab84(0x127)]['unsubscribe'](),this[_0x22ab84(0x169)][_0x22ab84(0x161)](_0x125de4));}async[a9_0x458ada(0xb4)](_0x182e73,_0x5f3af8){const _0x29e01c=a9_0x458ada;try{console[_0x29e01c(0xb3)](_0x29e01c(0x178)+_0x182e73+_0x29e01c(0x162)+_0x5f3af8);const _0x9fc8a0=this[_0x29e01c(0x14e)](_0x5f3af8),_0x1a1b41=new RTCPeerConnection(this[_0x29e01c(0x17e)]),_0x1c4690=_0x9fc8a0[_0x29e01c(0x14a)][_0x29e01c(0x10e)]({'width':config[_0x29e01c(0x177)][_0x29e01c(0x173)][_0x29e01c(0x140)],'height':config[_0x29e01c(0x177)][_0x29e01c(0x173)][_0x29e01c(0xe1)],'framerate':config[_0x29e01c(0x177)][_0x29e01c(0x173)][_0x29e01c(0xf5)]});console[_0x29e01c(0xb3)]('[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20'+_0x182e73);const {MediaStream:_0x2fa9c0}=require(_0x29e01c(0x11d)),_0x3c803e=new _0x2fa9c0([_0x1c4690]);_0x1a1b41[_0x29e01c(0x112)](_0x1c4690,_0x3c803e),this['sendFrameToVideoSource'](_0x9fc8a0['videoSource'],_0x9fc8a0['canvas']),_0x1a1b41[_0x29e01c(0x115)]=_0x5d9204=>{const _0x2b5ac6=_0x29e01c;if(_0x5d9204[_0x2b5ac6(0x100)]&&this[_0x2b5ac6(0xc4)])console[_0x2b5ac6(0xb3)](_0x2b5ac6(0x157)+_0x182e73+':',{'type':_0x5d9204[_0x2b5ac6(0x100)]['type'],'protocol':_0x5d9204[_0x2b5ac6(0x100)][_0x2b5ac6(0x11f)],'address':_0x5d9204[_0x2b5ac6(0x100)]['address'],'port':_0x5d9204['candidate'][_0x2b5ac6(0xfa)]}),this[_0x2b5ac6(0xc4)][_0x2b5ac6(0x142)](JSON[_0x2b5ac6(0x151)]({'op':_0x2b5ac6(0x16a),'session_id':_0x182e73,'candidate':_0x5d9204[_0x2b5ac6(0x100)]}));else!_0x5d9204[_0x2b5ac6(0x100)]&&console[_0x2b5ac6(0xb3)](_0x2b5ac6(0x12b)+_0x182e73);},_0x1a1b41[_0x29e01c(0xf9)]=()=>{const _0x4d64a0=_0x29e01c;console[_0x4d64a0(0xb3)](_0x4d64a0(0x121)+_0x182e73+_0x4d64a0(0x17c)+_0x1a1b41[_0x4d64a0(0x15a)]);if(_0x1a1b41[_0x4d64a0(0x15a)]===_0x4d64a0(0xf2))console[_0x4d64a0(0xb3)](_0x4d64a0(0x121)+_0x182e73+'\x20successfully\x20connected!');else{if(_0x1a1b41[_0x4d64a0(0x15a)]==='failed')console[_0x4d64a0(0xb3)](_0x4d64a0(0x121)+_0x182e73+_0x4d64a0(0x155)),this[_0x4d64a0(0x107)](_0x182e73);else _0x1a1b41[_0x4d64a0(0x15a)]===_0x4d64a0(0x171)&&(console[_0x4d64a0(0xb3)](_0x4d64a0(0x121)+_0x182e73+_0x4d64a0(0x180)),this[_0x4d64a0(0xfd)](_0x182e73));}},this[_0x29e01c(0x179)]['set'](_0x182e73,{'peerConnection':_0x1a1b41,'topic':_0x5f3af8,'videoTrack':_0x1c4690,'mediaStream':_0x3c803e,'status':'initializing'}),!this[_0x29e01c(0x120)][_0x29e01c(0x160)](_0x5f3af8)&&this[_0x29e01c(0x120)][_0x29e01c(0x124)](_0x5f3af8,new Set()),this['topicSessions'][_0x29e01c(0x184)](_0x5f3af8)[_0x29e01c(0xe8)](_0x182e73),console[_0x29e01c(0xb3)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x182e73+_0x29e01c(0x167)),console[_0x29e01c(0xb3)]('[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20'+_0x5f3af8+':\x20'+this['topicSessions'][_0x29e01c(0x184)](_0x5f3af8)[_0x29e01c(0x16e)]);}catch(_0x3238e4){console['error'](_0x29e01c(0x103)+_0x182e73+':',_0x3238e4),this['stopSession'](_0x182e73);}}async[a9_0x458ada(0x14b)](_0xe9cec9,_0x50dd40){const _0x4cfc5f=a9_0x458ada,_0x658287=this[_0x4cfc5f(0x179)][_0x4cfc5f(0x184)](_0xe9cec9);if(!_0x658287){console[_0x4cfc5f(0x123)](_0x4cfc5f(0x11c)+_0xe9cec9);return;}try{console[_0x4cfc5f(0xb3)](_0x4cfc5f(0x135)+_0xe9cec9),await _0x658287[_0x4cfc5f(0x10a)][_0x4cfc5f(0x111)](new RTCSessionDescription(_0x50dd40)),console[_0x4cfc5f(0xb3)](_0x4cfc5f(0x139));const _0x4cf2be=await _0x658287['peerConnection'][_0x4cfc5f(0x125)]();console[_0x4cfc5f(0xb3)]('[WebRTC\x20Appliance]\x20Created\x20answer'),await _0x658287['peerConnection'][_0x4cfc5f(0xfe)](_0x4cf2be),console[_0x4cfc5f(0xb3)](_0x4cfc5f(0x17b)),this['serverWs']&&(this[_0x4cfc5f(0xc4)][_0x4cfc5f(0x142)](JSON[_0x4cfc5f(0x151)]({'op':_0x4cfc5f(0xb2),'session_id':_0xe9cec9,'answer':_0x4cf2be})),console[_0x4cfc5f(0xb3)](_0x4cfc5f(0x15d)+_0xe9cec9));}catch(_0x2b247c){console['error']('[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20'+_0xe9cec9+':',_0x2b247c),this[_0x4cfc5f(0x107)](_0xe9cec9);}}async[a9_0x458ada(0xdb)](_0x419b8e,_0x20c710){const _0x5c30b5=a9_0x458ada,_0x56d583=this[_0x5c30b5(0x179)]['get'](_0x419b8e);if(!_0x56d583){console[_0x5c30b5(0x123)](_0x5c30b5(0x150)+_0x419b8e);return;}try{await _0x56d583[_0x5c30b5(0x10a)][_0x5c30b5(0x101)](new RTCIceCandidate(_0x20c710)),console[_0x5c30b5(0xb3)](_0x5c30b5(0xeb)+_0x419b8e);}catch(_0xec4fe4){console[_0x5c30b5(0x123)]('[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20'+_0x419b8e+':',_0xec4fe4);}}[a9_0x458ada(0xe5)](_0x5bd7c0,_0x32a7bc){const _0xa577d4=a9_0x458ada;if(!this['rosbridgeWs']||this[_0xa577d4(0xe2)]['readyState']!==this[_0xa577d4(0xe2)][_0xa577d4(0x15e)])return console[_0xa577d4(0x123)](_0xa577d4(0x148)),null;console[_0xa577d4(0xb3)](_0xa577d4(0xe3)+_0x5bd7c0);const _0x24afda=_0x5bd7c0[_0xa577d4(0x16b)](_0xa577d4(0x11b)),_0x494c02=_0x5bd7c0[_0xa577d4(0x16b)](_0xa577d4(0xd5))||_0x5bd7c0[_0xa577d4(0x16b)](_0xa577d4(0x105));let _0x3c6634=[];_0x24afda?_0x494c02?_0x3c6634=[_0xa577d4(0x10b),_0xa577d4(0xf8),'compressed_depth_image_transport/CompressedDepthImage',_0xa577d4(0x170)]:_0x3c6634=[_0xa577d4(0x170),'sensor_msgs/msg/Image',_0xa577d4(0x10b)]:_0x3c6634=[_0xa577d4(0x10b),_0xa577d4(0xf8),_0xa577d4(0x170)];console['log'](_0xa577d4(0xe9)+_0x5bd7c0+'\x20detected\x20as\x20'+(_0x24afda?_0xa577d4(0x11b):_0xa577d4(0xfc))+'\x20image,\x20trying\x20message\x20types:',_0x3c6634);const _0x237069=[];let _0x28b211=![];const _0x38e2e0=_0x407bd4=>{return _0x3c39cb=>{const _0x279d5d=a9_0x160b;try{const _0x15840e=JSON[_0x279d5d(0x132)](_0x3c39cb[_0x279d5d(0x12f)]);_0x15840e['op']==='publish'&&_0x15840e[_0x279d5d(0x134)]===_0x5bd7c0&&_0x15840e[_0x279d5d(0x104)]&&(!_0x28b211&&(console[_0x279d5d(0xb3)](_0x279d5d(0x10c)+_0x5bd7c0+_0x279d5d(0xe4)+_0x407bd4),_0x28b211=!![]),_0x32a7bc(_0x15840e[_0x279d5d(0x104)]));}catch(_0x14aa6e){console[_0x279d5d(0x123)](_0x279d5d(0x141),_0x14aa6e);}};};for(const _0x266c79 of _0x3c6634){const _0x4e0b8f={'op':_0xa577d4(0xc8),'topic':_0x5bd7c0,'type':_0x266c79};console['log']('[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20'+_0x266c79),this[_0xa577d4(0xe2)][_0xa577d4(0x142)](JSON['stringify'](_0x4e0b8f));const _0x2cf00b=_0x38e2e0(_0x266c79);this[_0xa577d4(0xe2)]['addEventListener'](_0xa577d4(0x154),_0x2cf00b),_0x237069[_0xa577d4(0x114)]({'handler':_0x2cf00b,'type':_0x266c79});}return _0x24afda&&_0x494c02&&setTimeout(()=>{const _0x4aea36=_0xa577d4;if(!_0x28b211){console[_0x4aea36(0xb3)](_0x4aea36(0xbc)+_0x5bd7c0+_0x4aea36(0xd9));const _0x2a1ed1=_0x5bd7c0['replace']('/compressedDepth','')[_0x4aea36(0xd4)](_0x4aea36(0xb7),''),_0x8a2f07=[_0x2a1ed1+_0x4aea36(0x15b),_0x2a1ed1+_0x4aea36(0xf6),_0x2a1ed1];for(const _0x2cbabe of _0x8a2f07){console[_0x4aea36(0xb3)](_0x4aea36(0x147)+_0x2cbabe);const _0x2acde4={'op':_0x4aea36(0xc8),'topic':_0x2cbabe,'type':_0x4aea36(0x170)};this[_0x4aea36(0xe2)][_0x4aea36(0x142)](JSON[_0x4aea36(0x151)](_0x2acde4));const _0x5ec26d=_0x5aacb6=>{const _0x11e831=_0x4aea36;try{const _0x1e18ab=JSON[_0x11e831(0x132)](_0x5aacb6[_0x11e831(0x12f)]);_0x1e18ab['op']===_0x11e831(0x166)&&_0x1e18ab[_0x11e831(0x134)]===_0x2cbabe&&_0x1e18ab[_0x11e831(0x104)]&&(console[_0x11e831(0xb3)](_0x11e831(0x158)+_0x2cbabe+',\x20converting\x20to\x20base64...'),_0x1e18ab[_0x11e831(0x104)]['data']&&!_0x1e18ab[_0x11e831(0x104)]['data'][_0x11e831(0x16c)]('/9j/')&&_0x32a7bc(_0x1e18ab[_0x11e831(0x104)]));}catch(_0x5b42d1){console[_0x11e831(0x123)](_0x11e831(0xdc),_0x5b42d1);}};this['rosbridgeWs'][_0x4aea36(0x110)](_0x4aea36(0x154),_0x5ec26d),_0x237069[_0x4aea36(0x114)]({'handler':_0x5ec26d,'type':_0x4aea36(0x170),'topic':_0x2cbabe});}}},0xbb8),{'unsubscribe':()=>{const _0x495f83=_0xa577d4;for(const {handler:_0x1cb7f7,type:_0x13ecd0,topic:_0x559a42}of _0x237069){this[_0x495f83(0xe2)][_0x495f83(0xc5)](_0x495f83(0x154),_0x1cb7f7),this[_0x495f83(0xe2)]['readyState']===this['rosbridgeWs'][_0x495f83(0x15e)]&&this[_0x495f83(0xe2)][_0x495f83(0x142)](JSON[_0x495f83(0x151)]({'op':_0x495f83(0xf1),'topic':_0x559a42||_0x5bd7c0}));}}};}[a9_0x458ada(0x163)](_0x2ccb0f,_0x2f63c9){const _0x503037=a9_0x458ada;_0x2f63c9[_0x503037(0x16d)]=_0x503037(0xff),_0x2f63c9['fillRect'](0x0,0x0,_0x2ccb0f[_0x503037(0x140)],_0x2ccb0f[_0x503037(0xe1)]),_0x2f63c9[_0x503037(0x16d)]=_0x503037(0x14d),_0x2f63c9[_0x503037(0xe6)]=_0x503037(0x113),_0x2f63c9[_0x503037(0x149)]=_0x503037(0xd1),_0x2f63c9['fillText'](_0x503037(0xb8),_0x2ccb0f[_0x503037(0x140)]/0x2,_0x2ccb0f[_0x503037(0xe1)]/0x2-0x14),_0x2f63c9[_0x503037(0x16d)]='#ffffff',_0x2f63c9[_0x503037(0xe6)]='16px\x20Arial',_0x2f63c9[_0x503037(0xe0)]('Waiting\x20for\x20ROS\x20image\x20data...',_0x2ccb0f[_0x503037(0x140)]/0x2,_0x2ccb0f[_0x503037(0xe1)]/0x2+0x14);const _0x10e832=Date['now']()/0x3e8;for(let _0x4ca8f0=0x0;_0x4ca8f0<0x3;_0x4ca8f0++){const _0x3559aa=(Math['sin'](_0x10e832*0x2+_0x4ca8f0*0.5)+0x1)/0x2;_0x2f63c9[_0x503037(0x16d)]=_0x503037(0xc2)+_0x3559aa*0.5+')',_0x2f63c9[_0x503037(0x106)](),_0x2f63c9[_0x503037(0xdf)](_0x2ccb0f[_0x503037(0x140)]/0x2-0x28+_0x4ca8f0*0x28,_0x2ccb0f[_0x503037(0xe1)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x2f63c9['fill']();}}['sendFrameToVideoSource'](_0x11767b,_0x1ce6fe){const _0x4a2b87=a9_0x458ada;try{if(!_0x11767b||!_0x1ce6fe)return;const _0x34873a=_0x1ce6fe[_0x4a2b87(0xd0)]('2d'),_0x49f520=_0x34873a['getImageData'](0x0,0x0,_0x1ce6fe[_0x4a2b87(0x140)],_0x1ce6fe[_0x4a2b87(0xe1)]),_0x3f386a=this[_0x4a2b87(0xd2)](_0x49f520[_0x4a2b87(0x12f)],_0x1ce6fe[_0x4a2b87(0x140)],_0x1ce6fe['height']),_0xccad51={'width':_0x1ce6fe[_0x4a2b87(0x140)],'height':_0x1ce6fe[_0x4a2b87(0xe1)],'data':_0x3f386a};typeof _0x11767b[_0x4a2b87(0xcb)]===_0x4a2b87(0x174)&&_0x11767b[_0x4a2b87(0xcb)](_0xccad51);}catch(_0xb38371){console[_0x4a2b87(0x123)](_0x4a2b87(0x145),_0xb38371);}}['convertRGBAtoI420'](_0x1bbaba,_0x2c8b15,_0x4426ab){const _0x42db98=a9_0x458ada,_0x10bf28=_0x2c8b15*_0x4426ab,_0x548244=_0x2c8b15*_0x4426ab/0x4,_0x1d08f5=new Uint8Array(_0x10bf28+_0x548244*0x2);let _0x590289=0x0,_0x19d2db=_0x10bf28,_0x1bd490=_0x10bf28+_0x548244;for(let _0x59c9ab=0x0;_0x59c9ab<_0x4426ab;_0x59c9ab++){for(let _0x30cacf=0x0;_0x30cacf<_0x2c8b15;_0x30cacf++){const _0xaaf6dd=(_0x59c9ab*_0x2c8b15+_0x30cacf)*0x4,_0x546459=_0x1bbaba[_0xaaf6dd],_0x56998f=_0x1bbaba[_0xaaf6dd+0x1],_0x4be625=_0x1bbaba[_0xaaf6dd+0x2],_0x4a8cfe=Math[_0x42db98(0xc7)](0.299*_0x546459+0.587*_0x56998f+0.114*_0x4be625);_0x1d08f5[_0x590289++]=_0x4a8cfe;if(_0x59c9ab%0x2===0x0&&_0x30cacf%0x2===0x0){const _0x48f1cb=Math[_0x42db98(0xc7)](-0.169*_0x546459-0.331*_0x56998f+0.5*_0x4be625+0x80),_0x376c9c=Math[_0x42db98(0xc7)](0.5*_0x546459-0.419*_0x56998f-0.081*_0x4be625+0x80);_0x1d08f5[_0x19d2db++]=Math[_0x42db98(0xc0)](0x0,Math[_0x42db98(0x118)](0xff,_0x48f1cb)),_0x1d08f5[_0x1bd490++]=Math['max'](0x0,Math[_0x42db98(0x118)](0xff,_0x376c9c));}}}return _0x1d08f5;}async[a9_0x458ada(0x137)](_0x3900d0,_0x43f37b,_0x3ae2d9,_0x5ac322,_0x20cb2e){const _0x5e7565=a9_0x458ada;try{if(!_0x3ae2d9||!_0x3ae2d9[_0x5e7565(0x12f)])return;Math[_0x5e7565(0x15c)]()<0.01&&console[_0x5e7565(0xb3)]('[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20'+_0x5ac322+_0x5e7565(0x168)+_0x3ae2d9[_0x5e7565(0x12f)][_0x5e7565(0x175)]+_0x5e7565(0x126));const _0x72391a=Buffer['from'](_0x3ae2d9[_0x5e7565(0x12f)],_0x5e7565(0xd8)),_0x41364e=this[_0x5e7565(0x17f)][_0x5e7565(0x17d)](_0x5ac322);let _0x4152f1;_0x41364e?_0x4152f1=await this['depthProcessor'][_0x5e7565(0xbb)](_0x72391a,_0x3900d0,_0x43f37b,_0x5ac322):_0x4152f1=await this[_0x5e7565(0x17f)][_0x5e7565(0x182)](_0x72391a,_0x3900d0,_0x43f37b),_0x43f37b[_0x5e7565(0xcc)](_0x4152f1,0x0,0x0),_0x43f37b[_0x5e7565(0x16d)]=_0x5e7565(0x16f),_0x43f37b[_0x5e7565(0xb1)](0xa,0xa,0xdc,0x32),_0x43f37b[_0x5e7565(0x16d)]=_0x41364e?_0x5e7565(0x143):_0x5e7565(0xea),_0x43f37b[_0x5e7565(0xe6)]='12px\x20monospace',_0x43f37b[_0x5e7565(0xe0)]((_0x41364e?_0x5e7565(0x183):'📹\x20Color')+':\x20'+new Date()[_0x5e7565(0x13f)](),0xf,0x1c),_0x43f37b[_0x5e7565(0x16d)]='#ffffff',_0x43f37b[_0x5e7565(0xe6)]=_0x5e7565(0x176),_0x43f37b[_0x5e7565(0xe0)](_0x5e7565(0x164)+_0x5ac322[_0x5e7565(0xb6)]('/')['pop'](),0xf,0x2d),this[_0x5e7565(0xbd)](_0x20cb2e,_0x3900d0);}catch(_0x564ca1){console[_0x5e7565(0xd7)](_0x5e7565(0x17a)+_0x5ac322+':',_0x564ca1[_0x5e7565(0x154)]);_0x5ac322[_0x5e7565(0x16b)](_0x5e7565(0x11b))&&Math[_0x5e7565(0x15c)]()<0.1&&console[_0x5e7565(0xd7)](_0x5e7565(0x116)+_0x5ac322[_0x5e7565(0xd4)](_0x5e7565(0xc6),_0x5e7565(0x15b)));_0x43f37b[_0x5e7565(0x16d)]=_0x5e7565(0xff),_0x43f37b[_0x5e7565(0xb1)](0x0,0x0,_0x3900d0[_0x5e7565(0x140)],_0x3900d0[_0x5e7565(0xe1)]),_0x43f37b[_0x5e7565(0x16d)]='#888',_0x43f37b[_0x5e7565(0xe6)]=_0x5e7565(0x10f),_0x43f37b[_0x5e7565(0x149)]=_0x5e7565(0xd1);const _0x1d8f6a=_0x5ac322[_0x5e7565(0x16b)]('depth')?_0x5e7565(0x108):_0x5e7565(0x156);_0x43f37b[_0x5e7565(0xe0)](_0x1d8f6a,_0x3900d0[_0x5e7565(0x140)]/0x2,_0x3900d0[_0x5e7565(0xe1)]/0x2),_0x43f37b[_0x5e7565(0x16d)]=_0x5e7565(0x181),_0x43f37b[_0x5e7565(0xe6)]='12px\x20Arial',_0x43f37b[_0x5e7565(0xe0)](_0x5e7565(0x164)+_0x5ac322[_0x5e7565(0xb6)]('/')[_0x5e7565(0x146)](),_0x3900d0['width']/0x2,_0x3900d0['height']/0x2+0x19),this[_0x5e7565(0xbd)](_0x20cb2e,_0x3900d0);}}[a9_0x458ada(0x107)](_0x225544){const _0x5470ae=a9_0x458ada,_0x15f97f=this[_0x5470ae(0x179)]['get'](_0x225544);if(!_0x15f97f){console[_0x5470ae(0xd7)](_0x5470ae(0xf3)+_0x225544);return;}console[_0x5470ae(0xb3)](_0x5470ae(0x138)+_0x225544+_0x5470ae(0x159)+_0x15f97f[_0x5470ae(0x134)]);try{this['serverWs']&&this[_0x5470ae(0xc4)]['readyState']===this[_0x5470ae(0xc4)][_0x5470ae(0x15e)]&&this[_0x5470ae(0xc4)][_0x5470ae(0x142)](JSON[_0x5470ae(0x151)]({'op':_0x5470ae(0x153),'session_id':_0x225544})),_0x15f97f[_0x5470ae(0x133)]&&_0x15f97f[_0x5470ae(0x133)][_0x5470ae(0x13c)](),_0x15f97f[_0x5470ae(0x10a)]&&_0x15f97f[_0x5470ae(0x10a)]['close']();}catch(_0x2387f0){console[_0x5470ae(0x123)](_0x5470ae(0x12c)+_0x2387f0);}this[_0x5470ae(0xfd)](_0x225544);}[a9_0x458ada(0xfd)](_0x22246d){const _0x237358=a9_0x458ada,_0x1221a8=this['activeSessions'][_0x237358(0x184)](_0x22246d);if(_0x1221a8){const _0x33e498=this[_0x237358(0x120)]['get'](_0x1221a8[_0x237358(0x134)]);_0x33e498&&(_0x33e498['delete'](_0x22246d),_0x33e498[_0x237358(0x16e)]===0x0&&this[_0x237358(0x120)]['delete'](_0x1221a8[_0x237358(0x134)])),this[_0x237358(0x128)](_0x1221a8[_0x237358(0x134)]);}this[_0x237358(0x179)][_0x237358(0x161)](_0x22246d),console[_0x237358(0xb3)](_0x237358(0x102)+_0x22246d);}['stopAllSessions'](){const _0x3c60b5=a9_0x458ada;console[_0x3c60b5(0xb3)](_0x3c60b5(0xec));const _0x357c62=Array[_0x3c60b5(0x12d)](this[_0x3c60b5(0x179)][_0x3c60b5(0x109)]());_0x357c62[_0x3c60b5(0x144)](_0x549f4b=>this[_0x3c60b5(0x107)](_0x549f4b));}[a9_0x458ada(0xdd)](){const _0xc8a09f=a9_0x458ada,_0x3cd43e=[];for(const [_0x378126,_0x1d5116]of this[_0xc8a09f(0x179)]){_0x3cd43e[_0xc8a09f(0x114)]({'sessionId':_0x378126,'topic':_0x1d5116[_0xc8a09f(0x134)],'connectionState':_0x1d5116['peerConnection']?.[_0xc8a09f(0x15a)]||'unknown','hasVideoTrack':!!_0x1d5116[_0xc8a09f(0x133)]});}return _0x3cd43e;}[a9_0x458ada(0xd3)](){const _0x2933e0=a9_0x458ada,_0x28b4a2=[];for(const [_0xc25cda,_0x4f04b6]of this[_0x2933e0(0x169)]){_0x28b4a2[_0x2933e0(0x114)]({'topic':_0xc25cda,'frameCount':_0x4f04b6[_0x2933e0(0xb9)],'hasVideoSource':!!_0x4f04b6[_0x2933e0(0x14a)],'hasRosSubscriber':!!_0x4f04b6[_0x2933e0(0x127)]});}return _0x28b4a2;}}function a9_0x160b(_0x1540bb,_0x2a2197){const _0x484a34=a9_0x14f6();return a9_0x160b=function(_0xfe2001,_0x190b7f){_0xfe2001=_0xfe2001-0xb1;let _0x14f614=_0x484a34[_0xfe2001];return _0x14f614;},a9_0x160b(_0x1540bb,_0x2a2197);}module[a9_0x458ada(0x14f)]=new ApplianceWebRTCService();function a9_0x14f6(){const _0x1ddb2d=['round','subscribe','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','4085pLpDkB','onFrame','putImageData','search','6262110YrHbat','[WebRTC\x20Appliance]\x20Service\x20initialized','getContext','center','convertRGBAtoI420','getSharedVideoSources','replace','compressed','toString','warn','base64',',\x20trying\x20alternative\x20depth\x20topics','apply','handleIceCandidate','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','getActiveSessions','getIceServers','arc','fillText','height','rosbridgeWs','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','\x20with\x20message\x20type\x20','subscribeToROSTopic','font','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','add','[WebRTC\x20Appliance]\x20Topic\x20','#00ff00','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','./turnCredentialsService','3836393buNSgM','(((.+)+)+)+$','sharp','unsubscribe','connected','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','initialize','framerate','/image','webrtc_init_session','sensor_msgs/msg/CompressedImage','onconnectionstatechange','port','12BZWIBz','color','cleanupSession','setLocalDescription','#1a1a1a','candidate','addIceCandidate','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','msg','compressedDepth','beginPath','stopSession','🔍\x20Processing\x20depth...','keys','peerConnection','sensor_msgs/CompressedImage','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','createTrack','16px\x20Arial','addEventListener','setRemoteDescription','addTrack','24px\x20Arial','push','onicecandidate','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','14DaRZyK','min','session_id','stun:stun.l.google.com:19302','depth','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','wrtc','851776uuIdym','protocol','topicSessions','[WebRTC\x20Appliance]\x20Session\x20','106440KykLCR','error','set','createAnswer','\x20bytes','rosSubscriber','releaseSharedVideoSource','handleMessage','132ZmhYPo','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','from','serverUrl','data','offer','constructor','parse','videoTrack','topic','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','webrtc_offer','updateCanvasWithImageData','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','\x20sessions\x20remaining)','stop','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','10uMoxKT','toLocaleTimeString','width','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','send','#00ffff','forEach','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','pop','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','textAlign','videoSource','handleOffer','45332gGJbcv','#00aaff','getOrCreateSharedVideoSource','exports','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','stringify','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','webrtc_stop_session','message','\x20connection\x20failed,\x20stopping\x20session','📹\x20Processing\x20video...','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','\x20for\x20topic:\x20','connectionState','/image_raw','random','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','OPEN','webrtc_','has','delete','\x20for\x20topic\x20','drawLoadingPattern','Topic:\x20','canvas','publish','\x20initialized\x20successfully',',\x20size:\x20','sharedVideoSources','webrtc_ice_candidate','includes','startsWith','fillStyle','size','rgba(0,\x200,\x200,\x200.7)','sensor_msgs/Image','closed','stun:stun1.l.google.com:19302','video','function','length','10px\x20monospace','webrtc','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','activeSessions','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','\x20connection\x20state:\x20','isDepthTopic','rtcConfig','depthProcessor','\x20connection\x20closed,\x20cleaning\x20up','#666','processColorImage','🔍\x20Depth','get','updateTurnCredentials','\x20sessions)','fillRect','webrtc_answer','log','initializeSession','124sDVraR','split','/compressed','🤖\x20Robot\x20Camera','frameCount','2017225izvals','processDepthImage','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','sendFrameToVideoSource','iceServers','3263RANNfS','max',',\x20cleaning\x20up\x20shared\x20resources','rgba(0,\x20170,\x20255,\x20','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','serverWs','removeEventListener','/compressedDepth'];a9_0x14f6=function(){return _0x1ddb2d;};return a9_0x14f6();}