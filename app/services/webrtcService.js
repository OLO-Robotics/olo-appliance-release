const a6_0x7f209=a6_0x6aed;(function(_0x428133,_0x21a0d3){const _0x1c248c=a6_0x6aed,_0x509c97=_0x428133();while(!![]){try{const _0x380074=parseInt(_0x1c248c(0x1b8))/0x1+parseInt(_0x1c248c(0x191))/0x2*(parseInt(_0x1c248c(0x151))/0x3)+parseInt(_0x1c248c(0x161))/0x4+-parseInt(_0x1c248c(0x201))/0x5*(-parseInt(_0x1c248c(0x146))/0x6)+parseInt(_0x1c248c(0x16a))/0x7*(parseInt(_0x1c248c(0x1a4))/0x8)+parseInt(_0x1c248c(0x145))/0x9*(-parseInt(_0x1c248c(0x193))/0xa)+-parseInt(_0x1c248c(0x17a))/0xb;if(_0x380074===_0x21a0d3)break;else _0x509c97['push'](_0x509c97['shift']());}catch(_0xfbb73){_0x509c97['push'](_0x509c97['shift']());}}}(a6_0x39c2,0xeb0bb));function a6_0x39c2(){const _0x1538d6=['textAlign',',\x20converting\x20to\x20base64...','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','initializing','peerConnection','random','stopSession','connectionState','sensor_msgs/Image','rosSubscriber','[WebRTC\x20Appliance]\x20Session\x20','activeSessions','\x20sessions)','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','log','font','apply','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','rtcConfig','18nIOHQd','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','4190DmsQXd','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','[WebRTC\x20Appliance]\x20Created\x20answer','webrtc_offer','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','sensor_msgs/CompressedImage','connected','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','beginPath','rgba(0,\x200,\x200,\x200.7)','./turnCredentialsService','frameCount','send','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','initialize','4432528luUYzW','\x20connection\x20closed,\x20cleaning\x20up','push','fillStyle','sensor_msgs/msg/Image','unsubscribe','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','error','subscribe','height','webrtc_ice_candidate','\x20for\x20topic\x20','type','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','size','data','depth','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','getActiveSessions','publish','142804IpwUTg','message','/compressedDepth','videoSource','updateCanvasWithImageData','updateTurnCredentials','sharedVideoSources','putImageData','videoTrack','depthProcessor','topicSessions','\x20successfully\x20connected!','webrtc_stop_session','getContext','from','round','../config','includes','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','warn','ðŸ“¹\x20Color','(((.+)+)+)+$','iceServers','fillText','parse','\x20initialized\x20successfully','readyState','delete','video','port','/image','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','getIceServers','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','failed','closed','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','has','ðŸ”\x20Processing\x20depth...','sensor_msgs/msg/CompressedImage','close','#888','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','base64','\x20image,\x20trying\x20message\x20types:','now','width','sin','Topic:\x20','function','\x20connection\x20failed,\x20stopping\x20session','max','12px\x20Arial','rgba(0,\x20170,\x20255,\x20','arc','protocol','onconnectionstatechange','#666','handleMessage','cleanupSession','getOrCreateSharedVideoSource','toString','exports','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','createAnswer','search','onFrame','\x20bytes','24px\x20Arial','center','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','isDepthTopic','145riiZho','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','msg','offer','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','\x20with\x20message\x20type\x20','sendFrameToVideoSource','wrtc','\x20sessions\x20remaining)','\x20connection\x20state:\x20','convertRGBAtoI420','#00ffff','rosbridgeWs','set','#00ff00','candidate','addEventListener','40509nxzUqo','30714PrqdqS','serverWs','\x20for\x20topic:\x20','replace','stun:stun1.l.google.com:19302','get','#00aaff','\x20detected\x20as\x20','setLocalDescription','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','Waiting\x20for\x20ROS\x20image\x20data...','588063rFtbCo','processColorImage','OPEN','handleIceCandidate','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','sharp','toLocaleTimeString','add','stopAllSessions','compressed_depth_image_transport/CompressedDepthImage',',\x20trying\x20alternative\x20depth\x20topics','pop','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','#1a1a1a','setRemoteDescription','5305496LqueDg','stun:stun.l.google.com:19302','min','startsWith','16px\x20Arial','removeEventListener','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','stringify','fill','21pQTVwG','topic','framerate',',\x20cleaning\x20up\x20shared\x20resources','onicecandidate','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','unknown',',\x20size:\x20','[WebRTC\x20Appliance]\x20Topic\x20','ðŸ”\x20Depth','handleOffer','webrtc','fillRect','initializeSession','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','canvas','24148850vhGBtj','#ffffff','session_id'];a6_0x39c2=function(){return _0x1538d6;};return a6_0x39c2();}const a6_0x5bbf67=(function(){let _0x1221d1=!![];return function(_0x382df1,_0x1c9524){const _0x17f1ca=_0x1221d1?function(){const _0x13d2e2=a6_0x6aed;if(_0x1c9524){const _0x4a7aa9=_0x1c9524[_0x13d2e2(0x18e)](_0x382df1,arguments);return _0x1c9524=null,_0x4a7aa9;}}:function(){};return _0x1221d1=![],_0x17f1ca;};}()),a6_0x3d18f9=a6_0x5bbf67(this,function(){const _0x35c488=a6_0x6aed;return a6_0x3d18f9[_0x35c488(0x1f5)]()[_0x35c488(0x1fa)](_0x35c488(0x1cd))[_0x35c488(0x1f5)]()['constructor'](a6_0x3d18f9)[_0x35c488(0x1fa)]('(((.+)+)+)+$');});function a6_0x6aed(_0x18a880,_0xd3ebfc){const _0x3fd648=a6_0x39c2();return a6_0x6aed=function(_0x3d18f9,_0x5bbf67){_0x3d18f9=_0x3d18f9-0x140;let _0x39c2ea=_0x3fd648[_0x3d18f9];return _0x39c2ea;},a6_0x6aed(_0x18a880,_0xd3ebfc);}a6_0x3d18f9();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x7f209(0x208)),sharp=require(a6_0x7f209(0x156)),config=require(a6_0x7f209(0x1c8)),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require(a6_0x7f209(0x19e));class ApplianceWebRTCService{constructor(){const _0x4c506c=a6_0x7f209;this[_0x4c506c(0x189)]=new Map(),this[_0x4c506c(0x1c2)]=new Map(),this['sharedVideoSources']=new Map(),this[_0x4c506c(0x140)]=null,this[_0x4c506c(0x147)]=null,this[_0x4c506c(0x1c1)]=new DepthImageProcessor(),this['rtcConfig']={'iceServers':[{'urls':_0x4c506c(0x162)},{'urls':_0x4c506c(0x14a)}]};}[a6_0x7f209(0x1a3)](_0x564a5e,_0x19b1cc){const _0x3f4518=a6_0x7f209;this[_0x3f4518(0x140)]=_0x564a5e,this['serverWs']=_0x19b1cc,turnCredentialsService[_0x3f4518(0x1a3)](config['serverUrl']),this[_0x3f4518(0x1bd)](),console['log']('[WebRTC\x20Appliance]\x20Service\x20initialized');}async[a6_0x7f209(0x1bd)](){const _0x3961d6=a6_0x7f209;try{console[_0x3961d6(0x18c)](_0x3961d6(0x18f));const _0x2c1573=await turnCredentialsService[_0x3961d6(0x1d8)]();this[_0x3961d6(0x190)][_0x3961d6(0x1ce)]=_0x2c1573,console[_0x3961d6(0x18c)]('[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully');}catch(_0xf57d08){console[_0x3961d6(0x1ab)](_0x3961d6(0x192),_0xf57d08),console[_0x3961d6(0x18c)](_0x3961d6(0x19b));}}[a6_0x7f209(0x1f2)](_0x2729aa){const _0x477514=a6_0x7f209;if(!_0x2729aa['op']||!_0x2729aa['op']['startsWith']('webrtc_'))return![];console[_0x477514(0x18c)](_0x477514(0x1a1)+_0x2729aa['op']);switch(_0x2729aa['op']){case'webrtc_init_session':this[_0x477514(0x177)](_0x2729aa[_0x477514(0x17c)],_0x2729aa[_0x477514(0x16b)]);return!![];case _0x477514(0x196):this[_0x477514(0x174)](_0x2729aa['session_id'],_0x2729aa[_0x477514(0x204)]);return!![];case _0x477514(0x1ae):this['handleIceCandidate'](_0x2729aa['session_id'],_0x2729aa[_0x477514(0x143)]);return!![];case _0x477514(0x1c4):this[_0x477514(0x184)](_0x2729aa[_0x477514(0x17c)]);return!![];default:console['warn']('[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20'+_0x2729aa['op']);return![];}}[a6_0x7f209(0x1f4)](_0x33d287){const _0x433deb=a6_0x7f209;if(this[_0x433deb(0x1be)][_0x433deb(0x1dd)](_0x33d287)){const _0x23e87d=this[_0x433deb(0x1be)][_0x433deb(0x14b)](_0x33d287);return _0x23e87d['frameCount']++,console['log'](_0x433deb(0x197)+_0x33d287+'\x20('+_0x23e87d[_0x433deb(0x19f)]+_0x433deb(0x18a)),_0x23e87d;}console[_0x433deb(0x18c)]('[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x33d287);const {createCanvas:_0x315a45}=require(_0x433deb(0x179)),_0x29939a=_0x315a45(config[_0x433deb(0x175)][_0x433deb(0x1d4)]['width'],config[_0x433deb(0x175)][_0x433deb(0x1d4)][_0x433deb(0x1ad)]),_0x53c958=_0x29939a[_0x433deb(0x1c5)]('2d');this['drawLoadingPattern'](_0x29939a,_0x53c958);const {RTCVideoSource:_0x5890fb}=nonstandard,_0x19a960=new _0x5890fb();let _0x418230=0x0;const _0x80caee=0x3e8/config[_0x433deb(0x175)][_0x433deb(0x1d4)][_0x433deb(0x16c)],_0x5527d4=this['subscribeToROSTopic'](_0x33d287,_0x18a6a0=>{const _0x5500d1=_0x433deb,_0x3191da=Date[_0x5500d1(0x1e5)]();_0x3191da-_0x418230>=_0x80caee&&(_0x418230=_0x3191da,this[_0x5500d1(0x1bc)](_0x29939a,_0x53c958,_0x18a6a0,_0x33d287,_0x19a960));}),_0x50b497={'videoSource':_0x19a960,'canvas':_0x29939a,'rosSubscriber':_0x5527d4,'frameCount':0x1,'topic':_0x33d287};return this[_0x433deb(0x1be)][_0x433deb(0x141)](_0x33d287,_0x50b497),_0x50b497;}['releaseSharedVideoSource'](_0x219b5d){const _0x16e56b=a6_0x7f209,_0xbfac19=this[_0x16e56b(0x1be)][_0x16e56b(0x14b)](_0x219b5d);if(!_0xbfac19)return;_0xbfac19['frameCount']--,console[_0x16e56b(0x18c)](_0x16e56b(0x1d9)+_0x219b5d+'\x20('+_0xbfac19[_0x16e56b(0x19f)]+_0x16e56b(0x209)),_0xbfac19[_0x16e56b(0x19f)]<=0x0&&(console[_0x16e56b(0x18c)](_0x16e56b(0x19a)+_0x219b5d+_0x16e56b(0x16d)),_0xbfac19[_0x16e56b(0x1bb)]&&(_0xbfac19[_0x16e56b(0x1bb)]=null),_0xbfac19[_0x16e56b(0x187)]&&_0xbfac19[_0x16e56b(0x187)][_0x16e56b(0x1a9)](),this['sharedVideoSources'][_0x16e56b(0x1d3)](_0x219b5d));}async[a6_0x7f209(0x177)](_0x1ba62e,_0x183973){const _0x5f1cc3=a6_0x7f209;try{console[_0x5f1cc3(0x18c)](_0x5f1cc3(0x18b)+_0x1ba62e+_0x5f1cc3(0x1af)+_0x183973);const _0x371cb8=this['getOrCreateSharedVideoSource'](_0x183973),_0x3880e0=new RTCPeerConnection(this[_0x5f1cc3(0x190)]),_0x506ecd=_0x371cb8[_0x5f1cc3(0x1bb)]['createTrack']({'width':config[_0x5f1cc3(0x175)][_0x5f1cc3(0x1d4)][_0x5f1cc3(0x1e6)],'height':config['webrtc']['video'][_0x5f1cc3(0x1ad)],'framerate':config['webrtc'][_0x5f1cc3(0x1d4)]['framerate']});console[_0x5f1cc3(0x18c)](_0x5f1cc3(0x17f)+_0x1ba62e);const {MediaStream:_0x495af5}=require(_0x5f1cc3(0x208)),_0x397490=new _0x495af5([_0x506ecd]);_0x3880e0['addTrack'](_0x506ecd,_0x397490),this['sendFrameToVideoSource'](_0x371cb8[_0x5f1cc3(0x1bb)],_0x371cb8[_0x5f1cc3(0x179)]),_0x3880e0[_0x5f1cc3(0x16e)]=_0x557b65=>{const _0x31b187=_0x5f1cc3;if(_0x557b65[_0x31b187(0x143)]&&this['serverWs'])console[_0x31b187(0x18c)](_0x31b187(0x1b1)+_0x1ba62e+':',{'type':_0x557b65[_0x31b187(0x143)][_0x31b187(0x1b0)],'protocol':_0x557b65[_0x31b187(0x143)][_0x31b187(0x1ef)],'address':_0x557b65[_0x31b187(0x143)]['address'],'port':_0x557b65[_0x31b187(0x143)][_0x31b187(0x1d5)]}),this[_0x31b187(0x147)][_0x31b187(0x1a0)](JSON['stringify']({'op':'webrtc_ice_candidate','session_id':_0x1ba62e,'candidate':_0x557b65[_0x31b187(0x143)]}));else!_0x557b65['candidate']&&console[_0x31b187(0x18c)](_0x31b187(0x1e2)+_0x1ba62e);},_0x3880e0[_0x5f1cc3(0x1f0)]=()=>{const _0x18dcb1=_0x5f1cc3;console[_0x18dcb1(0x18c)](_0x18dcb1(0x188)+_0x1ba62e+_0x18dcb1(0x20a)+_0x3880e0[_0x18dcb1(0x185)]);if(_0x3880e0[_0x18dcb1(0x185)]===_0x18dcb1(0x199))console[_0x18dcb1(0x18c)](_0x18dcb1(0x188)+_0x1ba62e+_0x18dcb1(0x1c3));else{if(_0x3880e0[_0x18dcb1(0x185)]===_0x18dcb1(0x1da))console['log'](_0x18dcb1(0x188)+_0x1ba62e+_0x18dcb1(0x1ea)),this[_0x18dcb1(0x184)](_0x1ba62e);else _0x3880e0[_0x18dcb1(0x185)]===_0x18dcb1(0x1db)&&(console[_0x18dcb1(0x18c)](_0x18dcb1(0x188)+_0x1ba62e+_0x18dcb1(0x1a5)),this['cleanupSession'](_0x1ba62e));}},this[_0x5f1cc3(0x189)][_0x5f1cc3(0x141)](_0x1ba62e,{'peerConnection':_0x3880e0,'topic':_0x183973,'videoTrack':_0x506ecd,'mediaStream':_0x397490,'status':_0x5f1cc3(0x181)}),!this['topicSessions'][_0x5f1cc3(0x1dd)](_0x183973)&&this[_0x5f1cc3(0x1c2)]['set'](_0x183973,new Set()),this[_0x5f1cc3(0x1c2)][_0x5f1cc3(0x14b)](_0x183973)[_0x5f1cc3(0x158)](_0x1ba62e),console[_0x5f1cc3(0x18c)](_0x5f1cc3(0x188)+_0x1ba62e+_0x5f1cc3(0x1d1)),console[_0x5f1cc3(0x18c)](_0x5f1cc3(0x14f)+_0x183973+':\x20'+this[_0x5f1cc3(0x1c2)][_0x5f1cc3(0x14b)](_0x183973)[_0x5f1cc3(0x1b2)]);}catch(_0x2fe7a3){console[_0x5f1cc3(0x1ab)](_0x5f1cc3(0x1dc)+_0x1ba62e+':',_0x2fe7a3),this[_0x5f1cc3(0x184)](_0x1ba62e);}}async[a6_0x7f209(0x174)](_0x50af68,_0x26169f){const _0x434322=a6_0x7f209,_0x5633fe=this['activeSessions'][_0x434322(0x14b)](_0x50af68);if(!_0x5633fe){console['error'](_0x434322(0x1d7)+_0x50af68);return;}try{console[_0x434322(0x18c)](_0x434322(0x1f8)+_0x50af68),await _0x5633fe[_0x434322(0x182)][_0x434322(0x160)](new RTCSessionDescription(_0x26169f)),console[_0x434322(0x18c)](_0x434322(0x1a2));const _0x2030da=await _0x5633fe[_0x434322(0x182)][_0x434322(0x1f9)]();console[_0x434322(0x18c)](_0x434322(0x195)),await _0x5633fe[_0x434322(0x182)][_0x434322(0x14e)](_0x2030da),console[_0x434322(0x18c)](_0x434322(0x1b5)),this[_0x434322(0x147)]&&(this[_0x434322(0x147)][_0x434322(0x1a0)](JSON[_0x434322(0x168)]({'op':'webrtc_answer','session_id':_0x50af68,'answer':_0x2030da})),console[_0x434322(0x18c)]('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0x50af68));}catch(_0xa585b1){console[_0x434322(0x1ab)](_0x434322(0x1f7)+_0x50af68+':',_0xa585b1),this[_0x434322(0x184)](_0x50af68);}}async[a6_0x7f209(0x154)](_0x157d9c,_0x35225d){const _0x2c1fb8=a6_0x7f209,_0x38820b=this['activeSessions'][_0x2c1fb8(0x14b)](_0x157d9c);if(!_0x38820b){console['error'](_0x2c1fb8(0x1ca)+_0x157d9c);return;}try{await _0x38820b['peerConnection']['addIceCandidate'](new RTCIceCandidate(_0x35225d)),console['log'](_0x2c1fb8(0x16f)+_0x157d9c);}catch(_0x8bcda5){console[_0x2c1fb8(0x1ab)]('[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20'+_0x157d9c+':',_0x8bcda5);}}['subscribeToROSTopic'](_0x5e5e43,_0x577c71){const _0x380e29=a6_0x7f209;if(!this[_0x380e29(0x140)]||this['rosbridgeWs'][_0x380e29(0x1d2)]!==this[_0x380e29(0x140)][_0x380e29(0x153)])return console['error']('[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected'),null;console['log'](_0x380e29(0x155)+_0x5e5e43);const _0x13d8f9=_0x5e5e43['includes'](_0x380e29(0x1b4)),_0x369283=_0x5e5e43[_0x380e29(0x1c9)]('compressed')||_0x5e5e43[_0x380e29(0x1c9)]('compressedDepth');let _0x4ed5a2=[];_0x13d8f9?_0x369283?_0x4ed5a2=[_0x380e29(0x198),_0x380e29(0x1df),_0x380e29(0x15a),_0x380e29(0x186)]:_0x4ed5a2=[_0x380e29(0x186),_0x380e29(0x1a8),_0x380e29(0x198)]:_0x4ed5a2=['sensor_msgs/CompressedImage',_0x380e29(0x1df),_0x380e29(0x186)];console[_0x380e29(0x18c)](_0x380e29(0x172)+_0x5e5e43+_0x380e29(0x14d)+(_0x13d8f9?_0x380e29(0x1b4):'color')+_0x380e29(0x1e4),_0x4ed5a2);const _0x4cebb5=[];let _0x17d88a=![];const _0x15abba=_0x207866=>{return _0x36e110=>{const _0x50dbaa=a6_0x6aed;try{const _0x29157f=JSON[_0x50dbaa(0x1d0)](_0x36e110[_0x50dbaa(0x1b3)]);_0x29157f['op']===_0x50dbaa(0x1b7)&&_0x29157f[_0x50dbaa(0x16b)]===_0x5e5e43&&_0x29157f['msg']&&(!_0x17d88a&&(console[_0x50dbaa(0x18c)](_0x50dbaa(0x178)+_0x5e5e43+_0x50dbaa(0x206)+_0x207866),_0x17d88a=!![]),_0x577c71(_0x29157f[_0x50dbaa(0x203)]));}catch(_0x6842f8){console[_0x50dbaa(0x1ab)](_0x50dbaa(0x205),_0x6842f8);}};};for(const _0x3cf2d3 of _0x4ed5a2){const _0x12791e={'op':'subscribe','topic':_0x5e5e43,'type':_0x3cf2d3};console[_0x380e29(0x18c)](_0x380e29(0x15d)+_0x3cf2d3),this[_0x380e29(0x140)][_0x380e29(0x1a0)](JSON[_0x380e29(0x168)](_0x12791e));const _0x3ec0d8=_0x15abba(_0x3cf2d3);this[_0x380e29(0x140)][_0x380e29(0x144)](_0x380e29(0x1b9),_0x3ec0d8),_0x4cebb5[_0x380e29(0x1a6)]({'handler':_0x3ec0d8,'type':_0x3cf2d3});}return _0x13d8f9&&_0x369283&&setTimeout(()=>{const _0x262a72=_0x380e29;if(!_0x17d88a){console[_0x262a72(0x18c)]('[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20'+_0x5e5e43+_0x262a72(0x15b));const _0xdec758=_0x5e5e43['replace'](_0x262a72(0x1ba),'')['replace']('/compressed',''),_0x45fc80=[_0xdec758+'/image_raw',_0xdec758+_0x262a72(0x1d6),_0xdec758];for(const _0x2d021c of _0x45fc80){console[_0x262a72(0x18c)]('[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20'+_0x2d021c);const _0x3110a2={'op':_0x262a72(0x1ac),'topic':_0x2d021c,'type':_0x262a72(0x186)};this[_0x262a72(0x140)][_0x262a72(0x1a0)](JSON['stringify'](_0x3110a2));const _0x79040c=_0x2aea06=>{const _0x32efe5=_0x262a72;try{const _0x55679f=JSON[_0x32efe5(0x1d0)](_0x2aea06[_0x32efe5(0x1b3)]);_0x55679f['op']==='publish'&&_0x55679f['topic']===_0x2d021c&&_0x55679f['msg']&&(console[_0x32efe5(0x18c)]('[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20'+_0x2d021c+_0x32efe5(0x17e)),_0x55679f[_0x32efe5(0x203)][_0x32efe5(0x1b3)]&&!_0x55679f[_0x32efe5(0x203)]['data'][_0x32efe5(0x164)]('/9j/')&&_0x577c71(_0x55679f[_0x32efe5(0x203)]));}catch(_0x2a54f0){console[_0x32efe5(0x1ab)](_0x32efe5(0x194),_0x2a54f0);}};this[_0x262a72(0x140)][_0x262a72(0x144)](_0x262a72(0x1b9),_0x79040c),_0x4cebb5[_0x262a72(0x1a6)]({'handler':_0x79040c,'type':_0x262a72(0x186),'topic':_0x2d021c});}}},0xbb8),{'unsubscribe':()=>{const _0x4f6c31=_0x380e29;for(const {handler:_0x2d5bc0,type:_0x67f098,topic:_0x1d6dd3}of _0x4cebb5){this[_0x4f6c31(0x140)][_0x4f6c31(0x166)](_0x4f6c31(0x1b9),_0x2d5bc0),this[_0x4f6c31(0x140)]['readyState']===this[_0x4f6c31(0x140)][_0x4f6c31(0x153)]&&this[_0x4f6c31(0x140)]['send'](JSON[_0x4f6c31(0x168)]({'op':_0x4f6c31(0x1a9),'topic':_0x1d6dd3||_0x5e5e43}));}}};}['drawLoadingPattern'](_0x486bdb,_0x2f4164){const _0x16cf3a=a6_0x7f209;_0x2f4164[_0x16cf3a(0x1a7)]='#1a1a1a',_0x2f4164[_0x16cf3a(0x176)](0x0,0x0,_0x486bdb[_0x16cf3a(0x1e6)],_0x486bdb[_0x16cf3a(0x1ad)]),_0x2f4164[_0x16cf3a(0x1a7)]=_0x16cf3a(0x14c),_0x2f4164['font']=_0x16cf3a(0x1fd),_0x2f4164[_0x16cf3a(0x17d)]=_0x16cf3a(0x1fe),_0x2f4164[_0x16cf3a(0x1cf)]('ðŸ¤–\x20Robot\x20Camera',_0x486bdb[_0x16cf3a(0x1e6)]/0x2,_0x486bdb[_0x16cf3a(0x1ad)]/0x2-0x14),_0x2f4164[_0x16cf3a(0x1a7)]=_0x16cf3a(0x17b),_0x2f4164[_0x16cf3a(0x18d)]=_0x16cf3a(0x165),_0x2f4164[_0x16cf3a(0x1cf)](_0x16cf3a(0x150),_0x486bdb[_0x16cf3a(0x1e6)]/0x2,_0x486bdb[_0x16cf3a(0x1ad)]/0x2+0x14);const _0x1d203a=Date[_0x16cf3a(0x1e5)]()/0x3e8;for(let _0x9dd698=0x0;_0x9dd698<0x3;_0x9dd698++){const _0xc06113=(Math[_0x16cf3a(0x1e7)](_0x1d203a*0x2+_0x9dd698*0.5)+0x1)/0x2;_0x2f4164[_0x16cf3a(0x1a7)]=_0x16cf3a(0x1ed)+_0xc06113*0.5+')',_0x2f4164[_0x16cf3a(0x19c)](),_0x2f4164[_0x16cf3a(0x1ee)](_0x486bdb[_0x16cf3a(0x1e6)]/0x2-0x28+_0x9dd698*0x28,_0x486bdb[_0x16cf3a(0x1ad)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x2f4164[_0x16cf3a(0x169)]();}}[a6_0x7f209(0x207)](_0xa0e444,_0x5a4bb0){const _0x810258=a6_0x7f209;try{if(!_0xa0e444||!_0x5a4bb0)return;const _0x469ceb=_0x5a4bb0[_0x810258(0x1c5)]('2d'),_0x3a9171=_0x469ceb['getImageData'](0x0,0x0,_0x5a4bb0[_0x810258(0x1e6)],_0x5a4bb0[_0x810258(0x1ad)]),_0x1a8e27=this[_0x810258(0x20b)](_0x3a9171[_0x810258(0x1b3)],_0x5a4bb0[_0x810258(0x1e6)],_0x5a4bb0[_0x810258(0x1ad)]),_0x386bfe={'width':_0x5a4bb0[_0x810258(0x1e6)],'height':_0x5a4bb0[_0x810258(0x1ad)],'data':_0x1a8e27};typeof _0xa0e444[_0x810258(0x1fb)]===_0x810258(0x1e9)&&_0xa0e444[_0x810258(0x1fb)](_0x386bfe);}catch(_0x760c63){console['error']('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x760c63);}}[a6_0x7f209(0x20b)](_0x4a01d9,_0x26dc7d,_0x27c4bf){const _0x1ff7df=a6_0x7f209,_0x3961c7=_0x26dc7d*_0x27c4bf,_0x502313=_0x26dc7d*_0x27c4bf/0x4,_0x1e2b5b=new Uint8Array(_0x3961c7+_0x502313*0x2);let _0xc630b5=0x0,_0x284840=_0x3961c7,_0x546c20=_0x3961c7+_0x502313;for(let _0x452b46=0x0;_0x452b46<_0x27c4bf;_0x452b46++){for(let _0x5953ac=0x0;_0x5953ac<_0x26dc7d;_0x5953ac++){const _0x26a7b2=(_0x452b46*_0x26dc7d+_0x5953ac)*0x4,_0x53573d=_0x4a01d9[_0x26a7b2],_0x449dd1=_0x4a01d9[_0x26a7b2+0x1],_0x4d25be=_0x4a01d9[_0x26a7b2+0x2],_0x40c2fe=Math[_0x1ff7df(0x1c7)](0.299*_0x53573d+0.587*_0x449dd1+0.114*_0x4d25be);_0x1e2b5b[_0xc630b5++]=_0x40c2fe;if(_0x452b46%0x2===0x0&&_0x5953ac%0x2===0x0){const _0x33df1e=Math['round'](-0.169*_0x53573d-0.331*_0x449dd1+0.5*_0x4d25be+0x80),_0x4078ca=Math[_0x1ff7df(0x1c7)](0.5*_0x53573d-0.419*_0x449dd1-0.081*_0x4d25be+0x80);_0x1e2b5b[_0x284840++]=Math[_0x1ff7df(0x1eb)](0x0,Math[_0x1ff7df(0x163)](0xff,_0x33df1e)),_0x1e2b5b[_0x546c20++]=Math[_0x1ff7df(0x1eb)](0x0,Math[_0x1ff7df(0x163)](0xff,_0x4078ca));}}}return _0x1e2b5b;}async['updateCanvasWithImageData'](_0x5d80e8,_0xdac5,_0x28604d,_0x67586f,_0x551ab8){const _0x13feda=a6_0x7f209;try{if(!_0x28604d||!_0x28604d['data'])return;Math[_0x13feda(0x183)]()<0.01&&console[_0x13feda(0x18c)](_0x13feda(0x180)+_0x67586f+_0x13feda(0x171)+_0x28604d[_0x13feda(0x1b3)]['length']+_0x13feda(0x1fc));const _0x2bccf3=Buffer[_0x13feda(0x1c6)](_0x28604d['data'],_0x13feda(0x1e3)),_0x5076f1=this[_0x13feda(0x1c1)][_0x13feda(0x200)](_0x67586f);let _0x2063e1;_0x5076f1?_0x2063e1=await this[_0x13feda(0x1c1)]['processDepthImage'](_0x2bccf3,_0x5d80e8,_0xdac5,_0x67586f):_0x2063e1=await this[_0x13feda(0x1c1)][_0x13feda(0x152)](_0x2bccf3,_0x5d80e8,_0xdac5),_0xdac5[_0x13feda(0x1bf)](_0x2063e1,0x0,0x0),_0xdac5[_0x13feda(0x1a7)]=_0x13feda(0x19d),_0xdac5['fillRect'](0xa,0xa,0xdc,0x32),_0xdac5[_0x13feda(0x1a7)]=_0x5076f1?_0x13feda(0x20c):_0x13feda(0x142),_0xdac5[_0x13feda(0x18d)]='12px\x20monospace',_0xdac5[_0x13feda(0x1cf)]((_0x5076f1?_0x13feda(0x173):_0x13feda(0x1cc))+':\x20'+new Date()[_0x13feda(0x157)](),0xf,0x1c),_0xdac5[_0x13feda(0x1a7)]=_0x13feda(0x17b),_0xdac5[_0x13feda(0x18d)]='10px\x20monospace',_0xdac5[_0x13feda(0x1cf)](_0x13feda(0x1e8)+_0x67586f['split']('/')[_0x13feda(0x15c)](),0xf,0x2d),this[_0x13feda(0x207)](_0x551ab8,_0x5d80e8);}catch(_0x18e7d9){console[_0x13feda(0x1cb)](_0x13feda(0x167)+_0x67586f+':',_0x18e7d9[_0x13feda(0x1b9)]);_0x67586f[_0x13feda(0x1c9)](_0x13feda(0x1b4))&&Math['random']()<0.1&&console['warn']('[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20'+_0x67586f[_0x13feda(0x149)]('/compressedDepth','/image_raw'));_0xdac5[_0x13feda(0x1a7)]=_0x13feda(0x15f),_0xdac5[_0x13feda(0x176)](0x0,0x0,_0x5d80e8['width'],_0x5d80e8[_0x13feda(0x1ad)]),_0xdac5['fillStyle']=_0x13feda(0x1e1),_0xdac5[_0x13feda(0x18d)]=_0x13feda(0x165),_0xdac5[_0x13feda(0x17d)]=_0x13feda(0x1fe);const _0x25e9ea=_0x67586f['includes'](_0x13feda(0x1b4))?_0x13feda(0x1de):'ðŸ“¹\x20Processing\x20video...';_0xdac5[_0x13feda(0x1cf)](_0x25e9ea,_0x5d80e8[_0x13feda(0x1e6)]/0x2,_0x5d80e8[_0x13feda(0x1ad)]/0x2),_0xdac5[_0x13feda(0x1a7)]=_0x13feda(0x1f1),_0xdac5[_0x13feda(0x18d)]=_0x13feda(0x1ec),_0xdac5[_0x13feda(0x1cf)]('Topic:\x20'+_0x67586f['split']('/')[_0x13feda(0x15c)](),_0x5d80e8['width']/0x2,_0x5d80e8[_0x13feda(0x1ad)]/0x2+0x19),this[_0x13feda(0x207)](_0x551ab8,_0x5d80e8);}}[a6_0x7f209(0x184)](_0x4c52bc){const _0x162769=a6_0x7f209,_0x172405=this[_0x162769(0x189)]['get'](_0x4c52bc);if(!_0x172405){console[_0x162769(0x1cb)](_0x162769(0x1ff)+_0x4c52bc);return;}console[_0x162769(0x18c)](_0x162769(0x202)+_0x4c52bc+_0x162769(0x148)+_0x172405['topic']);try{this['serverWs']&&this[_0x162769(0x147)][_0x162769(0x1d2)]===this[_0x162769(0x147)]['OPEN']&&this[_0x162769(0x147)][_0x162769(0x1a0)](JSON[_0x162769(0x168)]({'op':_0x162769(0x1c4),'session_id':_0x4c52bc})),_0x172405[_0x162769(0x1c0)]&&_0x172405[_0x162769(0x1c0)]['stop'](),_0x172405[_0x162769(0x182)]&&_0x172405[_0x162769(0x182)][_0x162769(0x1e0)]();}catch(_0x3e5cad){console[_0x162769(0x1ab)](_0x162769(0x1aa)+_0x3e5cad);}this['cleanupSession'](_0x4c52bc);}[a6_0x7f209(0x1f3)](_0x5522c6){const _0x2969b8=a6_0x7f209,_0x44a885=this[_0x2969b8(0x189)][_0x2969b8(0x14b)](_0x5522c6);if(_0x44a885){const _0x3c2245=this[_0x2969b8(0x1c2)][_0x2969b8(0x14b)](_0x44a885['topic']);_0x3c2245&&(_0x3c2245['delete'](_0x5522c6),_0x3c2245[_0x2969b8(0x1b2)]===0x0&&this[_0x2969b8(0x1c2)][_0x2969b8(0x1d3)](_0x44a885[_0x2969b8(0x16b)])),this['releaseSharedVideoSource'](_0x44a885['topic']);}this[_0x2969b8(0x189)]['delete'](_0x5522c6),console[_0x2969b8(0x18c)]('[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20'+_0x5522c6);}[a6_0x7f209(0x159)](){const _0x715358=a6_0x7f209;console[_0x715358(0x18c)](_0x715358(0x15e));const _0x555992=Array[_0x715358(0x1c6)](this['activeSessions']['keys']());_0x555992['forEach'](_0x275ea1=>this[_0x715358(0x184)](_0x275ea1));}[a6_0x7f209(0x1b6)](){const _0x8b32f4=a6_0x7f209,_0xa5a3c7=[];for(const [_0x109212,_0x5bad13]of this[_0x8b32f4(0x189)]){_0xa5a3c7[_0x8b32f4(0x1a6)]({'sessionId':_0x109212,'topic':_0x5bad13['topic'],'connectionState':_0x5bad13['peerConnection']?.[_0x8b32f4(0x185)]||_0x8b32f4(0x170),'hasVideoTrack':!!_0x5bad13[_0x8b32f4(0x1c0)]});}return _0xa5a3c7;}['getSharedVideoSources'](){const _0x58ae72=a6_0x7f209,_0x43bfd6=[];for(const [_0x5a378e,_0x55a462]of this['sharedVideoSources']){_0x43bfd6['push']({'topic':_0x5a378e,'frameCount':_0x55a462[_0x58ae72(0x19f)],'hasVideoSource':!!_0x55a462[_0x58ae72(0x1bb)],'hasRosSubscriber':!!_0x55a462[_0x58ae72(0x187)]});}return _0x43bfd6;}}module[a6_0x7f209(0x1f6)]=new ApplianceWebRTCService();