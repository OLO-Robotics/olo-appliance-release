const a6_0x5a6b46=a6_0x5d90;function a6_0x3596(){const _0x40e8b3=['getIceServers','ðŸ¤–\x20Robot\x20Camera','10px\x20monospace','stopSession','exports','constructor','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','onFrame','updateTurnCredentials','parse','774688tCUfTa','candidate','sendFrameToVideoSource','561LElLId','../config','initializing','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','stun:stun1.l.google.com:19302','isDepthTopic','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','setLocalDescription','subscribe','get','compressedDepth','createAnswer','port','length','stopAllSessions','Waiting\x20for\x20ROS\x20image\x20data...','toString','closed','9fRDZzR','handleIceCandidate','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20',',\x20size:\x20','depth','webrtc_init_session','split','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','canvas','compressed','#00ffff','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','webrtc_ice_candidate','ðŸ”\x20Depth','close','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','fill','OPEN','fillStyle','getContext','connectionState','sharedVideoSources','putImageData','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','\x20bytes','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','pop','24px\x20Arial','ðŸ“¹\x20Processing\x20video...','min','videoTrack','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','37575DGZkXV','getActiveSessions','size','delete','from','base64','rosbridgeWs','updateCanvasWithImageData','data','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','function','readyState','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','push','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','sensor_msgs/CompressedImage','set','startsWith','16px\x20Arial','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','now','send','keys','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','address','serverUrl','videoSource','processColorImage','initialize','addTrack','error','sensor_msgs/msg/CompressedImage','./turnCredentialsService','session_id','#00ff00','ðŸ“¹\x20Color','stringify','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','295054dwMOpi','\x20connection\x20state:\x20','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','stop','depthProcessor','webrtc_offer','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','\x20for\x20topic\x20','sensor_msgs/Image','[WebRTC\x20Appliance]\x20Session\x20','serverWs','/image_raw','sharp','webrtc','#1a1a1a','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','search','onicecandidate','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','warn','63770QqyxxJ','textAlign','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','log','webrtc_answer','addIceCandidate','round','rtcConfig','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','random','releaseSharedVideoSource','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','fillRect','#00aaff','message','\x20connection\x20failed,\x20stopping\x20session','connected','framerate','activeSessions','\x20sessions\x20remaining)','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','includes','handleOffer','12px\x20monospace','[WebRTC\x20Appliance]\x20Created\x20answer','has','630870ZZuLWc','arc','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','forEach','peerConnection','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','\x20image,\x20trying\x20message\x20types:','type','video','publish','failed','fillText','rosSubscriber','webrtc_stop_session','frameCount','getOrCreateSharedVideoSource','\x20connection\x20closed,\x20cleaning\x20up','color','/compressedDepth','handleMessage','#888','668160yMLmtf','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','6xnqBob','font','iceServers','(((.+)+)+)+$','getSharedVideoSources','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','1XufSoR','addEventListener','\x20with\x20message\x20type\x20','initializeSession','Topic:\x20','width','beginPath','processDepthImage','replace','convertRGBAtoI420','height','unsubscribe','drawLoadingPattern','topicSessions','subscribeToROSTopic','offer','\x20sessions)',',\x20converting\x20to\x20base64...','1145487WeiKnS','\x20for\x20topic:\x20','topic','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','msg','cleanupSession','/image','#ffffff','max'];a6_0x3596=function(){return _0x40e8b3;};return a6_0x3596();}(function(_0x2d1cb8,_0x55f262){const _0x55c1d2=a6_0x5d90,_0x1e1413=_0x2d1cb8();while(!![]){try{const _0x4ba960=parseInt(_0x55c1d2(0x125))/0x1*(parseInt(_0x55c1d2(0xd9))/0x2)+-parseInt(_0x55c1d2(0x180))/0x3+-parseInt(_0x55c1d2(0x11d))/0x4+-parseInt(_0x55c1d2(0x108))/0x5+-parseInt(_0x55c1d2(0x11f))/0x6*(parseInt(_0x55c1d2(0x137))/0x7)+-parseInt(_0x55c1d2(0x14a))/0x8*(-parseInt(_0x55c1d2(0x15f))/0x9)+-parseInt(_0x55c1d2(0xee))/0xa*(-parseInt(_0x55c1d2(0x14d))/0xb);if(_0x4ba960===_0x55f262)break;else _0x1e1413['push'](_0x1e1413['shift']());}catch(_0x4bf69f){_0x1e1413['push'](_0x1e1413['shift']());}}}(a6_0x3596,0x18772));const a6_0x313419=(function(){let _0xf9c00a=!![];return function(_0x109768,_0x17efa2){const _0x561cdf=_0xf9c00a?function(){if(_0x17efa2){const _0x24d87d=_0x17efa2['apply'](_0x109768,arguments);return _0x17efa2=null,_0x24d87d;}}:function(){};return _0xf9c00a=![],_0x561cdf;};}()),a6_0x2c7355=a6_0x313419(this,function(){const _0x758188=a6_0x5d90;return a6_0x2c7355[_0x758188(0x15d)]()[_0x758188(0xea)](_0x758188(0x122))[_0x758188(0x15d)]()[_0x758188(0x145)](a6_0x2c7355)[_0x758188(0xea)](_0x758188(0x122));});a6_0x2c7355();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require('wrtc'),sharp=require(a6_0x5a6b46(0xe6)),config=require(a6_0x5a6b46(0x14e)),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require(a6_0x5a6b46(0xd3));function a6_0x5d90(_0x31ddc0,_0x3b675){const _0xdff00=a6_0x3596();return a6_0x5d90=function(_0x2c7355,_0x313419){_0x2c7355=_0x2c7355-0xcd;let _0x3596a6=_0xdff00[_0x2c7355];return _0x3596a6;},a6_0x5d90(_0x31ddc0,_0x3b675);}class ApplianceWebRTCService{constructor(){const _0x34483c=a6_0x5a6b46;this[_0x34483c(0x100)]=new Map(),this[_0x34483c(0x132)]=new Map(),this['sharedVideoSources']=new Map(),this['rosbridgeWs']=null,this['serverWs']=null,this[_0x34483c(0xde)]=new DepthImageProcessor(),this[_0x34483c(0xf5)]={'iceServers':[{'urls':'stun:stun.l.google.com:19302'},{'urls':_0x34483c(0x151)}]};}[a6_0x5a6b46(0xcf)](_0x2fe371,_0x22b0e2){const _0x46ebf7=a6_0x5a6b46;this[_0x46ebf7(0x186)]=_0x2fe371,this['serverWs']=_0x22b0e2,turnCredentialsService[_0x46ebf7(0xcf)](config[_0x46ebf7(0x199)]),this[_0x46ebf7(0x148)](),console['log']('[WebRTC\x20Appliance]\x20Service\x20initialized');}async[a6_0x5a6b46(0x148)](){const _0x513034=a6_0x5a6b46;try{console[_0x513034(0xf1)](_0x513034(0x102));const _0x5d6e60=await turnCredentialsService[_0x513034(0x140)]();this['rtcConfig'][_0x513034(0x121)]=_0x5d6e60,console[_0x513034(0xf1)](_0x513034(0xec));}catch(_0x396702){console[_0x513034(0xd1)](_0x513034(0x10a),_0x396702),console[_0x513034(0xf1)]('[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers');}}[a6_0x5a6b46(0x11b)](_0x50c0d6){const _0x4baaab=a6_0x5a6b46;if(!_0x50c0d6['op']||!_0x50c0d6['op'][_0x4baaab(0x191)]('webrtc_'))return![];console[_0x4baaab(0xf1)](_0x4baaab(0x10d)+_0x50c0d6['op']);switch(_0x50c0d6['op']){case _0x4baaab(0x164):this[_0x4baaab(0x128)](_0x50c0d6['session_id'],_0x50c0d6[_0x4baaab(0x139)]);return!![];case _0x4baaab(0xdf):this[_0x4baaab(0x104)](_0x50c0d6[_0x4baaab(0xd4)],_0x50c0d6[_0x4baaab(0x134)]);return!![];case _0x4baaab(0x16b):this['handleIceCandidate'](_0x50c0d6['session_id'],_0x50c0d6['candidate']);return!![];case'webrtc_stop_session':this[_0x4baaab(0x143)](_0x50c0d6[_0x4baaab(0xd4)]);return!![];default:console['warn']('[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20'+_0x50c0d6['op']);return![];}}[a6_0x5a6b46(0x117)](_0x2bd1d4){const _0xba4c0c=a6_0x5a6b46;if(this[_0xba4c0c(0x175)][_0xba4c0c(0x107)](_0x2bd1d4)){const _0x53cba9=this[_0xba4c0c(0x175)][_0xba4c0c(0x156)](_0x2bd1d4);return _0x53cba9[_0xba4c0c(0x116)]++,console[_0xba4c0c(0xf1)](_0xba4c0c(0x18c)+_0x2bd1d4+'\x20('+_0x53cba9[_0xba4c0c(0x116)]+_0xba4c0c(0x135)),_0x53cba9;}console[_0xba4c0c(0xf1)](_0xba4c0c(0xe9)+_0x2bd1d4);const {createCanvas:_0x4dbd57}=require(_0xba4c0c(0x167)),_0x2232bb=_0x4dbd57(config['webrtc']['video'][_0xba4c0c(0x12a)],config['webrtc'][_0xba4c0c(0x110)][_0xba4c0c(0x12f)]),_0x3dc4c7=_0x2232bb[_0xba4c0c(0x173)]('2d');this[_0xba4c0c(0x131)](_0x2232bb,_0x3dc4c7);const {RTCVideoSource:_0x4cdd25}=nonstandard,_0x59758b=new _0x4cdd25();let _0x275aa7=0x0;const _0x6f4f43=0x3e8/config[_0xba4c0c(0xe7)][_0xba4c0c(0x110)][_0xba4c0c(0xff)],_0x52c4a7=this['subscribeToROSTopic'](_0x2bd1d4,_0x779a29=>{const _0x9cffe7=Date['now']();_0x9cffe7-_0x275aa7>=_0x6f4f43&&(_0x275aa7=_0x9cffe7,this['updateCanvasWithImageData'](_0x2232bb,_0x3dc4c7,_0x779a29,_0x2bd1d4,_0x59758b));}),_0x3718a5={'videoSource':_0x59758b,'canvas':_0x2232bb,'rosSubscriber':_0x52c4a7,'frameCount':0x1,'topic':_0x2bd1d4};return this['sharedVideoSources'][_0xba4c0c(0x190)](_0x2bd1d4,_0x3718a5),_0x3718a5;}[a6_0x5a6b46(0xf8)](_0x5ccb99){const _0x11b40a=a6_0x5a6b46,_0x11dc74=this[_0x11b40a(0x175)]['get'](_0x5ccb99);if(!_0x11dc74)return;_0x11dc74['frameCount']--,console[_0x11b40a(0xf1)](_0x11b40a(0x16f)+_0x5ccb99+'\x20('+_0x11dc74['frameCount']+_0x11b40a(0x101)),_0x11dc74[_0x11b40a(0x116)]<=0x0&&(console[_0x11b40a(0xf1)]('[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20'+_0x5ccb99+',\x20cleaning\x20up\x20shared\x20resources'),_0x11dc74[_0x11b40a(0xcd)]&&(_0x11dc74[_0x11b40a(0xcd)]=null),_0x11dc74['rosSubscriber']&&_0x11dc74['rosSubscriber'][_0x11b40a(0x130)](),this['sharedVideoSources']['delete'](_0x5ccb99));}async['initializeSession'](_0x5cf25a,_0x3a575a){const _0xa93a21=a6_0x5a6b46;try{console[_0xa93a21(0xf1)]('[WebRTC\x20Appliance]\x20Initializing\x20session\x20'+_0x5cf25a+_0xa93a21(0xe1)+_0x3a575a);const _0x1c8c8f=this[_0xa93a21(0x117)](_0x3a575a),_0x9da621=new RTCPeerConnection(this['rtcConfig']),_0x1e99c7=_0x1c8c8f[_0xa93a21(0xcd)]['createTrack']({'width':config[_0xa93a21(0xe7)][_0xa93a21(0x110)][_0xa93a21(0x12a)],'height':config[_0xa93a21(0xe7)]['video'][_0xa93a21(0x12f)],'framerate':config[_0xa93a21(0xe7)][_0xa93a21(0x110)][_0xa93a21(0xff)]});console[_0xa93a21(0xf1)](_0xa93a21(0x179)+_0x5cf25a);const {MediaStream:_0x58ee96}=require('wrtc'),_0x19a221=new _0x58ee96([_0x1e99c7]);_0x9da621[_0xa93a21(0xd0)](_0x1e99c7,_0x19a221),this[_0xa93a21(0x14c)](_0x1c8c8f[_0xa93a21(0xcd)],_0x1c8c8f['canvas']),_0x9da621[_0xa93a21(0xeb)]=_0x511a54=>{const _0x2075c5=_0xa93a21;if(_0x511a54[_0x2075c5(0x14b)]&&this[_0x2075c5(0xe4)])console[_0x2075c5(0xf1)](_0x2075c5(0x150)+_0x5cf25a+':',{'type':_0x511a54[_0x2075c5(0x14b)][_0x2075c5(0x10f)],'protocol':_0x511a54[_0x2075c5(0x14b)]['protocol'],'address':_0x511a54['candidate'][_0x2075c5(0x198)],'port':_0x511a54[_0x2075c5(0x14b)][_0x2075c5(0x159)]}),this[_0x2075c5(0xe4)]['send'](JSON['stringify']({'op':_0x2075c5(0x16b),'session_id':_0x5cf25a,'candidate':_0x511a54[_0x2075c5(0x14b)]}));else!_0x511a54[_0x2075c5(0x14b)]&&console[_0x2075c5(0xf1)](_0x2075c5(0xd8)+_0x5cf25a);},_0x9da621['onconnectionstatechange']=()=>{const _0x21e692=_0xa93a21;console['log'](_0x21e692(0xe3)+_0x5cf25a+_0x21e692(0xda)+_0x9da621[_0x21e692(0x174)]);if(_0x9da621[_0x21e692(0x174)]===_0x21e692(0xfe))console[_0x21e692(0xf1)](_0x21e692(0xe3)+_0x5cf25a+'\x20successfully\x20connected!');else{if(_0x9da621[_0x21e692(0x174)]===_0x21e692(0x112))console['log'](_0x21e692(0xe3)+_0x5cf25a+_0x21e692(0xfd)),this[_0x21e692(0x143)](_0x5cf25a);else _0x9da621[_0x21e692(0x174)]===_0x21e692(0x15e)&&(console[_0x21e692(0xf1)](_0x21e692(0xe3)+_0x5cf25a+_0x21e692(0x118)),this[_0x21e692(0x13c)](_0x5cf25a));}},this['activeSessions'][_0xa93a21(0x190)](_0x5cf25a,{'peerConnection':_0x9da621,'topic':_0x3a575a,'videoTrack':_0x1e99c7,'mediaStream':_0x19a221,'status':_0xa93a21(0x14f)}),!this['topicSessions']['has'](_0x3a575a)&&this[_0xa93a21(0x132)][_0xa93a21(0x190)](_0x3a575a,new Set()),this[_0xa93a21(0x132)][_0xa93a21(0x156)](_0x3a575a)['add'](_0x5cf25a),console[_0xa93a21(0xf1)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x5cf25a+'\x20initialized\x20successfully'),console[_0xa93a21(0xf1)](_0xa93a21(0x193)+_0x3a575a+':\x20'+this[_0xa93a21(0x132)][_0xa93a21(0x156)](_0x3a575a)[_0xa93a21(0x182)]);}catch(_0x44dc98){console[_0xa93a21(0xd1)]('[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20'+_0x5cf25a+':',_0x44dc98),this['stopSession'](_0x5cf25a);}}async[a6_0x5a6b46(0x104)](_0x1922db,_0x4f8727){const _0x13fb6f=a6_0x5a6b46,_0x53a4d7=this['activeSessions'][_0x13fb6f(0x156)](_0x1922db);if(!_0x53a4d7){console[_0x13fb6f(0xd1)](_0x13fb6f(0xf9)+_0x1922db);return;}try{console[_0x13fb6f(0xf1)](_0x13fb6f(0xe0)+_0x1922db),await _0x53a4d7['peerConnection']['setRemoteDescription'](new RTCSessionDescription(_0x4f8727)),console[_0x13fb6f(0xf1)]('[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)');const _0x18d013=await _0x53a4d7[_0x13fb6f(0x10c)][_0x13fb6f(0x158)]();console['log'](_0x13fb6f(0x106)),await _0x53a4d7[_0x13fb6f(0x10c)][_0x13fb6f(0x154)](_0x18d013),console[_0x13fb6f(0xf1)](_0x13fb6f(0x18e)),this['serverWs']&&(this[_0x13fb6f(0xe4)][_0x13fb6f(0x195)](JSON['stringify']({'op':_0x13fb6f(0xf2),'session_id':_0x1922db,'answer':_0x18d013})),console[_0x13fb6f(0xf1)](_0x13fb6f(0xdc)+_0x1922db));}catch(_0x59c3d){console[_0x13fb6f(0xd1)](_0x13fb6f(0x161)+_0x1922db+':',_0x59c3d),this[_0x13fb6f(0x143)](_0x1922db);}}async[a6_0x5a6b46(0x160)](_0x160d12,_0x32805e){const _0x54145e=a6_0x5a6b46,_0x5647b3=this[_0x54145e(0x100)]['get'](_0x160d12);if(!_0x5647b3){console[_0x54145e(0xd1)](_0x54145e(0x197)+_0x160d12);return;}try{await _0x5647b3['peerConnection'][_0x54145e(0xf3)](new RTCIceCandidate(_0x32805e)),console['log'](_0x54145e(0x146)+_0x160d12);}catch(_0x4a1cf6){console[_0x54145e(0xd1)](_0x54145e(0x177)+_0x160d12+':',_0x4a1cf6);}}[a6_0x5a6b46(0x133)](_0x501082,_0x4efe03){const _0x1f8745=a6_0x5a6b46;if(!this[_0x1f8745(0x186)]||this['rosbridgeWs'][_0x1f8745(0x18b)]!==this['rosbridgeWs'][_0x1f8745(0x171)])return console['error']('[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected'),null;console[_0x1f8745(0xf1)]('[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20'+_0x501082);const _0x327346=_0x501082[_0x1f8745(0x103)]('depth'),_0x36009e=_0x501082['includes'](_0x1f8745(0x168))||_0x501082[_0x1f8745(0x103)](_0x1f8745(0x157));let _0x3bb7db=[];_0x327346?_0x36009e?_0x3bb7db=['sensor_msgs/CompressedImage',_0x1f8745(0xd2),'compressed_depth_image_transport/CompressedDepthImage',_0x1f8745(0xe2)]:_0x3bb7db=['sensor_msgs/Image','sensor_msgs/msg/Image',_0x1f8745(0x18f)]:_0x3bb7db=[_0x1f8745(0x18f),_0x1f8745(0xd2),_0x1f8745(0xe2)];console['log']('[WebRTC\x20Appliance]\x20Topic\x20'+_0x501082+'\x20detected\x20as\x20'+(_0x327346?'depth':_0x1f8745(0x119))+_0x1f8745(0x10e),_0x3bb7db);const _0x3d715e=[];let _0x3f9a0d=![];const _0x4fecdf=_0x133082=>{return _0x521dd6=>{const _0x2d3036=a6_0x5d90;try{const _0x2717b0=JSON['parse'](_0x521dd6[_0x2d3036(0x188)]);_0x2717b0['op']===_0x2d3036(0x111)&&_0x2717b0['topic']===_0x501082&&_0x2717b0['msg']&&(!_0x3f9a0d&&(console[_0x2d3036(0xf1)](_0x2d3036(0x13a)+_0x501082+_0x2d3036(0x127)+_0x133082),_0x3f9a0d=!![]),_0x4efe03(_0x2717b0[_0x2d3036(0x13b)]));}catch(_0x568704){console[_0x2d3036(0xd1)](_0x2d3036(0x17f),_0x568704);}};};for(const _0x2f5840 of _0x3bb7db){const _0x5e8dde={'op':_0x1f8745(0x155),'topic':_0x501082,'type':_0x2f5840};console['log'](_0x1f8745(0x16e)+_0x2f5840),this[_0x1f8745(0x186)][_0x1f8745(0x195)](JSON[_0x1f8745(0xd7)](_0x5e8dde));const _0x5722b5=_0x4fecdf(_0x2f5840);this['rosbridgeWs'][_0x1f8745(0x126)]('message',_0x5722b5),_0x3d715e['push']({'handler':_0x5722b5,'type':_0x2f5840});}return _0x327346&&_0x36009e&&setTimeout(()=>{const _0x34d1c9=_0x1f8745;if(!_0x3f9a0d){console[_0x34d1c9(0xf1)](_0x34d1c9(0xdb)+_0x501082+',\x20trying\x20alternative\x20depth\x20topics');const _0x504406=_0x501082[_0x34d1c9(0x12d)](_0x34d1c9(0x11a),'')[_0x34d1c9(0x12d)]('/compressed',''),_0x40cb1c=[_0x504406+_0x34d1c9(0xe5),_0x504406+_0x34d1c9(0x13d),_0x504406];for(const _0x753205 of _0x40cb1c){console[_0x34d1c9(0xf1)](_0x34d1c9(0xf6)+_0x753205);const _0x45f4d6={'op':'subscribe','topic':_0x753205,'type':_0x34d1c9(0xe2)};this[_0x34d1c9(0x186)][_0x34d1c9(0x195)](JSON[_0x34d1c9(0xd7)](_0x45f4d6));const _0x186f66=_0x32904a=>{const _0x56e404=_0x34d1c9;try{const _0x4b5974=JSON[_0x56e404(0x149)](_0x32904a[_0x56e404(0x188)]);_0x4b5974['op']===_0x56e404(0x111)&&_0x4b5974[_0x56e404(0x139)]===_0x753205&&_0x4b5974[_0x56e404(0x13b)]&&(console[_0x56e404(0xf1)]('[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20'+_0x753205+_0x56e404(0x136)),_0x4b5974['msg']['data']&&!_0x4b5974[_0x56e404(0x13b)][_0x56e404(0x188)][_0x56e404(0x191)]('/9j/')&&_0x4efe03(_0x4b5974[_0x56e404(0x13b)]));}catch(_0x328ee8){console[_0x56e404(0xd1)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:',_0x328ee8);}};this[_0x34d1c9(0x186)]['addEventListener'](_0x34d1c9(0xfc),_0x186f66),_0x3d715e[_0x34d1c9(0x18d)]({'handler':_0x186f66,'type':'sensor_msgs/Image','topic':_0x753205});}}},0xbb8),{'unsubscribe':()=>{const _0x1ea60e=_0x1f8745;for(const {handler:_0x437f3a,type:_0x473810,topic:_0xf717f2}of _0x3d715e){this[_0x1ea60e(0x186)]['removeEventListener'](_0x1ea60e(0xfc),_0x437f3a),this[_0x1ea60e(0x186)][_0x1ea60e(0x18b)]===this['rosbridgeWs'][_0x1ea60e(0x171)]&&this['rosbridgeWs'][_0x1ea60e(0x195)](JSON['stringify']({'op':_0x1ea60e(0x130),'topic':_0xf717f2||_0x501082}));}}};}['drawLoadingPattern'](_0x326d37,_0x41c9b7){const _0x2f4d31=a6_0x5a6b46;_0x41c9b7[_0x2f4d31(0x172)]=_0x2f4d31(0xe8),_0x41c9b7['fillRect'](0x0,0x0,_0x326d37[_0x2f4d31(0x12a)],_0x326d37['height']),_0x41c9b7[_0x2f4d31(0x172)]=_0x2f4d31(0xfb),_0x41c9b7[_0x2f4d31(0x120)]=_0x2f4d31(0x17b),_0x41c9b7['textAlign']='center',_0x41c9b7['fillText'](_0x2f4d31(0x141),_0x326d37['width']/0x2,_0x326d37[_0x2f4d31(0x12f)]/0x2-0x14),_0x41c9b7[_0x2f4d31(0x172)]=_0x2f4d31(0x13e),_0x41c9b7[_0x2f4d31(0x120)]=_0x2f4d31(0x192),_0x41c9b7[_0x2f4d31(0x113)](_0x2f4d31(0x15c),_0x326d37['width']/0x2,_0x326d37[_0x2f4d31(0x12f)]/0x2+0x14);const _0x3dc0eb=Date[_0x2f4d31(0x194)]()/0x3e8;for(let _0x5048f1=0x0;_0x5048f1<0x3;_0x5048f1++){const _0x27a6de=(Math['sin'](_0x3dc0eb*0x2+_0x5048f1*0.5)+0x1)/0x2;_0x41c9b7[_0x2f4d31(0x172)]='rgba(0,\x20170,\x20255,\x20'+_0x27a6de*0.5+')',_0x41c9b7[_0x2f4d31(0x12b)](),_0x41c9b7[_0x2f4d31(0x109)](_0x326d37[_0x2f4d31(0x12a)]/0x2-0x28+_0x5048f1*0x28,_0x326d37[_0x2f4d31(0x12f)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x41c9b7[_0x2f4d31(0x170)]();}}[a6_0x5a6b46(0x14c)](_0xf2bfc6,_0x47101f){const _0x334b30=a6_0x5a6b46;try{if(!_0xf2bfc6||!_0x47101f)return;const _0x29436=_0x47101f[_0x334b30(0x173)]('2d'),_0x18ffba=_0x29436['getImageData'](0x0,0x0,_0x47101f['width'],_0x47101f[_0x334b30(0x12f)]),_0x864f57=this[_0x334b30(0x12e)](_0x18ffba['data'],_0x47101f['width'],_0x47101f[_0x334b30(0x12f)]),_0x38442d={'width':_0x47101f[_0x334b30(0x12a)],'height':_0x47101f['height'],'data':_0x864f57};typeof _0xf2bfc6[_0x334b30(0x147)]===_0x334b30(0x18a)&&_0xf2bfc6[_0x334b30(0x147)](_0x38442d);}catch(_0x130e11){console[_0x334b30(0xd1)](_0x334b30(0x189),_0x130e11);}}[a6_0x5a6b46(0x12e)](_0x3fefdf,_0x1dc23b,_0x15aee7){const _0x506c7f=a6_0x5a6b46,_0x57b7a5=_0x1dc23b*_0x15aee7,_0x2961f5=_0x1dc23b*_0x15aee7/0x4,_0xe558b1=new Uint8Array(_0x57b7a5+_0x2961f5*0x2);let _0x221c15=0x0,_0x2090e5=_0x57b7a5,_0x521e55=_0x57b7a5+_0x2961f5;for(let _0x4c4d2f=0x0;_0x4c4d2f<_0x15aee7;_0x4c4d2f++){for(let _0x771b8d=0x0;_0x771b8d<_0x1dc23b;_0x771b8d++){const _0x1fdc25=(_0x4c4d2f*_0x1dc23b+_0x771b8d)*0x4,_0x1c5680=_0x3fefdf[_0x1fdc25],_0x3678cd=_0x3fefdf[_0x1fdc25+0x1],_0x505558=_0x3fefdf[_0x1fdc25+0x2],_0x4f7c68=Math[_0x506c7f(0xf4)](0.299*_0x1c5680+0.587*_0x3678cd+0.114*_0x505558);_0xe558b1[_0x221c15++]=_0x4f7c68;if(_0x4c4d2f%0x2===0x0&&_0x771b8d%0x2===0x0){const _0x309a41=Math[_0x506c7f(0xf4)](-0.169*_0x1c5680-0.331*_0x3678cd+0.5*_0x505558+0x80),_0x479a0b=Math[_0x506c7f(0xf4)](0.5*_0x1c5680-0.419*_0x3678cd-0.081*_0x505558+0x80);_0xe558b1[_0x2090e5++]=Math['max'](0x0,Math['min'](0xff,_0x309a41)),_0xe558b1[_0x521e55++]=Math[_0x506c7f(0x13f)](0x0,Math[_0x506c7f(0x17d)](0xff,_0x479a0b));}}}return _0xe558b1;}async[a6_0x5a6b46(0x187)](_0x294ff5,_0x1a063e,_0x1272c1,_0xc2b396,_0x3ca73f){const _0x4191b9=a6_0x5a6b46;try{if(!_0x1272c1||!_0x1272c1[_0x4191b9(0x188)])return;Math[_0x4191b9(0xf7)]()<0.01&&console[_0x4191b9(0xf1)](_0x4191b9(0x166)+_0xc2b396+_0x4191b9(0x162)+_0x1272c1[_0x4191b9(0x188)][_0x4191b9(0x15a)]+_0x4191b9(0x178));const _0xeadba0=Buffer[_0x4191b9(0x184)](_0x1272c1[_0x4191b9(0x188)],_0x4191b9(0x185)),_0x251448=this['depthProcessor'][_0x4191b9(0x152)](_0xc2b396);let _0x53afe4;_0x251448?_0x53afe4=await this[_0x4191b9(0xde)][_0x4191b9(0x12c)](_0xeadba0,_0x294ff5,_0x1a063e,_0xc2b396):_0x53afe4=await this[_0x4191b9(0xde)][_0x4191b9(0xce)](_0xeadba0,_0x294ff5,_0x1a063e),_0x1a063e[_0x4191b9(0x176)](_0x53afe4,0x0,0x0),_0x1a063e['fillStyle']='rgba(0,\x200,\x200,\x200.7)',_0x1a063e['fillRect'](0xa,0xa,0xdc,0x32),_0x1a063e['fillStyle']=_0x251448?_0x4191b9(0x169):_0x4191b9(0xd5),_0x1a063e[_0x4191b9(0x120)]=_0x4191b9(0x105),_0x1a063e['fillText']((_0x251448?_0x4191b9(0x16c):_0x4191b9(0xd6))+':\x20'+new Date()['toLocaleTimeString'](),0xf,0x1c),_0x1a063e[_0x4191b9(0x172)]=_0x4191b9(0x13e),_0x1a063e[_0x4191b9(0x120)]=_0x4191b9(0x142),_0x1a063e[_0x4191b9(0x113)](_0x4191b9(0x129)+_0xc2b396[_0x4191b9(0x165)]('/')[_0x4191b9(0x17a)](),0xf,0x2d),this[_0x4191b9(0x14c)](_0x3ca73f,_0x294ff5);}catch(_0x1d30b3){console['warn'](_0x4191b9(0xf0)+_0xc2b396+':',_0x1d30b3[_0x4191b9(0xfc)]);_0xc2b396[_0x4191b9(0x103)](_0x4191b9(0x163))&&Math[_0x4191b9(0xf7)]()<0.1&&console[_0x4191b9(0xed)](_0x4191b9(0x153)+_0xc2b396['replace'](_0x4191b9(0x11a),_0x4191b9(0xe5)));_0x1a063e[_0x4191b9(0x172)]=_0x4191b9(0xe8),_0x1a063e[_0x4191b9(0xfa)](0x0,0x0,_0x294ff5[_0x4191b9(0x12a)],_0x294ff5[_0x4191b9(0x12f)]),_0x1a063e[_0x4191b9(0x172)]=_0x4191b9(0x11c),_0x1a063e[_0x4191b9(0x120)]=_0x4191b9(0x192),_0x1a063e[_0x4191b9(0xef)]='center';const _0x5ec9bd=_0xc2b396['includes'](_0x4191b9(0x163))?'ðŸ”\x20Processing\x20depth...':_0x4191b9(0x17c);_0x1a063e[_0x4191b9(0x113)](_0x5ec9bd,_0x294ff5[_0x4191b9(0x12a)]/0x2,_0x294ff5[_0x4191b9(0x12f)]/0x2),_0x1a063e['fillStyle']='#666',_0x1a063e[_0x4191b9(0x120)]='12px\x20Arial',_0x1a063e['fillText'](_0x4191b9(0x129)+_0xc2b396[_0x4191b9(0x165)]('/')[_0x4191b9(0x17a)](),_0x294ff5[_0x4191b9(0x12a)]/0x2,_0x294ff5[_0x4191b9(0x12f)]/0x2+0x19),this['sendFrameToVideoSource'](_0x3ca73f,_0x294ff5);}}[a6_0x5a6b46(0x143)](_0x32510d){const _0x17b7e1=a6_0x5a6b46,_0x4cadd9=this[_0x17b7e1(0x100)]['get'](_0x32510d);if(!_0x4cadd9){console['warn']('[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20'+_0x32510d);return;}console[_0x17b7e1(0xf1)](_0x17b7e1(0x11e)+_0x32510d+_0x17b7e1(0x138)+_0x4cadd9[_0x17b7e1(0x139)]);try{this[_0x17b7e1(0xe4)]&&this[_0x17b7e1(0xe4)]['readyState']===this[_0x17b7e1(0xe4)][_0x17b7e1(0x171)]&&this[_0x17b7e1(0xe4)][_0x17b7e1(0x195)](JSON[_0x17b7e1(0xd7)]({'op':_0x17b7e1(0x115),'session_id':_0x32510d})),_0x4cadd9[_0x17b7e1(0x17e)]&&_0x4cadd9[_0x17b7e1(0x17e)][_0x17b7e1(0xdd)](),_0x4cadd9[_0x17b7e1(0x10c)]&&_0x4cadd9[_0x17b7e1(0x10c)][_0x17b7e1(0x16d)]();}catch(_0x4e6cff){console['error']('[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20'+_0x4e6cff);}this[_0x17b7e1(0x13c)](_0x32510d);}[a6_0x5a6b46(0x13c)](_0x46cdde){const _0x54ca89=a6_0x5a6b46,_0x2f5802=this['activeSessions'][_0x54ca89(0x156)](_0x46cdde);if(_0x2f5802){const _0x3ade5a=this[_0x54ca89(0x132)][_0x54ca89(0x156)](_0x2f5802[_0x54ca89(0x139)]);_0x3ade5a&&(_0x3ade5a['delete'](_0x46cdde),_0x3ade5a[_0x54ca89(0x182)]===0x0&&this[_0x54ca89(0x132)][_0x54ca89(0x183)](_0x2f5802['topic'])),this[_0x54ca89(0xf8)](_0x2f5802['topic']);}this['activeSessions'][_0x54ca89(0x183)](_0x46cdde),console['log'](_0x54ca89(0x16a)+_0x46cdde);}[a6_0x5a6b46(0x15b)](){const _0x46dda5=a6_0x5a6b46;console[_0x46dda5(0xf1)](_0x46dda5(0x124));const _0x2a1be7=Array['from'](this[_0x46dda5(0x100)][_0x46dda5(0x196)]());_0x2a1be7[_0x46dda5(0x10b)](_0x2c2d10=>this[_0x46dda5(0x143)](_0x2c2d10));}[a6_0x5a6b46(0x181)](){const _0x344324=a6_0x5a6b46,_0x420846=[];for(const [_0x252f60,_0x31a6e8]of this[_0x344324(0x100)]){_0x420846[_0x344324(0x18d)]({'sessionId':_0x252f60,'topic':_0x31a6e8[_0x344324(0x139)],'connectionState':_0x31a6e8[_0x344324(0x10c)]?.[_0x344324(0x174)]||'unknown','hasVideoTrack':!!_0x31a6e8[_0x344324(0x17e)]});}return _0x420846;}[a6_0x5a6b46(0x123)](){const _0xa8975d=a6_0x5a6b46,_0x11f962=[];for(const [_0x3969ad,_0xd68f6]of this['sharedVideoSources']){_0x11f962[_0xa8975d(0x18d)]({'topic':_0x3969ad,'frameCount':_0xd68f6[_0xa8975d(0x116)],'hasVideoSource':!!_0xd68f6['videoSource'],'hasRosSubscriber':!!_0xd68f6[_0xa8975d(0x114)]});}return _0x11f962;}}module[a6_0x5a6b46(0x144)]=new ApplianceWebRTCService();