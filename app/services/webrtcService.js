function a9_0x4a71(){const _0x595eb3=['protocol','12px\x20Arial','replace','sensor_msgs/CompressedImage','\x20for\x20topic:\x20','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','webrtc','subscribe','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','stringify','updateTurnCredentials','sendFrameToVideoSource','sensor_msgs/Image','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','\x20connection\x20state:\x20','random','webrtc_stop_session','data','message','subscribeToROSTopic','Waiting\x20for\x20ROS\x20image\x20data...','\x20sessions\x20remaining)','stopSession','now','processColorImage','rtcConfig','[WebRTC\x20Appliance]\x20Created\x20answer','createTrack','split','🔍\x20Depth',',\x20cleaning\x20up\x20shared\x20resources','onicecandidate','updateCanvasWithImageData','parse','max','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','onconnectionstatechange','addTrack','log','sharedVideoSources','webrtc_','sharp','(((.+)+)+)+$','Topic:\x20','\x20bytes','forEach','session_id','webrtc_offer','handleIceCandidate','wrtc','warn','\x20with\x20message\x20type\x20','round','depth','[WebRTC\x20Appliance]\x20Service\x20initialized','./turnCredentialsService','unsubscribe','topic','initialize','fillText','length','toString','#1a1a1a','size','16px\x20Arial','fillRect','\x20connection\x20failed,\x20stopping\x20session','getIceServers','framerate','108586OwmOKD','offer','sin','from','sensor_msgs/msg/CompressedImage','set','#666','7091973ToccMq','456lvlkhT','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','getOrCreateSharedVideoSource','includes','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','topicSessions','./DepthImageProcessor','3704PMRMTQ','1025540vvsCLK','depthProcessor','stun:stun.l.google.com:19302','getContext','#00ffff','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','2596288GPCYxg','search','[WebRTC\x20Appliance]\x20Session\x20','addEventListener','add','error','/compressedDepth','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','\x20image,\x20trying\x20message\x20types:','🤖\x20Robot\x20Camera','fillStyle','fill','/image','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','canvas','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','readyState','processDepthImage','unknown','center','/compressed','#00aaff','handleMessage',',\x20converting\x20to\x20base64...','push','97167aGHBzB','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','\x20initialized\x20successfully','getSharedVideoSources','\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','width','drawLoadingPattern','/image_raw','base64',',\x20trying\x20alternative\x20depth\x20topics','\x20connection\x20closed,\x20cleaning\x20up','videoTrack','24px\x20Arial','arc','10px\x20monospace','initializeSession','height','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','rosbridgeWs','123330WbdFes','putImageData','candidate','send','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','font','closed','webrtc_answer','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','connectionState','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','2WcRFYc','video','rosSubscriber','port','compressed_depth_image_transport/CompressedDepthImage','webrtc_ice_candidate','getActiveSessions','removeEventListener','pop','apply','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','textAlign','peerConnection','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','videoSource','frameCount','get','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','stopAllSessions','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','createAnswer','function','onFrame','activeSessions','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','connected','serverWs','cleanupSession','keys','releaseSharedVideoSource','#ffffff','getImageData','delete','OPEN','msg','12px\x20monospace','convertRGBAtoI420','min','iceServers','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','#888','beginPath','/9j/','setRemoteDescription'];a9_0x4a71=function(){return _0x595eb3;};return a9_0x4a71();}const a9_0x5f0d25=a9_0x23ef;(function(_0x208db5,_0x589023){const _0x166fe9=a9_0x23ef,_0x1f6bdf=_0x208db5();while(!![]){try{const _0x3d3fd7=-parseInt(_0x166fe9(0x165))/0x1*(-parseInt(_0x166fe9(0x1b8))/0x2)+parseInt(_0x166fe9(0x16d))/0x3*(-parseInt(_0x166fe9(0x175))/0x4)+-parseInt(_0x166fe9(0x176))/0x5+parseInt(_0x166fe9(0x1ad))/0x6+-parseInt(_0x166fe9(0x199))/0x7+-parseInt(_0x166fe9(0x17d))/0x8+parseInt(_0x166fe9(0x16c))/0x9;if(_0x3d3fd7===_0x589023)break;else _0x1f6bdf['push'](_0x1f6bdf['shift']());}catch(_0x90f732){_0x1f6bdf['push'](_0x1f6bdf['shift']());}}}(a9_0x4a71,0x38d9d));const a9_0x149922=(function(){let _0x3c64b0=!![];return function(_0x9b661a,_0x22d45a){const _0x3a893a=_0x3c64b0?function(){const _0xf0b4dc=a9_0x23ef;if(_0x22d45a){const _0x485bb8=_0x22d45a[_0xf0b4dc(0x1c1)](_0x9b661a,arguments);return _0x22d45a=null,_0x485bb8;}}:function(){};return _0x3c64b0=![],_0x3a893a;};}()),a9_0x167179=a9_0x149922(this,function(){const _0x22b873=a9_0x23ef;return a9_0x167179[_0x22b873(0x15d)]()[_0x22b873(0x17e)](_0x22b873(0x14a))[_0x22b873(0x15d)]()['constructor'](a9_0x167179)[_0x22b873(0x17e)](_0x22b873(0x14a));});a9_0x167179();function a9_0x23ef(_0x289168,_0x3b76ab){const _0x57e2e0=a9_0x4a71();return a9_0x23ef=function(_0x167179,_0x149922){_0x167179=_0x167179-0x138;let _0x4a7138=_0x57e2e0[_0x167179];return _0x4a7138;},a9_0x23ef(_0x289168,_0x3b76ab);}const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a9_0x5f0d25(0x151)),sharp=require(a9_0x5f0d25(0x149)),config=require('../config'),DepthImageProcessor=require(a9_0x5f0d25(0x174)),turnCredentialsService=require(a9_0x5f0d25(0x157));class ApplianceWebRTCService{constructor(){const _0x34d4b7=a9_0x5f0d25;this[_0x34d4b7(0x1cf)]=new Map(),this[_0x34d4b7(0x173)]=new Map(),this[_0x34d4b7(0x147)]=new Map(),this[_0x34d4b7(0x1ac)]=null,this['serverWs']=null,this[_0x34d4b7(0x177)]=new DepthImageProcessor(),this[_0x34d4b7(0x139)]={'iceServers':[{'urls':_0x34d4b7(0x178)},{'urls':'stun:stun1.l.google.com:19302'}]};}[a9_0x5f0d25(0x15a)](_0x3e6e12,_0x51b8fb){const _0x443ae0=a9_0x5f0d25;this[_0x443ae0(0x1ac)]=_0x3e6e12,this[_0x443ae0(0x1d2)]=_0x51b8fb,turnCredentialsService[_0x443ae0(0x15a)](config['serverUrl']),this[_0x443ae0(0x1f1)](),console['log'](_0x443ae0(0x156));}async[a9_0x5f0d25(0x1f1)](){const _0x2ab1e6=a9_0x5f0d25;try{console[_0x2ab1e6(0x146)](_0x2ab1e6(0x1df));const _0x508a84=await turnCredentialsService[_0x2ab1e6(0x163)]();this[_0x2ab1e6(0x139)][_0x2ab1e6(0x1de)]=_0x508a84,console[_0x2ab1e6(0x146)](_0x2ab1e6(0x17b));}catch(_0x35a905){console['error'](_0x2ab1e6(0x1c9),_0x35a905),console[_0x2ab1e6(0x146)](_0x2ab1e6(0x1e0));}}[a9_0x5f0d25(0x196)](_0x5e6dac){const _0x5d9643=a9_0x5f0d25;if(!_0x5e6dac['op']||!_0x5e6dac['op']['startsWith'](_0x5d9643(0x148)))return![];console[_0x5d9643(0x146)]('[WebRTC\x20Appliance]\x20Handling\x20message:\x20'+_0x5e6dac['op']);switch(_0x5e6dac['op']){case'webrtc_init_session':this[_0x5d9643(0x1a9)](_0x5e6dac['session_id'],_0x5e6dac[_0x5d9643(0x159)]);return!![];case _0x5d9643(0x14f):this['handleOffer'](_0x5e6dac[_0x5d9643(0x14e)],_0x5e6dac[_0x5d9643(0x166)]);return!![];case _0x5d9643(0x1bd):this['handleIceCandidate'](_0x5e6dac[_0x5d9643(0x14e)],_0x5e6dac['candidate']);return!![];case _0x5d9643(0x1f7):this[_0x5d9643(0x1fd)](_0x5e6dac[_0x5d9643(0x14e)]);return!![];default:console[_0x5d9643(0x152)]('[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20'+_0x5e6dac['op']);return![];}}[a9_0x5f0d25(0x16f)](_0xc90d9c){const _0x3ec68a=a9_0x5f0d25;if(this['sharedVideoSources']['has'](_0xc90d9c)){const _0x1c65e1=this[_0x3ec68a(0x147)][_0x3ec68a(0x1c8)](_0xc90d9c);return _0x1c65e1[_0x3ec68a(0x1c7)]++,console[_0x3ec68a(0x146)]('[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20'+_0xc90d9c+'\x20('+_0x1c65e1['frameCount']+'\x20sessions)'),_0x1c65e1;}console['log']('[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'+_0xc90d9c);const {createCanvas:_0x5c21ba}=require('canvas'),_0x33ef3c=_0x5c21ba(config[_0x3ec68a(0x1ec)][_0x3ec68a(0x1b9)][_0x3ec68a(0x19f)],config['webrtc']['video'][_0x3ec68a(0x1aa)]),_0x48b200=_0x33ef3c[_0x3ec68a(0x179)]('2d');this[_0x3ec68a(0x1a0)](_0x33ef3c,_0x48b200);const {RTCVideoSource:_0x559ed4}=nonstandard,_0x33efdd=new _0x559ed4();let _0x4e294f=0x0;const _0x1dd207=0x3e8/config['webrtc'][_0x3ec68a(0x1b9)][_0x3ec68a(0x164)],_0x32d0a5=this[_0x3ec68a(0x1fa)](_0xc90d9c,_0x5295d5=>{const _0x4b5b2b=_0x3ec68a,_0x3cd7ff=Date[_0x4b5b2b(0x1fe)]();_0x3cd7ff-_0x4e294f>=_0x1dd207&&(_0x4e294f=_0x3cd7ff,this[_0x4b5b2b(0x140)](_0x33ef3c,_0x48b200,_0x5295d5,_0xc90d9c,_0x33efdd));}),_0x48aa9d={'videoSource':_0x33efdd,'canvas':_0x33ef3c,'rosSubscriber':_0x32d0a5,'frameCount':0x1,'topic':_0xc90d9c};return this['sharedVideoSources']['set'](_0xc90d9c,_0x48aa9d),_0x48aa9d;}[a9_0x5f0d25(0x1d5)](_0x22f596){const _0x32339a=a9_0x5f0d25,_0x3f2687=this[_0x32339a(0x147)]['get'](_0x22f596);if(!_0x3f2687)return;_0x3f2687[_0x32339a(0x1c7)]--,console[_0x32339a(0x146)](_0x32339a(0x19e)+_0x22f596+'\x20('+_0x3f2687[_0x32339a(0x1c7)]+_0x32339a(0x1fc)),_0x3f2687[_0x32339a(0x1c7)]<=0x0&&(console[_0x32339a(0x146)](_0x32339a(0x184)+_0x22f596+_0x32339a(0x13e)),_0x3f2687[_0x32339a(0x1c6)]&&(_0x3f2687[_0x32339a(0x1c6)]=null),_0x3f2687[_0x32339a(0x1ba)]&&_0x3f2687[_0x32339a(0x1ba)]['unsubscribe'](),this['sharedVideoSources'][_0x32339a(0x1d8)](_0x22f596));}async[a9_0x5f0d25(0x1a9)](_0x2a1c01,_0x5b9563){const _0xff31d6=a9_0x5f0d25;try{console[_0xff31d6(0x146)](_0xff31d6(0x1c2)+_0x2a1c01+_0xff31d6(0x19d)+_0x5b9563);const _0x48aba2=this[_0xff31d6(0x16f)](_0x5b9563),_0x3bb16d=new RTCPeerConnection(this[_0xff31d6(0x139)]),_0x354c61=_0x48aba2[_0xff31d6(0x1c6)][_0xff31d6(0x13b)]({'width':config[_0xff31d6(0x1ec)][_0xff31d6(0x1b9)][_0xff31d6(0x19f)],'height':config[_0xff31d6(0x1ec)][_0xff31d6(0x1b9)]['height'],'framerate':config[_0xff31d6(0x1ec)][_0xff31d6(0x1b9)][_0xff31d6(0x164)]});console[_0xff31d6(0x146)](_0xff31d6(0x1c5)+_0x2a1c01);const {MediaStream:_0x43d374}=require(_0xff31d6(0x151)),_0x180e1b=new _0x43d374([_0x354c61]);_0x3bb16d[_0xff31d6(0x145)](_0x354c61,_0x180e1b),this[_0xff31d6(0x1f2)](_0x48aba2[_0xff31d6(0x1c6)],_0x48aba2[_0xff31d6(0x18d)]),_0x3bb16d[_0xff31d6(0x13f)]=_0x4eaf7e=>{const _0x6b58c8=_0xff31d6;if(_0x4eaf7e[_0x6b58c8(0x1af)]&&this[_0x6b58c8(0x1d2)])console[_0x6b58c8(0x146)](_0x6b58c8(0x1ee)+_0x2a1c01+':',{'type':_0x4eaf7e[_0x6b58c8(0x1af)]['type'],'protocol':_0x4eaf7e[_0x6b58c8(0x1af)][_0x6b58c8(0x1e5)],'address':_0x4eaf7e[_0x6b58c8(0x1af)]['address'],'port':_0x4eaf7e['candidate'][_0x6b58c8(0x1bb)]}),this['serverWs']['send'](JSON[_0x6b58c8(0x1f0)]({'op':_0x6b58c8(0x1bd),'session_id':_0x2a1c01,'candidate':_0x4eaf7e[_0x6b58c8(0x1af)]}));else!_0x4eaf7e[_0x6b58c8(0x1af)]&&console[_0x6b58c8(0x146)](_0x6b58c8(0x1f4)+_0x2a1c01);},_0x3bb16d[_0xff31d6(0x144)]=()=>{const _0x33b4af=_0xff31d6;console[_0x33b4af(0x146)](_0x33b4af(0x17f)+_0x2a1c01+_0x33b4af(0x1f5)+_0x3bb16d['connectionState']);if(_0x3bb16d[_0x33b4af(0x1b6)]===_0x33b4af(0x1d1))console[_0x33b4af(0x146)](_0x33b4af(0x17f)+_0x2a1c01+'\x20successfully\x20connected!');else{if(_0x3bb16d[_0x33b4af(0x1b6)]==='failed')console[_0x33b4af(0x146)](_0x33b4af(0x17f)+_0x2a1c01+_0x33b4af(0x162)),this['stopSession'](_0x2a1c01);else _0x3bb16d[_0x33b4af(0x1b6)]===_0x33b4af(0x1b3)&&(console['log'](_0x33b4af(0x17f)+_0x2a1c01+_0x33b4af(0x1a4)),this[_0x33b4af(0x1d3)](_0x2a1c01));}},this[_0xff31d6(0x1cf)][_0xff31d6(0x16a)](_0x2a1c01,{'peerConnection':_0x3bb16d,'topic':_0x5b9563,'videoTrack':_0x354c61,'mediaStream':_0x180e1b,'status':'initializing'}),!this[_0xff31d6(0x173)]['has'](_0x5b9563)&&this[_0xff31d6(0x173)]['set'](_0x5b9563,new Set()),this[_0xff31d6(0x173)][_0xff31d6(0x1c8)](_0x5b9563)[_0xff31d6(0x181)](_0x2a1c01),console['log'](_0xff31d6(0x17f)+_0x2a1c01+_0xff31d6(0x19b)),console[_0xff31d6(0x146)]('[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20'+_0x5b9563+':\x20'+this[_0xff31d6(0x173)]['get'](_0x5b9563)[_0xff31d6(0x15f)]);}catch(_0x45ea8e){console[_0xff31d6(0x182)](_0xff31d6(0x1b1)+_0x2a1c01+':',_0x45ea8e),this['stopSession'](_0x2a1c01);}}async['handleOffer'](_0x4bc7e5,_0x418768){const _0x4ac17e=a9_0x5f0d25,_0x83b90a=this[_0x4ac17e(0x1cf)][_0x4ac17e(0x1c8)](_0x4bc7e5);if(!_0x83b90a){console[_0x4ac17e(0x182)](_0x4ac17e(0x19a)+_0x4bc7e5);return;}try{console['log']('[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20'+_0x4bc7e5),await _0x83b90a[_0x4ac17e(0x1c4)][_0x4ac17e(0x1e4)](new RTCSessionDescription(_0x418768)),console[_0x4ac17e(0x146)](_0x4ac17e(0x1ab));const _0x617b31=await _0x83b90a[_0x4ac17e(0x1c4)][_0x4ac17e(0x1cc)]();console[_0x4ac17e(0x146)](_0x4ac17e(0x13a)),await _0x83b90a[_0x4ac17e(0x1c4)]['setLocalDescription'](_0x617b31),console['log'](_0x4ac17e(0x1cb)),this['serverWs']&&(this['serverWs']['send'](JSON['stringify']({'op':_0x4ac17e(0x1b4),'session_id':_0x4bc7e5,'answer':_0x617b31})),console['log']('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0x4bc7e5));}catch(_0x27a31c){console[_0x4ac17e(0x182)](_0x4ac17e(0x1d0)+_0x4bc7e5+':',_0x27a31c),this[_0x4ac17e(0x1fd)](_0x4bc7e5);}}async[a9_0x5f0d25(0x150)](_0x4c1d6d,_0x3dbcc2){const _0x51173=a9_0x5f0d25,_0xb59d5f=this[_0x51173(0x1cf)][_0x51173(0x1c8)](_0x4c1d6d);if(!_0xb59d5f){console[_0x51173(0x182)](_0x51173(0x17c)+_0x4c1d6d);return;}try{await _0xb59d5f[_0x51173(0x1c4)]['addIceCandidate'](new RTCIceCandidate(_0x3dbcc2)),console['log'](_0x51173(0x143)+_0x4c1d6d);}catch(_0x2f3071){console[_0x51173(0x182)](_0x51173(0x18f)+_0x4c1d6d+':',_0x2f3071);}}[a9_0x5f0d25(0x1fa)](_0x538888,_0x3edd67){const _0x411f03=a9_0x5f0d25;if(!this[_0x411f03(0x1ac)]||this[_0x411f03(0x1ac)][_0x411f03(0x190)]!==this[_0x411f03(0x1ac)][_0x411f03(0x1d9)])return console[_0x411f03(0x182)](_0x411f03(0x186)),null;console[_0x411f03(0x146)]('[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20'+_0x538888);const _0x3e04f8=_0x538888['includes'](_0x411f03(0x155)),_0x29de81=_0x538888[_0x411f03(0x170)]('compressed')||_0x538888[_0x411f03(0x170)]('compressedDepth');let _0x4d1c22=[];_0x3e04f8?_0x29de81?_0x4d1c22=[_0x411f03(0x1e8),_0x411f03(0x169),_0x411f03(0x1bc),_0x411f03(0x1f3)]:_0x4d1c22=['sensor_msgs/Image','sensor_msgs/msg/Image',_0x411f03(0x1e8)]:_0x4d1c22=['sensor_msgs/CompressedImage','sensor_msgs/msg/CompressedImage',_0x411f03(0x1f3)];console[_0x411f03(0x146)]('[WebRTC\x20Appliance]\x20Topic\x20'+_0x538888+'\x20detected\x20as\x20'+(_0x3e04f8?_0x411f03(0x155):'color')+_0x411f03(0x187),_0x4d1c22);const _0x4814fb=[];let _0xf6586e=![];const _0x4a3c1b=_0x1a1154=>{return _0x1e8f05=>{const _0x59f85f=a9_0x23ef;try{const _0x31d8e9=JSON[_0x59f85f(0x141)](_0x1e8f05[_0x59f85f(0x1f8)]);_0x31d8e9['op']==='publish'&&_0x31d8e9[_0x59f85f(0x159)]===_0x538888&&_0x31d8e9['msg']&&(!_0xf6586e&&(console[_0x59f85f(0x146)]('[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20'+_0x538888+_0x59f85f(0x153)+_0x1a1154),_0xf6586e=!![]),_0x3edd67(_0x31d8e9[_0x59f85f(0x1da)]));}catch(_0x18b42f){console[_0x59f85f(0x182)](_0x59f85f(0x16e),_0x18b42f);}};};for(const _0x1ac6c0 of _0x4d1c22){const _0x339040={'op':'subscribe','topic':_0x538888,'type':_0x1ac6c0};console[_0x411f03(0x146)](_0x411f03(0x185)+_0x1ac6c0),this[_0x411f03(0x1ac)][_0x411f03(0x1b0)](JSON[_0x411f03(0x1f0)](_0x339040));const _0x3d06d1=_0x4a3c1b(_0x1ac6c0);this['rosbridgeWs'][_0x411f03(0x180)](_0x411f03(0x1f9),_0x3d06d1),_0x4814fb[_0x411f03(0x198)]({'handler':_0x3d06d1,'type':_0x1ac6c0});}return _0x3e04f8&&_0x29de81&&setTimeout(()=>{const _0x4b45be=_0x411f03;if(!_0xf6586e){console['log'](_0x4b45be(0x18c)+_0x538888+_0x4b45be(0x1a3));const _0x30ec9f=_0x538888[_0x4b45be(0x1e7)](_0x4b45be(0x183),'')['replace'](_0x4b45be(0x194),''),_0x1ee204=[_0x30ec9f+_0x4b45be(0x1a1),_0x30ec9f+_0x4b45be(0x18b),_0x30ec9f];for(const _0x1c7e2f of _0x1ee204){console[_0x4b45be(0x146)]('[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20'+_0x1c7e2f);const _0x353eda={'op':_0x4b45be(0x1ed),'topic':_0x1c7e2f,'type':_0x4b45be(0x1f3)};this['rosbridgeWs'][_0x4b45be(0x1b0)](JSON['stringify'](_0x353eda));const _0x1f054e=_0x445de8=>{const _0x185723=_0x4b45be;try{const _0x3d3d5e=JSON['parse'](_0x445de8['data']);_0x3d3d5e['op']==='publish'&&_0x3d3d5e[_0x185723(0x159)]===_0x1c7e2f&&_0x3d3d5e[_0x185723(0x1da)]&&(console[_0x185723(0x146)](_0x185723(0x1b5)+_0x1c7e2f+_0x185723(0x197)),_0x3d3d5e[_0x185723(0x1da)][_0x185723(0x1f8)]&&!_0x3d3d5e[_0x185723(0x1da)][_0x185723(0x1f8)]['startsWith'](_0x185723(0x1e3))&&_0x3edd67(_0x3d3d5e[_0x185723(0x1da)]));}catch(_0x4f85db){console[_0x185723(0x182)](_0x185723(0x1ea),_0x4f85db);}};this[_0x4b45be(0x1ac)][_0x4b45be(0x180)](_0x4b45be(0x1f9),_0x1f054e),_0x4814fb[_0x4b45be(0x198)]({'handler':_0x1f054e,'type':_0x4b45be(0x1f3),'topic':_0x1c7e2f});}}},0xbb8),{'unsubscribe':()=>{const _0x5162a0=_0x411f03;for(const {handler:_0x581bbe,type:_0x2b06e3,topic:_0x354595}of _0x4814fb){this['rosbridgeWs'][_0x5162a0(0x1bf)](_0x5162a0(0x1f9),_0x581bbe),this[_0x5162a0(0x1ac)][_0x5162a0(0x190)]===this[_0x5162a0(0x1ac)]['OPEN']&&this[_0x5162a0(0x1ac)][_0x5162a0(0x1b0)](JSON[_0x5162a0(0x1f0)]({'op':_0x5162a0(0x158),'topic':_0x354595||_0x538888}));}}};}[a9_0x5f0d25(0x1a0)](_0x5e279,_0x6373de){const _0x400290=a9_0x5f0d25;_0x6373de[_0x400290(0x189)]='#1a1a1a',_0x6373de['fillRect'](0x0,0x0,_0x5e279[_0x400290(0x19f)],_0x5e279[_0x400290(0x1aa)]),_0x6373de[_0x400290(0x189)]=_0x400290(0x195),_0x6373de[_0x400290(0x1b2)]=_0x400290(0x1a6),_0x6373de[_0x400290(0x1c3)]=_0x400290(0x193),_0x6373de[_0x400290(0x15b)](_0x400290(0x188),_0x5e279[_0x400290(0x19f)]/0x2,_0x5e279[_0x400290(0x1aa)]/0x2-0x14),_0x6373de[_0x400290(0x189)]='#ffffff',_0x6373de[_0x400290(0x1b2)]=_0x400290(0x160),_0x6373de['fillText'](_0x400290(0x1fb),_0x5e279[_0x400290(0x19f)]/0x2,_0x5e279[_0x400290(0x1aa)]/0x2+0x14);const _0x599336=Date[_0x400290(0x1fe)]()/0x3e8;for(let _0x52d92a=0x0;_0x52d92a<0x3;_0x52d92a++){const _0x2860f0=(Math[_0x400290(0x167)](_0x599336*0x2+_0x52d92a*0.5)+0x1)/0x2;_0x6373de[_0x400290(0x189)]='rgba(0,\x20170,\x20255,\x20'+_0x2860f0*0.5+')',_0x6373de[_0x400290(0x1e2)](),_0x6373de[_0x400290(0x1a7)](_0x5e279['width']/0x2-0x28+_0x52d92a*0x28,_0x5e279[_0x400290(0x1aa)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x6373de[_0x400290(0x18a)]();}}['sendFrameToVideoSource'](_0x4132e9,_0xfd3729){const _0x38646f=a9_0x5f0d25;try{if(!_0x4132e9||!_0xfd3729)return;const _0x6a2d1f=_0xfd3729[_0x38646f(0x179)]('2d'),_0x51bd56=_0x6a2d1f[_0x38646f(0x1d7)](0x0,0x0,_0xfd3729['width'],_0xfd3729[_0x38646f(0x1aa)]),_0x12ab92=this[_0x38646f(0x1dc)](_0x51bd56[_0x38646f(0x1f8)],_0xfd3729[_0x38646f(0x19f)],_0xfd3729[_0x38646f(0x1aa)]),_0x2665e6={'width':_0xfd3729[_0x38646f(0x19f)],'height':_0xfd3729['height'],'data':_0x12ab92};typeof _0x4132e9[_0x38646f(0x1ce)]===_0x38646f(0x1cd)&&_0x4132e9[_0x38646f(0x1ce)](_0x2665e6);}catch(_0x1705f8){console[_0x38646f(0x182)]('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x1705f8);}}[a9_0x5f0d25(0x1dc)](_0x37d407,_0x26778d,_0xa3cf88){const _0x443c7d=a9_0x5f0d25,_0x53f9f5=_0x26778d*_0xa3cf88,_0x35e6a1=_0x26778d*_0xa3cf88/0x4,_0x4b9e65=new Uint8Array(_0x53f9f5+_0x35e6a1*0x2);let _0xb63e63=0x0,_0x5598d0=_0x53f9f5,_0x3d3991=_0x53f9f5+_0x35e6a1;for(let _0x16f1e4=0x0;_0x16f1e4<_0xa3cf88;_0x16f1e4++){for(let _0x17f41e=0x0;_0x17f41e<_0x26778d;_0x17f41e++){const _0x1ba7b8=(_0x16f1e4*_0x26778d+_0x17f41e)*0x4,_0x2c3807=_0x37d407[_0x1ba7b8],_0x4eea48=_0x37d407[_0x1ba7b8+0x1],_0x43ca44=_0x37d407[_0x1ba7b8+0x2],_0x16d1e7=Math[_0x443c7d(0x154)](0.299*_0x2c3807+0.587*_0x4eea48+0.114*_0x43ca44);_0x4b9e65[_0xb63e63++]=_0x16d1e7;if(_0x16f1e4%0x2===0x0&&_0x17f41e%0x2===0x0){const _0x3606ab=Math[_0x443c7d(0x154)](-0.169*_0x2c3807-0.331*_0x4eea48+0.5*_0x43ca44+0x80),_0xd66df9=Math[_0x443c7d(0x154)](0.5*_0x2c3807-0.419*_0x4eea48-0.081*_0x43ca44+0x80);_0x4b9e65[_0x5598d0++]=Math[_0x443c7d(0x142)](0x0,Math[_0x443c7d(0x1dd)](0xff,_0x3606ab)),_0x4b9e65[_0x3d3991++]=Math[_0x443c7d(0x142)](0x0,Math[_0x443c7d(0x1dd)](0xff,_0xd66df9));}}}return _0x4b9e65;}async[a9_0x5f0d25(0x140)](_0x3a3989,_0xbe5989,_0x3eb3ad,_0x1035df,_0x47fbca){const _0x4d513a=a9_0x5f0d25;try{if(!_0x3eb3ad||!_0x3eb3ad[_0x4d513a(0x1f8)])return;Math[_0x4d513a(0x1f6)]()<0.01&&console['log'](_0x4d513a(0x1b7)+_0x1035df+',\x20size:\x20'+_0x3eb3ad['data'][_0x4d513a(0x15c)]+_0x4d513a(0x14c));const _0x36bda0=Buffer[_0x4d513a(0x168)](_0x3eb3ad[_0x4d513a(0x1f8)],_0x4d513a(0x1a2)),_0x391a28=this[_0x4d513a(0x177)]['isDepthTopic'](_0x1035df);let _0x58507f;_0x391a28?_0x58507f=await this[_0x4d513a(0x177)][_0x4d513a(0x191)](_0x36bda0,_0x3a3989,_0xbe5989,_0x1035df):_0x58507f=await this[_0x4d513a(0x177)][_0x4d513a(0x138)](_0x36bda0,_0x3a3989,_0xbe5989),_0xbe5989[_0x4d513a(0x1ae)](_0x58507f,0x0,0x0),_0xbe5989[_0x4d513a(0x189)]='rgba(0,\x200,\x200,\x200.7)',_0xbe5989[_0x4d513a(0x161)](0xa,0xa,0xdc,0x32),_0xbe5989['fillStyle']=_0x391a28?_0x4d513a(0x17a):'#00ff00',_0xbe5989[_0x4d513a(0x1b2)]=_0x4d513a(0x1db),_0xbe5989['fillText']((_0x391a28?_0x4d513a(0x13d):'📹\x20Color')+':\x20'+new Date()['toLocaleTimeString'](),0xf,0x1c),_0xbe5989[_0x4d513a(0x189)]=_0x4d513a(0x1d6),_0xbe5989[_0x4d513a(0x1b2)]=_0x4d513a(0x1a8),_0xbe5989[_0x4d513a(0x15b)](_0x4d513a(0x14b)+_0x1035df['split']('/')[_0x4d513a(0x1c0)](),0xf,0x2d),this[_0x4d513a(0x1f2)](_0x47fbca,_0x3a3989);}catch(_0x959f05){console[_0x4d513a(0x152)]('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x1035df+':',_0x959f05[_0x4d513a(0x1f9)]);_0x1035df[_0x4d513a(0x170)](_0x4d513a(0x155))&&Math[_0x4d513a(0x1f6)]()<0.1&&console[_0x4d513a(0x152)](_0x4d513a(0x171)+_0x1035df[_0x4d513a(0x1e7)](_0x4d513a(0x183),_0x4d513a(0x1a1)));_0xbe5989[_0x4d513a(0x189)]=_0x4d513a(0x15e),_0xbe5989[_0x4d513a(0x161)](0x0,0x0,_0x3a3989[_0x4d513a(0x19f)],_0x3a3989[_0x4d513a(0x1aa)]),_0xbe5989['fillStyle']=_0x4d513a(0x1e1),_0xbe5989['font']=_0x4d513a(0x160),_0xbe5989[_0x4d513a(0x1c3)]=_0x4d513a(0x193);const _0x3a181e=_0x1035df[_0x4d513a(0x170)]('depth')?'🔍\x20Processing\x20depth...':'📹\x20Processing\x20video...';_0xbe5989[_0x4d513a(0x15b)](_0x3a181e,_0x3a3989[_0x4d513a(0x19f)]/0x2,_0x3a3989[_0x4d513a(0x1aa)]/0x2),_0xbe5989['fillStyle']=_0x4d513a(0x16b),_0xbe5989['font']=_0x4d513a(0x1e6),_0xbe5989['fillText'](_0x4d513a(0x14b)+_0x1035df[_0x4d513a(0x13c)]('/')[_0x4d513a(0x1c0)](),_0x3a3989[_0x4d513a(0x19f)]/0x2,_0x3a3989[_0x4d513a(0x1aa)]/0x2+0x19),this[_0x4d513a(0x1f2)](_0x47fbca,_0x3a3989);}}[a9_0x5f0d25(0x1fd)](_0x512f42){const _0x52e332=a9_0x5f0d25,_0xb03af2=this[_0x52e332(0x1cf)][_0x52e332(0x1c8)](_0x512f42);if(!_0xb03af2){console[_0x52e332(0x152)]('[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20'+_0x512f42);return;}console['log'](_0x52e332(0x1ef)+_0x512f42+_0x52e332(0x1e9)+_0xb03af2[_0x52e332(0x159)]);try{this['serverWs']&&this[_0x52e332(0x1d2)][_0x52e332(0x190)]===this[_0x52e332(0x1d2)][_0x52e332(0x1d9)]&&this['serverWs'][_0x52e332(0x1b0)](JSON[_0x52e332(0x1f0)]({'op':_0x52e332(0x1f7),'session_id':_0x512f42})),_0xb03af2[_0x52e332(0x1a5)]&&_0xb03af2[_0x52e332(0x1a5)]['stop'](),_0xb03af2[_0x52e332(0x1c4)]&&_0xb03af2[_0x52e332(0x1c4)]['close']();}catch(_0x4e5d36){console['error'](_0x52e332(0x172)+_0x4e5d36);}this['cleanupSession'](_0x512f42);}['cleanupSession'](_0x1c08e1){const _0x5af7af=a9_0x5f0d25,_0x5a5b06=this[_0x5af7af(0x1cf)][_0x5af7af(0x1c8)](_0x1c08e1);if(_0x5a5b06){const _0x173bd2=this['topicSessions']['get'](_0x5a5b06['topic']);_0x173bd2&&(_0x173bd2[_0x5af7af(0x1d8)](_0x1c08e1),_0x173bd2[_0x5af7af(0x15f)]===0x0&&this[_0x5af7af(0x173)]['delete'](_0x5a5b06[_0x5af7af(0x159)])),this[_0x5af7af(0x1d5)](_0x5a5b06[_0x5af7af(0x159)]);}this['activeSessions'][_0x5af7af(0x1d8)](_0x1c08e1),console['log'](_0x5af7af(0x18e)+_0x1c08e1);}[a9_0x5f0d25(0x1ca)](){const _0x1a618f=a9_0x5f0d25;console[_0x1a618f(0x146)](_0x1a618f(0x1eb));const _0x810228=Array[_0x1a618f(0x168)](this['activeSessions'][_0x1a618f(0x1d4)]());_0x810228[_0x1a618f(0x14d)](_0x17ca5f=>this[_0x1a618f(0x1fd)](_0x17ca5f));}[a9_0x5f0d25(0x1be)](){const _0x3c87f1=a9_0x5f0d25,_0x103863=[];for(const [_0x54191b,_0x1140ca]of this[_0x3c87f1(0x1cf)]){_0x103863[_0x3c87f1(0x198)]({'sessionId':_0x54191b,'topic':_0x1140ca['topic'],'connectionState':_0x1140ca[_0x3c87f1(0x1c4)]?.['connectionState']||_0x3c87f1(0x192),'hasVideoTrack':!!_0x1140ca[_0x3c87f1(0x1a5)]});}return _0x103863;}[a9_0x5f0d25(0x19c)](){const _0x2d3f16=a9_0x5f0d25,_0x4768d1=[];for(const [_0x3551c6,_0x3fcf76]of this['sharedVideoSources']){_0x4768d1[_0x2d3f16(0x198)]({'topic':_0x3551c6,'frameCount':_0x3fcf76[_0x2d3f16(0x1c7)],'hasVideoSource':!!_0x3fcf76[_0x2d3f16(0x1c6)],'hasRosSubscriber':!!_0x3fcf76['rosSubscriber']});}return _0x4768d1;}}module['exports']=new ApplianceWebRTCService();