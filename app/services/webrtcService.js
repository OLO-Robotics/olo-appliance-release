const a6_0x344922=a6_0x1415;(function(_0x52670b,_0x1db85e){const _0x5815c5=a6_0x1415,_0x1664f6=_0x52670b();while(!![]){try{const _0x35e36f=parseInt(_0x5815c5(0x18e))/0x1*(-parseInt(_0x5815c5(0x169))/0x2)+-parseInt(_0x5815c5(0x1b7))/0x3+-parseInt(_0x5815c5(0x172))/0x4*(-parseInt(_0x5815c5(0x189))/0x5)+parseInt(_0x5815c5(0x166))/0x6*(parseInt(_0x5815c5(0x168))/0x7)+-parseInt(_0x5815c5(0x197))/0x8+-parseInt(_0x5815c5(0x11d))/0x9*(parseInt(_0x5815c5(0x137))/0xa)+parseInt(_0x5815c5(0x1ae))/0xb;if(_0x35e36f===_0x1db85e)break;else _0x1664f6['push'](_0x1664f6['shift']());}catch(_0x4a2901){_0x1664f6['push'](_0x1664f6['shift']());}}}(a6_0xdd6d,0xe67de));const a6_0x204592=(function(){let _0x11601a=!![];return function(_0x58bb51,_0x4cdc6b){const _0x1db753=_0x11601a?function(){const _0x3257ba=a6_0x1415;if(_0x4cdc6b){const _0x113cd0=_0x4cdc6b[_0x3257ba(0x12b)](_0x58bb51,arguments);return _0x4cdc6b=null,_0x113cd0;}}:function(){};return _0x11601a=![],_0x1db753;};}()),a6_0x4c5c89=a6_0x204592(this,function(){const _0x3e0514=a6_0x1415;return a6_0x4c5c89[_0x3e0514(0x19e)]()['search'](_0x3e0514(0x10c))[_0x3e0514(0x19e)]()['constructor'](a6_0x4c5c89)[_0x3e0514(0x194)](_0x3e0514(0x10c));});a6_0x4c5c89();function a6_0x1415(_0x3283ba,_0x5a56e0){const _0x41704c=a6_0xdd6d();return a6_0x1415=function(_0x4c5c89,_0x204592){_0x4c5c89=_0x4c5c89-0xf2;let _0xdd6dd4=_0x41704c[_0x4c5c89];return _0xdd6dd4;},a6_0x1415(_0x3283ba,_0x5a56e0);}const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x344922(0x18f)),sharp=require(a6_0x344922(0x153)),config=require(a6_0x344922(0x17f)),DepthImageProcessor=require(a6_0x344922(0x138)),turnCredentialsService=require(a6_0x344922(0x154));class ApplianceWebRTCService{constructor(){const _0x28ad97=a6_0x344922;this[_0x28ad97(0x15a)]=new Map(),this[_0x28ad97(0x101)]=new Map(),this[_0x28ad97(0x181)]=new Map(),this[_0x28ad97(0x1a7)]=null,this[_0x28ad97(0x15e)]=null,this['depthProcessor']=new DepthImageProcessor(),this[_0x28ad97(0x1b0)]={'iceServers':[{'urls':'stun:stun.l.google.com:19302'},{'urls':_0x28ad97(0x13b)}]};}[a6_0x344922(0x11a)](_0x174a8b,_0x289c22){const _0x13b093=a6_0x344922;this['rosbridgeWs']=_0x174a8b,this[_0x13b093(0x15e)]=_0x289c22,turnCredentialsService['initialize'](config[_0x13b093(0x16d)]),this['updateTurnCredentials'](),console[_0x13b093(0x126)]('[WebRTC\x20Appliance]\x20Service\x20initialized');}async[a6_0x344922(0x16b)](){const _0x2db0a8=a6_0x344922;try{console[_0x2db0a8(0x126)]('[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...');const _0x5afc3e=await turnCredentialsService['getIceServers']();this[_0x2db0a8(0x1b0)][_0x2db0a8(0x162)]=_0x5afc3e,console['log']('[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully');}catch(_0x5f2371){console[_0x2db0a8(0x182)]('[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:',_0x5f2371),console[_0x2db0a8(0x126)](_0x2db0a8(0x116));}}[a6_0x344922(0x15b)](_0x23a01c){const _0x2cc50=a6_0x344922;if(!_0x23a01c['op']||!_0x23a01c['op']['startsWith'](_0x2cc50(0x108)))return![];console[_0x2cc50(0x126)](_0x2cc50(0x1a4)+_0x23a01c['op']);switch(_0x23a01c['op']){case _0x2cc50(0xff):this[_0x2cc50(0x10b)](_0x23a01c[_0x2cc50(0x178)],_0x23a01c[_0x2cc50(0x16f)]);return!![];case _0x2cc50(0x130):this[_0x2cc50(0x167)](_0x23a01c['session_id'],_0x23a01c[_0x2cc50(0x12e)]);return!![];case _0x2cc50(0xf7):this[_0x2cc50(0x174)](_0x23a01c[_0x2cc50(0x178)],_0x23a01c[_0x2cc50(0x104)]);return!![];case'webrtc_stop_session':this[_0x2cc50(0x170)](_0x23a01c[_0x2cc50(0x178)]);return!![];default:console[_0x2cc50(0x10f)]('[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20'+_0x23a01c['op']);return![];}}[a6_0x344922(0x135)](_0x18661e){const _0x3170f3=a6_0x344922;if(this[_0x3170f3(0x181)][_0x3170f3(0xf4)](_0x18661e)){const _0x5b5857=this[_0x3170f3(0x181)][_0x3170f3(0x11e)](_0x18661e);return _0x5b5857[_0x3170f3(0x183)]++,console[_0x3170f3(0x126)](_0x3170f3(0x15d)+_0x18661e+'\x20('+_0x5b5857[_0x3170f3(0x183)]+_0x3170f3(0x186)),_0x5b5857;}console[_0x3170f3(0x126)]('[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x18661e);const {createCanvas:_0x5334d2}=require('canvas'),_0x23470c=_0x5334d2(config[_0x3170f3(0x133)][_0x3170f3(0x11c)][_0x3170f3(0x12f)],config[_0x3170f3(0x133)]['video'][_0x3170f3(0x146)]),_0x3b495c=_0x23470c['getContext']('2d');this[_0x3170f3(0x10d)](_0x23470c,_0x3b495c);const {RTCVideoSource:_0x138bec}=nonstandard,_0x3dccb1=new _0x138bec();let _0x12d757=0x0;const _0x4159e5=0x3e8/config['webrtc']['video'][_0x3170f3(0x191)],_0x44e6b2=this[_0x3170f3(0x159)](_0x18661e,_0x2c3791=>{const _0x2a92f4=_0x3170f3,_0x1f459d=Date['now']();_0x1f459d-_0x12d757>=_0x4159e5&&(_0x12d757=_0x1f459d,this[_0x2a92f4(0x111)](_0x23470c,_0x3b495c,_0x2c3791,_0x18661e,_0x3dccb1));}),_0x4f367a={'videoSource':_0x3dccb1,'canvas':_0x23470c,'rosSubscriber':_0x44e6b2,'frameCount':0x1,'topic':_0x18661e};return this[_0x3170f3(0x181)][_0x3170f3(0x157)](_0x18661e,_0x4f367a),_0x4f367a;}[a6_0x344922(0x144)](_0x1a3401){const _0x855ed4=a6_0x344922,_0x3d1f16=this[_0x855ed4(0x181)][_0x855ed4(0x11e)](_0x1a3401);if(!_0x3d1f16)return;_0x3d1f16[_0x855ed4(0x183)]--,console[_0x855ed4(0x126)](_0x855ed4(0x14b)+_0x1a3401+'\x20('+_0x3d1f16[_0x855ed4(0x183)]+_0x855ed4(0x1b5)),_0x3d1f16[_0x855ed4(0x183)]<=0x0&&(console[_0x855ed4(0x126)](_0x855ed4(0x110)+_0x1a3401+',\x20cleaning\x20up\x20shared\x20resources'),_0x3d1f16['videoSource']&&(_0x3d1f16[_0x855ed4(0x120)]=null),_0x3d1f16[_0x855ed4(0xf6)]&&_0x3d1f16[_0x855ed4(0xf6)]['unsubscribe'](),this['sharedVideoSources'][_0x855ed4(0x19c)](_0x1a3401));}async[a6_0x344922(0x10b)](_0x1adcb6,_0xdc6b2b){const _0x384bdf=a6_0x344922;try{console[_0x384bdf(0x126)](_0x384bdf(0x192)+_0x1adcb6+_0x384bdf(0x141)+_0xdc6b2b);const _0x37bb4b=this[_0x384bdf(0x135)](_0xdc6b2b),_0x3492b3=new RTCPeerConnection(this['rtcConfig']),_0x43ad52=_0x37bb4b[_0x384bdf(0x120)][_0x384bdf(0xfa)]({'width':config[_0x384bdf(0x133)][_0x384bdf(0x11c)][_0x384bdf(0x12f)],'height':config[_0x384bdf(0x133)]['video'][_0x384bdf(0x146)],'framerate':config[_0x384bdf(0x133)][_0x384bdf(0x11c)][_0x384bdf(0x191)]});console[_0x384bdf(0x126)](_0x384bdf(0x196)+_0x1adcb6);const {MediaStream:_0x4dd5aa}=require(_0x384bdf(0x18f)),_0x15b46a=new _0x4dd5aa([_0x43ad52]);_0x3492b3[_0x384bdf(0x136)](_0x43ad52,_0x15b46a),this[_0x384bdf(0x16e)](_0x37bb4b[_0x384bdf(0x120)],_0x37bb4b[_0x384bdf(0x1a6)]),_0x3492b3[_0x384bdf(0x10a)]=_0x358479=>{const _0x5a3e53=_0x384bdf;if(_0x358479[_0x5a3e53(0x104)]&&this[_0x5a3e53(0x15e)])console[_0x5a3e53(0x126)]('[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20'+_0x1adcb6+':',{'type':_0x358479[_0x5a3e53(0x104)]['type'],'protocol':_0x358479[_0x5a3e53(0x104)][_0x5a3e53(0x114)],'address':_0x358479[_0x5a3e53(0x104)][_0x5a3e53(0x17b)],'port':_0x358479['candidate']['port']}),this['serverWs'][_0x5a3e53(0x148)](JSON[_0x5a3e53(0x13e)]({'op':_0x5a3e53(0xf7),'session_id':_0x1adcb6,'candidate':_0x358479[_0x5a3e53(0x104)]}));else!_0x358479[_0x5a3e53(0x104)]&&console[_0x5a3e53(0x126)]('[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20'+_0x1adcb6);},_0x3492b3['onconnectionstatechange']=()=>{const _0x43c94d=_0x384bdf;console[_0x43c94d(0x126)](_0x43c94d(0x145)+_0x1adcb6+'\x20connection\x20state:\x20'+_0x3492b3[_0x43c94d(0x11f)]);if(_0x3492b3[_0x43c94d(0x11f)]===_0x43c94d(0x125))console[_0x43c94d(0x126)](_0x43c94d(0x145)+_0x1adcb6+_0x43c94d(0x15f));else{if(_0x3492b3[_0x43c94d(0x11f)]===_0x43c94d(0x1a5))console[_0x43c94d(0x126)](_0x43c94d(0x145)+_0x1adcb6+_0x43c94d(0xfd)),this[_0x43c94d(0x170)](_0x1adcb6);else _0x3492b3['connectionState']===_0x43c94d(0x17a)&&(console[_0x43c94d(0x126)](_0x43c94d(0x145)+_0x1adcb6+'\x20connection\x20closed,\x20cleaning\x20up'),this['cleanupSession'](_0x1adcb6));}},this['activeSessions'][_0x384bdf(0x157)](_0x1adcb6,{'peerConnection':_0x3492b3,'topic':_0xdc6b2b,'videoTrack':_0x43ad52,'mediaStream':_0x15b46a,'status':_0x384bdf(0x161)}),!this['topicSessions'][_0x384bdf(0xf4)](_0xdc6b2b)&&this[_0x384bdf(0x101)][_0x384bdf(0x157)](_0xdc6b2b,new Set()),this['topicSessions']['get'](_0xdc6b2b)[_0x384bdf(0x176)](_0x1adcb6),console['log'](_0x384bdf(0x145)+_0x1adcb6+_0x384bdf(0xf8)),console['log'](_0x384bdf(0xfe)+_0xdc6b2b+':\x20'+this[_0x384bdf(0x101)]['get'](_0xdc6b2b)[_0x384bdf(0x1a8)]);}catch(_0x5bb2c6){console[_0x384bdf(0x182)]('[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20'+_0x1adcb6+':',_0x5bb2c6),this[_0x384bdf(0x170)](_0x1adcb6);}}async[a6_0x344922(0x167)](_0x4b4d33,_0x4edfc7){const _0x3a8d3a=a6_0x344922,_0x3724a3=this[_0x3a8d3a(0x15a)]['get'](_0x4b4d33);if(!_0x3724a3){console[_0x3a8d3a(0x182)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20'+_0x4b4d33);return;}try{console[_0x3a8d3a(0x126)](_0x3a8d3a(0x106)+_0x4b4d33),await _0x3724a3[_0x3a8d3a(0x105)][_0x3a8d3a(0x147)](new RTCSessionDescription(_0x4edfc7)),console[_0x3a8d3a(0x126)](_0x3a8d3a(0x12a));const _0x3f8c88=await _0x3724a3['peerConnection']['createAnswer']();console[_0x3a8d3a(0x126)](_0x3a8d3a(0x1a9)),await _0x3724a3[_0x3a8d3a(0x105)][_0x3a8d3a(0x1b2)](_0x3f8c88),console[_0x3a8d3a(0x126)]('[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)'),this['serverWs']&&(this[_0x3a8d3a(0x15e)][_0x3a8d3a(0x148)](JSON[_0x3a8d3a(0x13e)]({'op':_0x3a8d3a(0x160),'session_id':_0x4b4d33,'answer':_0x3f8c88})),console[_0x3a8d3a(0x126)](_0x3a8d3a(0x199)+_0x4b4d33));}catch(_0x19ebf9){console[_0x3a8d3a(0x182)]('[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20'+_0x4b4d33+':',_0x19ebf9),this[_0x3a8d3a(0x170)](_0x4b4d33);}}async['handleIceCandidate'](_0x4a132d,_0x3a584e){const _0x8cd432=a6_0x344922,_0x21f569=this[_0x8cd432(0x15a)]['get'](_0x4a132d);if(!_0x21f569){console[_0x8cd432(0x182)](_0x8cd432(0x1aa)+_0x4a132d);return;}try{await _0x21f569[_0x8cd432(0x105)][_0x8cd432(0x16a)](new RTCIceCandidate(_0x3a584e)),console['log'](_0x8cd432(0x17c)+_0x4a132d);}catch(_0x345226){console[_0x8cd432(0x182)](_0x8cd432(0x118)+_0x4a132d+':',_0x345226);}}[a6_0x344922(0x159)](_0x66c7a9,_0x5bd754){const _0x44a969=a6_0x344922;if(!this[_0x44a969(0x1a7)]||this[_0x44a969(0x1a7)]['readyState']!==this[_0x44a969(0x1a7)]['OPEN'])return console[_0x44a969(0x182)]('[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected'),null;console[_0x44a969(0x126)](_0x44a969(0x128)+_0x66c7a9);const _0x2b58dd=_0x66c7a9['includes'](_0x44a969(0x15c)),_0x2a0b1f=_0x66c7a9['includes']('compressed')||_0x66c7a9[_0x44a969(0xfc)](_0x44a969(0x19a));let _0x30bc72=[];_0x2b58dd?_0x2a0b1f?_0x30bc72=['sensor_msgs/CompressedImage',_0x44a969(0x102),_0x44a969(0x123),_0x44a969(0x13a)]:_0x30bc72=[_0x44a969(0x13a),_0x44a969(0x10e),_0x44a969(0xf2)]:_0x30bc72=['sensor_msgs/CompressedImage',_0x44a969(0x102),_0x44a969(0x13a)];console[_0x44a969(0x126)](_0x44a969(0x1a3)+_0x66c7a9+_0x44a969(0x177)+(_0x2b58dd?_0x44a969(0x15c):_0x44a969(0xf9))+_0x44a969(0x142),_0x30bc72);const _0x156052=[];let _0x41daee=![];const _0x10ce52=_0x26d976=>{return _0x53220d=>{const _0x1ffd61=a6_0x1415;try{const _0x2a8d81=JSON[_0x1ffd61(0x122)](_0x53220d[_0x1ffd61(0x1a0)]);_0x2a8d81['op']===_0x1ffd61(0xf3)&&_0x2a8d81[_0x1ffd61(0x16f)]===_0x66c7a9&&_0x2a8d81[_0x1ffd61(0x156)]&&(!_0x41daee&&(console[_0x1ffd61(0x126)]('[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20'+_0x66c7a9+'\x20with\x20message\x20type\x20'+_0x26d976),_0x41daee=!![]),_0x5bd754(_0x2a8d81['msg']));}catch(_0x1e7970){console[_0x1ffd61(0x182)](_0x1ffd61(0x127),_0x1e7970);}};};for(const _0x1f3ce6 of _0x30bc72){const _0x607dc8={'op':_0x44a969(0x179),'topic':_0x66c7a9,'type':_0x1f3ce6};console[_0x44a969(0x126)](_0x44a969(0x13d)+_0x1f3ce6),this[_0x44a969(0x1a7)][_0x44a969(0x148)](JSON['stringify'](_0x607dc8));const _0x5d4ffd=_0x10ce52(_0x1f3ce6);this[_0x44a969(0x1a7)]['addEventListener'](_0x44a969(0xf5),_0x5d4ffd),_0x156052[_0x44a969(0x150)]({'handler':_0x5d4ffd,'type':_0x1f3ce6});}return _0x2b58dd&&_0x2a0b1f&&setTimeout(()=>{const _0x4baa82=_0x44a969;if(!_0x41daee){console[_0x4baa82(0x126)](_0x4baa82(0x14e)+_0x66c7a9+_0x4baa82(0x185));const _0x336307=_0x66c7a9['replace'](_0x4baa82(0x190),'')['replace'](_0x4baa82(0x17e),''),_0x596d28=[_0x336307+_0x4baa82(0x100),_0x336307+'/image',_0x336307];for(const _0x36b778 of _0x596d28){console[_0x4baa82(0x126)](_0x4baa82(0x164)+_0x36b778);const _0x2e0ec5={'op':_0x4baa82(0x179),'topic':_0x36b778,'type':'sensor_msgs/Image'};this[_0x4baa82(0x1a7)]['send'](JSON[_0x4baa82(0x13e)](_0x2e0ec5));const _0x166c08=_0x29a73c=>{const _0x56c5f2=_0x4baa82;try{const _0x26cb28=JSON[_0x56c5f2(0x122)](_0x29a73c['data']);_0x26cb28['op']===_0x56c5f2(0xf3)&&_0x26cb28[_0x56c5f2(0x16f)]===_0x36b778&&_0x26cb28[_0x56c5f2(0x156)]&&(console[_0x56c5f2(0x126)](_0x56c5f2(0x14a)+_0x36b778+_0x56c5f2(0xfb)),_0x26cb28[_0x56c5f2(0x156)][_0x56c5f2(0x1a0)]&&!_0x26cb28['msg']['data'][_0x56c5f2(0x124)](_0x56c5f2(0x152))&&_0x5bd754(_0x26cb28[_0x56c5f2(0x156)]));}catch(_0x1521e5){console[_0x56c5f2(0x182)](_0x56c5f2(0x165),_0x1521e5);}};this[_0x4baa82(0x1a7)]['addEventListener'](_0x4baa82(0xf5),_0x166c08),_0x156052[_0x4baa82(0x150)]({'handler':_0x166c08,'type':'sensor_msgs/Image','topic':_0x36b778});}}},0xbb8),{'unsubscribe':()=>{const _0x1a0685=_0x44a969;for(const {handler:_0x57098b,type:_0x5bc253,topic:_0xae1cbb}of _0x156052){this[_0x1a0685(0x1a7)][_0x1a0685(0x187)](_0x1a0685(0xf5),_0x57098b),this['rosbridgeWs'][_0x1a0685(0x163)]===this[_0x1a0685(0x1a7)][_0x1a0685(0x1b3)]&&this[_0x1a0685(0x1a7)]['send'](JSON['stringify']({'op':_0x1a0685(0x1b4),'topic':_0xae1cbb||_0x66c7a9}));}}};}[a6_0x344922(0x10d)](_0x2540f1,_0x34b738){const _0x99c1f8=a6_0x344922;_0x34b738['fillStyle']=_0x99c1f8(0x109),_0x34b738['fillRect'](0x0,0x0,_0x2540f1[_0x99c1f8(0x12f)],_0x2540f1[_0x99c1f8(0x146)]),_0x34b738['fillStyle']='#00aaff',_0x34b738[_0x99c1f8(0x13c)]=_0x99c1f8(0x115),_0x34b738[_0x99c1f8(0x121)]=_0x99c1f8(0x1a2),_0x34b738[_0x99c1f8(0x1b6)]('ü§ñ\x20Robot\x20Camera',_0x2540f1[_0x99c1f8(0x12f)]/0x2,_0x2540f1[_0x99c1f8(0x146)]/0x2-0x14),_0x34b738[_0x99c1f8(0x107)]='#ffffff',_0x34b738['font']=_0x99c1f8(0x198),_0x34b738[_0x99c1f8(0x1b6)](_0x99c1f8(0x14f),_0x2540f1['width']/0x2,_0x2540f1[_0x99c1f8(0x146)]/0x2+0x14);const _0x28b246=Date[_0x99c1f8(0x1af)]()/0x3e8;for(let _0x4ab41e=0x0;_0x4ab41e<0x3;_0x4ab41e++){const _0x44d9c0=(Math[_0x99c1f8(0x132)](_0x28b246*0x2+_0x4ab41e*0.5)+0x1)/0x2;_0x34b738['fillStyle']=_0x99c1f8(0x188)+_0x44d9c0*0.5+')',_0x34b738[_0x99c1f8(0x113)](),_0x34b738[_0x99c1f8(0x18a)](_0x2540f1[_0x99c1f8(0x12f)]/0x2-0x28+_0x4ab41e*0x28,_0x2540f1['height']/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x34b738[_0x99c1f8(0x17d)]();}}[a6_0x344922(0x16e)](_0x5a2770,_0x17195e){const _0x43bee0=a6_0x344922;try{if(!_0x5a2770||!_0x17195e)return;const _0xc3a9d5=_0x17195e['getContext']('2d'),_0x57e0fc=_0xc3a9d5['getImageData'](0x0,0x0,_0x17195e[_0x43bee0(0x12f)],_0x17195e[_0x43bee0(0x146)]),_0x440410=this[_0x43bee0(0x151)](_0x57e0fc[_0x43bee0(0x1a0)],_0x17195e[_0x43bee0(0x12f)],_0x17195e['height']),_0x118880={'width':_0x17195e[_0x43bee0(0x12f)],'height':_0x17195e[_0x43bee0(0x146)],'data':_0x440410};typeof _0x5a2770['onFrame']==='function'&&_0x5a2770['onFrame'](_0x118880);}catch(_0x6def2f){console['error'](_0x43bee0(0x11b),_0x6def2f);}}[a6_0x344922(0x151)](_0x17e020,_0x120a52,_0x4e6cc7){const _0x274f69=a6_0x344922,_0x2e581b=_0x120a52*_0x4e6cc7,_0x4c5955=_0x120a52*_0x4e6cc7/0x4,_0x4a0190=new Uint8Array(_0x2e581b+_0x4c5955*0x2);let _0x326ba1=0x0,_0x368443=_0x2e581b,_0x306e9e=_0x2e581b+_0x4c5955;for(let _0x48f598=0x0;_0x48f598<_0x4e6cc7;_0x48f598++){for(let _0x49cbc5=0x0;_0x49cbc5<_0x120a52;_0x49cbc5++){const _0x3c8d21=(_0x48f598*_0x120a52+_0x49cbc5)*0x4,_0x51c1fd=_0x17e020[_0x3c8d21],_0x1d224e=_0x17e020[_0x3c8d21+0x1],_0x14742b=_0x17e020[_0x3c8d21+0x2],_0x1e4e62=Math[_0x274f69(0x195)](0.299*_0x51c1fd+0.587*_0x1d224e+0.114*_0x14742b);_0x4a0190[_0x326ba1++]=_0x1e4e62;if(_0x48f598%0x2===0x0&&_0x49cbc5%0x2===0x0){const _0x12c2cd=Math[_0x274f69(0x195)](-0.169*_0x51c1fd-0.331*_0x1d224e+0.5*_0x14742b+0x80),_0x3d348d=Math[_0x274f69(0x195)](0.5*_0x51c1fd-0.419*_0x1d224e-0.081*_0x14742b+0x80);_0x4a0190[_0x368443++]=Math[_0x274f69(0x19f)](0x0,Math[_0x274f69(0x14d)](0xff,_0x12c2cd)),_0x4a0190[_0x306e9e++]=Math[_0x274f69(0x19f)](0x0,Math[_0x274f69(0x14d)](0xff,_0x3d348d));}}}return _0x4a0190;}async[a6_0x344922(0x111)](_0x3a3161,_0x1eb0ba,_0x4f530e,_0x360de9,_0x5bd8ff){const _0x55431a=a6_0x344922;try{if(!_0x4f530e||!_0x4f530e[_0x55431a(0x1a0)])return;Math['random']()<0.01&&console['log']('[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20'+_0x360de9+',\x20size:\x20'+_0x4f530e[_0x55431a(0x1a0)]['length']+'\x20bytes');const _0xf18e5a=Buffer[_0x55431a(0x117)](_0x4f530e[_0x55431a(0x1a0)],_0x55431a(0x180)),_0x4e4435=this[_0x55431a(0x184)][_0x55431a(0x119)](_0x360de9);let _0xa3b1ad;_0x4e4435?_0xa3b1ad=await this[_0x55431a(0x184)]['processDepthImage'](_0xf18e5a,_0x3a3161,_0x1eb0ba,_0x360de9):_0xa3b1ad=await this['depthProcessor'][_0x55431a(0x112)](_0xf18e5a,_0x3a3161,_0x1eb0ba),_0x1eb0ba['putImageData'](_0xa3b1ad,0x0,0x0),_0x1eb0ba['fillStyle']=_0x55431a(0x158),_0x1eb0ba[_0x55431a(0x1ac)](0xa,0xa,0xdc,0x32),_0x1eb0ba[_0x55431a(0x107)]=_0x4e4435?_0x55431a(0x12c):_0x55431a(0x18c),_0x1eb0ba['font']=_0x55431a(0x16c),_0x1eb0ba['fillText']((_0x4e4435?_0x55431a(0x131):'üìπ\x20Color')+':\x20'+new Date()[_0x55431a(0x149)](),0xf,0x1c),_0x1eb0ba['fillStyle']=_0x55431a(0x173),_0x1eb0ba[_0x55431a(0x13c)]=_0x55431a(0x12d),_0x1eb0ba[_0x55431a(0x1b6)](_0x55431a(0x103)+_0x360de9[_0x55431a(0x143)]('/')[_0x55431a(0x193)](),0xf,0x2d),this[_0x55431a(0x16e)](_0x5bd8ff,_0x3a3161);}catch(_0x2db922){console[_0x55431a(0x10f)]('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x360de9+':',_0x2db922[_0x55431a(0xf5)]);_0x360de9[_0x55431a(0xfc)]('depth')&&Math[_0x55431a(0x13f)]()<0.1&&console[_0x55431a(0x10f)](_0x55431a(0x19b)+_0x360de9[_0x55431a(0x1b8)](_0x55431a(0x190),'/image_raw'));_0x1eb0ba['fillStyle']=_0x55431a(0x109),_0x1eb0ba[_0x55431a(0x1ac)](0x0,0x0,_0x3a3161['width'],_0x3a3161['height']),_0x1eb0ba[_0x55431a(0x107)]='#888',_0x1eb0ba[_0x55431a(0x13c)]=_0x55431a(0x198),_0x1eb0ba[_0x55431a(0x121)]=_0x55431a(0x1a2);const _0x2ebbe1=_0x360de9[_0x55431a(0xfc)](_0x55431a(0x15c))?_0x55431a(0x139):_0x55431a(0x14c);_0x1eb0ba[_0x55431a(0x1b6)](_0x2ebbe1,_0x3a3161[_0x55431a(0x12f)]/0x2,_0x3a3161[_0x55431a(0x146)]/0x2),_0x1eb0ba['fillStyle']='#666',_0x1eb0ba['font']=_0x55431a(0x1ad),_0x1eb0ba[_0x55431a(0x1b6)](_0x55431a(0x103)+_0x360de9[_0x55431a(0x143)]('/')[_0x55431a(0x193)](),_0x3a3161[_0x55431a(0x12f)]/0x2,_0x3a3161['height']/0x2+0x19),this['sendFrameToVideoSource'](_0x5bd8ff,_0x3a3161);}}['stopSession'](_0x13e017){const _0x167593=a6_0x344922,_0x5a1630=this[_0x167593(0x15a)][_0x167593(0x11e)](_0x13e017);if(!_0x5a1630){console[_0x167593(0x10f)](_0x167593(0x155)+_0x13e017);return;}console[_0x167593(0x126)]('[WebRTC\x20Appliance]\x20Stopping\x20session:\x20'+_0x13e017+_0x167593(0x1ab)+_0x5a1630[_0x167593(0x16f)]);try{this[_0x167593(0x15e)]&&this[_0x167593(0x15e)]['readyState']===this['serverWs'][_0x167593(0x1b3)]&&this[_0x167593(0x15e)][_0x167593(0x148)](JSON[_0x167593(0x13e)]({'op':'webrtc_stop_session','session_id':_0x13e017})),_0x5a1630[_0x167593(0x19d)]&&_0x5a1630[_0x167593(0x19d)]['stop'](),_0x5a1630[_0x167593(0x105)]&&_0x5a1630[_0x167593(0x105)][_0x167593(0x1a1)]();}catch(_0x263462){console[_0x167593(0x182)]('[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20'+_0x263462);}this[_0x167593(0x134)](_0x13e017);}['cleanupSession'](_0x322655){const _0x34e970=a6_0x344922,_0x473ef0=this[_0x34e970(0x15a)][_0x34e970(0x11e)](_0x322655);if(_0x473ef0){const _0x4d8367=this[_0x34e970(0x101)][_0x34e970(0x11e)](_0x473ef0[_0x34e970(0x16f)]);_0x4d8367&&(_0x4d8367['delete'](_0x322655),_0x4d8367[_0x34e970(0x1a8)]===0x0&&this[_0x34e970(0x101)][_0x34e970(0x19c)](_0x473ef0[_0x34e970(0x16f)])),this[_0x34e970(0x144)](_0x473ef0[_0x34e970(0x16f)]);}this['activeSessions']['delete'](_0x322655),console['log'](_0x34e970(0x18d)+_0x322655);}[a6_0x344922(0x18b)](){const _0x454455=a6_0x344922;console[_0x454455(0x126)](_0x454455(0x129));const _0x4dc38c=Array[_0x454455(0x117)](this[_0x454455(0x15a)][_0x454455(0x140)]());_0x4dc38c[_0x454455(0x1b1)](_0x4f8f2b=>this[_0x454455(0x170)](_0x4f8f2b));}[a6_0x344922(0x175)](){const _0x8a926b=a6_0x344922,_0x5c8c99=[];for(const [_0x13a8e1,_0x26e511]of this[_0x8a926b(0x15a)]){_0x5c8c99[_0x8a926b(0x150)]({'sessionId':_0x13a8e1,'topic':_0x26e511[_0x8a926b(0x16f)],'connectionState':_0x26e511[_0x8a926b(0x105)]?.[_0x8a926b(0x11f)]||'unknown','hasVideoTrack':!!_0x26e511[_0x8a926b(0x19d)]});}return _0x5c8c99;}[a6_0x344922(0x171)](){const _0xb64337=a6_0x344922,_0x3befe0=[];for(const [_0x36cec9,_0xc3bc7f]of this[_0xb64337(0x181)]){_0x3befe0[_0xb64337(0x150)]({'topic':_0x36cec9,'frameCount':_0xc3bc7f[_0xb64337(0x183)],'hasVideoSource':!!_0xc3bc7f[_0xb64337(0x120)],'hasRosSubscriber':!!_0xc3bc7f[_0xb64337(0xf6)]});}return _0x3befe0;}}function a6_0xdd6d(){const _0x2db4aa=['toLocaleTimeString','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','üìπ\x20Processing\x20video...','min','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','Waiting\x20for\x20ROS\x20image\x20data...','push','convertRGBAtoI420','/9j/','sharp','./turnCredentialsService','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','msg','set','rgba(0,\x200,\x200,\x200.7)','subscribeToROSTopic','activeSessions','handleMessage','depth','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','serverWs','\x20successfully\x20connected!','webrtc_answer','initializing','iceServers','readyState','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','381030wPZTLg','handleOffer','77urEufi','1493612RPUnSw','addIceCandidate','updateTurnCredentials','12px\x20monospace','serverUrl','sendFrameToVideoSource','topic','stopSession','getSharedVideoSources','4zgFEhB','#ffffff','handleIceCandidate','getActiveSessions','add','\x20detected\x20as\x20','session_id','subscribe','closed','address','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','fill','/compressed','../config','base64','sharedVideoSources','error','frameCount','depthProcessor',',\x20trying\x20alternative\x20depth\x20topics','\x20sessions)','removeEventListener','rgba(0,\x20170,\x20255,\x20','3537730LwOOqT','arc','stopAllSessions','#00ff00','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','1vYyNbR','wrtc','/compressedDepth','framerate','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','pop','search','round','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','696280ONoqCU','16px\x20Arial','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','compressedDepth','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','delete','videoTrack','toString','max','data','close','center','[WebRTC\x20Appliance]\x20Topic\x20','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','failed','canvas','rosbridgeWs','size','[WebRTC\x20Appliance]\x20Created\x20answer','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','\x20for\x20topic:\x20','fillRect','12px\x20Arial','24008050sXQHVt','now','rtcConfig','forEach','setLocalDescription','OPEN','unsubscribe','\x20sessions\x20remaining)','fillText','1719564tUzKUw','replace','sensor_msgs/CompressedImage','publish','has','message','rosSubscriber','webrtc_ice_candidate','\x20initialized\x20successfully','color','createTrack',',\x20converting\x20to\x20base64...','includes','\x20connection\x20failed,\x20stopping\x20session','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','webrtc_init_session','/image_raw','topicSessions','sensor_msgs/msg/CompressedImage','Topic:\x20','candidate','peerConnection','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','fillStyle','webrtc_','#1a1a1a','onicecandidate','initializeSession','(((.+)+)+)+$','drawLoadingPattern','sensor_msgs/msg/Image','warn','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','updateCanvasWithImageData','processColorImage','beginPath','protocol','24px\x20Arial','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','from','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','isDepthTopic','initialize','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','video','36Pipszw','get','connectionState','videoSource','textAlign','parse','compressed_depth_image_transport/CompressedDepthImage','startsWith','connected','log','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','apply','#00ffff','10px\x20monospace','offer','width','webrtc_offer','üîç\x20Depth','sin','webrtc','cleanupSession','getOrCreateSharedVideoSource','addTrack','3093820rLdjqS','./DepthImageProcessor','üîç\x20Processing\x20depth...','sensor_msgs/Image','stun:stun1.l.google.com:19302','font','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','stringify','random','keys','\x20for\x20topic\x20','\x20image,\x20trying\x20message\x20types:','split','releaseSharedVideoSource','[WebRTC\x20Appliance]\x20Session\x20','height','setRemoteDescription','send'];a6_0xdd6d=function(){return _0x2db4aa;};return a6_0xdd6d();}module['exports']=new ApplianceWebRTCService();