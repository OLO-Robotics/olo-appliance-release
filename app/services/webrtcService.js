const a6_0x5caf34=a6_0x3419;function a6_0x3419(_0x25af8a,_0x23bce6){const _0x3dcce4=a6_0x4cda();return a6_0x3419=function(_0x568fd9,_0x2984b2){_0x568fd9=_0x568fd9-0x172;let _0x4cda9b=_0x3dcce4[_0x568fd9];return _0x4cda9b;},a6_0x3419(_0x25af8a,_0x23bce6);}(function(_0x1b5aad,_0xb2e649){const _0x4226de=a6_0x3419,_0x224a02=_0x1b5aad();while(!![]){try{const _0x30daac=parseInt(_0x4226de(0x236))/0x1*(-parseInt(_0x4226de(0x233))/0x2)+parseInt(_0x4226de(0x183))/0x3*(parseInt(_0x4226de(0x1da))/0x4)+parseInt(_0x4226de(0x1f1))/0x5+-parseInt(_0x4226de(0x207))/0x6+parseInt(_0x4226de(0x22a))/0x7+-parseInt(_0x4226de(0x22f))/0x8+parseInt(_0x4226de(0x1e2))/0x9;if(_0x30daac===_0xb2e649)break;else _0x224a02['push'](_0x224a02['shift']());}catch(_0xc925ce){_0x224a02['push'](_0x224a02['shift']());}}}(a6_0x4cda,0x4b79c));const a6_0x2984b2=(function(){let _0x1cd853=!![];return function(_0x3810a2,_0x26a50f){const _0x133896=_0x1cd853?function(){const _0x27c6b1=a6_0x3419;if(_0x26a50f){const _0x4395f4=_0x26a50f[_0x27c6b1(0x20d)](_0x3810a2,arguments);return _0x26a50f=null,_0x4395f4;}}:function(){};return _0x1cd853=![],_0x133896;};}()),a6_0x568fd9=a6_0x2984b2(this,function(){const _0x36fd68=a6_0x3419;return a6_0x568fd9[_0x36fd68(0x1b0)]()[_0x36fd68(0x196)](_0x36fd68(0x200))[_0x36fd68(0x1b0)]()[_0x36fd68(0x1dd)](a6_0x568fd9)[_0x36fd68(0x196)](_0x36fd68(0x200));});a6_0x568fd9();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require('wrtc'),sharp=require(a6_0x5caf34(0x212)),config=require(a6_0x5caf34(0x230)),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require(a6_0x5caf34(0x1cb));class ApplianceWebRTCService{constructor(){const _0x3e2b4e=a6_0x5caf34;this[_0x3e2b4e(0x21e)]=new Map(),this[_0x3e2b4e(0x1c6)]=new Map(),this[_0x3e2b4e(0x23b)]=new Map(),this[_0x3e2b4e(0x210)]=null,this[_0x3e2b4e(0x175)]=null,this[_0x3e2b4e(0x17e)]=new DepthImageProcessor(),this['rtcConfig']={'iceServers':[{'urls':_0x3e2b4e(0x1ea)},{'urls':'stun:stun1.l.google.com:19302'}]};}[a6_0x5caf34(0x1f0)](_0xbcc3a7,_0x2b6980){const _0xfcf59f=a6_0x5caf34;this['rosbridgeWs']=_0xbcc3a7,this['serverWs']=_0x2b6980,turnCredentialsService[_0xfcf59f(0x1f0)](config[_0xfcf59f(0x1c7)]),this[_0xfcf59f(0x216)](),console[_0xfcf59f(0x1e1)](_0xfcf59f(0x1c2));}async['updateTurnCredentials'](){const _0x539c86=a6_0x5caf34;try{console[_0x539c86(0x1e1)](_0x539c86(0x239));const _0x2be1b1=await turnCredentialsService['getIceServers']();this['rtcConfig']['iceServers']=_0x2be1b1,console[_0x539c86(0x1e1)]('[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully');}catch(_0x32ff1b){console[_0x539c86(0x1e4)](_0x539c86(0x19b),_0x32ff1b),console[_0x539c86(0x1e1)]('[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers');}}[a6_0x5caf34(0x1ab)](_0x5cc078){const _0x36a08a=a6_0x5caf34;if(!_0x5cc078['op']||!_0x5cc078['op'][_0x36a08a(0x1cc)](_0x36a08a(0x22c)))return![];console[_0x36a08a(0x1e1)](_0x36a08a(0x1f8)+_0x5cc078['op']);switch(_0x5cc078['op']){case _0x36a08a(0x1a9):this[_0x36a08a(0x1f9)](_0x5cc078[_0x36a08a(0x186)],_0x5cc078[_0x36a08a(0x1d2)]);return!![];case _0x36a08a(0x1e8):this['handleOffer'](_0x5cc078['session_id'],_0x5cc078[_0x36a08a(0x21d)]);return!![];case _0x36a08a(0x1a0):this[_0x36a08a(0x23a)](_0x5cc078[_0x36a08a(0x186)],_0x5cc078['candidate']);return!![];case _0x36a08a(0x1f6):this[_0x36a08a(0x1b9)](_0x5cc078['session_id']);return!![];default:console[_0x36a08a(0x220)](_0x36a08a(0x224)+_0x5cc078['op']);return![];}}[a6_0x5caf34(0x1ce)](_0x1a541a){const _0x38822b=a6_0x5caf34;if(this[_0x38822b(0x23b)][_0x38822b(0x217)](_0x1a541a)){const _0x41ccc7=this['sharedVideoSources'][_0x38822b(0x214)](_0x1a541a);return _0x41ccc7[_0x38822b(0x1d9)]++,console[_0x38822b(0x1e1)](_0x38822b(0x185)+_0x1a541a+'\x20('+_0x41ccc7[_0x38822b(0x1d9)]+_0x38822b(0x211)),_0x41ccc7;}console[_0x38822b(0x1e1)](_0x38822b(0x1c9)+_0x1a541a);const {createCanvas:_0x2e89f5}=require('canvas'),_0x358cff=_0x2e89f5(config[_0x38822b(0x1d6)][_0x38822b(0x1cf)][_0x38822b(0x1e6)],config[_0x38822b(0x1d6)][_0x38822b(0x1cf)][_0x38822b(0x1a6)]),_0x47eb71=_0x358cff[_0x38822b(0x206)]('2d');this[_0x38822b(0x218)](_0x358cff,_0x47eb71);const {RTCVideoSource:_0x2923da}=nonstandard,_0x134a5d=new _0x2923da();let _0x1483ca=0x0;const _0x16bc34=0x3e8/config[_0x38822b(0x1d6)][_0x38822b(0x1cf)][_0x38822b(0x231)],_0x4de89e=this[_0x38822b(0x18c)](_0x1a541a,_0x660be7=>{const _0x369e80=_0x38822b,_0x484cda=Date[_0x369e80(0x1b3)]();_0x484cda-_0x1483ca>=_0x16bc34&&(_0x1483ca=_0x484cda,this[_0x369e80(0x1bf)](_0x358cff,_0x47eb71,_0x660be7,_0x1a541a,_0x134a5d));}),_0x489f53={'videoSource':_0x134a5d,'canvas':_0x358cff,'rosSubscriber':_0x4de89e,'frameCount':0x1,'topic':_0x1a541a};return this[_0x38822b(0x23b)][_0x38822b(0x22d)](_0x1a541a,_0x489f53),_0x489f53;}['releaseSharedVideoSource'](_0x1a5253){const _0x211cbe=a6_0x5caf34,_0x5d192c=this[_0x211cbe(0x23b)][_0x211cbe(0x214)](_0x1a5253);if(!_0x5d192c)return;_0x5d192c['frameCount']--,console[_0x211cbe(0x1e1)]('[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x1a5253+'\x20('+_0x5d192c['frameCount']+_0x211cbe(0x1d0)),_0x5d192c[_0x211cbe(0x1d9)]<=0x0&&(console[_0x211cbe(0x1e1)](_0x211cbe(0x1b7)+_0x1a5253+_0x211cbe(0x234)),_0x5d192c[_0x211cbe(0x1b4)]&&(_0x5d192c[_0x211cbe(0x1b4)]=null),_0x5d192c[_0x211cbe(0x1d7)]&&_0x5d192c[_0x211cbe(0x1d7)][_0x211cbe(0x1fb)](),this[_0x211cbe(0x23b)][_0x211cbe(0x1ed)](_0x1a5253));}async['initializeSession'](_0x328f57,_0x4c7db0){const _0x434a14=a6_0x5caf34;try{console[_0x434a14(0x1e1)](_0x434a14(0x19d)+_0x328f57+_0x434a14(0x202)+_0x4c7db0);const _0x3ea780=this['getOrCreateSharedVideoSource'](_0x4c7db0),_0x33e072=new RTCPeerConnection(this[_0x434a14(0x1c8)]),_0x549208=_0x3ea780['videoSource'][_0x434a14(0x1b2)]({'width':config[_0x434a14(0x1d6)][_0x434a14(0x1cf)][_0x434a14(0x1e6)],'height':config[_0x434a14(0x1d6)][_0x434a14(0x1cf)][_0x434a14(0x1a6)],'framerate':config[_0x434a14(0x1d6)]['video']['framerate']});console[_0x434a14(0x1e1)]('[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20'+_0x328f57);const {MediaStream:_0xab640c}=require(_0x434a14(0x1f7)),_0x488162=new _0xab640c([_0x549208]);_0x33e072['addTrack'](_0x549208,_0x488162),this[_0x434a14(0x203)](_0x3ea780[_0x434a14(0x1b4)],_0x3ea780[_0x434a14(0x1d3)]),_0x33e072[_0x434a14(0x1db)]=_0x312879=>{const _0x5e333d=_0x434a14;if(_0x312879['candidate']&&this[_0x5e333d(0x175)])console[_0x5e333d(0x1e1)](_0x5e333d(0x23c)+_0x328f57+':',{'type':_0x312879[_0x5e333d(0x19a)][_0x5e333d(0x1ca)],'protocol':_0x312879[_0x5e333d(0x19a)][_0x5e333d(0x1ac)],'address':_0x312879[_0x5e333d(0x19a)][_0x5e333d(0x1c3)],'port':_0x312879['candidate'][_0x5e333d(0x194)]}),this[_0x5e333d(0x175)][_0x5e333d(0x209)](JSON['stringify']({'op':_0x5e333d(0x1a0),'session_id':_0x328f57,'candidate':_0x312879[_0x5e333d(0x19a)]}));else!_0x312879[_0x5e333d(0x19a)]&&console['log']('[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20'+_0x328f57);},_0x33e072['onconnectionstatechange']=()=>{const _0x2d2ef8=_0x434a14;console[_0x2d2ef8(0x1e1)](_0x2d2ef8(0x190)+_0x328f57+'\x20connection\x20state:\x20'+_0x33e072[_0x2d2ef8(0x188)]);if(_0x33e072['connectionState']==='connected')console[_0x2d2ef8(0x1e1)](_0x2d2ef8(0x190)+_0x328f57+_0x2d2ef8(0x223));else{if(_0x33e072[_0x2d2ef8(0x188)]==='failed')console[_0x2d2ef8(0x1e1)](_0x2d2ef8(0x190)+_0x328f57+_0x2d2ef8(0x172)),this['stopSession'](_0x328f57);else _0x33e072[_0x2d2ef8(0x188)]===_0x2d2ef8(0x173)&&(console[_0x2d2ef8(0x1e1)](_0x2d2ef8(0x190)+_0x328f57+_0x2d2ef8(0x180)),this[_0x2d2ef8(0x1af)](_0x328f57));}},this[_0x434a14(0x21e)][_0x434a14(0x22d)](_0x328f57,{'peerConnection':_0x33e072,'topic':_0x4c7db0,'videoTrack':_0x549208,'mediaStream':_0x488162,'status':_0x434a14(0x1e0)}),!this['topicSessions'][_0x434a14(0x217)](_0x4c7db0)&&this[_0x434a14(0x1c6)]['set'](_0x4c7db0,new Set()),this['topicSessions']['get'](_0x4c7db0)[_0x434a14(0x184)](_0x328f57),console[_0x434a14(0x1e1)](_0x434a14(0x190)+_0x328f57+'\x20initialized\x20successfully'),console[_0x434a14(0x1e1)](_0x434a14(0x1bd)+_0x4c7db0+':\x20'+this[_0x434a14(0x1c6)][_0x434a14(0x214)](_0x4c7db0)[_0x434a14(0x1b5)]);}catch(_0x16ec52){console[_0x434a14(0x1e4)]('[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20'+_0x328f57+':',_0x16ec52),this[_0x434a14(0x1b9)](_0x328f57);}}async['handleOffer'](_0x9e8711,_0xca5e67){const _0x54af1f=a6_0x5caf34,_0x4f27da=this[_0x54af1f(0x21e)][_0x54af1f(0x214)](_0x9e8711);if(!_0x4f27da){console['error'](_0x54af1f(0x1be)+_0x9e8711);return;}try{console[_0x54af1f(0x1e1)](_0x54af1f(0x1c4)+_0x9e8711),await _0x4f27da['peerConnection']['setRemoteDescription'](new RTCSessionDescription(_0xca5e67)),console[_0x54af1f(0x1e1)](_0x54af1f(0x18e));const _0x279739=await _0x4f27da[_0x54af1f(0x1ef)][_0x54af1f(0x227)]();console[_0x54af1f(0x1e1)](_0x54af1f(0x191)),await _0x4f27da[_0x54af1f(0x1ef)][_0x54af1f(0x19c)](_0x279739),console['log'](_0x54af1f(0x1a5)),this[_0x54af1f(0x175)]&&(this[_0x54af1f(0x175)][_0x54af1f(0x209)](JSON[_0x54af1f(0x238)]({'op':_0x54af1f(0x1df),'session_id':_0x9e8711,'answer':_0x279739})),console[_0x54af1f(0x1e1)](_0x54af1f(0x1aa)+_0x9e8711));}catch(_0x1b70a8){console[_0x54af1f(0x1e4)](_0x54af1f(0x1a2)+_0x9e8711+':',_0x1b70a8),this[_0x54af1f(0x1b9)](_0x9e8711);}}async[a6_0x5caf34(0x23a)](_0x4f2a60,_0x20ed37){const _0x37fdc2=a6_0x5caf34,_0x31a51e=this[_0x37fdc2(0x21e)][_0x37fdc2(0x214)](_0x4f2a60);if(!_0x31a51e){console[_0x37fdc2(0x1e4)](_0x37fdc2(0x1fd)+_0x4f2a60);return;}try{await _0x31a51e[_0x37fdc2(0x1ef)][_0x37fdc2(0x228)](new RTCIceCandidate(_0x20ed37)),console[_0x37fdc2(0x1e1)](_0x37fdc2(0x1ae)+_0x4f2a60);}catch(_0x102ff8){console[_0x37fdc2(0x1e4)](_0x37fdc2(0x219)+_0x4f2a60+':',_0x102ff8);}}['subscribeToROSTopic'](_0x2f77c9,_0x3a1c25){const _0x1f3acf=a6_0x5caf34;if(!this[_0x1f3acf(0x210)]||this[_0x1f3acf(0x210)][_0x1f3acf(0x1b6)]!==this[_0x1f3acf(0x210)][_0x1f3acf(0x1fe)])return console[_0x1f3acf(0x1e4)](_0x1f3acf(0x1ee)),null;console[_0x1f3acf(0x1e1)]('[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20'+_0x2f77c9);const _0x2dfec8=_0x2f77c9[_0x1f3acf(0x225)](_0x1f3acf(0x1ff)),_0xce363c=_0x2f77c9[_0x1f3acf(0x225)](_0x1f3acf(0x1e7))||_0x2f77c9[_0x1f3acf(0x225)](_0x1f3acf(0x201));let _0xb0308c=[];_0x2dfec8?_0xce363c?_0xb0308c=[_0x1f3acf(0x1c0),_0x1f3acf(0x1d5),'compressed_depth_image_transport/CompressedDepthImage','sensor_msgs/Image']:_0xb0308c=[_0x1f3acf(0x178),'sensor_msgs/msg/Image',_0x1f3acf(0x1c0)]:_0xb0308c=[_0x1f3acf(0x1c0),_0x1f3acf(0x1d5),_0x1f3acf(0x178)];console[_0x1f3acf(0x1e1)](_0x1f3acf(0x20c)+_0x2f77c9+_0x1f3acf(0x189)+(_0x2dfec8?_0x1f3acf(0x1ff):'color')+_0x1f3acf(0x229),_0xb0308c);const _0x33eb7f=[];let _0x5efb32=![];const _0x205499=_0x5861b8=>{return _0x4f95c3=>{const _0x13baa9=a6_0x3419;try{const _0xef15c7=JSON[_0x13baa9(0x1e3)](_0x4f95c3[_0x13baa9(0x21b)]);_0xef15c7['op']==='publish'&&_0xef15c7['topic']===_0x2f77c9&&_0xef15c7[_0x13baa9(0x1fc)]&&(!_0x5efb32&&(console[_0x13baa9(0x1e1)](_0x13baa9(0x1a8)+_0x2f77c9+_0x13baa9(0x195)+_0x5861b8),_0x5efb32=!![]),_0x3a1c25(_0xef15c7['msg']));}catch(_0x29c140){console['error'](_0x13baa9(0x1fa),_0x29c140);}};};for(const _0x405ae8 of _0xb0308c){const _0x527eab={'op':'subscribe','topic':_0x2f77c9,'type':_0x405ae8};console[_0x1f3acf(0x1e1)](_0x1f3acf(0x1de)+_0x405ae8),this[_0x1f3acf(0x210)][_0x1f3acf(0x209)](JSON[_0x1f3acf(0x238)](_0x527eab));const _0x1dcb62=_0x205499(_0x405ae8);this[_0x1f3acf(0x210)][_0x1f3acf(0x18d)](_0x1f3acf(0x1ba),_0x1dcb62),_0x33eb7f[_0x1f3acf(0x17f)]({'handler':_0x1dcb62,'type':_0x405ae8});}return _0x2dfec8&&_0xce363c&&setTimeout(()=>{const _0x5502a3=_0x1f3acf;if(!_0x5efb32){console[_0x5502a3(0x1e1)](_0x5502a3(0x1d4)+_0x2f77c9+_0x5502a3(0x1f4));const _0xdb5720=_0x2f77c9[_0x5502a3(0x221)](_0x5502a3(0x1eb),'')['replace']('/compressed',''),_0x196cd4=[_0xdb5720+_0x5502a3(0x1dc),_0xdb5720+_0x5502a3(0x1c1),_0xdb5720];for(const _0xc9d947 of _0x196cd4){console[_0x5502a3(0x1e1)](_0x5502a3(0x1a4)+_0xc9d947);const _0x396aa2={'op':_0x5502a3(0x17a),'topic':_0xc9d947,'type':'sensor_msgs/Image'};this['rosbridgeWs'][_0x5502a3(0x209)](JSON[_0x5502a3(0x238)](_0x396aa2));const _0x4e6411=_0x5a35bf=>{const _0xba1567=_0x5502a3;try{const _0xe12dde=JSON['parse'](_0x5a35bf['data']);_0xe12dde['op']===_0xba1567(0x226)&&_0xe12dde['topic']===_0xc9d947&&_0xe12dde[_0xba1567(0x1fc)]&&(console[_0xba1567(0x1e1)]('[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20'+_0xc9d947+_0xba1567(0x1ad)),_0xe12dde[_0xba1567(0x1fc)][_0xba1567(0x21b)]&&!_0xe12dde['msg'][_0xba1567(0x21b)]['startsWith']('/9j/')&&_0x3a1c25(_0xe12dde[_0xba1567(0x1fc)]));}catch(_0x54cb08){console[_0xba1567(0x1e4)](_0xba1567(0x182),_0x54cb08);}};this[_0x5502a3(0x210)][_0x5502a3(0x18d)](_0x5502a3(0x1ba),_0x4e6411),_0x33eb7f[_0x5502a3(0x17f)]({'handler':_0x4e6411,'type':'sensor_msgs/Image','topic':_0xc9d947});}}},0xbb8),{'unsubscribe':()=>{const _0x2426a5=_0x1f3acf;for(const {handler:_0x35d4d4,type:_0x3a937d,topic:_0x4c03c8}of _0x33eb7f){this[_0x2426a5(0x210)][_0x2426a5(0x177)]('message',_0x35d4d4),this[_0x2426a5(0x210)][_0x2426a5(0x1b6)]===this[_0x2426a5(0x210)][_0x2426a5(0x1fe)]&&this[_0x2426a5(0x210)][_0x2426a5(0x209)](JSON[_0x2426a5(0x238)]({'op':'unsubscribe','topic':_0x4c03c8||_0x2f77c9}));}}};}[a6_0x5caf34(0x218)](_0xcad0b1,_0x30aca8){const _0x103c84=a6_0x5caf34;_0x30aca8[_0x103c84(0x17d)]=_0x103c84(0x22b),_0x30aca8[_0x103c84(0x235)](0x0,0x0,_0xcad0b1[_0x103c84(0x1e6)],_0xcad0b1[_0x103c84(0x1a6)]),_0x30aca8[_0x103c84(0x17d)]=_0x103c84(0x1a3),_0x30aca8[_0x103c84(0x1bb)]=_0x103c84(0x1b1),_0x30aca8[_0x103c84(0x193)]=_0x103c84(0x21f),_0x30aca8[_0x103c84(0x17c)]('🤖\x20Robot\x20Camera',_0xcad0b1[_0x103c84(0x1e6)]/0x2,_0xcad0b1[_0x103c84(0x1a6)]/0x2-0x14),_0x30aca8[_0x103c84(0x17d)]=_0x103c84(0x21c),_0x30aca8['font']=_0x103c84(0x1f3),_0x30aca8[_0x103c84(0x17c)]('Waiting\x20for\x20ROS\x20image\x20data...',_0xcad0b1[_0x103c84(0x1e6)]/0x2,_0xcad0b1[_0x103c84(0x1a6)]/0x2+0x14);const _0xa1edee=Date[_0x103c84(0x1b3)]()/0x3e8;for(let _0x4fb491=0x0;_0x4fb491<0x3;_0x4fb491++){const _0xd5c543=(Math[_0x103c84(0x1f2)](_0xa1edee*0x2+_0x4fb491*0.5)+0x1)/0x2;_0x30aca8[_0x103c84(0x17d)]='rgba(0,\x20170,\x20255,\x20'+_0xd5c543*0.5+')',_0x30aca8['beginPath'](),_0x30aca8['arc'](_0xcad0b1['width']/0x2-0x28+_0x4fb491*0x28,_0xcad0b1[_0x103c84(0x1a6)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x30aca8['fill']();}}[a6_0x5caf34(0x203)](_0xfd792c,_0x3382a6){const _0x457122=a6_0x5caf34;try{if(!_0xfd792c||!_0x3382a6)return;const _0xb1e564=_0x3382a6[_0x457122(0x206)]('2d'),_0x58f8ee=_0xb1e564[_0x457122(0x1b8)](0x0,0x0,_0x3382a6[_0x457122(0x1e6)],_0x3382a6[_0x457122(0x1a6)]),_0x41f094=this[_0x457122(0x204)](_0x58f8ee[_0x457122(0x21b)],_0x3382a6[_0x457122(0x1e6)],_0x3382a6['height']),_0x5d8b47={'width':_0x3382a6['width'],'height':_0x3382a6[_0x457122(0x1a6)],'data':_0x41f094};typeof _0xfd792c['onFrame']===_0x457122(0x198)&&_0xfd792c[_0x457122(0x197)](_0x5d8b47);}catch(_0x14aed0){console[_0x457122(0x1e4)]('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x14aed0);}}[a6_0x5caf34(0x204)](_0x1e255a,_0x535f53,_0x2a847b){const _0x4df0e7=a6_0x5caf34,_0x4343b1=_0x535f53*_0x2a847b,_0x38578a=_0x535f53*_0x2a847b/0x4,_0x45051e=new Uint8Array(_0x4343b1+_0x38578a*0x2);let _0x2f2b01=0x0,_0x3bc813=_0x4343b1,_0x6526e=_0x4343b1+_0x38578a;for(let _0x3e82b9=0x0;_0x3e82b9<_0x2a847b;_0x3e82b9++){for(let _0x5e5437=0x0;_0x5e5437<_0x535f53;_0x5e5437++){const _0x5087e6=(_0x3e82b9*_0x535f53+_0x5e5437)*0x4,_0x3316b3=_0x1e255a[_0x5087e6],_0x71fb08=_0x1e255a[_0x5087e6+0x1],_0x1d0c3f=_0x1e255a[_0x5087e6+0x2],_0x21d860=Math[_0x4df0e7(0x1a7)](0.299*_0x3316b3+0.587*_0x71fb08+0.114*_0x1d0c3f);_0x45051e[_0x2f2b01++]=_0x21d860;if(_0x3e82b9%0x2===0x0&&_0x5e5437%0x2===0x0){const _0x4ade58=Math[_0x4df0e7(0x1a7)](-0.169*_0x3316b3-0.331*_0x71fb08+0.5*_0x1d0c3f+0x80),_0x20a8e3=Math[_0x4df0e7(0x1a7)](0.5*_0x3316b3-0.419*_0x71fb08-0.081*_0x1d0c3f+0x80);_0x45051e[_0x3bc813++]=Math[_0x4df0e7(0x199)](0x0,Math[_0x4df0e7(0x192)](0xff,_0x4ade58)),_0x45051e[_0x6526e++]=Math['max'](0x0,Math['min'](0xff,_0x20a8e3));}}}return _0x45051e;}async['updateCanvasWithImageData'](_0x5ce898,_0x42be93,_0x484431,_0x1e9ba8,_0x4f3b56){const _0x885474=a6_0x5caf34;try{if(!_0x484431||!_0x484431['data'])return;Math[_0x885474(0x18a)]()<0.01&&console[_0x885474(0x1e1)](_0x885474(0x1e5)+_0x1e9ba8+_0x885474(0x174)+_0x484431['data']['length']+_0x885474(0x1e9));const _0x547c83=Buffer[_0x885474(0x19e)](_0x484431['data'],'base64'),_0x2542ba=this[_0x885474(0x17e)][_0x885474(0x205)](_0x1e9ba8);let _0x2e1e24;_0x2542ba?_0x2e1e24=await this['depthProcessor'][_0x885474(0x1ec)](_0x547c83,_0x5ce898,_0x42be93,_0x1e9ba8):_0x2e1e24=await this['depthProcessor'][_0x885474(0x237)](_0x547c83,_0x5ce898,_0x42be93),_0x42be93[_0x885474(0x179)](_0x2e1e24,0x0,0x0),_0x42be93[_0x885474(0x17d)]='rgba(0,\x200,\x200,\x200.7)',_0x42be93[_0x885474(0x235)](0xa,0xa,0xdc,0x32),_0x42be93[_0x885474(0x17d)]=_0x2542ba?_0x885474(0x213):'#00ff00',_0x42be93['font']=_0x885474(0x20f),_0x42be93[_0x885474(0x17c)]((_0x2542ba?_0x885474(0x18f):'📹\x20Color')+':\x20'+new Date()[_0x885474(0x176)](),0xf,0x1c),_0x42be93[_0x885474(0x17d)]=_0x885474(0x21c),_0x42be93[_0x885474(0x1bb)]=_0x885474(0x20b),_0x42be93[_0x885474(0x17c)]('Topic:\x20'+_0x1e9ba8[_0x885474(0x1a1)]('/')[_0x885474(0x1f5)](),0xf,0x2d),this[_0x885474(0x203)](_0x4f3b56,_0x5ce898);}catch(_0x368ab5){console['warn'](_0x885474(0x1bc)+_0x1e9ba8+':',_0x368ab5['message']);_0x1e9ba8[_0x885474(0x225)](_0x885474(0x1ff))&&Math[_0x885474(0x18a)]()<0.1&&console[_0x885474(0x220)]('[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20'+_0x1e9ba8[_0x885474(0x221)](_0x885474(0x1eb),_0x885474(0x1dc)));_0x42be93[_0x885474(0x17d)]=_0x885474(0x22b),_0x42be93['fillRect'](0x0,0x0,_0x5ce898[_0x885474(0x1e6)],_0x5ce898[_0x885474(0x1a6)]),_0x42be93[_0x885474(0x17d)]='#888',_0x42be93['font']=_0x885474(0x1f3),_0x42be93[_0x885474(0x193)]=_0x885474(0x21f);const _0x171024=_0x1e9ba8['includes'](_0x885474(0x1ff))?_0x885474(0x19f):_0x885474(0x22e);_0x42be93[_0x885474(0x17c)](_0x171024,_0x5ce898[_0x885474(0x1e6)]/0x2,_0x5ce898['height']/0x2),_0x42be93[_0x885474(0x17d)]='#666',_0x42be93[_0x885474(0x1bb)]=_0x885474(0x215),_0x42be93[_0x885474(0x17c)](_0x885474(0x1d1)+_0x1e9ba8[_0x885474(0x1a1)]('/')[_0x885474(0x1f5)](),_0x5ce898[_0x885474(0x1e6)]/0x2,_0x5ce898[_0x885474(0x1a6)]/0x2+0x19),this['sendFrameToVideoSource'](_0x4f3b56,_0x5ce898);}}[a6_0x5caf34(0x1b9)](_0x4c2d3f){const _0xf44b61=a6_0x5caf34,_0x28098d=this[_0xf44b61(0x21e)][_0xf44b61(0x214)](_0x4c2d3f);if(!_0x28098d){console[_0xf44b61(0x220)](_0xf44b61(0x20a)+_0x4c2d3f);return;}console['log'](_0xf44b61(0x17b)+_0x4c2d3f+_0xf44b61(0x1c5)+_0x28098d['topic']);try{this[_0xf44b61(0x175)]&&this['serverWs'][_0xf44b61(0x1b6)]===this[_0xf44b61(0x175)][_0xf44b61(0x1fe)]&&this['serverWs'][_0xf44b61(0x209)](JSON['stringify']({'op':_0xf44b61(0x1f6),'session_id':_0x4c2d3f})),_0x28098d[_0xf44b61(0x21a)]&&_0x28098d[_0xf44b61(0x21a)][_0xf44b61(0x232)](),_0x28098d[_0xf44b61(0x1ef)]&&_0x28098d['peerConnection'][_0xf44b61(0x208)]();}catch(_0x3ea3b8){console[_0xf44b61(0x1e4)]('[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20'+_0x3ea3b8);}this['cleanupSession'](_0x4c2d3f);}[a6_0x5caf34(0x1af)](_0x11acdf){const _0x5e49cf=a6_0x5caf34,_0x40135e=this[_0x5e49cf(0x21e)][_0x5e49cf(0x214)](_0x11acdf);if(_0x40135e){const _0x218992=this[_0x5e49cf(0x1c6)]['get'](_0x40135e[_0x5e49cf(0x1d2)]);_0x218992&&(_0x218992[_0x5e49cf(0x1ed)](_0x11acdf),_0x218992[_0x5e49cf(0x1b5)]===0x0&&this[_0x5e49cf(0x1c6)]['delete'](_0x40135e[_0x5e49cf(0x1d2)])),this[_0x5e49cf(0x20e)](_0x40135e[_0x5e49cf(0x1d2)]);}this['activeSessions']['delete'](_0x11acdf),console[_0x5e49cf(0x1e1)](_0x5e49cf(0x1d8)+_0x11acdf);}[a6_0x5caf34(0x222)](){const _0x12203b=a6_0x5caf34;console[_0x12203b(0x1e1)](_0x12203b(0x1cd));const _0x5ef35b=Array[_0x12203b(0x19e)](this['activeSessions'][_0x12203b(0x187)]());_0x5ef35b[_0x12203b(0x18b)](_0x5ce2db=>this[_0x12203b(0x1b9)](_0x5ce2db));}[a6_0x5caf34(0x181)](){const _0x2ee7b1=a6_0x5caf34,_0x533020=[];for(const [_0x940af,_0x52900a]of this[_0x2ee7b1(0x21e)]){_0x533020['push']({'sessionId':_0x940af,'topic':_0x52900a['topic'],'connectionState':_0x52900a['peerConnection']?.[_0x2ee7b1(0x188)]||'unknown','hasVideoTrack':!!_0x52900a['videoTrack']});}return _0x533020;}['getSharedVideoSources'](){const _0x42fe18=a6_0x5caf34,_0x30ea00=[];for(const [_0x534615,_0x48389b]of this[_0x42fe18(0x23b)]){_0x30ea00[_0x42fe18(0x17f)]({'topic':_0x534615,'frameCount':_0x48389b['frameCount'],'hasVideoSource':!!_0x48389b[_0x42fe18(0x1b4)],'hasRosSubscriber':!!_0x48389b['rosSubscriber']});}return _0x30ea00;}}function a6_0x4cda(){const _0x769e51=['fillStyle','depthProcessor','push','\x20connection\x20closed,\x20cleaning\x20up','getActiveSessions','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','105684dgmNZS','add','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','session_id','keys','connectionState','\x20detected\x20as\x20','random','forEach','subscribeToROSTopic','addEventListener','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','🔍\x20Depth','[WebRTC\x20Appliance]\x20Session\x20','[WebRTC\x20Appliance]\x20Created\x20answer','min','textAlign','port','\x20with\x20message\x20type\x20','search','onFrame','function','max','candidate','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','setLocalDescription','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','from','🔍\x20Processing\x20depth...','webrtc_ice_candidate','split','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','#00aaff','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','height','round','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','webrtc_init_session','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','handleMessage','protocol',',\x20converting\x20to\x20base64...','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','cleanupSession','toString','24px\x20Arial','createTrack','now','videoSource','size','readyState','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','getImageData','stopSession','message','font','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','updateCanvasWithImageData','sensor_msgs/CompressedImage','/image','[WebRTC\x20Appliance]\x20Service\x20initialized','address','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','\x20for\x20topic:\x20','topicSessions','serverUrl','rtcConfig','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','type','./turnCredentialsService','startsWith','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','getOrCreateSharedVideoSource','video','\x20sessions\x20remaining)','Topic:\x20','topic','canvas','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','sensor_msgs/msg/CompressedImage','webrtc','rosSubscriber','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','frameCount','16XgMUaG','onicecandidate','/image_raw','constructor','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','webrtc_answer','initializing','log','3107997hGCvCo','parse','error','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','width','compressed','webrtc_offer','\x20bytes','stun:stun.l.google.com:19302','/compressedDepth','processDepthImage','delete','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','peerConnection','initialize','2666640MqaMmG','sin','16px\x20Arial',',\x20trying\x20alternative\x20depth\x20topics','pop','webrtc_stop_session','wrtc','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','initializeSession','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','unsubscribe','msg','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','OPEN','depth','(((.+)+)+)+$','compressedDepth','\x20for\x20topic\x20','sendFrameToVideoSource','convertRGBAtoI420','isDepthTopic','getContext','2643174YzdvIY','close','send','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','10px\x20monospace','[WebRTC\x20Appliance]\x20Topic\x20','apply','releaseSharedVideoSource','12px\x20monospace','rosbridgeWs','\x20sessions)','sharp','#00ffff','get','12px\x20Arial','updateTurnCredentials','has','drawLoadingPattern','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','videoTrack','data','#ffffff','offer','activeSessions','center','warn','replace','stopAllSessions','\x20successfully\x20connected!','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','includes','publish','createAnswer','addIceCandidate','\x20image,\x20trying\x20message\x20types:','2421573YnwOXk','#1a1a1a','webrtc_','set','📹\x20Processing\x20video...','1645992cUFufZ','../config','framerate','stop','410086LYmAOD',',\x20cleaning\x20up\x20shared\x20resources','fillRect','2FbaJyM','processColorImage','stringify','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','handleIceCandidate','sharedVideoSources','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','\x20connection\x20failed,\x20stopping\x20session','closed',',\x20size:\x20','serverWs','toLocaleTimeString','removeEventListener','sensor_msgs/Image','putImageData','subscribe','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','fillText'];a6_0x4cda=function(){return _0x769e51;};return a6_0x4cda();}module['exports']=new ApplianceWebRTCService();