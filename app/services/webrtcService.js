function a6_0x567a(_0x177298,_0x53f14a){const _0x55dae5=a6_0x4c1f();return a6_0x567a=function(_0x4e7133,_0xc06a8a){_0x4e7133=_0x4e7133-0x16a;let _0x4c1f6a=_0x55dae5[_0x4e7133];return _0x4c1f6a;},a6_0x567a(_0x177298,_0x53f14a);}const a6_0x30d0f2=a6_0x567a;(function(_0x275039,_0x1f1b4a){const _0x57487a=a6_0x567a,_0x1e2dfe=_0x275039();while(!![]){try{const _0x49ea5e=-parseInt(_0x57487a(0x1f9))/0x1+-parseInt(_0x57487a(0x1eb))/0x2*(parseInt(_0x57487a(0x1d3))/0x3)+-parseInt(_0x57487a(0x183))/0x4+parseInt(_0x57487a(0x1a9))/0x5+-parseInt(_0x57487a(0x182))/0x6*(-parseInt(_0x57487a(0x22b))/0x7)+-parseInt(_0x57487a(0x196))/0x8*(parseInt(_0x57487a(0x221))/0x9)+parseInt(_0x57487a(0x20a))/0xa;if(_0x49ea5e===_0x1f1b4a)break;else _0x1e2dfe['push'](_0x1e2dfe['shift']());}catch(_0x5c856d){_0x1e2dfe['push'](_0x1e2dfe['shift']());}}}(a6_0x4c1f,0x81544));function a6_0x4c1f(){const _0x560e14=['close','initializing','keys','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','sensor_msgs/msg/Image','sensor_msgs/msg/CompressedImage','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','../config','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','setLocalDescription','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','\x20bytes','height','address','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','split','addTrack','31235JHrJEA','stun:stun1.l.google.com:19302','12px\x20monospace','from','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','convertRGBAtoI420','rtcConfig','updateTurnCredentials','/compressedDepth','handleMessage','function','rgba(0,\x20170,\x20255,\x20','handleIceCandidate','webrtc_stop_session','getActiveSessions','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','\x20for\x20topic\x20','setRemoteDescription','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','has','rosSubscriber','fillRect','includes','arc','activeSessions','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','topic','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','updateCanvasWithImageData','🤖\x20Robot\x20Camera','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','error','12px\x20Arial','drawLoadingPattern','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','rosbridgeWs','sharedVideoSources','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','base64','unknown','videoTrack','5391XjWliT','onicecandidate','getOrCreateSharedVideoSource','failed','onFrame','video','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers',',\x20trying\x20alternative\x20depth\x20topics','[WebRTC\x20Appliance]\x20Session\x20','data','/image_raw','size','publish','peerConnection','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','max','subscribeToROSTopic','message','offer','font','add','closed','#888','418FifVhZ','depth','webrtc_ice_candidate','videoSource','unsubscribe','warn','constructor','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','fillText','#666','24px\x20Arial','subscribe','pop','putImageData','357111NHnImQ','\x20connection\x20closed,\x20cleaning\x20up','webrtc','toString','sharp','min','getSharedVideoSources','getContext','🔍\x20Depth','createTrack','round','set','color','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','processColorImage','\x20detected\x20as\x20','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','23651840MPxeQH','exports','removeEventListener','apply','candidate','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','delete','get','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','stopSession','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20',',\x20size:\x20','sendFrameToVideoSource','textAlign','iceServers','wrtc','center','stringify','fill','[WebRTC\x20Appliance]\x20Created\x20answer','\x20sessions)','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','\x20connection\x20state:\x20','18rkhEDr','compressedDepth','OPEN','fillStyle','now',',\x20converting\x20to\x20base64...','sensor_msgs/Image','Topic:\x20','startsWith','rgba(0,\x200,\x200,\x200.7)','182BaCugB','releaseSharedVideoSource','search','depthProcessor','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','\x20with\x20message\x20type\x20','addEventListener','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','connected','frameCount','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','width','log','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','📹\x20Color','push','send','\x20for\x20topic:\x20','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','#00ffff','type','replace','stun:stun.l.google.com:19302','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','framerate','(((.+)+)+)+$','toLocaleTimeString','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','processDepthImage','stopAllSessions','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','topicSessions','serverWs','parse','#ffffff','readyState','initialize','52506lBLTep','2782812pJnWZX','webrtc_init_session','/9j/','cleanupSession','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','\x20successfully\x20connected!','connectionState','/image',',\x20cleaning\x20up\x20shared\x20resources','addIceCandidate','sensor_msgs/CompressedImage','initializeSession','#00ff00','onconnectionstatechange','msg','session_id','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','#1a1a1a','2563352bBzzNt','16px\x20Arial'];a6_0x4c1f=function(){return _0x560e14;};return a6_0x4c1f();}const a6_0xc06a8a=(function(){let _0x22067a=!![];return function(_0x100176,_0xa698e0){const _0x24db47=_0x22067a?function(){const _0xb635b7=a6_0x567a;if(_0xa698e0){const _0x423ba0=_0xa698e0[_0xb635b7(0x20d)](_0x100176,arguments);return _0xa698e0=null,_0x423ba0;}}:function(){};return _0x22067a=![],_0x24db47;};}()),a6_0x4e7133=a6_0xc06a8a(this,function(){const _0x88c035=a6_0x567a;return a6_0x4e7133[_0x88c035(0x1fc)]()[_0x88c035(0x22d)](_0x88c035(0x176))[_0x88c035(0x1fc)]()[_0x88c035(0x1f1)](a6_0x4e7133)[_0x88c035(0x22d)](_0x88c035(0x176));});a6_0x4e7133();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x30d0f2(0x219)),sharp=require(a6_0x30d0f2(0x1fd)),config=require(a6_0x30d0f2(0x19f)),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require('./turnCredentialsService');class ApplianceWebRTCService{constructor(){const _0x3a8f7d=a6_0x30d0f2;this[_0x3a8f7d(0x1c1)]=new Map(),this[_0x3a8f7d(0x17c)]=new Map(),this[_0x3a8f7d(0x1ce)]=new Map(),this[_0x3a8f7d(0x1cd)]=null,this[_0x3a8f7d(0x17d)]=null,this['depthProcessor']=new DepthImageProcessor(),this[_0x3a8f7d(0x1af)]={'iceServers':[{'urls':_0x3a8f7d(0x172)},{'urls':_0x3a8f7d(0x1aa)}]};}[a6_0x30d0f2(0x181)](_0x435575,_0x4839b9){const _0x4906c7=a6_0x30d0f2;this['rosbridgeWs']=_0x435575,this[_0x4906c7(0x17d)]=_0x4839b9,turnCredentialsService[_0x4906c7(0x181)](config['serverUrl']),this[_0x4906c7(0x1b0)](),console['log']('[WebRTC\x20Appliance]\x20Service\x20initialized');}async[a6_0x30d0f2(0x1b0)](){const _0x10602b=a6_0x30d0f2;try{console[_0x10602b(0x237)](_0x10602b(0x17b));const _0x1556d7=await turnCredentialsService['getIceServers']();this[_0x10602b(0x1af)][_0x10602b(0x218)]=_0x1556d7,console[_0x10602b(0x237)](_0x10602b(0x194));}catch(_0xd14791){console[_0x10602b(0x1c8)](_0x10602b(0x1c7),_0xd14791),console[_0x10602b(0x237)](_0x10602b(0x1da));}}[a6_0x30d0f2(0x1b2)](_0xefeb1a){const _0x57e089=a6_0x30d0f2;if(!_0xefeb1a['op']||!_0xefeb1a['op']['startsWith']('webrtc_'))return![];console[_0x57e089(0x237)](_0x57e089(0x19e)+_0xefeb1a['op']);switch(_0xefeb1a['op']){case _0x57e089(0x184):this['initializeSession'](_0xefeb1a[_0x57e089(0x192)],_0xefeb1a[_0x57e089(0x1c3)]);return!![];case'webrtc_offer':this['handleOffer'](_0xefeb1a[_0x57e089(0x192)],_0xefeb1a[_0x57e089(0x1e6)]);return!![];case _0x57e089(0x1ed):this[_0x57e089(0x1b5)](_0xefeb1a[_0x57e089(0x192)],_0xefeb1a['candidate']);return!![];case'webrtc_stop_session':this[_0x57e089(0x213)](_0xefeb1a[_0x57e089(0x192)]);return!![];default:console[_0x57e089(0x1f0)](_0x57e089(0x235)+_0xefeb1a['op']);return![];}}[a6_0x30d0f2(0x1d5)](_0x6da69c){const _0xbc486c=a6_0x30d0f2;if(this[_0xbc486c(0x1ce)][_0xbc486c(0x1bc)](_0x6da69c)){const _0x3753d8=this['sharedVideoSources']['get'](_0x6da69c);return _0x3753d8[_0xbc486c(0x234)]++,console['log'](_0xbc486c(0x174)+_0x6da69c+'\x20('+_0x3753d8[_0xbc486c(0x234)]+_0xbc486c(0x21e)),_0x3753d8;}console[_0xbc486c(0x237)](_0xbc486c(0x1cf)+_0x6da69c);const {createCanvas:_0x1eed72}=require('canvas'),_0xbce74b=_0x1eed72(config['webrtc'][_0xbc486c(0x1d8)][_0xbc486c(0x236)],config[_0xbc486c(0x1fb)]['video'][_0xbc486c(0x1a4)]),_0x27ae68=_0xbce74b[_0xbc486c(0x200)]('2d');this[_0xbc486c(0x1ca)](_0xbce74b,_0x27ae68);const {RTCVideoSource:_0x5f575e}=nonstandard,_0x21d659=new _0x5f575e();let _0x4b6c29=0x0;const _0x235564=0x3e8/config['webrtc'][_0xbc486c(0x1d8)][_0xbc486c(0x175)],_0x85f502=this[_0xbc486c(0x1e4)](_0x6da69c,_0x47ebe7=>{const _0x2ced40=_0xbc486c,_0xbe4be5=Date[_0x2ced40(0x225)]();_0xbe4be5-_0x4b6c29>=_0x235564&&(_0x4b6c29=_0xbe4be5,this[_0x2ced40(0x1c5)](_0xbce74b,_0x27ae68,_0x47ebe7,_0x6da69c,_0x21d659));}),_0x3c8454={'videoSource':_0x21d659,'canvas':_0xbce74b,'rosSubscriber':_0x85f502,'frameCount':0x1,'topic':_0x6da69c};return this[_0xbc486c(0x1ce)][_0xbc486c(0x204)](_0x6da69c,_0x3c8454),_0x3c8454;}['releaseSharedVideoSource'](_0x2480ea){const _0x168bad=a6_0x30d0f2,_0x11a074=this['sharedVideoSources'][_0x168bad(0x211)](_0x2480ea);if(!_0x11a074)return;_0x11a074[_0x168bad(0x234)]--,console[_0x168bad(0x237)]('[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x2480ea+'\x20('+_0x11a074[_0x168bad(0x234)]+'\x20sessions\x20remaining)'),_0x11a074['frameCount']<=0x0&&(console[_0x168bad(0x237)]('[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20'+_0x2480ea+_0x168bad(0x18b)),_0x11a074[_0x168bad(0x1ee)]&&(_0x11a074[_0x168bad(0x1ee)]=null),_0x11a074[_0x168bad(0x1bd)]&&_0x11a074[_0x168bad(0x1bd)][_0x168bad(0x1ef)](),this[_0x168bad(0x1ce)]['delete'](_0x2480ea));}async[a6_0x30d0f2(0x18e)](_0x5bfdbb,_0x39435f){const _0x2844c4=a6_0x30d0f2;try{console[_0x2844c4(0x237)]('[WebRTC\x20Appliance]\x20Initializing\x20session\x20'+_0x5bfdbb+_0x2844c4(0x1b9)+_0x39435f);const _0x4270bf=this[_0x2844c4(0x1d5)](_0x39435f),_0x27f46a=new RTCPeerConnection(this[_0x2844c4(0x1af)]),_0x2a1064=_0x4270bf['videoSource'][_0x2844c4(0x202)]({'width':config['webrtc'][_0x2844c4(0x1d8)][_0x2844c4(0x236)],'height':config[_0x2844c4(0x1fb)]['video'][_0x2844c4(0x1a4)],'framerate':config[_0x2844c4(0x1fb)][_0x2844c4(0x1d8)][_0x2844c4(0x175)]});console[_0x2844c4(0x237)](_0x2844c4(0x178)+_0x5bfdbb);const {MediaStream:_0x134e95}=require(_0x2844c4(0x219)),_0x54e08c=new _0x134e95([_0x2a1064]);_0x27f46a[_0x2844c4(0x1a8)](_0x2a1064,_0x54e08c),this['sendFrameToVideoSource'](_0x4270bf['videoSource'],_0x4270bf['canvas']),_0x27f46a[_0x2844c4(0x1d4)]=_0x42b50a=>{const _0x23ad8e=_0x2844c4;if(_0x42b50a['candidate']&&this[_0x23ad8e(0x17d)])console[_0x23ad8e(0x237)](_0x23ad8e(0x21f)+_0x5bfdbb+':',{'type':_0x42b50a[_0x23ad8e(0x20e)][_0x23ad8e(0x170)],'protocol':_0x42b50a['candidate']['protocol'],'address':_0x42b50a[_0x23ad8e(0x20e)][_0x23ad8e(0x1a5)],'port':_0x42b50a['candidate']['port']}),this[_0x23ad8e(0x17d)][_0x23ad8e(0x16c)](JSON['stringify']({'op':_0x23ad8e(0x1ed),'session_id':_0x5bfdbb,'candidate':_0x42b50a[_0x23ad8e(0x20e)]}));else!_0x42b50a[_0x23ad8e(0x20e)]&&console[_0x23ad8e(0x237)](_0x23ad8e(0x1e2)+_0x5bfdbb);},_0x27f46a[_0x2844c4(0x190)]=()=>{const _0x1a53d4=_0x2844c4;console[_0x1a53d4(0x237)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x5bfdbb+_0x1a53d4(0x220)+_0x27f46a['connectionState']);if(_0x27f46a[_0x1a53d4(0x189)]===_0x1a53d4(0x233))console[_0x1a53d4(0x237)](_0x1a53d4(0x1dc)+_0x5bfdbb+_0x1a53d4(0x188));else{if(_0x27f46a[_0x1a53d4(0x189)]===_0x1a53d4(0x1d6))console['log'](_0x1a53d4(0x1dc)+_0x5bfdbb+'\x20connection\x20failed,\x20stopping\x20session'),this[_0x1a53d4(0x213)](_0x5bfdbb);else _0x27f46a['connectionState']===_0x1a53d4(0x1e9)&&(console[_0x1a53d4(0x237)](_0x1a53d4(0x1dc)+_0x5bfdbb+_0x1a53d4(0x1fa)),this['cleanupSession'](_0x5bfdbb));}},this[_0x2844c4(0x1c1)][_0x2844c4(0x204)](_0x5bfdbb,{'peerConnection':_0x27f46a,'topic':_0x39435f,'videoTrack':_0x2a1064,'mediaStream':_0x54e08c,'status':_0x2844c4(0x199)}),!this[_0x2844c4(0x17c)][_0x2844c4(0x1bc)](_0x39435f)&&this[_0x2844c4(0x17c)][_0x2844c4(0x204)](_0x39435f,new Set()),this['topicSessions'][_0x2844c4(0x211)](_0x39435f)[_0x2844c4(0x1e8)](_0x5bfdbb),console['log'](_0x2844c4(0x1dc)+_0x5bfdbb+'\x20initialized\x20successfully'),console['log'](_0x2844c4(0x187)+_0x39435f+':\x20'+this['topicSessions']['get'](_0x39435f)[_0x2844c4(0x1df)]);}catch(_0x535480){console[_0x2844c4(0x1c8)](_0x2844c4(0x1d9)+_0x5bfdbb+':',_0x535480),this['stopSession'](_0x5bfdbb);}}async['handleOffer'](_0x3e11ef,_0x30b2a5){const _0x11eda5=a6_0x30d0f2,_0x316660=this['activeSessions'][_0x11eda5(0x211)](_0x3e11ef);if(!_0x316660){console['error'](_0x11eda5(0x1f2)+_0x3e11ef);return;}try{console[_0x11eda5(0x237)](_0x11eda5(0x1c4)+_0x3e11ef),await _0x316660[_0x11eda5(0x1e1)][_0x11eda5(0x1ba)](new RTCSessionDescription(_0x30b2a5)),console[_0x11eda5(0x237)]('[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)');const _0x2a27e8=await _0x316660[_0x11eda5(0x1e1)]['createAnswer']();console['log'](_0x11eda5(0x21d)),await _0x316660[_0x11eda5(0x1e1)][_0x11eda5(0x1a1)](_0x2a27e8),console['log'](_0x11eda5(0x206)),this['serverWs']&&(this[_0x11eda5(0x17d)][_0x11eda5(0x16c)](JSON[_0x11eda5(0x21b)]({'op':'webrtc_answer','session_id':_0x3e11ef,'answer':_0x2a27e8})),console[_0x11eda5(0x237)](_0x11eda5(0x1bb)+_0x3e11ef));}catch(_0x3709db){console[_0x11eda5(0x1c8)](_0x11eda5(0x1a6)+_0x3e11ef+':',_0x3709db),this[_0x11eda5(0x213)](_0x3e11ef);}}async[a6_0x30d0f2(0x1b5)](_0x1f8500,_0x1468f5){const _0x341d67=a6_0x30d0f2,_0x1ac5b1=this[_0x341d67(0x1c1)][_0x341d67(0x211)](_0x1f8500);if(!_0x1ac5b1){console[_0x341d67(0x1c8)](_0x341d67(0x1cc)+_0x1f8500);return;}try{await _0x1ac5b1[_0x341d67(0x1e1)][_0x341d67(0x18c)](new RTCIceCandidate(_0x1468f5)),console[_0x341d67(0x237)](_0x341d67(0x22f)+_0x1f8500);}catch(_0x1d413e){console[_0x341d67(0x1c8)](_0x341d67(0x173)+_0x1f8500+':',_0x1d413e);}}[a6_0x30d0f2(0x1e4)](_0x627823,_0x3804b8){const _0x7c1fe0=a6_0x30d0f2;if(!this[_0x7c1fe0(0x1cd)]||this['rosbridgeWs'][_0x7c1fe0(0x180)]!==this[_0x7c1fe0(0x1cd)][_0x7c1fe0(0x223)])return console[_0x7c1fe0(0x1c8)](_0x7c1fe0(0x1a0)),null;console[_0x7c1fe0(0x237)](_0x7c1fe0(0x193)+_0x627823);const _0x895cc8=_0x627823[_0x7c1fe0(0x1bf)](_0x7c1fe0(0x1ec)),_0x513d3a=_0x627823[_0x7c1fe0(0x1bf)]('compressed')||_0x627823[_0x7c1fe0(0x1bf)](_0x7c1fe0(0x222));let _0x29559b=[];_0x895cc8?_0x513d3a?_0x29559b=['sensor_msgs/CompressedImage',_0x7c1fe0(0x19d),'compressed_depth_image_transport/CompressedDepthImage',_0x7c1fe0(0x227)]:_0x29559b=[_0x7c1fe0(0x227),_0x7c1fe0(0x19c),_0x7c1fe0(0x18d)]:_0x29559b=['sensor_msgs/CompressedImage',_0x7c1fe0(0x19d),_0x7c1fe0(0x227)];console['log']('[WebRTC\x20Appliance]\x20Topic\x20'+_0x627823+_0x7c1fe0(0x208)+(_0x895cc8?_0x7c1fe0(0x1ec):_0x7c1fe0(0x205))+'\x20image,\x20trying\x20message\x20types:',_0x29559b);const _0xc9ffdf=[];let _0x91494e=![];const _0x45bc77=_0x49a09c=>{return _0x40b3af=>{const _0x4f009e=a6_0x567a;try{const _0x33a71b=JSON[_0x4f009e(0x17e)](_0x40b3af[_0x4f009e(0x1dd)]);_0x33a71b['op']===_0x4f009e(0x1e0)&&_0x33a71b[_0x4f009e(0x1c3)]===_0x627823&&_0x33a71b[_0x4f009e(0x191)]&&(!_0x91494e&&(console['log'](_0x4f009e(0x20f)+_0x627823+_0x4f009e(0x230)+_0x49a09c),_0x91494e=!![]),_0x3804b8(_0x33a71b[_0x4f009e(0x191)]));}catch(_0x342e22){console[_0x4f009e(0x1c8)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x342e22);}};};for(const _0x590f16 of _0x29559b){const _0x245d46={'op':_0x7c1fe0(0x1f6),'topic':_0x627823,'type':_0x590f16};console[_0x7c1fe0(0x237)](_0x7c1fe0(0x214)+_0x590f16),this[_0x7c1fe0(0x1cd)]['send'](JSON['stringify'](_0x245d46));const _0x11b2da=_0x45bc77(_0x590f16);this[_0x7c1fe0(0x1cd)][_0x7c1fe0(0x231)]('message',_0x11b2da),_0xc9ffdf['push']({'handler':_0x11b2da,'type':_0x590f16});}return _0x895cc8&&_0x513d3a&&setTimeout(()=>{const _0x5d185a=_0x7c1fe0;if(!_0x91494e){console[_0x5d185a(0x237)]('[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20'+_0x627823+_0x5d185a(0x1db));const _0x3a5bef=_0x627823[_0x5d185a(0x171)](_0x5d185a(0x1b1),'')['replace']('/compressed',''),_0x30c626=[_0x3a5bef+_0x5d185a(0x1de),_0x3a5bef+_0x5d185a(0x18a),_0x3a5bef];for(const _0x5983f4 of _0x30c626){console[_0x5d185a(0x237)](_0x5d185a(0x209)+_0x5983f4);const _0x171beb={'op':_0x5d185a(0x1f6),'topic':_0x5983f4,'type':'sensor_msgs/Image'};this['rosbridgeWs'][_0x5d185a(0x16c)](JSON['stringify'](_0x171beb));const _0x183bc6=_0x5546da=>{const _0x2e7ebb=_0x5d185a;try{const _0x31cfa5=JSON[_0x2e7ebb(0x17e)](_0x5546da[_0x2e7ebb(0x1dd)]);_0x31cfa5['op']==='publish'&&_0x31cfa5[_0x2e7ebb(0x1c3)]===_0x5983f4&&_0x31cfa5['msg']&&(console[_0x2e7ebb(0x237)](_0x2e7ebb(0x212)+_0x5983f4+_0x2e7ebb(0x226)),_0x31cfa5['msg']['data']&&!_0x31cfa5[_0x2e7ebb(0x191)][_0x2e7ebb(0x1dd)][_0x2e7ebb(0x229)](_0x2e7ebb(0x185))&&_0x3804b8(_0x31cfa5[_0x2e7ebb(0x191)]));}catch(_0x165917){console['error']('[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:',_0x165917);}};this['rosbridgeWs']['addEventListener']('message',_0x183bc6),_0xc9ffdf[_0x5d185a(0x16b)]({'handler':_0x183bc6,'type':_0x5d185a(0x227),'topic':_0x5983f4});}}},0xbb8),{'unsubscribe':()=>{const _0x555805=_0x7c1fe0;for(const {handler:_0x3fcec2,type:_0x3406b2,topic:_0x960151}of _0xc9ffdf){this[_0x555805(0x1cd)][_0x555805(0x20c)](_0x555805(0x1e5),_0x3fcec2),this[_0x555805(0x1cd)][_0x555805(0x180)]===this[_0x555805(0x1cd)][_0x555805(0x223)]&&this['rosbridgeWs']['send'](JSON[_0x555805(0x21b)]({'op':'unsubscribe','topic':_0x960151||_0x627823}));}}};}[a6_0x30d0f2(0x1ca)](_0x9826a8,_0x408859){const _0x4c046b=a6_0x30d0f2;_0x408859[_0x4c046b(0x224)]=_0x4c046b(0x195),_0x408859['fillRect'](0x0,0x0,_0x9826a8[_0x4c046b(0x236)],_0x9826a8['height']),_0x408859[_0x4c046b(0x224)]='#00aaff',_0x408859[_0x4c046b(0x1e7)]=_0x4c046b(0x1f5),_0x408859[_0x4c046b(0x217)]=_0x4c046b(0x21a),_0x408859[_0x4c046b(0x1f3)](_0x4c046b(0x1c6),_0x9826a8[_0x4c046b(0x236)]/0x2,_0x9826a8['height']/0x2-0x14),_0x408859[_0x4c046b(0x224)]=_0x4c046b(0x17f),_0x408859[_0x4c046b(0x1e7)]=_0x4c046b(0x197),_0x408859[_0x4c046b(0x1f3)]('Waiting\x20for\x20ROS\x20image\x20data...',_0x9826a8[_0x4c046b(0x236)]/0x2,_0x9826a8['height']/0x2+0x14);const _0x50a4a4=Date[_0x4c046b(0x225)]()/0x3e8;for(let _0x17e7f1=0x0;_0x17e7f1<0x3;_0x17e7f1++){const _0x1938b3=(Math['sin'](_0x50a4a4*0x2+_0x17e7f1*0.5)+0x1)/0x2;_0x408859[_0x4c046b(0x224)]=_0x4c046b(0x1b4)+_0x1938b3*0.5+')',_0x408859['beginPath'](),_0x408859[_0x4c046b(0x1c0)](_0x9826a8[_0x4c046b(0x236)]/0x2-0x28+_0x17e7f1*0x28,_0x9826a8['height']/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x408859[_0x4c046b(0x21c)]();}}[a6_0x30d0f2(0x216)](_0x28ddb4,_0x20d3ed){const _0x2a159c=a6_0x30d0f2;try{if(!_0x28ddb4||!_0x20d3ed)return;const _0x31a576=_0x20d3ed[_0x2a159c(0x200)]('2d'),_0x96800f=_0x31a576['getImageData'](0x0,0x0,_0x20d3ed[_0x2a159c(0x236)],_0x20d3ed[_0x2a159c(0x1a4)]),_0x322bc6=this[_0x2a159c(0x1ae)](_0x96800f[_0x2a159c(0x1dd)],_0x20d3ed[_0x2a159c(0x236)],_0x20d3ed[_0x2a159c(0x1a4)]),_0x5c5c7a={'width':_0x20d3ed['width'],'height':_0x20d3ed['height'],'data':_0x322bc6};typeof _0x28ddb4[_0x2a159c(0x1d7)]===_0x2a159c(0x1b3)&&_0x28ddb4[_0x2a159c(0x1d7)](_0x5c5c7a);}catch(_0x4e5b55){console[_0x2a159c(0x1c8)](_0x2a159c(0x238),_0x4e5b55);}}[a6_0x30d0f2(0x1ae)](_0x608719,_0x1d2ad5,_0x184f50){const _0x4f9128=a6_0x30d0f2,_0x32ecb8=_0x1d2ad5*_0x184f50,_0x30ef17=_0x1d2ad5*_0x184f50/0x4,_0xe95163=new Uint8Array(_0x32ecb8+_0x30ef17*0x2);let _0xaa2d7e=0x0,_0x19cab9=_0x32ecb8,_0x48159a=_0x32ecb8+_0x30ef17;for(let _0x2c1528=0x0;_0x2c1528<_0x184f50;_0x2c1528++){for(let _0x495a53=0x0;_0x495a53<_0x1d2ad5;_0x495a53++){const _0x33febb=(_0x2c1528*_0x1d2ad5+_0x495a53)*0x4,_0x50e16f=_0x608719[_0x33febb],_0x5b8628=_0x608719[_0x33febb+0x1],_0x25a485=_0x608719[_0x33febb+0x2],_0x5bd1b6=Math[_0x4f9128(0x203)](0.299*_0x50e16f+0.587*_0x5b8628+0.114*_0x25a485);_0xe95163[_0xaa2d7e++]=_0x5bd1b6;if(_0x2c1528%0x2===0x0&&_0x495a53%0x2===0x0){const _0x42a2da=Math['round'](-0.169*_0x50e16f-0.331*_0x5b8628+0.5*_0x25a485+0x80),_0x366c82=Math['round'](0.5*_0x50e16f-0.419*_0x5b8628-0.081*_0x25a485+0x80);_0xe95163[_0x19cab9++]=Math[_0x4f9128(0x1e3)](0x0,Math[_0x4f9128(0x1fe)](0xff,_0x42a2da)),_0xe95163[_0x48159a++]=Math[_0x4f9128(0x1e3)](0x0,Math[_0x4f9128(0x1fe)](0xff,_0x366c82));}}}return _0xe95163;}async['updateCanvasWithImageData'](_0x30aa59,_0x5d8600,_0x3b5f2d,_0x24a201,_0x3fddeb){const _0x51d7c4=a6_0x30d0f2;try{if(!_0x3b5f2d||!_0x3b5f2d[_0x51d7c4(0x1dd)])return;Math['random']()<0.01&&console[_0x51d7c4(0x237)](_0x51d7c4(0x19b)+_0x24a201+_0x51d7c4(0x215)+_0x3b5f2d['data']['length']+_0x51d7c4(0x1a3));const _0x35fc9b=Buffer[_0x51d7c4(0x1ac)](_0x3b5f2d[_0x51d7c4(0x1dd)],_0x51d7c4(0x1d0)),_0x2bddbf=this[_0x51d7c4(0x22e)]['isDepthTopic'](_0x24a201);let _0x563990;_0x2bddbf?_0x563990=await this[_0x51d7c4(0x22e)][_0x51d7c4(0x179)](_0x35fc9b,_0x30aa59,_0x5d8600,_0x24a201):_0x563990=await this[_0x51d7c4(0x22e)][_0x51d7c4(0x207)](_0x35fc9b,_0x30aa59,_0x5d8600),_0x5d8600[_0x51d7c4(0x1f8)](_0x563990,0x0,0x0),_0x5d8600[_0x51d7c4(0x224)]=_0x51d7c4(0x22a),_0x5d8600[_0x51d7c4(0x1be)](0xa,0xa,0xdc,0x32),_0x5d8600['fillStyle']=_0x2bddbf?_0x51d7c4(0x16f):_0x51d7c4(0x18f),_0x5d8600[_0x51d7c4(0x1e7)]=_0x51d7c4(0x1ab),_0x5d8600[_0x51d7c4(0x1f3)]((_0x2bddbf?_0x51d7c4(0x201):_0x51d7c4(0x16a))+':\x20'+new Date()[_0x51d7c4(0x177)](),0xf,0x1c),_0x5d8600['fillStyle']='#ffffff',_0x5d8600[_0x51d7c4(0x1e7)]='10px\x20monospace',_0x5d8600['fillText'](_0x51d7c4(0x228)+_0x24a201[_0x51d7c4(0x1a7)]('/')[_0x51d7c4(0x1f7)](),0xf,0x2d),this[_0x51d7c4(0x216)](_0x3fddeb,_0x30aa59);}catch(_0x25ea2f){console[_0x51d7c4(0x1f0)](_0x51d7c4(0x16e)+_0x24a201+':',_0x25ea2f[_0x51d7c4(0x1e5)]);_0x24a201[_0x51d7c4(0x1bf)](_0x51d7c4(0x1ec))&&Math['random']()<0.1&&console['warn'](_0x51d7c4(0x1a2)+_0x24a201[_0x51d7c4(0x171)](_0x51d7c4(0x1b1),'/image_raw'));_0x5d8600[_0x51d7c4(0x224)]=_0x51d7c4(0x195),_0x5d8600['fillRect'](0x0,0x0,_0x30aa59[_0x51d7c4(0x236)],_0x30aa59['height']),_0x5d8600[_0x51d7c4(0x224)]=_0x51d7c4(0x1ea),_0x5d8600[_0x51d7c4(0x1e7)]=_0x51d7c4(0x197),_0x5d8600[_0x51d7c4(0x217)]=_0x51d7c4(0x21a);const _0x4fceec=_0x24a201[_0x51d7c4(0x1bf)](_0x51d7c4(0x1ec))?'🔍\x20Processing\x20depth...':'📹\x20Processing\x20video...';_0x5d8600[_0x51d7c4(0x1f3)](_0x4fceec,_0x30aa59[_0x51d7c4(0x236)]/0x2,_0x30aa59[_0x51d7c4(0x1a4)]/0x2),_0x5d8600[_0x51d7c4(0x224)]=_0x51d7c4(0x1f4),_0x5d8600[_0x51d7c4(0x1e7)]=_0x51d7c4(0x1c9),_0x5d8600['fillText'](_0x51d7c4(0x228)+_0x24a201[_0x51d7c4(0x1a7)]('/')[_0x51d7c4(0x1f7)](),_0x30aa59[_0x51d7c4(0x236)]/0x2,_0x30aa59[_0x51d7c4(0x1a4)]/0x2+0x19),this['sendFrameToVideoSource'](_0x3fddeb,_0x30aa59);}}['stopSession'](_0x47e9d8){const _0x520b8e=a6_0x30d0f2,_0x457aa6=this[_0x520b8e(0x1c1)][_0x520b8e(0x211)](_0x47e9d8);if(!_0x457aa6){console[_0x520b8e(0x1f0)](_0x520b8e(0x1c2)+_0x47e9d8);return;}console[_0x520b8e(0x237)](_0x520b8e(0x1b8)+_0x47e9d8+_0x520b8e(0x16d)+_0x457aa6[_0x520b8e(0x1c3)]);try{this[_0x520b8e(0x17d)]&&this[_0x520b8e(0x17d)][_0x520b8e(0x180)]===this[_0x520b8e(0x17d)][_0x520b8e(0x223)]&&this[_0x520b8e(0x17d)][_0x520b8e(0x16c)](JSON[_0x520b8e(0x21b)]({'op':_0x520b8e(0x1b6),'session_id':_0x47e9d8})),_0x457aa6[_0x520b8e(0x1d2)]&&_0x457aa6[_0x520b8e(0x1d2)]['stop'](),_0x457aa6[_0x520b8e(0x1e1)]&&_0x457aa6[_0x520b8e(0x1e1)][_0x520b8e(0x198)]();}catch(_0x388f3c){console[_0x520b8e(0x1c8)](_0x520b8e(0x1cb)+_0x388f3c);}this[_0x520b8e(0x186)](_0x47e9d8);}[a6_0x30d0f2(0x186)](_0x3c2877){const _0x7ad47d=a6_0x30d0f2,_0x45d9b2=this[_0x7ad47d(0x1c1)]['get'](_0x3c2877);if(_0x45d9b2){const _0x2913a7=this[_0x7ad47d(0x17c)][_0x7ad47d(0x211)](_0x45d9b2[_0x7ad47d(0x1c3)]);_0x2913a7&&(_0x2913a7['delete'](_0x3c2877),_0x2913a7[_0x7ad47d(0x1df)]===0x0&&this[_0x7ad47d(0x17c)][_0x7ad47d(0x210)](_0x45d9b2['topic'])),this[_0x7ad47d(0x22c)](_0x45d9b2['topic']);}this[_0x7ad47d(0x1c1)]['delete'](_0x3c2877),console[_0x7ad47d(0x237)](_0x7ad47d(0x1ad)+_0x3c2877);}[a6_0x30d0f2(0x17a)](){const _0x25ff16=a6_0x30d0f2;console['log'](_0x25ff16(0x232));const _0x1ba2d9=Array[_0x25ff16(0x1ac)](this[_0x25ff16(0x1c1)][_0x25ff16(0x19a)]());_0x1ba2d9['forEach'](_0x278484=>this[_0x25ff16(0x213)](_0x278484));}[a6_0x30d0f2(0x1b7)](){const _0x383451=a6_0x30d0f2,_0x5377c9=[];for(const [_0xa76d12,_0x406aa7]of this['activeSessions']){_0x5377c9[_0x383451(0x16b)]({'sessionId':_0xa76d12,'topic':_0x406aa7[_0x383451(0x1c3)],'connectionState':_0x406aa7[_0x383451(0x1e1)]?.[_0x383451(0x189)]||_0x383451(0x1d1),'hasVideoTrack':!!_0x406aa7[_0x383451(0x1d2)]});}return _0x5377c9;}[a6_0x30d0f2(0x1ff)](){const _0x12930f=a6_0x30d0f2,_0x31acb5=[];for(const [_0x4c9287,_0x2ccce4]of this[_0x12930f(0x1ce)]){_0x31acb5['push']({'topic':_0x4c9287,'frameCount':_0x2ccce4[_0x12930f(0x234)],'hasVideoSource':!!_0x2ccce4[_0x12930f(0x1ee)],'hasRosSubscriber':!!_0x2ccce4['rosSubscriber']});}return _0x31acb5;}}module[a6_0x30d0f2(0x20b)]=new ApplianceWebRTCService();