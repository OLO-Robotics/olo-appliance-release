const a6_0x1c8552=a6_0xe81b;function a6_0x4bd9(){const _0x5b1f55=['add','processDepthImage','compressedDepth','replace','8107vCooLN','base64','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','\x20image,\x20trying\x20message\x20types:','addTrack','get','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','depthProcessor','webrtc','Topic:\x20','#1a1a1a','search','rgba(0,\x20170,\x20255,\x20','video','sendFrameToVideoSource','12pcSVRs','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','initializeSession','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','topicSessions','Waiting\x20for\x20ROS\x20image\x20data...','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','OPEN','length','stopSession','../config','session_id','from','pop','/image_raw','15070ywHQMt','handleMessage','/image','message','framerate','12px\x20Arial','publish','getImageData','constructor','getIceServers','fillRect','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','📹\x20Processing\x20video...','frameCount','round','getOrCreateSharedVideoSource','9DXALGo','arc','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','toString','onFrame','log','4TvAcJz','#00ffff','processColorImage','stop','drawLoadingPattern','[WebRTC\x20Appliance]\x20Session\x20','includes','16px\x20Arial','textAlign','webrtc_answer','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','failed','removeEventListener','handleIceCandidate','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','activeSessions','delete','address','error','rosbridgeWs','7869520lJZHSH','now','createTrack','rgba(0,\x200,\x200,\x200.7)','width','videoSource','peerConnection','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','sin','#666','addIceCandidate','stringify','isDepthTopic','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','max','updateCanvasWithImageData','handleOffer','random','msg','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','(((.+)+)+)+$','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','putImageData','setRemoteDescription','./turnCredentialsService','beginPath','#00aaff','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','unknown','size','convertRGBAtoI420','2774401zRqRyO','split','#ffffff','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','videoTrack','compressed_depth_image_transport/CompressedDepthImage','protocol','stun:stun1.l.google.com:19302','webrtc_init_session','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','initialize','subscribe','\x20sessions)','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','connectionState','sensor_msgs/CompressedImage','readyState','\x20bytes','topic','data','#00ff00','[WebRTC\x20Appliance]\x20Service\x20initialized','148063wlyUJC','offer','createAnswer','push','🔍\x20Processing\x20depth...','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','candidate','sensor_msgs/Image','subscribeToROSTopic','🤖\x20Robot\x20Camera','webrtc_','iceServers','height','/9j/','apply','initializing','24px\x20Arial','has','cleanupSession','keys','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','parse','depth','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','color','connected','sensor_msgs/msg/Image','\x20for\x20topic\x20','startsWith','min','fillText',',\x20trying\x20alternative\x20depth\x20topics','fillStyle','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','warn','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','webrtc_stop_session','webrtc_ice_candidate','\x20for\x20topic:\x20','rosSubscriber','serverWs','./DepthImageProcessor','4320755Kzoydt','[WebRTC\x20Appliance]\x20Topic\x20','addEventListener',',\x20converting\x20to\x20base64...','27506676ZosUbp','\x20connection\x20closed,\x20cleaning\x20up','sensor_msgs/msg/CompressedImage',',\x20cleaning\x20up\x20shared\x20resources','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','close','compressed','stopAllSessions','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','sharp','📹\x20Color','font','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','163546IFMNYB','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','updateTurnCredentials','set','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','\x20sessions\x20remaining)','\x20successfully\x20connected!','wrtc','canvas','/compressedDepth','getContext','send','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','sharedVideoSources','6GcOyph'];a6_0x4bd9=function(){return _0x5b1f55;};return a6_0x4bd9();}(function(_0x4fc5f7,_0x3cd74f){const _0x10123c=a6_0xe81b,_0x26946f=_0x4fc5f7();while(!![]){try{const _0x3a2625=parseInt(_0x10123c(0x1ae))/0x1+parseInt(_0x10123c(0x1eb))/0x2*(parseInt(_0x10123c(0x20d))/0x3)+-parseInt(_0x10123c(0x164))/0x4*(-parseInt(_0x10123c(0x1da))/0x5)+parseInt(_0x10123c(0x1f9))/0x6*(-parseInt(_0x10123c(0x197))/0x7)+-parseInt(_0x10123c(0x178))/0x8*(-parseInt(_0x10123c(0x15e))/0x9)+-parseInt(_0x10123c(0x21d))/0xa*(-parseInt(_0x10123c(0x1fe))/0xb)+-parseInt(_0x10123c(0x1de))/0xc;if(_0x3a2625===_0x3cd74f)break;else _0x26946f['push'](_0x26946f['shift']());}catch(_0x81bfc6){_0x26946f['push'](_0x26946f['shift']());}}}(a6_0x4bd9,0xb5e81));const a6_0x15e88b=(function(){let _0x188a50=!![];return function(_0x3b95b3,_0x1f4382){const _0x4db1e7=_0x188a50?function(){const _0x4748f4=a6_0xe81b;if(_0x1f4382){const _0x2df2cb=_0x1f4382[_0x4748f4(0x1bc)](_0x3b95b3,arguments);return _0x1f4382=null,_0x2df2cb;}}:function(){};return _0x188a50=![],_0x4db1e7;};}()),a6_0x508791=a6_0x15e88b(this,function(){const _0x5e102d=a6_0xe81b;return a6_0x508791[_0x5e102d(0x161)]()[_0x5e102d(0x209)]('(((.+)+)+)+$')[_0x5e102d(0x161)]()[_0x5e102d(0x225)](a6_0x508791)[_0x5e102d(0x209)](_0x5e102d(0x18c));});function a6_0xe81b(_0x2ec302,_0x4b30d9){const _0x12d102=a6_0x4bd9();return a6_0xe81b=function(_0x508791,_0x15e88b){_0x508791=_0x508791-0x159;let _0x4bd941=_0x12d102[_0x508791];return _0x4bd941;},a6_0xe81b(_0x2ec302,_0x4b30d9);}a6_0x508791();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x1c8552(0x1f2)),sharp=require(a6_0x1c8552(0x1e7)),config=require(a6_0x1c8552(0x218)),DepthImageProcessor=require(a6_0x1c8552(0x1d9)),turnCredentialsService=require(a6_0x1c8552(0x190));class ApplianceWebRTCService{constructor(){const _0x3f235a=a6_0x1c8552;this['activeSessions']=new Map(),this[_0x3f235a(0x212)]=new Map(),this[_0x3f235a(0x1f8)]=new Map(),this['rosbridgeWs']=null,this['serverWs']=null,this[_0x3f235a(0x205)]=new DepthImageProcessor(),this['rtcConfig']={'iceServers':[{'urls':'stun:stun.l.google.com:19302'},{'urls':_0x3f235a(0x19e)}]};}[a6_0x1c8552(0x1a2)](_0x2e6675,_0xf4f9b){const _0x300d7f=a6_0x1c8552;this[_0x300d7f(0x177)]=_0x2e6675,this['serverWs']=_0xf4f9b,turnCredentialsService[_0x300d7f(0x1a2)](config['serverUrl']),this[_0x300d7f(0x1ed)](),console[_0x300d7f(0x163)](_0x300d7f(0x1ad));}async[a6_0x1c8552(0x1ed)](){const _0x27cc8d=a6_0x1c8552;try{console['log']('[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...');const _0x578a9b=await turnCredentialsService[_0x27cc8d(0x226)]();this['rtcConfig'][_0x27cc8d(0x1b9)]=_0x578a9b,console['log'](_0x27cc8d(0x214));}catch(_0x41864b){console[_0x27cc8d(0x176)](_0x27cc8d(0x193),_0x41864b),console[_0x27cc8d(0x163)](_0x27cc8d(0x1c5));}}[a6_0x1c8552(0x21e)](_0x52a811){const _0x57c252=a6_0x1c8552;if(!_0x52a811['op']||!_0x52a811['op'][_0x57c252(0x1cb)](_0x57c252(0x1b8)))return![];console[_0x57c252(0x163)](_0x57c252(0x1ec)+_0x52a811['op']);switch(_0x52a811['op']){case _0x57c252(0x19f):this[_0x57c252(0x20f)](_0x52a811[_0x57c252(0x219)],_0x52a811[_0x57c252(0x1aa)]);return!![];case'webrtc_offer':this[_0x57c252(0x188)](_0x52a811['session_id'],_0x52a811[_0x57c252(0x1af)]);return!![];case _0x57c252(0x1d5):this['handleIceCandidate'](_0x52a811['session_id'],_0x52a811[_0x57c252(0x1b4)]);return!![];case _0x57c252(0x1d4):this[_0x57c252(0x217)](_0x52a811['session_id']);return!![];default:console[_0x57c252(0x1d1)](_0x57c252(0x211)+_0x52a811['op']);return![];}}[a6_0x1c8552(0x15d)](_0x23c2d6){const _0x278900=a6_0x1c8552;if(this[_0x278900(0x1f8)][_0x278900(0x1bf)](_0x23c2d6)){const _0x13e2dc=this[_0x278900(0x1f8)]['get'](_0x23c2d6);return _0x13e2dc[_0x278900(0x15b)]++,console[_0x278900(0x163)](_0x278900(0x1e2)+_0x23c2d6+'\x20('+_0x13e2dc[_0x278900(0x15b)]+_0x278900(0x1a4)),_0x13e2dc;}console[_0x278900(0x163)](_0x278900(0x1b3)+_0x23c2d6);const {createCanvas:_0x138151}=require(_0x278900(0x1f3)),_0x17a682=_0x138151(config[_0x278900(0x206)][_0x278900(0x20b)][_0x278900(0x17c)],config[_0x278900(0x206)][_0x278900(0x20b)][_0x278900(0x1ba)]),_0x5d3c2c=_0x17a682[_0x278900(0x1f5)]('2d');this[_0x278900(0x168)](_0x17a682,_0x5d3c2c);const {RTCVideoSource:_0x5f06d3}=nonstandard,_0x5f08be=new _0x5f06d3();let _0x130c24=0x0;const _0x23a765=0x3e8/config[_0x278900(0x206)][_0x278900(0x20b)][_0x278900(0x221)],_0x461531=this[_0x278900(0x1b6)](_0x23c2d6,_0x4d530=>{const _0x51ab51=_0x278900,_0x5c5e16=Date[_0x51ab51(0x179)]();_0x5c5e16-_0x130c24>=_0x23a765&&(_0x130c24=_0x5c5e16,this[_0x51ab51(0x187)](_0x17a682,_0x5d3c2c,_0x4d530,_0x23c2d6,_0x5f08be));}),_0x10b449={'videoSource':_0x5f08be,'canvas':_0x17a682,'rosSubscriber':_0x461531,'frameCount':0x1,'topic':_0x23c2d6};return this[_0x278900(0x1f8)][_0x278900(0x1ee)](_0x23c2d6,_0x10b449),_0x10b449;}['releaseSharedVideoSource'](_0x2695f8){const _0x5f4f20=a6_0x1c8552,_0x4af10c=this[_0x5f4f20(0x1f8)][_0x5f4f20(0x203)](_0x2695f8);if(!_0x4af10c)return;_0x4af10c[_0x5f4f20(0x15b)]--,console[_0x5f4f20(0x163)](_0x5f4f20(0x18d)+_0x2695f8+'\x20('+_0x4af10c['frameCount']+_0x5f4f20(0x1f0)),_0x4af10c[_0x5f4f20(0x15b)]<=0x0&&(console[_0x5f4f20(0x163)](_0x5f4f20(0x1d3)+_0x2695f8+_0x5f4f20(0x1e1)),_0x4af10c[_0x5f4f20(0x17d)]&&(_0x4af10c['videoSource']=null),_0x4af10c[_0x5f4f20(0x1d7)]&&_0x4af10c[_0x5f4f20(0x1d7)]['unsubscribe'](),this[_0x5f4f20(0x1f8)][_0x5f4f20(0x174)](_0x2695f8));}async[a6_0x1c8552(0x20f)](_0x3c34b8,_0x10f32d){const _0x4c3f77=a6_0x1c8552;try{console[_0x4c3f77(0x163)](_0x4c3f77(0x1f7)+_0x3c34b8+_0x4c3f77(0x1ca)+_0x10f32d);const _0x34b604=this[_0x4c3f77(0x15d)](_0x10f32d),_0xf78368=new RTCPeerConnection(this['rtcConfig']),_0x36eb06=_0x34b604[_0x4c3f77(0x17d)][_0x4c3f77(0x17a)]({'width':config[_0x4c3f77(0x206)][_0x4c3f77(0x20b)][_0x4c3f77(0x17c)],'height':config[_0x4c3f77(0x206)][_0x4c3f77(0x20b)][_0x4c3f77(0x1ba)],'framerate':config[_0x4c3f77(0x206)][_0x4c3f77(0x20b)][_0x4c3f77(0x221)]});console[_0x4c3f77(0x163)](_0x4c3f77(0x1a5)+_0x3c34b8);const {MediaStream:_0x73e988}=require(_0x4c3f77(0x1f2)),_0x49d5fc=new _0x73e988([_0x36eb06]);_0xf78368[_0x4c3f77(0x202)](_0x36eb06,_0x49d5fc),this['sendFrameToVideoSource'](_0x34b604[_0x4c3f77(0x17d)],_0x34b604['canvas']),_0xf78368['onicecandidate']=_0x57741e=>{const _0x5829a0=_0x4c3f77;if(_0x57741e[_0x5829a0(0x1b4)]&&this[_0x5829a0(0x1d8)])console[_0x5829a0(0x163)]('[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20'+_0x3c34b8+':',{'type':_0x57741e[_0x5829a0(0x1b4)]['type'],'protocol':_0x57741e[_0x5829a0(0x1b4)][_0x5829a0(0x19d)],'address':_0x57741e[_0x5829a0(0x1b4)][_0x5829a0(0x175)],'port':_0x57741e[_0x5829a0(0x1b4)]['port']}),this[_0x5829a0(0x1d8)]['send'](JSON[_0x5829a0(0x183)]({'op':_0x5829a0(0x1d5),'session_id':_0x3c34b8,'candidate':_0x57741e[_0x5829a0(0x1b4)]}));else!_0x57741e['candidate']&&console[_0x5829a0(0x163)](_0x5829a0(0x200)+_0x3c34b8);},_0xf78368['onconnectionstatechange']=()=>{const _0x189c12=_0x4c3f77;console['log'](_0x189c12(0x169)+_0x3c34b8+'\x20connection\x20state:\x20'+_0xf78368[_0x189c12(0x1a6)]);if(_0xf78368[_0x189c12(0x1a6)]===_0x189c12(0x1c8))console[_0x189c12(0x163)](_0x189c12(0x169)+_0x3c34b8+_0x189c12(0x1f1));else{if(_0xf78368[_0x189c12(0x1a6)]===_0x189c12(0x16f))console[_0x189c12(0x163)](_0x189c12(0x169)+_0x3c34b8+'\x20connection\x20failed,\x20stopping\x20session'),this[_0x189c12(0x217)](_0x3c34b8);else _0xf78368['connectionState']==='closed'&&(console[_0x189c12(0x163)](_0x189c12(0x169)+_0x3c34b8+_0x189c12(0x1df)),this[_0x189c12(0x1c0)](_0x3c34b8));}},this[_0x4c3f77(0x173)][_0x4c3f77(0x1ee)](_0x3c34b8,{'peerConnection':_0xf78368,'topic':_0x10f32d,'videoTrack':_0x36eb06,'mediaStream':_0x49d5fc,'status':_0x4c3f77(0x1bd)}),!this[_0x4c3f77(0x212)][_0x4c3f77(0x1bf)](_0x10f32d)&&this[_0x4c3f77(0x212)][_0x4c3f77(0x1ee)](_0x10f32d,new Set()),this[_0x4c3f77(0x212)][_0x4c3f77(0x203)](_0x10f32d)[_0x4c3f77(0x1fa)](_0x3c34b8),console[_0x4c3f77(0x163)](_0x4c3f77(0x169)+_0x3c34b8+'\x20initialized\x20successfully'),console[_0x4c3f77(0x163)](_0x4c3f77(0x1d0)+_0x10f32d+':\x20'+this[_0x4c3f77(0x212)][_0x4c3f77(0x203)](_0x10f32d)[_0x4c3f77(0x195)]);}catch(_0x1a553f){console[_0x4c3f77(0x176)]('[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20'+_0x3c34b8+':',_0x1a553f),this[_0x4c3f77(0x217)](_0x3c34b8);}}async[a6_0x1c8552(0x188)](_0x334b02,_0x517385){const _0x1daed0=a6_0x1c8552,_0xe1f6f8=this[_0x1daed0(0x173)][_0x1daed0(0x203)](_0x334b02);if(!_0xe1f6f8){console['error'](_0x1daed0(0x1e6)+_0x334b02);return;}try{console[_0x1daed0(0x163)](_0x1daed0(0x19a)+_0x334b02),await _0xe1f6f8[_0x1daed0(0x17e)][_0x1daed0(0x18f)](new RTCSessionDescription(_0x517385)),console[_0x1daed0(0x163)](_0x1daed0(0x172));const _0x63fefd=await _0xe1f6f8['peerConnection'][_0x1daed0(0x1b0)]();console['log']('[WebRTC\x20Appliance]\x20Created\x20answer'),await _0xe1f6f8[_0x1daed0(0x17e)]['setLocalDescription'](_0x63fefd),console[_0x1daed0(0x163)](_0x1daed0(0x1ef)),this[_0x1daed0(0x1d8)]&&(this['serverWs']['send'](JSON['stringify']({'op':_0x1daed0(0x16d),'session_id':_0x334b02,'answer':_0x63fefd})),console[_0x1daed0(0x163)]('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0x334b02));}catch(_0x31a37e){console[_0x1daed0(0x176)]('[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20'+_0x334b02+':',_0x31a37e),this[_0x1daed0(0x217)](_0x334b02);}}async[a6_0x1c8552(0x171)](_0x458c80,_0x26b9ed){const _0x861bca=a6_0x1c8552,_0x162fc5=this[_0x861bca(0x173)][_0x861bca(0x203)](_0x458c80);if(!_0x162fc5){console[_0x861bca(0x176)](_0x861bca(0x185)+_0x458c80);return;}try{await _0x162fc5[_0x861bca(0x17e)][_0x861bca(0x182)](new RTCIceCandidate(_0x26b9ed)),console['log']('[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20'+_0x458c80);}catch(_0x4440af){console[_0x861bca(0x176)](_0x861bca(0x160)+_0x458c80+':',_0x4440af);}}['subscribeToROSTopic'](_0x3304f6,_0x5b2537){const _0x525612=a6_0x1c8552;if(!this[_0x525612(0x177)]||this['rosbridgeWs'][_0x525612(0x1a8)]!==this['rosbridgeWs']['OPEN'])return console['error']('[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected'),null;console[_0x525612(0x163)](_0x525612(0x159)+_0x3304f6);const _0x31d924=_0x3304f6[_0x525612(0x16a)](_0x525612(0x1c4)),_0x3becd2=_0x3304f6[_0x525612(0x16a)](_0x525612(0x1e4))||_0x3304f6[_0x525612(0x16a)](_0x525612(0x1fc));let _0x3fab2c=[];_0x31d924?_0x3becd2?_0x3fab2c=[_0x525612(0x1a7),_0x525612(0x1e0),_0x525612(0x19c),_0x525612(0x1b5)]:_0x3fab2c=['sensor_msgs/Image',_0x525612(0x1c9),_0x525612(0x1a7)]:_0x3fab2c=[_0x525612(0x1a7),_0x525612(0x1e0),_0x525612(0x1b5)];console[_0x525612(0x163)](_0x525612(0x1db)+_0x3304f6+'\x20detected\x20as\x20'+(_0x31d924?_0x525612(0x1c4):_0x525612(0x1c7))+_0x525612(0x201),_0x3fab2c);const _0xb304c=[];let _0x2001bb=![];const _0x30f788=_0x46b3f1=>{return _0x58917e=>{const _0x193486=a6_0xe81b;try{const _0x2af0ec=JSON[_0x193486(0x1c3)](_0x58917e['data']);_0x2af0ec['op']===_0x193486(0x223)&&_0x2af0ec[_0x193486(0x1aa)]===_0x3304f6&&_0x2af0ec[_0x193486(0x18a)]&&(!_0x2001bb&&(console[_0x193486(0x163)](_0x193486(0x1d2)+_0x3304f6+'\x20with\x20message\x20type\x20'+_0x46b3f1),_0x2001bb=!![]),_0x5b2537(_0x2af0ec['msg']));}catch(_0x54479a){console[_0x193486(0x176)](_0x193486(0x16e),_0x54479a);}};};for(const _0x1c7b2b of _0x3fab2c){const _0x38190d={'op':_0x525612(0x1a3),'topic':_0x3304f6,'type':_0x1c7b2b};console[_0x525612(0x163)](_0x525612(0x18b)+_0x1c7b2b),this[_0x525612(0x177)]['send'](JSON[_0x525612(0x183)](_0x38190d));const _0x509a88=_0x30f788(_0x1c7b2b);this[_0x525612(0x177)][_0x525612(0x1dc)](_0x525612(0x220),_0x509a88),_0xb304c[_0x525612(0x1b1)]({'handler':_0x509a88,'type':_0x1c7b2b});}return _0x31d924&&_0x3becd2&&setTimeout(()=>{const _0x45598f=_0x525612;if(!_0x2001bb){console[_0x45598f(0x163)](_0x45598f(0x1a1)+_0x3304f6+_0x45598f(0x1ce));const _0xdf058d=_0x3304f6[_0x45598f(0x1fd)](_0x45598f(0x1f4),'')[_0x45598f(0x1fd)]('/compressed',''),_0xf6af5c=[_0xdf058d+_0x45598f(0x21c),_0xdf058d+_0x45598f(0x21f),_0xdf058d];for(const _0x58635f of _0xf6af5c){console['log'](_0x45598f(0x1c6)+_0x58635f);const _0x1f04f8={'op':_0x45598f(0x1a3),'topic':_0x58635f,'type':_0x45598f(0x1b5)};this[_0x45598f(0x177)][_0x45598f(0x1f6)](JSON[_0x45598f(0x183)](_0x1f04f8));const _0x3dc49c=_0x4a0650=>{const _0x4d7db7=_0x45598f;try{const _0x20a070=JSON[_0x4d7db7(0x1c3)](_0x4a0650[_0x4d7db7(0x1ab)]);_0x20a070['op']===_0x4d7db7(0x223)&&_0x20a070[_0x4d7db7(0x1aa)]===_0x58635f&&_0x20a070[_0x4d7db7(0x18a)]&&(console[_0x4d7db7(0x163)]('[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20'+_0x58635f+_0x4d7db7(0x1dd)),_0x20a070[_0x4d7db7(0x18a)][_0x4d7db7(0x1ab)]&&!_0x20a070[_0x4d7db7(0x18a)]['data'][_0x4d7db7(0x1cb)](_0x4d7db7(0x1bb))&&_0x5b2537(_0x20a070['msg']));}catch(_0x98b1c1){console['error']('[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:',_0x98b1c1);}};this[_0x45598f(0x177)][_0x45598f(0x1dc)](_0x45598f(0x220),_0x3dc49c),_0xb304c[_0x45598f(0x1b1)]({'handler':_0x3dc49c,'type':_0x45598f(0x1b5),'topic':_0x58635f});}}},0xbb8),{'unsubscribe':()=>{const _0x5ed7ee=_0x525612;for(const {handler:_0x5c02f8,type:_0x39123c,topic:_0x195632}of _0xb304c){this['rosbridgeWs'][_0x5ed7ee(0x170)](_0x5ed7ee(0x220),_0x5c02f8),this[_0x5ed7ee(0x177)][_0x5ed7ee(0x1a8)]===this[_0x5ed7ee(0x177)][_0x5ed7ee(0x215)]&&this[_0x5ed7ee(0x177)]['send'](JSON['stringify']({'op':'unsubscribe','topic':_0x195632||_0x3304f6}));}}};}[a6_0x1c8552(0x168)](_0x199722,_0x29811c){const _0x43ec23=a6_0x1c8552;_0x29811c[_0x43ec23(0x1cf)]=_0x43ec23(0x208),_0x29811c[_0x43ec23(0x227)](0x0,0x0,_0x199722[_0x43ec23(0x17c)],_0x199722[_0x43ec23(0x1ba)]),_0x29811c[_0x43ec23(0x1cf)]=_0x43ec23(0x192),_0x29811c[_0x43ec23(0x1e9)]=_0x43ec23(0x1be),_0x29811c[_0x43ec23(0x16c)]='center',_0x29811c[_0x43ec23(0x1cd)](_0x43ec23(0x1b7),_0x199722['width']/0x2,_0x199722[_0x43ec23(0x1ba)]/0x2-0x14),_0x29811c['fillStyle']=_0x43ec23(0x199),_0x29811c[_0x43ec23(0x1e9)]=_0x43ec23(0x16b),_0x29811c[_0x43ec23(0x1cd)](_0x43ec23(0x213),_0x199722[_0x43ec23(0x17c)]/0x2,_0x199722['height']/0x2+0x14);const _0x45bc63=Date['now']()/0x3e8;for(let _0x6a1a1e=0x0;_0x6a1a1e<0x3;_0x6a1a1e++){const _0x448e2d=(Math[_0x43ec23(0x180)](_0x45bc63*0x2+_0x6a1a1e*0.5)+0x1)/0x2;_0x29811c['fillStyle']=_0x43ec23(0x20a)+_0x448e2d*0.5+')',_0x29811c[_0x43ec23(0x191)](),_0x29811c[_0x43ec23(0x15f)](_0x199722[_0x43ec23(0x17c)]/0x2-0x28+_0x6a1a1e*0x28,_0x199722[_0x43ec23(0x1ba)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x29811c['fill']();}}[a6_0x1c8552(0x20c)](_0x24ec1d,_0x69118){const _0x398038=a6_0x1c8552;try{if(!_0x24ec1d||!_0x69118)return;const _0x439112=_0x69118[_0x398038(0x1f5)]('2d'),_0x1813ea=_0x439112[_0x398038(0x224)](0x0,0x0,_0x69118['width'],_0x69118[_0x398038(0x1ba)]),_0x5db85b=this[_0x398038(0x196)](_0x1813ea['data'],_0x69118[_0x398038(0x17c)],_0x69118[_0x398038(0x1ba)]),_0x761584={'width':_0x69118[_0x398038(0x17c)],'height':_0x69118[_0x398038(0x1ba)],'data':_0x5db85b};typeof _0x24ec1d[_0x398038(0x162)]==='function'&&_0x24ec1d[_0x398038(0x162)](_0x761584);}catch(_0x539745){console[_0x398038(0x176)](_0x398038(0x204),_0x539745);}}['convertRGBAtoI420'](_0x3cdf61,_0x5d217d,_0x227e49){const _0x2c2833=a6_0x1c8552,_0x57e651=_0x5d217d*_0x227e49,_0x1df8c7=_0x5d217d*_0x227e49/0x4,_0x58b686=new Uint8Array(_0x57e651+_0x1df8c7*0x2);let _0x45cd5e=0x0,_0x163e59=_0x57e651,_0x5ca592=_0x57e651+_0x1df8c7;for(let _0x29647b=0x0;_0x29647b<_0x227e49;_0x29647b++){for(let _0x477fad=0x0;_0x477fad<_0x5d217d;_0x477fad++){const _0xd39d6d=(_0x29647b*_0x5d217d+_0x477fad)*0x4,_0x53a1e8=_0x3cdf61[_0xd39d6d],_0x543144=_0x3cdf61[_0xd39d6d+0x1],_0x414589=_0x3cdf61[_0xd39d6d+0x2],_0x215b39=Math[_0x2c2833(0x15c)](0.299*_0x53a1e8+0.587*_0x543144+0.114*_0x414589);_0x58b686[_0x45cd5e++]=_0x215b39;if(_0x29647b%0x2===0x0&&_0x477fad%0x2===0x0){const _0x26f1e6=Math['round'](-0.169*_0x53a1e8-0.331*_0x543144+0.5*_0x414589+0x80),_0x37c777=Math['round'](0.5*_0x53a1e8-0.419*_0x543144-0.081*_0x414589+0x80);_0x58b686[_0x163e59++]=Math[_0x2c2833(0x186)](0x0,Math['min'](0xff,_0x26f1e6)),_0x58b686[_0x5ca592++]=Math[_0x2c2833(0x186)](0x0,Math[_0x2c2833(0x1cc)](0xff,_0x37c777));}}}return _0x58b686;}async[a6_0x1c8552(0x187)](_0x4a3d6b,_0x478366,_0x5f4e32,_0x1f04f3,_0x58441d){const _0x15a23b=a6_0x1c8552;try{if(!_0x5f4e32||!_0x5f4e32[_0x15a23b(0x1ab)])return;Math[_0x15a23b(0x189)]()<0.01&&console['log'](_0x15a23b(0x17f)+_0x1f04f3+',\x20size:\x20'+_0x5f4e32[_0x15a23b(0x1ab)][_0x15a23b(0x216)]+_0x15a23b(0x1a9));const _0x997359=Buffer[_0x15a23b(0x21a)](_0x5f4e32[_0x15a23b(0x1ab)],_0x15a23b(0x1ff)),_0x4874b5=this[_0x15a23b(0x205)][_0x15a23b(0x184)](_0x1f04f3);let _0x733dfe;_0x4874b5?_0x733dfe=await this[_0x15a23b(0x205)][_0x15a23b(0x1fb)](_0x997359,_0x4a3d6b,_0x478366,_0x1f04f3):_0x733dfe=await this[_0x15a23b(0x205)][_0x15a23b(0x166)](_0x997359,_0x4a3d6b,_0x478366),_0x478366[_0x15a23b(0x18e)](_0x733dfe,0x0,0x0),_0x478366[_0x15a23b(0x1cf)]=_0x15a23b(0x17b),_0x478366[_0x15a23b(0x227)](0xa,0xa,0xdc,0x32),_0x478366[_0x15a23b(0x1cf)]=_0x4874b5?_0x15a23b(0x165):_0x15a23b(0x1ac),_0x478366[_0x15a23b(0x1e9)]='12px\x20monospace',_0x478366[_0x15a23b(0x1cd)]((_0x4874b5?'🔍\x20Depth':_0x15a23b(0x1e8))+':\x20'+new Date()['toLocaleTimeString'](),0xf,0x1c),_0x478366[_0x15a23b(0x1cf)]=_0x15a23b(0x199),_0x478366[_0x15a23b(0x1e9)]='10px\x20monospace',_0x478366[_0x15a23b(0x1cd)](_0x15a23b(0x207)+_0x1f04f3[_0x15a23b(0x198)]('/')['pop'](),0xf,0x2d),this[_0x15a23b(0x20c)](_0x58441d,_0x4a3d6b);}catch(_0x159c53){console[_0x15a23b(0x1d1)](_0x15a23b(0x1c2)+_0x1f04f3+':',_0x159c53[_0x15a23b(0x220)]);_0x1f04f3[_0x15a23b(0x16a)](_0x15a23b(0x1c4))&&Math[_0x15a23b(0x189)]()<0.1&&console[_0x15a23b(0x1d1)]('[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20'+_0x1f04f3[_0x15a23b(0x1fd)](_0x15a23b(0x1f4),'/image_raw'));_0x478366[_0x15a23b(0x1cf)]=_0x15a23b(0x208),_0x478366['fillRect'](0x0,0x0,_0x4a3d6b['width'],_0x4a3d6b['height']),_0x478366[_0x15a23b(0x1cf)]='#888',_0x478366[_0x15a23b(0x1e9)]=_0x15a23b(0x16b),_0x478366[_0x15a23b(0x16c)]='center';const _0x367af8=_0x1f04f3[_0x15a23b(0x16a)](_0x15a23b(0x1c4))?_0x15a23b(0x1b2):_0x15a23b(0x15a);_0x478366[_0x15a23b(0x1cd)](_0x367af8,_0x4a3d6b['width']/0x2,_0x4a3d6b[_0x15a23b(0x1ba)]/0x2),_0x478366['fillStyle']=_0x15a23b(0x181),_0x478366[_0x15a23b(0x1e9)]=_0x15a23b(0x222),_0x478366[_0x15a23b(0x1cd)]('Topic:\x20'+_0x1f04f3[_0x15a23b(0x198)]('/')[_0x15a23b(0x21b)](),_0x4a3d6b['width']/0x2,_0x4a3d6b[_0x15a23b(0x1ba)]/0x2+0x19),this[_0x15a23b(0x20c)](_0x58441d,_0x4a3d6b);}}[a6_0x1c8552(0x217)](_0x24e631){const _0x63bc0c=a6_0x1c8552,_0x452f36=this['activeSessions'][_0x63bc0c(0x203)](_0x24e631);if(!_0x452f36){console[_0x63bc0c(0x1d1)](_0x63bc0c(0x1ea)+_0x24e631);return;}console[_0x63bc0c(0x163)](_0x63bc0c(0x210)+_0x24e631+_0x63bc0c(0x1d6)+_0x452f36[_0x63bc0c(0x1aa)]);try{this['serverWs']&&this[_0x63bc0c(0x1d8)][_0x63bc0c(0x1a8)]===this['serverWs']['OPEN']&&this[_0x63bc0c(0x1d8)]['send'](JSON[_0x63bc0c(0x183)]({'op':_0x63bc0c(0x1d4),'session_id':_0x24e631})),_0x452f36[_0x63bc0c(0x19b)]&&_0x452f36[_0x63bc0c(0x19b)][_0x63bc0c(0x167)](),_0x452f36['peerConnection']&&_0x452f36[_0x63bc0c(0x17e)][_0x63bc0c(0x1e3)]();}catch(_0xcccae8){console['error'](_0x63bc0c(0x20e)+_0xcccae8);}this['cleanupSession'](_0x24e631);}['cleanupSession'](_0xf16b07){const _0x18ebcb=a6_0x1c8552,_0x3a4f03=this[_0x18ebcb(0x173)][_0x18ebcb(0x203)](_0xf16b07);if(_0x3a4f03){const _0x8a47fd=this['topicSessions'][_0x18ebcb(0x203)](_0x3a4f03[_0x18ebcb(0x1aa)]);_0x8a47fd&&(_0x8a47fd[_0x18ebcb(0x174)](_0xf16b07),_0x8a47fd['size']===0x0&&this[_0x18ebcb(0x212)][_0x18ebcb(0x174)](_0x3a4f03[_0x18ebcb(0x1aa)])),this['releaseSharedVideoSource'](_0x3a4f03['topic']);}this['activeSessions'][_0x18ebcb(0x174)](_0xf16b07),console[_0x18ebcb(0x163)](_0x18ebcb(0x1a0)+_0xf16b07);}[a6_0x1c8552(0x1e5)](){const _0x591a53=a6_0x1c8552;console[_0x591a53(0x163)]('[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions');const _0xb59e47=Array['from'](this['activeSessions'][_0x591a53(0x1c1)]());_0xb59e47['forEach'](_0x2dbb93=>this['stopSession'](_0x2dbb93));}['getActiveSessions'](){const _0x96c8ac=a6_0x1c8552,_0x5185cb=[];for(const [_0x3f82de,_0x2f2b62]of this['activeSessions']){_0x5185cb[_0x96c8ac(0x1b1)]({'sessionId':_0x3f82de,'topic':_0x2f2b62[_0x96c8ac(0x1aa)],'connectionState':_0x2f2b62[_0x96c8ac(0x17e)]?.[_0x96c8ac(0x1a6)]||_0x96c8ac(0x194),'hasVideoTrack':!!_0x2f2b62[_0x96c8ac(0x19b)]});}return _0x5185cb;}['getSharedVideoSources'](){const _0x1d9844=a6_0x1c8552,_0x416ec6=[];for(const [_0x930a0b,_0x39eadc]of this[_0x1d9844(0x1f8)]){_0x416ec6[_0x1d9844(0x1b1)]({'topic':_0x930a0b,'frameCount':_0x39eadc['frameCount'],'hasVideoSource':!!_0x39eadc['videoSource'],'hasRosSubscriber':!!_0x39eadc[_0x1d9844(0x1d7)]});}return _0x416ec6;}}module['exports']=new ApplianceWebRTCService();