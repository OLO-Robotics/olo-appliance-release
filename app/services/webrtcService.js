const a6_0x1221fe=a6_0x5c94;(function(_0x2b8502,_0x268eab){const _0x2d0ad2=a6_0x5c94,_0x26ff5f=_0x2b8502();while(!![]){try{const _0x13717b=-parseInt(_0x2d0ad2(0x1a7))/0x1*(parseInt(_0x2d0ad2(0x1e4))/0x2)+parseInt(_0x2d0ad2(0x1fd))/0x3+parseInt(_0x2d0ad2(0x15a))/0x4+parseInt(_0x2d0ad2(0x18f))/0x5+-parseInt(_0x2d0ad2(0x1db))/0x6*(-parseInt(_0x2d0ad2(0x21d))/0x7)+-parseInt(_0x2d0ad2(0x17b))/0x8+parseInt(_0x2d0ad2(0x1f5))/0x9;if(_0x13717b===_0x268eab)break;else _0x26ff5f['push'](_0x26ff5f['shift']());}catch(_0x5698e6){_0x26ff5f['push'](_0x26ff5f['shift']());}}}(a6_0x28aa,0x75790));const a6_0x1b1f1a=(function(){let _0xbc1a87=!![];return function(_0x3e3321,_0x3ddbc8){const _0x110668=_0xbc1a87?function(){const _0x4507d3=a6_0x5c94;if(_0x3ddbc8){const _0x2a7ab7=_0x3ddbc8[_0x4507d3(0x1a3)](_0x3e3321,arguments);return _0x3ddbc8=null,_0x2a7ab7;}}:function(){};return _0xbc1a87=![],_0x110668;};}()),a6_0x320dd4=a6_0x1b1f1a(this,function(){const _0x236b55=a6_0x5c94;return a6_0x320dd4[_0x236b55(0x211)]()[_0x236b55(0x1d0)](_0x236b55(0x17c))['toString']()[_0x236b55(0x216)](a6_0x320dd4)[_0x236b55(0x1d0)](_0x236b55(0x17c));});function a6_0x5c94(_0x12be8a,_0x211b93){const _0x379288=a6_0x28aa();return a6_0x5c94=function(_0x320dd4,_0x1b1f1a){_0x320dd4=_0x320dd4-0x15a;let _0x28aa34=_0x379288[_0x320dd4];return _0x28aa34;},a6_0x5c94(_0x12be8a,_0x211b93);}function a6_0x28aa(){const _0x2f60a7=['search','setRemoteDescription','\x20successfully\x20connected!','12px\x20Arial','max','\x20with\x20message\x20type\x20','session_id','getOrCreateSharedVideoSource','stopAllSessions','random','activeSessions','243342moGDRd','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','\x20bytes','replace','now','onconnectionstatechange','data','sensor_msgs/Image','depthProcessor','168710Lylpym','updateTurnCredentials','sin','\x20connection\x20state:\x20','webrtc_','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','arc','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','/9j/','getIceServers','/image','connectionState','handleIceCandidate','message','offer','340641zZeUrs','rtcConfig','stopSession','round','width','onFrame','webrtc_ice_candidate','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','2301561QmxUXu','set','depth','toLocaleTimeString','serverWs','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','📹\x20Processing\x20video...','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','video','updateCanvasWithImageData','split','topic','🔍\x20Depth','publish','removeEventListener','initializeSession','getContext','pop','🔍\x20Processing\x20depth...','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','toString','framerate','candidate','exports','size','constructor','base64','releaseSharedVideoSource','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','font','getImageData','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','21rLFrZZ','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','close','\x20initialized\x20successfully','rgba(0,\x20170,\x20255,\x20','10px\x20monospace',',\x20trying\x20alternative\x20depth\x20topics','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','#ffffff','canvas','textAlign','fillRect','startsWith','from','Topic:\x20','193108MIwgOU','delete','peerConnection','[WebRTC\x20Appliance]\x20Created\x20answer','rosSubscriber','onicecandidate','address','webrtc_offer','sensor_msgs/msg/CompressedImage','addTrack','rosbridgeWs','frameCount','forEach','subscribeToROSTopic','\x20connection\x20closed,\x20cleaning\x20up','get','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','24px\x20Arial','webrtc','drawLoadingPattern','OPEN','initialize','topicSessions','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','warn','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','videoSource','/image_raw','sensor_msgs/CompressedImage','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','2270272bxSXcY','(((.+)+)+)+$','beginPath','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','#888','../config','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','initializing','msg','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','[WebRTC\x20Appliance]\x20Topic\x20','unknown','stringify','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','stun:stun1.l.google.com:19302','push','addEventListener','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','wrtc','sharedVideoSources','1902265KGJCKk','cleanupSession','\x20for\x20topic:\x20','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','fill','/compressed','sharp','compressed_depth_image_transport/CompressedDepthImage','type','putImageData','16px\x20Arial','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','[WebRTC\x20Appliance]\x20Service\x20initialized','\x20for\x20topic\x20','handleOffer','processColorImage','\x20sessions\x20remaining)','keys','createTrack','unsubscribe','apply','error','fillText','sendFrameToVideoSource','7xABoav','stop','rgba(0,\x200,\x200,\x200.7)','includes','videoTrack','convertRGBAtoI420','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20',',\x20size:\x20','height','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','subscribe','color','protocol','./DepthImageProcessor','handleMessage','#666','processDepthImage','webrtc_init_session','connected','stun:stun.l.google.com:19302','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','#1a1a1a','failed','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','min','\x20sessions)','webrtc_stop_session','fillStyle','has','serverUrl','send','/compressedDepth','length','webrtc_answer','🤖\x20Robot\x20Camera','log','function','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','[WebRTC\x20Appliance]\x20Session\x20','parse'];a6_0x28aa=function(){return _0x2f60a7;};return a6_0x28aa();}a6_0x320dd4();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x1221fe(0x18d)),sharp=require(a6_0x1221fe(0x195)),config=require(a6_0x1221fe(0x180)),DepthImageProcessor=require(a6_0x1221fe(0x1b4)),turnCredentialsService=require('./turnCredentialsService');class ApplianceWebRTCService{constructor(){const _0x10f6c2=a6_0x1221fe;this[_0x10f6c2(0x1da)]=new Map(),this['topicSessions']=new Map(),this[_0x10f6c2(0x18e)]=new Map(),this[_0x10f6c2(0x164)]=null,this[_0x10f6c2(0x201)]=null,this[_0x10f6c2(0x1e3)]=new DepthImageProcessor(),this[_0x10f6c2(0x1f6)]={'iceServers':[{'urls':_0x10f6c2(0x1ba)},{'urls':_0x10f6c2(0x189)}]};}[a6_0x1221fe(0x16f)](_0x5a802a,_0x645b4b){const _0x2091fc=a6_0x1221fe;this[_0x2091fc(0x164)]=_0x5a802a,this[_0x2091fc(0x201)]=_0x645b4b,turnCredentialsService[_0x2091fc(0x16f)](config[_0x2091fc(0x1c5)]),this[_0x2091fc(0x1e5)](),console[_0x2091fc(0x1cb)](_0x2091fc(0x19b));}async['updateTurnCredentials'](){const _0xb583e5=a6_0x1221fe;try{console[_0xb583e5(0x1cb)](_0xb583e5(0x19a));const _0x217e06=await turnCredentialsService[_0xb583e5(0x1ef)]();this[_0xb583e5(0x1f6)]['iceServers']=_0x217e06,console['log'](_0xb583e5(0x18c));}catch(_0x2e3fae){console[_0xb583e5(0x1a4)](_0xb583e5(0x204),_0x2e3fae),console['log']('[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers');}}[a6_0x1221fe(0x1b5)](_0x420a41){const _0x12e7fb=a6_0x1221fe;if(!_0x420a41['op']||!_0x420a41['op'][_0x12e7fb(0x22a)](_0x12e7fb(0x1e8)))return![];console[_0x12e7fb(0x1cb)](_0x12e7fb(0x171)+_0x420a41['op']);switch(_0x420a41['op']){case _0x12e7fb(0x1b8):this[_0x12e7fb(0x20c)](_0x420a41[_0x12e7fb(0x1d6)],_0x420a41[_0x12e7fb(0x208)]);return!![];case _0x12e7fb(0x161):this[_0x12e7fb(0x19d)](_0x420a41[_0x12e7fb(0x1d6)],_0x420a41[_0x12e7fb(0x1f4)]);return!![];case _0x12e7fb(0x1fb):this[_0x12e7fb(0x1f2)](_0x420a41['session_id'],_0x420a41['candidate']);return!![];case _0x12e7fb(0x1c2):this[_0x12e7fb(0x1f7)](_0x420a41[_0x12e7fb(0x1d6)]);return!![];default:console[_0x12e7fb(0x174)](_0x12e7fb(0x225)+_0x420a41['op']);return![];}}[a6_0x1221fe(0x1d7)](_0x343e18){const _0x2d3b9e=a6_0x1221fe;if(this['sharedVideoSources'][_0x2d3b9e(0x1c4)](_0x343e18)){const _0x3321f8=this[_0x2d3b9e(0x18e)][_0x2d3b9e(0x169)](_0x343e18);return _0x3321f8['frameCount']++,console[_0x2d3b9e(0x1cb)]('[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x343e18+'\x20('+_0x3321f8['frameCount']+_0x2d3b9e(0x1c1)),_0x3321f8;}console[_0x2d3b9e(0x1cb)]('[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x343e18);const {createCanvas:_0x46cc1a}=require(_0x2d3b9e(0x227)),_0x14d891=_0x46cc1a(config[_0x2d3b9e(0x16c)][_0x2d3b9e(0x205)][_0x2d3b9e(0x1f9)],config[_0x2d3b9e(0x16c)][_0x2d3b9e(0x205)][_0x2d3b9e(0x1af)]),_0x4f0148=_0x14d891[_0x2d3b9e(0x20d)]('2d');this[_0x2d3b9e(0x16d)](_0x14d891,_0x4f0148);const {RTCVideoSource:_0x1f36ba}=nonstandard,_0x5893fa=new _0x1f36ba();let _0x99b6d8=0x0;const _0x30c688=0x3e8/config[_0x2d3b9e(0x16c)][_0x2d3b9e(0x205)][_0x2d3b9e(0x212)],_0x307c77=this[_0x2d3b9e(0x167)](_0x343e18,_0x3e890b=>{const _0xf212f3=_0x2d3b9e,_0x2806bc=Date[_0xf212f3(0x1df)]();_0x2806bc-_0x99b6d8>=_0x30c688&&(_0x99b6d8=_0x2806bc,this[_0xf212f3(0x206)](_0x14d891,_0x4f0148,_0x3e890b,_0x343e18,_0x5893fa));}),_0x23be73={'videoSource':_0x5893fa,'canvas':_0x14d891,'rosSubscriber':_0x307c77,'frameCount':0x1,'topic':_0x343e18};return this['sharedVideoSources'][_0x2d3b9e(0x1fe)](_0x343e18,_0x23be73),_0x23be73;}[a6_0x1221fe(0x218)](_0x135277){const _0x5c2d5e=a6_0x1221fe,_0x3a62b9=this[_0x5c2d5e(0x18e)]['get'](_0x135277);if(!_0x3a62b9)return;_0x3a62b9[_0x5c2d5e(0x165)]--,console[_0x5c2d5e(0x1cb)](_0x5c2d5e(0x210)+_0x135277+'\x20('+_0x3a62b9[_0x5c2d5e(0x165)]+_0x5c2d5e(0x19f)),_0x3a62b9[_0x5c2d5e(0x165)]<=0x0&&(console['log'](_0x5c2d5e(0x175)+_0x135277+',\x20cleaning\x20up\x20shared\x20resources'),_0x3a62b9['videoSource']&&(_0x3a62b9[_0x5c2d5e(0x176)]=null),_0x3a62b9['rosSubscriber']&&_0x3a62b9[_0x5c2d5e(0x15e)]['unsubscribe'](),this[_0x5c2d5e(0x18e)][_0x5c2d5e(0x15b)](_0x135277));}async[a6_0x1221fe(0x20c)](_0x1f1cc8,_0xf57dde){const _0x3ddfaf=a6_0x1221fe;try{console[_0x3ddfaf(0x1cb)](_0x3ddfaf(0x179)+_0x1f1cc8+_0x3ddfaf(0x19c)+_0xf57dde);const _0x18e2eb=this[_0x3ddfaf(0x1d7)](_0xf57dde),_0xf30cc7=new RTCPeerConnection(this[_0x3ddfaf(0x1f6)]),_0x44d706=_0x18e2eb[_0x3ddfaf(0x176)][_0x3ddfaf(0x1a1)]({'width':config[_0x3ddfaf(0x16c)][_0x3ddfaf(0x205)][_0x3ddfaf(0x1f9)],'height':config[_0x3ddfaf(0x16c)]['video'][_0x3ddfaf(0x1af)],'framerate':config[_0x3ddfaf(0x16c)][_0x3ddfaf(0x205)][_0x3ddfaf(0x212)]});console[_0x3ddfaf(0x1cb)](_0x3ddfaf(0x1dc)+_0x1f1cc8);const {MediaStream:_0x5425cd}=require(_0x3ddfaf(0x18d)),_0x28ebd9=new _0x5425cd([_0x44d706]);_0xf30cc7[_0x3ddfaf(0x163)](_0x44d706,_0x28ebd9),this[_0x3ddfaf(0x1a6)](_0x18e2eb[_0x3ddfaf(0x176)],_0x18e2eb[_0x3ddfaf(0x227)]),_0xf30cc7[_0x3ddfaf(0x15f)]=_0x50d658=>{const _0x18bf62=_0x3ddfaf;if(_0x50d658[_0x18bf62(0x213)]&&this['serverWs'])console[_0x18bf62(0x1cb)](_0x18bf62(0x17a)+_0x1f1cc8+':',{'type':_0x50d658[_0x18bf62(0x213)][_0x18bf62(0x197)],'protocol':_0x50d658[_0x18bf62(0x213)][_0x18bf62(0x1b3)],'address':_0x50d658[_0x18bf62(0x213)][_0x18bf62(0x160)],'port':_0x50d658[_0x18bf62(0x213)]['port']}),this[_0x18bf62(0x201)][_0x18bf62(0x1c6)](JSON[_0x18bf62(0x187)]({'op':_0x18bf62(0x1fb),'session_id':_0x1f1cc8,'candidate':_0x50d658['candidate']}));else!_0x50d658[_0x18bf62(0x213)]&&console[_0x18bf62(0x1cb)]('[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20'+_0x1f1cc8);},_0xf30cc7[_0x3ddfaf(0x1e0)]=()=>{const _0x12ec33=_0x3ddfaf;console[_0x12ec33(0x1cb)](_0x12ec33(0x1ce)+_0x1f1cc8+_0x12ec33(0x1e7)+_0xf30cc7['connectionState']);if(_0xf30cc7[_0x12ec33(0x1f1)]===_0x12ec33(0x1b9))console[_0x12ec33(0x1cb)](_0x12ec33(0x1ce)+_0x1f1cc8+_0x12ec33(0x1d2));else{if(_0xf30cc7[_0x12ec33(0x1f1)]===_0x12ec33(0x1be))console['log'](_0x12ec33(0x1ce)+_0x1f1cc8+'\x20connection\x20failed,\x20stopping\x20session'),this[_0x12ec33(0x1f7)](_0x1f1cc8);else _0xf30cc7[_0x12ec33(0x1f1)]==='closed'&&(console['log'](_0x12ec33(0x1ce)+_0x1f1cc8+_0x12ec33(0x168)),this[_0x12ec33(0x190)](_0x1f1cc8));}},this[_0x3ddfaf(0x1da)][_0x3ddfaf(0x1fe)](_0x1f1cc8,{'peerConnection':_0xf30cc7,'topic':_0xf57dde,'videoTrack':_0x44d706,'mediaStream':_0x28ebd9,'status':_0x3ddfaf(0x182)}),!this[_0x3ddfaf(0x170)][_0x3ddfaf(0x1c4)](_0xf57dde)&&this[_0x3ddfaf(0x170)][_0x3ddfaf(0x1fe)](_0xf57dde,new Set()),this[_0x3ddfaf(0x170)][_0x3ddfaf(0x169)](_0xf57dde)['add'](_0x1f1cc8),console[_0x3ddfaf(0x1cb)](_0x3ddfaf(0x1ce)+_0x1f1cc8+_0x3ddfaf(0x220)),console['log'](_0x3ddfaf(0x1ed)+_0xf57dde+':\x20'+this[_0x3ddfaf(0x170)][_0x3ddfaf(0x169)](_0xf57dde)[_0x3ddfaf(0x215)]);}catch(_0x220ba3){console[_0x3ddfaf(0x1a4)](_0x3ddfaf(0x192)+_0x1f1cc8+':',_0x220ba3),this[_0x3ddfaf(0x1f7)](_0x1f1cc8);}}async[a6_0x1221fe(0x19d)](_0x25b04b,_0x353043){const _0x3d1d32=a6_0x1221fe,_0x344f10=this[_0x3d1d32(0x1da)][_0x3d1d32(0x169)](_0x25b04b);if(!_0x344f10){console[_0x3d1d32(0x1a4)](_0x3d1d32(0x21c)+_0x25b04b);return;}try{console[_0x3d1d32(0x1cb)](_0x3d1d32(0x1e9)+_0x25b04b),await _0x344f10['peerConnection'][_0x3d1d32(0x1d1)](new RTCSessionDescription(_0x353043)),console[_0x3d1d32(0x1cb)](_0x3d1d32(0x17e));const _0x331142=await _0x344f10[_0x3d1d32(0x15c)]['createAnswer']();console[_0x3d1d32(0x1cb)](_0x3d1d32(0x15d)),await _0x344f10[_0x3d1d32(0x15c)]['setLocalDescription'](_0x331142),console[_0x3d1d32(0x1cb)]('[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)'),this[_0x3d1d32(0x201)]&&(this[_0x3d1d32(0x201)][_0x3d1d32(0x1c6)](JSON[_0x3d1d32(0x187)]({'op':_0x3d1d32(0x1c9),'session_id':_0x25b04b,'answer':_0x331142})),console[_0x3d1d32(0x1cb)](_0x3d1d32(0x1ec)+_0x25b04b));}catch(_0x5ae38b){console[_0x3d1d32(0x1a4)](_0x3d1d32(0x172)+_0x25b04b+':',_0x5ae38b),this['stopSession'](_0x25b04b);}}async[a6_0x1221fe(0x1f2)](_0x4c63f4,_0x38e8c4){const _0x2c08dd=a6_0x1221fe,_0x430952=this[_0x2c08dd(0x1da)][_0x2c08dd(0x169)](_0x4c63f4);if(!_0x430952){console[_0x2c08dd(0x1a4)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20'+_0x4c63f4);return;}try{await _0x430952[_0x2c08dd(0x15c)]['addIceCandidate'](new RTCIceCandidate(_0x38e8c4)),console['log'](_0x2c08dd(0x16a)+_0x4c63f4);}catch(_0x4a738a){console[_0x2c08dd(0x1a4)](_0x2c08dd(0x219)+_0x4c63f4+':',_0x4a738a);}}['subscribeToROSTopic'](_0x6eee,_0x1604a2){const _0x4a1281=a6_0x1221fe;if(!this[_0x4a1281(0x164)]||this[_0x4a1281(0x164)]['readyState']!==this[_0x4a1281(0x164)][_0x4a1281(0x16e)])return console[_0x4a1281(0x1a4)](_0x4a1281(0x181)),null;console['log'](_0x4a1281(0x1cd)+_0x6eee);const _0x382323=_0x6eee[_0x4a1281(0x1aa)](_0x4a1281(0x1ff)),_0x56f92b=_0x6eee[_0x4a1281(0x1aa)]('compressed')||_0x6eee[_0x4a1281(0x1aa)]('compressedDepth');let _0x102322=[];_0x382323?_0x56f92b?_0x102322=[_0x4a1281(0x178),_0x4a1281(0x162),_0x4a1281(0x196),_0x4a1281(0x1e2)]:_0x102322=[_0x4a1281(0x1e2),'sensor_msgs/msg/Image','sensor_msgs/CompressedImage']:_0x102322=['sensor_msgs/CompressedImage',_0x4a1281(0x162),_0x4a1281(0x1e2)];console[_0x4a1281(0x1cb)](_0x4a1281(0x185)+_0x6eee+'\x20detected\x20as\x20'+(_0x382323?_0x4a1281(0x1ff):_0x4a1281(0x1b2))+'\x20image,\x20trying\x20message\x20types:',_0x102322);const _0x3c5cb4=[];let _0x34f49a=![];const _0x3712dc=_0x2af729=>{return _0xe01c12=>{const _0x3fe87a=a6_0x5c94;try{const _0x128a16=JSON[_0x3fe87a(0x1cf)](_0xe01c12[_0x3fe87a(0x1e1)]);_0x128a16['op']===_0x3fe87a(0x20a)&&_0x128a16[_0x3fe87a(0x208)]===_0x6eee&&_0x128a16[_0x3fe87a(0x183)]&&(!_0x34f49a&&(console[_0x3fe87a(0x1cb)](_0x3fe87a(0x21e)+_0x6eee+_0x3fe87a(0x1d5)+_0x2af729),_0x34f49a=!![]),_0x1604a2(_0x128a16['msg']));}catch(_0x2af62e){console[_0x3fe87a(0x1a4)](_0x3fe87a(0x188),_0x2af62e);}};};for(const _0x18ca36 of _0x102322){const _0x5f149b={'op':_0x4a1281(0x1b1),'topic':_0x6eee,'type':_0x18ca36};console[_0x4a1281(0x1cb)](_0x4a1281(0x202)+_0x18ca36),this[_0x4a1281(0x164)][_0x4a1281(0x1c6)](JSON[_0x4a1281(0x187)](_0x5f149b));const _0x5efdf2=_0x3712dc(_0x18ca36);this[_0x4a1281(0x164)][_0x4a1281(0x18b)](_0x4a1281(0x1f3),_0x5efdf2),_0x3c5cb4['push']({'handler':_0x5efdf2,'type':_0x18ca36});}return _0x382323&&_0x56f92b&&setTimeout(()=>{const _0x5152ed=_0x4a1281;if(!_0x34f49a){console['log'](_0x5152ed(0x173)+_0x6eee+_0x5152ed(0x223));const _0x2590b5=_0x6eee[_0x5152ed(0x1de)](_0x5152ed(0x1c7),'')[_0x5152ed(0x1de)](_0x5152ed(0x194),''),_0x48174e=[_0x2590b5+'/image_raw',_0x2590b5+_0x5152ed(0x1f0),_0x2590b5];for(const _0x57fa4 of _0x48174e){console[_0x5152ed(0x1cb)](_0x5152ed(0x1b0)+_0x57fa4);const _0x1aff3a={'op':'subscribe','topic':_0x57fa4,'type':_0x5152ed(0x1e2)};this[_0x5152ed(0x164)][_0x5152ed(0x1c6)](JSON[_0x5152ed(0x187)](_0x1aff3a));const _0x2d0c81=_0x3da5ae=>{const _0x8162e0=_0x5152ed;try{const _0x33b683=JSON['parse'](_0x3da5ae[_0x8162e0(0x1e1)]);_0x33b683['op']===_0x8162e0(0x20a)&&_0x33b683['topic']===_0x57fa4&&_0x33b683[_0x8162e0(0x183)]&&(console[_0x8162e0(0x1cb)](_0x8162e0(0x1ea)+_0x57fa4+',\x20converting\x20to\x20base64...'),_0x33b683[_0x8162e0(0x183)]['data']&&!_0x33b683[_0x8162e0(0x183)][_0x8162e0(0x1e1)][_0x8162e0(0x22a)](_0x8162e0(0x1ee))&&_0x1604a2(_0x33b683[_0x8162e0(0x183)]));}catch(_0x5af7e5){console[_0x8162e0(0x1a4)](_0x8162e0(0x184),_0x5af7e5);}};this['rosbridgeWs']['addEventListener'](_0x5152ed(0x1f3),_0x2d0c81),_0x3c5cb4[_0x5152ed(0x18a)]({'handler':_0x2d0c81,'type':_0x5152ed(0x1e2),'topic':_0x57fa4});}}},0xbb8),{'unsubscribe':()=>{const _0x2da7b2=_0x4a1281;for(const {handler:_0x33274c,type:_0x22f289,topic:_0x40b8ba}of _0x3c5cb4){this[_0x2da7b2(0x164)][_0x2da7b2(0x20b)](_0x2da7b2(0x1f3),_0x33274c),this['rosbridgeWs']['readyState']===this['rosbridgeWs']['OPEN']&&this[_0x2da7b2(0x164)][_0x2da7b2(0x1c6)](JSON[_0x2da7b2(0x187)]({'op':_0x2da7b2(0x1a2),'topic':_0x40b8ba||_0x6eee}));}}};}[a6_0x1221fe(0x16d)](_0x2cfaba,_0x32b06c){const _0x2326e6=a6_0x1221fe;_0x32b06c[_0x2326e6(0x1c3)]=_0x2326e6(0x1bd),_0x32b06c['fillRect'](0x0,0x0,_0x2cfaba[_0x2326e6(0x1f9)],_0x2cfaba[_0x2326e6(0x1af)]),_0x32b06c[_0x2326e6(0x1c3)]='#00aaff',_0x32b06c['font']=_0x2326e6(0x16b),_0x32b06c[_0x2326e6(0x228)]='center',_0x32b06c[_0x2326e6(0x1a5)](_0x2326e6(0x1ca),_0x2cfaba[_0x2326e6(0x1f9)]/0x2,_0x2cfaba['height']/0x2-0x14),_0x32b06c['fillStyle']=_0x2326e6(0x226),_0x32b06c[_0x2326e6(0x21a)]=_0x2326e6(0x199),_0x32b06c[_0x2326e6(0x1a5)]('Waiting\x20for\x20ROS\x20image\x20data...',_0x2cfaba[_0x2326e6(0x1f9)]/0x2,_0x2cfaba[_0x2326e6(0x1af)]/0x2+0x14);const _0x237129=Date[_0x2326e6(0x1df)]()/0x3e8;for(let _0x5a5381=0x0;_0x5a5381<0x3;_0x5a5381++){const _0x25fd25=(Math[_0x2326e6(0x1e6)](_0x237129*0x2+_0x5a5381*0.5)+0x1)/0x2;_0x32b06c[_0x2326e6(0x1c3)]=_0x2326e6(0x221)+_0x25fd25*0.5+')',_0x32b06c[_0x2326e6(0x17d)](),_0x32b06c[_0x2326e6(0x1eb)](_0x2cfaba[_0x2326e6(0x1f9)]/0x2-0x28+_0x5a5381*0x28,_0x2cfaba[_0x2326e6(0x1af)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x32b06c[_0x2326e6(0x193)]();}}[a6_0x1221fe(0x1a6)](_0x2cbd63,_0x3ad685){const _0x3fb7cd=a6_0x1221fe;try{if(!_0x2cbd63||!_0x3ad685)return;const _0x5c7ee6=_0x3ad685['getContext']('2d'),_0x5973c8=_0x5c7ee6[_0x3fb7cd(0x21b)](0x0,0x0,_0x3ad685[_0x3fb7cd(0x1f9)],_0x3ad685[_0x3fb7cd(0x1af)]),_0x18f185=this[_0x3fb7cd(0x1ac)](_0x5973c8[_0x3fb7cd(0x1e1)],_0x3ad685['width'],_0x3ad685[_0x3fb7cd(0x1af)]),_0x35e1c4={'width':_0x3ad685['width'],'height':_0x3ad685[_0x3fb7cd(0x1af)],'data':_0x18f185};typeof _0x2cbd63['onFrame']===_0x3fb7cd(0x1cc)&&_0x2cbd63[_0x3fb7cd(0x1fa)](_0x35e1c4);}catch(_0x5c3ab9){console[_0x3fb7cd(0x1a4)]('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x5c3ab9);}}['convertRGBAtoI420'](_0x4a5ffb,_0x3b0ff6,_0x2062d3){const _0x307317=a6_0x1221fe,_0x152eb5=_0x3b0ff6*_0x2062d3,_0x42d5c6=_0x3b0ff6*_0x2062d3/0x4,_0x544c6b=new Uint8Array(_0x152eb5+_0x42d5c6*0x2);let _0x542ae8=0x0,_0x221bab=_0x152eb5,_0x232277=_0x152eb5+_0x42d5c6;for(let _0x5ef28f=0x0;_0x5ef28f<_0x2062d3;_0x5ef28f++){for(let _0xaa14cf=0x0;_0xaa14cf<_0x3b0ff6;_0xaa14cf++){const _0x46f336=(_0x5ef28f*_0x3b0ff6+_0xaa14cf)*0x4,_0x23b7b5=_0x4a5ffb[_0x46f336],_0xef9fd7=_0x4a5ffb[_0x46f336+0x1],_0x2339bc=_0x4a5ffb[_0x46f336+0x2],_0x5cdb7f=Math[_0x307317(0x1f8)](0.299*_0x23b7b5+0.587*_0xef9fd7+0.114*_0x2339bc);_0x544c6b[_0x542ae8++]=_0x5cdb7f;if(_0x5ef28f%0x2===0x0&&_0xaa14cf%0x2===0x0){const _0x2c281c=Math[_0x307317(0x1f8)](-0.169*_0x23b7b5-0.331*_0xef9fd7+0.5*_0x2339bc+0x80),_0x38059e=Math[_0x307317(0x1f8)](0.5*_0x23b7b5-0.419*_0xef9fd7-0.081*_0x2339bc+0x80);_0x544c6b[_0x221bab++]=Math[_0x307317(0x1d4)](0x0,Math[_0x307317(0x1c0)](0xff,_0x2c281c)),_0x544c6b[_0x232277++]=Math[_0x307317(0x1d4)](0x0,Math[_0x307317(0x1c0)](0xff,_0x38059e));}}}return _0x544c6b;}async[a6_0x1221fe(0x206)](_0x3efe98,_0x272508,_0x46d2d8,_0x15f983,_0x169dcf){const _0x377102=a6_0x1221fe;try{if(!_0x46d2d8||!_0x46d2d8[_0x377102(0x1e1)])return;Math[_0x377102(0x1d9)]()<0.01&&console[_0x377102(0x1cb)]('[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20'+_0x15f983+_0x377102(0x1ae)+_0x46d2d8[_0x377102(0x1e1)][_0x377102(0x1c8)]+_0x377102(0x1dd));const _0xbe883c=Buffer[_0x377102(0x22b)](_0x46d2d8['data'],_0x377102(0x217)),_0x1fdd13=this[_0x377102(0x1e3)]['isDepthTopic'](_0x15f983);let _0x299439;_0x1fdd13?_0x299439=await this['depthProcessor'][_0x377102(0x1b7)](_0xbe883c,_0x3efe98,_0x272508,_0x15f983):_0x299439=await this[_0x377102(0x1e3)][_0x377102(0x19e)](_0xbe883c,_0x3efe98,_0x272508),_0x272508[_0x377102(0x198)](_0x299439,0x0,0x0),_0x272508[_0x377102(0x1c3)]=_0x377102(0x1a9),_0x272508[_0x377102(0x229)](0xa,0xa,0xdc,0x32),_0x272508[_0x377102(0x1c3)]=_0x1fdd13?'#00ffff':'#00ff00',_0x272508[_0x377102(0x21a)]='12px\x20monospace',_0x272508[_0x377102(0x1a5)]((_0x1fdd13?_0x377102(0x209):'📹\x20Color')+':\x20'+new Date()[_0x377102(0x200)](),0xf,0x1c),_0x272508[_0x377102(0x1c3)]='#ffffff',_0x272508[_0x377102(0x21a)]=_0x377102(0x222),_0x272508[_0x377102(0x1a5)](_0x377102(0x22c)+_0x15f983[_0x377102(0x207)]('/')[_0x377102(0x20e)](),0xf,0x2d),this[_0x377102(0x1a6)](_0x169dcf,_0x3efe98);}catch(_0x35fb1b){console[_0x377102(0x174)]('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x15f983+':',_0x35fb1b[_0x377102(0x1f3)]);_0x15f983[_0x377102(0x1aa)](_0x377102(0x1ff))&&Math[_0x377102(0x1d9)]()<0.1&&console[_0x377102(0x174)](_0x377102(0x1bc)+_0x15f983[_0x377102(0x1de)](_0x377102(0x1c7),_0x377102(0x177)));_0x272508[_0x377102(0x1c3)]=_0x377102(0x1bd),_0x272508[_0x377102(0x229)](0x0,0x0,_0x3efe98['width'],_0x3efe98[_0x377102(0x1af)]),_0x272508[_0x377102(0x1c3)]=_0x377102(0x17f),_0x272508[_0x377102(0x21a)]='16px\x20Arial',_0x272508['textAlign']='center';const _0x3721b0=_0x15f983[_0x377102(0x1aa)](_0x377102(0x1ff))?_0x377102(0x20f):_0x377102(0x203);_0x272508[_0x377102(0x1a5)](_0x3721b0,_0x3efe98[_0x377102(0x1f9)]/0x2,_0x3efe98['height']/0x2),_0x272508['fillStyle']=_0x377102(0x1b6),_0x272508[_0x377102(0x21a)]=_0x377102(0x1d3),_0x272508['fillText'](_0x377102(0x22c)+_0x15f983[_0x377102(0x207)]('/')['pop'](),_0x3efe98['width']/0x2,_0x3efe98[_0x377102(0x1af)]/0x2+0x19),this[_0x377102(0x1a6)](_0x169dcf,_0x3efe98);}}[a6_0x1221fe(0x1f7)](_0x5c1a07){const _0x478850=a6_0x1221fe,_0x5d807c=this[_0x478850(0x1da)][_0x478850(0x169)](_0x5c1a07);if(!_0x5d807c){console[_0x478850(0x174)](_0x478850(0x1bf)+_0x5c1a07);return;}console['log'](_0x478850(0x224)+_0x5c1a07+_0x478850(0x191)+_0x5d807c[_0x478850(0x208)]);try{this[_0x478850(0x201)]&&this[_0x478850(0x201)]['readyState']===this[_0x478850(0x201)][_0x478850(0x16e)]&&this[_0x478850(0x201)]['send'](JSON['stringify']({'op':_0x478850(0x1c2),'session_id':_0x5c1a07})),_0x5d807c[_0x478850(0x1ab)]&&_0x5d807c[_0x478850(0x1ab)][_0x478850(0x1a8)](),_0x5d807c[_0x478850(0x15c)]&&_0x5d807c[_0x478850(0x15c)][_0x478850(0x21f)]();}catch(_0x2818f2){console[_0x478850(0x1a4)](_0x478850(0x1ad)+_0x2818f2);}this[_0x478850(0x190)](_0x5c1a07);}['cleanupSession'](_0x3095e3){const _0x391b31=a6_0x1221fe,_0x584f06=this[_0x391b31(0x1da)]['get'](_0x3095e3);if(_0x584f06){const _0xad227b=this[_0x391b31(0x170)][_0x391b31(0x169)](_0x584f06[_0x391b31(0x208)]);_0xad227b&&(_0xad227b[_0x391b31(0x15b)](_0x3095e3),_0xad227b['size']===0x0&&this['topicSessions']['delete'](_0x584f06[_0x391b31(0x208)])),this[_0x391b31(0x218)](_0x584f06['topic']);}this[_0x391b31(0x1da)]['delete'](_0x3095e3),console['log'](_0x391b31(0x1bb)+_0x3095e3);}[a6_0x1221fe(0x1d8)](){const _0x4c515f=a6_0x1221fe;console[_0x4c515f(0x1cb)](_0x4c515f(0x1fc));const _0x10efbe=Array[_0x4c515f(0x22b)](this['activeSessions'][_0x4c515f(0x1a0)]());_0x10efbe[_0x4c515f(0x166)](_0x31fb37=>this[_0x4c515f(0x1f7)](_0x31fb37));}['getActiveSessions'](){const _0x8ab9c8=a6_0x1221fe,_0x2aed0e=[];for(const [_0x1eb29d,_0xc8b9ae]of this[_0x8ab9c8(0x1da)]){_0x2aed0e[_0x8ab9c8(0x18a)]({'sessionId':_0x1eb29d,'topic':_0xc8b9ae[_0x8ab9c8(0x208)],'connectionState':_0xc8b9ae[_0x8ab9c8(0x15c)]?.[_0x8ab9c8(0x1f1)]||_0x8ab9c8(0x186),'hasVideoTrack':!!_0xc8b9ae[_0x8ab9c8(0x1ab)]});}return _0x2aed0e;}['getSharedVideoSources'](){const _0x2aa91c=a6_0x1221fe,_0x4b7837=[];for(const [_0x4b70a6,_0x2d956b]of this['sharedVideoSources']){_0x4b7837[_0x2aa91c(0x18a)]({'topic':_0x4b70a6,'frameCount':_0x2d956b[_0x2aa91c(0x165)],'hasVideoSource':!!_0x2d956b[_0x2aa91c(0x176)],'hasRosSubscriber':!!_0x2d956b[_0x2aa91c(0x15e)]});}return _0x4b7837;}}module[a6_0x1221fe(0x214)]=new ApplianceWebRTCService();