const a9_0x5da3b1=a9_0x52d9;(function(_0x34dd50,_0x34e686){const _0x375b30=a9_0x52d9,_0xa93e45=_0x34dd50();while(!![]){try{const _0x175668=-parseInt(_0x375b30(0xe9))/0x1*(parseInt(_0x375b30(0xfe))/0x2)+-parseInt(_0x375b30(0x153))/0x3*(-parseInt(_0x375b30(0x155))/0x4)+-parseInt(_0x375b30(0x182))/0x5*(parseInt(_0x375b30(0xd6))/0x6)+-parseInt(_0x375b30(0x164))/0x7*(parseInt(_0x375b30(0x12d))/0x8)+-parseInt(_0x375b30(0x146))/0x9*(parseInt(_0x375b30(0x16e))/0xa)+parseInt(_0x375b30(0xd3))/0xb+parseInt(_0x375b30(0x16f))/0xc;if(_0x175668===_0x34e686)break;else _0xa93e45['push'](_0xa93e45['shift']());}catch(_0xf70381){_0xa93e45['push'](_0xa93e45['shift']());}}}(a9_0x153e,0x28792));const a9_0x24cb4b=(function(){let _0x537cb1=!![];return function(_0x1445ff,_0x2969e4){const _0x360218=_0x537cb1?function(){const _0xf1a794=a9_0x52d9;if(_0x2969e4){const _0x46b4b6=_0x2969e4[_0xf1a794(0xe8)](_0x1445ff,arguments);return _0x2969e4=null,_0x46b4b6;}}:function(){};return _0x537cb1=![],_0x360218;};}()),a9_0x305861=a9_0x24cb4b(this,function(){const _0x4874a4=a9_0x52d9;return a9_0x305861[_0x4874a4(0x112)]()[_0x4874a4(0xeb)]('(((.+)+)+)+$')[_0x4874a4(0x112)]()[_0x4874a4(0x14b)](a9_0x305861)[_0x4874a4(0xeb)]('(((.+)+)+)+$');});a9_0x305861();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a9_0x5da3b1(0x128)),sharp=require(a9_0x5da3b1(0xbd)),config=require(a9_0x5da3b1(0x17a)),DepthImageProcessor=require(a9_0x5da3b1(0xe7)),turnCredentialsService=require(a9_0x5da3b1(0x15c));function a9_0x52d9(_0x38d711,_0x483c2d){const _0x1bdf86=a9_0x153e();return a9_0x52d9=function(_0x305861,_0x24cb4b){_0x305861=_0x305861-0xbd;let _0x153e24=_0x1bdf86[_0x305861];return _0x153e24;},a9_0x52d9(_0x38d711,_0x483c2d);}function a9_0x153e(){const _0x2b7401=['[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','msg','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','framerate','subscribeToROSTopic','unsubscribe','\x20connection\x20state:\x20','initialize','stop','send','forEach','rosSubscriber','18zkALro','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','webrtc','pop','/image_raw','constructor','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','serverWs','getContext','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','\x20initialized\x20successfully','textAlign','subscribe','40758XPXtUL','\x20detected\x20as\x20','76goLJxU','12px\x20monospace','replace','canvas','cleanupSession','\x20connection\x20failed,\x20stopping\x20session','/image','./turnCredentialsService','10px\x20monospace','addIceCandidate','ðŸ“¹\x20Color','addEventListener','onconnectionstatechange',',\x20cleaning\x20up\x20shared\x20resources','offer','91JWFMep','closed','unknown','connected','\x20with\x20message\x20type\x20','base64','push','\x20for\x20topic\x20','Topic:\x20','sensor_msgs/Image','1033310rTfoTA','7762560zcYbIH','#00aaff','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','#ffffff','stringify','videoTrack','#00ffff','round','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','delete','../config','color','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','warn','video','length','sharedVideoSources','175390OsPMBd','#666','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','sharp','createAnswer','frameCount','depth','/compressed','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','/compressedDepth','initializeSession','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','connectionState','#1a1a1a','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','readyState','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','[WebRTC\x20Appliance]\x20Session\x20','topicSessions','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','data','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','publish','\x20for\x20topic:\x20','getOrCreateSharedVideoSource','159577DsLkfd','initializing','sin','54cZIFXr','from','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','processDepthImage','\x20successfully\x20connected!','OPEN','size','random','ðŸ”\x20Processing\x20depth...','sensor_msgs/CompressedImage','fillText','sendFrameToVideoSource','candidate','session_id','onFrame','activeSessions','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','./DepthImageProcessor','apply','3vXyyoD','address','search','peerConnection','getSharedVideoSources','includes','\x20bytes','16px\x20Arial','get','sensor_msgs/msg/CompressedImage','center','error','depthProcessor','ðŸ“¹\x20Processing\x20video...','rtcConfig','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','toLocaleTimeString','\x20sessions\x20remaining)','fillStyle','updateCanvasWithImageData','#00ff00','123668ASCsvH','removeEventListener','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','set','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','parse','webrtc_answer','message','topic','stopAllSessions','12px\x20Arial','beginPath','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','arc','width','height','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','ðŸ¤–\x20Robot\x20Camera','function','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','toString','#888','rosbridgeWs','\x20image,\x20trying\x20message\x20types:','\x20connection\x20closed,\x20cleaning\x20up','now','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','close','sensor_msgs/msg/Image','startsWith','updateTurnCredentials',',\x20trying\x20alternative\x20depth\x20topics','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','max','drawLoadingPattern','videoSource','convertRGBAtoI420','log','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','stopSession','\x20sessions)','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','wrtc','releaseSharedVideoSource','font','keys','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','28232Iavoji','fillRect','type','webrtc_ice_candidate','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','24px\x20Arial','webrtc_stop_session','split','min','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','stun:stun1.l.google.com:19302',',\x20converting\x20to\x20base64...','handleIceCandidate'];a9_0x153e=function(){return _0x2b7401;};return a9_0x153e();}class ApplianceWebRTCService{constructor(){const _0x224f78=a9_0x5da3b1;this['activeSessions']=new Map(),this[_0x224f78(0xcc)]=new Map(),this['sharedVideoSources']=new Map(),this[_0x224f78(0x114)]=null,this['serverWs']=null,this['depthProcessor']=new DepthImageProcessor(),this[_0x224f78(0xf7)]={'iceServers':[{'urls':'stun:stun.l.google.com:19302'},{'urls':_0x224f78(0x137)}]};}['initialize'](_0x51d7f7,_0x2ec567){const _0x157158=a9_0x5da3b1;this['rosbridgeWs']=_0x51d7f7,this['serverWs']=_0x2ec567,turnCredentialsService[_0x157158(0x141)](config['serverUrl']),this['updateTurnCredentials'](),console[_0x157158(0x123)]('[WebRTC\x20Appliance]\x20Service\x20initialized');}async[a9_0x5da3b1(0x11c)](){const _0x2005c6=a9_0x5da3b1;try{console['log'](_0x2005c6(0x131));const _0x19eef7=await turnCredentialsService['getIceServers']();this[_0x2005c6(0xf7)]['iceServers']=_0x19eef7,console[_0x2005c6(0x123)](_0x2005c6(0xca));}catch(_0xf4fc79){console[_0x2005c6(0xf4)](_0x2005c6(0xc5),_0xf4fc79),console['log']('[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers');}}['handleMessage'](_0xc21d2c){const _0x52606f=a9_0x5da3b1;if(!_0xc21d2c['op']||!_0xc21d2c['op'][_0x52606f(0x11b)]('webrtc_'))return![];console[_0x52606f(0x123)](_0x52606f(0x13c)+_0xc21d2c['op']);switch(_0xc21d2c['op']){case'webrtc_init_session':this['initializeSession'](_0xc21d2c[_0x52606f(0xe3)],_0xc21d2c[_0x52606f(0x106)]);return!![];case'webrtc_offer':this['handleOffer'](_0xc21d2c[_0x52606f(0xe3)],_0xc21d2c[_0x52606f(0x163)]);return!![];case _0x52606f(0x130):this[_0x52606f(0x139)](_0xc21d2c[_0x52606f(0xe3)],_0xc21d2c[_0x52606f(0xe2)]);return!![];case _0x52606f(0x133):this[_0x52606f(0x125)](_0xc21d2c[_0x52606f(0xe3)]);return!![];default:console[_0x52606f(0x17e)]('[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20'+_0xc21d2c['op']);return![];}}[a9_0x5da3b1(0xd2)](_0xfeca0c){const _0x4e1742=a9_0x5da3b1;if(this[_0x4e1742(0x181)]['has'](_0xfeca0c)){const _0xc3f6f9=this[_0x4e1742(0x181)][_0x4e1742(0xf1)](_0xfeca0c);return _0xc3f6f9['frameCount']++,console['log'](_0x4e1742(0x127)+_0xfeca0c+'\x20('+_0xc3f6f9[_0x4e1742(0xbf)]+_0x4e1742(0x126)),_0xc3f6f9;}console['log'](_0x4e1742(0x178)+_0xfeca0c);const {createCanvas:_0x494403}=require(_0x4e1742(0x158)),_0x1aec64=_0x494403(config[_0x4e1742(0x148)][_0x4e1742(0x17f)][_0x4e1742(0x10c)],config[_0x4e1742(0x148)][_0x4e1742(0x17f)]['height']),_0x2b5758=_0x1aec64[_0x4e1742(0x14e)]('2d');this['drawLoadingPattern'](_0x1aec64,_0x2b5758);const {RTCVideoSource:_0x4a6079}=nonstandard,_0x313e06=new _0x4a6079();let _0x1cbe10=0x0;const _0x333edd=0x3e8/config[_0x4e1742(0x148)][_0x4e1742(0x17f)][_0x4e1742(0x13d)],_0x9e9684=this[_0x4e1742(0x13e)](_0xfeca0c,_0x5b636d=>{const _0x3179ed=_0x4e1742,_0x215fa6=Date['now']();_0x215fa6-_0x1cbe10>=_0x333edd&&(_0x1cbe10=_0x215fa6,this[_0x3179ed(0xfc)](_0x1aec64,_0x2b5758,_0x5b636d,_0xfeca0c,_0x313e06));}),_0x575025={'videoSource':_0x313e06,'canvas':_0x1aec64,'rosSubscriber':_0x9e9684,'frameCount':0x1,'topic':_0xfeca0c};return this[_0x4e1742(0x181)][_0x4e1742(0x101)](_0xfeca0c,_0x575025),_0x575025;}[a9_0x5da3b1(0x129)](_0x40d4e1){const _0x13dee4=a9_0x5da3b1,_0x3aa920=this[_0x13dee4(0x181)][_0x13dee4(0xf1)](_0x40d4e1);if(!_0x3aa920)return;_0x3aa920[_0x13dee4(0xbf)]--,console[_0x13dee4(0x123)](_0x13dee4(0x10a)+_0x40d4e1+'\x20('+_0x3aa920['frameCount']+_0x13dee4(0xfa)),_0x3aa920[_0x13dee4(0xbf)]<=0x0&&(console[_0x13dee4(0x123)]('[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20'+_0x40d4e1+_0x13dee4(0x162)),_0x3aa920['videoSource']&&(_0x3aa920[_0x13dee4(0x121)]=null),_0x3aa920[_0x13dee4(0x145)]&&_0x3aa920[_0x13dee4(0x145)][_0x13dee4(0x13f)](),this['sharedVideoSources']['delete'](_0x40d4e1));}async[a9_0x5da3b1(0xc4)](_0x3265e1,_0x52d9ed){const _0x4a0385=a9_0x5da3b1;try{console[_0x4a0385(0x123)]('[WebRTC\x20Appliance]\x20Initializing\x20session\x20'+_0x3265e1+_0x4a0385(0x16b)+_0x52d9ed);const _0x3027df=this[_0x4a0385(0xd2)](_0x52d9ed),_0x2abebf=new RTCPeerConnection(this['rtcConfig']),_0x150990=_0x3027df[_0x4a0385(0x121)]['createTrack']({'width':config['webrtc'][_0x4a0385(0x17f)][_0x4a0385(0x10c)],'height':config[_0x4a0385(0x148)][_0x4a0385(0x17f)]['height'],'framerate':config['webrtc'][_0x4a0385(0x17f)][_0x4a0385(0x13d)]});console['log']('[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20'+_0x3265e1);const {MediaStream:_0x4f0549}=require(_0x4a0385(0x128)),_0x369b8a=new _0x4f0549([_0x150990]);_0x2abebf['addTrack'](_0x150990,_0x369b8a),this[_0x4a0385(0xe1)](_0x3027df[_0x4a0385(0x121)],_0x3027df['canvas']),_0x2abebf['onicecandidate']=_0x2c871e=>{const _0x262d00=_0x4a0385;if(_0x2c871e[_0x262d00(0xe2)]&&this['serverWs'])console[_0x262d00(0x123)](_0x262d00(0xc2)+_0x3265e1+':',{'type':_0x2c871e[_0x262d00(0xe2)][_0x262d00(0x12f)],'protocol':_0x2c871e[_0x262d00(0xe2)]['protocol'],'address':_0x2c871e['candidate'][_0x262d00(0xea)],'port':_0x2c871e[_0x262d00(0xe2)]['port']}),this[_0x262d00(0x14d)][_0x262d00(0x143)](JSON[_0x262d00(0x173)]({'op':_0x262d00(0x130),'session_id':_0x3265e1,'candidate':_0x2c871e[_0x262d00(0xe2)]}));else!_0x2c871e[_0x262d00(0xe2)]&&console[_0x262d00(0x123)]('[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20'+_0x3265e1);},_0x2abebf[_0x4a0385(0x161)]=()=>{const _0x30823d=_0x4a0385;console['log']('[WebRTC\x20Appliance]\x20Session\x20'+_0x3265e1+_0x30823d(0x140)+_0x2abebf[_0x30823d(0xc6)]);if(_0x2abebf[_0x30823d(0xc6)]===_0x30823d(0x167))console[_0x30823d(0x123)](_0x30823d(0xcb)+_0x3265e1+_0x30823d(0xda));else{if(_0x2abebf['connectionState']==='failed')console[_0x30823d(0x123)](_0x30823d(0xcb)+_0x3265e1+_0x30823d(0x15a)),this[_0x30823d(0x125)](_0x3265e1);else _0x2abebf[_0x30823d(0xc6)]===_0x30823d(0x165)&&(console[_0x30823d(0x123)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x3265e1+_0x30823d(0x116)),this[_0x30823d(0x159)](_0x3265e1));}},this['activeSessions'][_0x4a0385(0x101)](_0x3265e1,{'peerConnection':_0x2abebf,'topic':_0x52d9ed,'videoTrack':_0x150990,'mediaStream':_0x369b8a,'status':_0x4a0385(0xd4)}),!this[_0x4a0385(0xcc)]['has'](_0x52d9ed)&&this[_0x4a0385(0xcc)]['set'](_0x52d9ed,new Set()),this['topicSessions']['get'](_0x52d9ed)['add'](_0x3265e1),console['log']('[WebRTC\x20Appliance]\x20Session\x20'+_0x3265e1+_0x4a0385(0x150)),console[_0x4a0385(0x123)](_0x4a0385(0x10e)+_0x52d9ed+':\x20'+this[_0x4a0385(0xcc)][_0x4a0385(0xf1)](_0x52d9ed)[_0x4a0385(0xdc)]);}catch(_0x1b78da){console[_0x4a0385(0xf4)](_0x4a0385(0xcd)+_0x3265e1+':',_0x1b78da),this[_0x4a0385(0x125)](_0x3265e1);}}async['handleOffer'](_0xac92d4,_0x3950ef){const _0x11e207=a9_0x5da3b1,_0x46c50b=this[_0x11e207(0xe5)][_0x11e207(0xf1)](_0xac92d4);if(!_0x46c50b){console[_0x11e207(0xf4)](_0x11e207(0x13a)+_0xac92d4);return;}try{console['log'](_0x11e207(0xcf)+_0xac92d4),await _0x46c50b['peerConnection']['setRemoteDescription'](new RTCSessionDescription(_0x3950ef)),console[_0x11e207(0x123)](_0x11e207(0x11e));const _0x3623ae=await _0x46c50b[_0x11e207(0xec)][_0x11e207(0xbe)]();console[_0x11e207(0x123)]('[WebRTC\x20Appliance]\x20Created\x20answer'),await _0x46c50b[_0x11e207(0xec)]['setLocalDescription'](_0x3623ae),console[_0x11e207(0x123)](_0x11e207(0xe6)),this[_0x11e207(0x14d)]&&(this[_0x11e207(0x14d)][_0x11e207(0x143)](JSON['stringify']({'op':_0x11e207(0x104),'session_id':_0xac92d4,'answer':_0x3623ae})),console['log']('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0xac92d4));}catch(_0xce35a3){console[_0x11e207(0xf4)]('[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20'+_0xac92d4+':',_0xce35a3),this[_0x11e207(0x125)](_0xac92d4);}}async[a9_0x5da3b1(0x139)](_0x2e897f,_0xbc8cdf){const _0x538a88=a9_0x5da3b1,_0x191dd1=this[_0x538a88(0xe5)][_0x538a88(0xf1)](_0x2e897f);if(!_0x191dd1){console[_0x538a88(0xf4)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20'+_0x2e897f);return;}try{await _0x191dd1['peerConnection'][_0x538a88(0x15e)](new RTCIceCandidate(_0xbc8cdf)),console[_0x538a88(0x123)](_0x538a88(0x102)+_0x2e897f);}catch(_0x56ad71){console[_0x538a88(0xf4)]('[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20'+_0x2e897f+':',_0x56ad71);}}[a9_0x5da3b1(0x13e)](_0x9f3cb,_0x4d1fdc){const _0x2a7dd4=a9_0x5da3b1;if(!this[_0x2a7dd4(0x114)]||this[_0x2a7dd4(0x114)][_0x2a7dd4(0xc9)]!==this[_0x2a7dd4(0x114)]['OPEN'])return console['error'](_0x2a7dd4(0x171)),null;console[_0x2a7dd4(0x123)](_0x2a7dd4(0x17d)+_0x9f3cb);const _0x24af71=_0x9f3cb[_0x2a7dd4(0xee)](_0x2a7dd4(0xc0)),_0x20fe60=_0x9f3cb['includes']('compressed')||_0x9f3cb[_0x2a7dd4(0xee)]('compressedDepth');let _0x36395b=[];_0x24af71?_0x20fe60?_0x36395b=[_0x2a7dd4(0xdf),'sensor_msgs/msg/CompressedImage','compressed_depth_image_transport/CompressedDepthImage',_0x2a7dd4(0x16d)]:_0x36395b=[_0x2a7dd4(0x16d),_0x2a7dd4(0x11a),_0x2a7dd4(0xdf)]:_0x36395b=[_0x2a7dd4(0xdf),_0x2a7dd4(0xf2),_0x2a7dd4(0x16d)];console[_0x2a7dd4(0x123)]('[WebRTC\x20Appliance]\x20Topic\x20'+_0x9f3cb+_0x2a7dd4(0x154)+(_0x24af71?_0x2a7dd4(0xc0):_0x2a7dd4(0x17b))+_0x2a7dd4(0x115),_0x36395b);const _0x1fb52c=[];let _0xf310a2=![];const _0x57f843=_0x1d36e2=>{return _0x497bd0=>{const _0x25531d=a9_0x52d9;try{const _0x2412a3=JSON[_0x25531d(0x103)](_0x497bd0['data']);_0x2412a3['op']==='publish'&&_0x2412a3['topic']===_0x9f3cb&&_0x2412a3[_0x25531d(0x13b)]&&(!_0xf310a2&&(console[_0x25531d(0x123)](_0x25531d(0x118)+_0x9f3cb+_0x25531d(0x168)+_0x1d36e2),_0xf310a2=!![]),_0x4d1fdc(_0x2412a3['msg']));}catch(_0x11c169){console['error'](_0x25531d(0x136),_0x11c169);}};};for(const _0x5516aa of _0x36395b){const _0x1cc810={'op':_0x2a7dd4(0x152),'topic':_0x9f3cb,'type':_0x5516aa};console[_0x2a7dd4(0x123)](_0x2a7dd4(0x177)+_0x5516aa),this[_0x2a7dd4(0x114)][_0x2a7dd4(0x143)](JSON[_0x2a7dd4(0x173)](_0x1cc810));const _0x3843d5=_0x57f843(_0x5516aa);this[_0x2a7dd4(0x114)][_0x2a7dd4(0x160)](_0x2a7dd4(0x105),_0x3843d5),_0x1fb52c[_0x2a7dd4(0x16a)]({'handler':_0x3843d5,'type':_0x5516aa});}return _0x24af71&&_0x20fe60&&setTimeout(()=>{const _0x38e9b2=_0x2a7dd4;if(!_0xf310a2){console[_0x38e9b2(0x123)](_0x38e9b2(0x184)+_0x9f3cb+_0x38e9b2(0x11d));const _0xac8d9=_0x9f3cb['replace'](_0x38e9b2(0xc3),'')[_0x38e9b2(0x157)](_0x38e9b2(0xc1),''),_0x148196=[_0xac8d9+_0x38e9b2(0x14a),_0xac8d9+_0x38e9b2(0x15b),_0xac8d9];for(const _0x5e04a4 of _0x148196){console[_0x38e9b2(0x123)](_0x38e9b2(0x147)+_0x5e04a4);const _0x5e3dce={'op':'subscribe','topic':_0x5e04a4,'type':_0x38e9b2(0x16d)};this['rosbridgeWs'][_0x38e9b2(0x143)](JSON[_0x38e9b2(0x173)](_0x5e3dce));const _0x279c6f=_0x2350c9=>{const _0x4b318f=_0x38e9b2;try{const _0x3a1843=JSON[_0x4b318f(0x103)](_0x2350c9[_0x4b318f(0xce)]);_0x3a1843['op']===_0x4b318f(0xd0)&&_0x3a1843[_0x4b318f(0x106)]===_0x5e04a4&&_0x3a1843[_0x4b318f(0x13b)]&&(console[_0x4b318f(0x123)](_0x4b318f(0x100)+_0x5e04a4+_0x4b318f(0x138)),_0x3a1843[_0x4b318f(0x13b)][_0x4b318f(0xce)]&&!_0x3a1843[_0x4b318f(0x13b)][_0x4b318f(0xce)][_0x4b318f(0x11b)]('/9j/')&&_0x4d1fdc(_0x3a1843[_0x4b318f(0x13b)]));}catch(_0x2fe7a9){console[_0x4b318f(0xf4)](_0x4b318f(0x14c),_0x2fe7a9);}};this['rosbridgeWs'][_0x38e9b2(0x160)](_0x38e9b2(0x105),_0x279c6f),_0x1fb52c[_0x38e9b2(0x16a)]({'handler':_0x279c6f,'type':_0x38e9b2(0x16d),'topic':_0x5e04a4});}}},0xbb8),{'unsubscribe':()=>{const _0x15c3f9=_0x2a7dd4;for(const {handler:_0x496c7c,type:_0x1f19c9,topic:_0x204956}of _0x1fb52c){this['rosbridgeWs'][_0x15c3f9(0xff)]('message',_0x496c7c),this['rosbridgeWs'][_0x15c3f9(0xc9)]===this[_0x15c3f9(0x114)][_0x15c3f9(0xdb)]&&this[_0x15c3f9(0x114)][_0x15c3f9(0x143)](JSON['stringify']({'op':'unsubscribe','topic':_0x204956||_0x9f3cb}));}}};}[a9_0x5da3b1(0x120)](_0x51623b,_0x559c0e){const _0x157001=a9_0x5da3b1;_0x559c0e['fillStyle']=_0x157001(0xc7),_0x559c0e[_0x157001(0x12e)](0x0,0x0,_0x51623b[_0x157001(0x10c)],_0x51623b['height']),_0x559c0e[_0x157001(0xfb)]=_0x157001(0x170),_0x559c0e[_0x157001(0x12a)]=_0x157001(0x132),_0x559c0e['textAlign']=_0x157001(0xf3),_0x559c0e[_0x157001(0xe0)](_0x157001(0x10f),_0x51623b[_0x157001(0x10c)]/0x2,_0x51623b['height']/0x2-0x14),_0x559c0e[_0x157001(0xfb)]=_0x157001(0x172),_0x559c0e[_0x157001(0x12a)]='16px\x20Arial',_0x559c0e[_0x157001(0xe0)]('Waiting\x20for\x20ROS\x20image\x20data...',_0x51623b[_0x157001(0x10c)]/0x2,_0x51623b[_0x157001(0x10d)]/0x2+0x14);const _0x2e2009=Date[_0x157001(0x117)]()/0x3e8;for(let _0x5af33e=0x0;_0x5af33e<0x3;_0x5af33e++){const _0x1ca928=(Math[_0x157001(0xd5)](_0x2e2009*0x2+_0x5af33e*0.5)+0x1)/0x2;_0x559c0e[_0x157001(0xfb)]='rgba(0,\x20170,\x20255,\x20'+_0x1ca928*0.5+')',_0x559c0e[_0x157001(0x109)](),_0x559c0e[_0x157001(0x10b)](_0x51623b[_0x157001(0x10c)]/0x2-0x28+_0x5af33e*0x28,_0x51623b[_0x157001(0x10d)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x559c0e['fill']();}}[a9_0x5da3b1(0xe1)](_0x4737db,_0x396c7e){const _0x31583f=a9_0x5da3b1;try{if(!_0x4737db||!_0x396c7e)return;const _0xa07350=_0x396c7e[_0x31583f(0x14e)]('2d'),_0x39d29e=_0xa07350['getImageData'](0x0,0x0,_0x396c7e['width'],_0x396c7e[_0x31583f(0x10d)]),_0x4f7bc1=this['convertRGBAtoI420'](_0x39d29e[_0x31583f(0xce)],_0x396c7e['width'],_0x396c7e[_0x31583f(0x10d)]),_0x2b14fe={'width':_0x396c7e[_0x31583f(0x10c)],'height':_0x396c7e['height'],'data':_0x4f7bc1};typeof _0x4737db[_0x31583f(0xe4)]===_0x31583f(0x110)&&_0x4737db[_0x31583f(0xe4)](_0x2b14fe);}catch(_0x196ff3){console[_0x31583f(0xf4)](_0x31583f(0xf8),_0x196ff3);}}[a9_0x5da3b1(0x122)](_0x1e861b,_0x3e2b44,_0x11ccd8){const _0x29e7eb=a9_0x5da3b1,_0x10493f=_0x3e2b44*_0x11ccd8,_0xdde482=_0x3e2b44*_0x11ccd8/0x4,_0x5af4ad=new Uint8Array(_0x10493f+_0xdde482*0x2);let _0x6914c3=0x0,_0x2f9dfc=_0x10493f,_0x10531f=_0x10493f+_0xdde482;for(let _0x547f86=0x0;_0x547f86<_0x11ccd8;_0x547f86++){for(let _0x2cd03c=0x0;_0x2cd03c<_0x3e2b44;_0x2cd03c++){const _0x3407a3=(_0x547f86*_0x3e2b44+_0x2cd03c)*0x4,_0x255815=_0x1e861b[_0x3407a3],_0x4928c1=_0x1e861b[_0x3407a3+0x1],_0x44ed58=_0x1e861b[_0x3407a3+0x2],_0x56915b=Math['round'](0.299*_0x255815+0.587*_0x4928c1+0.114*_0x44ed58);_0x5af4ad[_0x6914c3++]=_0x56915b;if(_0x547f86%0x2===0x0&&_0x2cd03c%0x2===0x0){const _0x5ac40b=Math[_0x29e7eb(0x176)](-0.169*_0x255815-0.331*_0x4928c1+0.5*_0x44ed58+0x80),_0x215d89=Math[_0x29e7eb(0x176)](0.5*_0x255815-0.419*_0x4928c1-0.081*_0x44ed58+0x80);_0x5af4ad[_0x2f9dfc++]=Math[_0x29e7eb(0x11f)](0x0,Math[_0x29e7eb(0x135)](0xff,_0x5ac40b)),_0x5af4ad[_0x10531f++]=Math[_0x29e7eb(0x11f)](0x0,Math['min'](0xff,_0x215d89));}}}return _0x5af4ad;}async[a9_0x5da3b1(0xfc)](_0x66f8fb,_0x546eae,_0x4721f9,_0x207cf5,_0x2283fc){const _0x260327=a9_0x5da3b1;try{if(!_0x4721f9||!_0x4721f9[_0x260327(0xce)])return;Math['random']()<0.01&&console[_0x260327(0x123)](_0x260327(0x124)+_0x207cf5+',\x20size:\x20'+_0x4721f9['data'][_0x260327(0x180)]+_0x260327(0xef));const _0x27b0d0=Buffer[_0x260327(0xd7)](_0x4721f9['data'],_0x260327(0x169)),_0x50b263=this[_0x260327(0xf5)]['isDepthTopic'](_0x207cf5);let _0x37d365;_0x50b263?_0x37d365=await this['depthProcessor'][_0x260327(0xd9)](_0x27b0d0,_0x66f8fb,_0x546eae,_0x207cf5):_0x37d365=await this[_0x260327(0xf5)]['processColorImage'](_0x27b0d0,_0x66f8fb,_0x546eae),_0x546eae['putImageData'](_0x37d365,0x0,0x0),_0x546eae[_0x260327(0xfb)]='rgba(0,\x200,\x200,\x200.7)',_0x546eae[_0x260327(0x12e)](0xa,0xa,0xdc,0x32),_0x546eae['fillStyle']=_0x50b263?_0x260327(0x175):_0x260327(0xfd),_0x546eae[_0x260327(0x12a)]=_0x260327(0x156),_0x546eae['fillText']((_0x50b263?'ðŸ”\x20Depth':_0x260327(0x15f))+':\x20'+new Date()[_0x260327(0xf9)](),0xf,0x1c),_0x546eae[_0x260327(0xfb)]=_0x260327(0x172),_0x546eae['font']=_0x260327(0x15d),_0x546eae['fillText'](_0x260327(0x16c)+_0x207cf5[_0x260327(0x134)]('/')[_0x260327(0x149)](),0xf,0x2d),this[_0x260327(0xe1)](_0x2283fc,_0x66f8fb);}catch(_0x266c50){console['warn'](_0x260327(0x17c)+_0x207cf5+':',_0x266c50['message']);_0x207cf5['includes'](_0x260327(0xc0))&&Math[_0x260327(0xdd)]()<0.1&&console['warn'](_0x260327(0x12c)+_0x207cf5['replace'](_0x260327(0xc3),'/image_raw'));_0x546eae[_0x260327(0xfb)]=_0x260327(0xc7),_0x546eae[_0x260327(0x12e)](0x0,0x0,_0x66f8fb[_0x260327(0x10c)],_0x66f8fb[_0x260327(0x10d)]),_0x546eae['fillStyle']=_0x260327(0x113),_0x546eae[_0x260327(0x12a)]=_0x260327(0xf0),_0x546eae[_0x260327(0x151)]=_0x260327(0xf3);const _0x5e37bb=_0x207cf5['includes'](_0x260327(0xc0))?_0x260327(0xde):_0x260327(0xf6);_0x546eae[_0x260327(0xe0)](_0x5e37bb,_0x66f8fb[_0x260327(0x10c)]/0x2,_0x66f8fb[_0x260327(0x10d)]/0x2),_0x546eae[_0x260327(0xfb)]=_0x260327(0x183),_0x546eae[_0x260327(0x12a)]=_0x260327(0x108),_0x546eae[_0x260327(0xe0)](_0x260327(0x16c)+_0x207cf5[_0x260327(0x134)]('/')[_0x260327(0x149)](),_0x66f8fb[_0x260327(0x10c)]/0x2,_0x66f8fb['height']/0x2+0x19),this['sendFrameToVideoSource'](_0x2283fc,_0x66f8fb);}}['stopSession'](_0x1eec37){const _0x2c839a=a9_0x5da3b1,_0x10d30b=this[_0x2c839a(0xe5)][_0x2c839a(0xf1)](_0x1eec37);if(!_0x10d30b){console['warn'](_0x2c839a(0xc8)+_0x1eec37);return;}console[_0x2c839a(0x123)](_0x2c839a(0x14f)+_0x1eec37+_0x2c839a(0xd1)+_0x10d30b['topic']);try{this[_0x2c839a(0x14d)]&&this['serverWs'][_0x2c839a(0xc9)]===this[_0x2c839a(0x14d)][_0x2c839a(0xdb)]&&this[_0x2c839a(0x14d)]['send'](JSON[_0x2c839a(0x173)]({'op':_0x2c839a(0x133),'session_id':_0x1eec37})),_0x10d30b['videoTrack']&&_0x10d30b[_0x2c839a(0x174)][_0x2c839a(0x142)](),_0x10d30b[_0x2c839a(0xec)]&&_0x10d30b[_0x2c839a(0xec)][_0x2c839a(0x119)]();}catch(_0x2f216f){console[_0x2c839a(0xf4)]('[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20'+_0x2f216f);}this['cleanupSession'](_0x1eec37);}[a9_0x5da3b1(0x159)](_0x450b5d){const _0x8f2920=a9_0x5da3b1,_0x4892b5=this['activeSessions'][_0x8f2920(0xf1)](_0x450b5d);if(_0x4892b5){const _0x5d81f3=this[_0x8f2920(0xcc)][_0x8f2920(0xf1)](_0x4892b5[_0x8f2920(0x106)]);_0x5d81f3&&(_0x5d81f3['delete'](_0x450b5d),_0x5d81f3[_0x8f2920(0xdc)]===0x0&&this['topicSessions'][_0x8f2920(0x179)](_0x4892b5[_0x8f2920(0x106)])),this[_0x8f2920(0x129)](_0x4892b5[_0x8f2920(0x106)]);}this[_0x8f2920(0xe5)]['delete'](_0x450b5d),console[_0x8f2920(0x123)](_0x8f2920(0x111)+_0x450b5d);}[a9_0x5da3b1(0x107)](){const _0x4921b6=a9_0x5da3b1;console[_0x4921b6(0x123)](_0x4921b6(0xd8));const _0x30eb74=Array[_0x4921b6(0xd7)](this[_0x4921b6(0xe5)][_0x4921b6(0x12b)]());_0x30eb74[_0x4921b6(0x144)](_0x304d49=>this[_0x4921b6(0x125)](_0x304d49));}['getActiveSessions'](){const _0x9d5e3c=a9_0x5da3b1,_0xb6454f=[];for(const [_0x5330d6,_0x1c8ccd]of this['activeSessions']){_0xb6454f['push']({'sessionId':_0x5330d6,'topic':_0x1c8ccd[_0x9d5e3c(0x106)],'connectionState':_0x1c8ccd[_0x9d5e3c(0xec)]?.['connectionState']||_0x9d5e3c(0x166),'hasVideoTrack':!!_0x1c8ccd[_0x9d5e3c(0x174)]});}return _0xb6454f;}[a9_0x5da3b1(0xed)](){const _0x5ddfc8=a9_0x5da3b1,_0x46a468=[];for(const [_0x265254,_0x28acb7]of this[_0x5ddfc8(0x181)]){_0x46a468[_0x5ddfc8(0x16a)]({'topic':_0x265254,'frameCount':_0x28acb7[_0x5ddfc8(0xbf)],'hasVideoSource':!!_0x28acb7['videoSource'],'hasRosSubscriber':!!_0x28acb7['rosSubscriber']});}return _0x46a468;}}module['exports']=new ApplianceWebRTCService();