const a6_0x3d8a30=a6_0x1036;(function(_0x103232,_0x1729ce){const _0x5c9786=a6_0x1036,_0x11343e=_0x103232();while(!![]){try{const _0x3e5834=parseInt(_0x5c9786(0x162))/0x1*(parseInt(_0x5c9786(0x226))/0x2)+parseInt(_0x5c9786(0x217))/0x3+-parseInt(_0x5c9786(0x1e4))/0x4+-parseInt(_0x5c9786(0x21a))/0x5*(parseInt(_0x5c9786(0x1a4))/0x6)+parseInt(_0x5c9786(0x1a9))/0x7+parseInt(_0x5c9786(0x1ca))/0x8*(parseInt(_0x5c9786(0x22f))/0x9)+parseInt(_0x5c9786(0x16d))/0xa*(-parseInt(_0x5c9786(0x221))/0xb);if(_0x3e5834===_0x1729ce)break;else _0x11343e['push'](_0x11343e['shift']());}catch(_0x538c42){_0x11343e['push'](_0x11343e['shift']());}}}(a6_0x2630,0x7675c));function a6_0x1036(_0xe3e124,_0x2230c9){const _0x25fec6=a6_0x2630();return a6_0x1036=function(_0x286680,_0x1abcf7){_0x286680=_0x286680-0x160;let _0x263066=_0x25fec6[_0x286680];return _0x263066;},a6_0x1036(_0xe3e124,_0x2230c9);}const a6_0x1abcf7=(function(){let _0xeeea59=!![];return function(_0x39bb07,_0x49605a){const _0x4150e2=_0xeeea59?function(){if(_0x49605a){const _0x4f2b98=_0x49605a['apply'](_0x39bb07,arguments);return _0x49605a=null,_0x4f2b98;}}:function(){};return _0xeeea59=![],_0x4150e2;};}()),a6_0x286680=a6_0x1abcf7(this,function(){const _0x4482c1=a6_0x1036;return a6_0x286680[_0x4482c1(0x161)]()['search']('(((.+)+)+)+$')[_0x4482c1(0x161)]()['constructor'](a6_0x286680)[_0x4482c1(0x196)]('(((.+)+)+)+$');});a6_0x286680();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require('wrtc'),sharp=require(a6_0x3d8a30(0x1d3)),config=require(a6_0x3d8a30(0x216)),DepthImageProcessor=require(a6_0x3d8a30(0x1f2)),turnCredentialsService=require(a6_0x3d8a30(0x1d6));function a6_0x2630(){const _0x4ed856=['offer','Topic:\x20','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','getIceServers','3806bXaeIE','/image','convertRGBAtoI420','push','[WebRTC\x20Appliance]\x20Session\x20','57082yZDtmq','/compressed','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','24px\x20Arial','\x20initialized\x20successfully','has','\x20with\x20message\x20type\x20','subscribe','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','1062ClLmHI','#666','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','toString','32wHcCSa','drawLoadingPattern','font','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','📹\x20Color','webrtc','height','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','sensor_msgs/CompressedImage','webrtc_offer','msg','58670TNyytl','webrtc_','message','connectionState','candidate','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','#00aaff','/9j/','send','12px\x20Arial','stop','#ffffff','serverWs','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','updateCanvasWithImageData','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','/compressedDepth','startsWith','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','📹\x20Processing\x20video...','serverUrl','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','getSharedVideoSources','initializeSession','onconnectionstatechange','log','type','rgba(0,\x200,\x200,\x200.7)','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','removeEventListener','stopSession','port','color','releaseSharedVideoSource','from','unknown','set','closed','round','\x20sessions)','Waiting\x20for\x20ROS\x20image\x20data...','search','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','readyState','webrtc_init_session','rgba(0,\x20170,\x20255,\x20','#888','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','getOrCreateSharedVideoSource','OPEN','\x20connection\x20state:\x20','replace','\x20for\x20topic\x20','warn','videoSource','176898tRDmPK','onicecandidate','iceServers','textAlign','rtcConfig','6740111VdCvIe','topic','data','max','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','\x20detected\x20as\x20','length','beginPath','toLocaleTimeString','now','#1a1a1a','sharedVideoSources','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','fillStyle','webrtc_stop_session','exports','connected','sensor_msgs/Image','random','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','pop','onFrame','address','createAnswer','getActiveSessions','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','unsubscribe','sensor_msgs/msg/CompressedImage','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','isDepthTopic','compressed','/image_raw','get','41432dEjJAN','\x20sessions\x20remaining)','fillText','[WebRTC\x20Appliance]\x20Created\x20answer','depth','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','updateTurnCredentials','setRemoteDescription','sharp','session_id','publish','./turnCredentialsService','\x20image,\x20trying\x20message\x20types:','processDepthImage','width','activeSessions','error','compressed_depth_image_transport/CompressedDepthImage','🔍\x20Processing\x20depth...','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','webrtc_answer','initializing','arc','close','1103336Elqlfv','canvas','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','size','\x20bytes','addEventListener','cleanupSession','12px\x20monospace','handleIceCandidate','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','\x20for\x20topic:\x20','topicSessions','getContext','delete','./DepthImageProcessor','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','10px\x20monospace','video','sendFrameToVideoSource','handleMessage','webrtc_ice_candidate','#00ffff','min','add','stun:stun.l.google.com:19302','rosbridgeWs','sensor_msgs/msg/Image',',\x20cleaning\x20up\x20shared\x20resources','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','fillRect','depthProcessor','#00ff00','videoTrack','16px\x20Arial','parse','center','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','initialize','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','addTrack','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','compressedDepth','split','frameCount','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','peerConnection','stringify','base64','framerate','../config','999612befDit','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','rosSubscriber','5OhwPlB','setLocalDescription','includes'];a6_0x2630=function(){return _0x4ed856;};return a6_0x2630();}class ApplianceWebRTCService{constructor(){const _0x2be056=a6_0x3d8a30;this[_0x2be056(0x1da)]=new Map(),this[_0x2be056(0x1ef)]=new Map(),this[_0x2be056(0x1b4)]=new Map(),this[_0x2be056(0x1fd)]=null,this[_0x2be056(0x179)]=null,this[_0x2be056(0x202)]=new DepthImageProcessor(),this[_0x2be056(0x1a8)]={'iceServers':[{'urls':_0x2be056(0x1fc)},{'urls':'stun:stun1.l.google.com:19302'}]};}[a6_0x3d8a30(0x209)](_0x3dd45e,_0x1aed12){const _0x5690af=a6_0x3d8a30;this[_0x5690af(0x1fd)]=_0x3dd45e,this['serverWs']=_0x1aed12,turnCredentialsService[_0x5690af(0x209)](config[_0x5690af(0x181)]),this[_0x5690af(0x1d1)](),console[_0x5690af(0x186)]('[WebRTC\x20Appliance]\x20Service\x20initialized');}async[a6_0x3d8a30(0x1d1)](){const _0x274e35=a6_0x3d8a30;try{console[_0x274e35(0x186)](_0x274e35(0x228));const _0xea032b=await turnCredentialsService[_0x274e35(0x220)]();this['rtcConfig'][_0x274e35(0x1a6)]=_0xea032b,console[_0x274e35(0x186)](_0x274e35(0x1df));}catch(_0x2339aa){console[_0x274e35(0x1db)](_0x274e35(0x20c),_0x2339aa),console[_0x274e35(0x186)]('[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers');}}[a6_0x3d8a30(0x1f7)](_0x24a42c){const _0x298b26=a6_0x3d8a30;if(!_0x24a42c['op']||!_0x24a42c['op'][_0x298b26(0x17e)](_0x298b26(0x16e)))return![];console[_0x298b26(0x186)](_0x298b26(0x20d)+_0x24a42c['op']);switch(_0x24a42c['op']){case _0x298b26(0x199):this['initializeSession'](_0x24a42c['session_id'],_0x24a42c[_0x298b26(0x1aa)]);return!![];case _0x298b26(0x16b):this['handleOffer'](_0x24a42c[_0x298b26(0x1d4)],_0x24a42c[_0x298b26(0x21d)]);return!![];case _0x298b26(0x1f8):this[_0x298b26(0x1ec)](_0x24a42c[_0x298b26(0x1d4)],_0x24a42c[_0x298b26(0x171)]);return!![];case _0x298b26(0x1b7):this[_0x298b26(0x18b)](_0x24a42c[_0x298b26(0x1d4)]);return!![];default:console[_0x298b26(0x1a2)]('[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20'+_0x24a42c['op']);return![];}}[a6_0x3d8a30(0x19d)](_0x2091e5){const _0x2bd1fc=a6_0x3d8a30;if(this['sharedVideoSources'][_0x2bd1fc(0x22b)](_0x2091e5)){const _0x47baf3=this['sharedVideoSources'][_0x2bd1fc(0x1c9)](_0x2091e5);return _0x47baf3[_0x2bd1fc(0x210)]++,console[_0x2bd1fc(0x186)](_0x2bd1fc(0x1c2)+_0x2091e5+'\x20('+_0x47baf3[_0x2bd1fc(0x210)]+_0x2bd1fc(0x194)),_0x47baf3;}console[_0x2bd1fc(0x186)](_0x2bd1fc(0x1e6)+_0x2091e5);const {createCanvas:_0xc71aa0}=require(_0x2bd1fc(0x1e5)),_0x3bf17f=_0xc71aa0(config[_0x2bd1fc(0x167)]['video'][_0x2bd1fc(0x1d9)],config['webrtc'][_0x2bd1fc(0x1f5)]['height']),_0x56eb77=_0x3bf17f[_0x2bd1fc(0x1f0)]('2d');this[_0x2bd1fc(0x163)](_0x3bf17f,_0x56eb77);const {RTCVideoSource:_0x1acf90}=nonstandard,_0x231acd=new _0x1acf90();let _0x4b7457=0x0;const _0x4bda2c=0x3e8/config[_0x2bd1fc(0x167)]['video']['framerate'],_0x41b1a9=this['subscribeToROSTopic'](_0x2091e5,_0x4abdc5=>{const _0x2e88e4=_0x2bd1fc,_0x2e1ae0=Date[_0x2e88e4(0x1b2)]();_0x2e1ae0-_0x4b7457>=_0x4bda2c&&(_0x4b7457=_0x2e1ae0,this[_0x2e88e4(0x17b)](_0x3bf17f,_0x56eb77,_0x4abdc5,_0x2091e5,_0x231acd));}),_0x1154b1={'videoSource':_0x231acd,'canvas':_0x3bf17f,'rosSubscriber':_0x41b1a9,'frameCount':0x1,'topic':_0x2091e5};return this[_0x2bd1fc(0x1b4)][_0x2bd1fc(0x191)](_0x2091e5,_0x1154b1),_0x1154b1;}[a6_0x3d8a30(0x18e)](_0x304450){const _0xbd891a=a6_0x3d8a30,_0x431844=this[_0xbd891a(0x1b4)][_0xbd891a(0x1c9)](_0x304450);if(!_0x431844)return;_0x431844['frameCount']--,console['log'](_0xbd891a(0x172)+_0x304450+'\x20('+_0x431844['frameCount']+_0xbd891a(0x1cb)),_0x431844[_0xbd891a(0x210)]<=0x0&&(console[_0xbd891a(0x186)](_0xbd891a(0x1de)+_0x304450+_0xbd891a(0x1ff)),_0x431844[_0xbd891a(0x1a3)]&&(_0x431844['videoSource']=null),_0x431844[_0xbd891a(0x219)]&&_0x431844['rosSubscriber']['unsubscribe'](),this[_0xbd891a(0x1b4)][_0xbd891a(0x1f1)](_0x304450));}async[a6_0x3d8a30(0x184)](_0x5b5675,_0x39be64){const _0x1b8dd3=a6_0x3d8a30;try{console[_0x1b8dd3(0x186)](_0x1b8dd3(0x20a)+_0x5b5675+_0x1b8dd3(0x1a1)+_0x39be64);const _0x36181d=this[_0x1b8dd3(0x19d)](_0x39be64),_0x46cb4a=new RTCPeerConnection(this[_0x1b8dd3(0x1a8)]),_0x227254=_0x36181d[_0x1b8dd3(0x1a3)]['createTrack']({'width':config['webrtc']['video']['width'],'height':config['webrtc'][_0x1b8dd3(0x1f5)][_0x1b8dd3(0x168)],'framerate':config[_0x1b8dd3(0x167)]['video'][_0x1b8dd3(0x215)]});console[_0x1b8dd3(0x186)](_0x1b8dd3(0x182)+_0x5b5675);const {MediaStream:_0x26857b}=require('wrtc'),_0x41e0c1=new _0x26857b([_0x227254]);_0x46cb4a[_0x1b8dd3(0x20b)](_0x227254,_0x41e0c1),this[_0x1b8dd3(0x1f6)](_0x36181d[_0x1b8dd3(0x1a3)],_0x36181d['canvas']),_0x46cb4a[_0x1b8dd3(0x1a5)]=_0x55935d=>{const _0x4e45ed=_0x1b8dd3;if(_0x55935d[_0x4e45ed(0x171)]&&this[_0x4e45ed(0x179)])console['log'](_0x4e45ed(0x1d0)+_0x5b5675+':',{'type':_0x55935d[_0x4e45ed(0x171)][_0x4e45ed(0x187)],'protocol':_0x55935d['candidate']['protocol'],'address':_0x55935d['candidate'][_0x4e45ed(0x1bf)],'port':_0x55935d['candidate'][_0x4e45ed(0x18c)]}),this[_0x4e45ed(0x179)][_0x4e45ed(0x175)](JSON[_0x4e45ed(0x213)]({'op':_0x4e45ed(0x1f8),'session_id':_0x5b5675,'candidate':_0x55935d[_0x4e45ed(0x171)]}));else!_0x55935d['candidate']&&console[_0x4e45ed(0x186)](_0x4e45ed(0x208)+_0x5b5675);},_0x46cb4a[_0x1b8dd3(0x185)]=()=>{const _0x3e49c7=_0x1b8dd3;console[_0x3e49c7(0x186)](_0x3e49c7(0x225)+_0x5b5675+_0x3e49c7(0x19f)+_0x46cb4a[_0x3e49c7(0x170)]);if(_0x46cb4a[_0x3e49c7(0x170)]===_0x3e49c7(0x1b9))console['log'](_0x3e49c7(0x225)+_0x5b5675+'\x20successfully\x20connected!');else{if(_0x46cb4a[_0x3e49c7(0x170)]==='failed')console['log'](_0x3e49c7(0x225)+_0x5b5675+'\x20connection\x20failed,\x20stopping\x20session'),this[_0x3e49c7(0x18b)](_0x5b5675);else _0x46cb4a[_0x3e49c7(0x170)]===_0x3e49c7(0x192)&&(console[_0x3e49c7(0x186)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x5b5675+'\x20connection\x20closed,\x20cleaning\x20up'),this['cleanupSession'](_0x5b5675));}},this[_0x1b8dd3(0x1da)]['set'](_0x5b5675,{'peerConnection':_0x46cb4a,'topic':_0x39be64,'videoTrack':_0x227254,'mediaStream':_0x41e0c1,'status':_0x1b8dd3(0x1e1)}),!this[_0x1b8dd3(0x1ef)][_0x1b8dd3(0x22b)](_0x39be64)&&this['topicSessions'][_0x1b8dd3(0x191)](_0x39be64,new Set()),this[_0x1b8dd3(0x1ef)][_0x1b8dd3(0x1c9)](_0x39be64)[_0x1b8dd3(0x1fb)](_0x5b5675),console[_0x1b8dd3(0x186)](_0x1b8dd3(0x225)+_0x5b5675+_0x1b8dd3(0x22a)),console[_0x1b8dd3(0x186)](_0x1b8dd3(0x1ad)+_0x39be64+':\x20'+this[_0x1b8dd3(0x1ef)]['get'](_0x39be64)[_0x1b8dd3(0x1e7)]);}catch(_0x47da78){console['error'](_0x1b8dd3(0x1bc)+_0x5b5675+':',_0x47da78),this['stopSession'](_0x5b5675);}}async['handleOffer'](_0x5a9409,_0x36c23c){const _0x5ca9de=a6_0x3d8a30,_0x3006cd=this['activeSessions']['get'](_0x5a9409);if(!_0x3006cd){console[_0x5ca9de(0x1db)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20'+_0x5a9409);return;}try{console['log'](_0x5ca9de(0x169)+_0x5a9409),await _0x3006cd[_0x5ca9de(0x212)][_0x5ca9de(0x1d2)](new RTCSessionDescription(_0x36c23c)),console['log'](_0x5ca9de(0x1b5));const _0x322012=await _0x3006cd[_0x5ca9de(0x212)][_0x5ca9de(0x1c0)]();console[_0x5ca9de(0x186)](_0x5ca9de(0x1cd)),await _0x3006cd[_0x5ca9de(0x212)][_0x5ca9de(0x21b)](_0x322012),console[_0x5ca9de(0x186)](_0x5ca9de(0x1ed)),this[_0x5ca9de(0x179)]&&(this[_0x5ca9de(0x179)][_0x5ca9de(0x175)](JSON[_0x5ca9de(0x213)]({'op':_0x5ca9de(0x1e0),'session_id':_0x5a9409,'answer':_0x322012})),console[_0x5ca9de(0x186)](_0x5ca9de(0x218)+_0x5a9409));}catch(_0x2919e0){console[_0x5ca9de(0x1db)](_0x5ca9de(0x160)+_0x5a9409+':',_0x2919e0),this['stopSession'](_0x5a9409);}}async['handleIceCandidate'](_0x458cb3,_0x4d43b3){const _0x533b26=a6_0x3d8a30,_0x2cee3e=this[_0x533b26(0x1da)]['get'](_0x458cb3);if(!_0x2cee3e){console[_0x533b26(0x1db)](_0x533b26(0x1c5)+_0x458cb3);return;}try{await _0x2cee3e['peerConnection']['addIceCandidate'](new RTCIceCandidate(_0x4d43b3)),console[_0x533b26(0x186)](_0x533b26(0x1f3)+_0x458cb3);}catch(_0x2d673e){console[_0x533b26(0x1db)](_0x533b26(0x19c)+_0x458cb3+':',_0x2d673e);}}['subscribeToROSTopic'](_0xe53a78,_0x427977){const _0x43da95=a6_0x3d8a30;if(!this[_0x43da95(0x1fd)]||this[_0x43da95(0x1fd)][_0x43da95(0x198)]!==this[_0x43da95(0x1fd)][_0x43da95(0x19e)])return console[_0x43da95(0x1db)](_0x43da95(0x165)),null;console[_0x43da95(0x186)]('[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20'+_0xe53a78);const _0x3b88c9=_0xe53a78[_0x43da95(0x21c)]('depth'),_0x3676ad=_0xe53a78[_0x43da95(0x21c)](_0x43da95(0x1c7))||_0xe53a78['includes'](_0x43da95(0x20e));let _0x1b795b=[];_0x3b88c9?_0x3676ad?_0x1b795b=[_0x43da95(0x16a),_0x43da95(0x1c4),_0x43da95(0x1dc),_0x43da95(0x1ba)]:_0x1b795b=['sensor_msgs/Image',_0x43da95(0x1fe),_0x43da95(0x16a)]:_0x1b795b=['sensor_msgs/CompressedImage',_0x43da95(0x1c4),_0x43da95(0x1ba)];console[_0x43da95(0x186)]('[WebRTC\x20Appliance]\x20Topic\x20'+_0xe53a78+_0x43da95(0x1ae)+(_0x3b88c9?'depth':_0x43da95(0x18d))+_0x43da95(0x1d7),_0x1b795b);const _0x9a52be=[];let _0x39265e=![];const _0x229e78=_0x1fa702=>{return _0x1de36b=>{const _0x1612fa=a6_0x1036;try{const _0x5f1410=JSON[_0x1612fa(0x206)](_0x1de36b['data']);_0x5f1410['op']==='publish'&&_0x5f1410[_0x1612fa(0x1aa)]===_0xe53a78&&_0x5f1410['msg']&&(!_0x39265e&&(console[_0x1612fa(0x186)](_0x1612fa(0x17c)+_0xe53a78+_0x1612fa(0x22c)+_0x1fa702),_0x39265e=!![]),_0x427977(_0x5f1410[_0x1612fa(0x16c)]));}catch(_0x31270b){console[_0x1612fa(0x1db)](_0x1612fa(0x21f),_0x31270b);}};};for(const _0x2cc2dd of _0x1b795b){const _0x1ec0d0={'op':_0x43da95(0x22d),'topic':_0xe53a78,'type':_0x2cc2dd};console['log']('[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20'+_0x2cc2dd),this[_0x43da95(0x1fd)]['send'](JSON[_0x43da95(0x213)](_0x1ec0d0));const _0x457633=_0x229e78(_0x2cc2dd);this[_0x43da95(0x1fd)][_0x43da95(0x1e9)]('message',_0x457633),_0x9a52be[_0x43da95(0x224)]({'handler':_0x457633,'type':_0x2cc2dd});}return _0x3b88c9&&_0x3676ad&&setTimeout(()=>{const _0x28d02f=_0x43da95;if(!_0x39265e){console[_0x28d02f(0x186)]('[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20'+_0xe53a78+',\x20trying\x20alternative\x20depth\x20topics');const _0x55b386=_0xe53a78['replace'](_0x28d02f(0x17d),'')['replace'](_0x28d02f(0x227),''),_0x13f8dc=[_0x55b386+_0x28d02f(0x1c8),_0x55b386+_0x28d02f(0x222),_0x55b386];for(const _0x5b76bb of _0x13f8dc){console['log'](_0x28d02f(0x17a)+_0x5b76bb);const _0xb2882={'op':_0x28d02f(0x22d),'topic':_0x5b76bb,'type':_0x28d02f(0x1ba)};this[_0x28d02f(0x1fd)][_0x28d02f(0x175)](JSON[_0x28d02f(0x213)](_0xb2882));const _0x557195=_0x47dcbd=>{const _0x43fa4d=_0x28d02f;try{const _0xcc4e2e=JSON[_0x43fa4d(0x206)](_0x47dcbd['data']);_0xcc4e2e['op']===_0x43fa4d(0x1d5)&&_0xcc4e2e[_0x43fa4d(0x1aa)]===_0x5b76bb&&_0xcc4e2e['msg']&&(console[_0x43fa4d(0x186)](_0x43fa4d(0x211)+_0x5b76bb+',\x20converting\x20to\x20base64...'),_0xcc4e2e[_0x43fa4d(0x16c)][_0x43fa4d(0x1ab)]&&!_0xcc4e2e['msg']['data'][_0x43fa4d(0x17e)](_0x43fa4d(0x174))&&_0x427977(_0xcc4e2e['msg']));}catch(_0x10deba){console['error'](_0x43fa4d(0x197),_0x10deba);}};this[_0x28d02f(0x1fd)]['addEventListener']('message',_0x557195),_0x9a52be[_0x28d02f(0x224)]({'handler':_0x557195,'type':_0x28d02f(0x1ba),'topic':_0x5b76bb});}}},0xbb8),{'unsubscribe':()=>{const _0x13bf42=_0x43da95;for(const {handler:_0x37e6f3,type:_0x120cb2,topic:_0x82a45a}of _0x9a52be){this[_0x13bf42(0x1fd)][_0x13bf42(0x18a)](_0x13bf42(0x16f),_0x37e6f3),this['rosbridgeWs'][_0x13bf42(0x198)]===this['rosbridgeWs'][_0x13bf42(0x19e)]&&this[_0x13bf42(0x1fd)][_0x13bf42(0x175)](JSON[_0x13bf42(0x213)]({'op':_0x13bf42(0x1c3),'topic':_0x82a45a||_0xe53a78}));}}};}[a6_0x3d8a30(0x163)](_0xceeb2e,_0x24a03d){const _0xb113f3=a6_0x3d8a30;_0x24a03d[_0xb113f3(0x1b6)]=_0xb113f3(0x1b3),_0x24a03d['fillRect'](0x0,0x0,_0xceeb2e[_0xb113f3(0x1d9)],_0xceeb2e[_0xb113f3(0x168)]),_0x24a03d[_0xb113f3(0x1b6)]=_0xb113f3(0x173),_0x24a03d['font']=_0xb113f3(0x229),_0x24a03d[_0xb113f3(0x1a7)]=_0xb113f3(0x207),_0x24a03d[_0xb113f3(0x1cc)]('🤖\x20Robot\x20Camera',_0xceeb2e[_0xb113f3(0x1d9)]/0x2,_0xceeb2e['height']/0x2-0x14),_0x24a03d['fillStyle']='#ffffff',_0x24a03d[_0xb113f3(0x164)]='16px\x20Arial',_0x24a03d[_0xb113f3(0x1cc)](_0xb113f3(0x195),_0xceeb2e[_0xb113f3(0x1d9)]/0x2,_0xceeb2e[_0xb113f3(0x168)]/0x2+0x14);const _0x27e095=Date[_0xb113f3(0x1b2)]()/0x3e8;for(let _0x430cdf=0x0;_0x430cdf<0x3;_0x430cdf++){const _0x4be97a=(Math['sin'](_0x27e095*0x2+_0x430cdf*0.5)+0x1)/0x2;_0x24a03d[_0xb113f3(0x1b6)]=_0xb113f3(0x19a)+_0x4be97a*0.5+')',_0x24a03d[_0xb113f3(0x1b0)](),_0x24a03d[_0xb113f3(0x1e2)](_0xceeb2e[_0xb113f3(0x1d9)]/0x2-0x28+_0x430cdf*0x28,_0xceeb2e[_0xb113f3(0x168)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x24a03d['fill']();}}[a6_0x3d8a30(0x1f6)](_0x1a7f43,_0x3fb436){const _0x34e157=a6_0x3d8a30;try{if(!_0x1a7f43||!_0x3fb436)return;const _0x70727e=_0x3fb436[_0x34e157(0x1f0)]('2d'),_0x92dcc4=_0x70727e['getImageData'](0x0,0x0,_0x3fb436[_0x34e157(0x1d9)],_0x3fb436['height']),_0x3e129b=this[_0x34e157(0x223)](_0x92dcc4[_0x34e157(0x1ab)],_0x3fb436[_0x34e157(0x1d9)],_0x3fb436[_0x34e157(0x168)]),_0x4ee130={'width':_0x3fb436[_0x34e157(0x1d9)],'height':_0x3fb436['height'],'data':_0x3e129b};typeof _0x1a7f43[_0x34e157(0x1be)]==='function'&&_0x1a7f43[_0x34e157(0x1be)](_0x4ee130);}catch(_0x47f84c){console[_0x34e157(0x1db)](_0x34e157(0x200),_0x47f84c);}}[a6_0x3d8a30(0x223)](_0x2ecded,_0x5ae22d,_0x1e4619){const _0x4abf78=a6_0x3d8a30,_0x15bfb0=_0x5ae22d*_0x1e4619,_0x2ffeeb=_0x5ae22d*_0x1e4619/0x4,_0x243dff=new Uint8Array(_0x15bfb0+_0x2ffeeb*0x2);let _0x392750=0x0,_0x44546d=_0x15bfb0,_0x1899c7=_0x15bfb0+_0x2ffeeb;for(let _0x32e5b3=0x0;_0x32e5b3<_0x1e4619;_0x32e5b3++){for(let _0x1b6250=0x0;_0x1b6250<_0x5ae22d;_0x1b6250++){const _0x189f29=(_0x32e5b3*_0x5ae22d+_0x1b6250)*0x4,_0x5de97d=_0x2ecded[_0x189f29],_0x15fa71=_0x2ecded[_0x189f29+0x1],_0x55d80e=_0x2ecded[_0x189f29+0x2],_0x59d1f6=Math[_0x4abf78(0x193)](0.299*_0x5de97d+0.587*_0x15fa71+0.114*_0x55d80e);_0x243dff[_0x392750++]=_0x59d1f6;if(_0x32e5b3%0x2===0x0&&_0x1b6250%0x2===0x0){const _0x335fa7=Math[_0x4abf78(0x193)](-0.169*_0x5de97d-0.331*_0x15fa71+0.5*_0x55d80e+0x80),_0x4197a6=Math[_0x4abf78(0x193)](0.5*_0x5de97d-0.419*_0x15fa71-0.081*_0x55d80e+0x80);_0x243dff[_0x44546d++]=Math[_0x4abf78(0x1ac)](0x0,Math['min'](0xff,_0x335fa7)),_0x243dff[_0x1899c7++]=Math[_0x4abf78(0x1ac)](0x0,Math[_0x4abf78(0x1fa)](0xff,_0x4197a6));}}}return _0x243dff;}async[a6_0x3d8a30(0x17b)](_0x27537c,_0x310071,_0x5755d8,_0x18c967,_0x2d6dab){const _0x1639da=a6_0x3d8a30;try{if(!_0x5755d8||!_0x5755d8[_0x1639da(0x1ab)])return;Math[_0x1639da(0x1bb)]()<0.01&&console[_0x1639da(0x186)]('[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20'+_0x18c967+',\x20size:\x20'+_0x5755d8['data'][_0x1639da(0x1af)]+_0x1639da(0x1e8));const _0x41197a=Buffer[_0x1639da(0x18f)](_0x5755d8[_0x1639da(0x1ab)],_0x1639da(0x214)),_0x5050c7=this[_0x1639da(0x202)][_0x1639da(0x1c6)](_0x18c967);let _0x3c3a62;_0x5050c7?_0x3c3a62=await this[_0x1639da(0x202)][_0x1639da(0x1d8)](_0x41197a,_0x27537c,_0x310071,_0x18c967):_0x3c3a62=await this[_0x1639da(0x202)]['processColorImage'](_0x41197a,_0x27537c,_0x310071),_0x310071['putImageData'](_0x3c3a62,0x0,0x0),_0x310071['fillStyle']=_0x1639da(0x188),_0x310071[_0x1639da(0x201)](0xa,0xa,0xdc,0x32),_0x310071['fillStyle']=_0x5050c7?_0x1639da(0x1f9):_0x1639da(0x203),_0x310071[_0x1639da(0x164)]=_0x1639da(0x1eb),_0x310071['fillText']((_0x5050c7?'🔍\x20Depth':_0x1639da(0x166))+':\x20'+new Date()[_0x1639da(0x1b1)](),0xf,0x1c),_0x310071['fillStyle']=_0x1639da(0x178),_0x310071['font']=_0x1639da(0x1f4),_0x310071[_0x1639da(0x1cc)](_0x1639da(0x21e)+_0x18c967[_0x1639da(0x20f)]('/')[_0x1639da(0x1bd)](),0xf,0x2d),this['sendFrameToVideoSource'](_0x2d6dab,_0x27537c);}catch(_0x58a451){console[_0x1639da(0x1a2)](_0x1639da(0x22e)+_0x18c967+':',_0x58a451[_0x1639da(0x16f)]);_0x18c967['includes'](_0x1639da(0x1ce))&&Math['random']()<0.1&&console[_0x1639da(0x1a2)]('[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20'+_0x18c967[_0x1639da(0x1a0)]('/compressedDepth','/image_raw'));_0x310071['fillStyle']=_0x1639da(0x1b3),_0x310071['fillRect'](0x0,0x0,_0x27537c[_0x1639da(0x1d9)],_0x27537c[_0x1639da(0x168)]),_0x310071[_0x1639da(0x1b6)]=_0x1639da(0x19b),_0x310071[_0x1639da(0x164)]=_0x1639da(0x205),_0x310071['textAlign']=_0x1639da(0x207);const _0x2753e5=_0x18c967[_0x1639da(0x21c)](_0x1639da(0x1ce))?_0x1639da(0x1dd):_0x1639da(0x180);_0x310071[_0x1639da(0x1cc)](_0x2753e5,_0x27537c[_0x1639da(0x1d9)]/0x2,_0x27537c[_0x1639da(0x168)]/0x2),_0x310071[_0x1639da(0x1b6)]=_0x1639da(0x230),_0x310071[_0x1639da(0x164)]=_0x1639da(0x176),_0x310071['fillText'](_0x1639da(0x21e)+_0x18c967[_0x1639da(0x20f)]('/')[_0x1639da(0x1bd)](),_0x27537c[_0x1639da(0x1d9)]/0x2,_0x27537c['height']/0x2+0x19),this[_0x1639da(0x1f6)](_0x2d6dab,_0x27537c);}}[a6_0x3d8a30(0x18b)](_0x28b547){const _0x41f6e3=a6_0x3d8a30,_0x36aeb4=this[_0x41f6e3(0x1da)][_0x41f6e3(0x1c9)](_0x28b547);if(!_0x36aeb4){console[_0x41f6e3(0x1a2)](_0x41f6e3(0x189)+_0x28b547);return;}console[_0x41f6e3(0x186)](_0x41f6e3(0x17f)+_0x28b547+_0x41f6e3(0x1ee)+_0x36aeb4[_0x41f6e3(0x1aa)]);try{this['serverWs']&&this[_0x41f6e3(0x179)][_0x41f6e3(0x198)]===this['serverWs'][_0x41f6e3(0x19e)]&&this['serverWs'][_0x41f6e3(0x175)](JSON[_0x41f6e3(0x213)]({'op':_0x41f6e3(0x1b7),'session_id':_0x28b547})),_0x36aeb4[_0x41f6e3(0x204)]&&_0x36aeb4[_0x41f6e3(0x204)][_0x41f6e3(0x177)](),_0x36aeb4[_0x41f6e3(0x212)]&&_0x36aeb4[_0x41f6e3(0x212)][_0x41f6e3(0x1e3)]();}catch(_0x4af4f0){console[_0x41f6e3(0x1db)](_0x41f6e3(0x1cf)+_0x4af4f0);}this[_0x41f6e3(0x1ea)](_0x28b547);}[a6_0x3d8a30(0x1ea)](_0xdf8bfa){const _0x4cf8e0=a6_0x3d8a30,_0x3827d5=this[_0x4cf8e0(0x1da)][_0x4cf8e0(0x1c9)](_0xdf8bfa);if(_0x3827d5){const _0x91c4a7=this[_0x4cf8e0(0x1ef)][_0x4cf8e0(0x1c9)](_0x3827d5[_0x4cf8e0(0x1aa)]);_0x91c4a7&&(_0x91c4a7[_0x4cf8e0(0x1f1)](_0xdf8bfa),_0x91c4a7[_0x4cf8e0(0x1e7)]===0x0&&this[_0x4cf8e0(0x1ef)][_0x4cf8e0(0x1f1)](_0x3827d5[_0x4cf8e0(0x1aa)])),this['releaseSharedVideoSource'](_0x3827d5['topic']);}this['activeSessions'][_0x4cf8e0(0x1f1)](_0xdf8bfa),console['log']('[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20'+_0xdf8bfa);}['stopAllSessions'](){const _0x5bcd0f=a6_0x3d8a30;console[_0x5bcd0f(0x186)]('[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions');const _0x1c3fea=Array['from'](this[_0x5bcd0f(0x1da)]['keys']());_0x1c3fea['forEach'](_0x2ff74a=>this[_0x5bcd0f(0x18b)](_0x2ff74a));}[a6_0x3d8a30(0x1c1)](){const _0x67f51a=a6_0x3d8a30,_0x5abcf2=[];for(const [_0x27adc0,_0x317abc]of this['activeSessions']){_0x5abcf2[_0x67f51a(0x224)]({'sessionId':_0x27adc0,'topic':_0x317abc[_0x67f51a(0x1aa)],'connectionState':_0x317abc[_0x67f51a(0x212)]?.[_0x67f51a(0x170)]||_0x67f51a(0x190),'hasVideoTrack':!!_0x317abc[_0x67f51a(0x204)]});}return _0x5abcf2;}[a6_0x3d8a30(0x183)](){const _0x54dc23=a6_0x3d8a30,_0x138401=[];for(const [_0x19969b,_0x2b8049]of this[_0x54dc23(0x1b4)]){_0x138401[_0x54dc23(0x224)]({'topic':_0x19969b,'frameCount':_0x2b8049[_0x54dc23(0x210)],'hasVideoSource':!!_0x2b8049['videoSource'],'hasRosSubscriber':!!_0x2b8049['rosSubscriber']});}return _0x138401;}}module[a6_0x3d8a30(0x1b8)]=new ApplianceWebRTCService();