const a6_0x33de06=a6_0x38ba;(function(_0x287ec4,_0x537f00){const _0x4a2d3d=a6_0x38ba,_0x26e5dd=_0x287ec4();while(!![]){try{const _0x198495=-parseInt(_0x4a2d3d(0x1e8))/0x1*(parseInt(_0x4a2d3d(0x12d))/0x2)+-parseInt(_0x4a2d3d(0x172))/0x3+parseInt(_0x4a2d3d(0x1d3))/0x4+parseInt(_0x4a2d3d(0x129))/0x5*(parseInt(_0x4a2d3d(0x1d8))/0x6)+-parseInt(_0x4a2d3d(0x1cb))/0x7+-parseInt(_0x4a2d3d(0x15e))/0x8+parseInt(_0x4a2d3d(0x1b6))/0x9*(parseInt(_0x4a2d3d(0x14b))/0xa);if(_0x198495===_0x537f00)break;else _0x26e5dd['push'](_0x26e5dd['shift']());}catch(_0x8218c0){_0x26e5dd['push'](_0x26e5dd['shift']());}}}(a6_0x1d24,0x2b588));const a6_0x24147f=(function(){let _0x39b23b=!![];return function(_0xb31daa,_0x4ecb4a){const _0x2d549e=_0x39b23b?function(){const _0x401541=a6_0x38ba;if(_0x4ecb4a){const _0x62709=_0x4ecb4a[_0x401541(0x1d7)](_0xb31daa,arguments);return _0x4ecb4a=null,_0x62709;}}:function(){};return _0x39b23b=![],_0x2d549e;};}()),a6_0x4788c6=a6_0x24147f(this,function(){const _0x11b020=a6_0x38ba;return a6_0x4788c6[_0x11b020(0x12a)]()[_0x11b020(0x1ba)](_0x11b020(0x1b7))[_0x11b020(0x12a)]()[_0x11b020(0x18c)](a6_0x4788c6)[_0x11b020(0x1ba)](_0x11b020(0x1b7));});a6_0x4788c6();function a6_0x38ba(_0x3f4a10,_0x436624){const _0x1e07c4=a6_0x1d24();return a6_0x38ba=function(_0x4788c6,_0x24147f){_0x4788c6=_0x4788c6-0x128;let _0x1d24e8=_0x1e07c4[_0x4788c6];return _0x1d24e8;},a6_0x38ba(_0x3f4a10,_0x436624);}const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x33de06(0x13d)),sharp=require(a6_0x33de06(0x1d1)),config=require(a6_0x33de06(0x13e)),DepthImageProcessor=require(a6_0x33de06(0x19c)),turnCredentialsService=require(a6_0x33de06(0x187));function a6_0x1d24(){const _0x279de5=['[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','[WebRTC\x20Appliance]\x20Session\x20','unsubscribe',',\x20size:\x20','\x20connection\x20closed,\x20cleaning\x20up','add','#ffffff','Topic:\x20','set','iceServers','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','stopSession','sendFrameToVideoSource','stun:stun1.l.google.com:19302','beginPath','removeEventListener','\x20for\x20topic\x20','min','updateCanvasWithImageData','./turnCredentialsService','split','activeSessions','🔍\x20Processing\x20depth...','updateTurnCredentials','constructor','/image','push','onicecandidate','warn','has','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','protocol','get','webrtc_ice_candidate','message','width','videoSource','port','textAlign','sensor_msgs/Image','./DepthImageProcessor','#00aaff','connectionState','\x20sessions)','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','initializeSession','rgba(0,\x200,\x200,\x200.7)','peerConnection','replace','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','session_id','onconnectionstatechange','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','webrtc','🔍\x20Depth','fillText','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','serverUrl','\x20sessions\x20remaining)','\x20connection\x20failed,\x20stopping\x20session','fillRect','putImageData','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','addEventListener','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','90AJwoia','(((.+)+)+)+$','24px\x20Arial','#00ff00','search','max','/compressed','fillStyle','stun:stun.l.google.com:19302','font','toLocaleTimeString','getIceServers','subscribeToROSTopic','releaseSharedVideoSource','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','candidate','\x20bytes','compressed','parse','depth','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','638127pGoEHQ',',\x20cleaning\x20up\x20shared\x20resources','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','16px\x20Arial','getActiveSessions','sharp','getOrCreateSharedVideoSource','41180UCDDED','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','12px\x20Arial','apply','2022CUvLDH','/compressedDepth','📹\x20Color','videoTrack','fill','rtcConfig','video','webrtc_init_session','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','base64','exports','msg','height','canvas','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','initializing','48DzSfZJ','sensor_msgs/CompressedImage','random','rosbridgeWs','center','processColorImage','📹\x20Processing\x20video...','from','\x20with\x20message\x20type\x20','setLocalDescription','size','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','forEach','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','addTrack','setRemoteDescription','createAnswer','2705TECdSA','toString','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','webrtc_stop_session','13918ffLnZf','cleanupSession','#00ffff','rosSubscriber','frameCount','startsWith','close','\x20initialized\x20successfully','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','/9j/','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','unknown','#888','serverWs',',\x20converting\x20to\x20base64...','wrtc','../config','round','#1a1a1a','initialize','topic','arc','12px\x20monospace','10px\x20monospace','delete','depthProcessor','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','handleOffer','sensor_msgs/msg/CompressedImage','990790bEyjrJ','framerate','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','includes','publish','sharedVideoSources','getContext','convertRGBAtoI420','data','topicSessions','log','addIceCandidate','sin','error','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','processDepthImage','handleIceCandidate','\x20connection\x20state:\x20','2235784nqwfuw','closed','send','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','handleMessage','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','offer','drawLoadingPattern','stringify','subscribe','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','function','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','compressedDepth','readyState','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','OPEN','onFrame','903576uJXuAw','stop'];a6_0x1d24=function(){return _0x279de5;};return a6_0x1d24();}class ApplianceWebRTCService{constructor(){const _0x4c7c34=a6_0x33de06;this[_0x4c7c34(0x189)]=new Map(),this[_0x4c7c34(0x155)]=new Map(),this[_0x4c7c34(0x151)]=new Map(),this['rosbridgeWs']=null,this[_0x4c7c34(0x13b)]=null,this[_0x4c7c34(0x147)]=new DepthImageProcessor(),this[_0x4c7c34(0x1dd)]={'iceServers':[{'urls':_0x4c7c34(0x1be)},{'urls':_0x4c7c34(0x181)}]};}[a6_0x33de06(0x141)](_0x5751b1,_0x35536e){const _0x4c1ade=a6_0x33de06;this[_0x4c1ade(0x1eb)]=_0x5751b1,this[_0x4c1ade(0x13b)]=_0x35536e,turnCredentialsService[_0x4c1ade(0x141)](config[_0x4c1ade(0x1ae)]),this[_0x4c1ade(0x18b)](),console[_0x4c1ade(0x156)]('[WebRTC\x20Appliance]\x20Service\x20initialized');}async[a6_0x33de06(0x18b)](){const _0x1fc170=a6_0x33de06;try{console['log'](_0x1fc170(0x137));const _0x5c4c8d=await turnCredentialsService[_0x1fc170(0x1c1)]();this[_0x1fc170(0x1dd)][_0x1fc170(0x17d)]=_0x5c4c8d,console[_0x1fc170(0x156)]('[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully');}catch(_0x5aa2f9){console[_0x1fc170(0x159)]('[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:',_0x5aa2f9),console[_0x1fc170(0x156)](_0x1fc170(0x1d4));}}[a6_0x33de06(0x162)](_0x46c75e){const _0x415a6c=a6_0x33de06;if(!_0x46c75e['op']||!_0x46c75e['op']['startsWith']('webrtc_'))return![];console[_0x415a6c(0x156)](_0x415a6c(0x1cd)+_0x46c75e['op']);switch(_0x46c75e['op']){case _0x415a6c(0x1df):this['initializeSession'](_0x46c75e[_0x415a6c(0x1a7)],_0x46c75e[_0x415a6c(0x142)]);return!![];case'webrtc_offer':this[_0x415a6c(0x149)](_0x46c75e[_0x415a6c(0x1a7)],_0x46c75e[_0x415a6c(0x164)]);return!![];case _0x415a6c(0x195):this['handleIceCandidate'](_0x46c75e[_0x415a6c(0x1a7)],_0x46c75e['candidate']);return!![];case _0x415a6c(0x12c):this[_0x415a6c(0x17f)](_0x46c75e[_0x415a6c(0x1a7)]);return!![];default:console['warn'](_0x415a6c(0x174)+_0x46c75e['op']);return![];}}[a6_0x33de06(0x1d2)](_0x553548){const _0x98cccb=a6_0x33de06;if(this[_0x98cccb(0x151)]['has'](_0x553548)){const _0x56c8d7=this['sharedVideoSources']['get'](_0x553548);return _0x56c8d7[_0x98cccb(0x131)]++,console[_0x98cccb(0x156)](_0x98cccb(0x1ce)+_0x553548+'\x20('+_0x56c8d7[_0x98cccb(0x131)]+_0x98cccb(0x19f)),_0x56c8d7;}console[_0x98cccb(0x156)](_0x98cccb(0x1b3)+_0x553548);const {createCanvas:_0x4a5313}=require('canvas'),_0xa4a36f=_0x4a5313(config[_0x98cccb(0x1aa)][_0x98cccb(0x1de)][_0x98cccb(0x197)],config[_0x98cccb(0x1aa)][_0x98cccb(0x1de)]['height']),_0x3f8b57=_0xa4a36f[_0x98cccb(0x152)]('2d');this[_0x98cccb(0x165)](_0xa4a36f,_0x3f8b57);const {RTCVideoSource:_0x4aef80}=nonstandard,_0x55a1fe=new _0x4aef80();let _0x52de69=0x0;const _0x206946=0x3e8/config['webrtc'][_0x98cccb(0x1de)]['framerate'],_0x6a0b1b=this['subscribeToROSTopic'](_0x553548,_0x258fdb=>{const _0x57c5f1=_0x98cccb,_0xdc9599=Date['now']();_0xdc9599-_0x52de69>=_0x206946&&(_0x52de69=_0xdc9599,this[_0x57c5f1(0x186)](_0xa4a36f,_0x3f8b57,_0x258fdb,_0x553548,_0x55a1fe));}),_0x543e3f={'videoSource':_0x55a1fe,'canvas':_0xa4a36f,'rosSubscriber':_0x6a0b1b,'frameCount':0x1,'topic':_0x553548};return this[_0x98cccb(0x151)][_0x98cccb(0x17c)](_0x553548,_0x543e3f),_0x543e3f;}['releaseSharedVideoSource'](_0x1722c0){const _0x428249=a6_0x33de06,_0x97d919=this[_0x428249(0x151)][_0x428249(0x194)](_0x1722c0);if(!_0x97d919)return;_0x97d919[_0x428249(0x131)]--,console[_0x428249(0x156)](_0x428249(0x17e)+_0x1722c0+'\x20('+_0x97d919[_0x428249(0x131)]+_0x428249(0x1af)),_0x97d919[_0x428249(0x131)]<=0x0&&(console[_0x428249(0x156)](_0x428249(0x1ca)+_0x1722c0+_0x428249(0x1cc)),_0x97d919[_0x428249(0x198)]&&(_0x97d919['videoSource']=null),_0x97d919[_0x428249(0x130)]&&_0x97d919[_0x428249(0x130)][_0x428249(0x176)](),this[_0x428249(0x151)][_0x428249(0x146)](_0x1722c0));}async[a6_0x33de06(0x1a2)](_0x4571f8,_0x4e8ce8){const _0x23de04=a6_0x33de06;try{console['log'](_0x23de04(0x16b)+_0x4571f8+_0x23de04(0x184)+_0x4e8ce8);const _0x4dbee5=this['getOrCreateSharedVideoSource'](_0x4e8ce8),_0x432d6e=new RTCPeerConnection(this[_0x23de04(0x1dd)]),_0x3216c2=_0x4dbee5[_0x23de04(0x198)]['createTrack']({'width':config[_0x23de04(0x1aa)][_0x23de04(0x1de)][_0x23de04(0x197)],'height':config['webrtc'][_0x23de04(0x1de)]['height'],'framerate':config['webrtc'][_0x23de04(0x1de)][_0x23de04(0x14c)]});console['log'](_0x23de04(0x161)+_0x4571f8);const {MediaStream:_0x39eff2}=require(_0x23de04(0x13d)),_0x206c95=new _0x39eff2([_0x3216c2]);_0x432d6e[_0x23de04(0x1f6)](_0x3216c2,_0x206c95),this['sendFrameToVideoSource'](_0x4dbee5[_0x23de04(0x198)],_0x4dbee5[_0x23de04(0x1e5)]),_0x432d6e[_0x23de04(0x18f)]=_0x50d48f=>{const _0x260971=_0x23de04;if(_0x50d48f['candidate']&&this['serverWs'])console[_0x260971(0x156)](_0x260971(0x14e)+_0x4571f8+':',{'type':_0x50d48f[_0x260971(0x1c5)]['type'],'protocol':_0x50d48f[_0x260971(0x1c5)][_0x260971(0x193)],'address':_0x50d48f[_0x260971(0x1c5)]['address'],'port':_0x50d48f[_0x260971(0x1c5)][_0x260971(0x199)]}),this[_0x260971(0x13b)][_0x260971(0x160)](JSON[_0x260971(0x166)]({'op':'webrtc_ice_candidate','session_id':_0x4571f8,'candidate':_0x50d48f[_0x260971(0x1c5)]}));else!_0x50d48f[_0x260971(0x1c5)]&&console[_0x260971(0x156)](_0x260971(0x1c4)+_0x4571f8);},_0x432d6e[_0x23de04(0x1a8)]=()=>{const _0x33c2ab=_0x23de04;console[_0x33c2ab(0x156)](_0x33c2ab(0x175)+_0x4571f8+_0x33c2ab(0x15d)+_0x432d6e['connectionState']);if(_0x432d6e['connectionState']==='connected')console[_0x33c2ab(0x156)](_0x33c2ab(0x175)+_0x4571f8+'\x20successfully\x20connected!');else{if(_0x432d6e[_0x33c2ab(0x19e)]==='failed')console['log'](_0x33c2ab(0x175)+_0x4571f8+_0x33c2ab(0x1b0)),this[_0x33c2ab(0x17f)](_0x4571f8);else _0x432d6e[_0x33c2ab(0x19e)]===_0x33c2ab(0x15f)&&(console[_0x33c2ab(0x156)](_0x33c2ab(0x175)+_0x4571f8+_0x33c2ab(0x178)),this[_0x33c2ab(0x12e)](_0x4571f8));}},this['activeSessions'][_0x23de04(0x17c)](_0x4571f8,{'peerConnection':_0x432d6e,'topic':_0x4e8ce8,'videoTrack':_0x3216c2,'mediaStream':_0x206c95,'status':_0x23de04(0x1e7)}),!this[_0x23de04(0x155)][_0x23de04(0x191)](_0x4e8ce8)&&this[_0x23de04(0x155)]['set'](_0x4e8ce8,new Set()),this[_0x23de04(0x155)][_0x23de04(0x194)](_0x4e8ce8)[_0x23de04(0x179)](_0x4571f8),console[_0x23de04(0x156)](_0x23de04(0x175)+_0x4571f8+_0x23de04(0x134)),console[_0x23de04(0x156)](_0x23de04(0x1f3)+_0x4e8ce8+':\x20'+this[_0x23de04(0x155)][_0x23de04(0x194)](_0x4e8ce8)[_0x23de04(0x1f2)]);}catch(_0x364765){console[_0x23de04(0x159)](_0x23de04(0x1a9)+_0x4571f8+':',_0x364765),this[_0x23de04(0x17f)](_0x4571f8);}}async['handleOffer'](_0x44d9a1,_0x3b5c4e){const _0x25489c=a6_0x33de06,_0x4fa677=this[_0x25489c(0x189)]['get'](_0x44d9a1);if(!_0x4fa677){console[_0x25489c(0x159)](_0x25489c(0x135)+_0x44d9a1);return;}try{console['log']('[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20'+_0x44d9a1),await _0x4fa677['peerConnection'][_0x25489c(0x1f7)](new RTCSessionDescription(_0x3b5c4e)),console[_0x25489c(0x156)](_0x25489c(0x1a1));const _0x20723a=await _0x4fa677[_0x25489c(0x1a4)][_0x25489c(0x128)]();console[_0x25489c(0x156)]('[WebRTC\x20Appliance]\x20Created\x20answer'),await _0x4fa677['peerConnection'][_0x25489c(0x1f1)](_0x20723a),console[_0x25489c(0x156)](_0x25489c(0x1ad)),this[_0x25489c(0x13b)]&&(this[_0x25489c(0x13b)][_0x25489c(0x160)](JSON['stringify']({'op':'webrtc_answer','session_id':_0x44d9a1,'answer':_0x20723a})),console[_0x25489c(0x156)]('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0x44d9a1));}catch(_0x42811e){console[_0x25489c(0x159)](_0x25489c(0x12b)+_0x44d9a1+':',_0x42811e),this[_0x25489c(0x17f)](_0x44d9a1);}}async[a6_0x33de06(0x15c)](_0x5ea218,_0x206739){const _0x4d507e=a6_0x33de06,_0x4a6ec5=this['activeSessions'][_0x4d507e(0x194)](_0x5ea218);if(!_0x4a6ec5){console[_0x4d507e(0x159)](_0x4d507e(0x1b5)+_0x5ea218);return;}try{await _0x4a6ec5[_0x4d507e(0x1a4)][_0x4d507e(0x157)](new RTCIceCandidate(_0x206739)),console[_0x4d507e(0x156)](_0x4d507e(0x1e0)+_0x5ea218);}catch(_0x815d2c){console[_0x4d507e(0x159)](_0x4d507e(0x169)+_0x5ea218+':',_0x815d2c);}}[a6_0x33de06(0x1c2)](_0x190bf1,_0x5a8e6c){const _0x129340=a6_0x33de06;if(!this[_0x129340(0x1eb)]||this[_0x129340(0x1eb)]['readyState']!==this[_0x129340(0x1eb)][_0x129340(0x170)])return console[_0x129340(0x159)]('[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected'),null;console[_0x129340(0x156)]('[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20'+_0x190bf1);const _0x3252e8=_0x190bf1['includes'](_0x129340(0x1c9)),_0x3876ca=_0x190bf1[_0x129340(0x14f)](_0x129340(0x1c7))||_0x190bf1[_0x129340(0x14f)](_0x129340(0x16c));let _0x84c480=[];_0x3252e8?_0x3876ca?_0x84c480=[_0x129340(0x1e9),_0x129340(0x14a),'compressed_depth_image_transport/CompressedDepthImage',_0x129340(0x19b)]:_0x84c480=[_0x129340(0x19b),'sensor_msgs/msg/Image',_0x129340(0x1e9)]:_0x84c480=['sensor_msgs/CompressedImage','sensor_msgs/msg/CompressedImage',_0x129340(0x19b)];console[_0x129340(0x156)]('[WebRTC\x20Appliance]\x20Topic\x20'+_0x190bf1+'\x20detected\x20as\x20'+(_0x3252e8?_0x129340(0x1c9):'color')+'\x20image,\x20trying\x20message\x20types:',_0x84c480);const _0x22665e=[];let _0x542d19=![];const _0x293aa6=_0xa857e4=>{return _0xd60f50=>{const _0x16681a=a6_0x38ba;try{const _0x1746dd=JSON['parse'](_0xd60f50[_0x16681a(0x154)]);_0x1746dd['op']===_0x16681a(0x150)&&_0x1746dd['topic']===_0x190bf1&&_0x1746dd['msg']&&(!_0x542d19&&(console[_0x16681a(0x156)](_0x16681a(0x1d5)+_0x190bf1+_0x16681a(0x1f0)+_0xa857e4),_0x542d19=!![]),_0x5a8e6c(_0x1746dd[_0x16681a(0x1e3)]));}catch(_0x50c850){console['error'](_0x16681a(0x163),_0x50c850);}};};for(const _0x5a2fec of _0x84c480){const _0x251515={'op':_0x129340(0x167),'topic':_0x190bf1,'type':_0x5a2fec};console[_0x129340(0x156)](_0x129340(0x192)+_0x5a2fec),this[_0x129340(0x1eb)][_0x129340(0x160)](JSON['stringify'](_0x251515));const _0x41caf4=_0x293aa6(_0x5a2fec);this['rosbridgeWs'][_0x129340(0x1b4)]('message',_0x41caf4),_0x22665e[_0x129340(0x18e)]({'handler':_0x41caf4,'type':_0x5a2fec});}return _0x3252e8&&_0x3876ca&&setTimeout(()=>{const _0x4133bf=_0x129340;if(!_0x542d19){console[_0x4133bf(0x156)](_0x4133bf(0x14d)+_0x190bf1+',\x20trying\x20alternative\x20depth\x20topics');const _0x4add89=_0x190bf1[_0x4133bf(0x1a5)](_0x4133bf(0x1d9),'')[_0x4133bf(0x1a5)](_0x4133bf(0x1bc),''),_0x4cc56e=[_0x4add89+'/image_raw',_0x4add89+_0x4133bf(0x18d),_0x4add89];for(const _0x26a45e of _0x4cc56e){console[_0x4133bf(0x156)](_0x4133bf(0x1e6)+_0x26a45e);const _0x2c91e1={'op':_0x4133bf(0x167),'topic':_0x26a45e,'type':_0x4133bf(0x19b)};this[_0x4133bf(0x1eb)][_0x4133bf(0x160)](JSON[_0x4133bf(0x166)](_0x2c91e1));const _0x168c54=_0x3b8364=>{const _0x7972c3=_0x4133bf;try{const _0x1f626c=JSON[_0x7972c3(0x1c8)](_0x3b8364['data']);_0x1f626c['op']===_0x7972c3(0x150)&&_0x1f626c[_0x7972c3(0x142)]===_0x26a45e&&_0x1f626c[_0x7972c3(0x1e3)]&&(console[_0x7972c3(0x156)](_0x7972c3(0x1f5)+_0x26a45e+_0x7972c3(0x13c)),_0x1f626c[_0x7972c3(0x1e3)][_0x7972c3(0x154)]&&!_0x1f626c[_0x7972c3(0x1e3)][_0x7972c3(0x154)][_0x7972c3(0x132)](_0x7972c3(0x136))&&_0x5a8e6c(_0x1f626c[_0x7972c3(0x1e3)]));}catch(_0x3661c2){console[_0x7972c3(0x159)](_0x7972c3(0x16e),_0x3661c2);}};this[_0x4133bf(0x1eb)][_0x4133bf(0x1b4)](_0x4133bf(0x196),_0x168c54),_0x22665e[_0x4133bf(0x18e)]({'handler':_0x168c54,'type':_0x4133bf(0x19b),'topic':_0x26a45e});}}},0xbb8),{'unsubscribe':()=>{const _0x53cbeb=_0x129340;for(const {handler:_0x3f84c8,type:_0x3c2009,topic:_0x384506}of _0x22665e){this[_0x53cbeb(0x1eb)][_0x53cbeb(0x183)](_0x53cbeb(0x196),_0x3f84c8),this['rosbridgeWs'][_0x53cbeb(0x16d)]===this[_0x53cbeb(0x1eb)][_0x53cbeb(0x170)]&&this[_0x53cbeb(0x1eb)][_0x53cbeb(0x160)](JSON[_0x53cbeb(0x166)]({'op':'unsubscribe','topic':_0x384506||_0x190bf1}));}}};}[a6_0x33de06(0x165)](_0x4671b0,_0x2e447d){const _0x4af71f=a6_0x33de06;_0x2e447d[_0x4af71f(0x1bd)]='#1a1a1a',_0x2e447d['fillRect'](0x0,0x0,_0x4671b0['width'],_0x4671b0[_0x4af71f(0x1e4)]),_0x2e447d[_0x4af71f(0x1bd)]=_0x4af71f(0x19d),_0x2e447d['font']=_0x4af71f(0x1b8),_0x2e447d[_0x4af71f(0x19a)]=_0x4af71f(0x1ec),_0x2e447d[_0x4af71f(0x1ac)]('🤖\x20Robot\x20Camera',_0x4671b0[_0x4af71f(0x197)]/0x2,_0x4671b0[_0x4af71f(0x1e4)]/0x2-0x14),_0x2e447d[_0x4af71f(0x1bd)]=_0x4af71f(0x17a),_0x2e447d[_0x4af71f(0x1bf)]=_0x4af71f(0x1cf),_0x2e447d[_0x4af71f(0x1ac)]('Waiting\x20for\x20ROS\x20image\x20data...',_0x4671b0[_0x4af71f(0x197)]/0x2,_0x4671b0[_0x4af71f(0x1e4)]/0x2+0x14);const _0x3c531e=Date['now']()/0x3e8;for(let _0x5e8503=0x0;_0x5e8503<0x3;_0x5e8503++){const _0x5abfff=(Math[_0x4af71f(0x158)](_0x3c531e*0x2+_0x5e8503*0.5)+0x1)/0x2;_0x2e447d[_0x4af71f(0x1bd)]='rgba(0,\x20170,\x20255,\x20'+_0x5abfff*0.5+')',_0x2e447d[_0x4af71f(0x182)](),_0x2e447d[_0x4af71f(0x143)](_0x4671b0[_0x4af71f(0x197)]/0x2-0x28+_0x5e8503*0x28,_0x4671b0[_0x4af71f(0x1e4)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x2e447d[_0x4af71f(0x1dc)]();}}['sendFrameToVideoSource'](_0x245699,_0x164c64){const _0x53a5bb=a6_0x33de06;try{if(!_0x245699||!_0x164c64)return;const _0x41f8f2=_0x164c64[_0x53a5bb(0x152)]('2d'),_0x123576=_0x41f8f2['getImageData'](0x0,0x0,_0x164c64[_0x53a5bb(0x197)],_0x164c64[_0x53a5bb(0x1e4)]),_0xb2c5d0=this[_0x53a5bb(0x153)](_0x123576[_0x53a5bb(0x154)],_0x164c64[_0x53a5bb(0x197)],_0x164c64[_0x53a5bb(0x1e4)]),_0x4e59c7={'width':_0x164c64[_0x53a5bb(0x197)],'height':_0x164c64[_0x53a5bb(0x1e4)],'data':_0xb2c5d0};typeof _0x245699[_0x53a5bb(0x171)]===_0x53a5bb(0x16a)&&_0x245699[_0x53a5bb(0x171)](_0x4e59c7);}catch(_0x2a5451){console[_0x53a5bb(0x159)]('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x2a5451);}}['convertRGBAtoI420'](_0x4f39eb,_0x287743,_0x541a6c){const _0x187ee3=a6_0x33de06,_0x384e23=_0x287743*_0x541a6c,_0x215e1e=_0x287743*_0x541a6c/0x4,_0x21b5d4=new Uint8Array(_0x384e23+_0x215e1e*0x2);let _0x393560=0x0,_0x1afb8a=_0x384e23,_0x3d744c=_0x384e23+_0x215e1e;for(let _0xe81b95=0x0;_0xe81b95<_0x541a6c;_0xe81b95++){for(let _0x1c742b=0x0;_0x1c742b<_0x287743;_0x1c742b++){const _0x5cde6d=(_0xe81b95*_0x287743+_0x1c742b)*0x4,_0x3cd0ae=_0x4f39eb[_0x5cde6d],_0x26cc15=_0x4f39eb[_0x5cde6d+0x1],_0x5ca391=_0x4f39eb[_0x5cde6d+0x2],_0x42cbac=Math[_0x187ee3(0x13f)](0.299*_0x3cd0ae+0.587*_0x26cc15+0.114*_0x5ca391);_0x21b5d4[_0x393560++]=_0x42cbac;if(_0xe81b95%0x2===0x0&&_0x1c742b%0x2===0x0){const _0x2ab7f8=Math[_0x187ee3(0x13f)](-0.169*_0x3cd0ae-0.331*_0x26cc15+0.5*_0x5ca391+0x80),_0x2df4dd=Math[_0x187ee3(0x13f)](0.5*_0x3cd0ae-0.419*_0x26cc15-0.081*_0x5ca391+0x80);_0x21b5d4[_0x1afb8a++]=Math[_0x187ee3(0x1bb)](0x0,Math[_0x187ee3(0x185)](0xff,_0x2ab7f8)),_0x21b5d4[_0x3d744c++]=Math[_0x187ee3(0x1bb)](0x0,Math[_0x187ee3(0x185)](0xff,_0x2df4dd));}}}return _0x21b5d4;}async['updateCanvasWithImageData'](_0xa7629,_0x2d6f9d,_0x46c254,_0x1c4881,_0x2ab11f){const _0x29275f=a6_0x33de06;try{if(!_0x46c254||!_0x46c254['data'])return;Math['random']()<0.01&&console[_0x29275f(0x156)](_0x29275f(0x1a6)+_0x1c4881+_0x29275f(0x177)+_0x46c254[_0x29275f(0x154)]['length']+_0x29275f(0x1c6));const _0x27c537=Buffer[_0x29275f(0x1ef)](_0x46c254[_0x29275f(0x154)],_0x29275f(0x1e1)),_0xb19d27=this['depthProcessor']['isDepthTopic'](_0x1c4881);let _0x2261f4;_0xb19d27?_0x2261f4=await this['depthProcessor'][_0x29275f(0x15b)](_0x27c537,_0xa7629,_0x2d6f9d,_0x1c4881):_0x2261f4=await this[_0x29275f(0x147)][_0x29275f(0x1ed)](_0x27c537,_0xa7629,_0x2d6f9d),_0x2d6f9d[_0x29275f(0x1b2)](_0x2261f4,0x0,0x0),_0x2d6f9d['fillStyle']=_0x29275f(0x1a3),_0x2d6f9d[_0x29275f(0x1b1)](0xa,0xa,0xdc,0x32),_0x2d6f9d[_0x29275f(0x1bd)]=_0xb19d27?_0x29275f(0x12f):_0x29275f(0x1b9),_0x2d6f9d['font']=_0x29275f(0x144),_0x2d6f9d[_0x29275f(0x1ac)]((_0xb19d27?_0x29275f(0x1ab):_0x29275f(0x1da))+':\x20'+new Date()[_0x29275f(0x1c0)](),0xf,0x1c),_0x2d6f9d[_0x29275f(0x1bd)]='#ffffff',_0x2d6f9d['font']=_0x29275f(0x145),_0x2d6f9d[_0x29275f(0x1ac)](_0x29275f(0x17b)+_0x1c4881[_0x29275f(0x188)]('/')['pop'](),0xf,0x2d),this[_0x29275f(0x180)](_0x2ab11f,_0xa7629);}catch(_0x4ee1d1){console['warn'](_0x29275f(0x1a0)+_0x1c4881+':',_0x4ee1d1[_0x29275f(0x196)]);_0x1c4881[_0x29275f(0x14f)]('depth')&&Math[_0x29275f(0x1ea)]()<0.1&&console[_0x29275f(0x190)](_0x29275f(0x138)+_0x1c4881[_0x29275f(0x1a5)](_0x29275f(0x1d9),'/image_raw'));_0x2d6f9d[_0x29275f(0x1bd)]=_0x29275f(0x140),_0x2d6f9d[_0x29275f(0x1b1)](0x0,0x0,_0xa7629['width'],_0xa7629[_0x29275f(0x1e4)]),_0x2d6f9d[_0x29275f(0x1bd)]=_0x29275f(0x13a),_0x2d6f9d['font']=_0x29275f(0x1cf),_0x2d6f9d[_0x29275f(0x19a)]=_0x29275f(0x1ec);const _0x1f3f72=_0x1c4881[_0x29275f(0x14f)]('depth')?_0x29275f(0x18a):_0x29275f(0x1ee);_0x2d6f9d[_0x29275f(0x1ac)](_0x1f3f72,_0xa7629[_0x29275f(0x197)]/0x2,_0xa7629[_0x29275f(0x1e4)]/0x2),_0x2d6f9d['fillStyle']='#666',_0x2d6f9d[_0x29275f(0x1bf)]=_0x29275f(0x1d6),_0x2d6f9d[_0x29275f(0x1ac)](_0x29275f(0x17b)+_0x1c4881[_0x29275f(0x188)]('/')['pop'](),_0xa7629['width']/0x2,_0xa7629[_0x29275f(0x1e4)]/0x2+0x19),this['sendFrameToVideoSource'](_0x2ab11f,_0xa7629);}}['stopSession'](_0xcd437d){const _0x58962b=a6_0x33de06,_0x4755ad=this[_0x58962b(0x189)][_0x58962b(0x194)](_0xcd437d);if(!_0x4755ad){console[_0x58962b(0x190)](_0x58962b(0x168)+_0xcd437d);return;}console['log']('[WebRTC\x20Appliance]\x20Stopping\x20session:\x20'+_0xcd437d+'\x20for\x20topic:\x20'+_0x4755ad[_0x58962b(0x142)]);try{this[_0x58962b(0x13b)]&&this[_0x58962b(0x13b)]['readyState']===this[_0x58962b(0x13b)]['OPEN']&&this[_0x58962b(0x13b)]['send'](JSON[_0x58962b(0x166)]({'op':_0x58962b(0x12c),'session_id':_0xcd437d})),_0x4755ad[_0x58962b(0x1db)]&&_0x4755ad[_0x58962b(0x1db)][_0x58962b(0x173)](),_0x4755ad[_0x58962b(0x1a4)]&&_0x4755ad[_0x58962b(0x1a4)][_0x58962b(0x133)]();}catch(_0x307e1d){console[_0x58962b(0x159)](_0x58962b(0x16f)+_0x307e1d);}this[_0x58962b(0x12e)](_0xcd437d);}[a6_0x33de06(0x12e)](_0x381668){const _0x3617f5=a6_0x33de06,_0x2e9985=this[_0x3617f5(0x189)]['get'](_0x381668);if(_0x2e9985){const _0x2ada5c=this[_0x3617f5(0x155)][_0x3617f5(0x194)](_0x2e9985[_0x3617f5(0x142)]);_0x2ada5c&&(_0x2ada5c['delete'](_0x381668),_0x2ada5c[_0x3617f5(0x1f2)]===0x0&&this['topicSessions'][_0x3617f5(0x146)](_0x2e9985['topic'])),this[_0x3617f5(0x1c3)](_0x2e9985[_0x3617f5(0x142)]);}this[_0x3617f5(0x189)]['delete'](_0x381668),console[_0x3617f5(0x156)](_0x3617f5(0x15a)+_0x381668);}['stopAllSessions'](){const _0x53c903=a6_0x33de06;console[_0x53c903(0x156)](_0x53c903(0x148));const _0x1bfa4f=Array[_0x53c903(0x1ef)](this[_0x53c903(0x189)]['keys']());_0x1bfa4f[_0x53c903(0x1f4)](_0x16c316=>this['stopSession'](_0x16c316));}[a6_0x33de06(0x1d0)](){const _0x616ac4=a6_0x33de06,_0x35c9d5=[];for(const [_0x48ac43,_0x444a7c]of this[_0x616ac4(0x189)]){_0x35c9d5[_0x616ac4(0x18e)]({'sessionId':_0x48ac43,'topic':_0x444a7c[_0x616ac4(0x142)],'connectionState':_0x444a7c['peerConnection']?.[_0x616ac4(0x19e)]||_0x616ac4(0x139),'hasVideoTrack':!!_0x444a7c[_0x616ac4(0x1db)]});}return _0x35c9d5;}['getSharedVideoSources'](){const _0x441d08=a6_0x33de06,_0x47a801=[];for(const [_0x2fb1f7,_0x267e54]of this['sharedVideoSources']){_0x47a801[_0x441d08(0x18e)]({'topic':_0x2fb1f7,'frameCount':_0x267e54[_0x441d08(0x131)],'hasVideoSource':!!_0x267e54[_0x441d08(0x198)],'hasRosSubscriber':!!_0x267e54[_0x441d08(0x130)]});}return _0x47a801;}}module[a6_0x33de06(0x1e2)]=new ApplianceWebRTCService();