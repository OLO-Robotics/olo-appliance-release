const a6_0x55cac0=a6_0x1e63;(function(_0x5199cb,_0x4cb7ec){const _0x110bf2=a6_0x1e63,_0x25a551=_0x5199cb();while(!![]){try{const _0x55a0e2=-parseInt(_0x110bf2(0x1a5))/0x1*(parseInt(_0x110bf2(0x20a))/0x2)+parseInt(_0x110bf2(0x234))/0x3+parseInt(_0x110bf2(0x26c))/0x4+parseInt(_0x110bf2(0x27f))/0x5*(parseInt(_0x110bf2(0x253))/0x6)+-parseInt(_0x110bf2(0x1b8))/0x7+-parseInt(_0x110bf2(0x246))/0x8*(parseInt(_0x110bf2(0x20e))/0x9)+parseInt(_0x110bf2(0x1af))/0xa;if(_0x55a0e2===_0x4cb7ec)break;else _0x25a551['push'](_0x25a551['shift']());}catch(_0xd5a4ea){_0x25a551['push'](_0x25a551['shift']());}}}(a6_0x103d,0x4a0e5));const a6_0x186a60=(function(){let _0x230095=!![];return function(_0x63d1ae,_0x515540){const _0x3fb602=_0x230095?function(){const _0x2e5e88=a6_0x1e63;if(_0x515540){const _0x19efd9=_0x515540[_0x2e5e88(0x262)](_0x63d1ae,arguments);return _0x515540=null,_0x19efd9;}}:function(){};return _0x230095=![],_0x3fb602;};}()),a6_0x48d627=a6_0x186a60(this,function(){const _0x403189=a6_0x1e63;return a6_0x48d627[_0x403189(0x251)]()[_0x403189(0x1d2)](_0x403189(0x21e))[_0x403189(0x251)]()['constructor'](a6_0x48d627)[_0x403189(0x1d2)](_0x403189(0x21e));});a6_0x48d627();function a6_0x1e63(_0x291c38,_0x4173be){const _0x14824c=a6_0x103d();return a6_0x1e63=function(_0x48d627,_0x186a60){_0x48d627=_0x48d627-0x1a5;let _0x103d4f=_0x14824c[_0x48d627];return _0x103d4f;},a6_0x1e63(_0x291c38,_0x4173be);}const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x55cac0(0x213)),sharp=require(a6_0x55cac0(0x24e)),config=require(a6_0x55cac0(0x263)),DepthImageProcessor=require(a6_0x55cac0(0x233)),turnCredentialsService=require(a6_0x55cac0(0x1d4));class ApplianceWebRTCService{constructor(){const _0x4a29c9=a6_0x55cac0;this[_0x4a29c9(0x1bf)]=new Map(),this[_0x4a29c9(0x1b6)]=new Map(),this[_0x4a29c9(0x258)]=new Map(),this[_0x4a29c9(0x23c)]=null,this['serverWs']=null,this[_0x4a29c9(0x1ea)]=new DepthImageProcessor(),this[_0x4a29c9(0x214)]={'iceServers':[{'urls':_0x4a29c9(0x204)},{'urls':_0x4a29c9(0x235)}]};}[a6_0x55cac0(0x1ca)](_0x2591f4,_0x36c5ad){const _0x3e635f=a6_0x55cac0;this[_0x3e635f(0x23c)]=_0x2591f4,this['serverWs']=_0x36c5ad,turnCredentialsService[_0x3e635f(0x1ca)](config['serverUrl']),this[_0x3e635f(0x1d0)](),console[_0x3e635f(0x268)](_0x3e635f(0x200));}async['updateTurnCredentials'](){const _0x1daf46=a6_0x55cac0;try{console['log'](_0x1daf46(0x1bd));const _0x397795=await turnCredentialsService[_0x1daf46(0x239)]();this['rtcConfig']['iceServers']=_0x397795,console[_0x1daf46(0x268)]('[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully');}catch(_0x9a1c5e){console[_0x1daf46(0x257)]('[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:',_0x9a1c5e),console[_0x1daf46(0x268)](_0x1daf46(0x25a));}}['handleMessage'](_0x54e418){const _0x1d6089=a6_0x55cac0;if(!_0x54e418['op']||!_0x54e418['op'][_0x1d6089(0x24b)](_0x1d6089(0x1f6)))return![];console[_0x1d6089(0x268)](_0x1d6089(0x267)+_0x54e418['op']);switch(_0x54e418['op']){case _0x1d6089(0x273):this[_0x1d6089(0x277)](_0x54e418[_0x1d6089(0x27a)],_0x54e418[_0x1d6089(0x250)]);return!![];case _0x1d6089(0x27e):this[_0x1d6089(0x1c8)](_0x54e418[_0x1d6089(0x27a)],_0x54e418['offer']);return!![];case _0x1d6089(0x1e2):this[_0x1d6089(0x25f)](_0x54e418['session_id'],_0x54e418['candidate']);return!![];case _0x1d6089(0x21d):this[_0x1d6089(0x1ef)](_0x54e418['session_id']);return!![];default:console['warn'](_0x1d6089(0x24f)+_0x54e418['op']);return![];}}[a6_0x55cac0(0x231)](_0x3f83aa){const _0x1450a3=a6_0x55cac0;if(this[_0x1450a3(0x258)][_0x1450a3(0x218)](_0x3f83aa)){const _0x257ace=this[_0x1450a3(0x258)][_0x1450a3(0x223)](_0x3f83aa);return _0x257ace['frameCount']++,console[_0x1450a3(0x268)](_0x1450a3(0x25d)+_0x3f83aa+'\x20('+_0x257ace[_0x1450a3(0x1c0)]+_0x1450a3(0x20f)),_0x257ace;}console['log'](_0x1450a3(0x248)+_0x3f83aa);const {createCanvas:_0x716743}=require(_0x1450a3(0x226)),_0x557114=_0x716743(config['webrtc']['video'][_0x1450a3(0x222)],config['webrtc'][_0x1450a3(0x1e6)][_0x1450a3(0x21f)]),_0x4431f9=_0x557114[_0x1450a3(0x1c1)]('2d');this[_0x1450a3(0x270)](_0x557114,_0x4431f9);const {RTCVideoSource:_0xc85ed9}=nonstandard,_0x51741a=new _0xc85ed9();let _0x4e6905=0x0;const _0x1cced7=0x3e8/config[_0x1450a3(0x1fd)]['video'][_0x1450a3(0x22a)],_0x30ba9b=this['subscribeToROSTopic'](_0x3f83aa,_0x2799f3=>{const _0x13513a=_0x1450a3,_0x59a3ae=Date['now']();_0x59a3ae-_0x4e6905>=_0x1cced7&&(_0x4e6905=_0x59a3ae,this[_0x13513a(0x1d3)](_0x557114,_0x4431f9,_0x2799f3,_0x3f83aa,_0x51741a));}),_0x3996c1={'videoSource':_0x51741a,'canvas':_0x557114,'rosSubscriber':_0x30ba9b,'frameCount':0x1,'topic':_0x3f83aa};return this[_0x1450a3(0x258)][_0x1450a3(0x1ff)](_0x3f83aa,_0x3996c1),_0x3996c1;}[a6_0x55cac0(0x1ce)](_0x4a4155){const _0x148daa=a6_0x55cac0,_0x40bd71=this[_0x148daa(0x258)][_0x148daa(0x223)](_0x4a4155);if(!_0x40bd71)return;_0x40bd71['frameCount']--,console['log'](_0x148daa(0x275)+_0x4a4155+'\x20('+_0x40bd71[_0x148daa(0x1c0)]+'\x20sessions\x20remaining)'),_0x40bd71['frameCount']<=0x0&&(console[_0x148daa(0x268)](_0x148daa(0x1e4)+_0x4a4155+_0x148daa(0x1b7)),_0x40bd71[_0x148daa(0x24c)]&&(_0x40bd71[_0x148daa(0x24c)]=null),_0x40bd71[_0x148daa(0x1f5)]&&_0x40bd71['rosSubscriber'][_0x148daa(0x261)](),this[_0x148daa(0x258)]['delete'](_0x4a4155));}async[a6_0x55cac0(0x277)](_0xa89d5,_0x2359e0){const _0x1ba77c=a6_0x55cac0;try{console['log'](_0x1ba77c(0x21b)+_0xa89d5+'\x20for\x20topic\x20'+_0x2359e0);const _0x24a7f1=this['getOrCreateSharedVideoSource'](_0x2359e0),_0x40a5bf=new RTCPeerConnection(this[_0x1ba77c(0x214)]),_0x4f5c49=_0x24a7f1['videoSource'][_0x1ba77c(0x1b2)]({'width':config[_0x1ba77c(0x1fd)][_0x1ba77c(0x1e6)]['width'],'height':config[_0x1ba77c(0x1fd)]['video'][_0x1ba77c(0x21f)],'framerate':config['webrtc'][_0x1ba77c(0x1e6)][_0x1ba77c(0x22a)]});console[_0x1ba77c(0x268)](_0x1ba77c(0x206)+_0xa89d5);const {MediaStream:_0x10de92}=require(_0x1ba77c(0x213)),_0x47ffa9=new _0x10de92([_0x4f5c49]);_0x40a5bf[_0x1ba77c(0x26b)](_0x4f5c49,_0x47ffa9),this[_0x1ba77c(0x1f8)](_0x24a7f1['videoSource'],_0x24a7f1[_0x1ba77c(0x226)]),_0x40a5bf[_0x1ba77c(0x221)]=_0x1c375f=>{const _0x498ff3=_0x1ba77c;if(_0x1c375f[_0x498ff3(0x225)]&&this['serverWs'])console['log'](_0x498ff3(0x25c)+_0xa89d5+':',{'type':_0x1c375f[_0x498ff3(0x225)][_0x498ff3(0x245)],'protocol':_0x1c375f[_0x498ff3(0x225)][_0x498ff3(0x1f4)],'address':_0x1c375f[_0x498ff3(0x225)][_0x498ff3(0x20b)],'port':_0x1c375f[_0x498ff3(0x225)][_0x498ff3(0x1ee)]}),this[_0x498ff3(0x272)][_0x498ff3(0x1f7)](JSON[_0x498ff3(0x1e0)]({'op':_0x498ff3(0x1e2),'session_id':_0xa89d5,'candidate':_0x1c375f[_0x498ff3(0x225)]}));else!_0x1c375f['candidate']&&console[_0x498ff3(0x268)]('[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20'+_0xa89d5);},_0x40a5bf[_0x1ba77c(0x230)]=()=>{const _0x33e919=_0x1ba77c;console[_0x33e919(0x268)]('[WebRTC\x20Appliance]\x20Session\x20'+_0xa89d5+_0x33e919(0x1e3)+_0x40a5bf[_0x33e919(0x1d5)]);if(_0x40a5bf[_0x33e919(0x1d5)]===_0x33e919(0x1f2))console[_0x33e919(0x268)](_0x33e919(0x20d)+_0xa89d5+_0x33e919(0x1eb));else{if(_0x40a5bf[_0x33e919(0x1d5)]===_0x33e919(0x23a))console['log'](_0x33e919(0x20d)+_0xa89d5+_0x33e919(0x219)),this[_0x33e919(0x1ef)](_0xa89d5);else _0x40a5bf[_0x33e919(0x1d5)]===_0x33e919(0x1fc)&&(console[_0x33e919(0x268)](_0x33e919(0x20d)+_0xa89d5+_0x33e919(0x27b)),this[_0x33e919(0x274)](_0xa89d5));}},this[_0x1ba77c(0x1bf)]['set'](_0xa89d5,{'peerConnection':_0x40a5bf,'topic':_0x2359e0,'videoTrack':_0x4f5c49,'mediaStream':_0x47ffa9,'status':'initializing'}),!this[_0x1ba77c(0x1b6)][_0x1ba77c(0x218)](_0x2359e0)&&this['topicSessions'][_0x1ba77c(0x1ff)](_0x2359e0,new Set()),this['topicSessions'][_0x1ba77c(0x223)](_0x2359e0)['add'](_0xa89d5),console[_0x1ba77c(0x268)](_0x1ba77c(0x20d)+_0xa89d5+_0x1ba77c(0x227)),console[_0x1ba77c(0x268)](_0x1ba77c(0x26d)+_0x2359e0+':\x20'+this['topicSessions']['get'](_0x2359e0)['size']);}catch(_0x4ef9df){console['error'](_0x1ba77c(0x244)+_0xa89d5+':',_0x4ef9df),this['stopSession'](_0xa89d5);}}async[a6_0x55cac0(0x1c8)](_0x2f7582,_0x2ea300){const _0x3ce998=a6_0x55cac0,_0x2d8821=this['activeSessions']['get'](_0x2f7582);if(!_0x2d8821){console['error'](_0x3ce998(0x1aa)+_0x2f7582);return;}try{console[_0x3ce998(0x268)](_0x3ce998(0x228)+_0x2f7582),await _0x2d8821[_0x3ce998(0x236)][_0x3ce998(0x1d8)](new RTCSessionDescription(_0x2ea300)),console[_0x3ce998(0x268)](_0x3ce998(0x240));const _0x4740ad=await _0x2d8821[_0x3ce998(0x236)][_0x3ce998(0x1cc)]();console[_0x3ce998(0x268)](_0x3ce998(0x205)),await _0x2d8821['peerConnection'][_0x3ce998(0x264)](_0x4740ad),console[_0x3ce998(0x268)](_0x3ce998(0x1a9)),this['serverWs']&&(this[_0x3ce998(0x272)][_0x3ce998(0x1f7)](JSON[_0x3ce998(0x1e0)]({'op':_0x3ce998(0x202),'session_id':_0x2f7582,'answer':_0x4740ad})),console[_0x3ce998(0x268)](_0x3ce998(0x1fe)+_0x2f7582));}catch(_0x6ba37d){console['error'](_0x3ce998(0x211)+_0x2f7582+':',_0x6ba37d),this['stopSession'](_0x2f7582);}}async[a6_0x55cac0(0x25f)](_0x27839e,_0x1885b3){const _0x4f0eb2=a6_0x55cac0,_0x30ea59=this[_0x4f0eb2(0x1bf)]['get'](_0x27839e);if(!_0x30ea59){console[_0x4f0eb2(0x257)](_0x4f0eb2(0x1bb)+_0x27839e);return;}try{await _0x30ea59['peerConnection'][_0x4f0eb2(0x241)](new RTCIceCandidate(_0x1885b3)),console[_0x4f0eb2(0x268)](_0x4f0eb2(0x271)+_0x27839e);}catch(_0x2f99d2){console[_0x4f0eb2(0x257)](_0x4f0eb2(0x1de)+_0x27839e+':',_0x2f99d2);}}[a6_0x55cac0(0x201)](_0x1d5046,_0x49f343){const _0x223c0d=a6_0x55cac0;if(!this[_0x223c0d(0x23c)]||this[_0x223c0d(0x23c)][_0x223c0d(0x1ad)]!==this['rosbridgeWs'][_0x223c0d(0x1dd)])return console['error'](_0x223c0d(0x22e)),null;console[_0x223c0d(0x268)](_0x223c0d(0x1f9)+_0x1d5046);const _0x527a54=_0x1d5046['includes'](_0x223c0d(0x207)),_0x588bd7=_0x1d5046[_0x223c0d(0x254)](_0x223c0d(0x1cb))||_0x1d5046[_0x223c0d(0x254)](_0x223c0d(0x276));let _0x433f99=[];_0x527a54?_0x588bd7?_0x433f99=[_0x223c0d(0x256),'sensor_msgs/msg/CompressedImage','compressed_depth_image_transport/CompressedDepthImage',_0x223c0d(0x27d)]:_0x433f99=[_0x223c0d(0x27d),'sensor_msgs/msg/Image',_0x223c0d(0x256)]:_0x433f99=['sensor_msgs/CompressedImage',_0x223c0d(0x1c6),_0x223c0d(0x27d)];console[_0x223c0d(0x268)]('[WebRTC\x20Appliance]\x20Topic\x20'+_0x1d5046+_0x223c0d(0x24d)+(_0x527a54?'depth':_0x223c0d(0x1ac))+_0x223c0d(0x1d7),_0x433f99);const _0x49c704=[];let _0x3a4256=![];const _0x54dc98=_0x314212=>{return _0x5cec6c=>{const _0x16f268=a6_0x1e63;try{const _0x4af0b5=JSON[_0x16f268(0x1b0)](_0x5cec6c[_0x16f268(0x1c7)]);_0x4af0b5['op']===_0x16f268(0x23e)&&_0x4af0b5[_0x16f268(0x250)]===_0x1d5046&&_0x4af0b5['msg']&&(!_0x3a4256&&(console[_0x16f268(0x268)](_0x16f268(0x243)+_0x1d5046+_0x16f268(0x265)+_0x314212),_0x3a4256=!![]),_0x49f343(_0x4af0b5[_0x16f268(0x1e5)]));}catch(_0x33d698){console[_0x16f268(0x257)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x33d698);}};};for(const _0x5ac256 of _0x433f99){const _0x464c19={'op':_0x223c0d(0x1db),'topic':_0x1d5046,'type':_0x5ac256};console[_0x223c0d(0x268)](_0x223c0d(0x22f)+_0x5ac256),this[_0x223c0d(0x23c)][_0x223c0d(0x1f7)](JSON[_0x223c0d(0x1e0)](_0x464c19));const _0x47d38b=_0x54dc98(_0x5ac256);this[_0x223c0d(0x23c)][_0x223c0d(0x1e9)](_0x223c0d(0x25b),_0x47d38b),_0x49c704[_0x223c0d(0x208)]({'handler':_0x47d38b,'type':_0x5ac256});}return _0x527a54&&_0x588bd7&&setTimeout(()=>{const _0x291ce9=_0x223c0d;if(!_0x3a4256){console[_0x291ce9(0x268)](_0x291ce9(0x1be)+_0x1d5046+_0x291ce9(0x1ae));const _0xa75d34=_0x1d5046[_0x291ce9(0x26f)](_0x291ce9(0x255),'')[_0x291ce9(0x26f)](_0x291ce9(0x1c3),''),_0x4f136e=[_0xa75d34+_0x291ce9(0x23f),_0xa75d34+_0x291ce9(0x1a7),_0xa75d34];for(const _0xa42fd7 of _0x4f136e){console['log'](_0x291ce9(0x232)+_0xa42fd7);const _0x3eeea6={'op':_0x291ce9(0x1db),'topic':_0xa42fd7,'type':'sensor_msgs/Image'};this['rosbridgeWs'][_0x291ce9(0x1f7)](JSON['stringify'](_0x3eeea6));const _0x4a89df=_0x17517d=>{const _0x4cbec2=_0x291ce9;try{const _0x204bc2=JSON[_0x4cbec2(0x1b0)](_0x17517d[_0x4cbec2(0x1c7)]);_0x204bc2['op']===_0x4cbec2(0x23e)&&_0x204bc2[_0x4cbec2(0x250)]===_0xa42fd7&&_0x204bc2[_0x4cbec2(0x1e5)]&&(console[_0x4cbec2(0x268)]('[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20'+_0xa42fd7+_0x4cbec2(0x1ed)),_0x204bc2[_0x4cbec2(0x1e5)][_0x4cbec2(0x1c7)]&&!_0x204bc2[_0x4cbec2(0x1e5)][_0x4cbec2(0x1c7)][_0x4cbec2(0x24b)]('/9j/')&&_0x49f343(_0x204bc2[_0x4cbec2(0x1e5)]));}catch(_0x303301){console[_0x4cbec2(0x257)](_0x4cbec2(0x266),_0x303301);}};this[_0x291ce9(0x23c)][_0x291ce9(0x1e9)](_0x291ce9(0x25b),_0x4a89df),_0x49c704[_0x291ce9(0x208)]({'handler':_0x4a89df,'type':_0x291ce9(0x27d),'topic':_0xa42fd7});}}},0xbb8),{'unsubscribe':()=>{const _0x259ebe=_0x223c0d;for(const {handler:_0x2b1b32,type:_0x2c48ab,topic:_0x314d09}of _0x49c704){this[_0x259ebe(0x23c)][_0x259ebe(0x1dc)](_0x259ebe(0x25b),_0x2b1b32),this[_0x259ebe(0x23c)][_0x259ebe(0x1ad)]===this[_0x259ebe(0x23c)][_0x259ebe(0x1dd)]&&this['rosbridgeWs'][_0x259ebe(0x1f7)](JSON['stringify']({'op':_0x259ebe(0x261),'topic':_0x314d09||_0x1d5046}));}}};}[a6_0x55cac0(0x270)](_0x255b7f,_0x48009e){const _0x5087b3=a6_0x55cac0;_0x48009e[_0x5087b3(0x1c9)]='#1a1a1a',_0x48009e['fillRect'](0x0,0x0,_0x255b7f[_0x5087b3(0x222)],_0x255b7f['height']),_0x48009e[_0x5087b3(0x1c9)]='#00aaff',_0x48009e[_0x5087b3(0x1b5)]=_0x5087b3(0x1df),_0x48009e['textAlign']='center',_0x48009e[_0x5087b3(0x238)](_0x5087b3(0x1cf),_0x255b7f[_0x5087b3(0x222)]/0x2,_0x255b7f[_0x5087b3(0x21f)]/0x2-0x14),_0x48009e[_0x5087b3(0x1c9)]=_0x5087b3(0x27c),_0x48009e[_0x5087b3(0x1b5)]=_0x5087b3(0x279),_0x48009e[_0x5087b3(0x238)](_0x5087b3(0x1c5),_0x255b7f[_0x5087b3(0x222)]/0x2,_0x255b7f[_0x5087b3(0x21f)]/0x2+0x14);const _0x2076e3=Date[_0x5087b3(0x1ba)]()/0x3e8;for(let _0x11d9b7=0x0;_0x11d9b7<0x3;_0x11d9b7++){const _0x91abb5=(Math[_0x5087b3(0x1fa)](_0x2076e3*0x2+_0x11d9b7*0.5)+0x1)/0x2;_0x48009e[_0x5087b3(0x1c9)]=_0x5087b3(0x216)+_0x91abb5*0.5+')',_0x48009e[_0x5087b3(0x237)](),_0x48009e['arc'](_0x255b7f[_0x5087b3(0x222)]/0x2-0x28+_0x11d9b7*0x28,_0x255b7f[_0x5087b3(0x21f)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x48009e[_0x5087b3(0x25e)]();}}[a6_0x55cac0(0x1f8)](_0x2d2b7a,_0x154395){const _0x373b10=a6_0x55cac0;try{if(!_0x2d2b7a||!_0x154395)return;const _0x475f20=_0x154395['getContext']('2d'),_0x121bad=_0x475f20[_0x373b10(0x1f1)](0x0,0x0,_0x154395[_0x373b10(0x222)],_0x154395[_0x373b10(0x21f)]),_0x2587dd=this[_0x373b10(0x269)](_0x121bad[_0x373b10(0x1c7)],_0x154395[_0x373b10(0x222)],_0x154395[_0x373b10(0x21f)]),_0xadf32d={'width':_0x154395['width'],'height':_0x154395[_0x373b10(0x21f)],'data':_0x2587dd};typeof _0x2d2b7a['onFrame']===_0x373b10(0x1f3)&&_0x2d2b7a[_0x373b10(0x224)](_0xadf32d);}catch(_0x31ccc7){console['error'](_0x373b10(0x1b1),_0x31ccc7);}}[a6_0x55cac0(0x269)](_0xfb55c,_0xe628d1,_0x3ab851){const _0x5536a6=a6_0x55cac0,_0x3b7b0f=_0xe628d1*_0x3ab851,_0x4c9bc8=_0xe628d1*_0x3ab851/0x4,_0x227bda=new Uint8Array(_0x3b7b0f+_0x4c9bc8*0x2);let _0x2e202c=0x0,_0x1224f0=_0x3b7b0f,_0x993ee8=_0x3b7b0f+_0x4c9bc8;for(let _0x2bed6c=0x0;_0x2bed6c<_0x3ab851;_0x2bed6c++){for(let _0x40b4e5=0x0;_0x40b4e5<_0xe628d1;_0x40b4e5++){const _0x2131d9=(_0x2bed6c*_0xe628d1+_0x40b4e5)*0x4,_0x497b14=_0xfb55c[_0x2131d9],_0x38fc9b=_0xfb55c[_0x2131d9+0x1],_0xbf2bec=_0xfb55c[_0x2131d9+0x2],_0x32ce95=Math[_0x5536a6(0x210)](0.299*_0x497b14+0.587*_0x38fc9b+0.114*_0xbf2bec);_0x227bda[_0x2e202c++]=_0x32ce95;if(_0x2bed6c%0x2===0x0&&_0x40b4e5%0x2===0x0){const _0x503c5c=Math[_0x5536a6(0x210)](-0.169*_0x497b14-0.331*_0x38fc9b+0.5*_0xbf2bec+0x80),_0x11fada=Math[_0x5536a6(0x210)](0.5*_0x497b14-0.419*_0x38fc9b-0.081*_0xbf2bec+0x80);_0x227bda[_0x1224f0++]=Math['max'](0x0,Math['min'](0xff,_0x503c5c)),_0x227bda[_0x993ee8++]=Math[_0x5536a6(0x1e7)](0x0,Math[_0x5536a6(0x21a)](0xff,_0x11fada));}}}return _0x227bda;}async[a6_0x55cac0(0x1d3)](_0x36360e,_0x29691e,_0x531b7d,_0x552ae5,_0x4c33f9){const _0x4acee1=a6_0x55cac0;try{if(!_0x531b7d||!_0x531b7d[_0x4acee1(0x1c7)])return;Math[_0x4acee1(0x1ec)]()<0.01&&console['log'](_0x4acee1(0x24a)+_0x552ae5+_0x4acee1(0x1e1)+_0x531b7d['data']['length']+_0x4acee1(0x1a6));const _0x3ef3d1=Buffer['from'](_0x531b7d[_0x4acee1(0x1c7)],'base64'),_0x233a87=this[_0x4acee1(0x1ea)][_0x4acee1(0x1c4)](_0x552ae5);let _0x1030a9;_0x233a87?_0x1030a9=await this[_0x4acee1(0x1ea)][_0x4acee1(0x203)](_0x3ef3d1,_0x36360e,_0x29691e,_0x552ae5):_0x1030a9=await this[_0x4acee1(0x1ea)][_0x4acee1(0x259)](_0x3ef3d1,_0x36360e,_0x29691e),_0x29691e[_0x4acee1(0x260)](_0x1030a9,0x0,0x0),_0x29691e['fillStyle']=_0x4acee1(0x26a),_0x29691e['fillRect'](0xa,0xa,0xdc,0x32),_0x29691e['fillStyle']=_0x233a87?_0x4acee1(0x1d6):'#00ff00',_0x29691e[_0x4acee1(0x1b5)]=_0x4acee1(0x1ab),_0x29691e['fillText']((_0x233a87?_0x4acee1(0x1c2):_0x4acee1(0x1d9))+':\x20'+new Date()[_0x4acee1(0x22d)](),0xf,0x1c),_0x29691e[_0x4acee1(0x1c9)]=_0x4acee1(0x27c),_0x29691e[_0x4acee1(0x1b5)]=_0x4acee1(0x1bc),_0x29691e['fillText'](_0x4acee1(0x1b9)+_0x552ae5[_0x4acee1(0x217)]('/')[_0x4acee1(0x1b4)](),0xf,0x2d),this[_0x4acee1(0x1f8)](_0x4c33f9,_0x36360e);}catch(_0x5cd8f5){console['warn'](_0x4acee1(0x22c)+_0x552ae5+':',_0x5cd8f5[_0x4acee1(0x25b)]);_0x552ae5[_0x4acee1(0x254)](_0x4acee1(0x207))&&Math[_0x4acee1(0x1ec)]()<0.1&&console[_0x4acee1(0x20c)](_0x4acee1(0x23d)+_0x552ae5[_0x4acee1(0x26f)](_0x4acee1(0x255),_0x4acee1(0x23f)));_0x29691e['fillStyle']='#1a1a1a',_0x29691e[_0x4acee1(0x252)](0x0,0x0,_0x36360e['width'],_0x36360e[_0x4acee1(0x21f)]),_0x29691e[_0x4acee1(0x1c9)]=_0x4acee1(0x22b),_0x29691e[_0x4acee1(0x1b5)]=_0x4acee1(0x279),_0x29691e[_0x4acee1(0x212)]=_0x4acee1(0x1da);const _0x52070c=_0x552ae5[_0x4acee1(0x254)](_0x4acee1(0x207))?'üîç\x20Processing\x20depth...':_0x4acee1(0x1e8);_0x29691e[_0x4acee1(0x238)](_0x52070c,_0x36360e[_0x4acee1(0x222)]/0x2,_0x36360e[_0x4acee1(0x21f)]/0x2),_0x29691e[_0x4acee1(0x1c9)]=_0x4acee1(0x1b3),_0x29691e['font']=_0x4acee1(0x247),_0x29691e[_0x4acee1(0x238)]('Topic:\x20'+_0x552ae5[_0x4acee1(0x217)]('/')[_0x4acee1(0x1b4)](),_0x36360e[_0x4acee1(0x222)]/0x2,_0x36360e[_0x4acee1(0x21f)]/0x2+0x19),this[_0x4acee1(0x1f8)](_0x4c33f9,_0x36360e);}}[a6_0x55cac0(0x1ef)](_0x5e4274){const _0x4fb6a2=a6_0x55cac0,_0x2cdc2d=this['activeSessions'][_0x4fb6a2(0x223)](_0x5e4274);if(!_0x2cdc2d){console[_0x4fb6a2(0x20c)]('[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20'+_0x5e4274);return;}console[_0x4fb6a2(0x268)](_0x4fb6a2(0x1cd)+_0x5e4274+'\x20for\x20topic:\x20'+_0x2cdc2d[_0x4fb6a2(0x250)]);try{this[_0x4fb6a2(0x272)]&&this[_0x4fb6a2(0x272)][_0x4fb6a2(0x1ad)]===this[_0x4fb6a2(0x272)][_0x4fb6a2(0x1dd)]&&this['serverWs'][_0x4fb6a2(0x1f7)](JSON[_0x4fb6a2(0x1e0)]({'op':_0x4fb6a2(0x21d),'session_id':_0x5e4274})),_0x2cdc2d[_0x4fb6a2(0x21c)]&&_0x2cdc2d['videoTrack']['stop'](),_0x2cdc2d[_0x4fb6a2(0x236)]&&_0x2cdc2d[_0x4fb6a2(0x236)][_0x4fb6a2(0x1a8)]();}catch(_0x413f5a){console[_0x4fb6a2(0x257)](_0x4fb6a2(0x1f0)+_0x413f5a);}this[_0x4fb6a2(0x274)](_0x5e4274);}[a6_0x55cac0(0x274)](_0xd801f0){const _0x377ad9=a6_0x55cac0,_0x18cf21=this['activeSessions'][_0x377ad9(0x223)](_0xd801f0);if(_0x18cf21){const _0x52efe3=this[_0x377ad9(0x1b6)][_0x377ad9(0x223)](_0x18cf21[_0x377ad9(0x250)]);_0x52efe3&&(_0x52efe3['delete'](_0xd801f0),_0x52efe3[_0x377ad9(0x220)]===0x0&&this[_0x377ad9(0x1b6)][_0x377ad9(0x26e)](_0x18cf21[_0x377ad9(0x250)])),this[_0x377ad9(0x1ce)](_0x18cf21[_0x377ad9(0x250)]);}this[_0x377ad9(0x1bf)][_0x377ad9(0x26e)](_0xd801f0),console[_0x377ad9(0x268)](_0x377ad9(0x209)+_0xd801f0);}[a6_0x55cac0(0x278)](){const _0x1cbf46=a6_0x55cac0;console['log'](_0x1cbf46(0x1d1));const _0x4cb464=Array['from'](this[_0x1cbf46(0x1bf)][_0x1cbf46(0x23b)]());_0x4cb464[_0x1cbf46(0x229)](_0x501a27=>this[_0x1cbf46(0x1ef)](_0x501a27));}[a6_0x55cac0(0x242)](){const _0x123bf0=a6_0x55cac0,_0x367c2e=[];for(const [_0x80c410,_0x81d4ee]of this['activeSessions']){_0x367c2e[_0x123bf0(0x208)]({'sessionId':_0x80c410,'topic':_0x81d4ee[_0x123bf0(0x250)],'connectionState':_0x81d4ee[_0x123bf0(0x236)]?.[_0x123bf0(0x1d5)]||_0x123bf0(0x249),'hasVideoTrack':!!_0x81d4ee[_0x123bf0(0x21c)]});}return _0x367c2e;}[a6_0x55cac0(0x215)](){const _0x25da9a=a6_0x55cac0,_0x4e1754=[];for(const [_0x348dde,_0x25e1a6]of this[_0x25da9a(0x258)]){_0x4e1754[_0x25da9a(0x208)]({'topic':_0x348dde,'frameCount':_0x25e1a6[_0x25da9a(0x1c0)],'hasVideoSource':!!_0x25e1a6[_0x25da9a(0x24c)],'hasRosSubscriber':!!_0x25e1a6['rosSubscriber']});}return _0x4e1754;}}module[a6_0x55cac0(0x1fb)]=new ApplianceWebRTCService();function a6_0x103d(){const _0x1ec1f1=['unknown','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','startsWith','videoSource','\x20detected\x20as\x20','sharp','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','topic','toString','fillRect','275982HFyZXk','includes','/compressedDepth','sensor_msgs/CompressedImage','error','sharedVideoSources','processColorImage','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','message','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','fill','handleIceCandidate','putImageData','unsubscribe','apply','../config','setLocalDescription','\x20with\x20message\x20type\x20','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','log','convertRGBAtoI420','rgba(0,\x200,\x200,\x200.7)','addTrack','1612456sbTBoW','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','delete','replace','drawLoadingPattern','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','serverWs','webrtc_init_session','cleanupSession','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','compressedDepth','initializeSession','stopAllSessions','16px\x20Arial','session_id','\x20connection\x20closed,\x20cleaning\x20up','#ffffff','sensor_msgs/Image','webrtc_offer','35WHPaIN','41708RhGZeM','\x20bytes','/image','close','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','12px\x20monospace','color','readyState',',\x20trying\x20alternative\x20depth\x20topics','937310hthVHD','parse','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','createTrack','#666','pop','font','topicSessions',',\x20cleaning\x20up\x20shared\x20resources','2977100MJoTAC','Topic:\x20','now','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','10px\x20monospace','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','activeSessions','frameCount','getContext','üîç\x20Depth','/compressed','isDepthTopic','Waiting\x20for\x20ROS\x20image\x20data...','sensor_msgs/msg/CompressedImage','data','handleOffer','fillStyle','initialize','compressed','createAnswer','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','releaseSharedVideoSource','ü§ñ\x20Robot\x20Camera','updateTurnCredentials','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','search','updateCanvasWithImageData','./turnCredentialsService','connectionState','#00ffff','\x20image,\x20trying\x20message\x20types:','setRemoteDescription','üìπ\x20Color','center','subscribe','removeEventListener','OPEN','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','24px\x20Arial','stringify',',\x20size:\x20','webrtc_ice_candidate','\x20connection\x20state:\x20','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','msg','video','max','üìπ\x20Processing\x20video...','addEventListener','depthProcessor','\x20successfully\x20connected!','random',',\x20converting\x20to\x20base64...','port','stopSession','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','getImageData','connected','function','protocol','rosSubscriber','webrtc_','send','sendFrameToVideoSource','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','sin','exports','closed','webrtc','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','set','[WebRTC\x20Appliance]\x20Service\x20initialized','subscribeToROSTopic','webrtc_answer','processDepthImage','stun:stun.l.google.com:19302','[WebRTC\x20Appliance]\x20Created\x20answer','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','depth','push','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','2fownVk','address','warn','[WebRTC\x20Appliance]\x20Session\x20','18342HHHsgn','\x20sessions)','round','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','textAlign','wrtc','rtcConfig','getSharedVideoSources','rgba(0,\x20170,\x20255,\x20','split','has','\x20connection\x20failed,\x20stopping\x20session','min','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','videoTrack','webrtc_stop_session','(((.+)+)+)+$','height','size','onicecandidate','width','get','onFrame','candidate','canvas','\x20initialized\x20successfully','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','forEach','framerate','#888','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','toLocaleTimeString','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','onconnectionstatechange','getOrCreateSharedVideoSource','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','./DepthImageProcessor','1328025vdqkBm','stun:stun1.l.google.com:19302','peerConnection','beginPath','fillText','getIceServers','failed','keys','rosbridgeWs','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','publish','/image_raw','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','addIceCandidate','getActiveSessions','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','type','1928RYEzCQ','12px\x20Arial','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'];a6_0x103d=function(){return _0x1ec1f1;};return a6_0x103d();}