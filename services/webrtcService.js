const a6_0x1d748f=a6_0xe22f;(function(_0x265f2e,_0x40f1d5){const _0x1fa6b7=a6_0xe22f,_0x11908d=_0x265f2e();while(!![]){try{const _0x29e55c=parseInt(_0x1fa6b7(0xec))/0x1+parseInt(_0x1fa6b7(0x95))/0x2+-parseInt(_0x1fa6b7(0xe3))/0x3*(-parseInt(_0x1fa6b7(0x148))/0x4)+-parseInt(_0x1fa6b7(0xb0))/0x5+parseInt(_0x1fa6b7(0x10e))/0x6+parseInt(_0x1fa6b7(0x122))/0x7+-parseInt(_0x1fa6b7(0x114))/0x8*(parseInt(_0x1fa6b7(0x11e))/0x9);if(_0x29e55c===_0x40f1d5)break;else _0x11908d['push'](_0x11908d['shift']());}catch(_0x54c053){_0x11908d['push'](_0x11908d['shift']());}}}(a6_0x46f6,0x4010a));const a6_0x60e098=(function(){let _0x2996fc=!![];return function(_0x326ab5,_0x2b1b46){const _0x210fb0=_0x2996fc?function(){const _0xc21e42=a6_0xe22f;if(_0x2b1b46){const _0x223951=_0x2b1b46[_0xc21e42(0x108)](_0x326ab5,arguments);return _0x2b1b46=null,_0x223951;}}:function(){};return _0x2996fc=![],_0x210fb0;};}()),a6_0x243235=a6_0x60e098(this,function(){const _0x51be14=a6_0xe22f;return a6_0x243235[_0x51be14(0x94)]()[_0x51be14(0x12c)](_0x51be14(0x9b))[_0x51be14(0x94)]()[_0x51be14(0xc7)](a6_0x243235)[_0x51be14(0x12c)](_0x51be14(0x9b));});function a6_0xe22f(_0x2f9295,_0x4c0332){const _0x2f941a=a6_0x46f6();return a6_0xe22f=function(_0x243235,_0x60e098){_0x243235=_0x243235-0x78;let _0x46f65a=_0x2f941a[_0x243235];return _0x46f65a;},a6_0xe22f(_0x2f9295,_0x4c0332);}a6_0x243235();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x1d748f(0x105)),sharp=require(a6_0x1d748f(0x91)),config=require(a6_0x1d748f(0x86)),DepthImageProcessor=require(a6_0x1d748f(0xaf)),turnCredentialsService=require('./turnCredentialsService');function a6_0x46f6(){const _0x14e964=['webrtc_answer','16px\x20Arial','onconnectionstatechange','getIceServers','delete','iceServers','initialize','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Session\x20','search','length','compressed','fillText','data','candidate','depth','\x20sessions)','startsWith','🤖\x20Robot\x20Camera','convertRGBAtoI420','type','min','[WebRTC\x20Appliance]\x20Created\x20answer','sendFrameToVideoSource','handleIceCandidate','unknown','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','rtcConfig','fill','🔍\x20Processing\x20depth...','#ffffff','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','get','onFrame','rgba(0,\x200,\x200,\x200.7)','max','11884bSiwMA','Topic:\x20','peerConnection',',\x20converting\x20to\x20base64...','height','stun:stun.l.google.com:19302',',\x20trying\x20alternative\x20depth\x20topics','/compressedDepth','textAlign','[WebRTC\x20Appliance]\x20Service\x20initialized','rgba(0,\x20170,\x20255,\x20','split','parse','updateCanvasWithImageData','\x20for\x20topic\x20','../config','initializeSession','/image_raw','releaseSharedVideoSource','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','closed','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','failed','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','createAnswer','function','sharp','includes','initializing','toString','449388FCSnpt','\x20detected\x20as\x20','10px\x20monospace','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','webrtc','canvas','(((.+)+)+)+$','from','readyState','putImageData','sin','stun:stun1.l.google.com:19302','OPEN','subscribeToROSTopic','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','videoSource','webrtc_ice_candidate','set','updateTurnCredentials','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','sharedVideoSources','rosbridgeWs','addEventListener','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','#00ffff','./DepthImageProcessor','1380515eJMQlM','sensor_msgs/msg/Image','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','msg','serverWs','beginPath','push','protocol','frameCount','12px\x20monospace','#1a1a1a','sensor_msgs/CompressedImage','fillStyle','rosSubscriber','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','📹\x20Color','12px\x20Arial','webrtc_offer','#666','onicecandidate','compressedDepth','stopSession','size','constructor','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','activeSessions','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','/image','getOrCreateSharedVideoSource','/compressed','topicSessions',',\x20size:\x20','\x20initialized\x20successfully','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','font','\x20connection\x20closed,\x20cleaning\x20up','stringify','session_id','video','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','topic','offer','processColorImage','\x20successfully\x20connected!','fillRect','webrtc_init_session','\x20bytes','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','subscribe','423ESBkbn','isDepthTopic','log','webrtc_stop_session','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','getContext','videoTrack','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','139875OIqbdb','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','stopAllSessions','publish','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','\x20sessions\x20remaining)','close','message','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','replace','connectionState','add','connected','\x20connection\x20state:\x20','📹\x20Processing\x20video...','warn','webrtc_','cleanupSession','error','\x20for\x20topic:\x20','framerate','\x20connection\x20failed,\x20stopping\x20session','sensor_msgs/Image','wrtc','#00aaff','getImageData','apply','keys','sensor_msgs/msg/CompressedImage','drawLoadingPattern','24px\x20Arial','createTrack','1827516mCkmwj','has',',\x20cleaning\x20up\x20shared\x20resources','\x20with\x20message\x20type\x20','round','pop','7855384HVMOMK','send','getSharedVideoSources','depthProcessor','Waiting\x20for\x20ROS\x20image\x20data...','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','center','port','width','unsubscribe','9CUtCrz','now','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','getActiveSessions','3026590WnvlMj'];a6_0x46f6=function(){return _0x14e964;};return a6_0x46f6();}class ApplianceWebRTCService{constructor(){const _0xa17c4=a6_0x1d748f;this[_0xa17c4(0xc9)]=new Map(),this['topicSessions']=new Map(),this[_0xa17c4(0xaa)]=new Map(),this[_0xa17c4(0xab)]=null,this['serverWs']=null,this[_0xa17c4(0x117)]=new DepthImageProcessor(),this[_0xa17c4(0x13f)]={'iceServers':[{'urls':_0xa17c4(0x7c)},{'urls':_0xa17c4(0xa0)}]};}[a6_0x1d748f(0x129)](_0x537542,_0x1874f7){const _0x35fb38=a6_0x1d748f;this[_0x35fb38(0xab)]=_0x537542,this[_0x35fb38(0xb4)]=_0x1874f7,turnCredentialsService[_0x35fb38(0x129)](config['serverUrl']),this[_0x35fb38(0xa8)](),console[_0x35fb38(0xe5)](_0x35fb38(0x80));}async[a6_0x1d748f(0xa8)](){const _0x280004=a6_0x1d748f;try{console[_0x280004(0xe5)](_0x280004(0xf4));const _0xbbc0a0=await turnCredentialsService[_0x280004(0x126)]();this[_0x280004(0x13f)][_0x280004(0x128)]=_0xbbc0a0,console[_0x280004(0xe5)](_0x280004(0x8c));}catch(_0x1ce1c2){console[_0x280004(0x100)](_0x280004(0xa4),_0x1ce1c2),console[_0x280004(0xe5)](_0x280004(0xd7));}}['handleMessage'](_0x745b02){const _0x1834c1=a6_0x1d748f;if(!_0x745b02['op']||!_0x745b02['op'][_0x1834c1(0x134)](_0x1834c1(0xfe)))return![];console[_0x1834c1(0xe5)]('[WebRTC\x20Appliance]\x20Handling\x20message:\x20'+_0x745b02['op']);switch(_0x745b02['op']){case _0x1834c1(0xde):this['initializeSession'](_0x745b02[_0x1834c1(0xd5)],_0x745b02[_0x1834c1(0xd9)]);return!![];case _0x1834c1(0xc1):this['handleOffer'](_0x745b02[_0x1834c1(0xd5)],_0x745b02[_0x1834c1(0xda)]);return!![];case _0x1834c1(0xa6):this[_0x1834c1(0x13b)](_0x745b02[_0x1834c1(0xd5)],_0x745b02[_0x1834c1(0x131)]);return!![];case _0x1834c1(0xe6):this['stopSession'](_0x745b02[_0x1834c1(0xd5)]);return!![];default:console[_0x1834c1(0xfd)](_0x1834c1(0x8e)+_0x745b02['op']);return![];}}[a6_0x1d748f(0xcc)](_0x188690){const _0x499e49=a6_0x1d748f;if(this[_0x499e49(0xaa)][_0x499e49(0x10f)](_0x188690)){const _0x418a03=this['sharedVideoSources'][_0x499e49(0x144)](_0x188690);return _0x418a03[_0x499e49(0xb8)]++,console[_0x499e49(0xe5)](_0x499e49(0xe7)+_0x188690+'\x20('+_0x418a03['frameCount']+_0x499e49(0x133)),_0x418a03;}console[_0x499e49(0xe5)](_0x499e49(0xf6)+_0x188690);const {createCanvas:_0x6f81f}=require(_0x499e49(0x9a)),_0x2f6917=_0x6f81f(config[_0x499e49(0x99)]['video'][_0x499e49(0x11c)],config[_0x499e49(0x99)]['video'][_0x499e49(0x7b)]),_0x3431df=_0x2f6917[_0x499e49(0xe9)]('2d');this[_0x499e49(0x10b)](_0x2f6917,_0x3431df);const {RTCVideoSource:_0x4acee8}=nonstandard,_0x56fa57=new _0x4acee8();let _0x20b1fd=0x0;const _0x426b69=0x3e8/config[_0x499e49(0x99)][_0x499e49(0xd6)][_0x499e49(0x102)],_0x7a2ce6=this[_0x499e49(0xa2)](_0x188690,_0x5adbdd=>{const _0x721a2b=_0x499e49,_0x54ee5b=Date[_0x721a2b(0x11f)]();_0x54ee5b-_0x20b1fd>=_0x426b69&&(_0x20b1fd=_0x54ee5b,this[_0x721a2b(0x84)](_0x2f6917,_0x3431df,_0x5adbdd,_0x188690,_0x56fa57));}),_0x5dbd89={'videoSource':_0x56fa57,'canvas':_0x2f6917,'rosSubscriber':_0x7a2ce6,'frameCount':0x1,'topic':_0x188690};return this[_0x499e49(0xaa)][_0x499e49(0xa7)](_0x188690,_0x5dbd89),_0x5dbd89;}[a6_0x1d748f(0x89)](_0x40c438){const _0x204724=a6_0x1d748f,_0x33abe9=this['sharedVideoSources'][_0x204724(0x144)](_0x40c438);if(!_0x33abe9)return;_0x33abe9[_0x204724(0xb8)]--,console[_0x204724(0xe5)](_0x204724(0xb2)+_0x40c438+'\x20('+_0x33abe9[_0x204724(0xb8)]+_0x204724(0xf1)),_0x33abe9[_0x204724(0xb8)]<=0x0&&(console[_0x204724(0xe5)](_0x204724(0xa9)+_0x40c438+_0x204724(0x110)),_0x33abe9['videoSource']&&(_0x33abe9['videoSource']=null),_0x33abe9[_0x204724(0xbd)]&&_0x33abe9[_0x204724(0xbd)][_0x204724(0x11d)](),this[_0x204724(0xaa)][_0x204724(0x127)](_0x40c438));}async[a6_0x1d748f(0x87)](_0x43e7a8,_0x180e80){const _0x409b57=a6_0x1d748f;try{console[_0x409b57(0xe5)]('[WebRTC\x20Appliance]\x20Initializing\x20session\x20'+_0x43e7a8+_0x409b57(0x85)+_0x180e80);const _0x10fea5=this[_0x409b57(0xcc)](_0x180e80),_0x26a25d=new RTCPeerConnection(this[_0x409b57(0x13f)]),_0x52e913=_0x10fea5[_0x409b57(0xa5)][_0x409b57(0x10d)]({'width':config[_0x409b57(0x99)]['video'][_0x409b57(0x11c)],'height':config['webrtc'][_0x409b57(0xd6)][_0x409b57(0x7b)],'framerate':config[_0x409b57(0x99)]['video'][_0x409b57(0x102)]});console[_0x409b57(0xe5)]('[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20'+_0x43e7a8);const {MediaStream:_0x24445a}=require(_0x409b57(0x105)),_0x4853ed=new _0x24445a([_0x52e913]);_0x26a25d['addTrack'](_0x52e913,_0x4853ed),this[_0x409b57(0x13a)](_0x10fea5[_0x409b57(0xa5)],_0x10fea5['canvas']),_0x26a25d[_0x409b57(0xc3)]=_0xf0385f=>{const _0x5a6dc7=_0x409b57;if(_0xf0385f[_0x5a6dc7(0x131)]&&this[_0x5a6dc7(0xb4)])console[_0x5a6dc7(0xe5)](_0x5a6dc7(0xad)+_0x43e7a8+':',{'type':_0xf0385f['candidate'][_0x5a6dc7(0x137)],'protocol':_0xf0385f[_0x5a6dc7(0x131)][_0x5a6dc7(0xb7)],'address':_0xf0385f[_0x5a6dc7(0x131)]['address'],'port':_0xf0385f[_0x5a6dc7(0x131)][_0x5a6dc7(0x11b)]}),this[_0x5a6dc7(0xb4)][_0x5a6dc7(0x115)](JSON[_0x5a6dc7(0xd4)]({'op':'webrtc_ice_candidate','session_id':_0x43e7a8,'candidate':_0xf0385f[_0x5a6dc7(0x131)]}));else!_0xf0385f[_0x5a6dc7(0x131)]&&console[_0x5a6dc7(0xe5)](_0x5a6dc7(0x13d)+_0x43e7a8);},_0x26a25d[_0x409b57(0x125)]=()=>{const _0x5df8e0=_0x409b57;console['log'](_0x5df8e0(0x12b)+_0x43e7a8+_0x5df8e0(0xfb)+_0x26a25d[_0x5df8e0(0xf8)]);if(_0x26a25d['connectionState']===_0x5df8e0(0xfa))console['log'](_0x5df8e0(0x12b)+_0x43e7a8+_0x5df8e0(0xdc));else{if(_0x26a25d[_0x5df8e0(0xf8)]===_0x5df8e0(0x8d))console[_0x5df8e0(0xe5)](_0x5df8e0(0x12b)+_0x43e7a8+_0x5df8e0(0x103)),this[_0x5df8e0(0xc5)](_0x43e7a8);else _0x26a25d[_0x5df8e0(0xf8)]===_0x5df8e0(0x8b)&&(console['log']('[WebRTC\x20Appliance]\x20Session\x20'+_0x43e7a8+_0x5df8e0(0xd3)),this[_0x5df8e0(0xff)](_0x43e7a8));}},this[_0x409b57(0xc9)][_0x409b57(0xa7)](_0x43e7a8,{'peerConnection':_0x26a25d,'topic':_0x180e80,'videoTrack':_0x52e913,'mediaStream':_0x4853ed,'status':_0x409b57(0x93)}),!this['topicSessions']['has'](_0x180e80)&&this[_0x409b57(0xce)][_0x409b57(0xa7)](_0x180e80,new Set()),this[_0x409b57(0xce)]['get'](_0x180e80)[_0x409b57(0xf9)](_0x43e7a8),console[_0x409b57(0xe5)](_0x409b57(0x12b)+_0x43e7a8+_0x409b57(0xd0)),console[_0x409b57(0xe5)]('[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20'+_0x180e80+':\x20'+this[_0x409b57(0xce)][_0x409b57(0x144)](_0x180e80)[_0x409b57(0xc6)]);}catch(_0x128db2){console[_0x409b57(0x100)]('[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20'+_0x43e7a8+':',_0x128db2),this['stopSession'](_0x43e7a8);}}async['handleOffer'](_0x340e96,_0xd8661d){const _0x314f71=a6_0x1d748f,_0x29d30f=this['activeSessions']['get'](_0x340e96);if(!_0x29d30f){console[_0x314f71(0x100)](_0x314f71(0x98)+_0x340e96);return;}try{console[_0x314f71(0xe5)](_0x314f71(0x12a)+_0x340e96),await _0x29d30f[_0x314f71(0x79)]['setRemoteDescription'](new RTCSessionDescription(_0xd8661d)),console[_0x314f71(0xe5)](_0x314f71(0xd1));const _0x28f5d0=await _0x29d30f[_0x314f71(0x79)][_0x314f71(0x8f)]();console[_0x314f71(0xe5)](_0x314f71(0x139)),await _0x29d30f[_0x314f71(0x79)]['setLocalDescription'](_0x28f5d0),console[_0x314f71(0xe5)]('[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)'),this[_0x314f71(0xb4)]&&(this[_0x314f71(0xb4)][_0x314f71(0x115)](JSON['stringify']({'op':_0x314f71(0x123),'session_id':_0x340e96,'answer':_0x28f5d0})),console[_0x314f71(0xe5)]('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0x340e96));}catch(_0x11346e){console[_0x314f71(0x100)]('[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20'+_0x340e96+':',_0x11346e),this[_0x314f71(0xc5)](_0x340e96);}}async['handleIceCandidate'](_0x5f24da,_0x22f534){const _0x5e8ba5=a6_0x1d748f,_0x2d86a1=this[_0x5e8ba5(0xc9)]['get'](_0x5f24da);if(!_0x2d86a1){console[_0x5e8ba5(0x100)](_0x5e8ba5(0x119)+_0x5f24da);return;}try{await _0x2d86a1[_0x5e8ba5(0x79)]['addIceCandidate'](new RTCIceCandidate(_0x22f534)),console['log'](_0x5e8ba5(0xe0)+_0x5f24da);}catch(_0x380293){console['error'](_0x5e8ba5(0xe8)+_0x5f24da+':',_0x380293);}}[a6_0x1d748f(0xa2)](_0x1aee58,_0x242dd2){const _0x1dcea9=a6_0x1d748f;if(!this[_0x1dcea9(0xab)]||this[_0x1dcea9(0xab)][_0x1dcea9(0x9d)]!==this['rosbridgeWs'][_0x1dcea9(0xa1)])return console['error'](_0x1dcea9(0x143)),null;console[_0x1dcea9(0xe5)](_0x1dcea9(0xf0)+_0x1aee58);const _0x3c28c1=_0x1aee58[_0x1dcea9(0x92)]('depth'),_0x455b30=_0x1aee58[_0x1dcea9(0x92)](_0x1dcea9(0x12e))||_0x1aee58[_0x1dcea9(0x92)](_0x1dcea9(0xc4));let _0x17ba5c=[];_0x3c28c1?_0x455b30?_0x17ba5c=[_0x1dcea9(0xbb),_0x1dcea9(0x10a),'compressed_depth_image_transport/CompressedDepthImage','sensor_msgs/Image']:_0x17ba5c=[_0x1dcea9(0x104),_0x1dcea9(0xb1),'sensor_msgs/CompressedImage']:_0x17ba5c=[_0x1dcea9(0xbb),_0x1dcea9(0x10a),_0x1dcea9(0x104)];console[_0x1dcea9(0xe5)]('[WebRTC\x20Appliance]\x20Topic\x20'+_0x1aee58+_0x1dcea9(0x96)+(_0x3c28c1?_0x1dcea9(0x132):'color')+'\x20image,\x20trying\x20message\x20types:',_0x17ba5c);const _0x53ff3b=[];let _0x29780a=![];const _0x26708e=_0x3973ba=>{return _0x18cee1=>{const _0x5253cb=a6_0xe22f;try{const _0x3b3f25=JSON[_0x5253cb(0x83)](_0x18cee1['data']);_0x3b3f25['op']==='publish'&&_0x3b3f25[_0x5253cb(0xd9)]===_0x1aee58&&_0x3b3f25[_0x5253cb(0xb3)]&&(!_0x29780a&&(console[_0x5253cb(0xe5)](_0x5253cb(0x8a)+_0x1aee58+_0x5253cb(0x111)+_0x3973ba),_0x29780a=!![]),_0x242dd2(_0x3b3f25[_0x5253cb(0xb3)]));}catch(_0x53e02f){console[_0x5253cb(0x100)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x53e02f);}};};for(const _0x5e01e1 of _0x17ba5c){const _0x1d7f3e={'op':_0x1dcea9(0xe2),'topic':_0x1aee58,'type':_0x5e01e1};console[_0x1dcea9(0xe5)]('[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20'+_0x5e01e1),this[_0x1dcea9(0xab)][_0x1dcea9(0x115)](JSON['stringify'](_0x1d7f3e));const _0x48bbe9=_0x26708e(_0x5e01e1);this[_0x1dcea9(0xab)][_0x1dcea9(0xac)](_0x1dcea9(0xf3),_0x48bbe9),_0x53ff3b[_0x1dcea9(0xb6)]({'handler':_0x48bbe9,'type':_0x5e01e1});}return _0x3c28c1&&_0x455b30&&setTimeout(()=>{const _0x98b82e=_0x1dcea9;if(!_0x29780a){console['log']('[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20'+_0x1aee58+_0x98b82e(0x7d));const _0x3c5dd1=_0x1aee58[_0x98b82e(0xf7)](_0x98b82e(0x7e),'')[_0x98b82e(0xf7)](_0x98b82e(0xcd),''),_0x5888bc=[_0x3c5dd1+_0x98b82e(0x88),_0x3c5dd1+_0x98b82e(0xcb),_0x3c5dd1];for(const _0x5ab2f2 of _0x5888bc){console[_0x98b82e(0xe5)](_0x98b82e(0xca)+_0x5ab2f2);const _0x1db0bd={'op':_0x98b82e(0xe2),'topic':_0x5ab2f2,'type':_0x98b82e(0x104)};this[_0x98b82e(0xab)]['send'](JSON['stringify'](_0x1db0bd));const _0x257a3f=_0x358cb1=>{const _0x2691d9=_0x98b82e;try{const _0x1a8bab=JSON['parse'](_0x358cb1['data']);_0x1a8bab['op']===_0x2691d9(0xef)&&_0x1a8bab[_0x2691d9(0xd9)]===_0x5ab2f2&&_0x1a8bab[_0x2691d9(0xb3)]&&(console['log'](_0x2691d9(0xa3)+_0x5ab2f2+_0x2691d9(0x7a)),_0x1a8bab['msg'][_0x2691d9(0x130)]&&!_0x1a8bab['msg'][_0x2691d9(0x130)][_0x2691d9(0x134)]('/9j/')&&_0x242dd2(_0x1a8bab[_0x2691d9(0xb3)]));}catch(_0x24cffa){console[_0x2691d9(0x100)](_0x2691d9(0x120),_0x24cffa);}};this['rosbridgeWs'][_0x98b82e(0xac)](_0x98b82e(0xf3),_0x257a3f),_0x53ff3b[_0x98b82e(0xb6)]({'handler':_0x257a3f,'type':_0x98b82e(0x104),'topic':_0x5ab2f2});}}},0xbb8),{'unsubscribe':()=>{const _0x1b13e3=_0x1dcea9;for(const {handler:_0x47462d,type:_0x2f9d47,topic:_0x3ce130}of _0x53ff3b){this[_0x1b13e3(0xab)]['removeEventListener']('message',_0x47462d),this['rosbridgeWs']['readyState']===this[_0x1b13e3(0xab)][_0x1b13e3(0xa1)]&&this[_0x1b13e3(0xab)][_0x1b13e3(0x115)](JSON[_0x1b13e3(0xd4)]({'op':'unsubscribe','topic':_0x3ce130||_0x1aee58}));}}};}[a6_0x1d748f(0x10b)](_0x2c0a2d,_0x4c6d24){const _0x53c0e0=a6_0x1d748f;_0x4c6d24[_0x53c0e0(0xbc)]=_0x53c0e0(0xba),_0x4c6d24[_0x53c0e0(0xdd)](0x0,0x0,_0x2c0a2d[_0x53c0e0(0x11c)],_0x2c0a2d[_0x53c0e0(0x7b)]),_0x4c6d24['fillStyle']=_0x53c0e0(0x106),_0x4c6d24['font']=_0x53c0e0(0x10c),_0x4c6d24[_0x53c0e0(0x7f)]=_0x53c0e0(0x11a),_0x4c6d24['fillText'](_0x53c0e0(0x135),_0x2c0a2d[_0x53c0e0(0x11c)]/0x2,_0x2c0a2d[_0x53c0e0(0x7b)]/0x2-0x14),_0x4c6d24[_0x53c0e0(0xbc)]=_0x53c0e0(0x142),_0x4c6d24[_0x53c0e0(0xd2)]=_0x53c0e0(0x124),_0x4c6d24[_0x53c0e0(0x12f)](_0x53c0e0(0x118),_0x2c0a2d[_0x53c0e0(0x11c)]/0x2,_0x2c0a2d[_0x53c0e0(0x7b)]/0x2+0x14);const _0x4aca8d=Date[_0x53c0e0(0x11f)]()/0x3e8;for(let _0x16247c=0x0;_0x16247c<0x3;_0x16247c++){const _0xbf9de2=(Math[_0x53c0e0(0x9f)](_0x4aca8d*0x2+_0x16247c*0.5)+0x1)/0x2;_0x4c6d24[_0x53c0e0(0xbc)]=_0x53c0e0(0x81)+_0xbf9de2*0.5+')',_0x4c6d24[_0x53c0e0(0xb5)](),_0x4c6d24['arc'](_0x2c0a2d[_0x53c0e0(0x11c)]/0x2-0x28+_0x16247c*0x28,_0x2c0a2d[_0x53c0e0(0x7b)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x4c6d24[_0x53c0e0(0x140)]();}}['sendFrameToVideoSource'](_0x2efcb0,_0xa6c08a){const _0x41e9ef=a6_0x1d748f;try{if(!_0x2efcb0||!_0xa6c08a)return;const _0x48249c=_0xa6c08a['getContext']('2d'),_0x14fe75=_0x48249c[_0x41e9ef(0x107)](0x0,0x0,_0xa6c08a['width'],_0xa6c08a[_0x41e9ef(0x7b)]),_0x1f334e=this[_0x41e9ef(0x136)](_0x14fe75['data'],_0xa6c08a['width'],_0xa6c08a[_0x41e9ef(0x7b)]),_0x58a81a={'width':_0xa6c08a['width'],'height':_0xa6c08a[_0x41e9ef(0x7b)],'data':_0x1f334e};typeof _0x2efcb0[_0x41e9ef(0x145)]===_0x41e9ef(0x90)&&_0x2efcb0['onFrame'](_0x58a81a);}catch(_0x94c757){console['error'](_0x41e9ef(0xbe),_0x94c757);}}[a6_0x1d748f(0x136)](_0x2ce611,_0x42c39e,_0x53b1fe){const _0x4e3827=a6_0x1d748f,_0x23753f=_0x42c39e*_0x53b1fe,_0x51a7f9=_0x42c39e*_0x53b1fe/0x4,_0x123289=new Uint8Array(_0x23753f+_0x51a7f9*0x2);let _0x463f47=0x0,_0xce1e46=_0x23753f,_0x14c898=_0x23753f+_0x51a7f9;for(let _0x456d72=0x0;_0x456d72<_0x53b1fe;_0x456d72++){for(let _0x3fc832=0x0;_0x3fc832<_0x42c39e;_0x3fc832++){const _0xa4c664=(_0x456d72*_0x42c39e+_0x3fc832)*0x4,_0x38ae13=_0x2ce611[_0xa4c664],_0x36ab2b=_0x2ce611[_0xa4c664+0x1],_0x5ecaca=_0x2ce611[_0xa4c664+0x2],_0x159e45=Math[_0x4e3827(0x112)](0.299*_0x38ae13+0.587*_0x36ab2b+0.114*_0x5ecaca);_0x123289[_0x463f47++]=_0x159e45;if(_0x456d72%0x2===0x0&&_0x3fc832%0x2===0x0){const _0x1abbd6=Math['round'](-0.169*_0x38ae13-0.331*_0x36ab2b+0.5*_0x5ecaca+0x80),_0x43a0da=Math[_0x4e3827(0x112)](0.5*_0x38ae13-0.419*_0x36ab2b-0.081*_0x5ecaca+0x80);_0x123289[_0xce1e46++]=Math[_0x4e3827(0x147)](0x0,Math[_0x4e3827(0x138)](0xff,_0x1abbd6)),_0x123289[_0x14c898++]=Math[_0x4e3827(0x147)](0x0,Math[_0x4e3827(0x138)](0xff,_0x43a0da));}}}return _0x123289;}async[a6_0x1d748f(0x84)](_0x541c77,_0x952a31,_0x5ac6b7,_0x1f9d78,_0x5b604a){const _0x13d1b1=a6_0x1d748f;try{if(!_0x5ac6b7||!_0x5ac6b7[_0x13d1b1(0x130)])return;Math['random']()<0.01&&console['log']('[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20'+_0x1f9d78+_0x13d1b1(0xcf)+_0x5ac6b7[_0x13d1b1(0x130)][_0x13d1b1(0x12d)]+_0x13d1b1(0xdf));const _0x70551f=Buffer['from'](_0x5ac6b7[_0x13d1b1(0x130)],'base64'),_0x304c05=this[_0x13d1b1(0x117)][_0x13d1b1(0xe4)](_0x1f9d78);let _0x2f9365;_0x304c05?_0x2f9365=await this[_0x13d1b1(0x117)]['processDepthImage'](_0x70551f,_0x541c77,_0x952a31,_0x1f9d78):_0x2f9365=await this[_0x13d1b1(0x117)][_0x13d1b1(0xdb)](_0x70551f,_0x541c77,_0x952a31),_0x952a31[_0x13d1b1(0x9e)](_0x2f9365,0x0,0x0),_0x952a31[_0x13d1b1(0xbc)]=_0x13d1b1(0x146),_0x952a31[_0x13d1b1(0xdd)](0xa,0xa,0xdc,0x32),_0x952a31[_0x13d1b1(0xbc)]=_0x304c05?_0x13d1b1(0xae):'#00ff00',_0x952a31['font']=_0x13d1b1(0xb9),_0x952a31['fillText']((_0x304c05?'🔍\x20Depth':_0x13d1b1(0xbf))+':\x20'+new Date()['toLocaleTimeString'](),0xf,0x1c),_0x952a31[_0x13d1b1(0xbc)]=_0x13d1b1(0x142),_0x952a31[_0x13d1b1(0xd2)]=_0x13d1b1(0x97),_0x952a31['fillText'](_0x13d1b1(0x78)+_0x1f9d78[_0x13d1b1(0x82)]('/')[_0x13d1b1(0x113)](),0xf,0x2d),this[_0x13d1b1(0x13a)](_0x5b604a,_0x541c77);}catch(_0x3bcaf7){console[_0x13d1b1(0xfd)](_0x13d1b1(0xe1)+_0x1f9d78+':',_0x3bcaf7[_0x13d1b1(0xf3)]);_0x1f9d78[_0x13d1b1(0x92)]('depth')&&Math['random']()<0.1&&console[_0x13d1b1(0xfd)](_0x13d1b1(0xed)+_0x1f9d78[_0x13d1b1(0xf7)](_0x13d1b1(0x7e),_0x13d1b1(0x88)));_0x952a31[_0x13d1b1(0xbc)]=_0x13d1b1(0xba),_0x952a31[_0x13d1b1(0xdd)](0x0,0x0,_0x541c77[_0x13d1b1(0x11c)],_0x541c77[_0x13d1b1(0x7b)]),_0x952a31[_0x13d1b1(0xbc)]='#888',_0x952a31[_0x13d1b1(0xd2)]=_0x13d1b1(0x124),_0x952a31[_0x13d1b1(0x7f)]=_0x13d1b1(0x11a);const _0x1722d9=_0x1f9d78['includes'](_0x13d1b1(0x132))?_0x13d1b1(0x141):_0x13d1b1(0xfc);_0x952a31[_0x13d1b1(0x12f)](_0x1722d9,_0x541c77[_0x13d1b1(0x11c)]/0x2,_0x541c77['height']/0x2),_0x952a31[_0x13d1b1(0xbc)]=_0x13d1b1(0xc2),_0x952a31[_0x13d1b1(0xd2)]=_0x13d1b1(0xc0),_0x952a31[_0x13d1b1(0x12f)](_0x13d1b1(0x78)+_0x1f9d78[_0x13d1b1(0x82)]('/')['pop'](),_0x541c77[_0x13d1b1(0x11c)]/0x2,_0x541c77[_0x13d1b1(0x7b)]/0x2+0x19),this[_0x13d1b1(0x13a)](_0x5b604a,_0x541c77);}}['stopSession'](_0x24a2b7){const _0x8096aa=a6_0x1d748f,_0x158b2a=this[_0x8096aa(0xc9)]['get'](_0x24a2b7);if(!_0x158b2a){console[_0x8096aa(0xfd)](_0x8096aa(0xd8)+_0x24a2b7);return;}console[_0x8096aa(0xe5)](_0x8096aa(0xc8)+_0x24a2b7+_0x8096aa(0x101)+_0x158b2a[_0x8096aa(0xd9)]);try{this[_0x8096aa(0xb4)]&&this[_0x8096aa(0xb4)][_0x8096aa(0x9d)]===this[_0x8096aa(0xb4)][_0x8096aa(0xa1)]&&this[_0x8096aa(0xb4)]['send'](JSON[_0x8096aa(0xd4)]({'op':_0x8096aa(0xe6),'session_id':_0x24a2b7})),_0x158b2a[_0x8096aa(0xea)]&&_0x158b2a['videoTrack']['stop'](),_0x158b2a[_0x8096aa(0x79)]&&_0x158b2a[_0x8096aa(0x79)][_0x8096aa(0xf2)]();}catch(_0x336dc2){console['error'](_0x8096aa(0xf5)+_0x336dc2);}this[_0x8096aa(0xff)](_0x24a2b7);}['cleanupSession'](_0x3e47ea){const _0x57a800=a6_0x1d748f,_0x1bbe9f=this['activeSessions'][_0x57a800(0x144)](_0x3e47ea);if(_0x1bbe9f){const _0x12e6b8=this[_0x57a800(0xce)]['get'](_0x1bbe9f[_0x57a800(0xd9)]);_0x12e6b8&&(_0x12e6b8[_0x57a800(0x127)](_0x3e47ea),_0x12e6b8[_0x57a800(0xc6)]===0x0&&this[_0x57a800(0xce)]['delete'](_0x1bbe9f['topic'])),this[_0x57a800(0x89)](_0x1bbe9f[_0x57a800(0xd9)]);}this[_0x57a800(0xc9)][_0x57a800(0x127)](_0x3e47ea),console[_0x57a800(0xe5)](_0x57a800(0x13e)+_0x3e47ea);}[a6_0x1d748f(0xee)](){const _0x10dce2=a6_0x1d748f;console[_0x10dce2(0xe5)](_0x10dce2(0xeb));const _0x2a9acf=Array[_0x10dce2(0x9c)](this[_0x10dce2(0xc9)][_0x10dce2(0x109)]());_0x2a9acf['forEach'](_0x41700a=>this['stopSession'](_0x41700a));}[a6_0x1d748f(0x121)](){const _0x58869f=a6_0x1d748f,_0x4a2f75=[];for(const [_0x46170b,_0x360be8]of this[_0x58869f(0xc9)]){_0x4a2f75['push']({'sessionId':_0x46170b,'topic':_0x360be8['topic'],'connectionState':_0x360be8[_0x58869f(0x79)]?.[_0x58869f(0xf8)]||_0x58869f(0x13c),'hasVideoTrack':!!_0x360be8['videoTrack']});}return _0x4a2f75;}[a6_0x1d748f(0x116)](){const _0x1f6549=a6_0x1d748f,_0x509f0c=[];for(const [_0x2504c1,_0xbb6e9]of this[_0x1f6549(0xaa)]){_0x509f0c['push']({'topic':_0x2504c1,'frameCount':_0xbb6e9[_0x1f6549(0xb8)],'hasVideoSource':!!_0xbb6e9[_0x1f6549(0xa5)],'hasRosSubscriber':!!_0xbb6e9[_0x1f6549(0xbd)]});}return _0x509f0c;}}module['exports']=new ApplianceWebRTCService();