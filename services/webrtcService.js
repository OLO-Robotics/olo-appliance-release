const a6_0x596fbe=a6_0x1ebe;(function(_0x13e248,_0x134ae5){const _0x158f5e=a6_0x1ebe,_0x431e7d=_0x13e248();while(!![]){try{const _0x5b6c3c=-parseInt(_0x158f5e(0x1e3))/0x1*(-parseInt(_0x158f5e(0x18e))/0x2)+-parseInt(_0x158f5e(0x1cf))/0x3*(-parseInt(_0x158f5e(0x1c2))/0x4)+parseInt(_0x158f5e(0x153))/0x5+-parseInt(_0x158f5e(0x17a))/0x6*(-parseInt(_0x158f5e(0x134))/0x7)+-parseInt(_0x158f5e(0x199))/0x8+-parseInt(_0x158f5e(0x1f6))/0x9+-parseInt(_0x158f5e(0x19a))/0xa;if(_0x5b6c3c===_0x134ae5)break;else _0x431e7d['push'](_0x431e7d['shift']());}catch(_0xb0e9a7){_0x431e7d['push'](_0x431e7d['shift']());}}}(a6_0x36a8,0xf3833));const a6_0x492ea4=(function(){let _0x404ca1=!![];return function(_0x4f2505,_0x59f6ba){const _0x1ec817=_0x404ca1?function(){const _0x1a9641=a6_0x1ebe;if(_0x59f6ba){const _0xc6b362=_0x59f6ba[_0x1a9641(0x16e)](_0x4f2505,arguments);return _0x59f6ba=null,_0xc6b362;}}:function(){};return _0x404ca1=![],_0x1ec817;};}()),a6_0x488df0=a6_0x492ea4(this,function(){const _0x1e358d=a6_0x1ebe;return a6_0x488df0[_0x1e358d(0x1f5)]()[_0x1e358d(0x198)](_0x1e358d(0x1ee))[_0x1e358d(0x1f5)]()[_0x1e358d(0x1f1)](a6_0x488df0)[_0x1e358d(0x198)](_0x1e358d(0x1ee));});a6_0x488df0();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x596fbe(0x1f2)),sharp=require(a6_0x596fbe(0x1d8)),config=require(a6_0x596fbe(0x1d3)),DepthImageProcessor=require(a6_0x596fbe(0x1fd)),turnCredentialsService=require('./turnCredentialsService');function a6_0x36a8(){const _0x47baa8=['getActiveSessions','startsWith','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','fillStyle','4048179ubdSWJ','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','sensor_msgs/msg/Image','processDepthImage','../config','log','rosSubscriber','fillText','toLocaleTimeString','sharp','height','publish','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','videoSource','type','rtcConfig','isDepthTopic','warn','compressedDepth','4rMaINa','initializeSession','fillRect','depth','forEach','sin','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','msg','round','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','from','(((.+)+)+)+$','center','base64','constructor','wrtc','sharedVideoSources','handleIceCandidate','toString','8621766IItChm','beginPath','/image_raw','delete','rgba(0,\x200,\x200,\x200.7)','12px\x20Arial','addEventListener','./DepthImageProcessor','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','onFrame','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','exports','peerConnection','includes','drawLoadingPattern','onconnectionstatechange','push','63lQeKnI','min','OPEN','sensor_msgs/Image','sendFrameToVideoSource','\x20connection\x20state:\x20','onicecandidate','[WebRTC\x20Appliance]\x20Created\x20answer','pop','#00aaff','📹\x20Processing\x20video...','address','video','iceServers','stringify','16px\x20Arial','createTrack','webrtc_stop_session','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','parse','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','subscribe','cleanupSession','webrtc_offer','split','max','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','\x20for\x20topic\x20','canvas','set','length','6647985zbuhaV','\x20initialized\x20successfully','#666','serverWs','readyState','connectionState','activeSessions','convertRGBAtoI420','updateTurnCredentials','width','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','replace','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','offer','has','webrtc','topic','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)',',\x20trying\x20alternative\x20depth\x20topics','data','#ffffff','serverUrl','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','color','failed','apply','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','sensor_msgs/msg/CompressedImage','[WebRTC\x20Appliance]\x20Service\x20initialized','textAlign','getSharedVideoSources','compressed','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','/9j/','port','frameCount','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','312306EVxghN','handleMessage','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','putImageData','12px\x20monospace','updateCanvasWithImageData','\x20successfully\x20connected!','[WebRTC\x20Appliance]\x20Session\x20','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','\x20for\x20topic:\x20','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','handleOffer','\x20image,\x20trying\x20message\x20types:','unsubscribe','#00ff00','stopAllSessions','rosbridgeWs','getImageData','size','depthProcessor','135238RmmigK','now','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','font','🤖\x20Robot\x20Camera','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','Topic:\x20','releaseSharedVideoSource','search','1008808FMNdzL','13364230TxDVMr','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','stun:stun1.l.google.com:19302','unknown','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','candidate','#1a1a1a','session_id','setRemoteDescription','get','keys','sensor_msgs/CompressedImage',',\x20converting\x20to\x20base64...','\x20sessions\x20remaining)','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','webrtc_answer','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','videoTrack','removeEventListener','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','stopSession','\x20connection\x20closed,\x20cleaning\x20up','\x20with\x20message\x20type\x20','random','/compressedDepth','message','\x20connection\x20failed,\x20stopping\x20session','/compressed','initialize','/image','webrtc_ice_candidate','send','stop','subscribeToROSTopic','addTrack','webrtc_init_session','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','\x20bytes','function','getOrCreateSharedVideoSource','4KCDzZU','error','setLocalDescription','Waiting\x20for\x20ROS\x20image\x20data...','topicSessions','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','#00ffff','fill','framerate'];a6_0x36a8=function(){return _0x47baa8;};return a6_0x36a8();}class ApplianceWebRTCService{constructor(){const _0x43b7b0=a6_0x596fbe;this[_0x43b7b0(0x159)]=new Map(),this[_0x43b7b0(0x1c6)]=new Map(),this['sharedVideoSources']=new Map(),this['rosbridgeWs']=null,this['serverWs']=null,this[_0x43b7b0(0x18d)]=new DepthImageProcessor(),this[_0x43b7b0(0x1df)]={'iceServers':[{'urls':'stun:stun.l.google.com:19302'},{'urls':_0x43b7b0(0x19c)}]};}[a6_0x596fbe(0x1b6)](_0x54f83c,_0x1067f8){const _0xd46402=a6_0x596fbe;this[_0xd46402(0x18a)]=_0x54f83c,this['serverWs']=_0x1067f8,turnCredentialsService[_0xd46402(0x1b6)](config[_0xd46402(0x16a)]),this[_0xd46402(0x15b)](),console[_0xd46402(0x1d4)](_0xd46402(0x171));}async[a6_0x596fbe(0x15b)](){const _0x1e8449=a6_0x596fbe;try{console[_0x1e8449(0x1d4)]('[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...');const _0x54cba5=await turnCredentialsService['getIceServers']();this[_0x1e8449(0x1df)][_0x1e8449(0x141)]=_0x54cba5,console[_0x1e8449(0x1d4)](_0x1e8449(0x175));}catch(_0x1c08fe){console['error']('[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:',_0x1c08fe),console[_0x1e8449(0x1d4)](_0x1e8449(0x190));}}[a6_0x596fbe(0x17b)](_0x54a9ae){const _0x440fc4=a6_0x596fbe;if(!_0x54a9ae['op']||!_0x54a9ae['op'][_0x440fc4(0x1cc)]('webrtc_'))return![];console[_0x440fc4(0x1d4)](_0x440fc4(0x16b)+_0x54a9ae['op']);switch(_0x54a9ae['op']){case _0x440fc4(0x1bd):this[_0x440fc4(0x1e4)](_0x54a9ae[_0x440fc4(0x1a1)],_0x54a9ae[_0x440fc4(0x163)]);return!![];case _0x440fc4(0x14b):this[_0x440fc4(0x185)](_0x54a9ae[_0x440fc4(0x1a1)],_0x54a9ae[_0x440fc4(0x160)]);return!![];case'webrtc_ice_candidate':this['handleIceCandidate'](_0x54a9ae[_0x440fc4(0x1a1)],_0x54a9ae['candidate']);return!![];case _0x440fc4(0x145):this[_0x440fc4(0x1ae)](_0x54a9ae[_0x440fc4(0x1a1)]);return!![];default:console[_0x440fc4(0x1e1)](_0x440fc4(0x16f)+_0x54a9ae['op']);return![];}}[a6_0x596fbe(0x1c1)](_0x48047c){const _0x3dbc77=a6_0x596fbe;if(this[_0x3dbc77(0x1f3)][_0x3dbc77(0x161)](_0x48047c)){const _0x3c9294=this[_0x3dbc77(0x1f3)][_0x3dbc77(0x1a3)](_0x48047c);return _0x3c9294[_0x3dbc77(0x178)]++,console[_0x3dbc77(0x1d4)](_0x3dbc77(0x1ec)+_0x48047c+'\x20('+_0x3c9294['frameCount']+'\x20sessions)'),_0x3c9294;}console[_0x3dbc77(0x1d4)](_0x3dbc77(0x179)+_0x48047c);const {createCanvas:_0x1fcff8}=require('canvas'),_0x3c4851=_0x1fcff8(config[_0x3dbc77(0x162)][_0x3dbc77(0x140)][_0x3dbc77(0x15c)],config[_0x3dbc77(0x162)][_0x3dbc77(0x140)]['height']),_0x192779=_0x3c4851['getContext']('2d');this[_0x3dbc77(0x204)](_0x3c4851,_0x192779);const {RTCVideoSource:_0x59dcab}=nonstandard,_0x13894d=new _0x59dcab();let _0x54efd2=0x0;const _0xc8046e=0x3e8/config['webrtc'][_0x3dbc77(0x140)]['framerate'],_0x9f335d=this[_0x3dbc77(0x1bb)](_0x48047c,_0x4ffc10=>{const _0x36d27a=_0x3dbc77,_0x2b1505=Date['now']();_0x2b1505-_0x54efd2>=_0xc8046e&&(_0x54efd2=_0x2b1505,this[_0x36d27a(0x17f)](_0x3c4851,_0x192779,_0x4ffc10,_0x48047c,_0x13894d));}),_0xc3f2a1={'videoSource':_0x13894d,'canvas':_0x3c4851,'rosSubscriber':_0x9f335d,'frameCount':0x1,'topic':_0x48047c};return this[_0x3dbc77(0x1f3)]['set'](_0x48047c,_0xc3f2a1),_0xc3f2a1;}[a6_0x596fbe(0x197)](_0x16920a){const _0x4a732c=a6_0x596fbe,_0x173f3a=this['sharedVideoSources'][_0x4a732c(0x1a3)](_0x16920a);if(!_0x173f3a)return;_0x173f3a[_0x4a732c(0x178)]--,console[_0x4a732c(0x1d4)](_0x4a732c(0x1aa)+_0x16920a+'\x20('+_0x173f3a[_0x4a732c(0x178)]+_0x4a732c(0x1a7)),_0x173f3a[_0x4a732c(0x178)]<=0x0&&(console[_0x4a732c(0x1d4)](_0x4a732c(0x15d)+_0x16920a+',\x20cleaning\x20up\x20shared\x20resources'),_0x173f3a[_0x4a732c(0x1dd)]&&(_0x173f3a[_0x4a732c(0x1dd)]=null),_0x173f3a[_0x4a732c(0x1d5)]&&_0x173f3a[_0x4a732c(0x1d5)][_0x4a732c(0x187)](),this['sharedVideoSources'][_0x4a732c(0x1f9)](_0x16920a));}async['initializeSession'](_0x67bd72,_0x732553){const _0x46077e=a6_0x596fbe;try{console[_0x46077e(0x1d4)](_0x46077e(0x164)+_0x67bd72+_0x46077e(0x14f)+_0x732553);const _0x5a0df0=this[_0x46077e(0x1c1)](_0x732553),_0x3e1561=new RTCPeerConnection(this[_0x46077e(0x1df)]),_0x55a488=_0x5a0df0['videoSource'][_0x46077e(0x144)]({'width':config[_0x46077e(0x162)][_0x46077e(0x140)]['width'],'height':config[_0x46077e(0x162)][_0x46077e(0x140)][_0x46077e(0x1d9)],'framerate':config[_0x46077e(0x162)][_0x46077e(0x140)][_0x46077e(0x1ca)]});console['log'](_0x46077e(0x1c7)+_0x67bd72);const {MediaStream:_0x27a376}=require(_0x46077e(0x1f2)),_0x27e7b7=new _0x27a376([_0x55a488]);_0x3e1561[_0x46077e(0x1bc)](_0x55a488,_0x27e7b7),this[_0x46077e(0x138)](_0x5a0df0[_0x46077e(0x1dd)],_0x5a0df0[_0x46077e(0x150)]),_0x3e1561[_0x46077e(0x13a)]=_0x3b7b18=>{const _0x34c563=_0x46077e;if(_0x3b7b18[_0x34c563(0x19f)]&&this[_0x34c563(0x156)])console[_0x34c563(0x1d4)](_0x34c563(0x1cd)+_0x67bd72+':',{'type':_0x3b7b18['candidate'][_0x34c563(0x1de)],'protocol':_0x3b7b18[_0x34c563(0x19f)]['protocol'],'address':_0x3b7b18[_0x34c563(0x19f)][_0x34c563(0x13f)],'port':_0x3b7b18[_0x34c563(0x19f)][_0x34c563(0x177)]}),this['serverWs']['send'](JSON[_0x34c563(0x142)]({'op':_0x34c563(0x1b8),'session_id':_0x67bd72,'candidate':_0x3b7b18[_0x34c563(0x19f)]}));else!_0x3b7b18[_0x34c563(0x19f)]&&console[_0x34c563(0x1d4)](_0x34c563(0x195)+_0x67bd72);},_0x3e1561[_0x46077e(0x205)]=()=>{const _0x528d98=_0x46077e;console[_0x528d98(0x1d4)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x67bd72+_0x528d98(0x139)+_0x3e1561[_0x528d98(0x158)]);if(_0x3e1561[_0x528d98(0x158)]==='connected')console[_0x528d98(0x1d4)](_0x528d98(0x181)+_0x67bd72+_0x528d98(0x180));else{if(_0x3e1561[_0x528d98(0x158)]===_0x528d98(0x16d))console[_0x528d98(0x1d4)](_0x528d98(0x181)+_0x67bd72+_0x528d98(0x1b4)),this['stopSession'](_0x67bd72);else _0x3e1561[_0x528d98(0x158)]==='closed'&&(console[_0x528d98(0x1d4)](_0x528d98(0x181)+_0x67bd72+_0x528d98(0x1af)),this[_0x528d98(0x14a)](_0x67bd72));}},this[_0x46077e(0x159)][_0x46077e(0x151)](_0x67bd72,{'peerConnection':_0x3e1561,'topic':_0x732553,'videoTrack':_0x55a488,'mediaStream':_0x27e7b7,'status':'initializing'}),!this[_0x46077e(0x1c6)][_0x46077e(0x161)](_0x732553)&&this[_0x46077e(0x1c6)]['set'](_0x732553,new Set()),this[_0x46077e(0x1c6)][_0x46077e(0x1a3)](_0x732553)['add'](_0x67bd72),console[_0x46077e(0x1d4)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x67bd72+_0x46077e(0x154)),console['log']('[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20'+_0x732553+':\x20'+this[_0x46077e(0x1c6)][_0x46077e(0x1a3)](_0x732553)[_0x46077e(0x18c)]);}catch(_0x14a399){console[_0x46077e(0x1c3)](_0x46077e(0x193)+_0x67bd72+':',_0x14a399),this[_0x46077e(0x1ae)](_0x67bd72);}}async[a6_0x596fbe(0x185)](_0x4b81e4,_0x43d4e4){const _0x11c4c4=a6_0x596fbe,_0x43eae1=this[_0x11c4c4(0x159)]['get'](_0x4b81e4);if(!_0x43eae1){console[_0x11c4c4(0x1c3)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20'+_0x4b81e4);return;}try{console[_0x11c4c4(0x1d4)](_0x11c4c4(0x1be)+_0x4b81e4),await _0x43eae1['peerConnection'][_0x11c4c4(0x1a2)](new RTCSessionDescription(_0x43d4e4)),console[_0x11c4c4(0x1d4)]('[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)');const _0x8c4a1e=await _0x43eae1[_0x11c4c4(0x202)]['createAnswer']();console['log'](_0x11c4c4(0x13b)),await _0x43eae1[_0x11c4c4(0x202)][_0x11c4c4(0x1c4)](_0x8c4a1e),console[_0x11c4c4(0x1d4)](_0x11c4c4(0x166)),this[_0x11c4c4(0x156)]&&(this['serverWs']['send'](JSON[_0x11c4c4(0x142)]({'op':_0x11c4c4(0x1a9),'session_id':_0x4b81e4,'answer':_0x8c4a1e})),console['log']('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0x4b81e4));}catch(_0x562eb0){console['error'](_0x11c4c4(0x1d0)+_0x4b81e4+':',_0x562eb0),this[_0x11c4c4(0x1ae)](_0x4b81e4);}}async[a6_0x596fbe(0x1f4)](_0x2fd77c,_0x4a9891){const _0x42eefc=a6_0x596fbe,_0x2dee62=this[_0x42eefc(0x159)]['get'](_0x2fd77c);if(!_0x2dee62){console['error']('[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20'+_0x2fd77c);return;}try{await _0x2dee62[_0x42eefc(0x202)]['addIceCandidate'](new RTCIceCandidate(_0x4a9891)),console[_0x42eefc(0x1d4)](_0x42eefc(0x1db)+_0x2fd77c);}catch(_0x298962){console['error'](_0x42eefc(0x1fe)+_0x2fd77c+':',_0x298962);}}['subscribeToROSTopic'](_0x3b357c,_0x4b839e){const _0x3a329b=a6_0x596fbe;if(!this[_0x3a329b(0x18a)]||this[_0x3a329b(0x18a)][_0x3a329b(0x157)]!==this['rosbridgeWs'][_0x3a329b(0x136)])return console['error'](_0x3a329b(0x14e)),null;console[_0x3a329b(0x1d4)](_0x3a329b(0x17c)+_0x3b357c);const _0x502189=_0x3b357c['includes'](_0x3a329b(0x1e6)),_0x32e6bd=_0x3b357c[_0x3a329b(0x203)](_0x3a329b(0x174))||_0x3b357c[_0x3a329b(0x203)](_0x3a329b(0x1e2));let _0x181c6c=[];_0x502189?_0x32e6bd?_0x181c6c=['sensor_msgs/CompressedImage',_0x3a329b(0x170),'compressed_depth_image_transport/CompressedDepthImage','sensor_msgs/Image']:_0x181c6c=[_0x3a329b(0x137),_0x3a329b(0x1d1),'sensor_msgs/CompressedImage']:_0x181c6c=[_0x3a329b(0x1a5),_0x3a329b(0x170),_0x3a329b(0x137)];console[_0x3a329b(0x1d4)]('[WebRTC\x20Appliance]\x20Topic\x20'+_0x3b357c+'\x20detected\x20as\x20'+(_0x502189?_0x3a329b(0x1e6):_0x3a329b(0x16c))+_0x3a329b(0x186),_0x181c6c);const _0x10a4d5=[];let _0x546db7=![];const _0x76b9c2=_0x515c3b=>{return _0x2897e1=>{const _0xcec11d=a6_0x1ebe;try{const _0x5d3578=JSON[_0xcec11d(0x147)](_0x2897e1[_0xcec11d(0x168)]);_0x5d3578['op']===_0xcec11d(0x1da)&&_0x5d3578['topic']===_0x3b357c&&_0x5d3578['msg']&&(!_0x546db7&&(console[_0xcec11d(0x1d4)](_0xcec11d(0x148)+_0x3b357c+_0xcec11d(0x1b0)+_0x515c3b),_0x546db7=!![]),_0x4b839e(_0x5d3578[_0xcec11d(0x1ea)]));}catch(_0x492396){console[_0xcec11d(0x1c3)](_0xcec11d(0x184),_0x492396);}};};for(const _0x9e4951 of _0x181c6c){const _0x178d2c={'op':_0x3a329b(0x149),'topic':_0x3b357c,'type':_0x9e4951};console[_0x3a329b(0x1d4)](_0x3a329b(0x182)+_0x9e4951),this[_0x3a329b(0x18a)][_0x3a329b(0x1b9)](JSON[_0x3a329b(0x142)](_0x178d2c));const _0x24f65e=_0x76b9c2(_0x9e4951);this['rosbridgeWs'][_0x3a329b(0x1fc)](_0x3a329b(0x1b3),_0x24f65e),_0x10a4d5[_0x3a329b(0x206)]({'handler':_0x24f65e,'type':_0x9e4951});}return _0x502189&&_0x32e6bd&&setTimeout(()=>{const _0x39bcfd=_0x3a329b;if(!_0x546db7){console[_0x39bcfd(0x1d4)](_0x39bcfd(0x1e9)+_0x3b357c+_0x39bcfd(0x167));const _0x3db9e8=_0x3b357c[_0x39bcfd(0x15e)](_0x39bcfd(0x1b2),'')[_0x39bcfd(0x15e)](_0x39bcfd(0x1b5),''),_0x309128=[_0x3db9e8+_0x39bcfd(0x1f8),_0x3db9e8+_0x39bcfd(0x1b7),_0x3db9e8];for(const _0x247dbb of _0x309128){console[_0x39bcfd(0x1d4)](_0x39bcfd(0x146)+_0x247dbb);const _0x25d3ad={'op':_0x39bcfd(0x149),'topic':_0x247dbb,'type':_0x39bcfd(0x137)};this[_0x39bcfd(0x18a)][_0x39bcfd(0x1b9)](JSON['stringify'](_0x25d3ad));const _0xb7d2e3=_0x472ff1=>{const _0x1e96d7=_0x39bcfd;try{const _0x20fbfd=JSON[_0x1e96d7(0x147)](_0x472ff1[_0x1e96d7(0x168)]);_0x20fbfd['op']==='publish'&&_0x20fbfd['topic']===_0x247dbb&&_0x20fbfd[_0x1e96d7(0x1ea)]&&(console[_0x1e96d7(0x1d4)](_0x1e96d7(0x1dc)+_0x247dbb+_0x1e96d7(0x1a6)),_0x20fbfd[_0x1e96d7(0x1ea)][_0x1e96d7(0x168)]&&!_0x20fbfd['msg'][_0x1e96d7(0x168)][_0x1e96d7(0x1cc)](_0x1e96d7(0x176))&&_0x4b839e(_0x20fbfd['msg']));}catch(_0x113bb5){console[_0x1e96d7(0x1c3)](_0x1e96d7(0x200),_0x113bb5);}};this['rosbridgeWs'][_0x39bcfd(0x1fc)](_0x39bcfd(0x1b3),_0xb7d2e3),_0x10a4d5[_0x39bcfd(0x206)]({'handler':_0xb7d2e3,'type':_0x39bcfd(0x137),'topic':_0x247dbb});}}},0xbb8),{'unsubscribe':()=>{const _0x541b0f=_0x3a329b;for(const {handler:_0x52632d,type:_0x3d0117,topic:_0x1ab1d5}of _0x10a4d5){this['rosbridgeWs'][_0x541b0f(0x1ac)]('message',_0x52632d),this[_0x541b0f(0x18a)][_0x541b0f(0x157)]===this[_0x541b0f(0x18a)][_0x541b0f(0x136)]&&this[_0x541b0f(0x18a)][_0x541b0f(0x1b9)](JSON[_0x541b0f(0x142)]({'op':_0x541b0f(0x187),'topic':_0x1ab1d5||_0x3b357c}));}}};}['drawLoadingPattern'](_0x589e20,_0xe0ef1a){const _0xced4ed=a6_0x596fbe;_0xe0ef1a[_0xced4ed(0x1ce)]=_0xced4ed(0x1a0),_0xe0ef1a[_0xced4ed(0x1e5)](0x0,0x0,_0x589e20[_0xced4ed(0x15c)],_0x589e20[_0xced4ed(0x1d9)]),_0xe0ef1a[_0xced4ed(0x1ce)]=_0xced4ed(0x13d),_0xe0ef1a[_0xced4ed(0x191)]='24px\x20Arial',_0xe0ef1a[_0xced4ed(0x172)]=_0xced4ed(0x1ef),_0xe0ef1a[_0xced4ed(0x1d6)](_0xced4ed(0x192),_0x589e20[_0xced4ed(0x15c)]/0x2,_0x589e20[_0xced4ed(0x1d9)]/0x2-0x14),_0xe0ef1a[_0xced4ed(0x1ce)]=_0xced4ed(0x169),_0xe0ef1a['font']=_0xced4ed(0x143),_0xe0ef1a[_0xced4ed(0x1d6)](_0xced4ed(0x1c5),_0x589e20[_0xced4ed(0x15c)]/0x2,_0x589e20[_0xced4ed(0x1d9)]/0x2+0x14);const _0x575452=Date[_0xced4ed(0x18f)]()/0x3e8;for(let _0x35087e=0x0;_0x35087e<0x3;_0x35087e++){const _0x5a42e6=(Math[_0xced4ed(0x1e8)](_0x575452*0x2+_0x35087e*0.5)+0x1)/0x2;_0xe0ef1a[_0xced4ed(0x1ce)]='rgba(0,\x20170,\x20255,\x20'+_0x5a42e6*0.5+')',_0xe0ef1a[_0xced4ed(0x1f7)](),_0xe0ef1a['arc'](_0x589e20[_0xced4ed(0x15c)]/0x2-0x28+_0x35087e*0x28,_0x589e20[_0xced4ed(0x1d9)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0xe0ef1a[_0xced4ed(0x1c9)]();}}[a6_0x596fbe(0x138)](_0x30ba59,_0x4b2541){const _0x455480=a6_0x596fbe;try{if(!_0x30ba59||!_0x4b2541)return;const _0x47f9d0=_0x4b2541['getContext']('2d'),_0x3e11a2=_0x47f9d0[_0x455480(0x18b)](0x0,0x0,_0x4b2541[_0x455480(0x15c)],_0x4b2541[_0x455480(0x1d9)]),_0x320a38=this[_0x455480(0x15a)](_0x3e11a2[_0x455480(0x168)],_0x4b2541[_0x455480(0x15c)],_0x4b2541['height']),_0xcde19e={'width':_0x4b2541['width'],'height':_0x4b2541[_0x455480(0x1d9)],'data':_0x320a38};typeof _0x30ba59[_0x455480(0x1ff)]===_0x455480(0x1c0)&&_0x30ba59[_0x455480(0x1ff)](_0xcde19e);}catch(_0x5380a7){console[_0x455480(0x1c3)](_0x455480(0x165),_0x5380a7);}}[a6_0x596fbe(0x15a)](_0x3e9204,_0x3018ed,_0xdca66e){const _0x3b8109=a6_0x596fbe,_0x56a10a=_0x3018ed*_0xdca66e,_0x22f255=_0x3018ed*_0xdca66e/0x4,_0x3e99cf=new Uint8Array(_0x56a10a+_0x22f255*0x2);let _0x48ee6d=0x0,_0x3b5f1b=_0x56a10a,_0x56a4e0=_0x56a10a+_0x22f255;for(let _0x2d7ffd=0x0;_0x2d7ffd<_0xdca66e;_0x2d7ffd++){for(let _0x9e4b9c=0x0;_0x9e4b9c<_0x3018ed;_0x9e4b9c++){const _0x4b2c27=(_0x2d7ffd*_0x3018ed+_0x9e4b9c)*0x4,_0x1e76de=_0x3e9204[_0x4b2c27],_0xe9e4ae=_0x3e9204[_0x4b2c27+0x1],_0x5adf25=_0x3e9204[_0x4b2c27+0x2],_0x222e31=Math[_0x3b8109(0x1eb)](0.299*_0x1e76de+0.587*_0xe9e4ae+0.114*_0x5adf25);_0x3e99cf[_0x48ee6d++]=_0x222e31;if(_0x2d7ffd%0x2===0x0&&_0x9e4b9c%0x2===0x0){const _0x437fd8=Math[_0x3b8109(0x1eb)](-0.169*_0x1e76de-0.331*_0xe9e4ae+0.5*_0x5adf25+0x80),_0x2478d7=Math[_0x3b8109(0x1eb)](0.5*_0x1e76de-0.419*_0xe9e4ae-0.081*_0x5adf25+0x80);_0x3e99cf[_0x3b5f1b++]=Math[_0x3b8109(0x14d)](0x0,Math[_0x3b8109(0x135)](0xff,_0x437fd8)),_0x3e99cf[_0x56a4e0++]=Math[_0x3b8109(0x14d)](0x0,Math[_0x3b8109(0x135)](0xff,_0x2478d7));}}}return _0x3e99cf;}async[a6_0x596fbe(0x17f)](_0x11c17c,_0x872e78,_0x5d5d67,_0x2931f4,_0x153293){const _0x3651de=a6_0x596fbe;try{if(!_0x5d5d67||!_0x5d5d67['data'])return;Math[_0x3651de(0x1b1)]()<0.01&&console[_0x3651de(0x1d4)](_0x3651de(0x194)+_0x2931f4+',\x20size:\x20'+_0x5d5d67[_0x3651de(0x168)][_0x3651de(0x152)]+_0x3651de(0x1bf));const _0x19acd9=Buffer[_0x3651de(0x1ed)](_0x5d5d67[_0x3651de(0x168)],_0x3651de(0x1f0)),_0x1cdb81=this['depthProcessor'][_0x3651de(0x1e0)](_0x2931f4);let _0x280e5b;_0x1cdb81?_0x280e5b=await this[_0x3651de(0x18d)][_0x3651de(0x1d2)](_0x19acd9,_0x11c17c,_0x872e78,_0x2931f4):_0x280e5b=await this['depthProcessor']['processColorImage'](_0x19acd9,_0x11c17c,_0x872e78),_0x872e78[_0x3651de(0x17d)](_0x280e5b,0x0,0x0),_0x872e78[_0x3651de(0x1ce)]=_0x3651de(0x1fa),_0x872e78[_0x3651de(0x1e5)](0xa,0xa,0xdc,0x32),_0x872e78['fillStyle']=_0x1cdb81?_0x3651de(0x1c8):_0x3651de(0x188),_0x872e78[_0x3651de(0x191)]=_0x3651de(0x17e),_0x872e78[_0x3651de(0x1d6)]((_0x1cdb81?'🔍\x20Depth':'📹\x20Color')+':\x20'+new Date()[_0x3651de(0x1d7)](),0xf,0x1c),_0x872e78['fillStyle']=_0x3651de(0x169),_0x872e78[_0x3651de(0x191)]='10px\x20monospace',_0x872e78[_0x3651de(0x1d6)]('Topic:\x20'+_0x2931f4['split']('/')[_0x3651de(0x13c)](),0xf,0x2d),this[_0x3651de(0x138)](_0x153293,_0x11c17c);}catch(_0x62e179){console[_0x3651de(0x1e1)]('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x2931f4+':',_0x62e179['message']);_0x2931f4[_0x3651de(0x203)](_0x3651de(0x1e6))&&Math[_0x3651de(0x1b1)]()<0.1&&console[_0x3651de(0x1e1)](_0x3651de(0x1ad)+_0x2931f4[_0x3651de(0x15e)]('/compressedDepth',_0x3651de(0x1f8)));_0x872e78[_0x3651de(0x1ce)]=_0x3651de(0x1a0),_0x872e78['fillRect'](0x0,0x0,_0x11c17c[_0x3651de(0x15c)],_0x11c17c[_0x3651de(0x1d9)]),_0x872e78['fillStyle']='#888',_0x872e78[_0x3651de(0x191)]='16px\x20Arial',_0x872e78['textAlign']=_0x3651de(0x1ef);const _0x2bcc9a=_0x2931f4[_0x3651de(0x203)](_0x3651de(0x1e6))?'🔍\x20Processing\x20depth...':_0x3651de(0x13e);_0x872e78[_0x3651de(0x1d6)](_0x2bcc9a,_0x11c17c[_0x3651de(0x15c)]/0x2,_0x11c17c[_0x3651de(0x1d9)]/0x2),_0x872e78[_0x3651de(0x1ce)]=_0x3651de(0x155),_0x872e78[_0x3651de(0x191)]=_0x3651de(0x1fb),_0x872e78[_0x3651de(0x1d6)](_0x3651de(0x196)+_0x2931f4[_0x3651de(0x14c)]('/')[_0x3651de(0x13c)](),_0x11c17c[_0x3651de(0x15c)]/0x2,_0x11c17c[_0x3651de(0x1d9)]/0x2+0x19),this[_0x3651de(0x138)](_0x153293,_0x11c17c);}}[a6_0x596fbe(0x1ae)](_0x486409){const _0x4c7ea5=a6_0x596fbe,_0x48180d=this[_0x4c7ea5(0x159)][_0x4c7ea5(0x1a3)](_0x486409);if(!_0x48180d){console[_0x4c7ea5(0x1e1)]('[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20'+_0x486409);return;}console[_0x4c7ea5(0x1d4)](_0x4c7ea5(0x15f)+_0x486409+_0x4c7ea5(0x183)+_0x48180d[_0x4c7ea5(0x163)]);try{this['serverWs']&&this['serverWs'][_0x4c7ea5(0x157)]===this[_0x4c7ea5(0x156)][_0x4c7ea5(0x136)]&&this[_0x4c7ea5(0x156)][_0x4c7ea5(0x1b9)](JSON[_0x4c7ea5(0x142)]({'op':'webrtc_stop_session','session_id':_0x486409})),_0x48180d[_0x4c7ea5(0x1ab)]&&_0x48180d[_0x4c7ea5(0x1ab)][_0x4c7ea5(0x1ba)](),_0x48180d['peerConnection']&&_0x48180d['peerConnection']['close']();}catch(_0x378990){console[_0x4c7ea5(0x1c3)](_0x4c7ea5(0x19b)+_0x378990);}this[_0x4c7ea5(0x14a)](_0x486409);}[a6_0x596fbe(0x14a)](_0x5e65e5){const _0x5f556c=a6_0x596fbe,_0x5e2694=this[_0x5f556c(0x159)][_0x5f556c(0x1a3)](_0x5e65e5);if(_0x5e2694){const _0x19250b=this[_0x5f556c(0x1c6)][_0x5f556c(0x1a3)](_0x5e2694[_0x5f556c(0x163)]);_0x19250b&&(_0x19250b['delete'](_0x5e65e5),_0x19250b['size']===0x0&&this[_0x5f556c(0x1c6)][_0x5f556c(0x1f9)](_0x5e2694[_0x5f556c(0x163)])),this[_0x5f556c(0x197)](_0x5e2694['topic']);}this[_0x5f556c(0x159)][_0x5f556c(0x1f9)](_0x5e65e5),console[_0x5f556c(0x1d4)](_0x5f556c(0x1a8)+_0x5e65e5);}[a6_0x596fbe(0x189)](){const _0x1cf383=a6_0x596fbe;console[_0x1cf383(0x1d4)](_0x1cf383(0x19e));const _0x579ea2=Array['from'](this[_0x1cf383(0x159)][_0x1cf383(0x1a4)]());_0x579ea2[_0x1cf383(0x1e7)](_0x47bdbd=>this[_0x1cf383(0x1ae)](_0x47bdbd));}[a6_0x596fbe(0x1cb)](){const _0xc3c905=a6_0x596fbe,_0x46b9e0=[];for(const [_0x1a6200,_0x3c84f1]of this[_0xc3c905(0x159)]){_0x46b9e0[_0xc3c905(0x206)]({'sessionId':_0x1a6200,'topic':_0x3c84f1[_0xc3c905(0x163)],'connectionState':_0x3c84f1[_0xc3c905(0x202)]?.['connectionState']||_0xc3c905(0x19d),'hasVideoTrack':!!_0x3c84f1[_0xc3c905(0x1ab)]});}return _0x46b9e0;}[a6_0x596fbe(0x173)](){const _0x10daaa=a6_0x596fbe,_0x3bc4b3=[];for(const [_0x1716a5,_0x2aa755]of this['sharedVideoSources']){_0x3bc4b3[_0x10daaa(0x206)]({'topic':_0x1716a5,'frameCount':_0x2aa755[_0x10daaa(0x178)],'hasVideoSource':!!_0x2aa755['videoSource'],'hasRosSubscriber':!!_0x2aa755[_0x10daaa(0x1d5)]});}return _0x3bc4b3;}}function a6_0x1ebe(_0x258126,_0x1a20c7){const _0x1a4912=a6_0x36a8();return a6_0x1ebe=function(_0x488df0,_0x492ea4){_0x488df0=_0x488df0-0x134;let _0x36a855=_0x1a4912[_0x488df0];return _0x36a855;},a6_0x1ebe(_0x258126,_0x1a20c7);}module[a6_0x596fbe(0x201)]=new ApplianceWebRTCService();