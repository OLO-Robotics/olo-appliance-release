const a6_0x2a8851=a6_0x320a;(function(_0x48ac85,_0x470df2){const _0x567e79=a6_0x320a,_0x557977=_0x48ac85();while(!![]){try{const _0x69174a=parseInt(_0x567e79(0x10b))/0x1*(-parseInt(_0x567e79(0x9c))/0x2)+parseInt(_0x567e79(0x82))/0x3+-parseInt(_0x567e79(0x89))/0x4+parseInt(_0x567e79(0xdb))/0x5+-parseInt(_0x567e79(0xc3))/0x6*(parseInt(_0x567e79(0xe6))/0x7)+-parseInt(_0x567e79(0xa6))/0x8*(parseInt(_0x567e79(0xb8))/0x9)+parseInt(_0x567e79(0x8f))/0xa;if(_0x69174a===_0x470df2)break;else _0x557977['push'](_0x557977['shift']());}catch(_0x3337e9){_0x557977['push'](_0x557977['shift']());}}}(a6_0x5778,0x63265));function a6_0x320a(_0xa0d769,_0x444bc1){const _0x6f655c=a6_0x5778();return a6_0x320a=function(_0x40dab7,_0x22808b){_0x40dab7=_0x40dab7-0x80;let _0x5778ca=_0x6f655c[_0x40dab7];return _0x5778ca;},a6_0x320a(_0xa0d769,_0x444bc1);}const a6_0x22808b=(function(){let _0x1834f7=!![];return function(_0x1b84f4,_0x35ea89){const _0x322632=_0x1834f7?function(){const _0x4e27af=a6_0x320a;if(_0x35ea89){const _0xd629d4=_0x35ea89[_0x4e27af(0x80)](_0x1b84f4,arguments);return _0x35ea89=null,_0xd629d4;}}:function(){};return _0x1834f7=![],_0x322632;};}()),a6_0x40dab7=a6_0x22808b(this,function(){const _0x1da890=a6_0x320a;return a6_0x40dab7['toString']()['search'](_0x1da890(0x147))[_0x1da890(0xc8)]()[_0x1da890(0x143)](a6_0x40dab7)[_0x1da890(0x9f)](_0x1da890(0x147));});a6_0x40dab7();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x2a8851(0xf5)),sharp=require(a6_0x2a8851(0x12c)),config=require(a6_0x2a8851(0x148)),DepthImageProcessor=require(a6_0x2a8851(0x115)),turnCredentialsService=require('./turnCredentialsService');function a6_0x5778(){const _0x3e6e6a=['1123701rrcHXQ','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','depth','updateCanvasWithImageData','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','pop','canvas','937324qXwLwn','stopSession','addTrack','getIceServers','Waiting\x20for\x20ROS\x20image\x20data...','warn','11285090HFKZKB','includes','initialize','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','videoSource','sensor_msgs/Image','data','closed','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','webrtc_','depthProcessor','processDepthImage','activeSessions','3662xTWfcU','publish','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','search','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','[WebRTC\x20Appliance]\x20Topic\x20','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','sensor_msgs/msg/CompressedImage','removeEventListener','round','4168ZyBxjJ','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','rosbridgeWs','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','webrtc_init_session','\x20sessions\x20remaining)','stop','videoTrack','\x20for\x20topic\x20','sensor_msgs/msg/Image','protocol','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','#888','handleOffer','send','function','split','sensor_msgs/CompressedImage','6579HeGOGN','serverWs','[WebRTC\x20Appliance]\x20Service\x20initialized','base64','unknown','push','compressed_depth_image_transport/CompressedDepthImage','initializeSession','getOrCreateSharedVideoSource','length','12px\x20Arial','4747626NUwixC','log','ðŸ”\x20Depth','Topic:\x20','arc','toString','readyState','/image_raw','random','#00aaff','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','\x20initialized\x20successfully','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','height','video','fillStyle','webrtc_answer','subscribe','getImageData','\x20bytes','setRemoteDescription','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','replace','initializing','1968600Qfbqah','beginPath','putImageData','#ffffff','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','textAlign','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','size',',\x20size:\x20','webrtc_stop_session','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','7Tkzekn','ðŸ”\x20Processing\x20depth...','releaseSharedVideoSource','exports','add','connected','topic','webrtc_ice_candidate','\x20with\x20message\x20type\x20','center','processColorImage','stringify','topicSessions','sendFrameToVideoSource','framerate','wrtc','error','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','startsWith','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','parse','max','failed','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','rtcConfig','peerConnection','unsubscribe',',\x20cleaning\x20up\x20shared\x20resources','\x20sessions)','onconnectionstatechange',',\x20trying\x20alternative\x20depth\x20topics','keys','type','sin','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','connectionState','[WebRTC\x20Appliance]\x20Session\x20','46PDJZcb','drawLoadingPattern','iceServers','subscribeToROSTopic','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','/9j/','stun:stun1.l.google.com:19302','message','getActiveSessions','delete','./DepthImageProcessor','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','fill','sharedVideoSources','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','fillText','width','[WebRTC\x20Appliance]\x20Created\x20answer','\x20successfully\x20connected!','min','now','onFrame','onicecandidate','getContext','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','convertRGBAtoI420','24px\x20Arial','msg','set','sharp','ðŸ“¹\x20Processing\x20video...','/compressed','frameCount','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','font','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','rosSubscriber','get','fillRect','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','offer','handleIceCandidate','16px\x20Arial','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','has','session_id','OPEN','ðŸ“¹\x20Color','\x20connection\x20closed,\x20cleaning\x20up','cleanupSession','candidate','addEventListener','constructor','close','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','(((.+)+)+)+$','../config','webrtc','apply','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20'];a6_0x5778=function(){return _0x3e6e6a;};return a6_0x5778();}class ApplianceWebRTCService{constructor(){const _0x44520a=a6_0x2a8851;this['activeSessions']=new Map(),this[_0x44520a(0xf2)]=new Map(),this[_0x44520a(0x118)]=new Map(),this['rosbridgeWs']=null,this[_0x44520a(0xb9)]=null,this['depthProcessor']=new DepthImageProcessor(),this[_0x44520a(0xfe)]={'iceServers':[{'urls':'stun:stun.l.google.com:19302'},{'urls':_0x44520a(0x111)}]};}[a6_0x2a8851(0x91)](_0x417e20,_0x16f396){const _0xa87098=a6_0x2a8851;this[_0xa87098(0xa8)]=_0x417e20,this['serverWs']=_0x16f396,turnCredentialsService[_0xa87098(0x91)](config['serverUrl']),this['updateTurnCredentials'](),console[_0xa87098(0xc4)](_0xa87098(0xba));}async['updateTurnCredentials'](){const _0x1375e5=a6_0x2a8851;try{console['log'](_0x1375e5(0xcd));const _0x3cc552=await turnCredentialsService[_0x1375e5(0x8c)]();this[_0x1375e5(0xfe)][_0x1375e5(0x10d)]=_0x3cc552,console[_0x1375e5(0xc4)](_0x1375e5(0xa0));}catch(_0x11c44d){console['error'](_0x1375e5(0x13a),_0x11c44d),console[_0x1375e5(0xc4)](_0x1375e5(0xcf));}}['handleMessage'](_0x3e9017){const _0x540f81=a6_0x2a8851;if(!_0x3e9017['op']||!_0x3e9017['op'][_0x540f81(0xf8)](_0x540f81(0x98)))return![];console[_0x540f81(0xc4)](_0x540f81(0x83)+_0x3e9017['op']);switch(_0x3e9017['op']){case _0x540f81(0xaa):this[_0x540f81(0xbf)](_0x3e9017['session_id'],_0x3e9017['topic']);return!![];case'webrtc_offer':this[_0x540f81(0xb3)](_0x3e9017[_0x540f81(0x13c)],_0x3e9017[_0x540f81(0x137)]);return!![];case _0x540f81(0xed):this[_0x540f81(0x138)](_0x3e9017[_0x540f81(0x13c)],_0x3e9017['candidate']);return!![];case _0x540f81(0xe4):this[_0x540f81(0x8a)](_0x3e9017['session_id']);return!![];default:console[_0x540f81(0x8e)](_0x540f81(0xa7)+_0x3e9017['op']);return![];}}['getOrCreateSharedVideoSource'](_0x390729){const _0x348fd9=a6_0x2a8851;if(this[_0x348fd9(0x118)][_0x348fd9(0x13b)](_0x390729)){const _0x3b0dd5=this[_0x348fd9(0x118)][_0x348fd9(0x134)](_0x390729);return _0x3b0dd5[_0x348fd9(0x12f)]++,console['log'](_0x348fd9(0xa9)+_0x390729+'\x20('+_0x3b0dd5[_0x348fd9(0x12f)]+_0x348fd9(0x102)),_0x3b0dd5;}console[_0x348fd9(0xc4)](_0x348fd9(0x10f)+_0x390729);const {createCanvas:_0x3876f0}=require(_0x348fd9(0x88)),_0x5c8105=_0x3876f0(config[_0x348fd9(0x149)][_0x348fd9(0xd1)][_0x348fd9(0x11e)],config[_0x348fd9(0x149)][_0x348fd9(0xd1)]['height']),_0x21fb2a=_0x5c8105[_0x348fd9(0x125)]('2d');this[_0x348fd9(0x10c)](_0x5c8105,_0x21fb2a);const {RTCVideoSource:_0x5ba681}=nonstandard,_0x425144=new _0x5ba681();let _0x3a5881=0x0;const _0x47e85d=0x3e8/config[_0x348fd9(0x149)][_0x348fd9(0xd1)][_0x348fd9(0xf4)],_0x50716d=this[_0x348fd9(0x10e)](_0x390729,_0x3dad69=>{const _0x4d49b3=Date['now']();_0x4d49b3-_0x3a5881>=_0x47e85d&&(_0x3a5881=_0x4d49b3,this['updateCanvasWithImageData'](_0x5c8105,_0x21fb2a,_0x3dad69,_0x390729,_0x425144));}),_0x54e996={'videoSource':_0x425144,'canvas':_0x5c8105,'rosSubscriber':_0x50716d,'frameCount':0x1,'topic':_0x390729};return this[_0x348fd9(0x118)][_0x348fd9(0x12b)](_0x390729,_0x54e996),_0x54e996;}[a6_0x2a8851(0xe8)](_0x4b5fac){const _0x20dd28=a6_0x2a8851,_0x356f8a=this['sharedVideoSources'][_0x20dd28(0x134)](_0x4b5fac);if(!_0x356f8a)return;_0x356f8a[_0x20dd28(0x12f)]--,console[_0x20dd28(0xc4)](_0x20dd28(0xb1)+_0x4b5fac+'\x20('+_0x356f8a['frameCount']+_0x20dd28(0xab)),_0x356f8a['frameCount']<=0x0&&(console[_0x20dd28(0xc4)](_0x20dd28(0x119)+_0x4b5fac+_0x20dd28(0x101)),_0x356f8a['videoSource']&&(_0x356f8a[_0x20dd28(0x93)]=null),_0x356f8a[_0x20dd28(0x133)]&&_0x356f8a[_0x20dd28(0x133)]['unsubscribe'](),this['sharedVideoSources'][_0x20dd28(0x114)](_0x4b5fac));}async[a6_0x2a8851(0xbf)](_0x107a40,_0x178e4a){const _0x6956e4=a6_0x2a8851;try{console[_0x6956e4(0xc4)](_0x6956e4(0x145)+_0x107a40+_0x6956e4(0xae)+_0x178e4a);const _0x55dd47=this[_0x6956e4(0xc0)](_0x178e4a),_0x1def30=new RTCPeerConnection(this[_0x6956e4(0xfe)]),_0x3e9d05=_0x55dd47[_0x6956e4(0x93)]['createTrack']({'width':config[_0x6956e4(0x149)][_0x6956e4(0xd1)][_0x6956e4(0x11e)],'height':config[_0x6956e4(0x149)][_0x6956e4(0xd1)][_0x6956e4(0xd0)],'framerate':config[_0x6956e4(0x149)][_0x6956e4(0xd1)][_0x6956e4(0xf4)]});console[_0x6956e4(0xc4)](_0x6956e4(0x136)+_0x107a40);const {MediaStream:_0x1dfaa5}=require('wrtc'),_0x3a2c0e=new _0x1dfaa5([_0x3e9d05]);_0x1def30[_0x6956e4(0x8b)](_0x3e9d05,_0x3a2c0e),this[_0x6956e4(0xf3)](_0x55dd47[_0x6956e4(0x93)],_0x55dd47['canvas']),_0x1def30[_0x6956e4(0x124)]=_0x43cde6=>{const _0x4a6c50=_0x6956e4;if(_0x43cde6[_0x4a6c50(0x141)]&&this['serverWs'])console['log'](_0x4a6c50(0xa2)+_0x107a40+':',{'type':_0x43cde6['candidate'][_0x4a6c50(0x106)],'protocol':_0x43cde6[_0x4a6c50(0x141)][_0x4a6c50(0xb0)],'address':_0x43cde6[_0x4a6c50(0x141)]['address'],'port':_0x43cde6[_0x4a6c50(0x141)]['port']}),this[_0x4a6c50(0xb9)]['send'](JSON[_0x4a6c50(0xf1)]({'op':_0x4a6c50(0xed),'session_id':_0x107a40,'candidate':_0x43cde6[_0x4a6c50(0x141)]}));else!_0x43cde6[_0x4a6c50(0x141)]&&console['log']('[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20'+_0x107a40);},_0x1def30[_0x6956e4(0x103)]=()=>{const _0x8a74ff=_0x6956e4;console['log']('[WebRTC\x20Appliance]\x20Session\x20'+_0x107a40+'\x20connection\x20state:\x20'+_0x1def30['connectionState']);if(_0x1def30[_0x8a74ff(0x109)]===_0x8a74ff(0xeb))console[_0x8a74ff(0xc4)](_0x8a74ff(0x10a)+_0x107a40+_0x8a74ff(0x120));else{if(_0x1def30[_0x8a74ff(0x109)]===_0x8a74ff(0xfc))console['log'](_0x8a74ff(0x10a)+_0x107a40+'\x20connection\x20failed,\x20stopping\x20session'),this[_0x8a74ff(0x8a)](_0x107a40);else _0x1def30['connectionState']===_0x8a74ff(0x96)&&(console[_0x8a74ff(0xc4)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x107a40+_0x8a74ff(0x13f)),this[_0x8a74ff(0x140)](_0x107a40));}},this[_0x6956e4(0x9b)][_0x6956e4(0x12b)](_0x107a40,{'peerConnection':_0x1def30,'topic':_0x178e4a,'videoTrack':_0x3e9d05,'mediaStream':_0x3a2c0e,'status':_0x6956e4(0xda)}),!this[_0x6956e4(0xf2)]['has'](_0x178e4a)&&this['topicSessions'][_0x6956e4(0x12b)](_0x178e4a,new Set()),this[_0x6956e4(0xf2)][_0x6956e4(0x134)](_0x178e4a)[_0x6956e4(0xea)](_0x107a40),console[_0x6956e4(0xc4)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x107a40+_0x6956e4(0xce)),console['log'](_0x6956e4(0x9e)+_0x178e4a+':\x20'+this[_0x6956e4(0xf2)]['get'](_0x178e4a)[_0x6956e4(0xe2)]);}catch(_0x36142a){console[_0x6956e4(0xf6)](_0x6956e4(0xd8)+_0x107a40+':',_0x36142a),this[_0x6956e4(0x8a)](_0x107a40);}}async['handleOffer'](_0xe52d78,_0x62f59f){const _0x341665=a6_0x2a8851,_0x5a5779=this[_0x341665(0x9b)][_0x341665(0x134)](_0xe52d78);if(!_0x5a5779){console[_0x341665(0xf6)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20'+_0xe52d78);return;}try{console[_0x341665(0xc4)](_0x341665(0x108)+_0xe52d78),await _0x5a5779[_0x341665(0xff)][_0x341665(0xd7)](new RTCSessionDescription(_0x62f59f)),console[_0x341665(0xc4)](_0x341665(0xfd));const _0x2192cb=await _0x5a5779[_0x341665(0xff)]['createAnswer']();console[_0x341665(0xc4)](_0x341665(0x11f)),await _0x5a5779['peerConnection']['setLocalDescription'](_0x2192cb),console[_0x341665(0xc4)](_0x341665(0x146)),this[_0x341665(0xb9)]&&(this[_0x341665(0xb9)][_0x341665(0xb4)](JSON[_0x341665(0xf1)]({'op':_0x341665(0xd3),'session_id':_0xe52d78,'answer':_0x2192cb})),console[_0x341665(0xc4)](_0x341665(0x97)+_0xe52d78));}catch(_0x26b878){console[_0x341665(0xf6)](_0x341665(0xe1)+_0xe52d78+':',_0x26b878),this['stopSession'](_0xe52d78);}}async['handleIceCandidate'](_0x2e8808,_0x1c5499){const _0x2c95be=a6_0x2a8851,_0x45d7bf=this['activeSessions'][_0x2c95be(0x134)](_0x2e8808);if(!_0x45d7bf){console[_0x2c95be(0xf6)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20'+_0x2e8808);return;}try{await _0x45d7bf['peerConnection']['addIceCandidate'](new RTCIceCandidate(_0x1c5499)),console[_0x2c95be(0xc4)]('[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20'+_0x2e8808);}catch(_0x5c56a3){console['error'](_0x2c95be(0x126)+_0x2e8808+':',_0x5c56a3);}}['subscribeToROSTopic'](_0x34f3e9,_0x1b1284){const _0x71bacb=a6_0x2a8851;if(!this[_0x71bacb(0xa8)]||this[_0x71bacb(0xa8)][_0x71bacb(0xc9)]!==this[_0x71bacb(0xa8)]['OPEN'])return console[_0x71bacb(0xf6)](_0x71bacb(0x86)),null;console['log'](_0x71bacb(0x92)+_0x34f3e9);const _0x304430=_0x34f3e9[_0x71bacb(0x90)](_0x71bacb(0x84)),_0x20430a=_0x34f3e9[_0x71bacb(0x90)]('compressed')||_0x34f3e9[_0x71bacb(0x90)]('compressedDepth');let _0x584878=[];_0x304430?_0x20430a?_0x584878=[_0x71bacb(0xb7),_0x71bacb(0xa3),_0x71bacb(0xbe),_0x71bacb(0x94)]:_0x584878=['sensor_msgs/Image',_0x71bacb(0xaf),_0x71bacb(0xb7)]:_0x584878=[_0x71bacb(0xb7),_0x71bacb(0xa3),_0x71bacb(0x94)];console[_0x71bacb(0xc4)](_0x71bacb(0xa1)+_0x34f3e9+'\x20detected\x20as\x20'+(_0x304430?_0x71bacb(0x84):'color')+'\x20image,\x20trying\x20message\x20types:',_0x584878);const _0x7968ab=[];let _0xa4ca6=![];const _0x1e4cd3=_0x5c1814=>{return _0x3d4e03=>{const _0x4802e2=a6_0x320a;try{const _0x44c031=JSON[_0x4802e2(0xfa)](_0x3d4e03[_0x4802e2(0x95)]);_0x44c031['op']==='publish'&&_0x44c031[_0x4802e2(0xec)]===_0x34f3e9&&_0x44c031[_0x4802e2(0x12a)]&&(!_0xa4ca6&&(console[_0x4802e2(0xc4)](_0x4802e2(0xdf)+_0x34f3e9+_0x4802e2(0xee)+_0x5c1814),_0xa4ca6=!![]),_0x1b1284(_0x44c031[_0x4802e2(0x12a)]));}catch(_0x5cd593){console[_0x4802e2(0xf6)](_0x4802e2(0xe5),_0x5cd593);}};};for(const _0x5b84d9 of _0x584878){const _0xb8e4c6={'op':_0x71bacb(0xd4),'topic':_0x34f3e9,'type':_0x5b84d9};console[_0x71bacb(0xc4)]('[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20'+_0x5b84d9),this[_0x71bacb(0xa8)][_0x71bacb(0xb4)](JSON['stringify'](_0xb8e4c6));const _0x17fcbe=_0x1e4cd3(_0x5b84d9);this['rosbridgeWs'][_0x71bacb(0x142)](_0x71bacb(0x112),_0x17fcbe),_0x7968ab[_0x71bacb(0xbd)]({'handler':_0x17fcbe,'type':_0x5b84d9});}return _0x304430&&_0x20430a&&setTimeout(()=>{const _0x4e5ae4=_0x71bacb;if(!_0xa4ca6){console['log'](_0x4e5ae4(0x116)+_0x34f3e9+_0x4e5ae4(0x104));const _0x12de9b=_0x34f3e9['replace']('/compressedDepth','')[_0x4e5ae4(0xd9)](_0x4e5ae4(0x12e),''),_0x2dba62=[_0x12de9b+_0x4e5ae4(0xca),_0x12de9b+'/image',_0x12de9b];for(const _0x239e86 of _0x2dba62){console[_0x4e5ae4(0xc4)](_0x4e5ae4(0x11a)+_0x239e86);const _0x1f2b4e={'op':_0x4e5ae4(0xd4),'topic':_0x239e86,'type':_0x4e5ae4(0x94)};this[_0x4e5ae4(0xa8)][_0x4e5ae4(0xb4)](JSON[_0x4e5ae4(0xf1)](_0x1f2b4e));const _0x463556=_0x367bff=>{const _0x3f3ffc=_0x4e5ae4;try{const _0xb5ea60=JSON[_0x3f3ffc(0xfa)](_0x367bff[_0x3f3ffc(0x95)]);_0xb5ea60['op']===_0x3f3ffc(0x9d)&&_0xb5ea60[_0x3f3ffc(0xec)]===_0x239e86&&_0xb5ea60['msg']&&(console[_0x3f3ffc(0xc4)]('[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20'+_0x239e86+',\x20converting\x20to\x20base64...'),_0xb5ea60[_0x3f3ffc(0x12a)][_0x3f3ffc(0x95)]&&!_0xb5ea60['msg'][_0x3f3ffc(0x95)][_0x3f3ffc(0xf8)](_0x3f3ffc(0x110))&&_0x1b1284(_0xb5ea60['msg']));}catch(_0x145336){console[_0x3f3ffc(0xf6)](_0x3f3ffc(0xf9),_0x145336);}};this[_0x4e5ae4(0xa8)][_0x4e5ae4(0x142)]('message',_0x463556),_0x7968ab['push']({'handler':_0x463556,'type':_0x4e5ae4(0x94),'topic':_0x239e86});}}},0xbb8),{'unsubscribe':()=>{const _0x442258=_0x71bacb;for(const {handler:_0x27180b,type:_0x1f4344,topic:_0x511ae8}of _0x7968ab){this[_0x442258(0xa8)][_0x442258(0xa4)](_0x442258(0x112),_0x27180b),this['rosbridgeWs'][_0x442258(0xc9)]===this[_0x442258(0xa8)][_0x442258(0x13d)]&&this[_0x442258(0xa8)][_0x442258(0xb4)](JSON[_0x442258(0xf1)]({'op':_0x442258(0x100),'topic':_0x511ae8||_0x34f3e9}));}}};}['drawLoadingPattern'](_0x4e3c3f,_0x3b7f97){const _0x56be9a=a6_0x2a8851;_0x3b7f97[_0x56be9a(0xd2)]='#1a1a1a',_0x3b7f97[_0x56be9a(0x135)](0x0,0x0,_0x4e3c3f[_0x56be9a(0x11e)],_0x4e3c3f[_0x56be9a(0xd0)]),_0x3b7f97[_0x56be9a(0xd2)]=_0x56be9a(0xcc),_0x3b7f97[_0x56be9a(0x131)]=_0x56be9a(0x129),_0x3b7f97[_0x56be9a(0xe0)]='center',_0x3b7f97[_0x56be9a(0x11d)]('ðŸ¤–\x20Robot\x20Camera',_0x4e3c3f[_0x56be9a(0x11e)]/0x2,_0x4e3c3f[_0x56be9a(0xd0)]/0x2-0x14),_0x3b7f97[_0x56be9a(0xd2)]=_0x56be9a(0xde),_0x3b7f97[_0x56be9a(0x131)]='16px\x20Arial',_0x3b7f97[_0x56be9a(0x11d)](_0x56be9a(0x8d),_0x4e3c3f['width']/0x2,_0x4e3c3f[_0x56be9a(0xd0)]/0x2+0x14);const _0x38778c=Date[_0x56be9a(0x122)]()/0x3e8;for(let _0x1c7412=0x0;_0x1c7412<0x3;_0x1c7412++){const _0x2c52c5=(Math[_0x56be9a(0x107)](_0x38778c*0x2+_0x1c7412*0.5)+0x1)/0x2;_0x3b7f97['fillStyle']='rgba(0,\x20170,\x20255,\x20'+_0x2c52c5*0.5+')',_0x3b7f97[_0x56be9a(0xdc)](),_0x3b7f97[_0x56be9a(0xc7)](_0x4e3c3f[_0x56be9a(0x11e)]/0x2-0x28+_0x1c7412*0x28,_0x4e3c3f['height']/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x3b7f97[_0x56be9a(0x117)]();}}['sendFrameToVideoSource'](_0xe36398,_0x5e174){const _0x2dd582=a6_0x2a8851;try{if(!_0xe36398||!_0x5e174)return;const _0x29f454=_0x5e174[_0x2dd582(0x125)]('2d'),_0x288fc5=_0x29f454[_0x2dd582(0xd5)](0x0,0x0,_0x5e174['width'],_0x5e174[_0x2dd582(0xd0)]),_0x2c9c55=this[_0x2dd582(0x128)](_0x288fc5[_0x2dd582(0x95)],_0x5e174[_0x2dd582(0x11e)],_0x5e174['height']),_0x2f6f02={'width':_0x5e174[_0x2dd582(0x11e)],'height':_0x5e174[_0x2dd582(0xd0)],'data':_0x2c9c55};typeof _0xe36398[_0x2dd582(0x123)]===_0x2dd582(0xb5)&&_0xe36398[_0x2dd582(0x123)](_0x2f6f02);}catch(_0xb22d80){console[_0x2dd582(0xf6)](_0x2dd582(0x132),_0xb22d80);}}[a6_0x2a8851(0x128)](_0x5ed2ec,_0x207566,_0x9fef4e){const _0x1d6be1=a6_0x2a8851,_0x5d236d=_0x207566*_0x9fef4e,_0x3d0d94=_0x207566*_0x9fef4e/0x4,_0x520a99=new Uint8Array(_0x5d236d+_0x3d0d94*0x2);let _0x23834a=0x0,_0x5d0312=_0x5d236d,_0x265b5a=_0x5d236d+_0x3d0d94;for(let _0x1238aa=0x0;_0x1238aa<_0x9fef4e;_0x1238aa++){for(let _0x7593dd=0x0;_0x7593dd<_0x207566;_0x7593dd++){const _0x314a43=(_0x1238aa*_0x207566+_0x7593dd)*0x4,_0x1d425b=_0x5ed2ec[_0x314a43],_0x25ec6d=_0x5ed2ec[_0x314a43+0x1],_0x4130e8=_0x5ed2ec[_0x314a43+0x2],_0x5a0d42=Math[_0x1d6be1(0xa5)](0.299*_0x1d425b+0.587*_0x25ec6d+0.114*_0x4130e8);_0x520a99[_0x23834a++]=_0x5a0d42;if(_0x1238aa%0x2===0x0&&_0x7593dd%0x2===0x0){const _0x2c391b=Math[_0x1d6be1(0xa5)](-0.169*_0x1d425b-0.331*_0x25ec6d+0.5*_0x4130e8+0x80),_0x2dda34=Math[_0x1d6be1(0xa5)](0.5*_0x1d425b-0.419*_0x25ec6d-0.081*_0x4130e8+0x80);_0x520a99[_0x5d0312++]=Math[_0x1d6be1(0xfb)](0x0,Math[_0x1d6be1(0x121)](0xff,_0x2c391b)),_0x520a99[_0x265b5a++]=Math['max'](0x0,Math[_0x1d6be1(0x121)](0xff,_0x2dda34));}}}return _0x520a99;}async[a6_0x2a8851(0x85)](_0x2452a2,_0x4a94ef,_0x170422,_0x56b8d8,_0x2a1704){const _0x53500=a6_0x2a8851;try{if(!_0x170422||!_0x170422[_0x53500(0x95)])return;Math['random']()<0.01&&console[_0x53500(0xc4)](_0x53500(0xf7)+_0x56b8d8+_0x53500(0xe3)+_0x170422[_0x53500(0x95)][_0x53500(0xc1)]+_0x53500(0xd6));const _0x1f9424=Buffer['from'](_0x170422[_0x53500(0x95)],_0x53500(0xbb)),_0x43be72=this[_0x53500(0x99)]['isDepthTopic'](_0x56b8d8);let _0x55dae2;_0x43be72?_0x55dae2=await this[_0x53500(0x99)][_0x53500(0x9a)](_0x1f9424,_0x2452a2,_0x4a94ef,_0x56b8d8):_0x55dae2=await this[_0x53500(0x99)][_0x53500(0xf0)](_0x1f9424,_0x2452a2,_0x4a94ef),_0x4a94ef[_0x53500(0xdd)](_0x55dae2,0x0,0x0),_0x4a94ef[_0x53500(0xd2)]='rgba(0,\x200,\x200,\x200.7)',_0x4a94ef[_0x53500(0x135)](0xa,0xa,0xdc,0x32),_0x4a94ef['fillStyle']=_0x43be72?'#00ffff':'#00ff00',_0x4a94ef[_0x53500(0x131)]='12px\x20monospace',_0x4a94ef[_0x53500(0x11d)]((_0x43be72?_0x53500(0xc5):_0x53500(0x13e))+':\x20'+new Date()['toLocaleTimeString'](),0xf,0x1c),_0x4a94ef['fillStyle']=_0x53500(0xde),_0x4a94ef[_0x53500(0x131)]='10px\x20monospace',_0x4a94ef[_0x53500(0x11d)](_0x53500(0xc6)+_0x56b8d8[_0x53500(0xb6)]('/')[_0x53500(0x87)](),0xf,0x2d),this[_0x53500(0xf3)](_0x2a1704,_0x2452a2);}catch(_0x3e6e08){console[_0x53500(0x8e)](_0x53500(0x11c)+_0x56b8d8+':',_0x3e6e08[_0x53500(0x112)]);_0x56b8d8[_0x53500(0x90)]('depth')&&Math[_0x53500(0xcb)]()<0.1&&console[_0x53500(0x8e)](_0x53500(0x81)+_0x56b8d8['replace']('/compressedDepth',_0x53500(0xca)));_0x4a94ef[_0x53500(0xd2)]='#1a1a1a',_0x4a94ef[_0x53500(0x135)](0x0,0x0,_0x2452a2[_0x53500(0x11e)],_0x2452a2['height']),_0x4a94ef[_0x53500(0xd2)]=_0x53500(0xb2),_0x4a94ef[_0x53500(0x131)]=_0x53500(0x139),_0x4a94ef[_0x53500(0xe0)]=_0x53500(0xef);const _0x32310f=_0x56b8d8[_0x53500(0x90)](_0x53500(0x84))?_0x53500(0xe7):_0x53500(0x12d);_0x4a94ef['fillText'](_0x32310f,_0x2452a2['width']/0x2,_0x2452a2[_0x53500(0xd0)]/0x2),_0x4a94ef['fillStyle']='#666',_0x4a94ef[_0x53500(0x131)]=_0x53500(0xc2),_0x4a94ef['fillText'](_0x53500(0xc6)+_0x56b8d8[_0x53500(0xb6)]('/')[_0x53500(0x87)](),_0x2452a2[_0x53500(0x11e)]/0x2,_0x2452a2[_0x53500(0xd0)]/0x2+0x19),this[_0x53500(0xf3)](_0x2a1704,_0x2452a2);}}[a6_0x2a8851(0x8a)](_0x159abe){const _0xfebfa0=a6_0x2a8851,_0x180eee=this[_0xfebfa0(0x9b)]['get'](_0x159abe);if(!_0x180eee){console[_0xfebfa0(0x8e)](_0xfebfa0(0x130)+_0x159abe);return;}console['log'](_0xfebfa0(0x11b)+_0x159abe+'\x20for\x20topic:\x20'+_0x180eee[_0xfebfa0(0xec)]);try{this['serverWs']&&this[_0xfebfa0(0xb9)][_0xfebfa0(0xc9)]===this[_0xfebfa0(0xb9)]['OPEN']&&this[_0xfebfa0(0xb9)]['send'](JSON[_0xfebfa0(0xf1)]({'op':_0xfebfa0(0xe4),'session_id':_0x159abe})),_0x180eee[_0xfebfa0(0xad)]&&_0x180eee[_0xfebfa0(0xad)][_0xfebfa0(0xac)](),_0x180eee[_0xfebfa0(0xff)]&&_0x180eee[_0xfebfa0(0xff)][_0xfebfa0(0x144)]();}catch(_0xdb845b){console[_0xfebfa0(0xf6)]('[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20'+_0xdb845b);}this['cleanupSession'](_0x159abe);}['cleanupSession'](_0x1a6b1a){const _0x643052=a6_0x2a8851,_0x4d4980=this[_0x643052(0x9b)][_0x643052(0x134)](_0x1a6b1a);if(_0x4d4980){const _0x3c08d0=this[_0x643052(0xf2)][_0x643052(0x134)](_0x4d4980['topic']);_0x3c08d0&&(_0x3c08d0['delete'](_0x1a6b1a),_0x3c08d0[_0x643052(0xe2)]===0x0&&this[_0x643052(0xf2)]['delete'](_0x4d4980[_0x643052(0xec)])),this['releaseSharedVideoSource'](_0x4d4980[_0x643052(0xec)]);}this['activeSessions'][_0x643052(0x114)](_0x1a6b1a),console[_0x643052(0xc4)]('[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20'+_0x1a6b1a);}['stopAllSessions'](){const _0x221c64=a6_0x2a8851;console['log'](_0x221c64(0x127));const _0x1b1866=Array['from'](this[_0x221c64(0x9b)][_0x221c64(0x105)]());_0x1b1866['forEach'](_0x2be684=>this['stopSession'](_0x2be684));}[a6_0x2a8851(0x113)](){const _0x20ee8e=a6_0x2a8851,_0x2b7a0c=[];for(const [_0x2c6fc3,_0x288b20]of this[_0x20ee8e(0x9b)]){_0x2b7a0c[_0x20ee8e(0xbd)]({'sessionId':_0x2c6fc3,'topic':_0x288b20[_0x20ee8e(0xec)],'connectionState':_0x288b20[_0x20ee8e(0xff)]?.[_0x20ee8e(0x109)]||_0x20ee8e(0xbc),'hasVideoTrack':!!_0x288b20[_0x20ee8e(0xad)]});}return _0x2b7a0c;}['getSharedVideoSources'](){const _0x5f3dfd=a6_0x2a8851,_0x5909c1=[];for(const [_0x2ba0bd,_0x536040]of this[_0x5f3dfd(0x118)]){_0x5909c1[_0x5f3dfd(0xbd)]({'topic':_0x2ba0bd,'frameCount':_0x536040[_0x5f3dfd(0x12f)],'hasVideoSource':!!_0x536040[_0x5f3dfd(0x93)],'hasRosSubscriber':!!_0x536040[_0x5f3dfd(0x133)]});}return _0x5909c1;}}module[a6_0x2a8851(0xe9)]=new ApplianceWebRTCService();