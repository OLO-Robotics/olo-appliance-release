const a6_0x4334b0=a6_0x1a2a;function a6_0x1a2a(_0x1939bb,_0x2d429e){const _0x22a3f0=a6_0x1990();return a6_0x1a2a=function(_0x72d895,_0x341ff9){_0x72d895=_0x72d895-0x1a7;let _0x19908f=_0x22a3f0[_0x72d895];return _0x19908f;},a6_0x1a2a(_0x1939bb,_0x2d429e);}(function(_0x5d593f,_0x4654a3){const _0x2d960c=a6_0x1a2a,_0x39a8c3=_0x5d593f();while(!![]){try{const _0xa2ed25=-parseInt(_0x2d960c(0x26d))/0x1*(parseInt(_0x2d960c(0x1af))/0x2)+parseInt(_0x2d960c(0x1b5))/0x3*(parseInt(_0x2d960c(0x1ba))/0x4)+-parseInt(_0x2d960c(0x223))/0x5*(-parseInt(_0x2d960c(0x216))/0x6)+-parseInt(_0x2d960c(0x1b6))/0x7*(parseInt(_0x2d960c(0x25b))/0x8)+-parseInt(_0x2d960c(0x20b))/0x9+parseInt(_0x2d960c(0x21c))/0xa+parseInt(_0x2d960c(0x1b4))/0xb*(parseInt(_0x2d960c(0x1cc))/0xc);if(_0xa2ed25===_0x4654a3)break;else _0x39a8c3['push'](_0x39a8c3['shift']());}catch(_0x307da0){_0x39a8c3['push'](_0x39a8c3['shift']());}}}(a6_0x1990,0x7384b));const a6_0x341ff9=(function(){let _0x5f1a6e=!![];return function(_0x225217,_0x4a4c6d){const _0x5035a6=_0x5f1a6e?function(){if(_0x4a4c6d){const _0x3e1903=_0x4a4c6d['apply'](_0x225217,arguments);return _0x4a4c6d=null,_0x3e1903;}}:function(){};return _0x5f1a6e=![],_0x5035a6;};}()),a6_0x72d895=a6_0x341ff9(this,function(){const _0x3f4632=a6_0x1a2a;return a6_0x72d895[_0x3f4632(0x273)]()[_0x3f4632(0x261)]('(((.+)+)+)+$')[_0x3f4632(0x273)]()[_0x3f4632(0x201)](a6_0x72d895)['search']('(((.+)+)+)+$');});a6_0x72d895();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require('wrtc'),sharp=require(a6_0x4334b0(0x1cf)),config=require('../config'),DepthImageProcessor=require(a6_0x4334b0(0x260)),turnCredentialsService=require('./turnCredentialsService');class ApplianceWebRTCService{constructor(){const _0x2ba95e=a6_0x4334b0;this[_0x2ba95e(0x1a8)]=new Map(),this['topicSessions']=new Map(),this['sharedVideoSources']=new Map(),this[_0x2ba95e(0x1e4)]=null,this['serverWs']=null,this['depthProcessor']=new DepthImageProcessor(),this[_0x2ba95e(0x1f0)]={'iceServers':[{'urls':_0x2ba95e(0x1ca)},{'urls':_0x2ba95e(0x1ae)}]};}[a6_0x4334b0(0x1b9)](_0x1b9e83,_0x50eb11){const _0x45cf41=a6_0x4334b0;this[_0x45cf41(0x1e4)]=_0x1b9e83,this[_0x45cf41(0x209)]=_0x50eb11,turnCredentialsService['initialize'](config[_0x45cf41(0x1ac)]),this[_0x45cf41(0x1c0)](),console[_0x45cf41(0x264)](_0x45cf41(0x1f2));}async[a6_0x4334b0(0x1c0)](){const _0x53c36b=a6_0x4334b0;try{console[_0x53c36b(0x264)](_0x53c36b(0x1b1));const _0x53a4fa=await turnCredentialsService[_0x53c36b(0x1b7)]();this['rtcConfig']['iceServers']=_0x53a4fa,console[_0x53c36b(0x264)](_0x53c36b(0x1e9));}catch(_0x112889){console[_0x53c36b(0x242)]('[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:',_0x112889),console['log'](_0x53c36b(0x217));}}[a6_0x4334b0(0x1c8)](_0x2bbc7b){const _0x38313e=a6_0x4334b0;if(!_0x2bbc7b['op']||!_0x2bbc7b['op'][_0x38313e(0x1c3)]('webrtc_'))return![];console[_0x38313e(0x264)]('[WebRTC\x20Appliance]\x20Handling\x20message:\x20'+_0x2bbc7b['op']);switch(_0x2bbc7b['op']){case _0x38313e(0x252):this['initializeSession'](_0x2bbc7b[_0x38313e(0x24f)],_0x2bbc7b[_0x38313e(0x1bf)]);return!![];case _0x38313e(0x21a):this[_0x38313e(0x233)](_0x2bbc7b[_0x38313e(0x24f)],_0x2bbc7b[_0x38313e(0x236)]);return!![];case'webrtc_ice_candidate':this[_0x38313e(0x25f)](_0x2bbc7b[_0x38313e(0x24f)],_0x2bbc7b['candidate']);return!![];case'webrtc_stop_session':this[_0x38313e(0x258)](_0x2bbc7b['session_id']);return!![];default:console[_0x38313e(0x245)](_0x38313e(0x1fc)+_0x2bbc7b['op']);return![];}}[a6_0x4334b0(0x1e3)](_0x487dac){const _0x5d79d8=a6_0x4334b0;if(this[_0x5d79d8(0x232)][_0x5d79d8(0x1ed)](_0x487dac)){const _0x5661a=this[_0x5d79d8(0x232)][_0x5d79d8(0x207)](_0x487dac);return _0x5661a[_0x5d79d8(0x237)]++,console[_0x5d79d8(0x264)](_0x5d79d8(0x1dd)+_0x487dac+'\x20('+_0x5661a[_0x5d79d8(0x237)]+_0x5d79d8(0x22b)),_0x5661a;}console[_0x5d79d8(0x264)](_0x5d79d8(0x1b3)+_0x487dac);const {createCanvas:_0x5381af}=require(_0x5d79d8(0x1fe)),_0x5de8d4=_0x5381af(config[_0x5d79d8(0x1f4)][_0x5d79d8(0x23b)][_0x5d79d8(0x1a7)],config[_0x5d79d8(0x1f4)][_0x5d79d8(0x23b)][_0x5d79d8(0x244)]),_0x457398=_0x5de8d4[_0x5d79d8(0x222)]('2d');this['drawLoadingPattern'](_0x5de8d4,_0x457398);const {RTCVideoSource:_0x354c21}=nonstandard,_0x133aa7=new _0x354c21();let _0x5a27a8=0x0;const _0x519070=0x3e8/config['webrtc'][_0x5d79d8(0x23b)][_0x5d79d8(0x24a)],_0x103924=this[_0x5d79d8(0x1fa)](_0x487dac,_0x1ffaa8=>{const _0x4adadd=_0x5d79d8,_0x2ff9f0=Date[_0x4adadd(0x1ee)]();_0x2ff9f0-_0x5a27a8>=_0x519070&&(_0x5a27a8=_0x2ff9f0,this['updateCanvasWithImageData'](_0x5de8d4,_0x457398,_0x1ffaa8,_0x487dac,_0x133aa7));}),_0x1aa874={'videoSource':_0x133aa7,'canvas':_0x5de8d4,'rosSubscriber':_0x103924,'frameCount':0x1,'topic':_0x487dac};return this['sharedVideoSources'][_0x5d79d8(0x254)](_0x487dac,_0x1aa874),_0x1aa874;}['releaseSharedVideoSource'](_0x3b3e1c){const _0xe4556b=a6_0x4334b0,_0x3aa97d=this[_0xe4556b(0x232)][_0xe4556b(0x207)](_0x3b3e1c);if(!_0x3aa97d)return;_0x3aa97d[_0xe4556b(0x237)]--,console['log'](_0xe4556b(0x224)+_0x3b3e1c+'\x20('+_0x3aa97d[_0xe4556b(0x237)]+_0xe4556b(0x20d)),_0x3aa97d[_0xe4556b(0x237)]<=0x0&&(console[_0xe4556b(0x264)](_0xe4556b(0x257)+_0x3b3e1c+',\x20cleaning\x20up\x20shared\x20resources'),_0x3aa97d[_0xe4556b(0x211)]&&(_0x3aa97d[_0xe4556b(0x211)]=null),_0x3aa97d[_0xe4556b(0x1d8)]&&_0x3aa97d['rosSubscriber'][_0xe4556b(0x1ce)](),this[_0xe4556b(0x232)]['delete'](_0x3b3e1c));}async['initializeSession'](_0x215704,_0x14ce26){const _0x510c0d=a6_0x4334b0;try{console[_0x510c0d(0x264)](_0x510c0d(0x248)+_0x215704+'\x20for\x20topic\x20'+_0x14ce26);const _0x9a2547=this[_0x510c0d(0x1e3)](_0x14ce26),_0x3b68b0=new RTCPeerConnection(this['rtcConfig']),_0x1926dd=_0x9a2547['videoSource'][_0x510c0d(0x249)]({'width':config[_0x510c0d(0x1f4)]['video'][_0x510c0d(0x1a7)],'height':config[_0x510c0d(0x1f4)]['video'][_0x510c0d(0x244)],'framerate':config[_0x510c0d(0x1f4)]['video']['framerate']});console['log'](_0x510c0d(0x1d1)+_0x215704);const {MediaStream:_0x47d7de}=require(_0x510c0d(0x1f8)),_0xcb2501=new _0x47d7de([_0x1926dd]);_0x3b68b0[_0x510c0d(0x1c2)](_0x1926dd,_0xcb2501),this[_0x510c0d(0x1be)](_0x9a2547['videoSource'],_0x9a2547[_0x510c0d(0x1fe)]),_0x3b68b0['onicecandidate']=_0x306b38=>{const _0x24abe5=_0x510c0d;if(_0x306b38[_0x24abe5(0x21d)]&&this[_0x24abe5(0x209)])console[_0x24abe5(0x264)](_0x24abe5(0x1d6)+_0x215704+':',{'type':_0x306b38[_0x24abe5(0x21d)][_0x24abe5(0x221)],'protocol':_0x306b38[_0x24abe5(0x21d)][_0x24abe5(0x265)],'address':_0x306b38['candidate'][_0x24abe5(0x229)],'port':_0x306b38[_0x24abe5(0x21d)][_0x24abe5(0x1d4)]}),this[_0x24abe5(0x209)][_0x24abe5(0x23e)](JSON['stringify']({'op':_0x24abe5(0x200),'session_id':_0x215704,'candidate':_0x306b38['candidate']}));else!_0x306b38[_0x24abe5(0x21d)]&&console[_0x24abe5(0x264)](_0x24abe5(0x25c)+_0x215704);},_0x3b68b0['onconnectionstatechange']=()=>{const _0x10b74b=_0x510c0d;console['log'](_0x10b74b(0x1bc)+_0x215704+'\x20connection\x20state:\x20'+_0x3b68b0[_0x10b74b(0x202)]);if(_0x3b68b0[_0x10b74b(0x202)]==='connected')console[_0x10b74b(0x264)](_0x10b74b(0x1bc)+_0x215704+'\x20successfully\x20connected!');else{if(_0x3b68b0[_0x10b74b(0x202)]==='failed')console[_0x10b74b(0x264)](_0x10b74b(0x1bc)+_0x215704+'\x20connection\x20failed,\x20stopping\x20session'),this[_0x10b74b(0x258)](_0x215704);else _0x3b68b0[_0x10b74b(0x202)]==='closed'&&(console[_0x10b74b(0x264)](_0x10b74b(0x1bc)+_0x215704+'\x20connection\x20closed,\x20cleaning\x20up'),this[_0x10b74b(0x20c)](_0x215704));}},this['activeSessions'][_0x510c0d(0x254)](_0x215704,{'peerConnection':_0x3b68b0,'topic':_0x14ce26,'videoTrack':_0x1926dd,'mediaStream':_0xcb2501,'status':_0x510c0d(0x219)}),!this['topicSessions'][_0x510c0d(0x1ed)](_0x14ce26)&&this[_0x510c0d(0x1bd)][_0x510c0d(0x254)](_0x14ce26,new Set()),this['topicSessions'][_0x510c0d(0x207)](_0x14ce26)[_0x510c0d(0x1db)](_0x215704),console[_0x510c0d(0x264)](_0x510c0d(0x1bc)+_0x215704+_0x510c0d(0x234)),console['log'](_0x510c0d(0x239)+_0x14ce26+':\x20'+this[_0x510c0d(0x1bd)][_0x510c0d(0x207)](_0x14ce26)['size']);}catch(_0x46c21f){console[_0x510c0d(0x242)](_0x510c0d(0x20e)+_0x215704+':',_0x46c21f),this[_0x510c0d(0x258)](_0x215704);}}async['handleOffer'](_0x20a31c,_0x5ea342){const _0x3cc51c=a6_0x4334b0,_0x1aa1a6=this[_0x3cc51c(0x1a8)][_0x3cc51c(0x207)](_0x20a31c);if(!_0x1aa1a6){console[_0x3cc51c(0x242)](_0x3cc51c(0x1c7)+_0x20a31c);return;}try{console[_0x3cc51c(0x264)](_0x3cc51c(0x240)+_0x20a31c),await _0x1aa1a6[_0x3cc51c(0x23a)][_0x3cc51c(0x203)](new RTCSessionDescription(_0x5ea342)),console[_0x3cc51c(0x264)](_0x3cc51c(0x243));const _0x2b6720=await _0x1aa1a6[_0x3cc51c(0x23a)]['createAnswer']();console[_0x3cc51c(0x264)](_0x3cc51c(0x1ad)),await _0x1aa1a6['peerConnection'][_0x3cc51c(0x262)](_0x2b6720),console[_0x3cc51c(0x264)](_0x3cc51c(0x1f7)),this[_0x3cc51c(0x209)]&&(this[_0x3cc51c(0x209)][_0x3cc51c(0x23e)](JSON[_0x3cc51c(0x212)]({'op':_0x3cc51c(0x1ab),'session_id':_0x20a31c,'answer':_0x2b6720})),console['log']('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0x20a31c));}catch(_0xe0c4d7){console['error'](_0x3cc51c(0x22e)+_0x20a31c+':',_0xe0c4d7),this[_0x3cc51c(0x258)](_0x20a31c);}}async['handleIceCandidate'](_0x11fb61,_0x5e796a){const _0x355737=a6_0x4334b0,_0x1ec152=this[_0x355737(0x1a8)][_0x355737(0x207)](_0x11fb61);if(!_0x1ec152){console[_0x355737(0x242)](_0x355737(0x1de)+_0x11fb61);return;}try{await _0x1ec152[_0x355737(0x23a)]['addIceCandidate'](new RTCIceCandidate(_0x5e796a)),console['log'](_0x355737(0x1f1)+_0x11fb61);}catch(_0x1f4370){console[_0x355737(0x242)](_0x355737(0x213)+_0x11fb61+':',_0x1f4370);}}[a6_0x4334b0(0x1fa)](_0x4eefcf,_0x42c047){const _0x306e24=a6_0x4334b0;if(!this[_0x306e24(0x1e4)]||this[_0x306e24(0x1e4)][_0x306e24(0x267)]!==this[_0x306e24(0x1e4)]['OPEN'])return console['error'](_0x306e24(0x1dc)),null;console[_0x306e24(0x264)](_0x306e24(0x1ef)+_0x4eefcf);const _0x263f5c=_0x4eefcf[_0x306e24(0x1e2)](_0x306e24(0x263)),_0x403163=_0x4eefcf[_0x306e24(0x1e2)](_0x306e24(0x208))||_0x4eefcf[_0x306e24(0x1e2)](_0x306e24(0x1bb));let _0x5cadf7=[];_0x263f5c?_0x403163?_0x5cadf7=[_0x306e24(0x1b0),_0x306e24(0x24b),'compressed_depth_image_transport/CompressedDepthImage',_0x306e24(0x22a)]:_0x5cadf7=[_0x306e24(0x22a),_0x306e24(0x253),'sensor_msgs/CompressedImage']:_0x5cadf7=[_0x306e24(0x1b0),_0x306e24(0x24b),'sensor_msgs/Image'];console[_0x306e24(0x264)](_0x306e24(0x1c6)+_0x4eefcf+'\x20detected\x20as\x20'+(_0x263f5c?'depth':'color')+'\x20image,\x20trying\x20message\x20types:',_0x5cadf7);const _0x2f85d2=[];let _0x4911d5=![];const _0x1a533c=_0x299124=>{return _0x2e45f5=>{const _0x76291b=a6_0x1a2a;try{const _0x2b4649=JSON[_0x76291b(0x22c)](_0x2e45f5[_0x76291b(0x1eb)]);_0x2b4649['op']===_0x76291b(0x22f)&&_0x2b4649[_0x76291b(0x1bf)]===_0x4eefcf&&_0x2b4649[_0x76291b(0x247)]&&(!_0x4911d5&&(console[_0x76291b(0x264)]('[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20'+_0x4eefcf+_0x76291b(0x230)+_0x299124),_0x4911d5=!![]),_0x42c047(_0x2b4649[_0x76291b(0x247)]));}catch(_0xe130f9){console[_0x76291b(0x242)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0xe130f9);}};};for(const _0x5f47e0 of _0x5cadf7){const _0x50a496={'op':_0x306e24(0x1e5),'topic':_0x4eefcf,'type':_0x5f47e0};console[_0x306e24(0x264)]('[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20'+_0x5f47e0),this[_0x306e24(0x1e4)]['send'](JSON[_0x306e24(0x212)](_0x50a496));const _0x10d6e7=_0x1a533c(_0x5f47e0);this['rosbridgeWs'][_0x306e24(0x25e)](_0x306e24(0x1e7),_0x10d6e7),_0x2f85d2['push']({'handler':_0x10d6e7,'type':_0x5f47e0});}return _0x263f5c&&_0x403163&&setTimeout(()=>{const _0x1099f9=_0x306e24;if(!_0x4911d5){console['log'](_0x1099f9(0x1e6)+_0x4eefcf+',\x20trying\x20alternative\x20depth\x20topics');const _0x5e6c08=_0x4eefcf[_0x1099f9(0x1a9)]('/compressedDepth','')[_0x1099f9(0x1a9)]('/compressed',''),_0x216463=[_0x5e6c08+_0x1099f9(0x24e),_0x5e6c08+_0x1099f9(0x251),_0x5e6c08];for(const _0x508323 of _0x216463){console[_0x1099f9(0x264)](_0x1099f9(0x218)+_0x508323);const _0x527575={'op':_0x1099f9(0x1e5),'topic':_0x508323,'type':_0x1099f9(0x22a)};this[_0x1099f9(0x1e4)]['send'](JSON['stringify'](_0x527575));const _0x1c39f0=_0x25c98c=>{const _0x42af9c=_0x1099f9;try{const _0x1c3eea=JSON[_0x42af9c(0x22c)](_0x25c98c[_0x42af9c(0x1eb)]);_0x1c3eea['op']===_0x42af9c(0x22f)&&_0x1c3eea[_0x42af9c(0x1bf)]===_0x508323&&_0x1c3eea['msg']&&(console[_0x42af9c(0x264)](_0x42af9c(0x1c9)+_0x508323+',\x20converting\x20to\x20base64...'),_0x1c3eea[_0x42af9c(0x247)][_0x42af9c(0x1eb)]&&!_0x1c3eea[_0x42af9c(0x247)][_0x42af9c(0x1eb)][_0x42af9c(0x1c3)]('/9j/')&&_0x42c047(_0x1c3eea[_0x42af9c(0x247)]));}catch(_0x402447){console[_0x42af9c(0x242)](_0x42af9c(0x25a),_0x402447);}};this[_0x1099f9(0x1e4)][_0x1099f9(0x25e)]('message',_0x1c39f0),_0x2f85d2[_0x1099f9(0x1c1)]({'handler':_0x1c39f0,'type':_0x1099f9(0x22a),'topic':_0x508323});}}},0xbb8),{'unsubscribe':()=>{const _0x2e1673=_0x306e24;for(const {handler:_0xfd557f,type:_0x315923,topic:_0x5ee551}of _0x2f85d2){this[_0x2e1673(0x1e4)][_0x2e1673(0x23f)](_0x2e1673(0x1e7),_0xfd557f),this[_0x2e1673(0x1e4)][_0x2e1673(0x267)]===this[_0x2e1673(0x1e4)][_0x2e1673(0x1d7)]&&this[_0x2e1673(0x1e4)][_0x2e1673(0x23e)](JSON['stringify']({'op':'unsubscribe','topic':_0x5ee551||_0x4eefcf}));}}};}[a6_0x4334b0(0x1cd)](_0x2e0a38,_0x5e205d){const _0x47c638=a6_0x4334b0;_0x5e205d['fillStyle']='#1a1a1a',_0x5e205d[_0x47c638(0x227)](0x0,0x0,_0x2e0a38[_0x47c638(0x1a7)],_0x2e0a38[_0x47c638(0x244)]),_0x5e205d[_0x47c638(0x1e0)]='#00aaff',_0x5e205d[_0x47c638(0x1b8)]=_0x47c638(0x1aa),_0x5e205d[_0x47c638(0x1d0)]=_0x47c638(0x231),_0x5e205d[_0x47c638(0x26e)]('🤖\x20Robot\x20Camera',_0x2e0a38['width']/0x2,_0x2e0a38[_0x47c638(0x244)]/0x2-0x14),_0x5e205d['fillStyle']=_0x47c638(0x225),_0x5e205d['font']='16px\x20Arial',_0x5e205d[_0x47c638(0x26e)]('Waiting\x20for\x20ROS\x20image\x20data...',_0x2e0a38[_0x47c638(0x1a7)]/0x2,_0x2e0a38[_0x47c638(0x244)]/0x2+0x14);const _0x51b267=Date[_0x47c638(0x1ee)]()/0x3e8;for(let _0x2744e1=0x0;_0x2744e1<0x3;_0x2744e1++){const _0x2b1f29=(Math[_0x47c638(0x1f6)](_0x51b267*0x2+_0x2744e1*0.5)+0x1)/0x2;_0x5e205d['fillStyle']=_0x47c638(0x1b2)+_0x2b1f29*0.5+')',_0x5e205d[_0x47c638(0x1f5)](),_0x5e205d[_0x47c638(0x1ec)](_0x2e0a38['width']/0x2-0x28+_0x2744e1*0x28,_0x2e0a38[_0x47c638(0x244)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x5e205d[_0x47c638(0x256)]();}}['sendFrameToVideoSource'](_0x4f6da2,_0x4b1d88){const _0x162e69=a6_0x4334b0;try{if(!_0x4f6da2||!_0x4b1d88)return;const _0x2a1a89=_0x4b1d88[_0x162e69(0x222)]('2d'),_0x18f4e9=_0x2a1a89[_0x162e69(0x26a)](0x0,0x0,_0x4b1d88[_0x162e69(0x1a7)],_0x4b1d88[_0x162e69(0x244)]),_0x3df780=this[_0x162e69(0x24d)](_0x18f4e9[_0x162e69(0x1eb)],_0x4b1d88[_0x162e69(0x1a7)],_0x4b1d88[_0x162e69(0x244)]),_0x2c0aa0={'width':_0x4b1d88[_0x162e69(0x1a7)],'height':_0x4b1d88[_0x162e69(0x244)],'data':_0x3df780};typeof _0x4f6da2[_0x162e69(0x238)]===_0x162e69(0x226)&&_0x4f6da2[_0x162e69(0x238)](_0x2c0aa0);}catch(_0x14ad53){console[_0x162e69(0x242)](_0x162e69(0x26b),_0x14ad53);}}['convertRGBAtoI420'](_0x198ce8,_0x55f910,_0x1534f2){const _0x27c4fa=a6_0x4334b0,_0x3c28be=_0x55f910*_0x1534f2,_0xb5001c=_0x55f910*_0x1534f2/0x4,_0x371368=new Uint8Array(_0x3c28be+_0xb5001c*0x2);let _0x33f45d=0x0,_0x5360e7=_0x3c28be,_0x5c2aef=_0x3c28be+_0xb5001c;for(let _0x26380b=0x0;_0x26380b<_0x1534f2;_0x26380b++){for(let _0x59c485=0x0;_0x59c485<_0x55f910;_0x59c485++){const _0x5057e8=(_0x26380b*_0x55f910+_0x59c485)*0x4,_0x16e39d=_0x198ce8[_0x5057e8],_0x5d6fd3=_0x198ce8[_0x5057e8+0x1],_0x353592=_0x198ce8[_0x5057e8+0x2],_0x7438ad=Math[_0x27c4fa(0x21e)](0.299*_0x16e39d+0.587*_0x5d6fd3+0.114*_0x353592);_0x371368[_0x33f45d++]=_0x7438ad;if(_0x26380b%0x2===0x0&&_0x59c485%0x2===0x0){const _0x58a06a=Math[_0x27c4fa(0x21e)](-0.169*_0x16e39d-0.331*_0x5d6fd3+0.5*_0x353592+0x80),_0x33c441=Math[_0x27c4fa(0x21e)](0.5*_0x16e39d-0.419*_0x5d6fd3-0.081*_0x353592+0x80);_0x371368[_0x5360e7++]=Math[_0x27c4fa(0x255)](0x0,Math[_0x27c4fa(0x26f)](0xff,_0x58a06a)),_0x371368[_0x5c2aef++]=Math[_0x27c4fa(0x255)](0x0,Math['min'](0xff,_0x33c441));}}}return _0x371368;}async[a6_0x4334b0(0x1d2)](_0x1ef8d1,_0x3ab38a,_0x56bb0d,_0x5ddbc8,_0x34bb5f){const _0x429095=a6_0x4334b0;try{if(!_0x56bb0d||!_0x56bb0d['data'])return;Math[_0x429095(0x22d)]()<0.01&&console[_0x429095(0x264)]('[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20'+_0x5ddbc8+_0x429095(0x1fb)+_0x56bb0d[_0x429095(0x1eb)][_0x429095(0x268)]+_0x429095(0x1e1));const _0x381cc4=Buffer[_0x429095(0x1f9)](_0x56bb0d[_0x429095(0x1eb)],_0x429095(0x271)),_0x1dd369=this[_0x429095(0x259)]['isDepthTopic'](_0x5ddbc8);let _0x1d4efc;_0x1dd369?_0x1d4efc=await this['depthProcessor'][_0x429095(0x21b)](_0x381cc4,_0x1ef8d1,_0x3ab38a,_0x5ddbc8):_0x1d4efc=await this['depthProcessor'][_0x429095(0x206)](_0x381cc4,_0x1ef8d1,_0x3ab38a),_0x3ab38a[_0x429095(0x1d3)](_0x1d4efc,0x0,0x0),_0x3ab38a[_0x429095(0x1e0)]=_0x429095(0x272),_0x3ab38a[_0x429095(0x227)](0xa,0xa,0xdc,0x32),_0x3ab38a[_0x429095(0x1e0)]=_0x1dd369?_0x429095(0x269):_0x429095(0x215),_0x3ab38a[_0x429095(0x1b8)]=_0x429095(0x23d),_0x3ab38a[_0x429095(0x26e)]((_0x1dd369?_0x429095(0x241):_0x429095(0x1df))+':\x20'+new Date()[_0x429095(0x204)](),0xf,0x1c),_0x3ab38a[_0x429095(0x1e0)]='#ffffff',_0x3ab38a[_0x429095(0x1b8)]=_0x429095(0x1d5),_0x3ab38a[_0x429095(0x26e)]('Topic:\x20'+_0x5ddbc8[_0x429095(0x210)]('/')[_0x429095(0x266)](),0xf,0x2d),this[_0x429095(0x1be)](_0x34bb5f,_0x1ef8d1);}catch(_0x1b2ddd){console[_0x429095(0x245)]('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x5ddbc8+':',_0x1b2ddd[_0x429095(0x1e7)]);_0x5ddbc8[_0x429095(0x1e2)](_0x429095(0x263))&&Math[_0x429095(0x22d)]()<0.1&&console[_0x429095(0x245)](_0x429095(0x246)+_0x5ddbc8[_0x429095(0x1a9)]('/compressedDepth',_0x429095(0x24e)));_0x3ab38a['fillStyle']=_0x429095(0x205),_0x3ab38a[_0x429095(0x227)](0x0,0x0,_0x1ef8d1['width'],_0x1ef8d1[_0x429095(0x244)]),_0x3ab38a['fillStyle']=_0x429095(0x1da),_0x3ab38a[_0x429095(0x1b8)]=_0x429095(0x235),_0x3ab38a[_0x429095(0x1d0)]='center';const _0x307b02=_0x5ddbc8[_0x429095(0x1e2)]('depth')?'🔍\x20Processing\x20depth...':_0x429095(0x1e8);_0x3ab38a[_0x429095(0x26e)](_0x307b02,_0x1ef8d1['width']/0x2,_0x1ef8d1['height']/0x2),_0x3ab38a[_0x429095(0x1e0)]=_0x429095(0x228),_0x3ab38a[_0x429095(0x1b8)]=_0x429095(0x24c),_0x3ab38a[_0x429095(0x26e)](_0x429095(0x1f3)+_0x5ddbc8[_0x429095(0x210)]('/')[_0x429095(0x266)](),_0x1ef8d1[_0x429095(0x1a7)]/0x2,_0x1ef8d1['height']/0x2+0x19),this[_0x429095(0x1be)](_0x34bb5f,_0x1ef8d1);}}[a6_0x4334b0(0x258)](_0x5d13ad){const _0x2b9c2c=a6_0x4334b0,_0x3f4309=this[_0x2b9c2c(0x1a8)][_0x2b9c2c(0x207)](_0x5d13ad);if(!_0x3f4309){console[_0x2b9c2c(0x245)](_0x2b9c2c(0x25d)+_0x5d13ad);return;}console['log'](_0x2b9c2c(0x270)+_0x5d13ad+'\x20for\x20topic:\x20'+_0x3f4309[_0x2b9c2c(0x1bf)]);try{this['serverWs']&&this[_0x2b9c2c(0x209)][_0x2b9c2c(0x267)]===this[_0x2b9c2c(0x209)]['OPEN']&&this[_0x2b9c2c(0x209)][_0x2b9c2c(0x23e)](JSON[_0x2b9c2c(0x212)]({'op':'webrtc_stop_session','session_id':_0x5d13ad})),_0x3f4309[_0x2b9c2c(0x1ff)]&&_0x3f4309[_0x2b9c2c(0x1ff)][_0x2b9c2c(0x1c5)](),_0x3f4309['peerConnection']&&_0x3f4309[_0x2b9c2c(0x23a)][_0x2b9c2c(0x220)]();}catch(_0x13b353){console['error'](_0x2b9c2c(0x1fd)+_0x13b353);}this['cleanupSession'](_0x5d13ad);}[a6_0x4334b0(0x20c)](_0x54dc20){const _0x4e3698=a6_0x4334b0,_0xe6cad0=this[_0x4e3698(0x1a8)][_0x4e3698(0x207)](_0x54dc20);if(_0xe6cad0){const _0x4f3b34=this[_0x4e3698(0x1bd)][_0x4e3698(0x207)](_0xe6cad0['topic']);_0x4f3b34&&(_0x4f3b34[_0x4e3698(0x20a)](_0x54dc20),_0x4f3b34[_0x4e3698(0x1ea)]===0x0&&this[_0x4e3698(0x1bd)][_0x4e3698(0x20a)](_0xe6cad0[_0x4e3698(0x1bf)])),this[_0x4e3698(0x23c)](_0xe6cad0[_0x4e3698(0x1bf)]);}this[_0x4e3698(0x1a8)]['delete'](_0x54dc20),console[_0x4e3698(0x264)]('[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20'+_0x54dc20);}[a6_0x4334b0(0x1c4)](){const _0x118ac6=a6_0x4334b0;console[_0x118ac6(0x264)](_0x118ac6(0x250));const _0x40afbf=Array[_0x118ac6(0x1f9)](this[_0x118ac6(0x1a8)][_0x118ac6(0x1cb)]());_0x40afbf[_0x118ac6(0x1d9)](_0x3eb20f=>this[_0x118ac6(0x258)](_0x3eb20f));}[a6_0x4334b0(0x20f)](){const _0xb1ba23=a6_0x4334b0,_0x5844ed=[];for(const [_0x2f374d,_0x297824]of this[_0xb1ba23(0x1a8)]){_0x5844ed[_0xb1ba23(0x1c1)]({'sessionId':_0x2f374d,'topic':_0x297824[_0xb1ba23(0x1bf)],'connectionState':_0x297824[_0xb1ba23(0x23a)]?.[_0xb1ba23(0x202)]||_0xb1ba23(0x214),'hasVideoTrack':!!_0x297824['videoTrack']});}return _0x5844ed;}[a6_0x4334b0(0x26c)](){const _0x4dc5c2=a6_0x4334b0,_0x5b6d7e=[];for(const [_0x4e2f4f,_0xa57eb]of this[_0x4dc5c2(0x232)]){_0x5b6d7e[_0x4dc5c2(0x1c1)]({'topic':_0x4e2f4f,'frameCount':_0xa57eb[_0x4dc5c2(0x237)],'hasVideoSource':!!_0xa57eb['videoSource'],'hasRosSubscriber':!!_0xa57eb['rosSubscriber']});}return _0x5b6d7e;}}function a6_0x1990(){const _0x3e24c9=['stun:stun1.l.google.com:19302','2NoFVnW','sensor_msgs/CompressedImage','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','rgba(0,\x20170,\x20255,\x20','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','97350fXnCGp','148395PIBNEA','7umpvml','getIceServers','font','initialize','12hprslb','compressedDepth','[WebRTC\x20Appliance]\x20Session\x20','topicSessions','sendFrameToVideoSource','topic','updateTurnCredentials','push','addTrack','startsWith','stopAllSessions','stop','[WebRTC\x20Appliance]\x20Topic\x20','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','handleMessage','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','stun:stun.l.google.com:19302','keys','2256kuKpHh','drawLoadingPattern','unsubscribe','sharp','textAlign','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','updateCanvasWithImageData','putImageData','port','10px\x20monospace','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','OPEN','rosSubscriber','forEach','#888','add','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','📹\x20Color','fillStyle','\x20bytes','includes','getOrCreateSharedVideoSource','rosbridgeWs','subscribe','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','message','📹\x20Processing\x20video...','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','size','data','arc','has','now','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','rtcConfig','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Service\x20initialized','Topic:\x20','webrtc','beginPath','sin','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','wrtc','from','subscribeToROSTopic',',\x20size:\x20','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','canvas','videoTrack','webrtc_ice_candidate','constructor','connectionState','setRemoteDescription','toLocaleTimeString','#1a1a1a','processColorImage','get','compressed','serverWs','delete','8218035UOAuDp','cleanupSession','\x20sessions\x20remaining)','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','getActiveSessions','split','videoSource','stringify','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','unknown','#00ff00','2886ERuuLN','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','initializing','webrtc_offer','processDepthImage','1409460ndSfNk','candidate','round','exports','close','type','getContext','715rIESuh','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','#ffffff','function','fillRect','#666','address','sensor_msgs/Image','\x20sessions)','parse','random','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','publish','\x20with\x20message\x20type\x20','center','sharedVideoSources','handleOffer','\x20initialized\x20successfully','16px\x20Arial','offer','frameCount','onFrame','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','peerConnection','video','releaseSharedVideoSource','12px\x20monospace','send','removeEventListener','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','🔍\x20Depth','error','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','height','warn','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','msg','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','createTrack','framerate','sensor_msgs/msg/CompressedImage','12px\x20Arial','convertRGBAtoI420','/image_raw','session_id','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','/image','webrtc_init_session','sensor_msgs/msg/Image','set','max','fill','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','stopSession','depthProcessor','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','2300072vMEbzf','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','addEventListener','handleIceCandidate','./DepthImageProcessor','search','setLocalDescription','depth','log','protocol','pop','readyState','length','#00ffff','getImageData','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','getSharedVideoSources','348137KtoORT','fillText','min','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','base64','rgba(0,\x200,\x200,\x200.7)','toString','width','activeSessions','replace','24px\x20Arial','webrtc_answer','serverUrl','[WebRTC\x20Appliance]\x20Created\x20answer'];a6_0x1990=function(){return _0x3e24c9;};return a6_0x1990();}module[a6_0x4334b0(0x21f)]=new ApplianceWebRTCService();