const a6_0x38a237=a6_0x2780;(function(_0x376b87,_0x4fd75d){const _0x44fb38=a6_0x2780,_0x5b2c44=_0x376b87();while(!![]){try{const _0x3e3e66=-parseInt(_0x44fb38(0x114))/0x1*(parseInt(_0x44fb38(0x118))/0x2)+-parseInt(_0x44fb38(0x1af))/0x3*(-parseInt(_0x44fb38(0x184))/0x4)+-parseInt(_0x44fb38(0x1cb))/0x5+-parseInt(_0x44fb38(0x157))/0x6*(parseInt(_0x44fb38(0x1ac))/0x7)+-parseInt(_0x44fb38(0x195))/0x8*(-parseInt(_0x44fb38(0x1c3))/0x9)+parseInt(_0x44fb38(0x115))/0xa+-parseInt(_0x44fb38(0x1d4))/0xb*(parseInt(_0x44fb38(0x155))/0xc);if(_0x3e3e66===_0x4fd75d)break;else _0x5b2c44['push'](_0x5b2c44['shift']());}catch(_0x303914){_0x5b2c44['push'](_0x5b2c44['shift']());}}}(a6_0x32a1,0xba985));const a6_0x175c43=(function(){let _0x4f56dc=!![];return function(_0x3bed6e,_0x192542){const _0x186ec3=_0x4f56dc?function(){const _0x1f1da4=a6_0x2780;if(_0x192542){const _0x5c1656=_0x192542[_0x1f1da4(0x146)](_0x3bed6e,arguments);return _0x192542=null,_0x5c1656;}}:function(){};return _0x4f56dc=![],_0x186ec3;};}()),a6_0x5c8347=a6_0x175c43(this,function(){const _0x3e24b9=a6_0x2780;return a6_0x5c8347[_0x3e24b9(0x173)]()[_0x3e24b9(0x168)](_0x3e24b9(0x19d))[_0x3e24b9(0x173)]()[_0x3e24b9(0x17c)](a6_0x5c8347)[_0x3e24b9(0x168)](_0x3e24b9(0x19d));});function a6_0x32a1(){const _0x346485=['[WebRTC\x20Appliance]\x20Session\x20','processDepthImage','message','depthProcessor','\x20successfully\x20connected!','35YdZJMY','./DepthImageProcessor','updateTurnCredentials','489147eHrjoW','10px\x20monospace','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','toLocaleTimeString','has','ðŸ“¹\x20Color','sharp','/image_raw','subscribeToROSTopic','onFrame','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','sensor_msgs/CompressedImage','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','getActiveSessions','session_id','webrtc_stop_session','wrtc','9vPXNno','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','isDepthTopic','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','\x20detected\x20as\x20','initialize','24px\x20Arial','1350710QbDAnh','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','getContext','fillStyle','#00ff00','sendFrameToVideoSource','stringify','rtcConfig','[WebRTC\x20Appliance]\x20Created\x20answer','110PNdqbS','onconnectionstatechange','/9j/','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','parse','frameCount','topicSessions','\x20sessions)','sensor_msgs/Image','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','activeSessions','12px\x20monospace','cleanupSession','\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','size','candidate','Topic:\x20','96803FZMZod','13586040kFnChK','failed','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','2CpoaKb','port','protocol','get','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','setLocalDescription','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','set','connected','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','convertRGBAtoI420','length','canvas','getIceServers','stun:stun.l.google.com:19302','initializeSession','ðŸ“¹\x20Processing\x20video...','video','height','webrtc','forEach','split','\x20connection\x20state:\x20','close','width','rgba(0,\x20170,\x20255,\x20','serverWs','function',',\x20trying\x20alternative\x20depth\x20topics','readyState','ðŸ”\x20Depth','fillRect','OPEN','#ffffff','sharedVideoSources','peerConnection','depth','from','max','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','data','rosSubscriber','compressed','topic','webrtc_ice_candidate','apply','color','pop','delete','push','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','add','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','includes','framerate','webrtc_','serverUrl','stop','connectionState','arc','1637760SpmNlQ','fillText','1529826lZnyjs','exports','releaseSharedVideoSource','unknown','videoSource',',\x20size:\x20','random','ðŸ¤–\x20Robot\x20Camera','log','webrtc_answer','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','16px\x20Arial','font','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','12px\x20Arial','stun:stun1.l.google.com:19302','search','/compressed','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','#666','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','subscribe','round','beginPath','[WebRTC\x20Appliance]\x20Topic\x20','[WebRTC\x20Appliance]\x20Service\x20initialized','msg','toString','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','stopSession','handleOffer','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','setRemoteDescription','center','closed','iceServers','constructor','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','send','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','#00ffff','ðŸ”\x20Processing\x20depth...','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','error','36mZMWvp','replace','\x20initialized\x20successfully','addEventListener','\x20bytes','createAnswer','type','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','unsubscribe','updateCanvasWithImageData','publish','addIceCandidate','now','rosbridgeWs','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','../config','warn','7558784iBuyUI','min','compressed_depth_image_transport/CompressedDepthImage','keys','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','drawLoadingPattern','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','getOrCreateSharedVideoSource','(((.+)+)+)+$',',\x20cleaning\x20up\x20shared\x20resources','\x20sessions\x20remaining)','startsWith','\x20for\x20topic:\x20','initializing','Waiting\x20for\x20ROS\x20image\x20data...','onicecandidate','videoTrack','offer'];a6_0x32a1=function(){return _0x346485;};return a6_0x32a1();}a6_0x5c8347();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x38a237(0x1c2)),sharp=require(a6_0x38a237(0x1b5)),config=require(a6_0x38a237(0x193)),DepthImageProcessor=require(a6_0x38a237(0x1ad)),turnCredentialsService=require('./turnCredentialsService');class ApplianceWebRTCService{constructor(){const _0x2f5da6=a6_0x38a237;this[_0x2f5da6(0x10c)]=new Map(),this[_0x2f5da6(0x108)]=new Map(),this[_0x2f5da6(0x13b)]=new Map(),this[_0x2f5da6(0x191)]=null,this['serverWs']=null,this[_0x2f5da6(0x1aa)]=new DepthImageProcessor(),this[_0x2f5da6(0x1d2)]={'iceServers':[{'urls':_0x2f5da6(0x127)},{'urls':_0x2f5da6(0x167)}]};}[a6_0x38a237(0x1c9)](_0x1dfd29,_0x46e332){const _0x1c5c0f=a6_0x38a237;this[_0x1c5c0f(0x191)]=_0x1dfd29,this[_0x1c5c0f(0x133)]=_0x46e332,turnCredentialsService[_0x1c5c0f(0x1c9)](config[_0x1c5c0f(0x151)]),this[_0x1c5c0f(0x1ae)](),console[_0x1c5c0f(0x15f)](_0x1c5c0f(0x171));}async['updateTurnCredentials'](){const _0x52da13=a6_0x38a237;try{console[_0x52da13(0x15f)](_0x52da13(0x122));const _0x1d3d67=await turnCredentialsService[_0x52da13(0x126)]();this[_0x52da13(0x1d2)][_0x52da13(0x17b)]=_0x1d3d67,console[_0x52da13(0x15f)](_0x52da13(0x162));}catch(_0x18d1eb){console[_0x52da13(0x183)](_0x52da13(0x11e),_0x18d1eb),console[_0x52da13(0x15f)](_0x52da13(0x10b));}}['handleMessage'](_0xed22e2){const _0x17b9cc=a6_0x38a237;if(!_0xed22e2['op']||!_0xed22e2['op']['startsWith'](_0x17b9cc(0x150)))return![];console[_0x17b9cc(0x15f)](_0x17b9cc(0x1b1)+_0xed22e2['op']);switch(_0xed22e2['op']){case'webrtc_init_session':this[_0x17b9cc(0x128)](_0xed22e2[_0x17b9cc(0x1c0)],_0xed22e2[_0x17b9cc(0x144)]);return!![];case'webrtc_offer':this[_0x17b9cc(0x176)](_0xed22e2[_0x17b9cc(0x1c0)],_0xed22e2[_0x17b9cc(0x1a6)]);return!![];case _0x17b9cc(0x145):this['handleIceCandidate'](_0xed22e2[_0x17b9cc(0x1c0)],_0xed22e2[_0x17b9cc(0x112)]);return!![];case _0x17b9cc(0x1c1):this[_0x17b9cc(0x175)](_0xed22e2[_0x17b9cc(0x1c0)]);return!![];default:console[_0x17b9cc(0x194)]('[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20'+_0xed22e2['op']);return![];}}[a6_0x38a237(0x19c)](_0x25caa5){const _0x1621ee=a6_0x38a237;if(this[_0x1621ee(0x13b)][_0x1621ee(0x1b3)](_0x25caa5)){const _0xff22a2=this['sharedVideoSources'][_0x1621ee(0x11b)](_0x25caa5);return _0xff22a2[_0x1621ee(0x107)]++,console[_0x1621ee(0x15f)](_0x1621ee(0x199)+_0x25caa5+'\x20('+_0xff22a2[_0x1621ee(0x107)]+_0x1621ee(0x109)),_0xff22a2;}console[_0x1621ee(0x15f)](_0x1621ee(0x140)+_0x25caa5);const {createCanvas:_0x53776a}=require(_0x1621ee(0x125)),_0x3b6f8a=_0x53776a(config['webrtc']['video'][_0x1621ee(0x131)],config['webrtc']['video'][_0x1621ee(0x12b)]),_0xc7a077=_0x3b6f8a[_0x1621ee(0x1cd)]('2d');this[_0x1621ee(0x19a)](_0x3b6f8a,_0xc7a077);const {RTCVideoSource:_0x2d9ebe}=nonstandard,_0x2c1dae=new _0x2d9ebe();let _0x25c5c8=0x0;const _0x3a74fb=0x3e8/config['webrtc'][_0x1621ee(0x12a)][_0x1621ee(0x14f)],_0x565e57=this[_0x1621ee(0x1b7)](_0x25caa5,_0x4572bb=>{const _0x5335b1=_0x1621ee,_0x162b85=Date[_0x5335b1(0x190)]();_0x162b85-_0x25c5c8>=_0x3a74fb&&(_0x25c5c8=_0x162b85,this[_0x5335b1(0x18d)](_0x3b6f8a,_0xc7a077,_0x4572bb,_0x25caa5,_0x2c1dae));}),_0x43df12={'videoSource':_0x2c1dae,'canvas':_0x3b6f8a,'rosSubscriber':_0x565e57,'frameCount':0x1,'topic':_0x25caa5};return this[_0x1621ee(0x13b)]['set'](_0x25caa5,_0x43df12),_0x43df12;}[a6_0x38a237(0x159)](_0x29dfec){const _0x36dc50=a6_0x38a237,_0x1a5c37=this[_0x36dc50(0x13b)][_0x36dc50(0x11b)](_0x29dfec);if(!_0x1a5c37)return;_0x1a5c37['frameCount']--,console[_0x36dc50(0x15f)](_0x36dc50(0x1cc)+_0x29dfec+'\x20('+_0x1a5c37[_0x36dc50(0x107)]+_0x36dc50(0x19f)),_0x1a5c37[_0x36dc50(0x107)]<=0x0&&(console[_0x36dc50(0x15f)]('[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20'+_0x29dfec+_0x36dc50(0x19e)),_0x1a5c37[_0x36dc50(0x15b)]&&(_0x1a5c37[_0x36dc50(0x15b)]=null),_0x1a5c37[_0x36dc50(0x142)]&&_0x1a5c37[_0x36dc50(0x142)][_0x36dc50(0x18c)](),this['sharedVideoSources'][_0x36dc50(0x149)](_0x29dfec));}async['initializeSession'](_0x139d14,_0x2f8ee2){const _0x46a9ac=a6_0x38a237;try{console['log'](_0x46a9ac(0x1c7)+_0x139d14+_0x46a9ac(0x10f)+_0x2f8ee2);const _0x12f547=this[_0x46a9ac(0x19c)](_0x2f8ee2),_0x6705e9=new RTCPeerConnection(this[_0x46a9ac(0x1d2)]),_0x12adc7=_0x12f547['videoSource']['createTrack']({'width':config[_0x46a9ac(0x12c)][_0x46a9ac(0x12a)][_0x46a9ac(0x131)],'height':config[_0x46a9ac(0x12c)][_0x46a9ac(0x12a)][_0x46a9ac(0x12b)],'framerate':config[_0x46a9ac(0x12c)][_0x46a9ac(0x12a)]['framerate']});console[_0x46a9ac(0x15f)](_0x46a9ac(0x1bd)+_0x139d14);const {MediaStream:_0x5673e0}=require(_0x46a9ac(0x1c2)),_0x3308e9=new _0x5673e0([_0x12adc7]);_0x6705e9['addTrack'](_0x12adc7,_0x3308e9),this['sendFrameToVideoSource'](_0x12f547['videoSource'],_0x12f547[_0x46a9ac(0x125)]),_0x6705e9[_0x46a9ac(0x1a4)]=_0x4ab04b=>{const _0x133459=_0x46a9ac;if(_0x4ab04b[_0x133459(0x112)]&&this[_0x133459(0x133)])console[_0x133459(0x15f)](_0x133459(0x192)+_0x139d14+':',{'type':_0x4ab04b[_0x133459(0x112)][_0x133459(0x18a)],'protocol':_0x4ab04b[_0x133459(0x112)][_0x133459(0x11a)],'address':_0x4ab04b[_0x133459(0x112)]['address'],'port':_0x4ab04b[_0x133459(0x112)][_0x133459(0x119)]}),this['serverWs']['send'](JSON[_0x133459(0x1d1)]({'op':_0x133459(0x145),'session_id':_0x139d14,'candidate':_0x4ab04b[_0x133459(0x112)]}));else!_0x4ab04b['candidate']&&console['log'](_0x133459(0x17d)+_0x139d14);},_0x6705e9[_0x46a9ac(0x1d5)]=()=>{const _0x4854fa=_0x46a9ac;console['log'](_0x4854fa(0x1a7)+_0x139d14+_0x4854fa(0x12f)+_0x6705e9[_0x4854fa(0x153)]);if(_0x6705e9[_0x4854fa(0x153)]===_0x4854fa(0x120))console[_0x4854fa(0x15f)](_0x4854fa(0x1a7)+_0x139d14+_0x4854fa(0x1ab));else{if(_0x6705e9[_0x4854fa(0x153)]===_0x4854fa(0x116))console[_0x4854fa(0x15f)](_0x4854fa(0x1a7)+_0x139d14+'\x20connection\x20failed,\x20stopping\x20session'),this[_0x4854fa(0x175)](_0x139d14);else _0x6705e9[_0x4854fa(0x153)]===_0x4854fa(0x17a)&&(console[_0x4854fa(0x15f)](_0x4854fa(0x1a7)+_0x139d14+'\x20connection\x20closed,\x20cleaning\x20up'),this[_0x4854fa(0x10e)](_0x139d14));}},this['activeSessions']['set'](_0x139d14,{'peerConnection':_0x6705e9,'topic':_0x2f8ee2,'videoTrack':_0x12adc7,'mediaStream':_0x3308e9,'status':_0x46a9ac(0x1a2)}),!this[_0x46a9ac(0x108)][_0x46a9ac(0x1b3)](_0x2f8ee2)&&this[_0x46a9ac(0x108)][_0x46a9ac(0x11f)](_0x2f8ee2,new Set()),this[_0x46a9ac(0x108)][_0x46a9ac(0x11b)](_0x2f8ee2)[_0x46a9ac(0x14c)](_0x139d14),console[_0x46a9ac(0x15f)](_0x46a9ac(0x1a7)+_0x139d14+_0x46a9ac(0x186)),console[_0x46a9ac(0x15f)](_0x46a9ac(0x174)+_0x2f8ee2+':\x20'+this[_0x46a9ac(0x108)]['get'](_0x2f8ee2)[_0x46a9ac(0x111)]);}catch(_0x48f9a3){console['error'](_0x46a9ac(0x18b)+_0x139d14+':',_0x48f9a3),this[_0x46a9ac(0x175)](_0x139d14);}}async[a6_0x38a237(0x176)](_0x5ee3cc,_0x17703a){const _0xaf128c=a6_0x38a237,_0x1a97cb=this[_0xaf128c(0x10c)][_0xaf128c(0x11b)](_0x5ee3cc);if(!_0x1a97cb){console[_0xaf128c(0x183)](_0xaf128c(0x1bb)+_0x5ee3cc);return;}try{console['log'](_0xaf128c(0x1c4)+_0x5ee3cc),await _0x1a97cb[_0xaf128c(0x13c)][_0xaf128c(0x178)](new RTCSessionDescription(_0x17703a)),console[_0xaf128c(0x15f)](_0xaf128c(0x1ba));const _0x5ad9b5=await _0x1a97cb[_0xaf128c(0x13c)][_0xaf128c(0x189)]();console[_0xaf128c(0x15f)](_0xaf128c(0x1d3)),await _0x1a97cb[_0xaf128c(0x13c)][_0xaf128c(0x11d)](_0x5ad9b5),console['log'](_0xaf128c(0x1be)),this[_0xaf128c(0x133)]&&(this[_0xaf128c(0x133)]['send'](JSON[_0xaf128c(0x1d1)]({'op':_0xaf128c(0x160),'session_id':_0x5ee3cc,'answer':_0x5ad9b5})),console[_0xaf128c(0x15f)](_0xaf128c(0x110)+_0x5ee3cc));}catch(_0x42e16a){console[_0xaf128c(0x183)](_0xaf128c(0x17f)+_0x5ee3cc+':',_0x42e16a),this[_0xaf128c(0x175)](_0x5ee3cc);}}async['handleIceCandidate'](_0x4f6443,_0x2856f3){const _0x74f29f=a6_0x38a237,_0x3cbaa1=this[_0x74f29f(0x10c)][_0x74f29f(0x11b)](_0x4f6443);if(!_0x3cbaa1){console[_0x74f29f(0x183)](_0x74f29f(0x161)+_0x4f6443);return;}try{await _0x3cbaa1[_0x74f29f(0x13c)][_0x74f29f(0x18f)](new RTCIceCandidate(_0x2856f3)),console['log'](_0x74f29f(0x182)+_0x4f6443);}catch(_0x547521){console[_0x74f29f(0x183)](_0x74f29f(0x11c)+_0x4f6443+':',_0x547521);}}['subscribeToROSTopic'](_0x1b3f04,_0x46663a){const _0x50c638=a6_0x38a237;if(!this['rosbridgeWs']||this[_0x50c638(0x191)][_0x50c638(0x136)]!==this['rosbridgeWs'][_0x50c638(0x139)])return console[_0x50c638(0x183)]('[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected'),null;console[_0x50c638(0x15f)](_0x50c638(0x19b)+_0x1b3f04);const _0x3ed1c7=_0x1b3f04['includes'](_0x50c638(0x13d)),_0x9a6664=_0x1b3f04[_0x50c638(0x14e)](_0x50c638(0x143))||_0x1b3f04[_0x50c638(0x14e)]('compressedDepth');let _0x2608f2=[];_0x3ed1c7?_0x9a6664?_0x2608f2=[_0x50c638(0x1bc),'sensor_msgs/msg/CompressedImage',_0x50c638(0x197),_0x50c638(0x10a)]:_0x2608f2=[_0x50c638(0x10a),'sensor_msgs/msg/Image',_0x50c638(0x1bc)]:_0x2608f2=[_0x50c638(0x1bc),'sensor_msgs/msg/CompressedImage','sensor_msgs/Image'];console[_0x50c638(0x15f)](_0x50c638(0x170)+_0x1b3f04+_0x50c638(0x1c8)+(_0x3ed1c7?'depth':_0x50c638(0x147))+'\x20image,\x20trying\x20message\x20types:',_0x2608f2);const _0x31a0ef=[];let _0x2b1a55=![];const _0x4e3c6a=_0x282f66=>{return _0x1cd9dd=>{const _0x2ef411=a6_0x2780;try{const _0x4379d8=JSON[_0x2ef411(0x106)](_0x1cd9dd[_0x2ef411(0x141)]);_0x4379d8['op']===_0x2ef411(0x18e)&&_0x4379d8[_0x2ef411(0x144)]===_0x1b3f04&&_0x4379d8[_0x2ef411(0x172)]&&(!_0x2b1a55&&(console['log'](_0x2ef411(0x105)+_0x1b3f04+'\x20with\x20message\x20type\x20'+_0x282f66),_0x2b1a55=!![]),_0x46663a(_0x4379d8[_0x2ef411(0x172)]));}catch(_0x113e3d){console[_0x2ef411(0x183)](_0x2ef411(0x14b),_0x113e3d);}};};for(const _0x4eaf00 of _0x2608f2){const _0x4a8d29={'op':'subscribe','topic':_0x1b3f04,'type':_0x4eaf00};console['log'](_0x50c638(0x16c)+_0x4eaf00),this[_0x50c638(0x191)][_0x50c638(0x17e)](JSON[_0x50c638(0x1d1)](_0x4a8d29));const _0x9511bc=_0x4e3c6a(_0x4eaf00);this['rosbridgeWs'][_0x50c638(0x187)](_0x50c638(0x1a9),_0x9511bc),_0x31a0ef[_0x50c638(0x14a)]({'handler':_0x9511bc,'type':_0x4eaf00});}return _0x3ed1c7&&_0x9a6664&&setTimeout(()=>{const _0xf03a21=_0x50c638;if(!_0x2b1a55){console[_0xf03a21(0x15f)]('[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20'+_0x1b3f04+_0xf03a21(0x135));const _0x330666=_0x1b3f04[_0xf03a21(0x185)]('/compressedDepth','')[_0xf03a21(0x185)](_0xf03a21(0x169),''),_0x3f21cf=[_0x330666+_0xf03a21(0x1b6),_0x330666+'/image',_0x330666];for(const _0x1e30c0 of _0x3f21cf){console[_0xf03a21(0x15f)](_0xf03a21(0x1c5)+_0x1e30c0);const _0xbfe097={'op':_0xf03a21(0x16d),'topic':_0x1e30c0,'type':_0xf03a21(0x10a)};this[_0xf03a21(0x191)]['send'](JSON[_0xf03a21(0x1d1)](_0xbfe097));const _0x1a227e=_0x3f7bd8=>{const _0x52c4c0=_0xf03a21;try{const _0x44a4cb=JSON[_0x52c4c0(0x106)](_0x3f7bd8[_0x52c4c0(0x141)]);_0x44a4cb['op']===_0x52c4c0(0x18e)&&_0x44a4cb[_0x52c4c0(0x144)]===_0x1e30c0&&_0x44a4cb[_0x52c4c0(0x172)]&&(console[_0x52c4c0(0x15f)]('[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20'+_0x1e30c0+',\x20converting\x20to\x20base64...'),_0x44a4cb[_0x52c4c0(0x172)][_0x52c4c0(0x141)]&&!_0x44a4cb[_0x52c4c0(0x172)][_0x52c4c0(0x141)][_0x52c4c0(0x1a0)](_0x52c4c0(0x104))&&_0x46663a(_0x44a4cb[_0x52c4c0(0x172)]));}catch(_0x2dae76){console[_0x52c4c0(0x183)](_0x52c4c0(0x121),_0x2dae76);}};this['rosbridgeWs']['addEventListener'](_0xf03a21(0x1a9),_0x1a227e),_0x31a0ef['push']({'handler':_0x1a227e,'type':_0xf03a21(0x10a),'topic':_0x1e30c0});}}},0xbb8),{'unsubscribe':()=>{const _0x45217d=_0x50c638;for(const {handler:_0x2e14d0,type:_0xf33fa1,topic:_0x7c8564}of _0x31a0ef){this['rosbridgeWs']['removeEventListener'](_0x45217d(0x1a9),_0x2e14d0),this[_0x45217d(0x191)]['readyState']===this[_0x45217d(0x191)]['OPEN']&&this['rosbridgeWs']['send'](JSON[_0x45217d(0x1d1)]({'op':_0x45217d(0x18c),'topic':_0x7c8564||_0x1b3f04}));}}};}[a6_0x38a237(0x19a)](_0xf8b882,_0x94f6e){const _0x1cdc8a=a6_0x38a237;_0x94f6e[_0x1cdc8a(0x1ce)]='#1a1a1a',_0x94f6e[_0x1cdc8a(0x138)](0x0,0x0,_0xf8b882[_0x1cdc8a(0x131)],_0xf8b882[_0x1cdc8a(0x12b)]),_0x94f6e[_0x1cdc8a(0x1ce)]='#00aaff',_0x94f6e['font']=_0x1cdc8a(0x1ca),_0x94f6e['textAlign']=_0x1cdc8a(0x179),_0x94f6e[_0x1cdc8a(0x156)](_0x1cdc8a(0x15e),_0xf8b882[_0x1cdc8a(0x131)]/0x2,_0xf8b882[_0x1cdc8a(0x12b)]/0x2-0x14),_0x94f6e[_0x1cdc8a(0x1ce)]=_0x1cdc8a(0x13a),_0x94f6e[_0x1cdc8a(0x164)]=_0x1cdc8a(0x163),_0x94f6e[_0x1cdc8a(0x156)](_0x1cdc8a(0x1a3),_0xf8b882[_0x1cdc8a(0x131)]/0x2,_0xf8b882[_0x1cdc8a(0x12b)]/0x2+0x14);const _0x3dcfd2=Date[_0x1cdc8a(0x190)]()/0x3e8;for(let _0x50e799=0x0;_0x50e799<0x3;_0x50e799++){const _0x537a36=(Math['sin'](_0x3dcfd2*0x2+_0x50e799*0.5)+0x1)/0x2;_0x94f6e[_0x1cdc8a(0x1ce)]=_0x1cdc8a(0x132)+_0x537a36*0.5+')',_0x94f6e[_0x1cdc8a(0x16f)](),_0x94f6e[_0x1cdc8a(0x154)](_0xf8b882[_0x1cdc8a(0x131)]/0x2-0x28+_0x50e799*0x28,_0xf8b882[_0x1cdc8a(0x12b)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x94f6e['fill']();}}[a6_0x38a237(0x1d0)](_0x16e2ac,_0x3e6cd0){const _0x31d16b=a6_0x38a237;try{if(!_0x16e2ac||!_0x3e6cd0)return;const _0x1b8726=_0x3e6cd0[_0x31d16b(0x1cd)]('2d'),_0x48562c=_0x1b8726['getImageData'](0x0,0x0,_0x3e6cd0[_0x31d16b(0x131)],_0x3e6cd0[_0x31d16b(0x12b)]),_0x460fef=this[_0x31d16b(0x123)](_0x48562c[_0x31d16b(0x141)],_0x3e6cd0[_0x31d16b(0x131)],_0x3e6cd0[_0x31d16b(0x12b)]),_0x3e1463={'width':_0x3e6cd0[_0x31d16b(0x131)],'height':_0x3e6cd0['height'],'data':_0x460fef};typeof _0x16e2ac['onFrame']===_0x31d16b(0x134)&&_0x16e2ac[_0x31d16b(0x1b8)](_0x3e1463);}catch(_0x1e27a4){console[_0x31d16b(0x183)]('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x1e27a4);}}['convertRGBAtoI420'](_0x588584,_0x1370a9,_0x5f5180){const _0x37d3de=a6_0x38a237,_0x5d1d14=_0x1370a9*_0x5f5180,_0xd10031=_0x1370a9*_0x5f5180/0x4,_0x4dbb58=new Uint8Array(_0x5d1d14+_0xd10031*0x2);let _0x52da45=0x0,_0x3c6752=_0x5d1d14,_0x35a60f=_0x5d1d14+_0xd10031;for(let _0x2a56a1=0x0;_0x2a56a1<_0x5f5180;_0x2a56a1++){for(let _0x574c00=0x0;_0x574c00<_0x1370a9;_0x574c00++){const _0x195334=(_0x2a56a1*_0x1370a9+_0x574c00)*0x4,_0x3a0d90=_0x588584[_0x195334],_0x50a5c1=_0x588584[_0x195334+0x1],_0x46b39b=_0x588584[_0x195334+0x2],_0x1e9c6c=Math[_0x37d3de(0x16e)](0.299*_0x3a0d90+0.587*_0x50a5c1+0.114*_0x46b39b);_0x4dbb58[_0x52da45++]=_0x1e9c6c;if(_0x2a56a1%0x2===0x0&&_0x574c00%0x2===0x0){const _0x4ded8b=Math[_0x37d3de(0x16e)](-0.169*_0x3a0d90-0.331*_0x50a5c1+0.5*_0x46b39b+0x80),_0x173fe2=Math[_0x37d3de(0x16e)](0.5*_0x3a0d90-0.419*_0x50a5c1-0.081*_0x46b39b+0x80);_0x4dbb58[_0x3c6752++]=Math['max'](0x0,Math[_0x37d3de(0x196)](0xff,_0x4ded8b)),_0x4dbb58[_0x35a60f++]=Math[_0x37d3de(0x13f)](0x0,Math['min'](0xff,_0x173fe2));}}}return _0x4dbb58;}async[a6_0x38a237(0x18d)](_0x3e3b5e,_0x1da6d2,_0x169153,_0x478727,_0xb821a5){const _0x3fa3f9=a6_0x38a237;try{if(!_0x169153||!_0x169153['data'])return;Math[_0x3fa3f9(0x15d)]()<0.01&&console[_0x3fa3f9(0x15f)](_0x3fa3f9(0x16a)+_0x478727+_0x3fa3f9(0x15c)+_0x169153[_0x3fa3f9(0x141)][_0x3fa3f9(0x124)]+_0x3fa3f9(0x188));const _0x17fed6=Buffer[_0x3fa3f9(0x13e)](_0x169153[_0x3fa3f9(0x141)],'base64'),_0x52fa4a=this[_0x3fa3f9(0x1aa)][_0x3fa3f9(0x1c6)](_0x478727);let _0x5082d7;_0x52fa4a?_0x5082d7=await this[_0x3fa3f9(0x1aa)][_0x3fa3f9(0x1a8)](_0x17fed6,_0x3e3b5e,_0x1da6d2,_0x478727):_0x5082d7=await this['depthProcessor']['processColorImage'](_0x17fed6,_0x3e3b5e,_0x1da6d2),_0x1da6d2['putImageData'](_0x5082d7,0x0,0x0),_0x1da6d2[_0x3fa3f9(0x1ce)]='rgba(0,\x200,\x200,\x200.7)',_0x1da6d2[_0x3fa3f9(0x138)](0xa,0xa,0xdc,0x32),_0x1da6d2[_0x3fa3f9(0x1ce)]=_0x52fa4a?_0x3fa3f9(0x180):_0x3fa3f9(0x1cf),_0x1da6d2[_0x3fa3f9(0x164)]=_0x3fa3f9(0x10d),_0x1da6d2[_0x3fa3f9(0x156)]((_0x52fa4a?_0x3fa3f9(0x137):_0x3fa3f9(0x1b4))+':\x20'+new Date()[_0x3fa3f9(0x1b2)](),0xf,0x1c),_0x1da6d2[_0x3fa3f9(0x1ce)]='#ffffff',_0x1da6d2[_0x3fa3f9(0x164)]=_0x3fa3f9(0x1b0),_0x1da6d2['fillText'](_0x3fa3f9(0x113)+_0x478727[_0x3fa3f9(0x12e)]('/')[_0x3fa3f9(0x148)](),0xf,0x2d),this[_0x3fa3f9(0x1d0)](_0xb821a5,_0x3e3b5e);}catch(_0x11c0b6){console[_0x3fa3f9(0x194)]('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x478727+':',_0x11c0b6['message']);_0x478727[_0x3fa3f9(0x14e)]('depth')&&Math[_0x3fa3f9(0x15d)]()<0.1&&console[_0x3fa3f9(0x194)]('[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20'+_0x478727[_0x3fa3f9(0x185)]('/compressedDepth',_0x3fa3f9(0x1b6)));_0x1da6d2[_0x3fa3f9(0x1ce)]='#1a1a1a',_0x1da6d2['fillRect'](0x0,0x0,_0x3e3b5e[_0x3fa3f9(0x131)],_0x3e3b5e[_0x3fa3f9(0x12b)]),_0x1da6d2[_0x3fa3f9(0x1ce)]='#888',_0x1da6d2[_0x3fa3f9(0x164)]=_0x3fa3f9(0x163),_0x1da6d2['textAlign']=_0x3fa3f9(0x179);const _0x409bc6=_0x478727[_0x3fa3f9(0x14e)](_0x3fa3f9(0x13d))?_0x3fa3f9(0x181):_0x3fa3f9(0x129);_0x1da6d2[_0x3fa3f9(0x156)](_0x409bc6,_0x3e3b5e[_0x3fa3f9(0x131)]/0x2,_0x3e3b5e[_0x3fa3f9(0x12b)]/0x2),_0x1da6d2[_0x3fa3f9(0x1ce)]=_0x3fa3f9(0x16b),_0x1da6d2[_0x3fa3f9(0x164)]=_0x3fa3f9(0x166),_0x1da6d2[_0x3fa3f9(0x156)](_0x3fa3f9(0x113)+_0x478727[_0x3fa3f9(0x12e)]('/')[_0x3fa3f9(0x148)](),_0x3e3b5e[_0x3fa3f9(0x131)]/0x2,_0x3e3b5e[_0x3fa3f9(0x12b)]/0x2+0x19),this['sendFrameToVideoSource'](_0xb821a5,_0x3e3b5e);}}['stopSession'](_0x448313){const _0x560ed8=a6_0x38a237,_0x3e9eaf=this['activeSessions']['get'](_0x448313);if(!_0x3e9eaf){console[_0x560ed8(0x194)](_0x560ed8(0x1b9)+_0x448313);return;}console['log'](_0x560ed8(0x177)+_0x448313+_0x560ed8(0x1a1)+_0x3e9eaf[_0x560ed8(0x144)]);try{this['serverWs']&&this[_0x560ed8(0x133)]['readyState']===this['serverWs']['OPEN']&&this[_0x560ed8(0x133)][_0x560ed8(0x17e)](JSON[_0x560ed8(0x1d1)]({'op':'webrtc_stop_session','session_id':_0x448313})),_0x3e9eaf[_0x560ed8(0x1a5)]&&_0x3e9eaf[_0x560ed8(0x1a5)][_0x560ed8(0x152)](),_0x3e9eaf[_0x560ed8(0x13c)]&&_0x3e9eaf['peerConnection'][_0x560ed8(0x130)]();}catch(_0x5499cb){console['error'](_0x560ed8(0x14d)+_0x5499cb);}this[_0x560ed8(0x10e)](_0x448313);}[a6_0x38a237(0x10e)](_0x86c81){const _0x195ffd=a6_0x38a237,_0x333933=this[_0x195ffd(0x10c)]['get'](_0x86c81);if(_0x333933){const _0x5c04ad=this[_0x195ffd(0x108)]['get'](_0x333933[_0x195ffd(0x144)]);_0x5c04ad&&(_0x5c04ad['delete'](_0x86c81),_0x5c04ad[_0x195ffd(0x111)]===0x0&&this[_0x195ffd(0x108)][_0x195ffd(0x149)](_0x333933[_0x195ffd(0x144)])),this[_0x195ffd(0x159)](_0x333933[_0x195ffd(0x144)]);}this[_0x195ffd(0x10c)][_0x195ffd(0x149)](_0x86c81),console[_0x195ffd(0x15f)](_0x195ffd(0x117)+_0x86c81);}['stopAllSessions'](){const _0x458e35=a6_0x38a237;console[_0x458e35(0x15f)](_0x458e35(0x165));const _0x1b359a=Array[_0x458e35(0x13e)](this[_0x458e35(0x10c)][_0x458e35(0x198)]());_0x1b359a[_0x458e35(0x12d)](_0x3155f8=>this[_0x458e35(0x175)](_0x3155f8));}[a6_0x38a237(0x1bf)](){const _0x513f05=a6_0x38a237,_0x2c08a6=[];for(const [_0xd54ecc,_0x4632ee]of this['activeSessions']){_0x2c08a6[_0x513f05(0x14a)]({'sessionId':_0xd54ecc,'topic':_0x4632ee[_0x513f05(0x144)],'connectionState':_0x4632ee[_0x513f05(0x13c)]?.['connectionState']||_0x513f05(0x15a),'hasVideoTrack':!!_0x4632ee[_0x513f05(0x1a5)]});}return _0x2c08a6;}['getSharedVideoSources'](){const _0x43a2c2=a6_0x38a237,_0x421c17=[];for(const [_0xd2bab4,_0x511a98]of this['sharedVideoSources']){_0x421c17[_0x43a2c2(0x14a)]({'topic':_0xd2bab4,'frameCount':_0x511a98[_0x43a2c2(0x107)],'hasVideoSource':!!_0x511a98[_0x43a2c2(0x15b)],'hasRosSubscriber':!!_0x511a98[_0x43a2c2(0x142)]});}return _0x421c17;}}function a6_0x2780(_0x39a737,_0x3af073){const _0x46b844=a6_0x32a1();return a6_0x2780=function(_0x5c8347,_0x175c43){_0x5c8347=_0x5c8347-0x104;let _0x32a165=_0x46b844[_0x5c8347];return _0x32a165;},a6_0x2780(_0x39a737,_0x3af073);}module[a6_0x38a237(0x158)]=new ApplianceWebRTCService();