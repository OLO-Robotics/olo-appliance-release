const a6_0x3082f9=a6_0x375f;function a6_0x375f(_0x51c6c9,_0x3a555a){const _0x494530=a6_0x35e4();return a6_0x375f=function(_0x40625b,_0x1fe2f0){_0x40625b=_0x40625b-0xd8;let _0x35e475=_0x494530[_0x40625b];return _0x35e475;},a6_0x375f(_0x51c6c9,_0x3a555a);}(function(_0x4a246b,_0x2aa242){const _0x45dc85=a6_0x375f,_0x11e037=_0x4a246b();while(!![]){try{const _0x1c0f5f=-parseInt(_0x45dc85(0x146))/0x1*(-parseInt(_0x45dc85(0xfc))/0x2)+-parseInt(_0x45dc85(0x155))/0x3*(-parseInt(_0x45dc85(0x101))/0x4)+-parseInt(_0x45dc85(0x152))/0x5*(-parseInt(_0x45dc85(0xe1))/0x6)+-parseInt(_0x45dc85(0x171))/0x7*(-parseInt(_0x45dc85(0xe6))/0x8)+-parseInt(_0x45dc85(0x135))/0x9*(-parseInt(_0x45dc85(0xed))/0xa)+parseInt(_0x45dc85(0x139))/0xb+-parseInt(_0x45dc85(0x159))/0xc*(parseInt(_0x45dc85(0x134))/0xd);if(_0x1c0f5f===_0x2aa242)break;else _0x11e037['push'](_0x11e037['shift']());}catch(_0x6f5695){_0x11e037['push'](_0x11e037['shift']());}}}(a6_0x35e4,0xb20c4));const a6_0x1fe2f0=(function(){let _0x51e223=!![];return function(_0x65e7fd,_0x26ff34){const _0x32aca1=_0x51e223?function(){const _0x3ce19a=a6_0x375f;if(_0x26ff34){const _0x447e57=_0x26ff34[_0x3ce19a(0xeb)](_0x65e7fd,arguments);return _0x26ff34=null,_0x447e57;}}:function(){};return _0x51e223=![],_0x32aca1;};}()),a6_0x40625b=a6_0x1fe2f0(this,function(){const _0x1fea18=a6_0x375f;return a6_0x40625b['toString']()[_0x1fea18(0x153)](_0x1fea18(0x19e))[_0x1fea18(0xdd)]()['constructor'](a6_0x40625b)['search'](_0x1fea18(0x19e));});function a6_0x35e4(){const _0x10120c=['isDepthTopic','webrtc_init_session','color','activeSessions','164FLrfqU','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','depthProcessor','startsWith','canvas','size','\x20connection\x20failed,\x20stopping\x20session','getContext','ðŸ¤–\x20Robot\x20Camera','textAlign','push','error','[WebRTC\x20Appliance]\x20Topic\x20','/image_raw','parse','protocol','getActiveSessions','addEventListener','warn','initializeSession','stun:stun.l.google.com:19302','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','Waiting\x20for\x20ROS\x20image\x20data...','subscribe','get','fill','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','sensor_msgs/CompressedImage','now','#ffffff','\x20connection\x20closed,\x20cleaning\x20up','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','convertRGBAtoI420','unsubscribe','[WebRTC\x20Appliance]\x20Session\x20','topicSessions','candidate','addTrack','width','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','\x20successfully\x20connected!','webrtc_ice_candidate','videoSource','\x20for\x20topic:\x20','stringify','pop','../config','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','fillRect','52LzqnCc','7304553ofZrli','handleOffer','message','#666','15799223BQstcR','delete','sensor_msgs/msg/CompressedImage','center','publish','send','drawLoadingPattern','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','beginPath','\x20connection\x20state:\x20','wrtc',',\x20converting\x20to\x20base64...','font','38382nksKeY','msg','topic','/compressedDepth','fillText','toLocaleTimeString','processColorImage','fillStyle','forEach','random','#00aaff','removeEventListener','645580wXIrRU','search','releaseSharedVideoSource','75921MYdpqE',',\x20trying\x20alternative\x20depth\x20topics','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','initializing','15902124vjLKXc','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','keys','function','onFrame','round','framerate','length','#00ff00','initialize','stopSession','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','Topic:\x20','frameCount','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','unknown','max','onicecandidate','updateCanvasWithImageData','#00ffff','16px\x20Arial','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','35AZgybd','port','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','getOrCreateSharedVideoSource','includes','rgba(0,\x20170,\x20255,\x20','videoTrack','height','depth','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','serverWs','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','has','setLocalDescription','\x20image,\x20trying\x20message\x20types:','OPEN','log','ðŸ”\x20Processing\x20depth...','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','createAnswer','[WebRTC\x20Appliance]\x20Created\x20answer','ðŸ”\x20Depth','rosSubscriber','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','ðŸ“¹\x20Color','set',',\x20cleaning\x20up\x20shared\x20resources','type','peerConnection','getImageData','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','data','stop','from','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','\x20sessions\x20remaining)','updateTurnCredentials','./turnCredentialsService','rosbridgeWs','min','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','subscribeToROSTopic','24px\x20Arial','setRemoteDescription','sensor_msgs/msg/Image','(((.+)+)+)+$','addIceCandidate','\x20initialized\x20successfully','#888','sendFrameToVideoSource','connectionState','split','readyState','#1a1a1a','compressed','iceServers','\x20with\x20message\x20type\x20','10px\x20monospace','processDepthImage','replace','session_id','webrtc_offer','getIceServers','connected','toString','video','webrtc_stop_session','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','36zPtKWH','onconnectionstatechange','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','\x20bytes','1800632UJqvpZ','stopAllSessions','webrtc','rtcConfig','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','apply','/compressed','10tusZTj','handleIceCandidate','stun:stun1.l.google.com:19302','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','getSharedVideoSources','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','offer','sharedVideoSources','\x20sessions)','add','handleMessage','webrtc_','sensor_msgs/Image','cleanupSession','44LwsQbl'];a6_0x35e4=function(){return _0x10120c;};return a6_0x35e4();}a6_0x40625b();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x3082f9(0x143)),sharp=require('sharp'),config=require(a6_0x3082f9(0x130)),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require(a6_0x3082f9(0x196));class ApplianceWebRTCService{constructor(){const _0x83ae97=a6_0x3082f9;this[_0x83ae97(0x100)]=new Map(),this['topicSessions']=new Map(),this[_0x83ae97(0xf5)]=new Map(),this[_0x83ae97(0x197)]=null,this[_0x83ae97(0x17b)]=null,this[_0x83ae97(0x104)]=new DepthImageProcessor(),this[_0x83ae97(0xe9)]={'iceServers':[{'urls':_0x83ae97(0x116)},{'urls':_0x83ae97(0xef)}]};}[a6_0x3082f9(0x162)](_0x5303ae,_0x208732){const _0x5510ab=a6_0x3082f9;this[_0x5510ab(0x197)]=_0x5303ae,this[_0x5510ab(0x17b)]=_0x208732,turnCredentialsService[_0x5510ab(0x162)](config['serverUrl']),this[_0x5510ab(0x195)](),console[_0x5510ab(0x181)]('[WebRTC\x20Appliance]\x20Service\x20initialized');}async['updateTurnCredentials'](){const _0x3bd853=a6_0x3082f9;try{console[_0x3bd853(0x181)](_0x3bd853(0xe0));const _0x1b552e=await turnCredentialsService[_0x3bd853(0xdb)]();this[_0x3bd853(0xe9)][_0x3bd853(0x1a8)]=_0x1b552e,console['log'](_0x3bd853(0xea));}catch(_0x24e87f){console[_0x3bd853(0x10d)](_0x3bd853(0xe4),_0x24e87f),console[_0x3bd853(0x181)](_0x3bd853(0x199));}}[a6_0x3082f9(0xf8)](_0x12b574){const _0x4e4ae2=a6_0x3082f9;if(!_0x12b574['op']||!_0x12b574['op']['startsWith'](_0x4e4ae2(0xf9)))return![];console[_0x4e4ae2(0x181)](_0x4e4ae2(0x11c)+_0x12b574['op']);switch(_0x12b574['op']){case _0x4e4ae2(0xfe):this[_0x4e4ae2(0x115)](_0x12b574[_0x4e4ae2(0xd9)],_0x12b574[_0x4e4ae2(0x148)]);return!![];case _0x4e4ae2(0xda):this[_0x4e4ae2(0x136)](_0x12b574[_0x4e4ae2(0xd9)],_0x12b574[_0x4e4ae2(0xf4)]);return!![];case _0x4e4ae2(0x12b):this[_0x4e4ae2(0xee)](_0x12b574['session_id'],_0x12b574['candidate']);return!![];case _0x4e4ae2(0xdf):this[_0x4e4ae2(0x163)](_0x12b574[_0x4e4ae2(0xd9)]);return!![];default:console[_0x4e4ae2(0x114)]('[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20'+_0x12b574['op']);return![];}}[a6_0x3082f9(0x174)](_0x3e18c6){const _0x245606=a6_0x3082f9;if(this[_0x245606(0xf5)]['has'](_0x3e18c6)){const _0x43ac2b=this[_0x245606(0xf5)][_0x245606(0x11a)](_0x3e18c6);return _0x43ac2b[_0x245606(0x166)]++,console[_0x245606(0x181)]('[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x3e18c6+'\x20('+_0x43ac2b[_0x245606(0x166)]+_0x245606(0xf6)),_0x43ac2b;}console[_0x245606(0x181)](_0x245606(0x102)+_0x3e18c6);const {createCanvas:_0x359082}=require('canvas'),_0x31d1f4=_0x359082(config[_0x245606(0xe8)]['video'][_0x245606(0x128)],config[_0x245606(0xe8)][_0x245606(0xde)][_0x245606(0x178)]),_0x4a2b42=_0x31d1f4[_0x245606(0x109)]('2d');this[_0x245606(0x13f)](_0x31d1f4,_0x4a2b42);const {RTCVideoSource:_0x3930f3}=nonstandard,_0x5208e9=new _0x3930f3();let _0x26eed8=0x0;const _0x758f4c=0x3e8/config[_0x245606(0xe8)][_0x245606(0xde)][_0x245606(0x15f)],_0x24833b=this[_0x245606(0x19a)](_0x3e18c6,_0x16f91b=>{const _0x462d7e=_0x245606,_0x3dba1f=Date[_0x462d7e(0x11e)]();_0x3dba1f-_0x26eed8>=_0x758f4c&&(_0x26eed8=_0x3dba1f,this[_0x462d7e(0x16b)](_0x31d1f4,_0x4a2b42,_0x16f91b,_0x3e18c6,_0x5208e9));}),_0x182f19={'videoSource':_0x5208e9,'canvas':_0x31d1f4,'rosSubscriber':_0x24833b,'frameCount':0x1,'topic':_0x3e18c6};return this[_0x245606(0xf5)][_0x245606(0x18a)](_0x3e18c6,_0x182f19),_0x182f19;}['releaseSharedVideoSource'](_0xabf987){const _0x1e1e4a=a6_0x3082f9,_0x1f9b28=this[_0x1e1e4a(0xf5)][_0x1e1e4a(0x11a)](_0xabf987);if(!_0x1f9b28)return;_0x1f9b28[_0x1e1e4a(0x166)]--,console[_0x1e1e4a(0x181)](_0x1e1e4a(0xe3)+_0xabf987+'\x20('+_0x1f9b28[_0x1e1e4a(0x166)]+_0x1e1e4a(0x194)),_0x1f9b28[_0x1e1e4a(0x166)]<=0x0&&(console[_0x1e1e4a(0x181)]('[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20'+_0xabf987+_0x1e1e4a(0x18b)),_0x1f9b28['videoSource']&&(_0x1f9b28[_0x1e1e4a(0x12c)]=null),_0x1f9b28[_0x1e1e4a(0x187)]&&_0x1f9b28[_0x1e1e4a(0x187)][_0x1e1e4a(0x123)](),this['sharedVideoSources'][_0x1e1e4a(0x13a)](_0xabf987));}async[a6_0x3082f9(0x115)](_0x2d68c5,_0x21b9f7){const _0x44f61f=a6_0x3082f9;try{console[_0x44f61f(0x181)]('[WebRTC\x20Appliance]\x20Initializing\x20session\x20'+_0x2d68c5+'\x20for\x20topic\x20'+_0x21b9f7);const _0x51be9d=this[_0x44f61f(0x174)](_0x21b9f7),_0x232bed=new RTCPeerConnection(this[_0x44f61f(0xe9)]),_0x45c0bd=_0x51be9d[_0x44f61f(0x12c)]['createTrack']({'width':config[_0x44f61f(0xe8)]['video'][_0x44f61f(0x128)],'height':config[_0x44f61f(0xe8)]['video'][_0x44f61f(0x178)],'framerate':config[_0x44f61f(0xe8)]['video'][_0x44f61f(0x15f)]});console['log'](_0x44f61f(0x170)+_0x2d68c5);const {MediaStream:_0x2682cc}=require('wrtc'),_0x717dc=new _0x2682cc([_0x45c0bd]);_0x232bed[_0x44f61f(0x127)](_0x45c0bd,_0x717dc),this[_0x44f61f(0x1a2)](_0x51be9d[_0x44f61f(0x12c)],_0x51be9d[_0x44f61f(0x106)]),_0x232bed[_0x44f61f(0x16a)]=_0x55d480=>{const _0x9c2240=_0x44f61f;if(_0x55d480[_0x9c2240(0x126)]&&this['serverWs'])console[_0x9c2240(0x181)](_0x9c2240(0x164)+_0x2d68c5+':',{'type':_0x55d480['candidate'][_0x9c2240(0x18c)],'protocol':_0x55d480[_0x9c2240(0x126)][_0x9c2240(0x111)],'address':_0x55d480['candidate']['address'],'port':_0x55d480['candidate'][_0x9c2240(0x172)]}),this[_0x9c2240(0x17b)]['send'](JSON['stringify']({'op':'webrtc_ice_candidate','session_id':_0x2d68c5,'candidate':_0x55d480[_0x9c2240(0x126)]}));else!_0x55d480[_0x9c2240(0x126)]&&console[_0x9c2240(0x181)](_0x9c2240(0x157)+_0x2d68c5);},_0x232bed[_0x44f61f(0xe2)]=()=>{const _0x54dde7=_0x44f61f;console['log'](_0x54dde7(0x124)+_0x2d68c5+_0x54dde7(0x142)+_0x232bed['connectionState']);if(_0x232bed[_0x54dde7(0x1a3)]===_0x54dde7(0xdc))console['log'](_0x54dde7(0x124)+_0x2d68c5+_0x54dde7(0x12a));else{if(_0x232bed[_0x54dde7(0x1a3)]==='failed')console['log']('[WebRTC\x20Appliance]\x20Session\x20'+_0x2d68c5+_0x54dde7(0x108)),this[_0x54dde7(0x163)](_0x2d68c5);else _0x232bed[_0x54dde7(0x1a3)]==='closed'&&(console['log'](_0x54dde7(0x124)+_0x2d68c5+_0x54dde7(0x120)),this[_0x54dde7(0xfb)](_0x2d68c5));}},this[_0x44f61f(0x100)][_0x44f61f(0x18a)](_0x2d68c5,{'peerConnection':_0x232bed,'topic':_0x21b9f7,'videoTrack':_0x45c0bd,'mediaStream':_0x717dc,'status':_0x44f61f(0x158)}),!this['topicSessions'][_0x44f61f(0x17d)](_0x21b9f7)&&this[_0x44f61f(0x125)][_0x44f61f(0x18a)](_0x21b9f7,new Set()),this['topicSessions']['get'](_0x21b9f7)[_0x44f61f(0xf7)](_0x2d68c5),console[_0x44f61f(0x181)](_0x44f61f(0x124)+_0x2d68c5+_0x44f61f(0x1a0)),console[_0x44f61f(0x181)]('[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20'+_0x21b9f7+':\x20'+this[_0x44f61f(0x125)][_0x44f61f(0x11a)](_0x21b9f7)[_0x44f61f(0x107)]);}catch(_0x4e3ef9){console[_0x44f61f(0x10d)](_0x44f61f(0xf0)+_0x2d68c5+':',_0x4e3ef9),this[_0x44f61f(0x163)](_0x2d68c5);}}async[a6_0x3082f9(0x136)](_0x20282b,_0x36ccc7){const _0x17acaa=a6_0x3082f9,_0x2e9c84=this[_0x17acaa(0x100)]['get'](_0x20282b);if(!_0x2e9c84){console[_0x17acaa(0x10d)](_0x17acaa(0x132)+_0x20282b);return;}try{console['log'](_0x17acaa(0x140)+_0x20282b),await _0x2e9c84[_0x17acaa(0x18d)][_0x17acaa(0x19c)](new RTCSessionDescription(_0x36ccc7)),console['log'](_0x17acaa(0x173));const _0x300062=await _0x2e9c84[_0x17acaa(0x18d)][_0x17acaa(0x184)]();console[_0x17acaa(0x181)](_0x17acaa(0x185)),await _0x2e9c84[_0x17acaa(0x18d)][_0x17acaa(0x17e)](_0x300062),console[_0x17acaa(0x181)]('[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)'),this[_0x17acaa(0x17b)]&&(this[_0x17acaa(0x17b)][_0x17acaa(0x13e)](JSON[_0x17acaa(0x12e)]({'op':'webrtc_answer','session_id':_0x20282b,'answer':_0x300062})),console[_0x17acaa(0x181)](_0x17acaa(0x121)+_0x20282b));}catch(_0xfa4ab5){console['error']('[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20'+_0x20282b+':',_0xfa4ab5),this['stopSession'](_0x20282b);}}async[a6_0x3082f9(0xee)](_0x51d838,_0x2bbc3f){const _0xb20d80=a6_0x3082f9,_0x51062a=this[_0xb20d80(0x100)][_0xb20d80(0x11a)](_0x51d838);if(!_0x51062a){console[_0xb20d80(0x10d)](_0xb20d80(0x183)+_0x51d838);return;}try{await _0x51062a[_0xb20d80(0x18d)][_0xb20d80(0x19f)](new RTCIceCandidate(_0x2bbc3f)),console['log']('[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20'+_0x51d838);}catch(_0xc70551){console[_0xb20d80(0x10d)](_0xb20d80(0x103)+_0x51d838+':',_0xc70551);}}[a6_0x3082f9(0x19a)](_0x31540e,_0xb73a5f){const _0x1f20a5=a6_0x3082f9;if(!this['rosbridgeWs']||this[_0x1f20a5(0x197)][_0x1f20a5(0x1a5)]!==this[_0x1f20a5(0x197)][_0x1f20a5(0x180)])return console[_0x1f20a5(0x10d)](_0x1f20a5(0x129)),null;console[_0x1f20a5(0x181)](_0x1f20a5(0x117)+_0x31540e);const _0x3eb304=_0x31540e[_0x1f20a5(0x175)](_0x1f20a5(0x179)),_0x31370f=_0x31540e[_0x1f20a5(0x175)](_0x1f20a5(0x1a7))||_0x31540e[_0x1f20a5(0x175)]('compressedDepth');let _0x3a9d72=[];_0x3eb304?_0x31370f?_0x3a9d72=[_0x1f20a5(0x11d),_0x1f20a5(0x13b),'compressed_depth_image_transport/CompressedDepthImage',_0x1f20a5(0xfa)]:_0x3a9d72=[_0x1f20a5(0xfa),_0x1f20a5(0x19d),_0x1f20a5(0x11d)]:_0x3a9d72=[_0x1f20a5(0x11d),_0x1f20a5(0x13b),_0x1f20a5(0xfa)];console[_0x1f20a5(0x181)](_0x1f20a5(0x10e)+_0x31540e+'\x20detected\x20as\x20'+(_0x3eb304?_0x1f20a5(0x179):_0x1f20a5(0xff))+_0x1f20a5(0x17f),_0x3a9d72);const _0xcd9810=[];let _0x29969c=![];const _0x3efff9=_0x2ed9ef=>{return _0x243581=>{const _0x5a6e53=a6_0x375f;try{const _0x23cae6=JSON['parse'](_0x243581['data']);_0x23cae6['op']===_0x5a6e53(0x13d)&&_0x23cae6[_0x5a6e53(0x148)]===_0x31540e&&_0x23cae6[_0x5a6e53(0x147)]&&(!_0x29969c&&(console['log'](_0x5a6e53(0x15a)+_0x31540e+_0x5a6e53(0x1a9)+_0x2ed9ef),_0x29969c=!![]),_0xb73a5f(_0x23cae6[_0x5a6e53(0x147)]));}catch(_0x1b7940){console['error']('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x1b7940);}};};for(const _0x490a11 of _0x3a9d72){const _0x1334ec={'op':_0x1f20a5(0x119),'topic':_0x31540e,'type':_0x490a11};console[_0x1f20a5(0x181)](_0x1f20a5(0x17c)+_0x490a11),this['rosbridgeWs']['send'](JSON[_0x1f20a5(0x12e)](_0x1334ec));const _0x4abe63=_0x3efff9(_0x490a11);this[_0x1f20a5(0x197)][_0x1f20a5(0x113)]('message',_0x4abe63),_0xcd9810[_0x1f20a5(0x10c)]({'handler':_0x4abe63,'type':_0x490a11});}return _0x3eb304&&_0x31370f&&setTimeout(()=>{const _0x7157aa=_0x1f20a5;if(!_0x29969c){console[_0x7157aa(0x181)]('[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20'+_0x31540e+_0x7157aa(0x156));const _0x17772d=_0x31540e[_0x7157aa(0xd8)]('/compressedDepth','')[_0x7157aa(0xd8)](_0x7157aa(0xec),''),_0x57750f=[_0x17772d+_0x7157aa(0x10f),_0x17772d+'/image',_0x17772d];for(const _0xafece1 of _0x57750f){console[_0x7157aa(0x181)](_0x7157aa(0x16f)+_0xafece1);const _0x482234={'op':_0x7157aa(0x119),'topic':_0xafece1,'type':_0x7157aa(0xfa)};this['rosbridgeWs'][_0x7157aa(0x13e)](JSON[_0x7157aa(0x12e)](_0x482234));const _0x4c6433=_0x1444e2=>{const _0x5d5363=_0x7157aa;try{const _0x4b9029=JSON[_0x5d5363(0x110)](_0x1444e2[_0x5d5363(0x190)]);_0x4b9029['op']===_0x5d5363(0x13d)&&_0x4b9029['topic']===_0xafece1&&_0x4b9029[_0x5d5363(0x147)]&&(console[_0x5d5363(0x181)](_0x5d5363(0xf3)+_0xafece1+_0x5d5363(0x144)),_0x4b9029[_0x5d5363(0x147)][_0x5d5363(0x190)]&&!_0x4b9029[_0x5d5363(0x147)][_0x5d5363(0x190)][_0x5d5363(0x105)]('/9j/')&&_0xb73a5f(_0x4b9029[_0x5d5363(0x147)]));}catch(_0x4321fd){console['error'](_0x5d5363(0x16e),_0x4321fd);}};this[_0x7157aa(0x197)]['addEventListener'](_0x7157aa(0x137),_0x4c6433),_0xcd9810[_0x7157aa(0x10c)]({'handler':_0x4c6433,'type':_0x7157aa(0xfa),'topic':_0xafece1});}}},0xbb8),{'unsubscribe':()=>{const _0x18e2ae=_0x1f20a5;for(const {handler:_0x3a751a,type:_0x5cea97,topic:_0x374745}of _0xcd9810){this['rosbridgeWs'][_0x18e2ae(0x151)](_0x18e2ae(0x137),_0x3a751a),this[_0x18e2ae(0x197)][_0x18e2ae(0x1a5)]===this[_0x18e2ae(0x197)][_0x18e2ae(0x180)]&&this['rosbridgeWs'][_0x18e2ae(0x13e)](JSON[_0x18e2ae(0x12e)]({'op':_0x18e2ae(0x123),'topic':_0x374745||_0x31540e}));}}};}[a6_0x3082f9(0x13f)](_0x55026e,_0x181372){const _0x4c7b6d=a6_0x3082f9;_0x181372['fillStyle']=_0x4c7b6d(0x1a6),_0x181372['fillRect'](0x0,0x0,_0x55026e[_0x4c7b6d(0x128)],_0x55026e[_0x4c7b6d(0x178)]),_0x181372[_0x4c7b6d(0x14d)]=_0x4c7b6d(0x150),_0x181372[_0x4c7b6d(0x145)]=_0x4c7b6d(0x19b),_0x181372[_0x4c7b6d(0x10b)]='center',_0x181372[_0x4c7b6d(0x14a)](_0x4c7b6d(0x10a),_0x55026e[_0x4c7b6d(0x128)]/0x2,_0x55026e[_0x4c7b6d(0x178)]/0x2-0x14),_0x181372[_0x4c7b6d(0x14d)]='#ffffff',_0x181372[_0x4c7b6d(0x145)]=_0x4c7b6d(0x16d),_0x181372['fillText'](_0x4c7b6d(0x118),_0x55026e[_0x4c7b6d(0x128)]/0x2,_0x55026e[_0x4c7b6d(0x178)]/0x2+0x14);const _0x161b2a=Date['now']()/0x3e8;for(let _0x42a209=0x0;_0x42a209<0x3;_0x42a209++){const _0x3ec071=(Math['sin'](_0x161b2a*0x2+_0x42a209*0.5)+0x1)/0x2;_0x181372[_0x4c7b6d(0x14d)]=_0x4c7b6d(0x176)+_0x3ec071*0.5+')',_0x181372[_0x4c7b6d(0x141)](),_0x181372['arc'](_0x55026e[_0x4c7b6d(0x128)]/0x2-0x28+_0x42a209*0x28,_0x55026e[_0x4c7b6d(0x178)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x181372[_0x4c7b6d(0x11b)]();}}[a6_0x3082f9(0x1a2)](_0x562517,_0x58a1d4){const _0x49820b=a6_0x3082f9;try{if(!_0x562517||!_0x58a1d4)return;const _0x57da99=_0x58a1d4[_0x49820b(0x109)]('2d'),_0x5b6626=_0x57da99[_0x49820b(0x18e)](0x0,0x0,_0x58a1d4['width'],_0x58a1d4['height']),_0x507762=this[_0x49820b(0x122)](_0x5b6626['data'],_0x58a1d4[_0x49820b(0x128)],_0x58a1d4[_0x49820b(0x178)]),_0x5ae798={'width':_0x58a1d4[_0x49820b(0x128)],'height':_0x58a1d4['height'],'data':_0x507762};typeof _0x562517[_0x49820b(0x15d)]===_0x49820b(0x15c)&&_0x562517[_0x49820b(0x15d)](_0x5ae798);}catch(_0x1a5d86){console['error'](_0x49820b(0x193),_0x1a5d86);}}['convertRGBAtoI420'](_0x223ffe,_0x4da1d6,_0x5b8567){const _0x3b07b0=a6_0x3082f9,_0x46d8d9=_0x4da1d6*_0x5b8567,_0x2c0142=_0x4da1d6*_0x5b8567/0x4,_0x2efe92=new Uint8Array(_0x46d8d9+_0x2c0142*0x2);let _0x164698=0x0,_0x5255bc=_0x46d8d9,_0x4fe7ee=_0x46d8d9+_0x2c0142;for(let _0x2af935=0x0;_0x2af935<_0x5b8567;_0x2af935++){for(let _0x57a451=0x0;_0x57a451<_0x4da1d6;_0x57a451++){const _0x3b1640=(_0x2af935*_0x4da1d6+_0x57a451)*0x4,_0x4d35f9=_0x223ffe[_0x3b1640],_0x169488=_0x223ffe[_0x3b1640+0x1],_0x584e8a=_0x223ffe[_0x3b1640+0x2],_0x45470e=Math[_0x3b07b0(0x15e)](0.299*_0x4d35f9+0.587*_0x169488+0.114*_0x584e8a);_0x2efe92[_0x164698++]=_0x45470e;if(_0x2af935%0x2===0x0&&_0x57a451%0x2===0x0){const _0x711cd=Math[_0x3b07b0(0x15e)](-0.169*_0x4d35f9-0.331*_0x169488+0.5*_0x584e8a+0x80),_0x1e70db=Math[_0x3b07b0(0x15e)](0.5*_0x4d35f9-0.419*_0x169488-0.081*_0x584e8a+0x80);_0x2efe92[_0x5255bc++]=Math[_0x3b07b0(0x169)](0x0,Math['min'](0xff,_0x711cd)),_0x2efe92[_0x4fe7ee++]=Math[_0x3b07b0(0x169)](0x0,Math[_0x3b07b0(0x198)](0xff,_0x1e70db));}}}return _0x2efe92;}async['updateCanvasWithImageData'](_0x2a731e,_0x171186,_0x2dc0d2,_0x30b04f,_0xfece52){const _0x37fdb4=a6_0x3082f9;try{if(!_0x2dc0d2||!_0x2dc0d2[_0x37fdb4(0x190)])return;Math['random']()<0.01&&console[_0x37fdb4(0x181)](_0x37fdb4(0x131)+_0x30b04f+',\x20size:\x20'+_0x2dc0d2[_0x37fdb4(0x190)][_0x37fdb4(0x160)]+_0x37fdb4(0xe5));const _0x3edfb9=Buffer[_0x37fdb4(0x192)](_0x2dc0d2['data'],'base64'),_0x3f3f88=this['depthProcessor'][_0x37fdb4(0xfd)](_0x30b04f);let _0x542e79;_0x3f3f88?_0x542e79=await this[_0x37fdb4(0x104)][_0x37fdb4(0x1ab)](_0x3edfb9,_0x2a731e,_0x171186,_0x30b04f):_0x542e79=await this[_0x37fdb4(0x104)][_0x37fdb4(0x14c)](_0x3edfb9,_0x2a731e,_0x171186),_0x171186['putImageData'](_0x542e79,0x0,0x0),_0x171186['fillStyle']='rgba(0,\x200,\x200,\x200.7)',_0x171186[_0x37fdb4(0x133)](0xa,0xa,0xdc,0x32),_0x171186[_0x37fdb4(0x14d)]=_0x3f3f88?_0x37fdb4(0x16c):_0x37fdb4(0x161),_0x171186[_0x37fdb4(0x145)]='12px\x20monospace',_0x171186[_0x37fdb4(0x14a)]((_0x3f3f88?_0x37fdb4(0x186):_0x37fdb4(0x189))+':\x20'+new Date()[_0x37fdb4(0x14b)](),0xf,0x1c),_0x171186['fillStyle']=_0x37fdb4(0x11f),_0x171186[_0x37fdb4(0x145)]=_0x37fdb4(0x1aa),_0x171186[_0x37fdb4(0x14a)](_0x37fdb4(0x165)+_0x30b04f[_0x37fdb4(0x1a4)]('/')[_0x37fdb4(0x12f)](),0xf,0x2d),this['sendFrameToVideoSource'](_0xfece52,_0x2a731e);}catch(_0x1d3a75){console[_0x37fdb4(0x114)]('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x30b04f+':',_0x1d3a75[_0x37fdb4(0x137)]);_0x30b04f['includes']('depth')&&Math[_0x37fdb4(0x14f)]()<0.1&&console[_0x37fdb4(0x114)](_0x37fdb4(0x18f)+_0x30b04f[_0x37fdb4(0xd8)](_0x37fdb4(0x149),'/image_raw'));_0x171186[_0x37fdb4(0x14d)]=_0x37fdb4(0x1a6),_0x171186[_0x37fdb4(0x133)](0x0,0x0,_0x2a731e[_0x37fdb4(0x128)],_0x2a731e[_0x37fdb4(0x178)]),_0x171186[_0x37fdb4(0x14d)]=_0x37fdb4(0x1a1),_0x171186[_0x37fdb4(0x145)]=_0x37fdb4(0x16d),_0x171186[_0x37fdb4(0x10b)]=_0x37fdb4(0x13c);const _0x5e1d1f=_0x30b04f[_0x37fdb4(0x175)]('depth')?_0x37fdb4(0x182):'ðŸ“¹\x20Processing\x20video...';_0x171186['fillText'](_0x5e1d1f,_0x2a731e[_0x37fdb4(0x128)]/0x2,_0x2a731e[_0x37fdb4(0x178)]/0x2),_0x171186[_0x37fdb4(0x14d)]=_0x37fdb4(0x138),_0x171186[_0x37fdb4(0x145)]='12px\x20Arial',_0x171186['fillText'](_0x37fdb4(0x165)+_0x30b04f[_0x37fdb4(0x1a4)]('/')[_0x37fdb4(0x12f)](),_0x2a731e[_0x37fdb4(0x128)]/0x2,_0x2a731e[_0x37fdb4(0x178)]/0x2+0x19),this[_0x37fdb4(0x1a2)](_0xfece52,_0x2a731e);}}['stopSession'](_0xe29755){const _0x294a11=a6_0x3082f9,_0x1a45be=this[_0x294a11(0x100)][_0x294a11(0x11a)](_0xe29755);if(!_0x1a45be){console['warn'](_0x294a11(0x188)+_0xe29755);return;}console['log']('[WebRTC\x20Appliance]\x20Stopping\x20session:\x20'+_0xe29755+_0x294a11(0x12d)+_0x1a45be[_0x294a11(0x148)]);try{this['serverWs']&&this[_0x294a11(0x17b)][_0x294a11(0x1a5)]===this['serverWs'][_0x294a11(0x180)]&&this[_0x294a11(0x17b)]['send'](JSON[_0x294a11(0x12e)]({'op':_0x294a11(0xdf),'session_id':_0xe29755})),_0x1a45be['videoTrack']&&_0x1a45be['videoTrack'][_0x294a11(0x191)](),_0x1a45be[_0x294a11(0x18d)]&&_0x1a45be[_0x294a11(0x18d)]['close']();}catch(_0x38be3a){console[_0x294a11(0x10d)](_0x294a11(0x17a)+_0x38be3a);}this[_0x294a11(0xfb)](_0xe29755);}['cleanupSession'](_0x599867){const _0x56466e=a6_0x3082f9,_0x132dbc=this[_0x56466e(0x100)][_0x56466e(0x11a)](_0x599867);if(_0x132dbc){const _0x568472=this[_0x56466e(0x125)][_0x56466e(0x11a)](_0x132dbc[_0x56466e(0x148)]);_0x568472&&(_0x568472[_0x56466e(0x13a)](_0x599867),_0x568472['size']===0x0&&this[_0x56466e(0x125)][_0x56466e(0x13a)](_0x132dbc[_0x56466e(0x148)])),this[_0x56466e(0x154)](_0x132dbc[_0x56466e(0x148)]);}this[_0x56466e(0x100)][_0x56466e(0x13a)](_0x599867),console['log'](_0x56466e(0x167)+_0x599867);}[a6_0x3082f9(0xe7)](){const _0x40fa29=a6_0x3082f9;console[_0x40fa29(0x181)](_0x40fa29(0xf1));const _0x3b6430=Array[_0x40fa29(0x192)](this[_0x40fa29(0x100)][_0x40fa29(0x15b)]());_0x3b6430[_0x40fa29(0x14e)](_0x52fe39=>this['stopSession'](_0x52fe39));}[a6_0x3082f9(0x112)](){const _0x4bcdb7=a6_0x3082f9,_0x25e4b2=[];for(const [_0x14eeb3,_0x4f4c1d]of this['activeSessions']){_0x25e4b2[_0x4bcdb7(0x10c)]({'sessionId':_0x14eeb3,'topic':_0x4f4c1d[_0x4bcdb7(0x148)],'connectionState':_0x4f4c1d[_0x4bcdb7(0x18d)]?.['connectionState']||_0x4bcdb7(0x168),'hasVideoTrack':!!_0x4f4c1d[_0x4bcdb7(0x177)]});}return _0x25e4b2;}[a6_0x3082f9(0xf2)](){const _0x2a17c5=a6_0x3082f9,_0x305c58=[];for(const [_0x333d85,_0xf0930f]of this[_0x2a17c5(0xf5)]){_0x305c58[_0x2a17c5(0x10c)]({'topic':_0x333d85,'frameCount':_0xf0930f['frameCount'],'hasVideoSource':!!_0xf0930f['videoSource'],'hasRosSubscriber':!!_0xf0930f[_0x2a17c5(0x187)]});}return _0x305c58;}}module['exports']=new ApplianceWebRTCService();