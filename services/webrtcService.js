function a6_0x48b8(_0x4bcfbb,_0x375cb3){const _0x1095e3=a6_0x1d0a();return a6_0x48b8=function(_0x32d214,_0x1b1fb9){_0x32d214=_0x32d214-0x12e;let _0x1d0a2e=_0x1095e3[_0x32d214];return _0x1d0a2e;},a6_0x48b8(_0x4bcfbb,_0x375cb3);}const a6_0xdbf0fa=a6_0x48b8;(function(_0x3e9b65,_0x72808){const _0x52dfbc=a6_0x48b8,_0x84149b=_0x3e9b65();while(!![]){try{const _0x3688d3=parseInt(_0x52dfbc(0x1b7))/0x1*(-parseInt(_0x52dfbc(0x15a))/0x2)+-parseInt(_0x52dfbc(0x16a))/0x3*(parseInt(_0x52dfbc(0x14a))/0x4)+parseInt(_0x52dfbc(0x1a0))/0x5*(parseInt(_0x52dfbc(0x1ce))/0x6)+-parseInt(_0x52dfbc(0x17d))/0x7+-parseInt(_0x52dfbc(0x1b0))/0x8*(parseInt(_0x52dfbc(0x179))/0x9)+parseInt(_0x52dfbc(0x180))/0xa*(parseInt(_0x52dfbc(0x1e8))/0xb)+-parseInt(_0x52dfbc(0x1e5))/0xc*(-parseInt(_0x52dfbc(0x16d))/0xd);if(_0x3688d3===_0x72808)break;else _0x84149b['push'](_0x84149b['shift']());}catch(_0x3cb122){_0x84149b['push'](_0x84149b['shift']());}}}(a6_0x1d0a,0x558c3));const a6_0x1b1fb9=(function(){let _0x35ba57=!![];return function(_0x58024a,_0x3d1449){const _0x5b8019=_0x35ba57?function(){const _0x28dcbb=a6_0x48b8;if(_0x3d1449){const _0x104a91=_0x3d1449[_0x28dcbb(0x135)](_0x58024a,arguments);return _0x3d1449=null,_0x104a91;}}:function(){};return _0x35ba57=![],_0x5b8019;};}()),a6_0x32d214=a6_0x1b1fb9(this,function(){const _0x9a6e7d=a6_0x48b8;return a6_0x32d214[_0x9a6e7d(0x1bd)]()[_0x9a6e7d(0x1ea)](_0x9a6e7d(0x1fe))[_0x9a6e7d(0x1bd)]()[_0x9a6e7d(0x1c7)](a6_0x32d214)[_0x9a6e7d(0x1ea)](_0x9a6e7d(0x1fe));});a6_0x32d214();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0xdbf0fa(0x17f)),sharp=require('sharp'),config=require(a6_0xdbf0fa(0x192)),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require('./turnCredentialsService');class ApplianceWebRTCService{constructor(){const _0x471c22=a6_0xdbf0fa;this['activeSessions']=new Map(),this['topicSessions']=new Map(),this[_0x471c22(0x1c0)]=new Map(),this[_0x471c22(0x1a3)]=null,this[_0x471c22(0x137)]=null,this[_0x471c22(0x1d7)]=new DepthImageProcessor(),this[_0x471c22(0x172)]={'iceServers':[{'urls':_0x471c22(0x145)},{'urls':_0x471c22(0x18b)}]};}[a6_0xdbf0fa(0x17e)](_0x2bb927,_0x26df7b){const _0x398813=a6_0xdbf0fa;this[_0x398813(0x1a3)]=_0x2bb927,this[_0x398813(0x137)]=_0x26df7b,turnCredentialsService[_0x398813(0x17e)](config[_0x398813(0x1e2)]),this['updateTurnCredentials'](),console[_0x398813(0x18a)](_0x398813(0x177));}async[a6_0xdbf0fa(0x12e)](){const _0x2c55da=a6_0xdbf0fa;try{console[_0x2c55da(0x18a)](_0x2c55da(0x156));const _0x426d0d=await turnCredentialsService['getIceServers']();this['rtcConfig'][_0x2c55da(0x1fb)]=_0x426d0d,console[_0x2c55da(0x18a)](_0x2c55da(0x1bb));}catch(_0x505be5){console[_0x2c55da(0x1dd)](_0x2c55da(0x1be),_0x505be5),console[_0x2c55da(0x18a)](_0x2c55da(0x193));}}['handleMessage'](_0x1606f3){const _0x4a3a9c=a6_0xdbf0fa;if(!_0x1606f3['op']||!_0x1606f3['op']['startsWith'](_0x4a3a9c(0x16f)))return![];console[_0x4a3a9c(0x18a)]('[WebRTC\x20Appliance]\x20Handling\x20message:\x20'+_0x1606f3['op']);switch(_0x1606f3['op']){case'webrtc_init_session':this[_0x4a3a9c(0x165)](_0x1606f3[_0x4a3a9c(0x160)],_0x1606f3['topic']);return!![];case _0x4a3a9c(0x1db):this[_0x4a3a9c(0x150)](_0x1606f3[_0x4a3a9c(0x160)],_0x1606f3['offer']);return!![];case _0x4a3a9c(0x1cf):this['handleIceCandidate'](_0x1606f3[_0x4a3a9c(0x160)],_0x1606f3[_0x4a3a9c(0x1ab)]);return!![];case _0x4a3a9c(0x154):this['stopSession'](_0x1606f3[_0x4a3a9c(0x160)]);return!![];default:console[_0x4a3a9c(0x1ff)](_0x4a3a9c(0x1d3)+_0x1606f3['op']);return![];}}[a6_0xdbf0fa(0x139)](_0x35abfb){const _0x29dc6d=a6_0xdbf0fa;if(this[_0x29dc6d(0x1c0)][_0x29dc6d(0x18d)](_0x35abfb)){const _0x5a17dd=this[_0x29dc6d(0x1c0)][_0x29dc6d(0x181)](_0x35abfb);return _0x5a17dd[_0x29dc6d(0x1dc)]++,console[_0x29dc6d(0x18a)]('[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x35abfb+'\x20('+_0x5a17dd['frameCount']+_0x29dc6d(0x19f)),_0x5a17dd;}console[_0x29dc6d(0x18a)]('[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x35abfb);const {createCanvas:_0x16a80b}=require(_0x29dc6d(0x184)),_0x482886=_0x16a80b(config[_0x29dc6d(0x162)][_0x29dc6d(0x15e)][_0x29dc6d(0x166)],config[_0x29dc6d(0x162)][_0x29dc6d(0x15e)]['height']),_0x175c1f=_0x482886[_0x29dc6d(0x149)]('2d');this[_0x29dc6d(0x1b6)](_0x482886,_0x175c1f);const {RTCVideoSource:_0x3a68cd}=nonstandard,_0xacb0b6=new _0x3a68cd();let _0x7cb08d=0x0;const _0x4fd448=0x3e8/config['webrtc'][_0x29dc6d(0x15e)]['framerate'],_0xb2b7aa=this[_0x29dc6d(0x1ec)](_0x35abfb,_0x16b09a=>{const _0x27b1c4=_0x29dc6d,_0x338312=Date[_0x27b1c4(0x13b)]();_0x338312-_0x7cb08d>=_0x4fd448&&(_0x7cb08d=_0x338312,this[_0x27b1c4(0x1e7)](_0x482886,_0x175c1f,_0x16b09a,_0x35abfb,_0xacb0b6));}),_0x268bff={'videoSource':_0xacb0b6,'canvas':_0x482886,'rosSubscriber':_0xb2b7aa,'frameCount':0x1,'topic':_0x35abfb};return this[_0x29dc6d(0x1c0)][_0x29dc6d(0x188)](_0x35abfb,_0x268bff),_0x268bff;}[a6_0xdbf0fa(0x1cc)](_0x14c0e3){const _0x34d534=a6_0xdbf0fa,_0x117181=this[_0x34d534(0x1c0)][_0x34d534(0x181)](_0x14c0e3);if(!_0x117181)return;_0x117181[_0x34d534(0x1dc)]--,console['log'](_0x34d534(0x1c6)+_0x14c0e3+'\x20('+_0x117181[_0x34d534(0x1dc)]+_0x34d534(0x1a9)),_0x117181[_0x34d534(0x1dc)]<=0x0&&(console['log']('[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20'+_0x14c0e3+',\x20cleaning\x20up\x20shared\x20resources'),_0x117181[_0x34d534(0x200)]&&(_0x117181[_0x34d534(0x200)]=null),_0x117181[_0x34d534(0x136)]&&_0x117181[_0x34d534(0x136)][_0x34d534(0x143)](),this[_0x34d534(0x1c0)]['delete'](_0x14c0e3));}async[a6_0xdbf0fa(0x165)](_0x23a8fa,_0x461293){const _0x3e851d=a6_0xdbf0fa;try{console['log'](_0x3e851d(0x1d9)+_0x23a8fa+_0x3e851d(0x1de)+_0x461293);const _0x2c7c04=this['getOrCreateSharedVideoSource'](_0x461293),_0x2abefd=new RTCPeerConnection(this[_0x3e851d(0x172)]),_0x103b20=_0x2c7c04[_0x3e851d(0x200)][_0x3e851d(0x1c5)]({'width':config['webrtc']['video'][_0x3e851d(0x166)],'height':config['webrtc'][_0x3e851d(0x15e)][_0x3e851d(0x15f)],'framerate':config['webrtc'][_0x3e851d(0x15e)]['framerate']});console[_0x3e851d(0x18a)]('[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20'+_0x23a8fa);const {MediaStream:_0x4119f6}=require('wrtc'),_0x4999a2=new _0x4119f6([_0x103b20]);_0x2abefd[_0x3e851d(0x1f9)](_0x103b20,_0x4999a2),this[_0x3e851d(0x147)](_0x2c7c04[_0x3e851d(0x200)],_0x2c7c04['canvas']),_0x2abefd[_0x3e851d(0x138)]=_0x3cfb6c=>{const _0x37f2bf=_0x3e851d;if(_0x3cfb6c[_0x37f2bf(0x1ab)]&&this[_0x37f2bf(0x137)])console[_0x37f2bf(0x18a)]('[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20'+_0x23a8fa+':',{'type':_0x3cfb6c[_0x37f2bf(0x1ab)][_0x37f2bf(0x1b9)],'protocol':_0x3cfb6c['candidate'][_0x37f2bf(0x1e9)],'address':_0x3cfb6c[_0x37f2bf(0x1ab)][_0x37f2bf(0x1b2)],'port':_0x3cfb6c['candidate'][_0x37f2bf(0x19d)]}),this[_0x37f2bf(0x137)][_0x37f2bf(0x19a)](JSON[_0x37f2bf(0x196)]({'op':_0x37f2bf(0x1cf),'session_id':_0x23a8fa,'candidate':_0x3cfb6c[_0x37f2bf(0x1ab)]}));else!_0x3cfb6c[_0x37f2bf(0x1ab)]&&console[_0x37f2bf(0x18a)](_0x37f2bf(0x13f)+_0x23a8fa);},_0x2abefd['onconnectionstatechange']=()=>{const _0x5e73b0=_0x3e851d;console[_0x5e73b0(0x18a)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x23a8fa+_0x5e73b0(0x176)+_0x2abefd['connectionState']);if(_0x2abefd['connectionState']===_0x5e73b0(0x1d4))console['log'](_0x5e73b0(0x1ae)+_0x23a8fa+_0x5e73b0(0x1df));else{if(_0x2abefd[_0x5e73b0(0x1c3)]===_0x5e73b0(0x1e6))console[_0x5e73b0(0x18a)](_0x5e73b0(0x1ae)+_0x23a8fa+_0x5e73b0(0x185)),this[_0x5e73b0(0x18f)](_0x23a8fa);else _0x2abefd[_0x5e73b0(0x1c3)]===_0x5e73b0(0x175)&&(console['log'](_0x5e73b0(0x1ae)+_0x23a8fa+_0x5e73b0(0x133)),this[_0x5e73b0(0x14e)](_0x23a8fa));}},this[_0x3e851d(0x13a)][_0x3e851d(0x188)](_0x23a8fa,{'peerConnection':_0x2abefd,'topic':_0x461293,'videoTrack':_0x103b20,'mediaStream':_0x4999a2,'status':'initializing'}),!this[_0x3e851d(0x1d2)][_0x3e851d(0x18d)](_0x461293)&&this[_0x3e851d(0x1d2)][_0x3e851d(0x188)](_0x461293,new Set()),this['topicSessions']['get'](_0x461293)[_0x3e851d(0x1a8)](_0x23a8fa),console[_0x3e851d(0x18a)](_0x3e851d(0x1ae)+_0x23a8fa+_0x3e851d(0x1bf)),console[_0x3e851d(0x18a)](_0x3e851d(0x1e1)+_0x461293+':\x20'+this[_0x3e851d(0x1d2)][_0x3e851d(0x181)](_0x461293)[_0x3e851d(0x16b)]);}catch(_0x1f45ea){console[_0x3e851d(0x1dd)](_0x3e851d(0x134)+_0x23a8fa+':',_0x1f45ea),this[_0x3e851d(0x18f)](_0x23a8fa);}}async[a6_0xdbf0fa(0x150)](_0x41f068,_0x1f5486){const _0xa18f60=a6_0xdbf0fa,_0x3a0ea5=this[_0xa18f60(0x13a)][_0xa18f60(0x181)](_0x41f068);if(!_0x3a0ea5){console[_0xa18f60(0x1dd)](_0xa18f60(0x1eb)+_0x41f068);return;}try{console[_0xa18f60(0x18a)](_0xa18f60(0x194)+_0x41f068),await _0x3a0ea5['peerConnection'][_0xa18f60(0x159)](new RTCSessionDescription(_0x1f5486)),console[_0xa18f60(0x18a)](_0xa18f60(0x1d5));const _0x40b7ff=await _0x3a0ea5['peerConnection'][_0xa18f60(0x153)]();console[_0xa18f60(0x18a)]('[WebRTC\x20Appliance]\x20Created\x20answer'),await _0x3a0ea5[_0xa18f60(0x183)][_0xa18f60(0x167)](_0x40b7ff),console['log'](_0xa18f60(0x1af)),this[_0xa18f60(0x137)]&&(this[_0xa18f60(0x137)][_0xa18f60(0x19a)](JSON[_0xa18f60(0x196)]({'op':'webrtc_answer','session_id':_0x41f068,'answer':_0x40b7ff})),console[_0xa18f60(0x18a)](_0xa18f60(0x1ac)+_0x41f068));}catch(_0x10feb1){console[_0xa18f60(0x1dd)](_0xa18f60(0x148)+_0x41f068+':',_0x10feb1),this['stopSession'](_0x41f068);}}async['handleIceCandidate'](_0xf864aa,_0x142cd2){const _0x1d1e99=a6_0xdbf0fa,_0x36b150=this[_0x1d1e99(0x13a)][_0x1d1e99(0x181)](_0xf864aa);if(!_0x36b150){console['error'](_0x1d1e99(0x140)+_0xf864aa);return;}try{await _0x36b150[_0x1d1e99(0x183)][_0x1d1e99(0x152)](new RTCIceCandidate(_0x142cd2)),console['log'](_0x1d1e99(0x1ef)+_0xf864aa);}catch(_0x514a8f){console[_0x1d1e99(0x1dd)](_0x1d1e99(0x1a5)+_0xf864aa+':',_0x514a8f);}}[a6_0xdbf0fa(0x1ec)](_0x39a6e4,_0xa28e27){const _0x1da05d=a6_0xdbf0fa;if(!this[_0x1da05d(0x1a3)]||this['rosbridgeWs'][_0x1da05d(0x1a4)]!==this['rosbridgeWs'][_0x1da05d(0x131)])return console[_0x1da05d(0x1dd)](_0x1da05d(0x1ed)),null;console[_0x1da05d(0x18a)](_0x1da05d(0x1da)+_0x39a6e4);const _0x5bbfdf=_0x39a6e4[_0x1da05d(0x157)](_0x1da05d(0x13c)),_0x545cd6=_0x39a6e4[_0x1da05d(0x157)](_0x1da05d(0x1cb))||_0x39a6e4[_0x1da05d(0x157)](_0x1da05d(0x155));let _0x247919=[];_0x5bbfdf?_0x545cd6?_0x247919=[_0x1da05d(0x1ba),'sensor_msgs/msg/CompressedImage','compressed_depth_image_transport/CompressedDepthImage',_0x1da05d(0x1d1)]:_0x247919=['sensor_msgs/Image',_0x1da05d(0x151),_0x1da05d(0x1ba)]:_0x247919=[_0x1da05d(0x1ba),_0x1da05d(0x1f6),_0x1da05d(0x1d1)];console[_0x1da05d(0x18a)](_0x1da05d(0x16e)+_0x39a6e4+_0x1da05d(0x15d)+(_0x5bbfdf?_0x1da05d(0x13c):_0x1da05d(0x1e4))+_0x1da05d(0x18e),_0x247919);const _0x2c9920=[];let _0x62b111=![];const _0x639ee0=_0x236fcc=>{return _0x208711=>{const _0x336aac=a6_0x48b8;try{const _0x1a8bf4=JSON['parse'](_0x208711[_0x336aac(0x14b)]);_0x1a8bf4['op']===_0x336aac(0x1cd)&&_0x1a8bf4['topic']===_0x39a6e4&&_0x1a8bf4[_0x336aac(0x199)]&&(!_0x62b111&&(console[_0x336aac(0x18a)](_0x336aac(0x19c)+_0x39a6e4+_0x336aac(0x1fd)+_0x236fcc),_0x62b111=!![]),_0xa28e27(_0x1a8bf4[_0x336aac(0x199)]));}catch(_0x58d083){console[_0x336aac(0x1dd)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x58d083);}};};for(const _0xebe9da of _0x247919){const _0x2cf731={'op':_0x1da05d(0x1f5),'topic':_0x39a6e4,'type':_0xebe9da};console[_0x1da05d(0x18a)](_0x1da05d(0x1f1)+_0xebe9da),this[_0x1da05d(0x1a3)]['send'](JSON[_0x1da05d(0x196)](_0x2cf731));const _0x400df5=_0x639ee0(_0xebe9da);this[_0x1da05d(0x1a3)]['addEventListener'](_0x1da05d(0x13d),_0x400df5),_0x2c9920[_0x1da05d(0x1c2)]({'handler':_0x400df5,'type':_0xebe9da});}return _0x5bbfdf&&_0x545cd6&&setTimeout(()=>{const _0x15b547=_0x1da05d;if(!_0x62b111){console[_0x15b547(0x18a)](_0x15b547(0x1a7)+_0x39a6e4+_0x15b547(0x1c9));const _0xf0d9e3=_0x39a6e4[_0x15b547(0x130)](_0x15b547(0x1a2),'')[_0x15b547(0x130)](_0x15b547(0x182),''),_0x4e6f35=[_0xf0d9e3+'/image_raw',_0xf0d9e3+_0x15b547(0x195),_0xf0d9e3];for(const _0x4f330e of _0x4e6f35){console[_0x15b547(0x18a)](_0x15b547(0x1ca)+_0x4f330e);const _0x306b90={'op':_0x15b547(0x1f5),'topic':_0x4f330e,'type':_0x15b547(0x1d1)};this[_0x15b547(0x1a3)][_0x15b547(0x19a)](JSON[_0x15b547(0x196)](_0x306b90));const _0x22eab0=_0x28ab28=>{const _0x59d92c=_0x15b547;try{const _0x5b8b22=JSON['parse'](_0x28ab28[_0x59d92c(0x14b)]);_0x5b8b22['op']===_0x59d92c(0x1cd)&&_0x5b8b22[_0x59d92c(0x1fa)]===_0x4f330e&&_0x5b8b22[_0x59d92c(0x199)]&&(console[_0x59d92c(0x18a)](_0x59d92c(0x1b5)+_0x4f330e+',\x20converting\x20to\x20base64...'),_0x5b8b22[_0x59d92c(0x199)][_0x59d92c(0x14b)]&&!_0x5b8b22[_0x59d92c(0x199)]['data'][_0x59d92c(0x1bc)](_0x59d92c(0x15b))&&_0xa28e27(_0x5b8b22['msg']));}catch(_0x371963){console['error'](_0x59d92c(0x1a1),_0x371963);}};this[_0x15b547(0x1a3)][_0x15b547(0x1c8)](_0x15b547(0x13d),_0x22eab0),_0x2c9920[_0x15b547(0x1c2)]({'handler':_0x22eab0,'type':_0x15b547(0x1d1),'topic':_0x4f330e});}}},0xbb8),{'unsubscribe':()=>{const _0x280ebe=_0x1da05d;for(const {handler:_0x1b6213,type:_0x18bb11,topic:_0x9e8f14}of _0x2c9920){this['rosbridgeWs'][_0x280ebe(0x16c)](_0x280ebe(0x13d),_0x1b6213),this[_0x280ebe(0x1a3)]['readyState']===this[_0x280ebe(0x1a3)][_0x280ebe(0x131)]&&this[_0x280ebe(0x1a3)][_0x280ebe(0x19a)](JSON['stringify']({'op':_0x280ebe(0x143),'topic':_0x9e8f14||_0x39a6e4}));}}};}['drawLoadingPattern'](_0x4eca62,_0x561d1b){const _0x31a465=a6_0xdbf0fa;_0x561d1b[_0x31a465(0x1d6)]='#1a1a1a',_0x561d1b[_0x31a465(0x13e)](0x0,0x0,_0x4eca62[_0x31a465(0x166)],_0x4eca62[_0x31a465(0x15f)]),_0x561d1b['fillStyle']='#00aaff',_0x561d1b[_0x31a465(0x1f4)]=_0x31a465(0x17b),_0x561d1b['textAlign']=_0x31a465(0x1d0),_0x561d1b[_0x31a465(0x1e0)](_0x31a465(0x15c),_0x4eca62[_0x31a465(0x166)]/0x2,_0x4eca62[_0x31a465(0x15f)]/0x2-0x14),_0x561d1b[_0x31a465(0x1d6)]='#ffffff',_0x561d1b[_0x31a465(0x1f4)]=_0x31a465(0x174),_0x561d1b['fillText'](_0x31a465(0x1b8),_0x4eca62[_0x31a465(0x166)]/0x2,_0x4eca62[_0x31a465(0x15f)]/0x2+0x14);const _0x46f357=Date[_0x31a465(0x13b)]()/0x3e8;for(let _0x14b5eb=0x0;_0x14b5eb<0x3;_0x14b5eb++){const _0x5808c2=(Math['sin'](_0x46f357*0x2+_0x14b5eb*0.5)+0x1)/0x2;_0x561d1b[_0x31a465(0x1d6)]='rgba(0,\x20170,\x20255,\x20'+_0x5808c2*0.5+')',_0x561d1b[_0x31a465(0x17c)](),_0x561d1b['arc'](_0x4eca62[_0x31a465(0x166)]/0x2-0x28+_0x14b5eb*0x28,_0x4eca62[_0x31a465(0x15f)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x561d1b['fill']();}}['sendFrameToVideoSource'](_0x959ef2,_0x33f1a2){const _0x5ed4f7=a6_0xdbf0fa;try{if(!_0x959ef2||!_0x33f1a2)return;const _0xeb38da=_0x33f1a2[_0x5ed4f7(0x149)]('2d'),_0xe51656=_0xeb38da[_0x5ed4f7(0x1c1)](0x0,0x0,_0x33f1a2['width'],_0x33f1a2[_0x5ed4f7(0x15f)]),_0x401b13=this[_0x5ed4f7(0x1b1)](_0xe51656[_0x5ed4f7(0x14b)],_0x33f1a2['width'],_0x33f1a2['height']),_0x48dcd2={'width':_0x33f1a2['width'],'height':_0x33f1a2[_0x5ed4f7(0x15f)],'data':_0x401b13};typeof _0x959ef2[_0x5ed4f7(0x186)]===_0x5ed4f7(0x187)&&_0x959ef2[_0x5ed4f7(0x186)](_0x48dcd2);}catch(_0x5e1c2e){console['error']('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x5e1c2e);}}[a6_0xdbf0fa(0x1b1)](_0x590034,_0x5b45a0,_0x55209b){const _0x2f06d7=a6_0xdbf0fa,_0x24b09a=_0x5b45a0*_0x55209b,_0x90d330=_0x5b45a0*_0x55209b/0x4,_0x5c54ee=new Uint8Array(_0x24b09a+_0x90d330*0x2);let _0xa16e14=0x0,_0x1451e5=_0x24b09a,_0x3adcc2=_0x24b09a+_0x90d330;for(let _0x5dd8b4=0x0;_0x5dd8b4<_0x55209b;_0x5dd8b4++){for(let _0x54e13c=0x0;_0x54e13c<_0x5b45a0;_0x54e13c++){const _0x502fb4=(_0x5dd8b4*_0x5b45a0+_0x54e13c)*0x4,_0x3e9b1e=_0x590034[_0x502fb4],_0x58c1ce=_0x590034[_0x502fb4+0x1],_0x485dc4=_0x590034[_0x502fb4+0x2],_0x2059db=Math[_0x2f06d7(0x1c4)](0.299*_0x3e9b1e+0.587*_0x58c1ce+0.114*_0x485dc4);_0x5c54ee[_0xa16e14++]=_0x2059db;if(_0x5dd8b4%0x2===0x0&&_0x54e13c%0x2===0x0){const _0x5624cc=Math[_0x2f06d7(0x1c4)](-0.169*_0x3e9b1e-0.331*_0x58c1ce+0.5*_0x485dc4+0x80),_0x1249a1=Math[_0x2f06d7(0x1c4)](0.5*_0x3e9b1e-0.419*_0x58c1ce-0.081*_0x485dc4+0x80);_0x5c54ee[_0x1451e5++]=Math['max'](0x0,Math[_0x2f06d7(0x19e)](0xff,_0x5624cc)),_0x5c54ee[_0x3adcc2++]=Math['max'](0x0,Math['min'](0xff,_0x1249a1));}}}return _0x5c54ee;}async['updateCanvasWithImageData'](_0xa53d84,_0x57637b,_0x4bc0bf,_0x501a6b,_0x3ddc8b){const _0xb51f8e=a6_0xdbf0fa;try{if(!_0x4bc0bf||!_0x4bc0bf[_0xb51f8e(0x14b)])return;Math[_0xb51f8e(0x197)]()<0.01&&console[_0xb51f8e(0x18a)](_0xb51f8e(0x173)+_0x501a6b+',\x20size:\x20'+_0x4bc0bf[_0xb51f8e(0x14b)][_0xb51f8e(0x1d8)]+'\x20bytes');const _0x62b92=Buffer[_0xb51f8e(0x158)](_0x4bc0bf[_0xb51f8e(0x14b)],_0xb51f8e(0x164)),_0x33cc74=this[_0xb51f8e(0x1d7)][_0xb51f8e(0x163)](_0x501a6b);let _0xe2a371;_0x33cc74?_0xe2a371=await this[_0xb51f8e(0x1d7)][_0xb51f8e(0x190)](_0x62b92,_0xa53d84,_0x57637b,_0x501a6b):_0xe2a371=await this[_0xb51f8e(0x1d7)][_0xb51f8e(0x12f)](_0x62b92,_0xa53d84,_0x57637b),_0x57637b['putImageData'](_0xe2a371,0x0,0x0),_0x57637b[_0xb51f8e(0x1d6)]=_0xb51f8e(0x142),_0x57637b[_0xb51f8e(0x13e)](0xa,0xa,0xdc,0x32),_0x57637b[_0xb51f8e(0x1d6)]=_0x33cc74?_0xb51f8e(0x178):_0xb51f8e(0x14d),_0x57637b[_0xb51f8e(0x1f4)]='12px\x20monospace',_0x57637b['fillText']((_0x33cc74?_0xb51f8e(0x14f):_0xb51f8e(0x191))+':\x20'+new Date()[_0xb51f8e(0x18c)](),0xf,0x1c),_0x57637b[_0xb51f8e(0x1d6)]=_0xb51f8e(0x1e3),_0x57637b[_0xb51f8e(0x1f4)]=_0xb51f8e(0x1b3),_0x57637b[_0xb51f8e(0x1e0)](_0xb51f8e(0x1f8)+_0x501a6b[_0xb51f8e(0x1aa)]('/')[_0xb51f8e(0x1f2)](),0xf,0x2d),this[_0xb51f8e(0x147)](_0x3ddc8b,_0xa53d84);}catch(_0x1964c5){console[_0xb51f8e(0x1ff)](_0xb51f8e(0x141)+_0x501a6b+':',_0x1964c5[_0xb51f8e(0x13d)]);_0x501a6b[_0xb51f8e(0x157)](_0xb51f8e(0x13c))&&Math[_0xb51f8e(0x197)]()<0.1&&console[_0xb51f8e(0x1ff)]('[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20'+_0x501a6b[_0xb51f8e(0x130)](_0xb51f8e(0x1a2),_0xb51f8e(0x171)));_0x57637b[_0xb51f8e(0x1d6)]=_0xb51f8e(0x198),_0x57637b[_0xb51f8e(0x13e)](0x0,0x0,_0xa53d84[_0xb51f8e(0x166)],_0xa53d84[_0xb51f8e(0x15f)]),_0x57637b['fillStyle']='#888',_0x57637b[_0xb51f8e(0x1f4)]=_0xb51f8e(0x174),_0x57637b['textAlign']=_0xb51f8e(0x1d0);const _0x3a997d=_0x501a6b[_0xb51f8e(0x157)](_0xb51f8e(0x13c))?_0xb51f8e(0x1f0):_0xb51f8e(0x1f7);_0x57637b[_0xb51f8e(0x1e0)](_0x3a997d,_0xa53d84[_0xb51f8e(0x166)]/0x2,_0xa53d84[_0xb51f8e(0x15f)]/0x2),_0x57637b[_0xb51f8e(0x1d6)]=_0xb51f8e(0x17a),_0x57637b[_0xb51f8e(0x1f4)]=_0xb51f8e(0x169),_0x57637b[_0xb51f8e(0x1e0)](_0xb51f8e(0x1f8)+_0x501a6b[_0xb51f8e(0x1aa)]('/')[_0xb51f8e(0x1f2)](),_0xa53d84['width']/0x2,_0xa53d84[_0xb51f8e(0x15f)]/0x2+0x19),this[_0xb51f8e(0x147)](_0x3ddc8b,_0xa53d84);}}[a6_0xdbf0fa(0x18f)](_0x1c0b62){const _0x48881e=a6_0xdbf0fa,_0x5b59c7=this[_0x48881e(0x13a)][_0x48881e(0x181)](_0x1c0b62);if(!_0x5b59c7){console['warn'](_0x48881e(0x144)+_0x1c0b62);return;}console[_0x48881e(0x18a)](_0x48881e(0x168)+_0x1c0b62+_0x48881e(0x1a6)+_0x5b59c7['topic']);try{this['serverWs']&&this[_0x48881e(0x137)]['readyState']===this[_0x48881e(0x137)][_0x48881e(0x131)]&&this[_0x48881e(0x137)][_0x48881e(0x19a)](JSON[_0x48881e(0x196)]({'op':_0x48881e(0x154),'session_id':_0x1c0b62})),_0x5b59c7[_0x48881e(0x1f3)]&&_0x5b59c7[_0x48881e(0x1f3)][_0x48881e(0x146)](),_0x5b59c7[_0x48881e(0x183)]&&_0x5b59c7[_0x48881e(0x183)][_0x48881e(0x1ad)]();}catch(_0x53d1f3){console[_0x48881e(0x1dd)](_0x48881e(0x19b)+_0x53d1f3);}this[_0x48881e(0x14e)](_0x1c0b62);}[a6_0xdbf0fa(0x14e)](_0x397b25){const _0x3ca296=a6_0xdbf0fa,_0x4302fe=this[_0x3ca296(0x13a)]['get'](_0x397b25);if(_0x4302fe){const _0x2da384=this[_0x3ca296(0x1d2)][_0x3ca296(0x181)](_0x4302fe[_0x3ca296(0x1fa)]);_0x2da384&&(_0x2da384[_0x3ca296(0x14c)](_0x397b25),_0x2da384['size']===0x0&&this[_0x3ca296(0x1d2)][_0x3ca296(0x14c)](_0x4302fe['topic'])),this[_0x3ca296(0x1cc)](_0x4302fe[_0x3ca296(0x1fa)]);}this['activeSessions']['delete'](_0x397b25),console[_0x3ca296(0x18a)](_0x3ca296(0x1fc)+_0x397b25);}[a6_0xdbf0fa(0x189)](){const _0x526d6e=a6_0xdbf0fa;console[_0x526d6e(0x18a)](_0x526d6e(0x1b4));const _0x290289=Array[_0x526d6e(0x158)](this[_0x526d6e(0x13a)][_0x526d6e(0x1ee)]());_0x290289['forEach'](_0x276c46=>this[_0x526d6e(0x18f)](_0x276c46));}[a6_0xdbf0fa(0x170)](){const _0x2f9b7b=a6_0xdbf0fa,_0x37f3fa=[];for(const [_0x4c3819,_0x3557c5]of this[_0x2f9b7b(0x13a)]){_0x37f3fa['push']({'sessionId':_0x4c3819,'topic':_0x3557c5[_0x2f9b7b(0x1fa)],'connectionState':_0x3557c5[_0x2f9b7b(0x183)]?.[_0x2f9b7b(0x1c3)]||_0x2f9b7b(0x161),'hasVideoTrack':!!_0x3557c5[_0x2f9b7b(0x1f3)]});}return _0x37f3fa;}[a6_0xdbf0fa(0x132)](){const _0xc963cc=a6_0xdbf0fa,_0x291f6b=[];for(const [_0x537630,_0x5bc4f7]of this[_0xc963cc(0x1c0)]){_0x291f6b[_0xc963cc(0x1c2)]({'topic':_0x537630,'frameCount':_0x5bc4f7[_0xc963cc(0x1dc)],'hasVideoSource':!!_0x5bc4f7[_0xc963cc(0x200)],'hasRosSubscriber':!!_0x5bc4f7[_0xc963cc(0x136)]});}return _0x291f6b;}}module['exports']=new ApplianceWebRTCService();function a6_0x1d0a(){const _0x43a0c6=['[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','compressed','releaseSharedVideoSource','publish','6auMqqG','webrtc_ice_candidate','center','sensor_msgs/Image','topicSessions','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','connected','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','fillStyle','depthProcessor','length','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','webrtc_offer','frameCount','error','\x20for\x20topic\x20','\x20successfully\x20connected!','fillText','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','serverUrl','#ffffff','color','9324skSmCQ','failed','updateCanvasWithImageData','11FSVMrB','protocol','search','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','subscribeToROSTopic','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','keys','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','üîç\x20Processing\x20depth...','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','pop','videoTrack','font','subscribe','sensor_msgs/msg/CompressedImage','üìπ\x20Processing\x20video...','Topic:\x20','addTrack','topic','iceServers','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','\x20with\x20message\x20type\x20','(((.+)+)+)+$','warn','videoSource','updateTurnCredentials','processColorImage','replace','OPEN','getSharedVideoSources','\x20connection\x20closed,\x20cleaning\x20up','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','apply','rosSubscriber','serverWs','onicecandidate','getOrCreateSharedVideoSource','activeSessions','now','depth','message','fillRect','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','rgba(0,\x200,\x200,\x200.7)','unsubscribe','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','stun:stun.l.google.com:19302','stop','sendFrameToVideoSource','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','getContext','28ozDIML','data','delete','#00ff00','cleanupSession','üîç\x20Depth','handleOffer','sensor_msgs/msg/Image','addIceCandidate','createAnswer','webrtc_stop_session','compressedDepth','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','includes','from','setRemoteDescription','2gCHqty','/9j/','ü§ñ\x20Robot\x20Camera','\x20detected\x20as\x20','video','height','session_id','unknown','webrtc','isDepthTopic','base64','initializeSession','width','setLocalDescription','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','12px\x20Arial','93681pvNHOR','size','removeEventListener','37531JoVriM','[WebRTC\x20Appliance]\x20Topic\x20','webrtc_','getActiveSessions','/image_raw','rtcConfig','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','16px\x20Arial','closed','\x20connection\x20state:\x20','[WebRTC\x20Appliance]\x20Service\x20initialized','#00ffff','36SoMtpY','#666','24px\x20Arial','beginPath','4343045RRwtSi','initialize','wrtc','811430nTPLCE','get','/compressed','peerConnection','canvas','\x20connection\x20failed,\x20stopping\x20session','onFrame','function','set','stopAllSessions','log','stun:stun1.l.google.com:19302','toLocaleTimeString','has','\x20image,\x20trying\x20message\x20types:','stopSession','processDepthImage','üìπ\x20Color','../config','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','/image','stringify','random','#1a1a1a','msg','send','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','port','min','\x20sessions)','119660PcTIbF','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','/compressedDepth','rosbridgeWs','readyState','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','\x20for\x20topic:\x20','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','add','\x20sessions\x20remaining)','split','candidate','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','close','[WebRTC\x20Appliance]\x20Session\x20','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','966520ROLgFI','convertRGBAtoI420','address','10px\x20monospace','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','drawLoadingPattern','675587sFXCvB','Waiting\x20for\x20ROS\x20image\x20data...','type','sensor_msgs/CompressedImage','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','startsWith','toString','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','\x20initialized\x20successfully','sharedVideoSources','getImageData','push','connectionState','round','createTrack','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','constructor','addEventListener',',\x20trying\x20alternative\x20depth\x20topics'];a6_0x1d0a=function(){return _0x43a0c6;};return a6_0x1d0a();}