const a6_0x813527=a6_0x268c;(function(_0x4b9af8,_0x3093c7){const _0xc203c3=a6_0x268c,_0x1e2f18=_0x4b9af8();while(!![]){try{const _0x448777=-parseInt(_0xc203c3(0xc0))/0x1+-parseInt(_0xc203c3(0x8f))/0x2+-parseInt(_0xc203c3(0xd1))/0x3+-parseInt(_0xc203c3(0x7b))/0x4+parseInt(_0xc203c3(0x12f))/0x5+parseInt(_0xc203c3(0xb5))/0x6*(-parseInt(_0xc203c3(0x123))/0x7)+-parseInt(_0xc203c3(0x108))/0x8*(-parseInt(_0xc203c3(0xae))/0x9);if(_0x448777===_0x3093c7)break;else _0x1e2f18['push'](_0x1e2f18['shift']());}catch(_0x5a46ae){_0x1e2f18['push'](_0x1e2f18['shift']());}}}(a6_0x225e,0x44f4b));const a6_0x48256c=(function(){let _0x2d942e=!![];return function(_0x4fbadd,_0x548919){const _0x22eb8f=_0x2d942e?function(){const _0x656dda=a6_0x268c;if(_0x548919){const _0x154e49=_0x548919[_0x656dda(0x132)](_0x4fbadd,arguments);return _0x548919=null,_0x154e49;}}:function(){};return _0x2d942e=![],_0x22eb8f;};}()),a6_0x219474=a6_0x48256c(this,function(){const _0xa5d8bb=a6_0x268c;return a6_0x219474[_0xa5d8bb(0xa9)]()[_0xa5d8bb(0x83)]('(((.+)+)+)+$')['toString']()[_0xa5d8bb(0xb0)](a6_0x219474)[_0xa5d8bb(0x83)](_0xa5d8bb(0x11a));});a6_0x219474();function a6_0x225e(){const _0x4bc08f=['arc','frameCount','ðŸ¤–\x20Robot\x20Camera','isDepthTopic','1793596DfVAZe','webrtc','parse','sharedVideoSources','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','rosSubscriber','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','from','search','offer','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','#00ffff','msg','max','publish','#ffffff','#1a1a1a','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','rtcConfig','protocol','972782mmjAGm','Waiting\x20for\x20ROS\x20image\x20data...','removeEventListener','topic','wrtc','/compressedDepth','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','releaseSharedVideoSource','fillRect','activeSessions','processDepthImage','has','serverUrl','font','subscribe','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Service\x20initialized','split','webrtc_','stun:stun1.l.google.com:19302','fill','createTrack','/compressed','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','toString','keys','video','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','error','1369818oCzGWo','sensor_msgs/CompressedImage','constructor','/image_raw','send','delete',',\x20converting\x20to\x20base64...','6WANJlC','onFrame','24px\x20Arial','session_id','sensor_msgs/msg/CompressedImage','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','webrtc_answer','OPEN','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','function','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','310088GvydiN','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','candidate','sensor_msgs/Image','\x20image,\x20trying\x20message\x20types:','getContext','videoSource','add','ðŸ”\x20Depth','initializeSession','\x20successfully\x20connected!','#888','startsWith','sharp','Topic:\x20','addEventListener','1492926LgWwGl','initialize','[WebRTC\x20Appliance]\x20Session\x20','includes','message','type','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','close','/9j/','getSharedVideoSources','10px\x20monospace','closed','12px\x20monospace','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','length','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','toLocaleTimeString','\x20sessions)','webrtc_stop_session','peerConnection','readyState','round','onconnectionstatechange',',\x20size:\x20','compressedDepth','#00aaff','now','stopAllSessions','sensor_msgs/msg/Image','serverWs','rgba(0,\x20170,\x20255,\x20','compressed_depth_image_transport/CompressedDepthImage','#00ff00','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','sin','videoTrack','unsubscribe','setRemoteDescription','\x20bytes','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','framerate','topicSessions','port','depth','./DepthImageProcessor','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','rgba(0,\x200,\x200,\x200.7)','getOrCreateSharedVideoSource','warn','\x20with\x20message\x20type\x20','failed','stringify','push','120oYbZMh','updateTurnCredentials','data','convertRGBAtoI420','\x20sessions\x20remaining)','forEach','updateCanvasWithImageData','sendFrameToVideoSource','rosbridgeWs','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','canvas','pop','fillStyle','stopSession','replace','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','fillText','(((.+)+)+)+$','random','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','[WebRTC\x20Appliance]\x20Topic\x20','center','beginPath','log','connectionState','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','2963002lymtsm','\x20for\x20topic:\x20','onicecandidate','webrtc_ice_candidate','\x20detected\x20as\x20','height','initializing','drawLoadingPattern','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','createAnswer','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','826095QDmRsc','../config','ðŸ“¹\x20Color','apply','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','\x20initialized\x20successfully','stop','getImageData','addIceCandidate','webrtc_offer','set','16px\x20Arial','handleIceCandidate','/image',',\x20cleaning\x20up\x20shared\x20resources','min','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','width','cleanupSession','depthProcessor','get','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','unknown','getActiveSessions','processColorImage','size','subscribeToROSTopic','ðŸ”\x20Processing\x20depth...','setLocalDescription','base64','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','textAlign'];a6_0x225e=function(){return _0x4bc08f;};return a6_0x225e();}const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x813527(0x93)),sharp=require(a6_0x813527(0xce)),config=require(a6_0x813527(0x130)),DepthImageProcessor=require(a6_0x813527(0xff)),turnCredentialsService=require('./turnCredentialsService');function a6_0x268c(_0x226813,_0x2bbbd7){const _0x214cd4=a6_0x225e();return a6_0x268c=function(_0x219474,_0x48256c){_0x219474=_0x219474-0x75;let _0x225ee7=_0x214cd4[_0x219474];return _0x225ee7;},a6_0x268c(_0x226813,_0x2bbbd7);}class ApplianceWebRTCService{constructor(){const _0x220e88=a6_0x813527;this['activeSessions']=new Map(),this[_0x220e88(0xfc)]=new Map(),this[_0x220e88(0x7e)]=new Map(),this[_0x220e88(0x110)]=null,this[_0x220e88(0xf0)]=null,this[_0x220e88(0x143)]=new DepthImageProcessor(),this[_0x220e88(0x8d)]={'iceServers':[{'urls':'stun:stun.l.google.com:19302'},{'urls':_0x220e88(0xa3)}]};}[a6_0x813527(0xd2)](_0x20d8b3,_0x452aac){const _0x27d099=a6_0x813527;this[_0x27d099(0x110)]=_0x20d8b3,this[_0x27d099(0xf0)]=_0x452aac,turnCredentialsService[_0x27d099(0xd2)](config[_0x27d099(0x9b)]),this[_0x27d099(0x109)](),console[_0x27d099(0x120)](_0x27d099(0xa0));}async[a6_0x813527(0x109)](){const _0x41e7a5=a6_0x813527;try{console[_0x41e7a5(0x120)](_0x41e7a5(0x75));const _0x7fbe08=await turnCredentialsService['getIceServers']();this[_0x41e7a5(0x8d)]['iceServers']=_0x7fbe08,console[_0x41e7a5(0x120)](_0x41e7a5(0xdf));}catch(_0x583099){console[_0x41e7a5(0xad)](_0x41e7a5(0xbf),_0x583099),console[_0x41e7a5(0x120)]('[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers');}}['handleMessage'](_0x539fe0){const _0x238076=a6_0x813527;if(!_0x539fe0['op']||!_0x539fe0['op'][_0x238076(0xcd)](_0x238076(0xa2)))return![];console[_0x238076(0x120)](_0x238076(0x100)+_0x539fe0['op']);switch(_0x539fe0['op']){case'webrtc_init_session':this['initializeSession'](_0x539fe0[_0x238076(0xb8)],_0x539fe0['topic']);return!![];case _0x238076(0x138):this['handleOffer'](_0x539fe0[_0x238076(0xb8)],_0x539fe0[_0x238076(0x84)]);return!![];case _0x238076(0x126):this['handleIceCandidate'](_0x539fe0[_0x238076(0xb8)],_0x539fe0[_0x238076(0xc3)]);return!![];case'webrtc_stop_session':this['stopSession'](_0x539fe0[_0x238076(0xb8)]);return!![];default:console['warn'](_0x238076(0x11c)+_0x539fe0['op']);return![];}}[a6_0x813527(0x102)](_0x37920a){const _0xf84058=a6_0x813527;if(this[_0xf84058(0x7e)][_0xf84058(0x9a)](_0x37920a)){const _0x3fda73=this['sharedVideoSources'][_0xf84058(0x144)](_0x37920a);return _0x3fda73['frameCount']++,console[_0xf84058(0x120)](_0xf84058(0xa8)+_0x37920a+'\x20('+_0x3fda73[_0xf84058(0x78)]+_0xf84058(0xe4)),_0x3fda73;}console['log'](_0xf84058(0x117)+_0x37920a);const {createCanvas:_0x14cc3a}=require('canvas'),_0x2595bf=_0x14cc3a(config[_0xf84058(0x7c)][_0xf84058(0xab)][_0xf84058(0x141)],config[_0xf84058(0x7c)][_0xf84058(0xab)][_0xf84058(0x128)]),_0x23bdeb=_0x2595bf['getContext']('2d');this[_0xf84058(0x12a)](_0x2595bf,_0x23bdeb);const {RTCVideoSource:_0x2fa2dd}=nonstandard,_0x31d79c=new _0x2fa2dd();let _0x24830a=0x0;const _0x34486f=0x3e8/config[_0xf84058(0x7c)][_0xf84058(0xab)]['framerate'],_0x1c8d69=this[_0xf84058(0x14a)](_0x37920a,_0x5a111f=>{const _0x500eec=_0xf84058,_0xbdce8d=Date[_0x500eec(0xed)]();_0xbdce8d-_0x24830a>=_0x34486f&&(_0x24830a=_0xbdce8d,this[_0x500eec(0x10e)](_0x2595bf,_0x23bdeb,_0x5a111f,_0x37920a,_0x31d79c));}),_0x347754={'videoSource':_0x31d79c,'canvas':_0x2595bf,'rosSubscriber':_0x1c8d69,'frameCount':0x1,'topic':_0x37920a};return this[_0xf84058(0x7e)][_0xf84058(0x139)](_0x37920a,_0x347754),_0x347754;}[a6_0x813527(0x96)](_0x1a1cdc){const _0xd1e993=a6_0x813527,_0x5120a5=this[_0xd1e993(0x7e)]['get'](_0x1a1cdc);if(!_0x5120a5)return;_0x5120a5[_0xd1e993(0x78)]--,console[_0xd1e993(0x120)](_0xd1e993(0xa7)+_0x1a1cdc+'\x20('+_0x5120a5[_0xd1e993(0x78)]+_0xd1e993(0x10c)),_0x5120a5[_0xd1e993(0x78)]<=0x0&&(console[_0xd1e993(0x120)](_0xd1e993(0x122)+_0x1a1cdc+_0xd1e993(0x13d)),_0x5120a5[_0xd1e993(0xc7)]&&(_0x5120a5['videoSource']=null),_0x5120a5[_0xd1e993(0x80)]&&_0x5120a5[_0xd1e993(0x80)][_0xd1e993(0xf7)](),this[_0xd1e993(0x7e)][_0xd1e993(0xb3)](_0x1a1cdc));}async[a6_0x813527(0xca)](_0x315c38,_0x57f63a){const _0x4a1405=a6_0x813527;try{console['log'](_0x4a1405(0xd8)+_0x315c38+'\x20for\x20topic\x20'+_0x57f63a);const _0x13a8ee=this[_0x4a1405(0x102)](_0x57f63a),_0x5bc9e7=new RTCPeerConnection(this[_0x4a1405(0x8d)]),_0x45f6f3=_0x13a8ee[_0x4a1405(0xc7)][_0x4a1405(0xa5)]({'width':config[_0x4a1405(0x7c)][_0x4a1405(0xab)][_0x4a1405(0x141)],'height':config['webrtc'][_0x4a1405(0xab)]['height'],'framerate':config['webrtc']['video'][_0x4a1405(0xfb)]});console[_0x4a1405(0x120)](_0x4a1405(0x85)+_0x315c38);const {MediaStream:_0x4f6f45}=require(_0x4a1405(0x93)),_0x3411f1=new _0x4f6f45([_0x45f6f3]);_0x5bc9e7['addTrack'](_0x45f6f3,_0x3411f1),this['sendFrameToVideoSource'](_0x13a8ee[_0x4a1405(0xc7)],_0x13a8ee[_0x4a1405(0x112)]),_0x5bc9e7[_0x4a1405(0x125)]=_0x296b87=>{const _0x5bcc39=_0x4a1405;if(_0x296b87[_0x5bcc39(0xc3)]&&this[_0x5bcc39(0xf0)])console[_0x5bcc39(0x120)](_0x5bcc39(0xac)+_0x315c38+':',{'type':_0x296b87[_0x5bcc39(0xc3)][_0x5bcc39(0xd6)],'protocol':_0x296b87[_0x5bcc39(0xc3)][_0x5bcc39(0x8e)],'address':_0x296b87[_0x5bcc39(0xc3)]['address'],'port':_0x296b87[_0x5bcc39(0xc3)][_0x5bcc39(0xfd)]}),this[_0x5bcc39(0xf0)][_0x5bcc39(0xb2)](JSON[_0x5bcc39(0x106)]({'op':_0x5bcc39(0x126),'session_id':_0x315c38,'candidate':_0x296b87[_0x5bcc39(0xc3)]}));else!_0x296b87['candidate']&&console[_0x5bcc39(0x120)](_0x5bcc39(0x13f)+_0x315c38);},_0x5bc9e7[_0x4a1405(0xe9)]=()=>{const _0x1d9b23=_0x4a1405;console[_0x1d9b23(0x120)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x315c38+'\x20connection\x20state:\x20'+_0x5bc9e7[_0x1d9b23(0x121)]);if(_0x5bc9e7[_0x1d9b23(0x121)]==='connected')console[_0x1d9b23(0x120)](_0x1d9b23(0xd3)+_0x315c38+_0x1d9b23(0xcb));else{if(_0x5bc9e7[_0x1d9b23(0x121)]===_0x1d9b23(0x105))console['log']('[WebRTC\x20Appliance]\x20Session\x20'+_0x315c38+'\x20connection\x20failed,\x20stopping\x20session'),this[_0x1d9b23(0x115)](_0x315c38);else _0x5bc9e7[_0x1d9b23(0x121)]===_0x1d9b23(0xdd)&&(console[_0x1d9b23(0x120)](_0x1d9b23(0xd3)+_0x315c38+'\x20connection\x20closed,\x20cleaning\x20up'),this[_0x1d9b23(0x142)](_0x315c38));}},this[_0x4a1405(0x98)][_0x4a1405(0x139)](_0x315c38,{'peerConnection':_0x5bc9e7,'topic':_0x57f63a,'videoTrack':_0x45f6f3,'mediaStream':_0x3411f1,'status':_0x4a1405(0x129)}),!this['topicSessions'][_0x4a1405(0x9a)](_0x57f63a)&&this[_0x4a1405(0xfc)][_0x4a1405(0x139)](_0x57f63a,new Set()),this[_0x4a1405(0xfc)][_0x4a1405(0x144)](_0x57f63a)[_0x4a1405(0xc8)](_0x315c38),console[_0x4a1405(0x120)](_0x4a1405(0xd3)+_0x315c38+_0x4a1405(0x134)),console[_0x4a1405(0x120)](_0x4a1405(0x9f)+_0x57f63a+':\x20'+this[_0x4a1405(0xfc)][_0x4a1405(0x144)](_0x57f63a)[_0x4a1405(0x149)]);}catch(_0x2ab6c9){console[_0x4a1405(0xad)](_0x4a1405(0x12c)+_0x315c38+':',_0x2ab6c9),this[_0x4a1405(0x115)](_0x315c38);}}async['handleOffer'](_0xa2ba89,_0x1849ba){const _0x563e8a=a6_0x813527,_0x2e7dc3=this[_0x563e8a(0x98)][_0x563e8a(0x144)](_0xa2ba89);if(!_0x2e7dc3){console[_0x563e8a(0xad)](_0x563e8a(0x8c)+_0xa2ba89);return;}try{console[_0x563e8a(0x120)](_0x563e8a(0xbd)+_0xa2ba89),await _0x2e7dc3[_0x563e8a(0xe6)][_0x563e8a(0xf8)](new RTCSessionDescription(_0x1849ba)),console['log']('[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)');const _0x49e57b=await _0x2e7dc3[_0x563e8a(0xe6)][_0x563e8a(0x12d)]();console[_0x563e8a(0x120)]('[WebRTC\x20Appliance]\x20Created\x20answer'),await _0x2e7dc3['peerConnection'][_0x563e8a(0x14c)](_0x49e57b),console['log'](_0x563e8a(0xc2)),this[_0x563e8a(0xf0)]&&(this[_0x563e8a(0xf0)]['send'](JSON[_0x563e8a(0x106)]({'op':_0x563e8a(0xbb),'session_id':_0xa2ba89,'answer':_0x49e57b})),console['log'](_0x563e8a(0x118)+_0xa2ba89));}catch(_0x4e2484){console['error'](_0x563e8a(0xe1)+_0xa2ba89+':',_0x4e2484),this[_0x563e8a(0x115)](_0xa2ba89);}}async[a6_0x813527(0x13b)](_0x54b2ff,_0x54623a){const _0x3739d5=a6_0x813527,_0xc0d97a=this[_0x3739d5(0x98)]['get'](_0x54b2ff);if(!_0xc0d97a){console['error']('[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20'+_0x54b2ff);return;}try{await _0xc0d97a['peerConnection'][_0x3739d5(0x137)](new RTCIceCandidate(_0x54623a)),console[_0x3739d5(0x120)](_0x3739d5(0x95)+_0x54b2ff);}catch(_0x5b4d3e){console[_0x3739d5(0xad)](_0x3739d5(0x145)+_0x54b2ff+':',_0x5b4d3e);}}[a6_0x813527(0x14a)](_0x2e82e0,_0x4488f6){const _0x223b8f=a6_0x813527;if(!this[_0x223b8f(0x110)]||this[_0x223b8f(0x110)][_0x223b8f(0xe7)]!==this[_0x223b8f(0x110)][_0x223b8f(0xbc)])return console['error']('[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected'),null;console[_0x223b8f(0x120)](_0x223b8f(0xba)+_0x2e82e0);const _0x535b65=_0x2e82e0['includes']('depth'),_0xfca647=_0x2e82e0['includes']('compressed')||_0x2e82e0['includes'](_0x223b8f(0xeb));let _0x29681d=[];_0x535b65?_0xfca647?_0x29681d=['sensor_msgs/CompressedImage',_0x223b8f(0xb9),_0x223b8f(0xf2),_0x223b8f(0xc4)]:_0x29681d=['sensor_msgs/Image',_0x223b8f(0xef),'sensor_msgs/CompressedImage']:_0x29681d=[_0x223b8f(0xaf),_0x223b8f(0xb9),_0x223b8f(0xc4)];console['log'](_0x223b8f(0x11d)+_0x2e82e0+_0x223b8f(0x127)+(_0x535b65?_0x223b8f(0xfe):'color')+_0x223b8f(0xc5),_0x29681d);const _0x5d41b6=[];let _0x5bff51=![];const _0x162d59=_0x433d4b=>{return _0x179b72=>{const _0x59655c=a6_0x268c;try{const _0x5b7de2=JSON[_0x59655c(0x7d)](_0x179b72[_0x59655c(0x10a)]);_0x5b7de2['op']===_0x59655c(0x89)&&_0x5b7de2[_0x59655c(0x92)]===_0x2e82e0&&_0x5b7de2[_0x59655c(0x87)]&&(!_0x5bff51&&(console[_0x59655c(0x120)](_0x59655c(0x140)+_0x2e82e0+_0x59655c(0x104)+_0x433d4b),_0x5bff51=!![]),_0x4488f6(_0x5b7de2[_0x59655c(0x87)]));}catch(_0x59f22b){console['error'](_0x59655c(0x111),_0x59f22b);}};};for(const _0x3d2082 of _0x29681d){const _0xaa44a7={'op':_0x223b8f(0x9d),'topic':_0x2e82e0,'type':_0x3d2082};console['log'](_0x223b8f(0xc1)+_0x3d2082),this[_0x223b8f(0x110)][_0x223b8f(0xb2)](JSON['stringify'](_0xaa44a7));const _0x44e465=_0x162d59(_0x3d2082);this[_0x223b8f(0x110)][_0x223b8f(0xd0)](_0x223b8f(0xd5),_0x44e465),_0x5d41b6[_0x223b8f(0x107)]({'handler':_0x44e465,'type':_0x3d2082});}return _0x535b65&&_0xfca647&&setTimeout(()=>{const _0x590306=_0x223b8f;if(!_0x5bff51){console[_0x590306(0x120)](_0x590306(0xd7)+_0x2e82e0+',\x20trying\x20alternative\x20depth\x20topics');const _0x5c63db=_0x2e82e0['replace'](_0x590306(0x94),'')[_0x590306(0x116)](_0x590306(0xa6),''),_0x2a36a4=[_0x5c63db+_0x590306(0xb1),_0x5c63db+_0x590306(0x13c),_0x5c63db];for(const _0x27a3e3 of _0x2a36a4){console['log'](_0x590306(0x133)+_0x27a3e3);const _0x414018={'op':_0x590306(0x9d),'topic':_0x27a3e3,'type':'sensor_msgs/Image'};this[_0x590306(0x110)]['send'](JSON['stringify'](_0x414018));const _0x552201=_0x1523d2=>{const _0x22d399=_0x590306;try{const _0x175213=JSON[_0x22d399(0x7d)](_0x1523d2[_0x22d399(0x10a)]);_0x175213['op']===_0x22d399(0x89)&&_0x175213[_0x22d399(0x92)]===_0x27a3e3&&_0x175213['msg']&&(console[_0x22d399(0x120)](_0x22d399(0xf4)+_0x27a3e3+_0x22d399(0xb4)),_0x175213['msg'][_0x22d399(0x10a)]&&!_0x175213['msg'][_0x22d399(0x10a)][_0x22d399(0xcd)](_0x22d399(0xda))&&_0x4488f6(_0x175213[_0x22d399(0x87)]));}catch(_0x4438c5){console[_0x22d399(0xad)](_0x22d399(0xe2),_0x4438c5);}};this['rosbridgeWs'][_0x590306(0xd0)](_0x590306(0xd5),_0x552201),_0x5d41b6[_0x590306(0x107)]({'handler':_0x552201,'type':'sensor_msgs/Image','topic':_0x27a3e3});}}},0xbb8),{'unsubscribe':()=>{const _0x178006=_0x223b8f;for(const {handler:_0x5949ee,type:_0x34ae6f,topic:_0x162582}of _0x5d41b6){this['rosbridgeWs'][_0x178006(0x91)](_0x178006(0xd5),_0x5949ee),this[_0x178006(0x110)]['readyState']===this['rosbridgeWs']['OPEN']&&this[_0x178006(0x110)][_0x178006(0xb2)](JSON[_0x178006(0x106)]({'op':'unsubscribe','topic':_0x162582||_0x2e82e0}));}}};}['drawLoadingPattern'](_0x1bd50f,_0x2897d7){const _0x5cd36d=a6_0x813527;_0x2897d7[_0x5cd36d(0x114)]=_0x5cd36d(0x8b),_0x2897d7[_0x5cd36d(0x97)](0x0,0x0,_0x1bd50f[_0x5cd36d(0x141)],_0x1bd50f[_0x5cd36d(0x128)]),_0x2897d7[_0x5cd36d(0x114)]=_0x5cd36d(0xec),_0x2897d7['font']=_0x5cd36d(0xb7),_0x2897d7['textAlign']='center',_0x2897d7[_0x5cd36d(0x119)](_0x5cd36d(0x79),_0x1bd50f[_0x5cd36d(0x141)]/0x2,_0x1bd50f[_0x5cd36d(0x128)]/0x2-0x14),_0x2897d7['fillStyle']=_0x5cd36d(0x8a),_0x2897d7[_0x5cd36d(0x9c)]=_0x5cd36d(0x13a),_0x2897d7[_0x5cd36d(0x119)](_0x5cd36d(0x90),_0x1bd50f['width']/0x2,_0x1bd50f['height']/0x2+0x14);const _0x1ba579=Date[_0x5cd36d(0xed)]()/0x3e8;for(let _0x5958f8=0x0;_0x5958f8<0x3;_0x5958f8++){const _0x4d1e7b=(Math[_0x5cd36d(0xf5)](_0x1ba579*0x2+_0x5958f8*0.5)+0x1)/0x2;_0x2897d7[_0x5cd36d(0x114)]=_0x5cd36d(0xf1)+_0x4d1e7b*0.5+')',_0x2897d7[_0x5cd36d(0x11f)](),_0x2897d7[_0x5cd36d(0x77)](_0x1bd50f['width']/0x2-0x28+_0x5958f8*0x28,_0x1bd50f['height']/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x2897d7[_0x5cd36d(0xa4)]();}}['sendFrameToVideoSource'](_0x34a3b6,_0x39ba98){const _0x2cda6f=a6_0x813527;try{if(!_0x34a3b6||!_0x39ba98)return;const _0xbc3466=_0x39ba98[_0x2cda6f(0xc6)]('2d'),_0x101dff=_0xbc3466[_0x2cda6f(0x136)](0x0,0x0,_0x39ba98['width'],_0x39ba98[_0x2cda6f(0x128)]),_0xd9a8c4=this['convertRGBAtoI420'](_0x101dff[_0x2cda6f(0x10a)],_0x39ba98[_0x2cda6f(0x141)],_0x39ba98[_0x2cda6f(0x128)]),_0x2c32f3={'width':_0x39ba98[_0x2cda6f(0x141)],'height':_0x39ba98[_0x2cda6f(0x128)],'data':_0xd9a8c4};typeof _0x34a3b6[_0x2cda6f(0xb6)]===_0x2cda6f(0xbe)&&_0x34a3b6['onFrame'](_0x2c32f3);}catch(_0x36583f){console[_0x2cda6f(0xad)](_0x2cda6f(0x7f),_0x36583f);}}[a6_0x813527(0x10b)](_0x18fd31,_0x31dd0d,_0x24b19e){const _0x16a626=a6_0x813527,_0x2189aa=_0x31dd0d*_0x24b19e,_0x30413a=_0x31dd0d*_0x24b19e/0x4,_0x1720ba=new Uint8Array(_0x2189aa+_0x30413a*0x2);let _0x1bbb55=0x0,_0x272289=_0x2189aa,_0x2337f7=_0x2189aa+_0x30413a;for(let _0x55e350=0x0;_0x55e350<_0x24b19e;_0x55e350++){for(let _0x24c70d=0x0;_0x24c70d<_0x31dd0d;_0x24c70d++){const _0x4e4d44=(_0x55e350*_0x31dd0d+_0x24c70d)*0x4,_0x3ba6a5=_0x18fd31[_0x4e4d44],_0x287b5e=_0x18fd31[_0x4e4d44+0x1],_0x59ce2f=_0x18fd31[_0x4e4d44+0x2],_0x40a4cb=Math[_0x16a626(0xe8)](0.299*_0x3ba6a5+0.587*_0x287b5e+0.114*_0x59ce2f);_0x1720ba[_0x1bbb55++]=_0x40a4cb;if(_0x55e350%0x2===0x0&&_0x24c70d%0x2===0x0){const _0x1165bf=Math[_0x16a626(0xe8)](-0.169*_0x3ba6a5-0.331*_0x287b5e+0.5*_0x59ce2f+0x80),_0x5d034c=Math[_0x16a626(0xe8)](0.5*_0x3ba6a5-0.419*_0x287b5e-0.081*_0x59ce2f+0x80);_0x1720ba[_0x272289++]=Math[_0x16a626(0x88)](0x0,Math[_0x16a626(0x13e)](0xff,_0x1165bf)),_0x1720ba[_0x2337f7++]=Math[_0x16a626(0x88)](0x0,Math[_0x16a626(0x13e)](0xff,_0x5d034c));}}}return _0x1720ba;}async[a6_0x813527(0x10e)](_0x55ea93,_0x24413a,_0x6d64b6,_0x8baf4,_0x27740f){const _0x5b3ba1=a6_0x813527;try{if(!_0x6d64b6||!_0x6d64b6[_0x5b3ba1(0x10a)])return;Math[_0x5b3ba1(0x11b)]()<0.01&&console['log']('[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20'+_0x8baf4+_0x5b3ba1(0xea)+_0x6d64b6[_0x5b3ba1(0x10a)][_0x5b3ba1(0xe0)]+_0x5b3ba1(0xf9));const _0x10a730=Buffer[_0x5b3ba1(0x82)](_0x6d64b6[_0x5b3ba1(0x10a)],_0x5b3ba1(0x14d)),_0x15d2f2=this['depthProcessor'][_0x5b3ba1(0x7a)](_0x8baf4);let _0x3b3272;_0x15d2f2?_0x3b3272=await this[_0x5b3ba1(0x143)][_0x5b3ba1(0x99)](_0x10a730,_0x55ea93,_0x24413a,_0x8baf4):_0x3b3272=await this[_0x5b3ba1(0x143)][_0x5b3ba1(0x148)](_0x10a730,_0x55ea93,_0x24413a),_0x24413a['putImageData'](_0x3b3272,0x0,0x0),_0x24413a['fillStyle']=_0x5b3ba1(0x101),_0x24413a['fillRect'](0xa,0xa,0xdc,0x32),_0x24413a['fillStyle']=_0x15d2f2?_0x5b3ba1(0x86):_0x5b3ba1(0xf3),_0x24413a[_0x5b3ba1(0x9c)]=_0x5b3ba1(0xde),_0x24413a[_0x5b3ba1(0x119)]((_0x15d2f2?_0x5b3ba1(0xc9):_0x5b3ba1(0x131))+':\x20'+new Date()[_0x5b3ba1(0xe3)](),0xf,0x1c),_0x24413a[_0x5b3ba1(0x114)]=_0x5b3ba1(0x8a),_0x24413a[_0x5b3ba1(0x9c)]=_0x5b3ba1(0xdc),_0x24413a[_0x5b3ba1(0x119)](_0x5b3ba1(0xcf)+_0x8baf4[_0x5b3ba1(0xa1)]('/')[_0x5b3ba1(0x113)](),0xf,0x2d),this['sendFrameToVideoSource'](_0x27740f,_0x55ea93);}catch(_0x578052){console[_0x5b3ba1(0x103)](_0x5b3ba1(0x12b)+_0x8baf4+':',_0x578052[_0x5b3ba1(0xd5)]);_0x8baf4['includes']('depth')&&Math['random']()<0.1&&console[_0x5b3ba1(0x103)]('[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20'+_0x8baf4['replace'](_0x5b3ba1(0x94),_0x5b3ba1(0xb1)));_0x24413a[_0x5b3ba1(0x114)]=_0x5b3ba1(0x8b),_0x24413a[_0x5b3ba1(0x97)](0x0,0x0,_0x55ea93['width'],_0x55ea93['height']),_0x24413a[_0x5b3ba1(0x114)]=_0x5b3ba1(0xcc),_0x24413a[_0x5b3ba1(0x9c)]='16px\x20Arial',_0x24413a[_0x5b3ba1(0x76)]=_0x5b3ba1(0x11e);const _0x1dc01b=_0x8baf4[_0x5b3ba1(0xd4)](_0x5b3ba1(0xfe))?_0x5b3ba1(0x14b):'ðŸ“¹\x20Processing\x20video...';_0x24413a[_0x5b3ba1(0x119)](_0x1dc01b,_0x55ea93[_0x5b3ba1(0x141)]/0x2,_0x55ea93[_0x5b3ba1(0x128)]/0x2),_0x24413a[_0x5b3ba1(0x114)]='#666',_0x24413a[_0x5b3ba1(0x9c)]='12px\x20Arial',_0x24413a[_0x5b3ba1(0x119)](_0x5b3ba1(0xcf)+_0x8baf4[_0x5b3ba1(0xa1)]('/')[_0x5b3ba1(0x113)](),_0x55ea93[_0x5b3ba1(0x141)]/0x2,_0x55ea93[_0x5b3ba1(0x128)]/0x2+0x19),this[_0x5b3ba1(0x10f)](_0x27740f,_0x55ea93);}}['stopSession'](_0x1b8eac){const _0x164d94=a6_0x813527,_0x171be2=this['activeSessions'][_0x164d94(0x144)](_0x1b8eac);if(!_0x171be2){console[_0x164d94(0x103)]('[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20'+_0x1b8eac);return;}console['log'](_0x164d94(0x81)+_0x1b8eac+_0x164d94(0x124)+_0x171be2[_0x164d94(0x92)]);try{this['serverWs']&&this[_0x164d94(0xf0)][_0x164d94(0xe7)]===this[_0x164d94(0xf0)][_0x164d94(0xbc)]&&this[_0x164d94(0xf0)][_0x164d94(0xb2)](JSON[_0x164d94(0x106)]({'op':_0x164d94(0xe5),'session_id':_0x1b8eac})),_0x171be2['videoTrack']&&_0x171be2[_0x164d94(0xf6)][_0x164d94(0x135)](),_0x171be2[_0x164d94(0xe6)]&&_0x171be2[_0x164d94(0xe6)][_0x164d94(0xd9)]();}catch(_0x578980){console[_0x164d94(0xad)](_0x164d94(0xfa)+_0x578980);}this[_0x164d94(0x142)](_0x1b8eac);}[a6_0x813527(0x142)](_0x1d0c71){const _0x1cee80=a6_0x813527,_0x44f7e3=this[_0x1cee80(0x98)]['get'](_0x1d0c71);if(_0x44f7e3){const _0x3a98bd=this[_0x1cee80(0xfc)][_0x1cee80(0x144)](_0x44f7e3[_0x1cee80(0x92)]);_0x3a98bd&&(_0x3a98bd[_0x1cee80(0xb3)](_0x1d0c71),_0x3a98bd[_0x1cee80(0x149)]===0x0&&this[_0x1cee80(0xfc)][_0x1cee80(0xb3)](_0x44f7e3[_0x1cee80(0x92)])),this[_0x1cee80(0x96)](_0x44f7e3[_0x1cee80(0x92)]);}this['activeSessions'][_0x1cee80(0xb3)](_0x1d0c71),console[_0x1cee80(0x120)](_0x1cee80(0x12e)+_0x1d0c71);}[a6_0x813527(0xee)](){const _0x5765d2=a6_0x813527;console['log'](_0x5765d2(0x9e));const _0x19ce6d=Array['from'](this[_0x5765d2(0x98)][_0x5765d2(0xaa)]());_0x19ce6d[_0x5765d2(0x10d)](_0x8b3816=>this[_0x5765d2(0x115)](_0x8b3816));}[a6_0x813527(0x147)](){const _0x3b2d54=a6_0x813527,_0x2a93ad=[];for(const [_0x2069b5,_0x277aa8]of this[_0x3b2d54(0x98)]){_0x2a93ad[_0x3b2d54(0x107)]({'sessionId':_0x2069b5,'topic':_0x277aa8[_0x3b2d54(0x92)],'connectionState':_0x277aa8[_0x3b2d54(0xe6)]?.[_0x3b2d54(0x121)]||_0x3b2d54(0x146),'hasVideoTrack':!!_0x277aa8['videoTrack']});}return _0x2a93ad;}[a6_0x813527(0xdb)](){const _0x565aab=a6_0x813527,_0x21dae4=[];for(const [_0x4fa272,_0xe89e48]of this['sharedVideoSources']){_0x21dae4[_0x565aab(0x107)]({'topic':_0x4fa272,'frameCount':_0xe89e48[_0x565aab(0x78)],'hasVideoSource':!!_0xe89e48[_0x565aab(0xc7)],'hasRosSubscriber':!!_0xe89e48[_0x565aab(0x80)]});}return _0x21dae4;}}module['exports']=new ApplianceWebRTCService();