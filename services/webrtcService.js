function a6_0x2c53(_0x271719,_0x39c85e){const _0x3821c6=a6_0x2583();return a6_0x2c53=function(_0x33e101,_0x9d5609){_0x33e101=_0x33e101-0x159;let _0x2583a8=_0x3821c6[_0x33e101];return _0x2583a8;},a6_0x2c53(_0x271719,_0x39c85e);}function a6_0x2583(){const _0x49f67d=['readyState','[WebRTC\x20Appliance]\x20Topic\x20','activeSessions','initialize','includes','videoTrack','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','updateTurnCredentials','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','depthProcessor','min','374jgULWF','pop','video','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','\x20with\x20message\x20type\x20','toString','error','rosSubscriber',',\x20trying\x20alternative\x20depth\x20topics','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','#666','rtcConfig','round','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','releaseSharedVideoSource','Topic:\x20','width','\x20sessions\x20remaining)','center','(((.+)+)+)+$','font','fillRect','get','putImageData','webrtc_ice_candidate','send','sharedVideoSources','addEventListener','startsWith','3XYBhJB','\x20connection\x20closed,\x20cleaning\x20up','12px\x20monospace','285918uddODG','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','onFrame','151062EoMvlL','ðŸ”\x20Depth','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','getActiveSessions','#888','has','/image_raw','../config','fillText','webrtc_offer','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','./DepthImageProcessor','198XPMGkE','videoSource','Waiting\x20for\x20ROS\x20image\x20data...','unknown','wrtc','handleIceCandidate','compressed_depth_image_transport/CompressedDepthImage','initializeSession','log','OPEN','subscribe','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','random','arc',',\x20converting\x20to\x20base64...','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','address','closed','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','topicSessions','#ffffff','getOrCreateSharedVideoSource','from','createAnswer','search','max','webrtc','processColorImage','223080zDsLwT','ðŸ”\x20Processing\x20depth...','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','connectionState','height','\x20detected\x20as\x20','offer','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','webrtc_','warn','#00ff00','\x20initialized\x20successfully','sendFrameToVideoSource','[WebRTC\x20Appliance]\x20Service\x20initialized','/compressedDepth','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','type','framerate','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','fill','getImageData','\x20sessions)','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','cleanupSession','delete','port','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','/9j/','rosbridgeWs','add','24px\x20Arial','\x20connection\x20failed,\x20stopping\x20session','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','stringify','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','webrtc_answer','keys','publish','664813uZCLUV','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','depth','addIceCandidate','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','stopAllSessions','1672968hiDlmz','unsubscribe','constructor','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','ðŸ“¹\x20Processing\x20video...','\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','iceServers','isDepthTopic','session_id','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','base64','convertRGBAtoI420','./turnCredentialsService','failed','close','replace','message','handleOffer','setRemoteDescription','data','getIceServers','topic','createTrack','textAlign','apply','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','initializing','peerConnection','handleMessage','length','getContext','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','exports','401110dguXLY','parse','sensor_msgs/CompressedImage','msg','size','candidate','webrtc_init_session','addTrack','stop','canvas','serverUrl','/image','stopSession','onconnectionstatechange','connected','sensor_msgs/Image','fillStyle','#00aaff',',\x20size:\x20','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','\x20connection\x20state:\x20','setLocalDescription','split','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','webrtc_stop_session','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','#1a1a1a','set','push','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','protocol','21DkIURz','[WebRTC\x20Appliance]\x20Session\x20','rgba(0,\x200,\x200,\x200.7)','now','181768abwXVB','sensor_msgs/msg/CompressedImage','16px\x20Arial','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','getSharedVideoSources','serverWs','frameCount'];a6_0x2583=function(){return _0x49f67d;};return a6_0x2583();}const a6_0x53ef2e=a6_0x2c53;(function(_0x5145e4,_0x808af7){const _0x3c5cb7=a6_0x2c53,_0x4d52cc=_0x5145e4();while(!![]){try{const _0x40602a=parseInt(_0x3c5cb7(0x15d))/0x1+parseInt(_0x3c5cb7(0x1dc))/0x2+parseInt(_0x3c5cb7(0x1d9))/0x3*(parseInt(_0x3c5cb7(0x164))/0x4)+-parseInt(_0x3c5cb7(0x208))/0x5+parseInt(_0x3c5cb7(0x1df))/0x6*(parseInt(_0x3c5cb7(0x1a6))/0x7)+parseInt(_0x3c5cb7(0x1aa))/0x8*(parseInt(_0x3c5cb7(0x1eb))/0x9)+parseInt(_0x3c5cb7(0x187))/0xa*(-parseInt(_0x3c5cb7(0x1bc))/0xb);if(_0x40602a===_0x808af7)break;else _0x4d52cc['push'](_0x4d52cc['shift']());}catch(_0x44a99f){_0x4d52cc['push'](_0x4d52cc['shift']());}}}(a6_0x2583,0x5ff39));const a6_0x9d5609=(function(){let _0xf7af5a=!![];return function(_0xbb033,_0x123621){const _0x43f27d=_0xf7af5a?function(){const _0x4108e2=a6_0x2c53;if(_0x123621){const _0x33af31=_0x123621[_0x4108e2(0x17d)](_0xbb033,arguments);return _0x123621=null,_0x33af31;}}:function(){};return _0xf7af5a=![],_0x43f27d;};}()),a6_0x33e101=a6_0x9d5609(this,function(){const _0x195308=a6_0x2c53;return a6_0x33e101['toString']()[_0x195308(0x204)](_0x195308(0x1cf))[_0x195308(0x1c1)]()[_0x195308(0x166)](a6_0x33e101)['search']('(((.+)+)+)+$');});a6_0x33e101();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x53ef2e(0x1ef)),sharp=require('sharp'),config=require(a6_0x53ef2e(0x1e6)),DepthImageProcessor=require(a6_0x53ef2e(0x1ea)),turnCredentialsService=require(a6_0x53ef2e(0x171));class ApplianceWebRTCService{constructor(){const _0x40e98e=a6_0x53ef2e;this[_0x40e98e(0x1b3)]=new Map(),this[_0x40e98e(0x1ff)]=new Map(),this[_0x40e98e(0x1d6)]=new Map(),this[_0x40e98e(0x224)]=null,this[_0x40e98e(0x1af)]=null,this['depthProcessor']=new DepthImageProcessor(),this[_0x40e98e(0x1c7)]={'iceServers':[{'urls':'stun:stun.l.google.com:19302'},{'urls':'stun:stun1.l.google.com:19302'}]};}[a6_0x53ef2e(0x1b4)](_0x235508,_0x59e6b8){const _0x508e15=a6_0x53ef2e;this[_0x508e15(0x224)]=_0x235508,this[_0x508e15(0x1af)]=_0x59e6b8,turnCredentialsService[_0x508e15(0x1b4)](config[_0x508e15(0x191)]),this[_0x508e15(0x1b8)](),console[_0x508e15(0x1f3)](_0x508e15(0x215));}async[a6_0x53ef2e(0x1b8)](){const _0x24587c=a6_0x53ef2e;try{console[_0x24587c(0x1f3)](_0x24587c(0x19e));const _0x23b850=await turnCredentialsService[_0x24587c(0x179)]();this[_0x24587c(0x1c7)][_0x24587c(0x16b)]=_0x23b850,console[_0x24587c(0x1f3)]('[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully');}catch(_0x21cc9e){console[_0x24587c(0x1c2)](_0x24587c(0x1f6),_0x21cc9e),console[_0x24587c(0x1f3)](_0x24587c(0x20f));}}[a6_0x53ef2e(0x182)](_0x588407){const _0x260795=a6_0x53ef2e;if(!_0x588407['op']||!_0x588407['op'][_0x260795(0x1d8)](_0x260795(0x210)))return![];console[_0x260795(0x1f3)](_0x260795(0x1bf)+_0x588407['op']);switch(_0x588407['op']){case _0x260795(0x18d):this['initializeSession'](_0x588407['session_id'],_0x588407[_0x260795(0x17a)]);return!![];case _0x260795(0x1e8):this[_0x260795(0x176)](_0x588407[_0x260795(0x16d)],_0x588407[_0x260795(0x20e)]);return!![];case'webrtc_ice_candidate':this['handleIceCandidate'](_0x588407[_0x260795(0x16d)],_0x588407['candidate']);return!![];case _0x260795(0x19f):this[_0x260795(0x193)](_0x588407[_0x260795(0x16d)]);return!![];default:console[_0x260795(0x211)](_0x260795(0x1e1)+_0x588407['op']);return![];}}[a6_0x53ef2e(0x201)](_0x52e84a){const _0x1eae5f=a6_0x53ef2e;if(this['sharedVideoSources'][_0x1eae5f(0x1e4)](_0x52e84a)){const _0x2c8cb9=this[_0x1eae5f(0x1d6)]['get'](_0x52e84a);return _0x2c8cb9['frameCount']++,console[_0x1eae5f(0x1f3)](_0x1eae5f(0x17e)+_0x52e84a+'\x20('+_0x2c8cb9['frameCount']+_0x1eae5f(0x21d)),_0x2c8cb9;}console[_0x1eae5f(0x1f3)](_0x1eae5f(0x16e)+_0x52e84a);const {createCanvas:_0x48e79c}=require(_0x1eae5f(0x190)),_0x118072=_0x48e79c(config[_0x1eae5f(0x206)]['video'][_0x1eae5f(0x1cc)],config[_0x1eae5f(0x206)]['video'][_0x1eae5f(0x20c)]),_0x50bfab=_0x118072[_0x1eae5f(0x184)]('2d');this['drawLoadingPattern'](_0x118072,_0x50bfab);const {RTCVideoSource:_0x283616}=nonstandard,_0x17f85d=new _0x283616();let _0x1c8d07=0x0;const _0x51564c=0x3e8/config['webrtc'][_0x1eae5f(0x1be)][_0x1eae5f(0x219)],_0x41284d=this['subscribeToROSTopic'](_0x52e84a,_0x47ead4=>{const _0x1aa8ac=Date['now']();_0x1aa8ac-_0x1c8d07>=_0x51564c&&(_0x1c8d07=_0x1aa8ac,this['updateCanvasWithImageData'](_0x118072,_0x50bfab,_0x47ead4,_0x52e84a,_0x17f85d));}),_0x3dd79c={'videoSource':_0x17f85d,'canvas':_0x118072,'rosSubscriber':_0x41284d,'frameCount':0x1,'topic':_0x52e84a};return this[_0x1eae5f(0x1d6)][_0x1eae5f(0x1a2)](_0x52e84a,_0x3dd79c),_0x3dd79c;}[a6_0x53ef2e(0x1ca)](_0x35544c){const _0x191137=a6_0x53ef2e,_0x24bbaf=this[_0x191137(0x1d6)][_0x191137(0x1d2)](_0x35544c);if(!_0x24bbaf)return;_0x24bbaf[_0x191137(0x1b0)]--,console[_0x191137(0x1f3)](_0x191137(0x20a)+_0x35544c+'\x20('+_0x24bbaf[_0x191137(0x1b0)]+_0x191137(0x1cd)),_0x24bbaf[_0x191137(0x1b0)]<=0x0&&(console[_0x191137(0x1f3)]('[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20'+_0x35544c+',\x20cleaning\x20up\x20shared\x20resources'),_0x24bbaf['videoSource']&&(_0x24bbaf[_0x191137(0x1ec)]=null),_0x24bbaf[_0x191137(0x1c3)]&&_0x24bbaf['rosSubscriber'][_0x191137(0x165)](),this['sharedVideoSources'][_0x191137(0x220)](_0x35544c));}async[a6_0x53ef2e(0x1f2)](_0x402962,_0x440d13){const _0x26daa0=a6_0x53ef2e;try{console['log'](_0x26daa0(0x162)+_0x402962+_0x26daa0(0x169)+_0x440d13);const _0x1fce51=this['getOrCreateSharedVideoSource'](_0x440d13),_0x2682b1=new RTCPeerConnection(this[_0x26daa0(0x1c7)]),_0x4f8b51=_0x1fce51[_0x26daa0(0x1ec)][_0x26daa0(0x17b)]({'width':config[_0x26daa0(0x206)]['video'][_0x26daa0(0x1cc)],'height':config[_0x26daa0(0x206)][_0x26daa0(0x1be)][_0x26daa0(0x20c)],'framerate':config[_0x26daa0(0x206)]['video'][_0x26daa0(0x219)]});console[_0x26daa0(0x1f3)](_0x26daa0(0x1fa)+_0x402962);const {MediaStream:_0x233aa6}=require(_0x26daa0(0x1ef)),_0x13365d=new _0x233aa6([_0x4f8b51]);_0x2682b1[_0x26daa0(0x18e)](_0x4f8b51,_0x13365d),this[_0x26daa0(0x214)](_0x1fce51[_0x26daa0(0x1ec)],_0x1fce51[_0x26daa0(0x190)]),_0x2682b1['onicecandidate']=_0x5a25bd=>{const _0xf6e255=_0x26daa0;if(_0x5a25bd['candidate']&&this[_0xf6e255(0x1af)])console[_0xf6e255(0x1f3)](_0xf6e255(0x217)+_0x402962+':',{'type':_0x5a25bd[_0xf6e255(0x18c)][_0xf6e255(0x218)],'protocol':_0x5a25bd[_0xf6e255(0x18c)][_0xf6e255(0x1a5)],'address':_0x5a25bd['candidate'][_0xf6e255(0x1fb)],'port':_0x5a25bd['candidate'][_0xf6e255(0x221)]}),this['serverWs']['send'](JSON[_0xf6e255(0x229)]({'op':_0xf6e255(0x1d4),'session_id':_0x402962,'candidate':_0x5a25bd[_0xf6e255(0x18c)]}));else!_0x5a25bd[_0xf6e255(0x18c)]&&console['log']('[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20'+_0x402962);},_0x2682b1[_0x26daa0(0x194)]=()=>{const _0x1e28d4=_0x26daa0;console[_0x1e28d4(0x1f3)](_0x1e28d4(0x1a7)+_0x402962+_0x1e28d4(0x19b)+_0x2682b1[_0x1e28d4(0x20b)]);if(_0x2682b1[_0x1e28d4(0x20b)]===_0x1e28d4(0x195))console[_0x1e28d4(0x1f3)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x402962+'\x20successfully\x20connected!');else{if(_0x2682b1[_0x1e28d4(0x20b)]===_0x1e28d4(0x172))console[_0x1e28d4(0x1f3)](_0x1e28d4(0x1a7)+_0x402962+_0x1e28d4(0x227)),this[_0x1e28d4(0x193)](_0x402962);else _0x2682b1[_0x1e28d4(0x20b)]===_0x1e28d4(0x1fc)&&(console[_0x1e28d4(0x1f3)](_0x1e28d4(0x1a7)+_0x402962+_0x1e28d4(0x1da)),this['cleanupSession'](_0x402962));}},this[_0x26daa0(0x1b3)][_0x26daa0(0x1a2)](_0x402962,{'peerConnection':_0x2682b1,'topic':_0x440d13,'videoTrack':_0x4f8b51,'mediaStream':_0x13365d,'status':_0x26daa0(0x180)}),!this[_0x26daa0(0x1ff)][_0x26daa0(0x1e4)](_0x440d13)&&this[_0x26daa0(0x1ff)]['set'](_0x440d13,new Set()),this[_0x26daa0(0x1ff)][_0x26daa0(0x1d2)](_0x440d13)[_0x26daa0(0x225)](_0x402962),console[_0x26daa0(0x1f3)](_0x26daa0(0x1a7)+_0x402962+_0x26daa0(0x213)),console[_0x26daa0(0x1f3)](_0x26daa0(0x1fe)+_0x440d13+':\x20'+this['topicSessions'][_0x26daa0(0x1d2)](_0x440d13)[_0x26daa0(0x18b)]);}catch(_0x2c7a10){console[_0x26daa0(0x1c2)](_0x26daa0(0x1b7)+_0x402962+':',_0x2c7a10),this['stopSession'](_0x402962);}}async[a6_0x53ef2e(0x176)](_0x4470e0,_0x1611fd){const _0x5b9c6f=a6_0x53ef2e,_0x2afeb0=this['activeSessions'][_0x5b9c6f(0x1d2)](_0x4470e0);if(!_0x2afeb0){console[_0x5b9c6f(0x1c2)](_0x5b9c6f(0x15f)+_0x4470e0);return;}try{console[_0x5b9c6f(0x1f3)]('[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20'+_0x4470e0),await _0x2afeb0[_0x5b9c6f(0x181)][_0x5b9c6f(0x177)](new RTCSessionDescription(_0x1611fd)),console[_0x5b9c6f(0x1f3)](_0x5b9c6f(0x1ad));const _0x49867e=await _0x2afeb0[_0x5b9c6f(0x181)][_0x5b9c6f(0x203)]();console[_0x5b9c6f(0x1f3)]('[WebRTC\x20Appliance]\x20Created\x20answer'),await _0x2afeb0['peerConnection'][_0x5b9c6f(0x19c)](_0x49867e),console[_0x5b9c6f(0x1f3)](_0x5b9c6f(0x1a4)),this[_0x5b9c6f(0x1af)]&&(this[_0x5b9c6f(0x1af)]['send'](JSON['stringify']({'op':_0x5b9c6f(0x15a),'session_id':_0x4470e0,'answer':_0x49867e})),console['log']('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0x4470e0));}catch(_0x56a33d){console['error'](_0x5b9c6f(0x15e)+_0x4470e0+':',_0x56a33d),this[_0x5b9c6f(0x193)](_0x4470e0);}}async[a6_0x53ef2e(0x1f0)](_0x4f7e57,_0x389196){const _0x44c819=a6_0x53ef2e,_0x10426b=this[_0x44c819(0x1b3)]['get'](_0x4f7e57);if(!_0x10426b){console['error'](_0x44c819(0x185)+_0x4f7e57);return;}try{await _0x10426b[_0x44c819(0x181)][_0x44c819(0x161)](new RTCIceCandidate(_0x389196)),console[_0x44c819(0x1f3)](_0x44c819(0x1fd)+_0x4f7e57);}catch(_0xec87db){console[_0x44c819(0x1c2)](_0x44c819(0x1b9)+_0x4f7e57+':',_0xec87db);}}['subscribeToROSTopic'](_0x3f0d92,_0x41426c){const _0x398b37=a6_0x53ef2e;if(!this[_0x398b37(0x224)]||this['rosbridgeWs'][_0x398b37(0x1b1)]!==this[_0x398b37(0x224)][_0x398b37(0x1f4)])return console[_0x398b37(0x1c2)](_0x398b37(0x17f)),null;console[_0x398b37(0x1f3)]('[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20'+_0x3f0d92);const _0x3fd040=_0x3f0d92[_0x398b37(0x1b5)](_0x398b37(0x160)),_0x5a990b=_0x3f0d92[_0x398b37(0x1b5)]('compressed')||_0x3f0d92[_0x398b37(0x1b5)]('compressedDepth');let _0x2f2ef1=[];_0x3fd040?_0x5a990b?_0x2f2ef1=[_0x398b37(0x189),_0x398b37(0x1ab),_0x398b37(0x1f1),_0x398b37(0x196)]:_0x2f2ef1=[_0x398b37(0x196),'sensor_msgs/msg/Image',_0x398b37(0x189)]:_0x2f2ef1=[_0x398b37(0x189),_0x398b37(0x1ab),_0x398b37(0x196)];console[_0x398b37(0x1f3)](_0x398b37(0x1b2)+_0x3f0d92+_0x398b37(0x20d)+(_0x3fd040?_0x398b37(0x160):'color')+'\x20image,\x20trying\x20message\x20types:',_0x2f2ef1);const _0x25b5e4=[];let _0x4b5685=![];const _0x4dd744=_0xf1b63d=>{return _0x5b5fd4=>{const _0x530d2e=a6_0x2c53;try{const _0x8762d2=JSON[_0x530d2e(0x188)](_0x5b5fd4['data']);_0x8762d2['op']===_0x530d2e(0x15c)&&_0x8762d2['topic']===_0x3f0d92&&_0x8762d2[_0x530d2e(0x18a)]&&(!_0x4b5685&&(console[_0x530d2e(0x1f3)](_0x530d2e(0x16a)+_0x3f0d92+_0x530d2e(0x1c0)+_0xf1b63d),_0x4b5685=!![]),_0x41426c(_0x8762d2['msg']));}catch(_0x131bd1){console[_0x530d2e(0x1c2)](_0x530d2e(0x228),_0x131bd1);}};};for(const _0x38df82 of _0x2f2ef1){const _0x2ae7b3={'op':'subscribe','topic':_0x3f0d92,'type':_0x38df82};console['log'](_0x398b37(0x167)+_0x38df82),this[_0x398b37(0x224)][_0x398b37(0x1d5)](JSON[_0x398b37(0x229)](_0x2ae7b3));const _0x54bff9=_0x4dd744(_0x38df82);this[_0x398b37(0x224)][_0x398b37(0x1d7)](_0x398b37(0x175),_0x54bff9),_0x25b5e4[_0x398b37(0x1a3)]({'handler':_0x54bff9,'type':_0x38df82});}return _0x3fd040&&_0x5a990b&&setTimeout(()=>{const _0x5e7e8f=_0x398b37;if(!_0x4b5685){console[_0x5e7e8f(0x1f3)](_0x5e7e8f(0x1dd)+_0x3f0d92+_0x5e7e8f(0x1c4));const _0x5d3780=_0x3f0d92[_0x5e7e8f(0x174)](_0x5e7e8f(0x216),'')[_0x5e7e8f(0x174)]('/compressed',''),_0x3bab50=[_0x5d3780+_0x5e7e8f(0x1e5),_0x5d3780+_0x5e7e8f(0x192),_0x5d3780];for(const _0x192ee0 of _0x3bab50){console[_0x5e7e8f(0x1f3)](_0x5e7e8f(0x1e9)+_0x192ee0);const _0x45f496={'op':_0x5e7e8f(0x1f5),'topic':_0x192ee0,'type':'sensor_msgs/Image'};this[_0x5e7e8f(0x224)][_0x5e7e8f(0x1d5)](JSON['stringify'](_0x45f496));const _0x3bc318=_0xce43e7=>{const _0x7cd36d=_0x5e7e8f;try{const _0x533b47=JSON['parse'](_0xce43e7[_0x7cd36d(0x178)]);_0x533b47['op']===_0x7cd36d(0x15c)&&_0x533b47[_0x7cd36d(0x17a)]===_0x192ee0&&_0x533b47['msg']&&(console[_0x7cd36d(0x1f3)]('[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20'+_0x192ee0+_0x7cd36d(0x1f9)),_0x533b47[_0x7cd36d(0x18a)][_0x7cd36d(0x178)]&&!_0x533b47[_0x7cd36d(0x18a)][_0x7cd36d(0x178)][_0x7cd36d(0x1d8)](_0x7cd36d(0x223))&&_0x41426c(_0x533b47[_0x7cd36d(0x18a)]));}catch(_0x1044b3){console[_0x7cd36d(0x1c2)](_0x7cd36d(0x1c5),_0x1044b3);}};this[_0x5e7e8f(0x224)][_0x5e7e8f(0x1d7)](_0x5e7e8f(0x175),_0x3bc318),_0x25b5e4[_0x5e7e8f(0x1a3)]({'handler':_0x3bc318,'type':_0x5e7e8f(0x196),'topic':_0x192ee0});}}},0xbb8),{'unsubscribe':()=>{const _0x276b89=_0x398b37;for(const {handler:_0x51ecfd,type:_0x443d1a,topic:_0x2ba06d}of _0x25b5e4){this[_0x276b89(0x224)]['removeEventListener']('message',_0x51ecfd),this['rosbridgeWs'][_0x276b89(0x1b1)]===this[_0x276b89(0x224)]['OPEN']&&this[_0x276b89(0x224)][_0x276b89(0x1d5)](JSON[_0x276b89(0x229)]({'op':_0x276b89(0x165),'topic':_0x2ba06d||_0x3f0d92}));}}};}['drawLoadingPattern'](_0x44c572,_0x3e8227){const _0x14c39c=a6_0x53ef2e;_0x3e8227[_0x14c39c(0x197)]=_0x14c39c(0x1a1),_0x3e8227[_0x14c39c(0x1d1)](0x0,0x0,_0x44c572[_0x14c39c(0x1cc)],_0x44c572[_0x14c39c(0x20c)]),_0x3e8227['fillStyle']=_0x14c39c(0x198),_0x3e8227['font']=_0x14c39c(0x226),_0x3e8227[_0x14c39c(0x17c)]='center',_0x3e8227[_0x14c39c(0x1e7)]('ðŸ¤–\x20Robot\x20Camera',_0x44c572[_0x14c39c(0x1cc)]/0x2,_0x44c572['height']/0x2-0x14),_0x3e8227[_0x14c39c(0x197)]=_0x14c39c(0x200),_0x3e8227[_0x14c39c(0x1d0)]='16px\x20Arial',_0x3e8227[_0x14c39c(0x1e7)](_0x14c39c(0x1ed),_0x44c572[_0x14c39c(0x1cc)]/0x2,_0x44c572[_0x14c39c(0x20c)]/0x2+0x14);const _0x4342d5=Date[_0x14c39c(0x1a9)]()/0x3e8;for(let _0x100828=0x0;_0x100828<0x3;_0x100828++){const _0x2df1cd=(Math['sin'](_0x4342d5*0x2+_0x100828*0.5)+0x1)/0x2;_0x3e8227[_0x14c39c(0x197)]='rgba(0,\x20170,\x20255,\x20'+_0x2df1cd*0.5+')',_0x3e8227['beginPath'](),_0x3e8227[_0x14c39c(0x1f8)](_0x44c572[_0x14c39c(0x1cc)]/0x2-0x28+_0x100828*0x28,_0x44c572['height']/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x3e8227[_0x14c39c(0x21b)]();}}['sendFrameToVideoSource'](_0x4cf4de,_0x5c012b){const _0x1ae610=a6_0x53ef2e;try{if(!_0x4cf4de||!_0x5c012b)return;const _0x2ad430=_0x5c012b['getContext']('2d'),_0x13bb70=_0x2ad430[_0x1ae610(0x21c)](0x0,0x0,_0x5c012b[_0x1ae610(0x1cc)],_0x5c012b[_0x1ae610(0x20c)]),_0x5147c8=this[_0x1ae610(0x170)](_0x13bb70[_0x1ae610(0x178)],_0x5c012b['width'],_0x5c012b[_0x1ae610(0x20c)]),_0x249059={'width':_0x5c012b[_0x1ae610(0x1cc)],'height':_0x5c012b['height'],'data':_0x5147c8};typeof _0x4cf4de['onFrame']==='function'&&_0x4cf4de[_0x1ae610(0x1de)](_0x249059);}catch(_0x586f61){console[_0x1ae610(0x1c2)]('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x586f61);}}[a6_0x53ef2e(0x170)](_0x29dfdb,_0x14a76e,_0x2fec21){const _0x4fb295=a6_0x53ef2e,_0x4dcc42=_0x14a76e*_0x2fec21,_0x4f2ecf=_0x14a76e*_0x2fec21/0x4,_0x94f756=new Uint8Array(_0x4dcc42+_0x4f2ecf*0x2);let _0x223770=0x0,_0x49fc7b=_0x4dcc42,_0x2c1d32=_0x4dcc42+_0x4f2ecf;for(let _0x3f86b1=0x0;_0x3f86b1<_0x2fec21;_0x3f86b1++){for(let _0x47de99=0x0;_0x47de99<_0x14a76e;_0x47de99++){const _0x297972=(_0x3f86b1*_0x14a76e+_0x47de99)*0x4,_0x197954=_0x29dfdb[_0x297972],_0x58e62d=_0x29dfdb[_0x297972+0x1],_0xbd4c1c=_0x29dfdb[_0x297972+0x2],_0x1166aa=Math[_0x4fb295(0x1c8)](0.299*_0x197954+0.587*_0x58e62d+0.114*_0xbd4c1c);_0x94f756[_0x223770++]=_0x1166aa;if(_0x3f86b1%0x2===0x0&&_0x47de99%0x2===0x0){const _0x85199=Math[_0x4fb295(0x1c8)](-0.169*_0x197954-0.331*_0x58e62d+0.5*_0xbd4c1c+0x80),_0x1df142=Math[_0x4fb295(0x1c8)](0.5*_0x197954-0.419*_0x58e62d-0.081*_0xbd4c1c+0x80);_0x94f756[_0x49fc7b++]=Math[_0x4fb295(0x205)](0x0,Math[_0x4fb295(0x1bb)](0xff,_0x85199)),_0x94f756[_0x2c1d32++]=Math[_0x4fb295(0x205)](0x0,Math[_0x4fb295(0x1bb)](0xff,_0x1df142));}}}return _0x94f756;}async['updateCanvasWithImageData'](_0x4720ff,_0x53bcaf,_0x13ea33,_0x238999,_0x387d1f){const _0x403576=a6_0x53ef2e;try{if(!_0x13ea33||!_0x13ea33['data'])return;Math[_0x403576(0x1f7)]()<0.01&&console['log'](_0x403576(0x19a)+_0x238999+_0x403576(0x199)+_0x13ea33[_0x403576(0x178)][_0x403576(0x183)]+'\x20bytes');const _0x2490d0=Buffer['from'](_0x13ea33[_0x403576(0x178)],_0x403576(0x16f)),_0x1a01de=this[_0x403576(0x1ba)][_0x403576(0x16c)](_0x238999);let _0x2859ea;_0x1a01de?_0x2859ea=await this['depthProcessor']['processDepthImage'](_0x2490d0,_0x4720ff,_0x53bcaf,_0x238999):_0x2859ea=await this['depthProcessor'][_0x403576(0x207)](_0x2490d0,_0x4720ff,_0x53bcaf),_0x53bcaf[_0x403576(0x1d3)](_0x2859ea,0x0,0x0),_0x53bcaf[_0x403576(0x197)]=_0x403576(0x1a8),_0x53bcaf['fillRect'](0xa,0xa,0xdc,0x32),_0x53bcaf['fillStyle']=_0x1a01de?'#00ffff':_0x403576(0x212),_0x53bcaf[_0x403576(0x1d0)]=_0x403576(0x1db),_0x53bcaf['fillText']((_0x1a01de?_0x403576(0x1e0):'ðŸ“¹\x20Color')+':\x20'+new Date()['toLocaleTimeString'](),0xf,0x1c),_0x53bcaf[_0x403576(0x197)]=_0x403576(0x200),_0x53bcaf[_0x403576(0x1d0)]='10px\x20monospace',_0x53bcaf[_0x403576(0x1e7)](_0x403576(0x1cb)+_0x238999[_0x403576(0x19d)]('/')['pop'](),0xf,0x2d),this['sendFrameToVideoSource'](_0x387d1f,_0x4720ff);}catch(_0x1f745a){console[_0x403576(0x211)]('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x238999+':',_0x1f745a[_0x403576(0x175)]);_0x238999[_0x403576(0x1b5)](_0x403576(0x160))&&Math[_0x403576(0x1f7)]()<0.1&&console[_0x403576(0x211)](_0x403576(0x159)+_0x238999[_0x403576(0x174)](_0x403576(0x216),'/image_raw'));_0x53bcaf[_0x403576(0x197)]=_0x403576(0x1a1),_0x53bcaf[_0x403576(0x1d1)](0x0,0x0,_0x4720ff[_0x403576(0x1cc)],_0x4720ff[_0x403576(0x20c)]),_0x53bcaf[_0x403576(0x197)]=_0x403576(0x1e3),_0x53bcaf[_0x403576(0x1d0)]=_0x403576(0x1ac),_0x53bcaf[_0x403576(0x17c)]=_0x403576(0x1ce);const _0x4a1bce=_0x238999[_0x403576(0x1b5)](_0x403576(0x160))?_0x403576(0x209):_0x403576(0x168);_0x53bcaf[_0x403576(0x1e7)](_0x4a1bce,_0x4720ff[_0x403576(0x1cc)]/0x2,_0x4720ff[_0x403576(0x20c)]/0x2),_0x53bcaf[_0x403576(0x197)]=_0x403576(0x1c6),_0x53bcaf[_0x403576(0x1d0)]='12px\x20Arial',_0x53bcaf[_0x403576(0x1e7)](_0x403576(0x1cb)+_0x238999[_0x403576(0x19d)]('/')[_0x403576(0x1bd)](),_0x4720ff[_0x403576(0x1cc)]/0x2,_0x4720ff[_0x403576(0x20c)]/0x2+0x19),this[_0x403576(0x214)](_0x387d1f,_0x4720ff);}}[a6_0x53ef2e(0x193)](_0x27a4a9){const _0x159fe6=a6_0x53ef2e,_0x2e1afc=this[_0x159fe6(0x1b3)]['get'](_0x27a4a9);if(!_0x2e1afc){console['warn'](_0x159fe6(0x222)+_0x27a4a9);return;}console[_0x159fe6(0x1f3)](_0x159fe6(0x1a0)+_0x27a4a9+'\x20for\x20topic:\x20'+_0x2e1afc['topic']);try{this[_0x159fe6(0x1af)]&&this['serverWs']['readyState']===this['serverWs'][_0x159fe6(0x1f4)]&&this['serverWs']['send'](JSON[_0x159fe6(0x229)]({'op':_0x159fe6(0x19f),'session_id':_0x27a4a9})),_0x2e1afc[_0x159fe6(0x1b6)]&&_0x2e1afc[_0x159fe6(0x1b6)][_0x159fe6(0x18f)](),_0x2e1afc[_0x159fe6(0x181)]&&_0x2e1afc[_0x159fe6(0x181)][_0x159fe6(0x173)]();}catch(_0x20473f){console['error'](_0x159fe6(0x1c9)+_0x20473f);}this[_0x159fe6(0x21f)](_0x27a4a9);}['cleanupSession'](_0x406541){const _0x3b6e2a=a6_0x53ef2e,_0x16ca6b=this['activeSessions'][_0x3b6e2a(0x1d2)](_0x406541);if(_0x16ca6b){const _0x5ed86e=this[_0x3b6e2a(0x1ff)][_0x3b6e2a(0x1d2)](_0x16ca6b[_0x3b6e2a(0x17a)]);_0x5ed86e&&(_0x5ed86e[_0x3b6e2a(0x220)](_0x406541),_0x5ed86e[_0x3b6e2a(0x18b)]===0x0&&this[_0x3b6e2a(0x1ff)][_0x3b6e2a(0x220)](_0x16ca6b['topic'])),this[_0x3b6e2a(0x1ca)](_0x16ca6b[_0x3b6e2a(0x17a)]);}this[_0x3b6e2a(0x1b3)][_0x3b6e2a(0x220)](_0x406541),console[_0x3b6e2a(0x1f3)](_0x3b6e2a(0x21a)+_0x406541);}[a6_0x53ef2e(0x163)](){const _0x2f075b=a6_0x53ef2e;console[_0x2f075b(0x1f3)](_0x2f075b(0x21e));const _0x461084=Array[_0x2f075b(0x202)](this[_0x2f075b(0x1b3)][_0x2f075b(0x15b)]());_0x461084['forEach'](_0x92aa29=>this[_0x2f075b(0x193)](_0x92aa29));}[a6_0x53ef2e(0x1e2)](){const _0x5372f4=a6_0x53ef2e,_0x4046d0=[];for(const [_0x7cef8c,_0x45e6af]of this['activeSessions']){_0x4046d0[_0x5372f4(0x1a3)]({'sessionId':_0x7cef8c,'topic':_0x45e6af[_0x5372f4(0x17a)],'connectionState':_0x45e6af['peerConnection']?.[_0x5372f4(0x20b)]||_0x5372f4(0x1ee),'hasVideoTrack':!!_0x45e6af[_0x5372f4(0x1b6)]});}return _0x4046d0;}[a6_0x53ef2e(0x1ae)](){const _0x20218b=a6_0x53ef2e,_0x3761e5=[];for(const [_0x288b44,_0x28331e]of this[_0x20218b(0x1d6)]){_0x3761e5[_0x20218b(0x1a3)]({'topic':_0x288b44,'frameCount':_0x28331e[_0x20218b(0x1b0)],'hasVideoSource':!!_0x28331e['videoSource'],'hasRosSubscriber':!!_0x28331e[_0x20218b(0x1c3)]});}return _0x3761e5;}}module[a6_0x53ef2e(0x186)]=new ApplianceWebRTCService();