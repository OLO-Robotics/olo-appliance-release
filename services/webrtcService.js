const a6_0x46cf95=a6_0x2667;(function(_0x43af89,_0x2e3e80){const _0x4844be=a6_0x2667,_0x195f5d=_0x43af89();while(!![]){try{const _0x5df0a3=-parseInt(_0x4844be(0x17c))/0x1*(parseInt(_0x4844be(0x1a3))/0x2)+-parseInt(_0x4844be(0x181))/0x3*(-parseInt(_0x4844be(0x15b))/0x4)+-parseInt(_0x4844be(0x15c))/0x5*(-parseInt(_0x4844be(0x17d))/0x6)+-parseInt(_0x4844be(0x114))/0x7*(parseInt(_0x4844be(0x1a2))/0x8)+parseInt(_0x4844be(0x193))/0x9*(-parseInt(_0x4844be(0x180))/0xa)+parseInt(_0x4844be(0x139))/0xb*(-parseInt(_0x4844be(0xe8))/0xc)+parseInt(_0x4844be(0x145))/0xd*(parseInt(_0x4844be(0x18a))/0xe);if(_0x5df0a3===_0x2e3e80)break;else _0x195f5d['push'](_0x195f5d['shift']());}catch(_0x734627){_0x195f5d['push'](_0x195f5d['shift']());}}}(a6_0x82b1,0x9a972));function a6_0x82b1(){const _0x19986f=['drawLoadingPattern','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','getSharedVideoSources','addTrack','updateTurnCredentials','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','rtcConfig','initializing','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','apply','\x20connection\x20state:\x20','\x20sessions\x20remaining)','sharedVideoSources','readyState',',\x20converting\x20to\x20base64...','10px\x20monospace','peerConnection','getOrCreateSharedVideoSource','\x20for\x20topic:\x20','initializeSession','round','2gcLPmn','12nuTOcc','from','putImageData','10KUpsBR','3PvxEqr','unsubscribe','framerate','onicecandidate','fill','\x20connection\x20failed,\x20stopping\x20session','exports','serverUrl','webrtc_ice_candidate','3170608bxgtky','#888','rosSubscriber','sensor_msgs/msg/Image','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','\x20initialized\x20successfully','startsWith','rgba(0,\x20170,\x20255,\x20','#ffffff','9756558CsfePX','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','video','msg','candidate','convertRGBAtoI420','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','topicSessions','toString','🔍\x20Processing\x20depth...','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','addIceCandidate','releaseSharedVideoSource','data','4632JkBZkE','1016102amOKxT','Topic:\x20','16px\x20Arial','/compressedDepth','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','webrtc_init_session','connectionState','canvas','min',',\x20cleaning\x20up\x20shared\x20resources','\x20connection\x20closed,\x20cleaning\x20up','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','webrtc_stop_session','#00ffff','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','🤖\x20Robot\x20Camera','cleanupSession','topic','search','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','removeEventListener','/compressed','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','10044kEjUWs','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','log','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','width','handleIceCandidate','Waiting\x20for\x20ROS\x20image\x20data...','sensor_msgs/Image','connected','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','fillRect','toLocaleTimeString','font','\x20bytes','./DepthImageProcessor','depthProcessor','24px\x20Arial','updateCanvasWithImageData','sin','rosbridgeWs','subscribe','sendFrameToVideoSource','activeSessions','random','color','keys','📹\x20Processing\x20video...','textAlign','compressed_depth_image_transport/CompressedDepthImage','[WebRTC\x20Appliance]\x20Created\x20answer','\x20detected\x20as\x20','includes','getImageData','type','OPEN','address','stopAllSessions','has','replace','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','onFrame','rgba(0,\x200,\x200,\x200.7)','now','fillStyle','12859qSiKBe','./turnCredentialsService','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','error','send','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','split','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','frameCount','stringify',',\x20size:\x20','\x20for\x20topic\x20','arc','12px\x20Arial','height','delete','videoSource','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','depth','subscribeToROSTopic','port','stun:stun1.l.google.com:19302','/image','processDepthImage','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','size','🔍\x20Depth','stop','serverWs','(((.+)+)+)+$','getContext','center','warn','processColorImage','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','message','10791qZjFPP','stun:stun.l.google.com:19302','offer','sensor_msgs/msg/CompressedImage','../config','max','sensor_msgs/CompressedImage','handleOffer','initialize','[WebRTC\x20Appliance]\x20Session\x20','session_id','#1a1a1a','169zfFjaD','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','compressed','#00ff00','createAnswer','videoTrack','parse','close','getActiveSessions','webrtc_answer','stopSession','getIceServers','beginPath','\x20image,\x20trying\x20message\x20types:','fillText','publish','setLocalDescription','#666','webrtc','protocol','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','get','3071416gYiyVc','2265240zSJAlU','compressedDepth','set','push','add','isDepthTopic','\x20with\x20message\x20type\x20','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','closed','📹\x20Color','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20'];a6_0x82b1=function(){return _0x19986f;};return a6_0x82b1();}const a6_0x588a23=(function(){let _0x3cb41b=!![];return function(_0x574298,_0x74af9c){const _0x2cdbd8=_0x3cb41b?function(){const _0x52b82d=a6_0x2667;if(_0x74af9c){const _0x372c6e=_0x74af9c[_0x52b82d(0x170)](_0x574298,arguments);return _0x74af9c=null,_0x372c6e;}}:function(){};return _0x3cb41b=![],_0x2cdbd8;};}()),a6_0x3aa933=a6_0x588a23(this,function(){const _0x538dec=a6_0x2667;return a6_0x3aa933[_0x538dec(0x19c)]()[_0x538dec(0xe2)]('(((.+)+)+)+$')[_0x538dec(0x19c)]()['constructor'](a6_0x3aa933)[_0x538dec(0xe2)](_0x538dec(0x131));});a6_0x3aa933();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require('wrtc'),sharp=require('sharp'),config=require(a6_0x46cf95(0x13d)),DepthImageProcessor=require(a6_0x46cf95(0xf6)),turnCredentialsService=require(a6_0x46cf95(0x115));class ApplianceWebRTCService{constructor(){const _0x17aad7=a6_0x46cf95;this[_0x17aad7(0xfe)]=new Map(),this['topicSessions']=new Map(),this[_0x17aad7(0x173)]=new Map(),this['rosbridgeWs']=null,this[_0x17aad7(0x130)]=null,this[_0x17aad7(0xf7)]=new DepthImageProcessor(),this[_0x17aad7(0x16d)]={'iceServers':[{'urls':_0x17aad7(0x13a)},{'urls':_0x17aad7(0x129)}]};}[a6_0x46cf95(0x141)](_0x564f65,_0x786cec){const _0x2bd145=a6_0x46cf95;this['rosbridgeWs']=_0x564f65,this[_0x2bd145(0x130)]=_0x786cec,turnCredentialsService['initialize'](config[_0x2bd145(0x188)]),this[_0x2bd145(0x16b)](),console[_0x2bd145(0xea)]('[WebRTC\x20Appliance]\x20Service\x20initialized');}async['updateTurnCredentials'](){const _0x501609=a6_0x46cf95;try{console[_0x501609(0xea)](_0x501609(0xf1));const _0x46ccfb=await turnCredentialsService[_0x501609(0x150)]();this[_0x501609(0x16d)]['iceServers']=_0x46ccfb,console[_0x501609(0xea)](_0x501609(0x119));}catch(_0x4bc407){console[_0x501609(0x117)](_0x501609(0x125),_0x4bc407),console[_0x501609(0xea)]('[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers');}}['handleMessage'](_0x26913b){const _0x1b2be8=a6_0x46cf95;if(!_0x26913b['op']||!_0x26913b['op'][_0x1b2be8(0x190)]('webrtc_'))return![];console[_0x1b2be8(0xea)](_0x1b2be8(0xe9)+_0x26913b['op']);switch(_0x26913b['op']){case _0x1b2be8(0x1a8):this[_0x1b2be8(0x17a)](_0x26913b[_0x1b2be8(0x143)],_0x26913b[_0x1b2be8(0xe1)]);return!![];case'webrtc_offer':this[_0x1b2be8(0x140)](_0x26913b['session_id'],_0x26913b[_0x1b2be8(0x13b)]);return!![];case _0x1b2be8(0x189):this[_0x1b2be8(0xed)](_0x26913b['session_id'],_0x26913b['candidate']);return!![];case _0x1b2be8(0xdc):this[_0x1b2be8(0x14f)](_0x26913b[_0x1b2be8(0x143)]);return!![];default:console[_0x1b2be8(0x134)](_0x1b2be8(0xde)+_0x26913b['op']);return![];}}[a6_0x46cf95(0x178)](_0x243035){const _0x3930cc=a6_0x46cf95;if(this[_0x3930cc(0x173)][_0x3930cc(0x10d)](_0x243035)){const _0x54fbf9=this[_0x3930cc(0x173)][_0x3930cc(0x15a)](_0x243035);return _0x54fbf9['frameCount']++,console[_0x3930cc(0xea)](_0x3930cc(0x163)+_0x243035+'\x20('+_0x54fbf9['frameCount']+'\x20sessions)'),_0x54fbf9;}console[_0x3930cc(0xea)]('[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x243035);const {createCanvas:_0x296a31}=require(_0x3930cc(0x1aa)),_0x223282=_0x296a31(config['webrtc'][_0x3930cc(0x195)][_0x3930cc(0xec)],config[_0x3930cc(0x157)][_0x3930cc(0x195)][_0x3930cc(0x122)]),_0xae6de0=_0x223282['getContext']('2d');this[_0x3930cc(0x167)](_0x223282,_0xae6de0);const {RTCVideoSource:_0x5f3355}=nonstandard,_0x5e0c5a=new _0x5f3355();let _0x106319=0x0;const _0x1d2ec4=0x3e8/config[_0x3930cc(0x157)]['video']['framerate'],_0xcdfa8e=this[_0x3930cc(0x127)](_0x243035,_0x5b8dc4=>{const _0x1e73fc=_0x3930cc,_0x59c017=Date[_0x1e73fc(0x112)]();_0x59c017-_0x106319>=_0x1d2ec4&&(_0x106319=_0x59c017,this[_0x1e73fc(0xf9)](_0x223282,_0xae6de0,_0x5b8dc4,_0x243035,_0x5e0c5a));}),_0x1ecbcb={'videoSource':_0x5e0c5a,'canvas':_0x223282,'rosSubscriber':_0xcdfa8e,'frameCount':0x1,'topic':_0x243035};return this['sharedVideoSources']['set'](_0x243035,_0x1ecbcb),_0x1ecbcb;}[a6_0x46cf95(0x1a0)](_0x3588d8){const _0x123c22=a6_0x46cf95,_0x2f33fd=this[_0x123c22(0x173)][_0x123c22(0x15a)](_0x3588d8);if(!_0x2f33fd)return;_0x2f33fd[_0x123c22(0x11c)]--,console[_0x123c22(0xea)]('[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x3588d8+'\x20('+_0x2f33fd['frameCount']+_0x123c22(0x172)),_0x2f33fd[_0x123c22(0x11c)]<=0x0&&(console[_0x123c22(0xea)](_0x123c22(0x194)+_0x3588d8+_0x123c22(0x1ac)),_0x2f33fd[_0x123c22(0x124)]&&(_0x2f33fd[_0x123c22(0x124)]=null),_0x2f33fd[_0x123c22(0x18c)]&&_0x2f33fd['rosSubscriber'][_0x123c22(0x182)](),this['sharedVideoSources'][_0x123c22(0x123)](_0x3588d8));}async[a6_0x46cf95(0x17a)](_0x32aecf,_0x5881d0){const _0x124605=a6_0x46cf95;try{console[_0x124605(0xea)](_0x124605(0x159)+_0x32aecf+_0x124605(0x11f)+_0x5881d0);const _0x88fc8b=this['getOrCreateSharedVideoSource'](_0x5881d0),_0x213e51=new RTCPeerConnection(this[_0x124605(0x16d)]),_0x47f12a=_0x88fc8b[_0x124605(0x124)]['createTrack']({'width':config['webrtc'][_0x124605(0x195)][_0x124605(0xec)],'height':config['webrtc'][_0x124605(0x195)][_0x124605(0x122)],'framerate':config[_0x124605(0x157)][_0x124605(0x195)][_0x124605(0x183)]});console['log'](_0x124605(0x19a)+_0x32aecf);const {MediaStream:_0x4675e0}=require('wrtc'),_0x1b0946=new _0x4675e0([_0x47f12a]);_0x213e51[_0x124605(0x16a)](_0x47f12a,_0x1b0946),this['sendFrameToVideoSource'](_0x88fc8b['videoSource'],_0x88fc8b['canvas']),_0x213e51[_0x124605(0x184)]=_0x576c68=>{const _0x414cd1=_0x124605;if(_0x576c68[_0x414cd1(0x197)]&&this[_0x414cd1(0x130)])console[_0x414cd1(0xea)]('[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20'+_0x32aecf+':',{'type':_0x576c68[_0x414cd1(0x197)][_0x414cd1(0x109)],'protocol':_0x576c68['candidate'][_0x414cd1(0x158)],'address':_0x576c68[_0x414cd1(0x197)][_0x414cd1(0x10b)],'port':_0x576c68[_0x414cd1(0x197)][_0x414cd1(0x128)]}),this[_0x414cd1(0x130)][_0x414cd1(0x118)](JSON['stringify']({'op':'webrtc_ice_candidate','session_id':_0x32aecf,'candidate':_0x576c68[_0x414cd1(0x197)]}));else!_0x576c68[_0x414cd1(0x197)]&&console[_0x414cd1(0xea)](_0x414cd1(0x146)+_0x32aecf);},_0x213e51['onconnectionstatechange']=()=>{const _0x7334e7=_0x124605;console[_0x7334e7(0xea)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x32aecf+_0x7334e7(0x171)+_0x213e51[_0x7334e7(0x1a9)]);if(_0x213e51[_0x7334e7(0x1a9)]===_0x7334e7(0xf0))console[_0x7334e7(0xea)](_0x7334e7(0x142)+_0x32aecf+'\x20successfully\x20connected!');else{if(_0x213e51[_0x7334e7(0x1a9)]==='failed')console[_0x7334e7(0xea)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x32aecf+_0x7334e7(0x186)),this[_0x7334e7(0x14f)](_0x32aecf);else _0x213e51[_0x7334e7(0x1a9)]===_0x7334e7(0x164)&&(console[_0x7334e7(0xea)](_0x7334e7(0x142)+_0x32aecf+_0x7334e7(0xda)),this[_0x7334e7(0xe0)](_0x32aecf));}},this[_0x124605(0xfe)][_0x124605(0x15e)](_0x32aecf,{'peerConnection':_0x213e51,'topic':_0x5881d0,'videoTrack':_0x47f12a,'mediaStream':_0x1b0946,'status':_0x124605(0x16e)}),!this[_0x124605(0x19b)][_0x124605(0x10d)](_0x5881d0)&&this['topicSessions']['set'](_0x5881d0,new Set()),this[_0x124605(0x19b)][_0x124605(0x15a)](_0x5881d0)[_0x124605(0x160)](_0x32aecf),console['log'](_0x124605(0x142)+_0x32aecf+_0x124605(0x18f)),console[_0x124605(0xea)]('[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20'+_0x5881d0+':\x20'+this['topicSessions']['get'](_0x5881d0)['size']);}catch(_0x517e98){console[_0x124605(0x117)](_0x124605(0x199)+_0x32aecf+':',_0x517e98),this['stopSession'](_0x32aecf);}}async[a6_0x46cf95(0x140)](_0x12a307,_0x792af6){const _0x448d17=a6_0x46cf95,_0x113db8=this[_0x448d17(0xfe)][_0x448d17(0x15a)](_0x12a307);if(!_0x113db8){console['error'](_0x448d17(0x16f)+_0x12a307);return;}try{console[_0x448d17(0xea)](_0x448d17(0x16c)+_0x12a307),await _0x113db8[_0x448d17(0x177)]['setRemoteDescription'](new RTCSessionDescription(_0x792af6)),console[_0x448d17(0xea)](_0x448d17(0x11b));const _0x45b751=await _0x113db8[_0x448d17(0x177)][_0x448d17(0x149)]();console[_0x448d17(0xea)](_0x448d17(0x105)),await _0x113db8['peerConnection'][_0x448d17(0x155)](_0x45b751),console[_0x448d17(0xea)]('[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)'),this['serverWs']&&(this[_0x448d17(0x130)][_0x448d17(0x118)](JSON[_0x448d17(0x11d)]({'op':_0x448d17(0x14e),'session_id':_0x12a307,'answer':_0x45b751})),console[_0x448d17(0xea)](_0x448d17(0x10f)+_0x12a307));}catch(_0x1be523){console[_0x448d17(0x117)]('[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20'+_0x12a307+':',_0x1be523),this['stopSession'](_0x12a307);}}async[a6_0x46cf95(0xed)](_0x31e6e6,_0x1c0f3c){const _0x6700b8=a6_0x46cf95,_0x1a9881=this['activeSessions'][_0x6700b8(0x15a)](_0x31e6e6);if(!_0x1a9881){console['error']('[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20'+_0x31e6e6);return;}try{await _0x1a9881[_0x6700b8(0x177)][_0x6700b8(0x19f)](new RTCIceCandidate(_0x1c0f3c)),console[_0x6700b8(0xea)](_0x6700b8(0xe4)+_0x31e6e6);}catch(_0x49e068){console[_0x6700b8(0x117)](_0x6700b8(0x18e)+_0x31e6e6+':',_0x49e068);}}[a6_0x46cf95(0x127)](_0x2baaf8,_0x1a23c2){const _0x26a568=a6_0x46cf95;if(!this[_0x26a568(0xfb)]||this['rosbridgeWs'][_0x26a568(0x174)]!==this[_0x26a568(0xfb)][_0x26a568(0x10a)])return console['error'](_0x26a568(0x19e)),null;console[_0x26a568(0xea)]('[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20'+_0x2baaf8);const _0x31c756=_0x2baaf8['includes'](_0x26a568(0x126)),_0x53ba64=_0x2baaf8[_0x26a568(0x107)](_0x26a568(0x147))||_0x2baaf8[_0x26a568(0x107)](_0x26a568(0x15d));let _0x3ffe10=[];_0x31c756?_0x53ba64?_0x3ffe10=['sensor_msgs/CompressedImage',_0x26a568(0x13c),_0x26a568(0x104),'sensor_msgs/Image']:_0x3ffe10=[_0x26a568(0xef),_0x26a568(0x18d),_0x26a568(0x13f)]:_0x3ffe10=[_0x26a568(0x13f),_0x26a568(0x13c),_0x26a568(0xef)];console[_0x26a568(0xea)]('[WebRTC\x20Appliance]\x20Topic\x20'+_0x2baaf8+_0x26a568(0x106)+(_0x31c756?_0x26a568(0x126):_0x26a568(0x100))+_0x26a568(0x152),_0x3ffe10);const _0x365889=[];let _0x3cb147=![];const _0x310ba6=_0x258b6f=>{return _0x3e0f3e=>{const _0x72a10f=a6_0x2667;try{const _0x26ce6b=JSON[_0x72a10f(0x14b)](_0x3e0f3e[_0x72a10f(0x1a1)]);_0x26ce6b['op']===_0x72a10f(0x154)&&_0x26ce6b['topic']===_0x2baaf8&&_0x26ce6b[_0x72a10f(0x196)]&&(!_0x3cb147&&(console[_0x72a10f(0xea)]('[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20'+_0x2baaf8+_0x72a10f(0x162)+_0x258b6f),_0x3cb147=!![]),_0x1a23c2(_0x26ce6b[_0x72a10f(0x196)]));}catch(_0x5ec8c2){console['error']('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x5ec8c2);}};};for(const _0x31b9cf of _0x3ffe10){const _0x4dce54={'op':'subscribe','topic':_0x2baaf8,'type':_0x31b9cf};console[_0x26a568(0xea)](_0x26a568(0x168)+_0x31b9cf),this[_0x26a568(0xfb)][_0x26a568(0x118)](JSON[_0x26a568(0x11d)](_0x4dce54));const _0x5c9753=_0x310ba6(_0x31b9cf);this[_0x26a568(0xfb)]['addEventListener'](_0x26a568(0x138),_0x5c9753),_0x365889[_0x26a568(0x15f)]({'handler':_0x5c9753,'type':_0x31b9cf});}return _0x31c756&&_0x53ba64&&setTimeout(()=>{const _0x19f9e6=_0x26a568;if(!_0x3cb147){console[_0x19f9e6(0xea)](_0x19f9e6(0x166)+_0x2baaf8+',\x20trying\x20alternative\x20depth\x20topics');const _0x50bf48=_0x2baaf8[_0x19f9e6(0x10e)](_0x19f9e6(0x1a6),'')[_0x19f9e6(0x10e)](_0x19f9e6(0xe6),''),_0x4e2a93=[_0x50bf48+'/image_raw',_0x50bf48+_0x19f9e6(0x12a),_0x50bf48];for(const _0x4a3b6f of _0x4e2a93){console[_0x19f9e6(0xea)](_0x19f9e6(0x116)+_0x4a3b6f);const _0x3d6003={'op':_0x19f9e6(0xfc),'topic':_0x4a3b6f,'type':_0x19f9e6(0xef)};this['rosbridgeWs'][_0x19f9e6(0x118)](JSON['stringify'](_0x3d6003));const _0x3eed1d=_0x23a5d3=>{const _0x3de086=_0x19f9e6;try{const _0x2454a4=JSON['parse'](_0x23a5d3['data']);_0x2454a4['op']===_0x3de086(0x154)&&_0x2454a4[_0x3de086(0xe1)]===_0x4a3b6f&&_0x2454a4['msg']&&(console[_0x3de086(0xea)](_0x3de086(0x12c)+_0x4a3b6f+_0x3de086(0x175)),_0x2454a4[_0x3de086(0x196)][_0x3de086(0x1a1)]&&!_0x2454a4['msg'][_0x3de086(0x1a1)][_0x3de086(0x190)]('/9j/')&&_0x1a23c2(_0x2454a4[_0x3de086(0x196)]));}catch(_0x27c286){console[_0x3de086(0x117)](_0x3de086(0x136),_0x27c286);}};this[_0x19f9e6(0xfb)]['addEventListener'](_0x19f9e6(0x138),_0x3eed1d),_0x365889[_0x19f9e6(0x15f)]({'handler':_0x3eed1d,'type':_0x19f9e6(0xef),'topic':_0x4a3b6f});}}},0xbb8),{'unsubscribe':()=>{const _0x4299c9=_0x26a568;for(const {handler:_0x3e0707,type:_0x5fb8eb,topic:_0x229d78}of _0x365889){this[_0x4299c9(0xfb)][_0x4299c9(0xe5)](_0x4299c9(0x138),_0x3e0707),this[_0x4299c9(0xfb)]['readyState']===this[_0x4299c9(0xfb)][_0x4299c9(0x10a)]&&this['rosbridgeWs'][_0x4299c9(0x118)](JSON[_0x4299c9(0x11d)]({'op':_0x4299c9(0x182),'topic':_0x229d78||_0x2baaf8}));}}};}['drawLoadingPattern'](_0x2daab0,_0x11d7c0){const _0x119a6f=a6_0x46cf95;_0x11d7c0['fillStyle']=_0x119a6f(0x144),_0x11d7c0[_0x119a6f(0xf2)](0x0,0x0,_0x2daab0[_0x119a6f(0xec)],_0x2daab0['height']),_0x11d7c0[_0x119a6f(0x113)]='#00aaff',_0x11d7c0[_0x119a6f(0xf4)]=_0x119a6f(0xf8),_0x11d7c0[_0x119a6f(0x103)]=_0x119a6f(0x133),_0x11d7c0['fillText'](_0x119a6f(0xdf),_0x2daab0[_0x119a6f(0xec)]/0x2,_0x2daab0['height']/0x2-0x14),_0x11d7c0[_0x119a6f(0x113)]=_0x119a6f(0x192),_0x11d7c0['font']=_0x119a6f(0x1a5),_0x11d7c0[_0x119a6f(0x153)](_0x119a6f(0xee),_0x2daab0[_0x119a6f(0xec)]/0x2,_0x2daab0[_0x119a6f(0x122)]/0x2+0x14);const _0x2586e1=Date[_0x119a6f(0x112)]()/0x3e8;for(let _0x231b64=0x0;_0x231b64<0x3;_0x231b64++){const _0x4fcf76=(Math[_0x119a6f(0xfa)](_0x2586e1*0x2+_0x231b64*0.5)+0x1)/0x2;_0x11d7c0['fillStyle']=_0x119a6f(0x191)+_0x4fcf76*0.5+')',_0x11d7c0[_0x119a6f(0x151)](),_0x11d7c0[_0x119a6f(0x120)](_0x2daab0['width']/0x2-0x28+_0x231b64*0x28,_0x2daab0[_0x119a6f(0x122)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x11d7c0[_0x119a6f(0x185)]();}}[a6_0x46cf95(0xfd)](_0x45f732,_0x14cc05){const _0x5229cf=a6_0x46cf95;try{if(!_0x45f732||!_0x14cc05)return;const _0x2640d1=_0x14cc05[_0x5229cf(0x132)]('2d'),_0x4e8e7d=_0x2640d1[_0x5229cf(0x108)](0x0,0x0,_0x14cc05[_0x5229cf(0xec)],_0x14cc05[_0x5229cf(0x122)]),_0x339a2b=this[_0x5229cf(0x198)](_0x4e8e7d['data'],_0x14cc05['width'],_0x14cc05[_0x5229cf(0x122)]),_0x143735={'width':_0x14cc05['width'],'height':_0x14cc05[_0x5229cf(0x122)],'data':_0x339a2b};typeof _0x45f732[_0x5229cf(0x110)]==='function'&&_0x45f732[_0x5229cf(0x110)](_0x143735);}catch(_0x2a8000){console['error'](_0x5229cf(0x1a7),_0x2a8000);}}['convertRGBAtoI420'](_0x371042,_0x1349f2,_0x1cbdda){const _0x40a969=a6_0x46cf95,_0x3d4efc=_0x1349f2*_0x1cbdda,_0x4b33e3=_0x1349f2*_0x1cbdda/0x4,_0x1f885e=new Uint8Array(_0x3d4efc+_0x4b33e3*0x2);let _0x5deeb5=0x0,_0x3adcac=_0x3d4efc,_0x336308=_0x3d4efc+_0x4b33e3;for(let _0xfb7bda=0x0;_0xfb7bda<_0x1cbdda;_0xfb7bda++){for(let _0x4ca72f=0x0;_0x4ca72f<_0x1349f2;_0x4ca72f++){const _0x23583a=(_0xfb7bda*_0x1349f2+_0x4ca72f)*0x4,_0x583b4c=_0x371042[_0x23583a],_0x1cdb85=_0x371042[_0x23583a+0x1],_0x2b691c=_0x371042[_0x23583a+0x2],_0x3f52ea=Math[_0x40a969(0x17b)](0.299*_0x583b4c+0.587*_0x1cdb85+0.114*_0x2b691c);_0x1f885e[_0x5deeb5++]=_0x3f52ea;if(_0xfb7bda%0x2===0x0&&_0x4ca72f%0x2===0x0){const _0x52abfc=Math[_0x40a969(0x17b)](-0.169*_0x583b4c-0.331*_0x1cdb85+0.5*_0x2b691c+0x80),_0x45254c=Math[_0x40a969(0x17b)](0.5*_0x583b4c-0.419*_0x1cdb85-0.081*_0x2b691c+0x80);_0x1f885e[_0x3adcac++]=Math['max'](0x0,Math[_0x40a969(0x1ab)](0xff,_0x52abfc)),_0x1f885e[_0x336308++]=Math[_0x40a969(0x13e)](0x0,Math[_0x40a969(0x1ab)](0xff,_0x45254c));}}}return _0x1f885e;}async[a6_0x46cf95(0xf9)](_0x7b9e7d,_0x404440,_0x1e1b80,_0x5ece65,_0x4fd640){const _0x5051d3=a6_0x46cf95;try{if(!_0x1e1b80||!_0x1e1b80[_0x5051d3(0x1a1)])return;Math[_0x5051d3(0xff)]()<0.01&&console[_0x5051d3(0xea)](_0x5051d3(0xe3)+_0x5ece65+_0x5051d3(0x11e)+_0x1e1b80[_0x5051d3(0x1a1)]['length']+_0x5051d3(0xf5));const _0x378aeb=Buffer['from'](_0x1e1b80[_0x5051d3(0x1a1)],'base64'),_0x40ed6e=this['depthProcessor'][_0x5051d3(0x161)](_0x5ece65);let _0x3d6764;_0x40ed6e?_0x3d6764=await this[_0x5051d3(0xf7)][_0x5051d3(0x12b)](_0x378aeb,_0x7b9e7d,_0x404440,_0x5ece65):_0x3d6764=await this[_0x5051d3(0xf7)][_0x5051d3(0x135)](_0x378aeb,_0x7b9e7d,_0x404440),_0x404440[_0x5051d3(0x17f)](_0x3d6764,0x0,0x0),_0x404440[_0x5051d3(0x113)]=_0x5051d3(0x111),_0x404440[_0x5051d3(0xf2)](0xa,0xa,0xdc,0x32),_0x404440[_0x5051d3(0x113)]=_0x40ed6e?_0x5051d3(0xdd):_0x5051d3(0x148),_0x404440['font']='12px\x20monospace',_0x404440['fillText']((_0x40ed6e?_0x5051d3(0x12e):_0x5051d3(0x165))+':\x20'+new Date()[_0x5051d3(0xf3)](),0xf,0x1c),_0x404440[_0x5051d3(0x113)]=_0x5051d3(0x192),_0x404440[_0x5051d3(0xf4)]=_0x5051d3(0x176),_0x404440[_0x5051d3(0x153)](_0x5051d3(0x1a4)+_0x5ece65[_0x5051d3(0x11a)]('/')['pop'](),0xf,0x2d),this[_0x5051d3(0xfd)](_0x4fd640,_0x7b9e7d);}catch(_0x51ad38){console[_0x5051d3(0x134)]('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x5ece65+':',_0x51ad38[_0x5051d3(0x138)]);_0x5ece65[_0x5051d3(0x107)]('depth')&&Math[_0x5051d3(0xff)]()<0.1&&console[_0x5051d3(0x134)](_0x5051d3(0xe7)+_0x5ece65['replace'](_0x5051d3(0x1a6),'/image_raw'));_0x404440[_0x5051d3(0x113)]='#1a1a1a',_0x404440[_0x5051d3(0xf2)](0x0,0x0,_0x7b9e7d[_0x5051d3(0xec)],_0x7b9e7d[_0x5051d3(0x122)]),_0x404440[_0x5051d3(0x113)]=_0x5051d3(0x18b),_0x404440[_0x5051d3(0xf4)]=_0x5051d3(0x1a5),_0x404440[_0x5051d3(0x103)]=_0x5051d3(0x133);const _0x2115ad=_0x5ece65[_0x5051d3(0x107)](_0x5051d3(0x126))?_0x5051d3(0x19d):_0x5051d3(0x102);_0x404440[_0x5051d3(0x153)](_0x2115ad,_0x7b9e7d[_0x5051d3(0xec)]/0x2,_0x7b9e7d['height']/0x2),_0x404440[_0x5051d3(0x113)]=_0x5051d3(0x156),_0x404440[_0x5051d3(0xf4)]=_0x5051d3(0x121),_0x404440[_0x5051d3(0x153)](_0x5051d3(0x1a4)+_0x5ece65['split']('/')['pop'](),_0x7b9e7d[_0x5051d3(0xec)]/0x2,_0x7b9e7d[_0x5051d3(0x122)]/0x2+0x19),this[_0x5051d3(0xfd)](_0x4fd640,_0x7b9e7d);}}[a6_0x46cf95(0x14f)](_0x427e48){const _0x3721a7=a6_0x46cf95,_0x2a42aa=this['activeSessions']['get'](_0x427e48);if(!_0x2a42aa){console[_0x3721a7(0x134)]('[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20'+_0x427e48);return;}console['log'](_0x3721a7(0xdb)+_0x427e48+_0x3721a7(0x179)+_0x2a42aa['topic']);try{this[_0x3721a7(0x130)]&&this[_0x3721a7(0x130)]['readyState']===this[_0x3721a7(0x130)][_0x3721a7(0x10a)]&&this[_0x3721a7(0x130)]['send'](JSON[_0x3721a7(0x11d)]({'op':_0x3721a7(0xdc),'session_id':_0x427e48})),_0x2a42aa[_0x3721a7(0x14a)]&&_0x2a42aa[_0x3721a7(0x14a)][_0x3721a7(0x12f)](),_0x2a42aa['peerConnection']&&_0x2a42aa[_0x3721a7(0x177)][_0x3721a7(0x14c)]();}catch(_0x21f707){console[_0x3721a7(0x117)](_0x3721a7(0xeb)+_0x21f707);}this['cleanupSession'](_0x427e48);}[a6_0x46cf95(0xe0)](_0x2dc59d){const _0x1308dd=a6_0x46cf95,_0x18be70=this[_0x1308dd(0xfe)]['get'](_0x2dc59d);if(_0x18be70){const _0x32f0cb=this[_0x1308dd(0x19b)][_0x1308dd(0x15a)](_0x18be70[_0x1308dd(0xe1)]);_0x32f0cb&&(_0x32f0cb[_0x1308dd(0x123)](_0x2dc59d),_0x32f0cb[_0x1308dd(0x12d)]===0x0&&this[_0x1308dd(0x19b)]['delete'](_0x18be70[_0x1308dd(0xe1)])),this[_0x1308dd(0x1a0)](_0x18be70['topic']);}this[_0x1308dd(0xfe)]['delete'](_0x2dc59d),console[_0x1308dd(0xea)]('[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20'+_0x2dc59d);}[a6_0x46cf95(0x10c)](){const _0x542416=a6_0x46cf95;console['log'](_0x542416(0x137));const _0x409e64=Array[_0x542416(0x17e)](this['activeSessions'][_0x542416(0x101)]());_0x409e64['forEach'](_0x1d16dd=>this[_0x542416(0x14f)](_0x1d16dd));}[a6_0x46cf95(0x14d)](){const _0xd6f529=a6_0x46cf95,_0x2260ff=[];for(const [_0x52fcdd,_0x106f0a]of this[_0xd6f529(0xfe)]){_0x2260ff[_0xd6f529(0x15f)]({'sessionId':_0x52fcdd,'topic':_0x106f0a[_0xd6f529(0xe1)],'connectionState':_0x106f0a[_0xd6f529(0x177)]?.['connectionState']||'unknown','hasVideoTrack':!!_0x106f0a[_0xd6f529(0x14a)]});}return _0x2260ff;}[a6_0x46cf95(0x169)](){const _0x52ecb3=a6_0x46cf95,_0x4805f1=[];for(const [_0x4eb14f,_0x102de1]of this[_0x52ecb3(0x173)]){_0x4805f1['push']({'topic':_0x4eb14f,'frameCount':_0x102de1[_0x52ecb3(0x11c)],'hasVideoSource':!!_0x102de1[_0x52ecb3(0x124)],'hasRosSubscriber':!!_0x102de1['rosSubscriber']});}return _0x4805f1;}}function a6_0x2667(_0x1cd4b3,_0x158fce){const _0x239cb3=a6_0x82b1();return a6_0x2667=function(_0x3aa933,_0x588a23){_0x3aa933=_0x3aa933-0xda;let _0x82b114=_0x239cb3[_0x3aa933];return _0x82b114;},a6_0x2667(_0x1cd4b3,_0x158fce);}module[a6_0x46cf95(0x187)]=new ApplianceWebRTCService();