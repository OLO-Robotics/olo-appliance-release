function a6_0x2e12(){const _0x1bd79f=['[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','random','\x20detected\x20as\x20','🔍\x20Depth','addTrack','search','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','(((.+)+)+)+$','561893VLqSJc','publish','24px\x20Arial','[WebRTC\x20Appliance]\x20Topic\x20','sin','message','topic','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','send','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','30222aRQcSm','port',',\x20size:\x20','round','\x20connection\x20state:\x20','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','videoTrack','compressed','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','sharedVideoSources','getActiveSessions','#666','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','setLocalDescription','framerate','/image_raw','apply','push',',\x20converting\x20to\x20base64...','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','sensor_msgs/Image','[WebRTC\x20Appliance]\x20Service\x20initialized','toLocaleTimeString','canvas','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','activeSessions','/9j/','sendFrameToVideoSource','has','\x20connection\x20failed,\x20stopping\x20session','sensor_msgs/msg/CompressedImage','peerConnection',',\x20cleaning\x20up\x20shared\x20resources','constructor','updateTurnCredentials','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','removeEventListener','\x20image,\x20trying\x20message\x20types:','Topic:\x20','videoSource','failed','webrtc_init_session','onconnectionstatechange','10px\x20monospace','unknown','📹\x20Processing\x20video...','initializeSession','fill','#00ff00','webrtc_ice_candidate','readyState','closed','convertRGBAtoI420','center','/compressedDepth','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','fillRect','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','initializing','compressed_depth_image_transport/CompressedDepthImage','#00ffff','get','frameCount','createAnswer','onicecandidate','📹\x20Color','stun:stun1.l.google.com:19302','1779589fKfYkY','msg','connectionState','onFrame','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','\x20bytes','rtcConfig','processColorImage','serverUrl','session_id','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','\x20connection\x20closed,\x20cleaning\x20up','log','toString','12px\x20monospace','🔍\x20Processing\x20depth...','\x20for\x20topic:\x20','stopAllSessions','stringify','depth','releaseSharedVideoSource','subscribeToROSTopic','split','add','video','\x20with\x20message\x20type\x20','depthProcessor','webrtc_offer','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','candidate','from','\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','getContext','[WebRTC\x20Appliance]\x20Created\x20answer','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','\x20initialized\x20successfully','sharp','stopSession','wrtc','getOrCreateSharedVideoSource','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','isDepthTopic','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','handleOffer','rgba(0,\x20170,\x20255,\x20','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','webrtc','../config','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','1136864TIYvMW','350gilDmz','error','webrtc_','size','max','updateCanvasWithImageData','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','9896BsNaXu','getIceServers','\x20sessions\x20remaining)','6HeoRai','rosbridgeWs','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','603nMtmzR','subscribe','height','addEventListener','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','offer','135Trqyid','12px\x20Arial','min','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','parse','keys','/image','\x20successfully\x20connected!','setRemoteDescription','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','replace','unsubscribe','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','fillText','now','createTrack','protocol','#00aaff','OPEN','cleanupSession','handleIceCandidate','pop','getSharedVideoSources','data','webrtc_stop_session','206246gLaDlm','486343gQUItU','textAlign','[WebRTC\x20Appliance]\x20Session\x20','delete','rosSubscriber','sensor_msgs/msg/Image','connected','set','stop','sensor_msgs/CompressedImage','topicSessions','initialize','width','font','fillStyle','16px\x20Arial','startsWith','base64','includes','arc','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','/compressed','drawLoadingPattern','warn','beginPath','putImageData','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','./turnCredentialsService','serverWs'];a6_0x2e12=function(){return _0x1bd79f;};return a6_0x2e12();}const a6_0x48c03f=a6_0x34c5;(function(_0x57aee5,_0x59db3d){const _0x2cc628=a6_0x34c5,_0x9e8ce1=_0x57aee5();while(!![]){try{const _0x2fe78c=-parseInt(_0x2cc628(0x148))/0x1+-parseInt(_0x2cc628(0x121))/0x2*(parseInt(_0x2cc628(0x1d4))/0x3)+-parseInt(_0x2cc628(0x1c9))/0x4+-parseInt(_0x2cc628(0x1de))/0x5*(-parseInt(_0x2cc628(0x152))/0x6)+-parseInt(_0x2cc628(0x195))/0x7+-parseInt(_0x2cc628(0x1d1))/0x8*(parseInt(_0x2cc628(0x1d7))/0x9)+parseInt(_0x2cc628(0x1ca))/0xa*(parseInt(_0x2cc628(0x122))/0xb);if(_0x2fe78c===_0x59db3d)break;else _0x9e8ce1['push'](_0x9e8ce1['shift']());}catch(_0x1028ca){_0x9e8ce1['push'](_0x9e8ce1['shift']());}}}(a6_0x2e12,0x47c69));function a6_0x34c5(_0x55d980,_0x30d310){const _0x21b646=a6_0x2e12();return a6_0x34c5=function(_0x3a4c89,_0x19f86d){_0x3a4c89=_0x3a4c89-0x11c;let _0x2e129a=_0x21b646[_0x3a4c89];return _0x2e129a;},a6_0x34c5(_0x55d980,_0x30d310);}const a6_0x19f86d=(function(){let _0xef086c=!![];return function(_0x2105ec,_0x3488f4){const _0x52ba0f=_0xef086c?function(){const _0x16d285=a6_0x34c5;if(_0x3488f4){const _0x708497=_0x3488f4[_0x16d285(0x162)](_0x2105ec,arguments);return _0x3488f4=null,_0x708497;}}:function(){};return _0xef086c=![],_0x52ba0f;};}()),a6_0x3a4c89=a6_0x19f86d(this,function(){const _0x1fb1f5=a6_0x34c5;return a6_0x3a4c89[_0x1fb1f5(0x1a3)]()[_0x1fb1f5(0x144)](_0x1fb1f5(0x147))['toString']()[_0x1fb1f5(0x173)](a6_0x3a4c89)[_0x1fb1f5(0x144)](_0x1fb1f5(0x147));});a6_0x3a4c89();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x48c03f(0x1be)),sharp=require(a6_0x48c03f(0x1bc)),config=require(a6_0x48c03f(0x1c7)),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require(a6_0x48c03f(0x13d));class ApplianceWebRTCService{constructor(){const _0xc9b2f8=a6_0x48c03f;this[_0xc9b2f8(0x16b)]=new Map(),this['topicSessions']=new Map(),this[_0xc9b2f8(0x15b)]=new Map(),this[_0xc9b2f8(0x1d5)]=null,this[_0xc9b2f8(0x13e)]=null,this[_0xc9b2f8(0x1b0)]=new DepthImageProcessor(),this['rtcConfig']={'iceServers':[{'urls':'stun:stun.l.google.com:19302'},{'urls':_0xc9b2f8(0x194)}]};}[a6_0x48c03f(0x12d)](_0x2a0664,_0x277025){const _0x512f42=a6_0x48c03f;this[_0x512f42(0x1d5)]=_0x2a0664,this['serverWs']=_0x277025,turnCredentialsService[_0x512f42(0x12d)](config[_0x512f42(0x19d)]),this[_0x512f42(0x174)](),console[_0x512f42(0x1a2)](_0x512f42(0x167));}async[a6_0x48c03f(0x174)](){const _0x52278d=a6_0x48c03f;try{console[_0x52278d(0x1a2)](_0x52278d(0x13f));const _0x2611a2=await turnCredentialsService[_0x52278d(0x1d2)]();this[_0x52278d(0x19b)]['iceServers']=_0x2611a2,console['log']('[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully');}catch(_0x317b3a){console[_0x52278d(0x1cb)](_0x52278d(0x13c),_0x317b3a),console[_0x52278d(0x1a2)](_0x52278d(0x165));}}['handleMessage'](_0x397f6e){const _0x5545d1=a6_0x48c03f;if(!_0x397f6e['op']||!_0x397f6e['op']['startsWith'](_0x5545d1(0x1cc)))return![];console[_0x5545d1(0x1a2)](_0x5545d1(0x1db)+_0x397f6e['op']);switch(_0x397f6e['op']){case _0x5545d1(0x17b):this[_0x5545d1(0x180)](_0x397f6e[_0x5545d1(0x19e)],_0x397f6e[_0x5545d1(0x14e)]);return!![];case _0x5545d1(0x1b1):this[_0x5545d1(0x1c3)](_0x397f6e[_0x5545d1(0x19e)],_0x397f6e[_0x5545d1(0x1dd)]);return!![];case _0x5545d1(0x183):this[_0x5545d1(0x11c)](_0x397f6e[_0x5545d1(0x19e)],_0x397f6e[_0x5545d1(0x1b4)]);return!![];case _0x5545d1(0x120):this[_0x5545d1(0x1bd)](_0x397f6e[_0x5545d1(0x19e)]);return!![];default:console['warn'](_0x5545d1(0x18b)+_0x397f6e['op']);return![];}}['getOrCreateSharedVideoSource'](_0x16e9de){const _0x42c759=a6_0x48c03f;if(this[_0x42c759(0x15b)][_0x42c759(0x16e)](_0x16e9de)){const _0x32ec58=this[_0x42c759(0x15b)][_0x42c759(0x18f)](_0x16e9de);return _0x32ec58[_0x42c759(0x190)]++,console[_0x42c759(0x1a2)]('[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x16e9de+'\x20('+_0x32ec58[_0x42c759(0x190)]+'\x20sessions)'),_0x32ec58;}console[_0x42c759(0x1a2)](_0x42c759(0x1e1)+_0x16e9de);const {createCanvas:_0x1850cf}=require(_0x42c759(0x169)),_0x2be5c6=_0x1850cf(config['webrtc'][_0x42c759(0x1ae)][_0x42c759(0x12e)],config['webrtc'][_0x42c759(0x1ae)][_0x42c759(0x1d9)]),_0x3e11f2=_0x2be5c6[_0x42c759(0x1b8)]('2d');this[_0x42c759(0x138)](_0x2be5c6,_0x3e11f2);const {RTCVideoSource:_0x28c014}=nonstandard,_0x4bd813=new _0x28c014();let _0x43ecf3=0x0;const _0x874fb8=0x3e8/config['webrtc'][_0x42c759(0x1ae)][_0x42c759(0x160)],_0x27e1d2=this[_0x42c759(0x1ab)](_0x16e9de,_0x5f18f3=>{const _0x351e94=_0x42c759,_0x263c79=Date[_0x351e94(0x1ec)]();_0x263c79-_0x43ecf3>=_0x874fb8&&(_0x43ecf3=_0x263c79,this[_0x351e94(0x1cf)](_0x2be5c6,_0x3e11f2,_0x5f18f3,_0x16e9de,_0x4bd813));}),_0x7749e4={'videoSource':_0x4bd813,'canvas':_0x2be5c6,'rosSubscriber':_0x27e1d2,'frameCount':0x1,'topic':_0x16e9de};return this['sharedVideoSources']['set'](_0x16e9de,_0x7749e4),_0x7749e4;}[a6_0x48c03f(0x1aa)](_0x2215ac){const _0x5ea98c=a6_0x48c03f,_0x1a7c4d=this['sharedVideoSources'][_0x5ea98c(0x18f)](_0x2215ac);if(!_0x1a7c4d)return;_0x1a7c4d[_0x5ea98c(0x190)]--,console[_0x5ea98c(0x1a2)](_0x5ea98c(0x1d0)+_0x2215ac+'\x20('+_0x1a7c4d[_0x5ea98c(0x190)]+_0x5ea98c(0x1d3)),_0x1a7c4d[_0x5ea98c(0x190)]<=0x0&&(console[_0x5ea98c(0x1a2)]('[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20'+_0x2215ac+_0x5ea98c(0x172)),_0x1a7c4d['videoSource']&&(_0x1a7c4d[_0x5ea98c(0x179)]=null),_0x1a7c4d[_0x5ea98c(0x126)]&&_0x1a7c4d[_0x5ea98c(0x126)][_0x5ea98c(0x1e9)](),this[_0x5ea98c(0x15b)][_0x5ea98c(0x125)](_0x2215ac));}async['initializeSession'](_0x5d0802,_0x38668b){const _0x3948de=a6_0x48c03f;try{console['log']('[WebRTC\x20Appliance]\x20Initializing\x20session\x20'+_0x5d0802+_0x3948de(0x1b6)+_0x38668b);const _0x20557c=this[_0x3948de(0x1bf)](_0x38668b),_0x2e7b73=new RTCPeerConnection(this[_0x3948de(0x19b)]),_0x41436a=_0x20557c[_0x3948de(0x179)][_0x3948de(0x1ed)]({'width':config[_0x3948de(0x1c6)][_0x3948de(0x1ae)][_0x3948de(0x12e)],'height':config[_0x3948de(0x1c6)][_0x3948de(0x1ae)][_0x3948de(0x1d9)],'framerate':config[_0x3948de(0x1c6)][_0x3948de(0x1ae)]['framerate']});console[_0x3948de(0x1a2)](_0x3948de(0x145)+_0x5d0802);const {MediaStream:_0x4c41cd}=require(_0x3948de(0x1be)),_0x426c64=new _0x4c41cd([_0x41436a]);_0x2e7b73[_0x3948de(0x143)](_0x41436a,_0x426c64),this[_0x3948de(0x16d)](_0x20557c[_0x3948de(0x179)],_0x20557c[_0x3948de(0x169)]),_0x2e7b73[_0x3948de(0x192)]=_0x50e43f=>{const _0x313402=_0x3948de;if(_0x50e43f['candidate']&&this[_0x313402(0x13e)])console[_0x313402(0x1a2)](_0x313402(0x1dc)+_0x5d0802+':',{'type':_0x50e43f['candidate']['type'],'protocol':_0x50e43f['candidate'][_0x313402(0x1ee)],'address':_0x50e43f[_0x313402(0x1b4)]['address'],'port':_0x50e43f[_0x313402(0x1b4)][_0x313402(0x153)]}),this[_0x313402(0x13e)][_0x313402(0x150)](JSON[_0x313402(0x1a8)]({'op':_0x313402(0x183),'session_id':_0x5d0802,'candidate':_0x50e43f[_0x313402(0x1b4)]}));else!_0x50e43f[_0x313402(0x1b4)]&&console[_0x313402(0x1a2)](_0x313402(0x1d6)+_0x5d0802);},_0x2e7b73[_0x3948de(0x17c)]=()=>{const _0x1b90ec=_0x3948de;console[_0x1b90ec(0x1a2)](_0x1b90ec(0x124)+_0x5d0802+_0x1b90ec(0x156)+_0x2e7b73['connectionState']);if(_0x2e7b73[_0x1b90ec(0x197)]===_0x1b90ec(0x128))console['log'](_0x1b90ec(0x124)+_0x5d0802+_0x1b90ec(0x1e5));else{if(_0x2e7b73['connectionState']===_0x1b90ec(0x17a))console[_0x1b90ec(0x1a2)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x5d0802+_0x1b90ec(0x16f)),this[_0x1b90ec(0x1bd)](_0x5d0802);else _0x2e7b73[_0x1b90ec(0x197)]===_0x1b90ec(0x185)&&(console[_0x1b90ec(0x1a2)](_0x1b90ec(0x124)+_0x5d0802+_0x1b90ec(0x1a1)),this[_0x1b90ec(0x1f1)](_0x5d0802));}},this[_0x3948de(0x16b)][_0x3948de(0x129)](_0x5d0802,{'peerConnection':_0x2e7b73,'topic':_0x38668b,'videoTrack':_0x41436a,'mediaStream':_0x426c64,'status':_0x3948de(0x18c)}),!this[_0x3948de(0x12c)][_0x3948de(0x16e)](_0x38668b)&&this[_0x3948de(0x12c)]['set'](_0x38668b,new Set()),this[_0x3948de(0x12c)][_0x3948de(0x18f)](_0x38668b)[_0x3948de(0x1ad)](_0x5d0802),console[_0x3948de(0x1a2)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x5d0802+_0x3948de(0x1bb)),console[_0x3948de(0x1a2)](_0x3948de(0x189)+_0x38668b+':\x20'+this[_0x3948de(0x12c)][_0x3948de(0x18f)](_0x38668b)[_0x3948de(0x1cd)]);}catch(_0x36e94b){console[_0x3948de(0x1cb)](_0x3948de(0x1b3)+_0x5d0802+':',_0x36e94b),this['stopSession'](_0x5d0802);}}async[a6_0x48c03f(0x1c3)](_0x2b769b,_0x3f995b){const _0x2c51fc=a6_0x48c03f,_0x23172e=this[_0x2c51fc(0x16b)][_0x2c51fc(0x18f)](_0x2b769b);if(!_0x23172e){console['error'](_0x2c51fc(0x1c0)+_0x2b769b);return;}try{console[_0x2c51fc(0x1a2)](_0x2c51fc(0x16a)+_0x2b769b),await _0x23172e[_0x2c51fc(0x171)][_0x2c51fc(0x1e6)](new RTCSessionDescription(_0x3f995b)),console[_0x2c51fc(0x1a2)](_0x2c51fc(0x157));const _0x7163fb=await _0x23172e['peerConnection'][_0x2c51fc(0x191)]();console['log'](_0x2c51fc(0x1b9)),await _0x23172e[_0x2c51fc(0x171)][_0x2c51fc(0x15f)](_0x7163fb),console['log'](_0x2c51fc(0x1c5)),this[_0x2c51fc(0x13e)]&&(this[_0x2c51fc(0x13e)][_0x2c51fc(0x150)](JSON[_0x2c51fc(0x1a8)]({'op':'webrtc_answer','session_id':_0x2b769b,'answer':_0x7163fb})),console[_0x2c51fc(0x1a2)]('[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20'+_0x2b769b));}catch(_0x1c9531){console[_0x2c51fc(0x1cb)]('[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20'+_0x2b769b+':',_0x1c9531),this['stopSession'](_0x2b769b);}}async[a6_0x48c03f(0x11c)](_0x522c77,_0x2afb91){const _0x3592a4=a6_0x48c03f,_0x23ae6f=this['activeSessions'][_0x3592a4(0x18f)](_0x522c77);if(!_0x23ae6f){console[_0x3592a4(0x1cb)](_0x3592a4(0x151)+_0x522c77);return;}try{await _0x23ae6f[_0x3592a4(0x171)]['addIceCandidate'](new RTCIceCandidate(_0x2afb91)),console[_0x3592a4(0x1a2)](_0x3592a4(0x15a)+_0x522c77);}catch(_0x2b0cbd){console[_0x3592a4(0x1cb)](_0x3592a4(0x1e7)+_0x522c77+':',_0x2b0cbd);}}[a6_0x48c03f(0x1ab)](_0x2fe6ac,_0x52ab4f){const _0x4286b8=a6_0x48c03f;if(!this[_0x4286b8(0x1d5)]||this[_0x4286b8(0x1d5)][_0x4286b8(0x184)]!==this[_0x4286b8(0x1d5)][_0x4286b8(0x1f0)])return console[_0x4286b8(0x1cb)](_0x4286b8(0x175)),null;console[_0x4286b8(0x1a2)](_0x4286b8(0x1b2)+_0x2fe6ac);const _0x5f2b43=_0x2fe6ac['includes'](_0x4286b8(0x1a9)),_0x2ac2b4=_0x2fe6ac[_0x4286b8(0x134)](_0x4286b8(0x159))||_0x2fe6ac['includes']('compressedDepth');let _0x147969=[];_0x5f2b43?_0x2ac2b4?_0x147969=[_0x4286b8(0x12b),_0x4286b8(0x170),_0x4286b8(0x18d),_0x4286b8(0x166)]:_0x147969=['sensor_msgs/Image',_0x4286b8(0x127),_0x4286b8(0x12b)]:_0x147969=[_0x4286b8(0x12b),_0x4286b8(0x170),'sensor_msgs/Image'];console[_0x4286b8(0x1a2)](_0x4286b8(0x14b)+_0x2fe6ac+_0x4286b8(0x141)+(_0x5f2b43?_0x4286b8(0x1a9):'color')+_0x4286b8(0x177),_0x147969);const _0xc62f5f=[];let _0x48dfd3=![];const _0x3ccd33=_0x4af93a=>{return _0x2d7ac6=>{const _0x1d5687=a6_0x34c5;try{const _0x3d882e=JSON[_0x1d5687(0x1e2)](_0x2d7ac6['data']);_0x3d882e['op']===_0x1d5687(0x149)&&_0x3d882e[_0x1d5687(0x14e)]===_0x2fe6ac&&_0x3d882e[_0x1d5687(0x196)]&&(!_0x48dfd3&&(console[_0x1d5687(0x1a2)]('[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20'+_0x2fe6ac+_0x1d5687(0x1af)+_0x4af93a),_0x48dfd3=!![]),_0x52ab4f(_0x3d882e['msg']));}catch(_0x29b1ca){console[_0x1d5687(0x1cb)](_0x1d5687(0x19f),_0x29b1ca);}};};for(const _0x540ccf of _0x147969){const _0x4b0c26={'op':'subscribe','topic':_0x2fe6ac,'type':_0x540ccf};console[_0x4286b8(0x1a2)]('[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20'+_0x540ccf),this[_0x4286b8(0x1d5)][_0x4286b8(0x150)](JSON[_0x4286b8(0x1a8)](_0x4b0c26));const _0x1b8e4c=_0x3ccd33(_0x540ccf);this['rosbridgeWs'][_0x4286b8(0x1da)]('message',_0x1b8e4c),_0xc62f5f[_0x4286b8(0x163)]({'handler':_0x1b8e4c,'type':_0x540ccf});}return _0x5f2b43&&_0x2ac2b4&&setTimeout(()=>{const _0x1fbb00=_0x4286b8;if(!_0x48dfd3){console[_0x1fbb00(0x1a2)](_0x1fbb00(0x199)+_0x2fe6ac+',\x20trying\x20alternative\x20depth\x20topics');const _0x27aef6=_0x2fe6ac['replace'](_0x1fbb00(0x188),'')[_0x1fbb00(0x1e8)](_0x1fbb00(0x137),''),_0x4d0d5d=[_0x27aef6+_0x1fbb00(0x161),_0x27aef6+_0x1fbb00(0x1e4),_0x27aef6];for(const _0x1fd757 of _0x4d0d5d){console[_0x1fbb00(0x1a2)](_0x1fbb00(0x1a0)+_0x1fd757);const _0x41dbd6={'op':_0x1fbb00(0x1d8),'topic':_0x1fd757,'type':'sensor_msgs/Image'};this[_0x1fbb00(0x1d5)][_0x1fbb00(0x150)](JSON[_0x1fbb00(0x1a8)](_0x41dbd6));const _0x3970cb=_0x126940=>{const _0x155504=_0x1fbb00;try{const _0x106b66=JSON['parse'](_0x126940[_0x155504(0x11f)]);_0x106b66['op']==='publish'&&_0x106b66['topic']===_0x1fd757&&_0x106b66[_0x155504(0x196)]&&(console[_0x155504(0x1a2)](_0x155504(0x1ba)+_0x1fd757+_0x155504(0x164)),_0x106b66[_0x155504(0x196)][_0x155504(0x11f)]&&!_0x106b66[_0x155504(0x196)]['data'][_0x155504(0x132)](_0x155504(0x16c))&&_0x52ab4f(_0x106b66[_0x155504(0x196)]));}catch(_0x4f8fde){console['error'](_0x155504(0x146),_0x4f8fde);}};this[_0x1fbb00(0x1d5)][_0x1fbb00(0x1da)]('message',_0x3970cb),_0xc62f5f[_0x1fbb00(0x163)]({'handler':_0x3970cb,'type':_0x1fbb00(0x166),'topic':_0x1fd757});}}},0xbb8),{'unsubscribe':()=>{const _0x5c91cc=_0x4286b8;for(const {handler:_0x58caba,type:_0x427f84,topic:_0x7a479f}of _0xc62f5f){this[_0x5c91cc(0x1d5)][_0x5c91cc(0x176)](_0x5c91cc(0x14d),_0x58caba),this['rosbridgeWs'][_0x5c91cc(0x184)]===this[_0x5c91cc(0x1d5)][_0x5c91cc(0x1f0)]&&this[_0x5c91cc(0x1d5)][_0x5c91cc(0x150)](JSON[_0x5c91cc(0x1a8)]({'op':_0x5c91cc(0x1e9),'topic':_0x7a479f||_0x2fe6ac}));}}};}[a6_0x48c03f(0x138)](_0x499ffd,_0x7f23e0){const _0x87f4fa=a6_0x48c03f;_0x7f23e0[_0x87f4fa(0x130)]='#1a1a1a',_0x7f23e0[_0x87f4fa(0x18a)](0x0,0x0,_0x499ffd[_0x87f4fa(0x12e)],_0x499ffd[_0x87f4fa(0x1d9)]),_0x7f23e0[_0x87f4fa(0x130)]=_0x87f4fa(0x1ef),_0x7f23e0[_0x87f4fa(0x12f)]=_0x87f4fa(0x14a),_0x7f23e0[_0x87f4fa(0x123)]='center',_0x7f23e0[_0x87f4fa(0x1eb)]('🤖\x20Robot\x20Camera',_0x499ffd[_0x87f4fa(0x12e)]/0x2,_0x499ffd[_0x87f4fa(0x1d9)]/0x2-0x14),_0x7f23e0['fillStyle']='#ffffff',_0x7f23e0[_0x87f4fa(0x12f)]=_0x87f4fa(0x131),_0x7f23e0[_0x87f4fa(0x1eb)]('Waiting\x20for\x20ROS\x20image\x20data...',_0x499ffd[_0x87f4fa(0x12e)]/0x2,_0x499ffd[_0x87f4fa(0x1d9)]/0x2+0x14);const _0x35622b=Date[_0x87f4fa(0x1ec)]()/0x3e8;for(let _0x44407c=0x0;_0x44407c<0x3;_0x44407c++){const _0x39fc2e=(Math[_0x87f4fa(0x14c)](_0x35622b*0x2+_0x44407c*0.5)+0x1)/0x2;_0x7f23e0[_0x87f4fa(0x130)]=_0x87f4fa(0x1c4)+_0x39fc2e*0.5+')',_0x7f23e0[_0x87f4fa(0x13a)](),_0x7f23e0[_0x87f4fa(0x135)](_0x499ffd[_0x87f4fa(0x12e)]/0x2-0x28+_0x44407c*0x28,_0x499ffd['height']/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x7f23e0[_0x87f4fa(0x181)]();}}[a6_0x48c03f(0x16d)](_0x42dad8,_0x27a2e8){const _0x2bdd06=a6_0x48c03f;try{if(!_0x42dad8||!_0x27a2e8)return;const _0x2f070c=_0x27a2e8[_0x2bdd06(0x1b8)]('2d'),_0x410593=_0x2f070c['getImageData'](0x0,0x0,_0x27a2e8['width'],_0x27a2e8['height']),_0x2e2e4c=this['convertRGBAtoI420'](_0x410593[_0x2bdd06(0x11f)],_0x27a2e8[_0x2bdd06(0x12e)],_0x27a2e8[_0x2bdd06(0x1d9)]),_0x15228a={'width':_0x27a2e8[_0x2bdd06(0x12e)],'height':_0x27a2e8[_0x2bdd06(0x1d9)],'data':_0x2e2e4c};typeof _0x42dad8['onFrame']==='function'&&_0x42dad8[_0x2bdd06(0x198)](_0x15228a);}catch(_0x158e2a){console['error'](_0x2bdd06(0x1c8),_0x158e2a);}}[a6_0x48c03f(0x186)](_0x152b50,_0x7b36fa,_0x33e86f){const _0x15ebfe=a6_0x48c03f,_0x5d44af=_0x7b36fa*_0x33e86f,_0x2ad86b=_0x7b36fa*_0x33e86f/0x4,_0x1019ae=new Uint8Array(_0x5d44af+_0x2ad86b*0x2);let _0x27a42e=0x0,_0x246b16=_0x5d44af,_0x379213=_0x5d44af+_0x2ad86b;for(let _0x363782=0x0;_0x363782<_0x33e86f;_0x363782++){for(let _0xb24dca=0x0;_0xb24dca<_0x7b36fa;_0xb24dca++){const _0x47e8d6=(_0x363782*_0x7b36fa+_0xb24dca)*0x4,_0x363ce6=_0x152b50[_0x47e8d6],_0x28b41a=_0x152b50[_0x47e8d6+0x1],_0x22d5ae=_0x152b50[_0x47e8d6+0x2],_0x5a563b=Math[_0x15ebfe(0x155)](0.299*_0x363ce6+0.587*_0x28b41a+0.114*_0x22d5ae);_0x1019ae[_0x27a42e++]=_0x5a563b;if(_0x363782%0x2===0x0&&_0xb24dca%0x2===0x0){const _0x1b8513=Math[_0x15ebfe(0x155)](-0.169*_0x363ce6-0.331*_0x28b41a+0.5*_0x22d5ae+0x80),_0x35c39f=Math['round'](0.5*_0x363ce6-0.419*_0x28b41a-0.081*_0x22d5ae+0x80);_0x1019ae[_0x246b16++]=Math[_0x15ebfe(0x1ce)](0x0,Math[_0x15ebfe(0x1e0)](0xff,_0x1b8513)),_0x1019ae[_0x379213++]=Math[_0x15ebfe(0x1ce)](0x0,Math[_0x15ebfe(0x1e0)](0xff,_0x35c39f));}}}return _0x1019ae;}async['updateCanvasWithImageData'](_0x5c1d05,_0x581d6a,_0x3e69b8,_0x39f132,_0x4a1e89){const _0xad92a=a6_0x48c03f;try{if(!_0x3e69b8||!_0x3e69b8[_0xad92a(0x11f)])return;Math[_0xad92a(0x140)]()<0.01&&console['log']('[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20'+_0x39f132+_0xad92a(0x154)+_0x3e69b8['data']['length']+_0xad92a(0x19a));const _0x5a0d3b=Buffer[_0xad92a(0x1b5)](_0x3e69b8[_0xad92a(0x11f)],_0xad92a(0x133)),_0x394ef9=this['depthProcessor'][_0xad92a(0x1c1)](_0x39f132);let _0x296f21;_0x394ef9?_0x296f21=await this[_0xad92a(0x1b0)]['processDepthImage'](_0x5a0d3b,_0x5c1d05,_0x581d6a,_0x39f132):_0x296f21=await this[_0xad92a(0x1b0)][_0xad92a(0x19c)](_0x5a0d3b,_0x5c1d05,_0x581d6a),_0x581d6a[_0xad92a(0x13b)](_0x296f21,0x0,0x0),_0x581d6a['fillStyle']='rgba(0,\x200,\x200,\x200.7)',_0x581d6a[_0xad92a(0x18a)](0xa,0xa,0xdc,0x32),_0x581d6a[_0xad92a(0x130)]=_0x394ef9?_0xad92a(0x18e):_0xad92a(0x182),_0x581d6a[_0xad92a(0x12f)]=_0xad92a(0x1a4),_0x581d6a['fillText']((_0x394ef9?_0xad92a(0x142):_0xad92a(0x193))+':\x20'+new Date()[_0xad92a(0x168)](),0xf,0x1c),_0x581d6a[_0xad92a(0x130)]='#ffffff',_0x581d6a[_0xad92a(0x12f)]=_0xad92a(0x17d),_0x581d6a[_0xad92a(0x1eb)]('Topic:\x20'+_0x39f132[_0xad92a(0x1ac)]('/')[_0xad92a(0x11d)](),0xf,0x2d),this['sendFrameToVideoSource'](_0x4a1e89,_0x5c1d05);}catch(_0x3e0fd7){console[_0xad92a(0x139)](_0xad92a(0x1c2)+_0x39f132+':',_0x3e0fd7['message']);_0x39f132['includes']('depth')&&Math[_0xad92a(0x140)]()<0.1&&console['warn'](_0xad92a(0x14f)+_0x39f132[_0xad92a(0x1e8)](_0xad92a(0x188),_0xad92a(0x161)));_0x581d6a[_0xad92a(0x130)]='#1a1a1a',_0x581d6a[_0xad92a(0x18a)](0x0,0x0,_0x5c1d05[_0xad92a(0x12e)],_0x5c1d05['height']),_0x581d6a['fillStyle']='#888',_0x581d6a[_0xad92a(0x12f)]='16px\x20Arial',_0x581d6a['textAlign']=_0xad92a(0x187);const _0x29b683=_0x39f132[_0xad92a(0x134)](_0xad92a(0x1a9))?_0xad92a(0x1a5):_0xad92a(0x17f);_0x581d6a[_0xad92a(0x1eb)](_0x29b683,_0x5c1d05['width']/0x2,_0x5c1d05[_0xad92a(0x1d9)]/0x2),_0x581d6a[_0xad92a(0x130)]=_0xad92a(0x15d),_0x581d6a[_0xad92a(0x12f)]=_0xad92a(0x1df),_0x581d6a[_0xad92a(0x1eb)](_0xad92a(0x178)+_0x39f132[_0xad92a(0x1ac)]('/')[_0xad92a(0x11d)](),_0x5c1d05[_0xad92a(0x12e)]/0x2,_0x5c1d05['height']/0x2+0x19),this[_0xad92a(0x16d)](_0x4a1e89,_0x5c1d05);}}['stopSession'](_0x59c184){const _0x2a6229=a6_0x48c03f,_0x3ee3f1=this[_0x2a6229(0x16b)]['get'](_0x59c184);if(!_0x3ee3f1){console[_0x2a6229(0x139)](_0x2a6229(0x1b7)+_0x59c184);return;}console[_0x2a6229(0x1a2)](_0x2a6229(0x15e)+_0x59c184+_0x2a6229(0x1a6)+_0x3ee3f1[_0x2a6229(0x14e)]);try{this[_0x2a6229(0x13e)]&&this['serverWs'][_0x2a6229(0x184)]===this[_0x2a6229(0x13e)]['OPEN']&&this[_0x2a6229(0x13e)][_0x2a6229(0x150)](JSON['stringify']({'op':_0x2a6229(0x120),'session_id':_0x59c184})),_0x3ee3f1['videoTrack']&&_0x3ee3f1[_0x2a6229(0x158)][_0x2a6229(0x12a)](),_0x3ee3f1[_0x2a6229(0x171)]&&_0x3ee3f1[_0x2a6229(0x171)]['close']();}catch(_0x104de0){console[_0x2a6229(0x1cb)](_0x2a6229(0x136)+_0x104de0);}this[_0x2a6229(0x1f1)](_0x59c184);}['cleanupSession'](_0x471de4){const _0x1c54a2=a6_0x48c03f,_0x571ec8=this[_0x1c54a2(0x16b)][_0x1c54a2(0x18f)](_0x471de4);if(_0x571ec8){const _0x5120b5=this[_0x1c54a2(0x12c)][_0x1c54a2(0x18f)](_0x571ec8[_0x1c54a2(0x14e)]);_0x5120b5&&(_0x5120b5[_0x1c54a2(0x125)](_0x471de4),_0x5120b5['size']===0x0&&this[_0x1c54a2(0x12c)][_0x1c54a2(0x125)](_0x571ec8[_0x1c54a2(0x14e)])),this[_0x1c54a2(0x1aa)](_0x571ec8[_0x1c54a2(0x14e)]);}this[_0x1c54a2(0x16b)]['delete'](_0x471de4),console[_0x1c54a2(0x1a2)]('[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20'+_0x471de4);}[a6_0x48c03f(0x1a7)](){const _0x34ace4=a6_0x48c03f;console[_0x34ace4(0x1a2)](_0x34ace4(0x1ea));const _0x5c5f1f=Array[_0x34ace4(0x1b5)](this[_0x34ace4(0x16b)][_0x34ace4(0x1e3)]());_0x5c5f1f['forEach'](_0x3009db=>this[_0x34ace4(0x1bd)](_0x3009db));}[a6_0x48c03f(0x15c)](){const _0x5468d2=a6_0x48c03f,_0x27a934=[];for(const [_0x143706,_0x7819e7]of this['activeSessions']){_0x27a934[_0x5468d2(0x163)]({'sessionId':_0x143706,'topic':_0x7819e7[_0x5468d2(0x14e)],'connectionState':_0x7819e7['peerConnection']?.[_0x5468d2(0x197)]||_0x5468d2(0x17e),'hasVideoTrack':!!_0x7819e7[_0x5468d2(0x158)]});}return _0x27a934;}[a6_0x48c03f(0x11e)](){const _0x299ad8=a6_0x48c03f,_0x40de19=[];for(const [_0x4b4f59,_0x3eee52]of this[_0x299ad8(0x15b)]){_0x40de19[_0x299ad8(0x163)]({'topic':_0x4b4f59,'frameCount':_0x3eee52[_0x299ad8(0x190)],'hasVideoSource':!!_0x3eee52[_0x299ad8(0x179)],'hasRosSubscriber':!!_0x3eee52[_0x299ad8(0x126)]});}return _0x40de19;}}module['exports']=new ApplianceWebRTCService();