const a6_0x5870cf=a6_0x2509;(function(_0x5f676,_0x598e59){const _0x383b08=a6_0x2509,_0x44e92e=_0x5f676();while(!![]){try{const _0x10dea9=parseInt(_0x383b08(0x224))/0x1+-parseInt(_0x383b08(0x255))/0x2*(-parseInt(_0x383b08(0x22e))/0x3)+parseInt(_0x383b08(0x227))/0x4+-parseInt(_0x383b08(0x27d))/0x5+parseInt(_0x383b08(0x259))/0x6*(-parseInt(_0x383b08(0x1da))/0x7)+parseInt(_0x383b08(0x1fd))/0x8+parseInt(_0x383b08(0x214))/0x9*(-parseInt(_0x383b08(0x254))/0xa);if(_0x10dea9===_0x598e59)break;else _0x44e92e['push'](_0x44e92e['shift']());}catch(_0x38d40c){_0x44e92e['push'](_0x44e92e['shift']());}}}(a6_0x3475,0x9e593));const a6_0x2ab24b=(function(){let _0xef97b3=!![];return function(_0x6a8292,_0x4f0fd4){const _0x5ca2d4=_0xef97b3?function(){const _0x6d0c2d=a6_0x2509;if(_0x4f0fd4){const _0xeb5607=_0x4f0fd4[_0x6d0c2d(0x276)](_0x6a8292,arguments);return _0x4f0fd4=null,_0xeb5607;}}:function(){};return _0xef97b3=![],_0x5ca2d4;};}()),a6_0x3a4c94=a6_0x2ab24b(this,function(){const _0x59c0f9=a6_0x2509;return a6_0x3a4c94[_0x59c0f9(0x234)]()['search'](_0x59c0f9(0x27a))['toString']()[_0x59c0f9(0x212)](a6_0x3a4c94)[_0x59c0f9(0x1c4)](_0x59c0f9(0x27a));});a6_0x3a4c94();function a6_0x2509(_0x1b9a81,_0x2e78d6){const _0x2cadb1=a6_0x3475();return a6_0x2509=function(_0x3a4c94,_0x2ab24b){_0x3a4c94=_0x3a4c94-0x1ac;let _0x34753d=_0x2cadb1[_0x3a4c94];return _0x34753d;},a6_0x2509(_0x1b9a81,_0x2e78d6);}const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require('wrtc'),sharp=require(a6_0x5870cf(0x243)),config=require(a6_0x5870cf(0x1d5)),DepthImageProcessor=require(a6_0x5870cf(0x1b6)),turnCredentialsService=require(a6_0x5870cf(0x208));class ApplianceWebRTCService{constructor(){const _0x349fcc=a6_0x5870cf;this[_0x349fcc(0x1cb)]=new Map(),this[_0x349fcc(0x213)]=new Map(),this['sharedVideoSources']=new Map(),this[_0x349fcc(0x205)]=null,this[_0x349fcc(0x1f4)]=null,this[_0x349fcc(0x244)]=new DepthImageProcessor(),this[_0x349fcc(0x26b)]={'iceServers':[{'urls':_0x349fcc(0x1d0)},{'urls':_0x349fcc(0x232)}]};}[a6_0x5870cf(0x266)](_0x55c1b1,_0x190add){const _0x35eaad=a6_0x5870cf;this[_0x35eaad(0x205)]=_0x55c1b1,this[_0x35eaad(0x1f4)]=_0x190add,turnCredentialsService['initialize'](config[_0x35eaad(0x1c7)]),this[_0x35eaad(0x1b0)](),console[_0x35eaad(0x1ad)](_0x35eaad(0x218));}async[a6_0x5870cf(0x1b0)](){const _0x24ee1d=a6_0x5870cf;try{console[_0x24ee1d(0x1ad)](_0x24ee1d(0x1e1));const _0x30e75e=await turnCredentialsService[_0x24ee1d(0x1b7)]();this[_0x24ee1d(0x26b)][_0x24ee1d(0x280)]=_0x30e75e,console[_0x24ee1d(0x1ad)](_0x24ee1d(0x1d7));}catch(_0x42703d){console[_0x24ee1d(0x1ec)]('[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:',_0x42703d),console[_0x24ee1d(0x1ad)](_0x24ee1d(0x23b));}}['handleMessage'](_0x25b1cc){const _0x250585=a6_0x5870cf;if(!_0x25b1cc['op']||!_0x25b1cc['op'][_0x250585(0x22b)]('webrtc_'))return![];console['log']('[WebRTC\x20Appliance]\x20Handling\x20message:\x20'+_0x25b1cc['op']);switch(_0x25b1cc['op']){case'webrtc_init_session':this[_0x250585(0x1fc)](_0x25b1cc[_0x250585(0x263)],_0x25b1cc['topic']);return!![];case _0x250585(0x258):this[_0x250585(0x265)](_0x25b1cc[_0x250585(0x263)],_0x25b1cc[_0x250585(0x1c3)]);return!![];case _0x250585(0x274):this[_0x250585(0x252)](_0x25b1cc[_0x250585(0x263)],_0x25b1cc[_0x250585(0x26d)]);return!![];case _0x250585(0x1b2):this[_0x250585(0x248)](_0x25b1cc[_0x250585(0x263)]);return!![];default:console[_0x250585(0x1fa)](_0x250585(0x247)+_0x25b1cc['op']);return![];}}[a6_0x5870cf(0x1e6)](_0x537f22){const _0x2236dd=a6_0x5870cf;if(this['sharedVideoSources'][_0x2236dd(0x261)](_0x537f22)){const _0x3e3d7f=this[_0x2236dd(0x220)][_0x2236dd(0x1ba)](_0x537f22);return _0x3e3d7f[_0x2236dd(0x1d4)]++,console[_0x2236dd(0x1ad)](_0x2236dd(0x20d)+_0x537f22+'\x20('+_0x3e3d7f[_0x2236dd(0x1d4)]+_0x2236dd(0x273)),_0x3e3d7f;}console[_0x2236dd(0x1ad)](_0x2236dd(0x215)+_0x537f22);const {createCanvas:_0x466dfb}=require('canvas'),_0xe88daa=_0x466dfb(config['webrtc'][_0x2236dd(0x24f)][_0x2236dd(0x23c)],config[_0x2236dd(0x1ea)]['video'][_0x2236dd(0x233)]),_0x37de1d=_0xe88daa[_0x2236dd(0x27c)]('2d');this[_0x2236dd(0x202)](_0xe88daa,_0x37de1d);const {RTCVideoSource:_0x2a1b62}=nonstandard,_0x2ecbef=new _0x2a1b62();let _0x292a44=0x0;const _0xe30459=0x3e8/config[_0x2236dd(0x1ea)]['video'][_0x2236dd(0x1b5)],_0x450d0c=this[_0x2236dd(0x211)](_0x537f22,_0xf79a6f=>{const _0x250c92=_0x2236dd,_0x1c4feb=Date['now']();_0x1c4feb-_0x292a44>=_0xe30459&&(_0x292a44=_0x1c4feb,this[_0x250c92(0x23d)](_0xe88daa,_0x37de1d,_0xf79a6f,_0x537f22,_0x2ecbef));}),_0x23534f={'videoSource':_0x2ecbef,'canvas':_0xe88daa,'rosSubscriber':_0x450d0c,'frameCount':0x1,'topic':_0x537f22};return this[_0x2236dd(0x220)][_0x2236dd(0x25f)](_0x537f22,_0x23534f),_0x23534f;}['releaseSharedVideoSource'](_0x4cbd28){const _0x1597da=a6_0x5870cf,_0x1f3f91=this[_0x1597da(0x220)][_0x1597da(0x1ba)](_0x4cbd28);if(!_0x1f3f91)return;_0x1f3f91['frameCount']--,console['log'](_0x1597da(0x223)+_0x4cbd28+'\x20('+_0x1f3f91[_0x1597da(0x1d4)]+_0x1597da(0x1bf)),_0x1f3f91[_0x1597da(0x1d4)]<=0x0&&(console[_0x1597da(0x1ad)](_0x1597da(0x206)+_0x4cbd28+_0x1597da(0x279)),_0x1f3f91['videoSource']&&(_0x1f3f91['videoSource']=null),_0x1f3f91[_0x1597da(0x1ff)]&&_0x1f3f91[_0x1597da(0x1ff)]['unsubscribe'](),this[_0x1597da(0x220)]['delete'](_0x4cbd28));}async['initializeSession'](_0x19174e,_0x4a2aec){const _0x4bfd50=a6_0x5870cf;try{console[_0x4bfd50(0x1ad)](_0x4bfd50(0x23a)+_0x19174e+'\x20for\x20topic\x20'+_0x4a2aec);const _0x5b461f=this[_0x4bfd50(0x1e6)](_0x4a2aec),_0x36a049=new RTCPeerConnection(this[_0x4bfd50(0x26b)]),_0x4f1edd=_0x5b461f[_0x4bfd50(0x1f0)]['createTrack']({'width':config['webrtc'][_0x4bfd50(0x24f)][_0x4bfd50(0x23c)],'height':config[_0x4bfd50(0x1ea)]['video'][_0x4bfd50(0x233)],'framerate':config[_0x4bfd50(0x1ea)][_0x4bfd50(0x24f)][_0x4bfd50(0x1b5)]});console[_0x4bfd50(0x1ad)](_0x4bfd50(0x1f9)+_0x19174e);const {MediaStream:_0x3af242}=require(_0x4bfd50(0x1bd)),_0x37cc14=new _0x3af242([_0x4f1edd]);_0x36a049[_0x4bfd50(0x22a)](_0x4f1edd,_0x37cc14),this[_0x4bfd50(0x1d3)](_0x5b461f['videoSource'],_0x5b461f[_0x4bfd50(0x1e8)]),_0x36a049[_0x4bfd50(0x1e9)]=_0x764d06=>{const _0x3b3b2a=_0x4bfd50;if(_0x764d06[_0x3b3b2a(0x26d)]&&this[_0x3b3b2a(0x1f4)])console[_0x3b3b2a(0x1ad)](_0x3b3b2a(0x238)+_0x19174e+':',{'type':_0x764d06[_0x3b3b2a(0x26d)][_0x3b3b2a(0x21d)],'protocol':_0x764d06[_0x3b3b2a(0x26d)]['protocol'],'address':_0x764d06[_0x3b3b2a(0x26d)][_0x3b3b2a(0x21e)],'port':_0x764d06[_0x3b3b2a(0x26d)]['port']}),this['serverWs'][_0x3b3b2a(0x209)](JSON[_0x3b3b2a(0x203)]({'op':_0x3b3b2a(0x274),'session_id':_0x19174e,'candidate':_0x764d06[_0x3b3b2a(0x26d)]}));else!_0x764d06[_0x3b3b2a(0x26d)]&&console[_0x3b3b2a(0x1ad)](_0x3b3b2a(0x245)+_0x19174e);},_0x36a049[_0x4bfd50(0x21c)]=()=>{const _0x215be6=_0x4bfd50;console['log'](_0x215be6(0x23f)+_0x19174e+'\x20connection\x20state:\x20'+_0x36a049[_0x215be6(0x228)]);if(_0x36a049[_0x215be6(0x228)]===_0x215be6(0x241))console[_0x215be6(0x1ad)](_0x215be6(0x23f)+_0x19174e+_0x215be6(0x20c));else{if(_0x36a049[_0x215be6(0x228)]===_0x215be6(0x25b))console[_0x215be6(0x1ad)](_0x215be6(0x23f)+_0x19174e+_0x215be6(0x231)),this[_0x215be6(0x248)](_0x19174e);else _0x36a049[_0x215be6(0x228)]==='closed'&&(console['log']('[WebRTC\x20Appliance]\x20Session\x20'+_0x19174e+_0x215be6(0x1ae)),this[_0x215be6(0x257)](_0x19174e));}},this[_0x4bfd50(0x1cb)][_0x4bfd50(0x25f)](_0x19174e,{'peerConnection':_0x36a049,'topic':_0x4a2aec,'videoTrack':_0x4f1edd,'mediaStream':_0x37cc14,'status':_0x4bfd50(0x1bc)}),!this[_0x4bfd50(0x213)][_0x4bfd50(0x261)](_0x4a2aec)&&this[_0x4bfd50(0x213)][_0x4bfd50(0x25f)](_0x4a2aec,new Set()),this[_0x4bfd50(0x213)]['get'](_0x4a2aec)['add'](_0x19174e),console[_0x4bfd50(0x1ad)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x19174e+'\x20initialized\x20successfully'),console[_0x4bfd50(0x1ad)](_0x4bfd50(0x24e)+_0x4a2aec+':\x20'+this[_0x4bfd50(0x213)][_0x4bfd50(0x1ba)](_0x4a2aec)[_0x4bfd50(0x237)]);}catch(_0x2ee85e){console[_0x4bfd50(0x1ec)](_0x4bfd50(0x1cc)+_0x19174e+':',_0x2ee85e),this[_0x4bfd50(0x248)](_0x19174e);}}async['handleOffer'](_0xb163a1,_0x4a651b){const _0x3286aa=a6_0x5870cf,_0x694275=this['activeSessions'][_0x3286aa(0x1ba)](_0xb163a1);if(!_0x694275){console['error'](_0x3286aa(0x1ca)+_0xb163a1);return;}try{console[_0x3286aa(0x1ad)]('[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20'+_0xb163a1),await _0x694275[_0x3286aa(0x230)][_0x3286aa(0x1d9)](new RTCSessionDescription(_0x4a651b)),console[_0x3286aa(0x1ad)](_0x3286aa(0x1c1));const _0x23193e=await _0x694275[_0x3286aa(0x230)][_0x3286aa(0x26e)]();console['log'](_0x3286aa(0x1f8)),await _0x694275[_0x3286aa(0x230)][_0x3286aa(0x1cd)](_0x23193e),console[_0x3286aa(0x1ad)]('[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)'),this['serverWs']&&(this[_0x3286aa(0x1f4)]['send'](JSON[_0x3286aa(0x203)]({'op':'webrtc_answer','session_id':_0xb163a1,'answer':_0x23193e})),console[_0x3286aa(0x1ad)](_0x3286aa(0x1ed)+_0xb163a1));}catch(_0x4e3f04){console[_0x3286aa(0x1ec)](_0x3286aa(0x27f)+_0xb163a1+':',_0x4e3f04),this[_0x3286aa(0x248)](_0xb163a1);}}async[a6_0x5870cf(0x252)](_0x4a6bdf,_0x4b30f9){const _0x48b59c=a6_0x5870cf,_0x17116a=this[_0x48b59c(0x1cb)][_0x48b59c(0x1ba)](_0x4a6bdf);if(!_0x17116a){console['error'](_0x48b59c(0x204)+_0x4a6bdf);return;}try{await _0x17116a['peerConnection'][_0x48b59c(0x25d)](new RTCIceCandidate(_0x4b30f9)),console[_0x48b59c(0x1ad)](_0x48b59c(0x1de)+_0x4a6bdf);}catch(_0x5725a4){console[_0x48b59c(0x1ec)]('[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20'+_0x4a6bdf+':',_0x5725a4);}}['subscribeToROSTopic'](_0xd237ce,_0x4b395b){const _0x5abe51=a6_0x5870cf;if(!this['rosbridgeWs']||this[_0x5abe51(0x205)][_0x5abe51(0x27e)]!==this[_0x5abe51(0x205)][_0x5abe51(0x1e3)])return console[_0x5abe51(0x1ec)]('[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected'),null;console[_0x5abe51(0x1ad)](_0x5abe51(0x210)+_0xd237ce);const _0x4bf2dd=_0xd237ce[_0x5abe51(0x222)](_0x5abe51(0x1e4)),_0x47f955=_0xd237ce[_0x5abe51(0x222)](_0x5abe51(0x24d))||_0xd237ce[_0x5abe51(0x222)](_0x5abe51(0x1d2));let _0x53f20f=[];_0x4bf2dd?_0x47f955?_0x53f20f=['sensor_msgs/CompressedImage',_0x5abe51(0x267),_0x5abe51(0x25e),_0x5abe51(0x24b)]:_0x53f20f=['sensor_msgs/Image','sensor_msgs/msg/Image',_0x5abe51(0x225)]:_0x53f20f=[_0x5abe51(0x225),'sensor_msgs/msg/CompressedImage',_0x5abe51(0x24b)];console[_0x5abe51(0x1ad)](_0x5abe51(0x239)+_0xd237ce+_0x5abe51(0x1cf)+(_0x4bf2dd?_0x5abe51(0x1e4):_0x5abe51(0x1eb))+_0x5abe51(0x216),_0x53f20f);const _0x3aaa27=[];let _0x1ed25e=![];const _0x4d616e=_0x29ab8a=>{return _0x3b76de=>{const _0x5831d0=a6_0x2509;try{const _0x20ee89=JSON[_0x5831d0(0x260)](_0x3b76de[_0x5831d0(0x1d8)]);_0x20ee89['op']==='publish'&&_0x20ee89['topic']===_0xd237ce&&_0x20ee89['msg']&&(!_0x1ed25e&&(console[_0x5831d0(0x1ad)]('[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20'+_0xd237ce+_0x5831d0(0x27b)+_0x29ab8a),_0x1ed25e=!![]),_0x4b395b(_0x20ee89['msg']));}catch(_0x56442e){console[_0x5831d0(0x1ec)](_0x5831d0(0x219),_0x56442e);}};};for(const _0x197d43 of _0x53f20f){const _0x5336aa={'op':_0x5abe51(0x1c9),'topic':_0xd237ce,'type':_0x197d43};console['log'](_0x5abe51(0x240)+_0x197d43),this[_0x5abe51(0x205)][_0x5abe51(0x209)](JSON[_0x5abe51(0x203)](_0x5336aa));const _0x1fa4ea=_0x4d616e(_0x197d43);this[_0x5abe51(0x205)][_0x5abe51(0x1ef)]('message',_0x1fa4ea),_0x3aaa27['push']({'handler':_0x1fa4ea,'type':_0x197d43});}return _0x4bf2dd&&_0x47f955&&setTimeout(()=>{const _0x59ab66=_0x5abe51;if(!_0x1ed25e){console['log']('[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20'+_0xd237ce+',\x20trying\x20alternative\x20depth\x20topics');const _0x1800f7=_0xd237ce[_0x59ab66(0x217)](_0x59ab66(0x253),'')['replace'](_0x59ab66(0x236),''),_0x3981a3=[_0x1800f7+_0x59ab66(0x1f1),_0x1800f7+_0x59ab66(0x1d1),_0x1800f7];for(const _0x10488a of _0x3981a3){console[_0x59ab66(0x1ad)](_0x59ab66(0x1b4)+_0x10488a);const _0x1ebc6c={'op':'subscribe','topic':_0x10488a,'type':'sensor_msgs/Image'};this[_0x59ab66(0x205)]['send'](JSON[_0x59ab66(0x203)](_0x1ebc6c));const _0x73a499=_0x68595f=>{const _0x284a00=_0x59ab66;try{const _0x27f6db=JSON[_0x284a00(0x260)](_0x68595f['data']);_0x27f6db['op']===_0x284a00(0x271)&&_0x27f6db[_0x284a00(0x1c0)]===_0x10488a&&_0x27f6db[_0x284a00(0x26f)]&&(console['log'](_0x284a00(0x21b)+_0x10488a+_0x284a00(0x269)),_0x27f6db[_0x284a00(0x26f)][_0x284a00(0x1d8)]&&!_0x27f6db['msg'][_0x284a00(0x1d8)][_0x284a00(0x22b)](_0x284a00(0x272))&&_0x4b395b(_0x27f6db[_0x284a00(0x26f)]));}catch(_0x20041e){console[_0x284a00(0x1ec)](_0x284a00(0x1c8),_0x20041e);}};this[_0x59ab66(0x205)]['addEventListener'](_0x59ab66(0x26c),_0x73a499),_0x3aaa27[_0x59ab66(0x1f6)]({'handler':_0x73a499,'type':_0x59ab66(0x24b),'topic':_0x10488a});}}},0xbb8),{'unsubscribe':()=>{const _0x5aa210=_0x5abe51;for(const {handler:_0xa9f3e4,type:_0x205a0b,topic:_0x41bd80}of _0x3aaa27){this['rosbridgeWs']['removeEventListener']('message',_0xa9f3e4),this['rosbridgeWs']['readyState']===this[_0x5aa210(0x205)][_0x5aa210(0x1e3)]&&this[_0x5aa210(0x205)][_0x5aa210(0x209)](JSON[_0x5aa210(0x203)]({'op':'unsubscribe','topic':_0x41bd80||_0xd237ce}));}}};}[a6_0x5870cf(0x202)](_0x593817,_0x36da65){const _0x5ca417=a6_0x5870cf;_0x36da65[_0x5ca417(0x1e7)]='#1a1a1a',_0x36da65[_0x5ca417(0x250)](0x0,0x0,_0x593817[_0x5ca417(0x23c)],_0x593817[_0x5ca417(0x233)]),_0x36da65['fillStyle']=_0x5ca417(0x20b),_0x36da65['font']=_0x5ca417(0x22c),_0x36da65[_0x5ca417(0x270)]='center',_0x36da65[_0x5ca417(0x1dc)](_0x5ca417(0x1d6),_0x593817[_0x5ca417(0x23c)]/0x2,_0x593817[_0x5ca417(0x233)]/0x2-0x14),_0x36da65['fillStyle']=_0x5ca417(0x1ee),_0x36da65[_0x5ca417(0x1c5)]=_0x5ca417(0x1e5),_0x36da65['fillText'](_0x5ca417(0x1df),_0x593817[_0x5ca417(0x23c)]/0x2,_0x593817[_0x5ca417(0x233)]/0x2+0x14);const _0x545ad4=Date[_0x5ca417(0x1f5)]()/0x3e8;for(let _0x163cbf=0x0;_0x163cbf<0x3;_0x163cbf++){const _0x2fa243=(Math['sin'](_0x545ad4*0x2+_0x163cbf*0.5)+0x1)/0x2;_0x36da65['fillStyle']=_0x5ca417(0x235)+_0x2fa243*0.5+')',_0x36da65[_0x5ca417(0x277)](),_0x36da65[_0x5ca417(0x262)](_0x593817[_0x5ca417(0x23c)]/0x2-0x28+_0x163cbf*0x28,_0x593817[_0x5ca417(0x233)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x36da65[_0x5ca417(0x1db)]();}}[a6_0x5870cf(0x1d3)](_0x5921c4,_0x5b68c7){const _0x4ddd40=a6_0x5870cf;try{if(!_0x5921c4||!_0x5b68c7)return;const _0x4fa440=_0x5b68c7[_0x4ddd40(0x27c)]('2d'),_0x4fc246=_0x4fa440[_0x4ddd40(0x1f3)](0x0,0x0,_0x5b68c7[_0x4ddd40(0x23c)],_0x5b68c7[_0x4ddd40(0x233)]),_0x3070ad=this[_0x4ddd40(0x22d)](_0x4fc246[_0x4ddd40(0x1d8)],_0x5b68c7['width'],_0x5b68c7[_0x4ddd40(0x233)]),_0x2bf03a={'width':_0x5b68c7[_0x4ddd40(0x23c)],'height':_0x5b68c7[_0x4ddd40(0x233)],'data':_0x3070ad};typeof _0x5921c4[_0x4ddd40(0x20f)]===_0x4ddd40(0x1f2)&&_0x5921c4['onFrame'](_0x2bf03a);}catch(_0x3abe73){console[_0x4ddd40(0x1ec)](_0x4ddd40(0x229),_0x3abe73);}}['convertRGBAtoI420'](_0x4547dc,_0x1bbdd3,_0x164c72){const _0x504ada=a6_0x5870cf,_0x47ffee=_0x1bbdd3*_0x164c72,_0x571c00=_0x1bbdd3*_0x164c72/0x4,_0x2bc6f6=new Uint8Array(_0x47ffee+_0x571c00*0x2);let _0x2feb91=0x0,_0x1694dc=_0x47ffee,_0x3526b3=_0x47ffee+_0x571c00;for(let _0x39e993=0x0;_0x39e993<_0x164c72;_0x39e993++){for(let _0x5bb71a=0x0;_0x5bb71a<_0x1bbdd3;_0x5bb71a++){const _0x5381ea=(_0x39e993*_0x1bbdd3+_0x5bb71a)*0x4,_0x31b1fe=_0x4547dc[_0x5381ea],_0x34ebe2=_0x4547dc[_0x5381ea+0x1],_0x2bcee8=_0x4547dc[_0x5381ea+0x2],_0x2ce25b=Math[_0x504ada(0x1be)](0.299*_0x31b1fe+0.587*_0x34ebe2+0.114*_0x2bcee8);_0x2bc6f6[_0x2feb91++]=_0x2ce25b;if(_0x39e993%0x2===0x0&&_0x5bb71a%0x2===0x0){const _0x210dc0=Math[_0x504ada(0x1be)](-0.169*_0x31b1fe-0.331*_0x34ebe2+0.5*_0x2bcee8+0x80),_0x2707c1=Math['round'](0.5*_0x31b1fe-0.419*_0x34ebe2-0.081*_0x2bcee8+0x80);_0x2bc6f6[_0x1694dc++]=Math['max'](0x0,Math[_0x504ada(0x1bb)](0xff,_0x210dc0)),_0x2bc6f6[_0x3526b3++]=Math[_0x504ada(0x251)](0x0,Math[_0x504ada(0x1bb)](0xff,_0x2707c1));}}}return _0x2bc6f6;}async[a6_0x5870cf(0x23d)](_0xb5e53b,_0x1ee077,_0x21df48,_0x3ccb0a,_0x1770e6){const _0x26b86b=a6_0x5870cf;try{if(!_0x21df48||!_0x21df48['data'])return;Math['random']()<0.01&&console['log'](_0x26b86b(0x226)+_0x3ccb0a+_0x26b86b(0x20e)+_0x21df48[_0x26b86b(0x1d8)]['length']+_0x26b86b(0x22f));const _0x2492d8=Buffer[_0x26b86b(0x1dd)](_0x21df48[_0x26b86b(0x1d8)],_0x26b86b(0x1b8)),_0x5aa724=this['depthProcessor']['isDepthTopic'](_0x3ccb0a);let _0x4b4975;_0x5aa724?_0x4b4975=await this[_0x26b86b(0x244)][_0x26b86b(0x249)](_0x2492d8,_0xb5e53b,_0x1ee077,_0x3ccb0a):_0x4b4975=await this[_0x26b86b(0x244)][_0x26b86b(0x1e2)](_0x2492d8,_0xb5e53b,_0x1ee077),_0x1ee077[_0x26b86b(0x278)](_0x4b4975,0x0,0x0),_0x1ee077[_0x26b86b(0x1e7)]=_0x26b86b(0x1fe),_0x1ee077[_0x26b86b(0x250)](0xa,0xa,0xdc,0x32),_0x1ee077[_0x26b86b(0x1e7)]=_0x5aa724?'#00ffff':_0x26b86b(0x221),_0x1ee077[_0x26b86b(0x1c5)]=_0x26b86b(0x246),_0x1ee077['fillText']((_0x5aa724?_0x26b86b(0x26a):_0x26b86b(0x242))+':\x20'+new Date()[_0x26b86b(0x25c)](),0xf,0x1c),_0x1ee077[_0x26b86b(0x1e7)]=_0x26b86b(0x1ee),_0x1ee077['font']=_0x26b86b(0x256),_0x1ee077[_0x26b86b(0x1dc)](_0x26b86b(0x25a)+_0x3ccb0a['split']('/')[_0x26b86b(0x20a)](),0xf,0x2d),this[_0x26b86b(0x1d3)](_0x1770e6,_0xb5e53b);}catch(_0x2c1c3f){console['warn'](_0x26b86b(0x1b1)+_0x3ccb0a+':',_0x2c1c3f[_0x26b86b(0x26c)]);_0x3ccb0a[_0x26b86b(0x222)](_0x26b86b(0x1e4))&&Math[_0x26b86b(0x1af)]()<0.1&&console[_0x26b86b(0x1fa)](_0x26b86b(0x268)+_0x3ccb0a[_0x26b86b(0x217)](_0x26b86b(0x253),_0x26b86b(0x1f1)));_0x1ee077[_0x26b86b(0x1e7)]=_0x26b86b(0x24a),_0x1ee077[_0x26b86b(0x250)](0x0,0x0,_0xb5e53b['width'],_0xb5e53b['height']),_0x1ee077[_0x26b86b(0x1e7)]=_0x26b86b(0x1ac),_0x1ee077['font']=_0x26b86b(0x1e5),_0x1ee077['textAlign']='center';const _0x3772cb=_0x3ccb0a['includes'](_0x26b86b(0x1e4))?_0x26b86b(0x23e):_0x26b86b(0x1e0);_0x1ee077[_0x26b86b(0x1dc)](_0x3772cb,_0xb5e53b['width']/0x2,_0xb5e53b[_0x26b86b(0x233)]/0x2),_0x1ee077[_0x26b86b(0x1e7)]='#666',_0x1ee077[_0x26b86b(0x1c5)]=_0x26b86b(0x207),_0x1ee077[_0x26b86b(0x1dc)](_0x26b86b(0x25a)+_0x3ccb0a['split']('/')[_0x26b86b(0x20a)](),_0xb5e53b[_0x26b86b(0x23c)]/0x2,_0xb5e53b[_0x26b86b(0x233)]/0x2+0x19),this['sendFrameToVideoSource'](_0x1770e6,_0xb5e53b);}}[a6_0x5870cf(0x248)](_0x400af4){const _0x302822=a6_0x5870cf,_0x4183aa=this[_0x302822(0x1cb)][_0x302822(0x1ba)](_0x400af4);if(!_0x4183aa){console[_0x302822(0x1fa)](_0x302822(0x21f)+_0x400af4);return;}console[_0x302822(0x1ad)]('[WebRTC\x20Appliance]\x20Stopping\x20session:\x20'+_0x400af4+_0x302822(0x1c2)+_0x4183aa[_0x302822(0x1c0)]);try{this[_0x302822(0x1f4)]&&this[_0x302822(0x1f4)][_0x302822(0x27e)]===this[_0x302822(0x1f4)][_0x302822(0x1e3)]&&this['serverWs'][_0x302822(0x209)](JSON[_0x302822(0x203)]({'op':_0x302822(0x1b2),'session_id':_0x400af4})),_0x4183aa[_0x302822(0x1ce)]&&_0x4183aa[_0x302822(0x1ce)]['stop'](),_0x4183aa[_0x302822(0x230)]&&_0x4183aa[_0x302822(0x230)][_0x302822(0x1b3)]();}catch(_0x3dbd23){console[_0x302822(0x1ec)](_0x302822(0x200)+_0x3dbd23);}this['cleanupSession'](_0x400af4);}[a6_0x5870cf(0x257)](_0x1e6c89){const _0x176c97=a6_0x5870cf,_0xefb31=this[_0x176c97(0x1cb)]['get'](_0x1e6c89);if(_0xefb31){const _0x3c7116=this[_0x176c97(0x213)][_0x176c97(0x1ba)](_0xefb31['topic']);_0x3c7116&&(_0x3c7116[_0x176c97(0x1c6)](_0x1e6c89),_0x3c7116[_0x176c97(0x237)]===0x0&&this[_0x176c97(0x213)]['delete'](_0xefb31[_0x176c97(0x1c0)])),this['releaseSharedVideoSource'](_0xefb31[_0x176c97(0x1c0)]);}this[_0x176c97(0x1cb)][_0x176c97(0x1c6)](_0x1e6c89),console[_0x176c97(0x1ad)](_0x176c97(0x1fb)+_0x1e6c89);}[a6_0x5870cf(0x201)](){const _0x1e2fbd=a6_0x5870cf;console[_0x1e2fbd(0x1ad)](_0x1e2fbd(0x264));const _0x39e7b0=Array[_0x1e2fbd(0x1dd)](this[_0x1e2fbd(0x1cb)][_0x1e2fbd(0x21a)]());_0x39e7b0[_0x1e2fbd(0x1b9)](_0x35a2ac=>this['stopSession'](_0x35a2ac));}[a6_0x5870cf(0x275)](){const _0x2c00db=a6_0x5870cf,_0x50f637=[];for(const [_0x461968,_0x1d22e6]of this[_0x2c00db(0x1cb)]){_0x50f637['push']({'sessionId':_0x461968,'topic':_0x1d22e6['topic'],'connectionState':_0x1d22e6['peerConnection']?.[_0x2c00db(0x228)]||'unknown','hasVideoTrack':!!_0x1d22e6[_0x2c00db(0x1ce)]});}return _0x50f637;}[a6_0x5870cf(0x24c)](){const _0x148d58=a6_0x5870cf,_0x220681=[];for(const [_0x31cd05,_0x5d61b2]of this[_0x148d58(0x220)]){_0x220681[_0x148d58(0x1f6)]({'topic':_0x31cd05,'frameCount':_0x5d61b2['frameCount'],'hasVideoSource':!!_0x5d61b2[_0x148d58(0x1f0)],'hasRosSubscriber':!!_0x5d61b2[_0x148d58(0x1ff)]});}return _0x220681;}}module[a6_0x5870cf(0x1f7)]=new ApplianceWebRTCService();function a6_0x3475(){const _0x19a63a=['(((.+)+)+)+$','\x20with\x20message\x20type\x20','getContext','4889095eDBzTu','readyState','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','iceServers','#888','log','\x20connection\x20closed,\x20cleaning\x20up','random','updateTurnCredentials','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','webrtc_stop_session','close','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','framerate','./DepthImageProcessor','getIceServers','base64','forEach','get','min','initializing','wrtc','round','\x20sessions\x20remaining)','topic','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','\x20for\x20topic:\x20','offer','search','font','delete','serverUrl','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','subscribe','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','activeSessions','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','setLocalDescription','videoTrack','\x20detected\x20as\x20','stun:stun.l.google.com:19302','/image','compressedDepth','sendFrameToVideoSource','frameCount','../config','🤖\x20Robot\x20Camera','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','data','setRemoteDescription','31157zaoPdP','fill','fillText','from','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','Waiting\x20for\x20ROS\x20image\x20data...','📹\x20Processing\x20video...','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','processColorImage','OPEN','depth','16px\x20Arial','getOrCreateSharedVideoSource','fillStyle','canvas','onicecandidate','webrtc','color','error','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','#ffffff','addEventListener','videoSource','/image_raw','function','getImageData','serverWs','now','push','exports','[WebRTC\x20Appliance]\x20Created\x20answer','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','warn','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','initializeSession','995032MEsKmx','rgba(0,\x200,\x200,\x200.7)','rosSubscriber','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','stopAllSessions','drawLoadingPattern','stringify','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','rosbridgeWs','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','12px\x20Arial','./turnCredentialsService','send','pop','#00aaff','\x20successfully\x20connected!','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20',',\x20size:\x20','onFrame','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','subscribeToROSTopic','constructor','topicSessions','9DzquAZ','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','\x20image,\x20trying\x20message\x20types:','replace','[WebRTC\x20Appliance]\x20Service\x20initialized','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','keys','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','onconnectionstatechange','type','address','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','sharedVideoSources','#00ff00','includes','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','911938lPdFaU','sensor_msgs/CompressedImage','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','4740064MLRImb','connectionState','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','addTrack','startsWith','24px\x20Arial','convertRGBAtoI420','6BwpWoh','\x20bytes','peerConnection','\x20connection\x20failed,\x20stopping\x20session','stun:stun1.l.google.com:19302','height','toString','rgba(0,\x20170,\x20255,\x20','/compressed','size','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Topic\x20','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','width','updateCanvasWithImageData','🔍\x20Processing\x20depth...','[WebRTC\x20Appliance]\x20Session\x20','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','connected','📹\x20Color','sharp','depthProcessor','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','12px\x20monospace','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','stopSession','processDepthImage','#1a1a1a','sensor_msgs/Image','getSharedVideoSources','compressed','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','video','fillRect','max','handleIceCandidate','/compressedDepth','16340170yPTCXX','1145922bWmKow','10px\x20monospace','cleanupSession','webrtc_offer','144lPUUIQ','Topic:\x20','failed','toLocaleTimeString','addIceCandidate','compressed_depth_image_transport/CompressedDepthImage','set','parse','has','arc','session_id','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','handleOffer','initialize','sensor_msgs/msg/CompressedImage','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20',',\x20converting\x20to\x20base64...','🔍\x20Depth','rtcConfig','message','candidate','createAnswer','msg','textAlign','publish','/9j/','\x20sessions)','webrtc_ice_candidate','getActiveSessions','apply','beginPath','putImageData',',\x20cleaning\x20up\x20shared\x20resources'];a6_0x3475=function(){return _0x19a63a;};return a6_0x3475();}