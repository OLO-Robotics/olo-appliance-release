function a6_0x30f0(_0x946821,_0x5e870a){const _0x41b75a=a6_0x6de9();return a6_0x30f0=function(_0x11c344,_0x468b92){_0x11c344=_0x11c344-0x113;let _0x6de9e5=_0x41b75a[_0x11c344];return _0x6de9e5;},a6_0x30f0(_0x946821,_0x5e870a);}const a6_0x3b8064=a6_0x30f0;function a6_0x6de9(){const _0x23044d=['type','147SlMpJB','#00ff00','replace','get','has','webrtc','#ffffff','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','readyState','session_id','convertRGBAtoI420','framerate','Topic:\x20','protocol','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','closed','processColorImage','failed','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','round','/image_raw','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','\x20sessions\x20remaining)','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','textAlign','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','webrtc_stop_session','releaseSharedVideoSource','getImageData','addIceCandidate','5167056rWLwzd','./turnCredentialsService','(((.+)+)+)+$','log','pop','#666','getIceServers','font','initializeSession','13409990CIYvsX','getSharedVideoSources','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','rosbridgeWs','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','video','subscribe','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','2046450DRiOyo','getOrCreateSharedVideoSource','drawLoadingPattern','compressedDepth','\x20for\x20topic:\x20','sharp','updateTurnCredentials','connected','webrtc_offer','base64','11ZYMDsE','data',',\x20cleaning\x20up\x20shared\x20resources','Waiting\x20for\x20ROS\x20image\x20data...','stopAllSessions','port','\x20initialized\x20successfully','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','unknown','depth','\x20connection\x20closed,\x20cleaning\x20up','449zXzzJO','rgba(0,\x200,\x200,\x200.7)','videoTrack','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','toLocaleTimeString','onFrame','canvas','compressed','webrtc_answer','min','keys','random','stun:stun.l.google.com:19302','webrtc_init_session','now','\x20bytes','cleanupSession','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','9624060HohbYg','setRemoteDescription','rosSubscriber','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','/image','setLocalDescription',',\x20trying\x20alternative\x20depth\x20topics','createAnswer','16px\x20Arial','webrtc_','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','12px\x20monospace','height','sensor_msgs/Image','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','stopSession','length','rtcConfig','fillStyle','updateCanvasWithImageData','3438rqrRmn','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','unsubscribe','5ybkRzr','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','topicSessions','handleIceCandidate','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','warn','candidate','initialize','[WebRTC\x20Appliance]\x20Service\x20initialized','sharedVideoSources','center','handleMessage','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','push','depthProcessor','onicecandidate','putImageData','handleOffer','sensor_msgs/msg/Image','addEventListener','startsWith','from','processDepthImage','getContext','#00ffff','createTrack','webrtc_ice_candidate','sensor_msgs/CompressedImage','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','delete','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','\x20image,\x20trying\x20message\x20types:','forEach','[WebRTC\x20Appliance]\x20Session\x20','connectionState','/compressedDepth','size','getActiveSessions','12px\x20Arial','59896QomINz','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','peerConnection','videoSource','10px\x20monospace','msg','stop','addTrack','address','frameCount','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','stringify','sendFrameToVideoSource','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','fill','🔍\x20Processing\x20depth...','fillRect','arc','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','includes','#888','topic','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','message','send','error','#1a1a1a','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','\x20connection\x20failed,\x20stopping\x20session','max','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','serverWs','width','split','exports','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','OPEN','24px\x20Arial','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','/9j/','search','iceServers','wrtc','compressed_depth_image_transport/CompressedDepthImage','\x20detected\x20as\x20','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','parse','publish','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','toString','\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Created\x20answer','activeSessions','set',',\x20size:\x20','constructor','onconnectionstatechange','/compressed','fillText','4830848MfBPcu'];a6_0x6de9=function(){return _0x23044d;};return a6_0x6de9();}(function(_0x476505,_0x2f2d63){const _0x3946b5=a6_0x30f0,_0x17ef7c=_0x476505();while(!![]){try{const _0x244004=parseInt(_0x3946b5(0x163))/0x1*(parseInt(_0x3946b5(0x18a))/0x2)+parseInt(_0x3946b5(0x14e))/0x3+-parseInt(_0x3946b5(0x11d))/0x4+parseInt(_0x3946b5(0x18d))/0x5*(parseInt(_0x3946b5(0x13d))/0x6)+parseInt(_0x3946b5(0x11f))/0x7*(-parseInt(_0x3946b5(0x1b5))/0x8)+parseInt(_0x3946b5(0x175))/0x9+-parseInt(_0x3946b5(0x146))/0xa*(parseInt(_0x3946b5(0x158))/0xb);if(_0x244004===_0x2f2d63)break;else _0x17ef7c['push'](_0x17ef7c['shift']());}catch(_0x351b80){_0x17ef7c['push'](_0x17ef7c['shift']());}}}(a6_0x6de9,0xa5a9f));const a6_0x468b92=(function(){let _0x15453b=!![];return function(_0x1d28d7,_0x570ead){const _0x27b87f=_0x15453b?function(){if(_0x570ead){const _0xe0f981=_0x570ead['apply'](_0x1d28d7,arguments);return _0x570ead=null,_0xe0f981;}}:function(){};return _0x15453b=![],_0x27b87f;};}()),a6_0x11c344=a6_0x468b92(this,function(){const _0x2109d5=a6_0x30f0;return a6_0x11c344[_0x2109d5(0x113)]()[_0x2109d5(0x1de)](_0x2109d5(0x13f))[_0x2109d5(0x113)]()[_0x2109d5(0x119)](a6_0x11c344)['search'](_0x2109d5(0x13f));});a6_0x11c344();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x3b8064(0x1e0)),sharp=require(a6_0x3b8064(0x153)),config=require('../config'),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require(a6_0x3b8064(0x13e));class ApplianceWebRTCService{constructor(){const _0x5d9444=a6_0x3b8064;this[_0x5d9444(0x116)]=new Map(),this[_0x5d9444(0x18f)]=new Map(),this[_0x5d9444(0x197)]=new Map(),this[_0x5d9444(0x149)]=null,this[_0x5d9444(0x1d5)]=null,this[_0x5d9444(0x19c)]=new DepthImageProcessor(),this[_0x5d9444(0x187)]={'iceServers':[{'urls':_0x5d9444(0x16f)},{'urls':'stun:stun1.l.google.com:19302'}]};}[a6_0x3b8064(0x195)](_0x1400f6,_0x5c819e){const _0x42762a=a6_0x3b8064;this[_0x42762a(0x149)]=_0x1400f6,this[_0x42762a(0x1d5)]=_0x5c819e,turnCredentialsService[_0x42762a(0x195)](config['serverUrl']),this[_0x42762a(0x154)](),console[_0x42762a(0x140)](_0x42762a(0x196));}async[a6_0x3b8064(0x154)](){const _0x31428a=a6_0x3b8064;try{console[_0x31428a(0x140)](_0x31428a(0x1dc));const _0x4d8d9e=await turnCredentialsService[_0x31428a(0x143)]();this[_0x31428a(0x187)][_0x31428a(0x1df)]=_0x4d8d9e,console[_0x31428a(0x140)](_0x31428a(0x1ac));}catch(_0x46673b){console[_0x31428a(0x1cf)](_0x31428a(0x1c8),_0x46673b),console[_0x31428a(0x140)](_0x31428a(0x1d4));}}[a6_0x3b8064(0x199)](_0x538998){const _0x2e3908=a6_0x3b8064;if(!_0x538998['op']||!_0x538998['op'][_0x2e3908(0x1a2)](_0x2e3908(0x17f)))return![];console[_0x2e3908(0x140)](_0x2e3908(0x18e)+_0x538998['op']);switch(_0x538998['op']){case _0x2e3908(0x170):this[_0x2e3908(0x145)](_0x538998[_0x2e3908(0x128)],_0x538998['topic']);return!![];case _0x2e3908(0x156):this[_0x2e3908(0x19f)](_0x538998[_0x2e3908(0x128)],_0x538998['offer']);return!![];case _0x2e3908(0x1a8):this[_0x2e3908(0x190)](_0x538998['session_id'],_0x538998[_0x2e3908(0x194)]);return!![];case _0x2e3908(0x139):this[_0x2e3908(0x185)](_0x538998[_0x2e3908(0x128)]);return!![];default:console[_0x2e3908(0x193)](_0x2e3908(0x12d)+_0x538998['op']);return![];}}[a6_0x3b8064(0x14f)](_0x1f9c7a){const _0x5929be=a6_0x3b8064;if(this[_0x5929be(0x197)][_0x5929be(0x123)](_0x1f9c7a)){const _0x2c570d=this[_0x5929be(0x197)][_0x5929be(0x122)](_0x1f9c7a);return _0x2c570d[_0x5929be(0x1be)]++,console[_0x5929be(0x140)](_0x5929be(0x1e4)+_0x1f9c7a+'\x20('+_0x2c570d['frameCount']+'\x20sessions)'),_0x2c570d;}console[_0x5929be(0x140)](_0x5929be(0x191)+_0x1f9c7a);const {createCanvas:_0x399168}=require(_0x5929be(0x169)),_0x53e0dc=_0x399168(config[_0x5929be(0x124)][_0x5929be(0x14b)][_0x5929be(0x1d6)],config[_0x5929be(0x124)][_0x5929be(0x14b)][_0x5929be(0x182)]),_0x328a97=_0x53e0dc[_0x5929be(0x1a5)]('2d');this[_0x5929be(0x150)](_0x53e0dc,_0x328a97);const {RTCVideoSource:_0x3ca7f9}=nonstandard,_0x338ea3=new _0x3ca7f9();let _0x1d186c=0x0;const _0x16624a=0x3e8/config[_0x5929be(0x124)][_0x5929be(0x14b)][_0x5929be(0x12a)],_0x855dd7=this['subscribeToROSTopic'](_0x1f9c7a,_0x3b92ea=>{const _0xbadc75=_0x5929be,_0x28b5a6=Date[_0xbadc75(0x171)]();_0x28b5a6-_0x1d186c>=_0x16624a&&(_0x1d186c=_0x28b5a6,this[_0xbadc75(0x189)](_0x53e0dc,_0x328a97,_0x3b92ea,_0x1f9c7a,_0x338ea3));}),_0x38215d={'videoSource':_0x338ea3,'canvas':_0x53e0dc,'rosSubscriber':_0x855dd7,'frameCount':0x1,'topic':_0x1f9c7a};return this[_0x5929be(0x197)][_0x5929be(0x117)](_0x1f9c7a,_0x38215d),_0x38215d;}[a6_0x3b8064(0x13a)](_0x514ec4){const _0x3a59d9=a6_0x3b8064,_0x4c2dae=this[_0x3a59d9(0x197)]['get'](_0x514ec4);if(!_0x4c2dae)return;_0x4c2dae[_0x3a59d9(0x1be)]--,console[_0x3a59d9(0x140)](_0x3a59d9(0x18b)+_0x514ec4+'\x20('+_0x4c2dae[_0x3a59d9(0x1be)]+_0x3a59d9(0x135)),_0x4c2dae[_0x3a59d9(0x1be)]<=0x0&&(console[_0x3a59d9(0x140)](_0x3a59d9(0x126)+_0x514ec4+_0x3a59d9(0x15a)),_0x4c2dae[_0x3a59d9(0x1b8)]&&(_0x4c2dae[_0x3a59d9(0x1b8)]=null),_0x4c2dae[_0x3a59d9(0x177)]&&_0x4c2dae['rosSubscriber']['unsubscribe'](),this[_0x3a59d9(0x197)][_0x3a59d9(0x1ab)](_0x514ec4));}async[a6_0x3b8064(0x145)](_0x13e7d4,_0xe2a0f2){const _0x52af57=a6_0x3b8064;try{console['log'](_0x52af57(0x1c0)+_0x13e7d4+_0x52af57(0x114)+_0xe2a0f2);const _0x48028c=this[_0x52af57(0x14f)](_0xe2a0f2),_0x40787c=new RTCPeerConnection(this['rtcConfig']),_0x24618a=_0x48028c[_0x52af57(0x1b8)][_0x52af57(0x1a7)]({'width':config['webrtc'][_0x52af57(0x14b)][_0x52af57(0x1d6)],'height':config[_0x52af57(0x124)][_0x52af57(0x14b)][_0x52af57(0x182)],'framerate':config[_0x52af57(0x124)]['video'][_0x52af57(0x12a)]});console[_0x52af57(0x140)]('[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20'+_0x13e7d4);const {MediaStream:_0x58a1f1}=require('wrtc'),_0x417fbd=new _0x58a1f1([_0x24618a]);_0x40787c[_0x52af57(0x1bc)](_0x24618a,_0x417fbd),this['sendFrameToVideoSource'](_0x48028c[_0x52af57(0x1b8)],_0x48028c['canvas']),_0x40787c[_0x52af57(0x19d)]=_0x5a6797=>{const _0x4ea4ed=_0x52af57;if(_0x5a6797[_0x4ea4ed(0x194)]&&this['serverWs'])console[_0x4ea4ed(0x140)](_0x4ea4ed(0x136)+_0x13e7d4+':',{'type':_0x5a6797['candidate'][_0x4ea4ed(0x11e)],'protocol':_0x5a6797[_0x4ea4ed(0x194)][_0x4ea4ed(0x12c)],'address':_0x5a6797['candidate'][_0x4ea4ed(0x1bd)],'port':_0x5a6797[_0x4ea4ed(0x194)][_0x4ea4ed(0x15d)]}),this[_0x4ea4ed(0x1d5)][_0x4ea4ed(0x1ce)](JSON['stringify']({'op':_0x4ea4ed(0x1a8),'session_id':_0x13e7d4,'candidate':_0x5a6797[_0x4ea4ed(0x194)]}));else!_0x5a6797[_0x4ea4ed(0x194)]&&console[_0x4ea4ed(0x140)]('[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20'+_0x13e7d4);},_0x40787c[_0x52af57(0x11a)]=()=>{const _0xd30cb8=_0x52af57;console[_0xd30cb8(0x140)](_0xd30cb8(0x1af)+_0x13e7d4+'\x20connection\x20state:\x20'+_0x40787c['connectionState']);if(_0x40787c[_0xd30cb8(0x1b0)]===_0xd30cb8(0x155))console[_0xd30cb8(0x140)](_0xd30cb8(0x1af)+_0x13e7d4+'\x20successfully\x20connected!');else{if(_0x40787c[_0xd30cb8(0x1b0)]===_0xd30cb8(0x130))console[_0xd30cb8(0x140)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x13e7d4+_0xd30cb8(0x1d2)),this[_0xd30cb8(0x185)](_0x13e7d4);else _0x40787c[_0xd30cb8(0x1b0)]===_0xd30cb8(0x12e)&&(console[_0xd30cb8(0x140)](_0xd30cb8(0x1af)+_0x13e7d4+_0xd30cb8(0x162)),this[_0xd30cb8(0x173)](_0x13e7d4));}},this['activeSessions']['set'](_0x13e7d4,{'peerConnection':_0x40787c,'topic':_0xe2a0f2,'videoTrack':_0x24618a,'mediaStream':_0x417fbd,'status':'initializing'}),!this[_0x52af57(0x18f)][_0x52af57(0x123)](_0xe2a0f2)&&this[_0x52af57(0x18f)]['set'](_0xe2a0f2,new Set()),this['topicSessions'][_0x52af57(0x122)](_0xe2a0f2)['add'](_0x13e7d4),console['log'](_0x52af57(0x1af)+_0x13e7d4+_0x52af57(0x15e)),console[_0x52af57(0x140)](_0x52af57(0x178)+_0xe2a0f2+':\x20'+this[_0x52af57(0x18f)][_0x52af57(0x122)](_0xe2a0f2)[_0x52af57(0x1b2)]);}catch(_0x336995){console[_0x52af57(0x1cf)](_0x52af57(0x1e7)+_0x13e7d4+':',_0x336995),this['stopSession'](_0x13e7d4);}}async['handleOffer'](_0x48892a,_0x1efd71){const _0x229026=a6_0x3b8064,_0x596c91=this[_0x229026(0x116)]['get'](_0x48892a);if(!_0x596c91){console[_0x229026(0x1cf)](_0x229026(0x166)+_0x48892a);return;}try{console['log'](_0x229026(0x14d)+_0x48892a),await _0x596c91[_0x229026(0x1b7)][_0x229026(0x176)](new RTCSessionDescription(_0x1efd71)),console[_0x229026(0x140)](_0x229026(0x174));const _0x5f4e72=await _0x596c91[_0x229026(0x1b7)][_0x229026(0x17d)]();console[_0x229026(0x140)](_0x229026(0x115)),await _0x596c91['peerConnection'][_0x229026(0x17b)](_0x5f4e72),console[_0x229026(0x140)]('[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)'),this[_0x229026(0x1d5)]&&(this[_0x229026(0x1d5)][_0x229026(0x1ce)](JSON[_0x229026(0x1c1)]({'op':_0x229026(0x16b),'session_id':_0x48892a,'answer':_0x5f4e72})),console['log'](_0x229026(0x131)+_0x48892a));}catch(_0x35619d){console[_0x229026(0x1cf)](_0x229026(0x14a)+_0x48892a+':',_0x35619d),this[_0x229026(0x185)](_0x48892a);}}async['handleIceCandidate'](_0x1f779b,_0x119905){const _0x4d6d54=a6_0x3b8064,_0x1393b4=this['activeSessions'][_0x4d6d54(0x122)](_0x1f779b);if(!_0x1393b4){console[_0x4d6d54(0x1cf)](_0x4d6d54(0x1d1)+_0x1f779b);return;}try{await _0x1393b4[_0x4d6d54(0x1b7)][_0x4d6d54(0x13c)](new RTCIceCandidate(_0x119905)),console[_0x4d6d54(0x140)](_0x4d6d54(0x15f)+_0x1f779b);}catch(_0x69f1a8){console[_0x4d6d54(0x1cf)](_0x4d6d54(0x138)+_0x1f779b+':',_0x69f1a8);}}['subscribeToROSTopic'](_0x3bf5c0,_0x5a98d1){const _0x399ef0=a6_0x3b8064;if(!this['rosbridgeWs']||this[_0x399ef0(0x149)][_0x399ef0(0x127)]!==this[_0x399ef0(0x149)]['OPEN'])return console[_0x399ef0(0x1cf)]('[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected'),null;console[_0x399ef0(0x140)](_0x399ef0(0x179)+_0x3bf5c0);const _0x4bf48a=_0x3bf5c0[_0x399ef0(0x1c9)]('depth'),_0x29b11b=_0x3bf5c0[_0x399ef0(0x1c9)](_0x399ef0(0x16a))||_0x3bf5c0[_0x399ef0(0x1c9)](_0x399ef0(0x151));let _0x1503eb=[];_0x4bf48a?_0x29b11b?_0x1503eb=[_0x399ef0(0x1a9),'sensor_msgs/msg/CompressedImage',_0x399ef0(0x1e1),_0x399ef0(0x183)]:_0x1503eb=['sensor_msgs/Image',_0x399ef0(0x1a0),_0x399ef0(0x1a9)]:_0x1503eb=[_0x399ef0(0x1a9),'sensor_msgs/msg/CompressedImage','sensor_msgs/Image'];console['log']('[WebRTC\x20Appliance]\x20Topic\x20'+_0x3bf5c0+_0x399ef0(0x1e2)+(_0x4bf48a?_0x399ef0(0x161):'color')+_0x399ef0(0x1ad),_0x1503eb);const _0x13e171=[];let _0x2bf366=![];const _0x17e2ea=_0x2c28de=>{return _0x2d4dd2=>{const _0x145e40=a6_0x30f0;try{const _0x20f336=JSON[_0x145e40(0x1e5)](_0x2d4dd2['data']);_0x20f336['op']===_0x145e40(0x1e6)&&_0x20f336[_0x145e40(0x1cb)]===_0x3bf5c0&&_0x20f336[_0x145e40(0x1ba)]&&(!_0x2bf366&&(console['log']('[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20'+_0x3bf5c0+'\x20with\x20message\x20type\x20'+_0x2c28de),_0x2bf366=!![]),_0x5a98d1(_0x20f336[_0x145e40(0x1ba)]));}catch(_0x186568){console['error']('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x186568);}};};for(const _0x350d20 of _0x1503eb){const _0x26414e={'op':_0x399ef0(0x14c),'topic':_0x3bf5c0,'type':_0x350d20};console[_0x399ef0(0x140)](_0x399ef0(0x19a)+_0x350d20),this[_0x399ef0(0x149)][_0x399ef0(0x1ce)](JSON[_0x399ef0(0x1c1)](_0x26414e));const _0x384f4a=_0x17e2ea(_0x350d20);this[_0x399ef0(0x149)][_0x399ef0(0x1a1)]('message',_0x384f4a),_0x13e171[_0x399ef0(0x19b)]({'handler':_0x384f4a,'type':_0x350d20});}return _0x4bf48a&&_0x29b11b&&setTimeout(()=>{const _0xb98fe1=_0x399ef0;if(!_0x2bf366){console[_0xb98fe1(0x140)](_0xb98fe1(0x134)+_0x3bf5c0+_0xb98fe1(0x17c));const _0x36f83c=_0x3bf5c0[_0xb98fe1(0x121)](_0xb98fe1(0x1b1),'')['replace'](_0xb98fe1(0x11b),''),_0x17ff8e=[_0x36f83c+_0xb98fe1(0x133),_0x36f83c+_0xb98fe1(0x17a),_0x36f83c];for(const _0x163f8e of _0x17ff8e){console[_0xb98fe1(0x140)](_0xb98fe1(0x1e3)+_0x163f8e);const _0x1a9c63={'op':_0xb98fe1(0x14c),'topic':_0x163f8e,'type':_0xb98fe1(0x183)};this[_0xb98fe1(0x149)]['send'](JSON[_0xb98fe1(0x1c1)](_0x1a9c63));const _0x5b7c58=_0x21faf4=>{const _0x4bb7e8=_0xb98fe1;try{const _0x3fa712=JSON[_0x4bb7e8(0x1e5)](_0x21faf4[_0x4bb7e8(0x159)]);_0x3fa712['op']===_0x4bb7e8(0x1e6)&&_0x3fa712['topic']===_0x163f8e&&_0x3fa712[_0x4bb7e8(0x1ba)]&&(console[_0x4bb7e8(0x140)](_0x4bb7e8(0x1cc)+_0x163f8e+',\x20converting\x20to\x20base64...'),_0x3fa712[_0x4bb7e8(0x1ba)][_0x4bb7e8(0x159)]&&!_0x3fa712[_0x4bb7e8(0x1ba)][_0x4bb7e8(0x159)][_0x4bb7e8(0x1a2)](_0x4bb7e8(0x1dd))&&_0x5a98d1(_0x3fa712[_0x4bb7e8(0x1ba)]));}catch(_0x221587){console[_0x4bb7e8(0x1cf)](_0x4bb7e8(0x1bf),_0x221587);}};this[_0xb98fe1(0x149)][_0xb98fe1(0x1a1)](_0xb98fe1(0x1cd),_0x5b7c58),_0x13e171[_0xb98fe1(0x19b)]({'handler':_0x5b7c58,'type':_0xb98fe1(0x183),'topic':_0x163f8e});}}},0xbb8),{'unsubscribe':()=>{const _0x16db29=_0x399ef0;for(const {handler:_0x3d7fe7,type:_0x1ff551,topic:_0xd3e745}of _0x13e171){this[_0x16db29(0x149)]['removeEventListener']('message',_0x3d7fe7),this['rosbridgeWs'][_0x16db29(0x127)]===this[_0x16db29(0x149)][_0x16db29(0x1da)]&&this['rosbridgeWs'][_0x16db29(0x1ce)](JSON[_0x16db29(0x1c1)]({'op':_0x16db29(0x18c),'topic':_0xd3e745||_0x3bf5c0}));}}};}['drawLoadingPattern'](_0x1499ad,_0x2835c4){const _0x2e351b=a6_0x3b8064;_0x2835c4[_0x2e351b(0x188)]='#1a1a1a',_0x2835c4[_0x2e351b(0x1c6)](0x0,0x0,_0x1499ad[_0x2e351b(0x1d6)],_0x1499ad[_0x2e351b(0x182)]),_0x2835c4[_0x2e351b(0x188)]='#00aaff',_0x2835c4['font']=_0x2e351b(0x1db),_0x2835c4[_0x2e351b(0x137)]=_0x2e351b(0x198),_0x2835c4[_0x2e351b(0x11c)]('🤖\x20Robot\x20Camera',_0x1499ad[_0x2e351b(0x1d6)]/0x2,_0x1499ad[_0x2e351b(0x182)]/0x2-0x14),_0x2835c4[_0x2e351b(0x188)]=_0x2e351b(0x125),_0x2835c4[_0x2e351b(0x144)]=_0x2e351b(0x17e),_0x2835c4['fillText'](_0x2e351b(0x15b),_0x1499ad[_0x2e351b(0x1d6)]/0x2,_0x1499ad[_0x2e351b(0x182)]/0x2+0x14);const _0x3ac888=Date[_0x2e351b(0x171)]()/0x3e8;for(let _0x10a036=0x0;_0x10a036<0x3;_0x10a036++){const _0x326c4a=(Math['sin'](_0x3ac888*0x2+_0x10a036*0.5)+0x1)/0x2;_0x2835c4[_0x2e351b(0x188)]='rgba(0,\x20170,\x20255,\x20'+_0x326c4a*0.5+')',_0x2835c4['beginPath'](),_0x2835c4[_0x2e351b(0x1c7)](_0x1499ad[_0x2e351b(0x1d6)]/0x2-0x28+_0x10a036*0x28,_0x1499ad['height']/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x2835c4[_0x2e351b(0x1c4)]();}}[a6_0x3b8064(0x1c2)](_0x6de10b,_0x5ca3ce){const _0x53fb2e=a6_0x3b8064;try{if(!_0x6de10b||!_0x5ca3ce)return;const _0x43877d=_0x5ca3ce[_0x53fb2e(0x1a5)]('2d'),_0x3bb3bd=_0x43877d[_0x53fb2e(0x13b)](0x0,0x0,_0x5ca3ce[_0x53fb2e(0x1d6)],_0x5ca3ce[_0x53fb2e(0x182)]),_0x3cce82=this[_0x53fb2e(0x129)](_0x3bb3bd['data'],_0x5ca3ce[_0x53fb2e(0x1d6)],_0x5ca3ce[_0x53fb2e(0x182)]),_0x320fc7={'width':_0x5ca3ce[_0x53fb2e(0x1d6)],'height':_0x5ca3ce[_0x53fb2e(0x182)],'data':_0x3cce82};typeof _0x6de10b[_0x53fb2e(0x168)]==='function'&&_0x6de10b[_0x53fb2e(0x168)](_0x320fc7);}catch(_0x2f34ed){console[_0x53fb2e(0x1cf)](_0x53fb2e(0x148),_0x2f34ed);}}[a6_0x3b8064(0x129)](_0x5d2b20,_0x5504df,_0x312387){const _0xf9d360=a6_0x3b8064,_0x17e508=_0x5504df*_0x312387,_0x138d86=_0x5504df*_0x312387/0x4,_0x2a76d4=new Uint8Array(_0x17e508+_0x138d86*0x2);let _0x594e3a=0x0,_0x2eef87=_0x17e508,_0x36fb30=_0x17e508+_0x138d86;for(let _0x2ed5a2=0x0;_0x2ed5a2<_0x312387;_0x2ed5a2++){for(let _0xead74a=0x0;_0xead74a<_0x5504df;_0xead74a++){const _0x3cd26d=(_0x2ed5a2*_0x5504df+_0xead74a)*0x4,_0x36ab08=_0x5d2b20[_0x3cd26d],_0x2be8e1=_0x5d2b20[_0x3cd26d+0x1],_0x22428c=_0x5d2b20[_0x3cd26d+0x2],_0x39b3b6=Math[_0xf9d360(0x132)](0.299*_0x36ab08+0.587*_0x2be8e1+0.114*_0x22428c);_0x2a76d4[_0x594e3a++]=_0x39b3b6;if(_0x2ed5a2%0x2===0x0&&_0xead74a%0x2===0x0){const _0x4740bd=Math[_0xf9d360(0x132)](-0.169*_0x36ab08-0.331*_0x2be8e1+0.5*_0x22428c+0x80),_0x185bfe=Math[_0xf9d360(0x132)](0.5*_0x36ab08-0.419*_0x2be8e1-0.081*_0x22428c+0x80);_0x2a76d4[_0x2eef87++]=Math[_0xf9d360(0x1d3)](0x0,Math[_0xf9d360(0x16c)](0xff,_0x4740bd)),_0x2a76d4[_0x36fb30++]=Math['max'](0x0,Math[_0xf9d360(0x16c)](0xff,_0x185bfe));}}}return _0x2a76d4;}async[a6_0x3b8064(0x189)](_0x316121,_0x5bab38,_0x23e654,_0x1efdc3,_0x1983c6){const _0x3b0310=a6_0x3b8064;try{if(!_0x23e654||!_0x23e654[_0x3b0310(0x159)])return;Math[_0x3b0310(0x16e)]()<0.01&&console[_0x3b0310(0x140)](_0x3b0310(0x1aa)+_0x1efdc3+_0x3b0310(0x118)+_0x23e654[_0x3b0310(0x159)][_0x3b0310(0x186)]+_0x3b0310(0x172));const _0x537157=Buffer['from'](_0x23e654['data'],_0x3b0310(0x157)),_0x4d4d92=this[_0x3b0310(0x19c)]['isDepthTopic'](_0x1efdc3);let _0x4e9678;_0x4d4d92?_0x4e9678=await this[_0x3b0310(0x19c)][_0x3b0310(0x1a4)](_0x537157,_0x316121,_0x5bab38,_0x1efdc3):_0x4e9678=await this[_0x3b0310(0x19c)][_0x3b0310(0x12f)](_0x537157,_0x316121,_0x5bab38),_0x5bab38[_0x3b0310(0x19e)](_0x4e9678,0x0,0x0),_0x5bab38[_0x3b0310(0x188)]=_0x3b0310(0x164),_0x5bab38[_0x3b0310(0x1c6)](0xa,0xa,0xdc,0x32),_0x5bab38['fillStyle']=_0x4d4d92?_0x3b0310(0x1a6):_0x3b0310(0x120),_0x5bab38['font']=_0x3b0310(0x181),_0x5bab38['fillText']((_0x4d4d92?'🔍\x20Depth':'📹\x20Color')+':\x20'+new Date()[_0x3b0310(0x167)](),0xf,0x1c),_0x5bab38['fillStyle']='#ffffff',_0x5bab38[_0x3b0310(0x144)]=_0x3b0310(0x1b9),_0x5bab38[_0x3b0310(0x11c)](_0x3b0310(0x12b)+_0x1efdc3[_0x3b0310(0x1d7)]('/')[_0x3b0310(0x141)](),0xf,0x2d),this['sendFrameToVideoSource'](_0x1983c6,_0x316121);}catch(_0x4eff67){console[_0x3b0310(0x193)]('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x1efdc3+':',_0x4eff67[_0x3b0310(0x1cd)]);_0x1efdc3['includes'](_0x3b0310(0x161))&&Math[_0x3b0310(0x16e)]()<0.1&&console[_0x3b0310(0x193)](_0x3b0310(0x180)+_0x1efdc3[_0x3b0310(0x121)](_0x3b0310(0x1b1),_0x3b0310(0x133)));_0x5bab38[_0x3b0310(0x188)]=_0x3b0310(0x1d0),_0x5bab38['fillRect'](0x0,0x0,_0x316121[_0x3b0310(0x1d6)],_0x316121[_0x3b0310(0x182)]),_0x5bab38[_0x3b0310(0x188)]=_0x3b0310(0x1ca),_0x5bab38[_0x3b0310(0x144)]=_0x3b0310(0x17e),_0x5bab38[_0x3b0310(0x137)]=_0x3b0310(0x198);const _0xf9a1b5=_0x1efdc3[_0x3b0310(0x1c9)]('depth')?_0x3b0310(0x1c5):'📹\x20Processing\x20video...';_0x5bab38[_0x3b0310(0x11c)](_0xf9a1b5,_0x316121['width']/0x2,_0x316121['height']/0x2),_0x5bab38[_0x3b0310(0x188)]=_0x3b0310(0x142),_0x5bab38[_0x3b0310(0x144)]=_0x3b0310(0x1b4),_0x5bab38[_0x3b0310(0x11c)](_0x3b0310(0x12b)+_0x1efdc3[_0x3b0310(0x1d7)]('/')[_0x3b0310(0x141)](),_0x316121[_0x3b0310(0x1d6)]/0x2,_0x316121[_0x3b0310(0x182)]/0x2+0x19),this[_0x3b0310(0x1c2)](_0x1983c6,_0x316121);}}['stopSession'](_0x4e4133){const _0x21724a=a6_0x3b8064,_0x2d57a0=this[_0x21724a(0x116)][_0x21724a(0x122)](_0x4e4133);if(!_0x2d57a0){console[_0x21724a(0x193)](_0x21724a(0x184)+_0x4e4133);return;}console[_0x21724a(0x140)](_0x21724a(0x192)+_0x4e4133+_0x21724a(0x152)+_0x2d57a0['topic']);try{this[_0x21724a(0x1d5)]&&this[_0x21724a(0x1d5)]['readyState']===this[_0x21724a(0x1d5)]['OPEN']&&this[_0x21724a(0x1d5)]['send'](JSON[_0x21724a(0x1c1)]({'op':'webrtc_stop_session','session_id':_0x4e4133})),_0x2d57a0[_0x21724a(0x165)]&&_0x2d57a0['videoTrack'][_0x21724a(0x1bb)](),_0x2d57a0[_0x21724a(0x1b7)]&&_0x2d57a0[_0x21724a(0x1b7)]['close']();}catch(_0x25f99f){console['error'](_0x21724a(0x1c3)+_0x25f99f);}this[_0x21724a(0x173)](_0x4e4133);}[a6_0x3b8064(0x173)](_0x16160f){const _0x43049f=a6_0x3b8064,_0x180477=this[_0x43049f(0x116)][_0x43049f(0x122)](_0x16160f);if(_0x180477){const _0x4a8508=this[_0x43049f(0x18f)][_0x43049f(0x122)](_0x180477[_0x43049f(0x1cb)]);_0x4a8508&&(_0x4a8508['delete'](_0x16160f),_0x4a8508[_0x43049f(0x1b2)]===0x0&&this['topicSessions']['delete'](_0x180477[_0x43049f(0x1cb)])),this[_0x43049f(0x13a)](_0x180477['topic']);}this[_0x43049f(0x116)][_0x43049f(0x1ab)](_0x16160f),console[_0x43049f(0x140)](_0x43049f(0x1d9)+_0x16160f);}[a6_0x3b8064(0x15c)](){const _0x3f40af=a6_0x3b8064;console['log'](_0x3f40af(0x1b6));const _0x1d9871=Array[_0x3f40af(0x1a3)](this[_0x3f40af(0x116)][_0x3f40af(0x16d)]());_0x1d9871[_0x3f40af(0x1ae)](_0x4ad3c7=>this[_0x3f40af(0x185)](_0x4ad3c7));}[a6_0x3b8064(0x1b3)](){const _0x12a805=a6_0x3b8064,_0x409e5f=[];for(const [_0x2d40c,_0x2a4add]of this[_0x12a805(0x116)]){_0x409e5f['push']({'sessionId':_0x2d40c,'topic':_0x2a4add[_0x12a805(0x1cb)],'connectionState':_0x2a4add[_0x12a805(0x1b7)]?.[_0x12a805(0x1b0)]||_0x12a805(0x160),'hasVideoTrack':!!_0x2a4add['videoTrack']});}return _0x409e5f;}[a6_0x3b8064(0x147)](){const _0x56cba2=a6_0x3b8064,_0x597a59=[];for(const [_0x394ea4,_0x2411a6]of this[_0x56cba2(0x197)]){_0x597a59['push']({'topic':_0x394ea4,'frameCount':_0x2411a6[_0x56cba2(0x1be)],'hasVideoSource':!!_0x2411a6[_0x56cba2(0x1b8)],'hasRosSubscriber':!!_0x2411a6['rosSubscriber']});}return _0x597a59;}}module[a6_0x3b8064(0x1d8)]=new ApplianceWebRTCService();