function a6_0x95d9(){const _0x5de228=['[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','sharedVideoSources','length','min','apply',',\x20cleaning\x20up\x20shared\x20resources','24px\x20Arial','setLocalDescription','373MQXQRZ','pop','toLocaleTimeString','from','base64','arc','ðŸ“¹\x20Color','handleOffer','handleMessage','/compressedDepth','parse','[WebRTC\x20Appliance]\x20Topic\x20','1685140ssuSkc','height','wrtc',',\x20converting\x20to\x20base64...','convertRGBAtoI420','fillStyle','readyState','releaseSharedVideoSource','updateCanvasWithImageData','\x20detected\x20as\x20','\x20connection\x20closed,\x20cleaning\x20up','subscribeToROSTopic','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','ðŸ”\x20Depth','\x20initialized\x20successfully','rosSubscriber','fillRect','warn','split','random','constructor','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','msg','\x20sessions\x20remaining)','round','sendFrameToVideoSource','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','/image','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','push','10px\x20monospace','rgba(0,\x20170,\x20255,\x20','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','function','width','center','addIceCandidate','size','/compressed','\x20connection\x20state:\x20','color','now','stopAllSessions','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','framerate','stop','onFrame','beginPath','delete','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','serverUrl','depth','unsubscribe','cleanupSession','onconnectionstatechange','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','textAlign','\x20sessions)','initializeSession','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','iceServers','get','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','data','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','log','max','webrtc','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','subscribe','ðŸ”\x20Processing\x20depth...','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','(((.+)+)+)+$','2157735gNHebJ','stringify','canvas','includes','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','3015369CupteC','startsWith','publish',',\x20trying\x20alternative\x20depth\x20topics','error','stopSession','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','OPEN','\x20bytes','sensor_msgs/Image','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','initialize','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','webrtc_','connected','#1a1a1a','rtcConfig','2262386SEbnXY','depthProcessor','session_id','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','send','../config','video','removeEventListener','3992pRfrmA','webrtc_stop_session','sensor_msgs/msg/Image','createTrack','fillText','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','fill','addTrack','videoSource','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','webrtc_answer','initializing','12998390VdtQQo','/image_raw','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','candidate','videoTrack','search','compressed','16px\x20Arial','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','font','[WebRTC\x20Appliance]\x20Session\x20','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','replace','add','16VJUrlG','onicecandidate','topic','handleIceCandidate','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','#00aaff','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','set','5AbVZlu','type','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','webrtc_init_session','compressed_depth_image_transport/CompressedDepthImage','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','topicSessions','activeSessions','\x20for\x20topic\x20','failed','serverWs','webrtc_ice_candidate','sensor_msgs/CompressedImage','/9j/','getContext','toString','#00ffff','8420658KHOMrm','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','\x20for\x20topic:\x20','rosbridgeWs','sensor_msgs/msg/CompressedImage','setRemoteDescription','./turnCredentialsService','has','Topic:\x20','addEventListener','updateTurnCredentials','frameCount','closed','isDepthTopic','drawLoadingPattern','getIceServers','createAnswer','[WebRTC\x20Appliance]\x20Created\x20answer','message','keys','stun:stun1.l.google.com:19302','#ffffff','connectionState','forEach','rgba(0,\x200,\x200,\x200.7)','peerConnection','getOrCreateSharedVideoSource','protocol'];a6_0x95d9=function(){return _0x5de228;};return a6_0x95d9();}const a6_0x468ff6=a6_0x6bb1;(function(_0x37ef35,_0x4162b2){const _0x5155f9=a6_0x6bb1,_0x7c6682=_0x37ef35();while(!![]){try{const _0x2c1d2f=parseInt(_0x5155f9(0x142))/0x1*(-parseInt(_0x5155f9(0xea))/0x2)+parseInt(_0x5155f9(0xcb))/0x3+parseInt(_0x5155f9(0x7f))/0x4+-parseInt(_0x5155f9(0x10d))/0x5*(-parseInt(_0x5155f9(0x11e))/0x6)+parseInt(_0x5155f9(0xe2))/0x7*(parseInt(_0x5155f9(0x105))/0x8)+-parseInt(_0x5155f9(0xd1))/0x9+-parseInt(_0x5155f9(0xf6))/0xa;if(_0x2c1d2f===_0x4162b2)break;else _0x7c6682['push'](_0x7c6682['shift']());}catch(_0x553213){_0x7c6682['push'](_0x7c6682['shift']());}}}(a6_0x95d9,0xc5fe5));function a6_0x6bb1(_0x26d46b,_0x1e0cbb){const _0x9f9c79=a6_0x95d9();return a6_0x6bb1=function(_0x6c30a5,_0x5c73cb){_0x6c30a5=_0x6c30a5-0x79;let _0x95d915=_0x9f9c79[_0x6c30a5];return _0x95d915;},a6_0x6bb1(_0x26d46b,_0x1e0cbb);}const a6_0x5c73cb=(function(){let _0x548b3d=!![];return function(_0x1ae079,_0x432f74){const _0x3117cc=_0x548b3d?function(){const _0x4aee2c=a6_0x6bb1;if(_0x432f74){const _0x4d610d=_0x432f74[_0x4aee2c(0x13e)](_0x1ae079,arguments);return _0x432f74=null,_0x4d610d;}}:function(){};return _0x548b3d=![],_0x3117cc;};}()),a6_0x6c30a5=a6_0x5c73cb(this,function(){const _0x2ed9c5=a6_0x6bb1;return a6_0x6c30a5[_0x2ed9c5(0x11c)]()[_0x2ed9c5(0xfc)](_0x2ed9c5(0xca))['toString']()[_0x2ed9c5(0x93)](a6_0x6c30a5)[_0x2ed9c5(0xfc)]('(((.+)+)+)+$');});a6_0x6c30a5();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x468ff6(0x81)),sharp=require('sharp'),config=require(a6_0x468ff6(0xe7)),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require(a6_0x468ff6(0x124));class ApplianceWebRTCService{constructor(){const _0x2ca74a=a6_0x468ff6;this[_0x2ca74a(0x114)]=new Map(),this[_0x2ca74a(0x113)]=new Map(),this[_0x2ca74a(0x13b)]=new Map(),this[_0x2ca74a(0x121)]=null,this['serverWs']=null,this[_0x2ca74a(0xe3)]=new DepthImageProcessor(),this[_0x2ca74a(0xe1)]={'iceServers':[{'urls':'stun:stun.l.google.com:19302'},{'urls':_0x2ca74a(0x132)}]};}[a6_0x468ff6(0xdc)](_0x5e6e28,_0x3e8686){const _0xeea534=a6_0x468ff6;this['rosbridgeWs']=_0x5e6e28,this[_0xeea534(0x117)]=_0x3e8686,turnCredentialsService['initialize'](config[_0xeea534(0xb3)]),this['updateTurnCredentials'](),console['log']('[WebRTC\x20Appliance]\x20Service\x20initialized');}async[a6_0x468ff6(0x128)](){const _0x27db97=a6_0x468ff6;try{console['log']('[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...');const _0x5343eb=await turnCredentialsService[_0x27db97(0x12d)]();this['rtcConfig'][_0x27db97(0xbd)]=_0x5343eb,console[_0x27db97(0xc2)](_0x27db97(0x13a));}catch(_0x554c96){console[_0x27db97(0xd5)](_0x27db97(0xe5),_0x554c96),console[_0x27db97(0xc2)](_0x27db97(0xab));}}[a6_0x468ff6(0x7b)](_0x39cdb4){const _0x44014b=a6_0x468ff6;if(!_0x39cdb4['op']||!_0x39cdb4['op']['startsWith'](_0x44014b(0xde)))return![];console[_0x44014b(0xc2)](_0x44014b(0xc1)+_0x39cdb4['op']);switch(_0x39cdb4['op']){case _0x44014b(0x110):this[_0x44014b(0xbb)](_0x39cdb4[_0x44014b(0xe4)],_0x39cdb4[_0x44014b(0x107)]);return!![];case'webrtc_offer':this[_0x44014b(0x7a)](_0x39cdb4[_0x44014b(0xe4)],_0x39cdb4['offer']);return!![];case _0x44014b(0x118):this[_0x44014b(0x108)](_0x39cdb4[_0x44014b(0xe4)],_0x39cdb4[_0x44014b(0xfa)]);return!![];case _0x44014b(0xeb):this[_0x44014b(0xd6)](_0x39cdb4[_0x44014b(0xe4)]);return!![];default:console[_0x44014b(0x90)](_0x44014b(0x94)+_0x39cdb4['op']);return![];}}[a6_0x468ff6(0x138)](_0x4b5278){const _0x1f4792=a6_0x468ff6;if(this['sharedVideoSources'][_0x1f4792(0x125)](_0x4b5278)){const _0xd5b3ee=this[_0x1f4792(0x13b)][_0x1f4792(0xbe)](_0x4b5278);return _0xd5b3ee[_0x1f4792(0x129)]++,console[_0x1f4792(0xc2)](_0x1f4792(0xac)+_0x4b5278+'\x20('+_0xd5b3ee[_0x1f4792(0x129)]+_0x1f4792(0xba)),_0xd5b3ee;}console[_0x1f4792(0xc2)]('[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x4b5278);const {createCanvas:_0x445772}=require(_0x1f4792(0xcd)),_0x475b64=_0x445772(config[_0x1f4792(0xc4)][_0x1f4792(0xe8)][_0x1f4792(0xa2)],config[_0x1f4792(0xc4)]['video'][_0x1f4792(0x80)]),_0xa8684f=_0x475b64[_0x1f4792(0x11b)]('2d');this[_0x1f4792(0x12c)](_0x475b64,_0xa8684f);const {RTCVideoSource:_0xcc875a}=nonstandard,_0x4c269b=new _0xcc875a();let _0x34cec0=0x0;const _0x2d7def=0x3e8/config[_0x1f4792(0xc4)]['video']['framerate'],_0x4a9f77=this[_0x1f4792(0x8a)](_0x4b5278,_0x1df206=>{const _0x2c5e32=_0x1f4792,_0x2bb26d=Date[_0x2c5e32(0xa9)]();_0x2bb26d-_0x34cec0>=_0x2d7def&&(_0x34cec0=_0x2bb26d,this[_0x2c5e32(0x87)](_0x475b64,_0xa8684f,_0x1df206,_0x4b5278,_0x4c269b));}),_0x446741={'videoSource':_0x4c269b,'canvas':_0x475b64,'rosSubscriber':_0x4a9f77,'frameCount':0x1,'topic':_0x4b5278};return this[_0x1f4792(0x13b)][_0x1f4792(0x10c)](_0x4b5278,_0x446741),_0x446741;}[a6_0x468ff6(0x86)](_0x42bdef){const _0x289075=a6_0x468ff6,_0x257b5b=this[_0x289075(0x13b)][_0x289075(0xbe)](_0x42bdef);if(!_0x257b5b)return;_0x257b5b[_0x289075(0x129)]--,console[_0x289075(0xc2)](_0x289075(0x10b)+_0x42bdef+'\x20('+_0x257b5b[_0x289075(0x129)]+_0x289075(0x96)),_0x257b5b[_0x289075(0x129)]<=0x0&&(console[_0x289075(0xc2)](_0x289075(0x11f)+_0x42bdef+_0x289075(0x13f)),_0x257b5b[_0x289075(0xf2)]&&(_0x257b5b['videoSource']=null),_0x257b5b[_0x289075(0x8e)]&&_0x257b5b['rosSubscriber'][_0x289075(0xb5)](),this['sharedVideoSources'][_0x289075(0xb1)](_0x42bdef));}async[a6_0x468ff6(0xbb)](_0x492a85,_0x5f2a2e){const _0x4b9a68=a6_0x468ff6;try{console[_0x4b9a68(0xc2)](_0x4b9a68(0xbf)+_0x492a85+_0x4b9a68(0x115)+_0x5f2a2e);const _0x42ba9d=this['getOrCreateSharedVideoSource'](_0x5f2a2e),_0x5ae3f1=new RTCPeerConnection(this[_0x4b9a68(0xe1)]),_0xce328f=_0x42ba9d[_0x4b9a68(0xf2)][_0x4b9a68(0xed)]({'width':config['webrtc'][_0x4b9a68(0xe8)][_0x4b9a68(0xa2)],'height':config['webrtc'][_0x4b9a68(0xe8)][_0x4b9a68(0x80)],'framerate':config[_0x4b9a68(0xc4)][_0x4b9a68(0xe8)][_0x4b9a68(0xad)]});console[_0x4b9a68(0xc2)](_0x4b9a68(0xb8)+_0x492a85);const {MediaStream:_0x4365e7}=require(_0x4b9a68(0x81)),_0x3e2d9e=new _0x4365e7([_0xce328f]);_0x5ae3f1[_0x4b9a68(0xf1)](_0xce328f,_0x3e2d9e),this[_0x4b9a68(0x98)](_0x42ba9d[_0x4b9a68(0xf2)],_0x42ba9d[_0x4b9a68(0xcd)]),_0x5ae3f1[_0x4b9a68(0x106)]=_0x5a32ea=>{const _0x4d0df9=_0x4b9a68;if(_0x5a32ea[_0x4d0df9(0xfa)]&&this['serverWs'])console[_0x4d0df9(0xc2)](_0x4d0df9(0xdb)+_0x492a85+':',{'type':_0x5a32ea['candidate'][_0x4d0df9(0x10e)],'protocol':_0x5a32ea['candidate'][_0x4d0df9(0x139)],'address':_0x5a32ea[_0x4d0df9(0xfa)]['address'],'port':_0x5a32ea['candidate']['port']}),this['serverWs'][_0x4d0df9(0xe6)](JSON[_0x4d0df9(0xcc)]({'op':_0x4d0df9(0x118),'session_id':_0x492a85,'candidate':_0x5a32ea[_0x4d0df9(0xfa)]}));else!_0x5a32ea['candidate']&&console[_0x4d0df9(0xc2)](_0x4d0df9(0x8b)+_0x492a85);},_0x5ae3f1[_0x4b9a68(0xb7)]=()=>{const _0x14e8ea=_0x4b9a68;console[_0x14e8ea(0xc2)](_0x14e8ea(0x101)+_0x492a85+_0x14e8ea(0xa7)+_0x5ae3f1['connectionState']);if(_0x5ae3f1[_0x14e8ea(0x134)]===_0x14e8ea(0xdf))console['log'](_0x14e8ea(0x101)+_0x492a85+'\x20successfully\x20connected!');else{if(_0x5ae3f1['connectionState']===_0x14e8ea(0x116))console['log'](_0x14e8ea(0x101)+_0x492a85+'\x20connection\x20failed,\x20stopping\x20session'),this[_0x14e8ea(0xd6)](_0x492a85);else _0x5ae3f1[_0x14e8ea(0x134)]===_0x14e8ea(0x12a)&&(console[_0x14e8ea(0xc2)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x492a85+_0x14e8ea(0x89)),this['cleanupSession'](_0x492a85));}},this[_0x4b9a68(0x114)]['set'](_0x492a85,{'peerConnection':_0x5ae3f1,'topic':_0x5f2a2e,'videoTrack':_0xce328f,'mediaStream':_0x3e2d9e,'status':_0x4b9a68(0xf5)}),!this[_0x4b9a68(0x113)][_0x4b9a68(0x125)](_0x5f2a2e)&&this['topicSessions'][_0x4b9a68(0x10c)](_0x5f2a2e,new Set()),this[_0x4b9a68(0x113)][_0x4b9a68(0xbe)](_0x5f2a2e)[_0x4b9a68(0x104)](_0x492a85),console[_0x4b9a68(0xc2)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x492a85+_0x4b9a68(0x8d)),console[_0x4b9a68(0xc2)](_0x4b9a68(0xf3)+_0x5f2a2e+':\x20'+this['topicSessions'][_0x4b9a68(0xbe)](_0x5f2a2e)[_0x4b9a68(0xa5)]);}catch(_0x1121c5){console[_0x4b9a68(0xd5)]('[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20'+_0x492a85+':',_0x1121c5),this[_0x4b9a68(0xd6)](_0x492a85);}}async[a6_0x468ff6(0x7a)](_0x471367,_0x4a922d){const _0x11df61=a6_0x468ff6,_0x1c4313=this[_0x11df61(0x114)]['get'](_0x471367);if(!_0x1c4313){console[_0x11df61(0xd5)](_0x11df61(0x112)+_0x471367);return;}try{console['log'](_0x11df61(0xbc)+_0x471367),await _0x1c4313[_0x11df61(0x137)][_0x11df61(0x123)](new RTCSessionDescription(_0x4a922d)),console[_0x11df61(0xc2)](_0x11df61(0xf9));const _0x5c107f=await _0x1c4313[_0x11df61(0x137)][_0x11df61(0x12e)]();console[_0x11df61(0xc2)](_0x11df61(0x12f)),await _0x1c4313['peerConnection'][_0x11df61(0x141)](_0x5c107f),console['log'](_0x11df61(0xef)),this[_0x11df61(0x117)]&&(this['serverWs'][_0x11df61(0xe6)](JSON['stringify']({'op':_0x11df61(0xf4),'session_id':_0x471367,'answer':_0x5c107f})),console[_0x11df61(0xc2)](_0x11df61(0xc6)+_0x471367));}catch(_0x484c88){console[_0x11df61(0xd5)]('[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20'+_0x471367+':',_0x484c88),this[_0x11df61(0xd6)](_0x471367);}}async[a6_0x468ff6(0x108)](_0x4d27d7,_0x595b78){const _0x1d5e27=a6_0x468ff6,_0x36a6d7=this[_0x1d5e27(0x114)][_0x1d5e27(0xbe)](_0x4d27d7);if(!_0x36a6d7){console[_0x1d5e27(0xd5)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20'+_0x4d27d7);return;}try{await _0x36a6d7[_0x1d5e27(0x137)][_0x1d5e27(0xa4)](new RTCIceCandidate(_0x595b78)),console[_0x1d5e27(0xc2)](_0x1d5e27(0xdd)+_0x4d27d7);}catch(_0x1d2ff0){console[_0x1d5e27(0xd5)](_0x1d5e27(0xff)+_0x4d27d7+':',_0x1d2ff0);}}['subscribeToROSTopic'](_0x40dc2f,_0x4254e3){const _0x4a4432=a6_0x468ff6;if(!this['rosbridgeWs']||this[_0x4a4432(0x121)]['readyState']!==this[_0x4a4432(0x121)][_0x4a4432(0xd8)])return console[_0x4a4432(0xd5)](_0x4a4432(0x102)),null;console[_0x4a4432(0xc2)](_0x4a4432(0xcf)+_0x40dc2f);const _0x1f8414=_0x40dc2f[_0x4a4432(0xce)](_0x4a4432(0xb4)),_0x194925=_0x40dc2f[_0x4a4432(0xce)](_0x4a4432(0xfd))||_0x40dc2f[_0x4a4432(0xce)]('compressedDepth');let _0x5450d7=[];_0x1f8414?_0x194925?_0x5450d7=[_0x4a4432(0x119),_0x4a4432(0x122),_0x4a4432(0x111),_0x4a4432(0xda)]:_0x5450d7=[_0x4a4432(0xda),_0x4a4432(0xec),_0x4a4432(0x119)]:_0x5450d7=[_0x4a4432(0x119),_0x4a4432(0x122),'sensor_msgs/Image'];console[_0x4a4432(0xc2)](_0x4a4432(0x7e)+_0x40dc2f+_0x4a4432(0x88)+(_0x1f8414?_0x4a4432(0xb4):_0x4a4432(0xa8))+'\x20image,\x20trying\x20message\x20types:',_0x5450d7);const _0x583ca8=[];let _0xac6cbb=![];const _0x2012b7=_0x37ae1e=>{return _0xebf504=>{const _0xf36284=a6_0x6bb1;try{const _0x5c0f53=JSON[_0xf36284(0x7d)](_0xebf504['data']);_0x5c0f53['op']==='publish'&&_0x5c0f53[_0xf36284(0x107)]===_0x40dc2f&&_0x5c0f53[_0xf36284(0x95)]&&(!_0xac6cbb&&(console['log'](_0xf36284(0x9c)+_0x40dc2f+'\x20with\x20message\x20type\x20'+_0x37ae1e),_0xac6cbb=!![]),_0x4254e3(_0x5c0f53[_0xf36284(0x95)]));}catch(_0x53c611){console[_0xf36284(0xd5)](_0xf36284(0xc5),_0x53c611);}};};for(const _0x592bc7 of _0x5450d7){const _0x11b8e8={'op':_0x4a4432(0xc7),'topic':_0x40dc2f,'type':_0x592bc7};console[_0x4a4432(0xc2)](_0x4a4432(0xd0)+_0x592bc7),this[_0x4a4432(0x121)]['send'](JSON[_0x4a4432(0xcc)](_0x11b8e8));const _0x259ad3=_0x2012b7(_0x592bc7);this[_0x4a4432(0x121)][_0x4a4432(0x127)](_0x4a4432(0x130),_0x259ad3),_0x583ca8[_0x4a4432(0x9d)]({'handler':_0x259ad3,'type':_0x592bc7});}return _0x1f8414&&_0x194925&&setTimeout(()=>{const _0x5bd72d=_0x4a4432;if(!_0xac6cbb){console[_0x5bd72d(0xc2)](_0x5bd72d(0xd7)+_0x40dc2f+_0x5bd72d(0xd4));const _0x214d93=_0x40dc2f[_0x5bd72d(0x103)](_0x5bd72d(0x7c),'')[_0x5bd72d(0x103)](_0x5bd72d(0xa6),''),_0x2f4f2a=[_0x214d93+_0x5bd72d(0xf7),_0x214d93+_0x5bd72d(0x9b),_0x214d93];for(const _0x803c78 of _0x2f4f2a){console[_0x5bd72d(0xc2)]('[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20'+_0x803c78);const _0x776124={'op':_0x5bd72d(0xc7),'topic':_0x803c78,'type':_0x5bd72d(0xda)};this['rosbridgeWs'][_0x5bd72d(0xe6)](JSON[_0x5bd72d(0xcc)](_0x776124));const _0x1572aa=_0x28eb71=>{const _0x4e9daa=_0x5bd72d;try{const _0x38b84c=JSON['parse'](_0x28eb71[_0x4e9daa(0xc0)]);_0x38b84c['op']===_0x4e9daa(0xd3)&&_0x38b84c['topic']===_0x803c78&&_0x38b84c[_0x4e9daa(0x95)]&&(console[_0x4e9daa(0xc2)](_0x4e9daa(0x9a)+_0x803c78+_0x4e9daa(0x82)),_0x38b84c['msg'][_0x4e9daa(0xc0)]&&!_0x38b84c['msg'][_0x4e9daa(0xc0)][_0x4e9daa(0xd2)](_0x4e9daa(0x11a))&&_0x4254e3(_0x38b84c[_0x4e9daa(0x95)]));}catch(_0x3c2ba9){console['error'](_0x4e9daa(0xa0),_0x3c2ba9);}};this['rosbridgeWs'][_0x5bd72d(0x127)](_0x5bd72d(0x130),_0x1572aa),_0x583ca8[_0x5bd72d(0x9d)]({'handler':_0x1572aa,'type':_0x5bd72d(0xda),'topic':_0x803c78});}}},0xbb8),{'unsubscribe':()=>{const _0x140cac=_0x4a4432;for(const {handler:_0x4922b0,type:_0x3b35ba,topic:_0x64d983}of _0x583ca8){this['rosbridgeWs'][_0x140cac(0xe9)](_0x140cac(0x130),_0x4922b0),this[_0x140cac(0x121)][_0x140cac(0x85)]===this[_0x140cac(0x121)][_0x140cac(0xd8)]&&this[_0x140cac(0x121)]['send'](JSON['stringify']({'op':_0x140cac(0xb5),'topic':_0x64d983||_0x40dc2f}));}}};}[a6_0x468ff6(0x12c)](_0x344afb,_0x4aa1fd){const _0x4abebf=a6_0x468ff6;_0x4aa1fd[_0x4abebf(0x84)]=_0x4abebf(0xe0),_0x4aa1fd[_0x4abebf(0x8f)](0x0,0x0,_0x344afb[_0x4abebf(0xa2)],_0x344afb['height']),_0x4aa1fd['fillStyle']=_0x4abebf(0x10a),_0x4aa1fd[_0x4abebf(0x100)]=_0x4abebf(0x140),_0x4aa1fd['textAlign']='center',_0x4aa1fd[_0x4abebf(0xee)]('ðŸ¤–\x20Robot\x20Camera',_0x344afb[_0x4abebf(0xa2)]/0x2,_0x344afb[_0x4abebf(0x80)]/0x2-0x14),_0x4aa1fd[_0x4abebf(0x84)]='#ffffff',_0x4aa1fd[_0x4abebf(0x100)]='16px\x20Arial',_0x4aa1fd[_0x4abebf(0xee)]('Waiting\x20for\x20ROS\x20image\x20data...',_0x344afb[_0x4abebf(0xa2)]/0x2,_0x344afb[_0x4abebf(0x80)]/0x2+0x14);const _0x5815ac=Date[_0x4abebf(0xa9)]()/0x3e8;for(let _0x4c7a44=0x0;_0x4c7a44<0x3;_0x4c7a44++){const _0x52d4ff=(Math['sin'](_0x5815ac*0x2+_0x4c7a44*0.5)+0x1)/0x2;_0x4aa1fd['fillStyle']=_0x4abebf(0x9f)+_0x52d4ff*0.5+')',_0x4aa1fd[_0x4abebf(0xb0)](),_0x4aa1fd[_0x4abebf(0x147)](_0x344afb[_0x4abebf(0xa2)]/0x2-0x28+_0x4c7a44*0x28,_0x344afb[_0x4abebf(0x80)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x4aa1fd[_0x4abebf(0xf0)]();}}[a6_0x468ff6(0x98)](_0x388f63,_0x176752){const _0x1fa835=a6_0x468ff6;try{if(!_0x388f63||!_0x176752)return;const _0xf11e4a=_0x176752[_0x1fa835(0x11b)]('2d'),_0x1eb197=_0xf11e4a['getImageData'](0x0,0x0,_0x176752[_0x1fa835(0xa2)],_0x176752[_0x1fa835(0x80)]),_0x31e3a5=this[_0x1fa835(0x83)](_0x1eb197[_0x1fa835(0xc0)],_0x176752['width'],_0x176752[_0x1fa835(0x80)]),_0x3ee082={'width':_0x176752['width'],'height':_0x176752[_0x1fa835(0x80)],'data':_0x31e3a5};typeof _0x388f63[_0x1fa835(0xaf)]===_0x1fa835(0xa1)&&_0x388f63['onFrame'](_0x3ee082);}catch(_0x3b2c55){console[_0x1fa835(0xd5)](_0x1fa835(0xb2),_0x3b2c55);}}[a6_0x468ff6(0x83)](_0x3c2c98,_0xf3da88,_0x379b63){const _0x2b76be=a6_0x468ff6,_0x36e72c=_0xf3da88*_0x379b63,_0x2da7f2=_0xf3da88*_0x379b63/0x4,_0x5e3224=new Uint8Array(_0x36e72c+_0x2da7f2*0x2);let _0x536e89=0x0,_0x18e484=_0x36e72c,_0x514f08=_0x36e72c+_0x2da7f2;for(let _0x10c8a7=0x0;_0x10c8a7<_0x379b63;_0x10c8a7++){for(let _0x27fb87=0x0;_0x27fb87<_0xf3da88;_0x27fb87++){const _0x4e4d75=(_0x10c8a7*_0xf3da88+_0x27fb87)*0x4,_0x26edf0=_0x3c2c98[_0x4e4d75],_0x2e47ed=_0x3c2c98[_0x4e4d75+0x1],_0x5d1bb7=_0x3c2c98[_0x4e4d75+0x2],_0x27bf65=Math[_0x2b76be(0x97)](0.299*_0x26edf0+0.587*_0x2e47ed+0.114*_0x5d1bb7);_0x5e3224[_0x536e89++]=_0x27bf65;if(_0x10c8a7%0x2===0x0&&_0x27fb87%0x2===0x0){const _0x37b00f=Math[_0x2b76be(0x97)](-0.169*_0x26edf0-0.331*_0x2e47ed+0.5*_0x5d1bb7+0x80),_0x26904c=Math[_0x2b76be(0x97)](0.5*_0x26edf0-0.419*_0x2e47ed-0.081*_0x5d1bb7+0x80);_0x5e3224[_0x18e484++]=Math[_0x2b76be(0xc3)](0x0,Math[_0x2b76be(0x13d)](0xff,_0x37b00f)),_0x5e3224[_0x514f08++]=Math[_0x2b76be(0xc3)](0x0,Math[_0x2b76be(0x13d)](0xff,_0x26904c));}}}return _0x5e3224;}async['updateCanvasWithImageData'](_0x1f79c1,_0x3b6e79,_0x19b5da,_0x4df1eb,_0x49b900){const _0x4edbe4=a6_0x468ff6;try{if(!_0x19b5da||!_0x19b5da['data'])return;Math[_0x4edbe4(0x92)]()<0.01&&console[_0x4edbe4(0xc2)]('[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20'+_0x4df1eb+',\x20size:\x20'+_0x19b5da[_0x4edbe4(0xc0)][_0x4edbe4(0x13c)]+_0x4edbe4(0xd9));const _0x41b3bb=Buffer[_0x4edbe4(0x145)](_0x19b5da[_0x4edbe4(0xc0)],_0x4edbe4(0x146)),_0xc4ef2c=this['depthProcessor'][_0x4edbe4(0x12b)](_0x4df1eb);let _0x5a6c0e;_0xc4ef2c?_0x5a6c0e=await this['depthProcessor']['processDepthImage'](_0x41b3bb,_0x1f79c1,_0x3b6e79,_0x4df1eb):_0x5a6c0e=await this[_0x4edbe4(0xe3)]['processColorImage'](_0x41b3bb,_0x1f79c1,_0x3b6e79),_0x3b6e79['putImageData'](_0x5a6c0e,0x0,0x0),_0x3b6e79['fillStyle']=_0x4edbe4(0x136),_0x3b6e79[_0x4edbe4(0x8f)](0xa,0xa,0xdc,0x32),_0x3b6e79['fillStyle']=_0xc4ef2c?_0x4edbe4(0x11d):'#00ff00',_0x3b6e79[_0x4edbe4(0x100)]='12px\x20monospace',_0x3b6e79['fillText']((_0xc4ef2c?_0x4edbe4(0x8c):_0x4edbe4(0x79))+':\x20'+new Date()[_0x4edbe4(0x144)](),0xf,0x1c),_0x3b6e79[_0x4edbe4(0x84)]=_0x4edbe4(0x133),_0x3b6e79[_0x4edbe4(0x100)]=_0x4edbe4(0x9e),_0x3b6e79[_0x4edbe4(0xee)](_0x4edbe4(0x126)+_0x4df1eb[_0x4edbe4(0x91)]('/')[_0x4edbe4(0x143)](),0xf,0x2d),this[_0x4edbe4(0x98)](_0x49b900,_0x1f79c1);}catch(_0x557c6a){console[_0x4edbe4(0x90)](_0x4edbe4(0xf8)+_0x4df1eb+':',_0x557c6a[_0x4edbe4(0x130)]);_0x4df1eb['includes'](_0x4edbe4(0xb4))&&Math[_0x4edbe4(0x92)]()<0.1&&console[_0x4edbe4(0x90)](_0x4edbe4(0x109)+_0x4df1eb[_0x4edbe4(0x103)](_0x4edbe4(0x7c),'/image_raw'));_0x3b6e79[_0x4edbe4(0x84)]=_0x4edbe4(0xe0),_0x3b6e79[_0x4edbe4(0x8f)](0x0,0x0,_0x1f79c1[_0x4edbe4(0xa2)],_0x1f79c1[_0x4edbe4(0x80)]),_0x3b6e79['fillStyle']='#888',_0x3b6e79['font']=_0x4edbe4(0xfe),_0x3b6e79[_0x4edbe4(0xb9)]=_0x4edbe4(0xa3);const _0x1818e9=_0x4df1eb[_0x4edbe4(0xce)]('depth')?_0x4edbe4(0xc8):'ðŸ“¹\x20Processing\x20video...';_0x3b6e79[_0x4edbe4(0xee)](_0x1818e9,_0x1f79c1['width']/0x2,_0x1f79c1[_0x4edbe4(0x80)]/0x2),_0x3b6e79[_0x4edbe4(0x84)]='#666',_0x3b6e79[_0x4edbe4(0x100)]='12px\x20Arial',_0x3b6e79[_0x4edbe4(0xee)](_0x4edbe4(0x126)+_0x4df1eb['split']('/')[_0x4edbe4(0x143)](),_0x1f79c1[_0x4edbe4(0xa2)]/0x2,_0x1f79c1['height']/0x2+0x19),this[_0x4edbe4(0x98)](_0x49b900,_0x1f79c1);}}[a6_0x468ff6(0xd6)](_0x23a339){const _0xd2a6b3=a6_0x468ff6,_0x30e896=this[_0xd2a6b3(0x114)]['get'](_0x23a339);if(!_0x30e896){console[_0xd2a6b3(0x90)](_0xd2a6b3(0x99)+_0x23a339);return;}console[_0xd2a6b3(0xc2)](_0xd2a6b3(0xc9)+_0x23a339+_0xd2a6b3(0x120)+_0x30e896['topic']);try{this['serverWs']&&this[_0xd2a6b3(0x117)][_0xd2a6b3(0x85)]===this[_0xd2a6b3(0x117)][_0xd2a6b3(0xd8)]&&this[_0xd2a6b3(0x117)][_0xd2a6b3(0xe6)](JSON[_0xd2a6b3(0xcc)]({'op':_0xd2a6b3(0xeb),'session_id':_0x23a339})),_0x30e896[_0xd2a6b3(0xfb)]&&_0x30e896[_0xd2a6b3(0xfb)][_0xd2a6b3(0xae)](),_0x30e896['peerConnection']&&_0x30e896[_0xd2a6b3(0x137)]['close']();}catch(_0x183177){console[_0xd2a6b3(0xd5)]('[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20'+_0x183177);}this[_0xd2a6b3(0xb6)](_0x23a339);}[a6_0x468ff6(0xb6)](_0x236ccc){const _0x511482=a6_0x468ff6,_0xfbf351=this['activeSessions'][_0x511482(0xbe)](_0x236ccc);if(_0xfbf351){const _0x6335bd=this['topicSessions'][_0x511482(0xbe)](_0xfbf351[_0x511482(0x107)]);_0x6335bd&&(_0x6335bd['delete'](_0x236ccc),_0x6335bd[_0x511482(0xa5)]===0x0&&this[_0x511482(0x113)]['delete'](_0xfbf351[_0x511482(0x107)])),this[_0x511482(0x86)](_0xfbf351[_0x511482(0x107)]);}this[_0x511482(0x114)][_0x511482(0xb1)](_0x236ccc),console['log'](_0x511482(0x10f)+_0x236ccc);}[a6_0x468ff6(0xaa)](){const _0x3bbb01=a6_0x468ff6;console[_0x3bbb01(0xc2)]('[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions');const _0x5d9f99=Array[_0x3bbb01(0x145)](this[_0x3bbb01(0x114)][_0x3bbb01(0x131)]());_0x5d9f99[_0x3bbb01(0x135)](_0x5a8843=>this[_0x3bbb01(0xd6)](_0x5a8843));}['getActiveSessions'](){const _0x19b932=a6_0x468ff6,_0x22fadd=[];for(const [_0x84c895,_0xb91d2]of this[_0x19b932(0x114)]){_0x22fadd[_0x19b932(0x9d)]({'sessionId':_0x84c895,'topic':_0xb91d2[_0x19b932(0x107)],'connectionState':_0xb91d2[_0x19b932(0x137)]?.[_0x19b932(0x134)]||'unknown','hasVideoTrack':!!_0xb91d2[_0x19b932(0xfb)]});}return _0x22fadd;}['getSharedVideoSources'](){const _0x25e514=a6_0x468ff6,_0xa224cd=[];for(const [_0x22dc6e,_0x1c4d49]of this[_0x25e514(0x13b)]){_0xa224cd[_0x25e514(0x9d)]({'topic':_0x22dc6e,'frameCount':_0x1c4d49[_0x25e514(0x129)],'hasVideoSource':!!_0x1c4d49[_0x25e514(0xf2)],'hasRosSubscriber':!!_0x1c4d49[_0x25e514(0x8e)]});}return _0xa224cd;}}module['exports']=new ApplianceWebRTCService();