const a6_0x5a6532=a6_0x626f;(function(_0x27b1ee,_0x497ed6){const _0x266823=a6_0x626f,_0x48ad84=_0x27b1ee();while(!![]){try{const _0x21ce1e=parseInt(_0x266823(0x237))/0x1*(parseInt(_0x266823(0x231))/0x2)+parseInt(_0x266823(0x1ec))/0x3*(-parseInt(_0x266823(0x224))/0x4)+-parseInt(_0x266823(0x2a1))/0x5*(parseInt(_0x266823(0x23f))/0x6)+-parseInt(_0x266823(0x288))/0x7+-parseInt(_0x266823(0x206))/0x8*(-parseInt(_0x266823(0x27c))/0x9)+-parseInt(_0x266823(0x22d))/0xa*(-parseInt(_0x266823(0x1f9))/0xb)+parseInt(_0x266823(0x29c))/0xc;if(_0x21ce1e===_0x497ed6)break;else _0x48ad84['push'](_0x48ad84['shift']());}catch(_0xb7d0f7){_0x48ad84['push'](_0x48ad84['shift']());}}}(a6_0xe24f,0x40207));function a6_0x626f(_0xf2345,_0x540363){const _0x30f258=a6_0xe24f();return a6_0x626f=function(_0x15a7a9,_0x594b3e){_0x15a7a9=_0x15a7a9-0x1e2;let _0xe24f06=_0x30f258[_0x15a7a9];return _0xe24f06;},a6_0x626f(_0xf2345,_0x540363);}const a6_0x594b3e=(function(){let _0x34fe30=!![];return function(_0x2417d0,_0x1d184f){const _0x4b2d9d=_0x34fe30?function(){const _0x30cc3e=a6_0x626f;if(_0x1d184f){const _0x23bc62=_0x1d184f[_0x30cc3e(0x286)](_0x2417d0,arguments);return _0x1d184f=null,_0x23bc62;}}:function(){};return _0x34fe30=![],_0x4b2d9d;};}()),a6_0x15a7a9=a6_0x594b3e(this,function(){const _0x2a9342=a6_0x626f;return a6_0x15a7a9[_0x2a9342(0x226)]()[_0x2a9342(0x263)](_0x2a9342(0x218))[_0x2a9342(0x226)]()[_0x2a9342(0x2a7)](a6_0x15a7a9)[_0x2a9342(0x263)](_0x2a9342(0x218));});a6_0x15a7a9();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x5a6532(0x1e6)),sharp=require(a6_0x5a6532(0x242)),config=require('../config'),DepthImageProcessor=require(a6_0x5a6532(0x285)),turnCredentialsService=require('./turnCredentialsService');function a6_0xe24f(){const _0x59b7a6=['push','readyState','8Kwyyzw','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','#ffffff',',\x20trying\x20alternative\x20depth\x20topics','addEventListener','function','fill','isDepthTopic','sin','parse','/9j/','subscribe','publish','stop','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','#1a1a1a','depthProcessor','rgba(0,\x20170,\x20255,\x20','(((.+)+)+)+$','data','stun:stun1.l.google.com:19302','cleanupSession','drawLoadingPattern','pop','ðŸ”\x20Processing\x20depth...','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','port','onicecandidate','serverUrl','getActiveSessions','285136UxqxAR','\x20detected\x20as\x20','toString','\x20image,\x20trying\x20message\x20types:','random','/compressedDepth','toLocaleTimeString','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','1473170fQjwuv','12px\x20monospace','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','compressed','472LuyKlC','[WebRTC\x20Appliance]\x20Topic\x20','width','/image','set','OPEN','1642VlcSJl','webrtc','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','getContext','handleIceCandidate','candidate','webrtc_ice_candidate','36zXMibK','type','handleMessage','sharp','depth','#666','frameCount','\x20for\x20topic:\x20','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','protocol','processColorImage','topic','includes','ðŸ“¹\x20Processing\x20video...','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','rosbridgeWs','color','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','Topic:\x20','initialize','max','from','stopAllSessions','webrtc_init_session','convertRGBAtoI420','compressed_depth_image_transport/CompressedDepthImage','createAnswer','initializeSession','topicSessions','\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','compressedDepth','rosSubscriber','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','delete','search','session_id','round','getIceServers','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','webrtc_answer','unsubscribe','fillRect','[WebRTC\x20Appliance]\x20Session\x20','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','24px\x20Arial','error','sensor_msgs/Image','min','length','onFrame','message','sensor_msgs/CompressedImage','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','setRemoteDescription','keys','serverWs','16px\x20Arial','send','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','671094upoBET','now','videoSource','getImageData','webrtc_','beginPath','rtcConfig','center','[WebRTC\x20Appliance]\x20Service\x20initialized','./DepthImageProcessor','apply','split','2574327dYLuPb','handleOffer','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','putImageData','[WebRTC\x20Appliance]\x20Created\x20answer','peerConnection','fillStyle','updateCanvasWithImageData','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','get','12px\x20Arial','/image_raw','ðŸ”\x20Depth','connectionState','arc','stringify','ðŸ“¹\x20Color','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','height','#00ffff','2090904JfAVWF','#00aaff','log','startsWith','getSharedVideoSources','131635FsgIIc','stopSession','rgba(0,\x200,\x200,\x200.7)','msg','connected','offer','constructor','addTrack','\x20connection\x20state:\x20','sendFrameToVideoSource','\x20initialized\x20successfully','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','releaseSharedVideoSource','unknown','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','sharedVideoSources','canvas','font',',\x20cleaning\x20up\x20shared\x20resources','video','framerate','activeSessions','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','\x20connection\x20closed,\x20cleaning\x20up','addIceCandidate','\x20successfully\x20connected!','exports','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','textAlign','wrtc','\x20sessions)','webrtc_stop_session','sensor_msgs/msg/CompressedImage','has','/compressed','6omWTbe','fillText','Waiting\x20for\x20ROS\x20image\x20data...','videoTrack','onconnectionstatechange','replace','base64','[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20','getOrCreateSharedVideoSource','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','warn','22SOkqOd','subscribeToROSTopic','setLocalDescription','10px\x20monospace','size','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','#888','\x20with\x20message\x20type\x20','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','updateTurnCredentials','#00ff00'];a6_0xe24f=function(){return _0x59b7a6;};return a6_0xe24f();}class ApplianceWebRTCService{constructor(){const _0xb759e5=a6_0x5a6532;this[_0xb759e5(0x2b6)]=new Map(),this['topicSessions']=new Map(),this[_0xb759e5(0x2b0)]=new Map(),this[_0xb759e5(0x24e)]=null,this['serverWs']=null,this[_0xb759e5(0x216)]=new DepthImageProcessor(),this[_0xb759e5(0x282)]={'iceServers':[{'urls':'stun:stun.l.google.com:19302'},{'urls':_0xb759e5(0x21a)}]};}[a6_0x5a6532(0x252)](_0x3f2b70,_0x5794ec){const _0x2ee61c=a6_0x5a6532;this[_0x2ee61c(0x24e)]=_0x3f2b70,this[_0x2ee61c(0x278)]=_0x5794ec,turnCredentialsService[_0x2ee61c(0x252)](config[_0x2ee61c(0x222)]),this[_0x2ee61c(0x202)](),console[_0x2ee61c(0x29e)](_0x2ee61c(0x284));}async[a6_0x5a6532(0x202)](){const _0x4bff78=a6_0x5a6532;try{console['log'](_0x4bff78(0x25d));const _0x271cfc=await turnCredentialsService[_0x4bff78(0x266)]();this['rtcConfig']['iceServers']=_0x271cfc,console[_0x4bff78(0x29e)](_0x4bff78(0x247));}catch(_0x1280f6){console[_0x4bff78(0x26e)](_0x4bff78(0x299),_0x1280f6),console[_0x4bff78(0x29e)]('[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers');}}[a6_0x5a6532(0x241)](_0x39b259){const _0x48dcce=a6_0x5a6532;if(!_0x39b259['op']||!_0x39b259['op'][_0x48dcce(0x29f)](_0x48dcce(0x280)))return![];console[_0x48dcce(0x29e)](_0x48dcce(0x250)+_0x39b259['op']);switch(_0x39b259['op']){case _0x48dcce(0x256):this[_0x48dcce(0x25a)](_0x39b259[_0x48dcce(0x264)],_0x39b259[_0x48dcce(0x24a)]);return!![];case'webrtc_offer':this[_0x48dcce(0x289)](_0x39b259['session_id'],_0x39b259[_0x48dcce(0x2a6)]);return!![];case'webrtc_ice_candidate':this['handleIceCandidate'](_0x39b259[_0x48dcce(0x264)],_0x39b259[_0x48dcce(0x23d)]);return!![];case'webrtc_stop_session':this['stopSession'](_0x39b259['session_id']);return!![];default:console[_0x48dcce(0x1f8)](_0x48dcce(0x261)+_0x39b259['op']);return![];}}[a6_0x5a6532(0x1f4)](_0x5131fe){const _0x3998bc=a6_0x5a6532;if(this['sharedVideoSources']['has'](_0x5131fe)){const _0x3a76ab=this['sharedVideoSources'][_0x3998bc(0x291)](_0x5131fe);return _0x3a76ab[_0x3998bc(0x245)]++,console[_0x3998bc(0x29e)]('[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x5131fe+'\x20('+_0x3a76ab['frameCount']+_0x3998bc(0x1e7)),_0x3a76ab;}console[_0x3998bc(0x29e)](_0x3998bc(0x201)+_0x5131fe);const {createCanvas:_0x472041}=require('canvas'),_0xd8ead9=_0x472041(config['webrtc'][_0x3998bc(0x2b4)]['width'],config[_0x3998bc(0x238)][_0x3998bc(0x2b4)]['height']),_0x458bbe=_0xd8ead9[_0x3998bc(0x23b)]('2d');this[_0x3998bc(0x21c)](_0xd8ead9,_0x458bbe);const {RTCVideoSource:_0x3dc1bb}=nonstandard,_0x359646=new _0x3dc1bb();let _0x359240=0x0;const _0x5cd991=0x3e8/config[_0x3998bc(0x238)][_0x3998bc(0x2b4)][_0x3998bc(0x2b5)],_0x205063=this[_0x3998bc(0x1fa)](_0x5131fe,_0x3a16fc=>{const _0x13b43e=_0x3998bc,_0x47b79d=Date['now']();_0x47b79d-_0x359240>=_0x5cd991&&(_0x359240=_0x47b79d,this[_0x13b43e(0x28f)](_0xd8ead9,_0x458bbe,_0x3a16fc,_0x5131fe,_0x359646));}),_0x5e69df={'videoSource':_0x359646,'canvas':_0xd8ead9,'rosSubscriber':_0x205063,'frameCount':0x1,'topic':_0x5131fe};return this[_0x3998bc(0x2b0)][_0x3998bc(0x235)](_0x5131fe,_0x5e69df),_0x5e69df;}[a6_0x5a6532(0x2ad)](_0xf18aed){const _0x3b8cb8=a6_0x5a6532,_0x33f4cf=this['sharedVideoSources'][_0x3b8cb8(0x291)](_0xf18aed);if(!_0x33f4cf)return;_0x33f4cf['frameCount']--,console[_0x3b8cb8(0x29e)]('[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20'+_0xf18aed+'\x20('+_0x33f4cf['frameCount']+'\x20sessions\x20remaining)'),_0x33f4cf[_0x3b8cb8(0x245)]<=0x0&&(console[_0x3b8cb8(0x29e)](_0x3b8cb8(0x2af)+_0xf18aed+_0x3b8cb8(0x2b3)),_0x33f4cf['videoSource']&&(_0x33f4cf[_0x3b8cb8(0x27e)]=null),_0x33f4cf[_0x3b8cb8(0x260)]&&_0x33f4cf['rosSubscriber'][_0x3b8cb8(0x269)](),this[_0x3b8cb8(0x2b0)][_0x3b8cb8(0x262)](_0xf18aed));}async[a6_0x5a6532(0x25a)](_0x3705ec,_0x246088){const _0x3f9545=a6_0x5a6532;try{console['log'](_0x3f9545(0x207)+_0x3705ec+_0x3f9545(0x25c)+_0x246088);const _0x381d35=this[_0x3f9545(0x1f4)](_0x246088),_0x4d082d=new RTCPeerConnection(this[_0x3f9545(0x282)]),_0x5c5950=_0x381d35[_0x3f9545(0x27e)]['createTrack']({'width':config[_0x3f9545(0x238)][_0x3f9545(0x2b4)][_0x3f9545(0x233)],'height':config[_0x3f9545(0x238)][_0x3f9545(0x2b4)][_0x3f9545(0x29a)],'framerate':config['webrtc']['video'][_0x3f9545(0x2b5)]});console[_0x3f9545(0x29e)](_0x3f9545(0x1e4)+_0x3705ec);const {MediaStream:_0x296eeb}=require(_0x3f9545(0x1e6)),_0x3cde52=new _0x296eeb([_0x5c5950]);_0x4d082d[_0x3f9545(0x2a8)](_0x5c5950,_0x3cde52),this[_0x3f9545(0x2aa)](_0x381d35[_0x3f9545(0x27e)],_0x381d35[_0x3f9545(0x2b1)]),_0x4d082d[_0x3f9545(0x221)]=_0x452bdb=>{const _0x2c7554=_0x3f9545;if(_0x452bdb['candidate']&&this[_0x2c7554(0x278)])console['log'](_0x2c7554(0x27b)+_0x3705ec+':',{'type':_0x452bdb[_0x2c7554(0x23d)][_0x2c7554(0x240)],'protocol':_0x452bdb['candidate'][_0x2c7554(0x248)],'address':_0x452bdb[_0x2c7554(0x23d)]['address'],'port':_0x452bdb[_0x2c7554(0x23d)][_0x2c7554(0x220)]}),this['serverWs'][_0x2c7554(0x27a)](JSON[_0x2c7554(0x297)]({'op':_0x2c7554(0x23e),'session_id':_0x3705ec,'candidate':_0x452bdb[_0x2c7554(0x23d)]}));else!_0x452bdb[_0x2c7554(0x23d)]&&console[_0x2c7554(0x29e)](_0x2c7554(0x22b)+_0x3705ec);},_0x4d082d[_0x3f9545(0x1f0)]=()=>{const _0x252446=_0x3f9545;console['log']('[WebRTC\x20Appliance]\x20Session\x20'+_0x3705ec+_0x252446(0x2a9)+_0x4d082d['connectionState']);if(_0x4d082d[_0x252446(0x295)]===_0x252446(0x2a5))console['log']('[WebRTC\x20Appliance]\x20Session\x20'+_0x3705ec+_0x252446(0x1e2));else{if(_0x4d082d[_0x252446(0x295)]==='failed')console[_0x252446(0x29e)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x3705ec+'\x20connection\x20failed,\x20stopping\x20session'),this['stopSession'](_0x3705ec);else _0x4d082d[_0x252446(0x295)]==='closed'&&(console[_0x252446(0x29e)](_0x252446(0x26b)+_0x3705ec+_0x252446(0x2b8)),this[_0x252446(0x21b)](_0x3705ec));}},this[_0x3f9545(0x2b6)][_0x3f9545(0x235)](_0x3705ec,{'peerConnection':_0x4d082d,'topic':_0x246088,'videoTrack':_0x5c5950,'mediaStream':_0x3cde52,'status':'initializing'}),!this[_0x3f9545(0x25b)][_0x3f9545(0x1ea)](_0x246088)&&this['topicSessions']['set'](_0x246088,new Set()),this['topicSessions'][_0x3f9545(0x291)](_0x246088)['add'](_0x3705ec),console['log'](_0x3f9545(0x26b)+_0x3705ec+_0x3f9545(0x2ab)),console[_0x3f9545(0x29e)](_0x3f9545(0x22f)+_0x246088+':\x20'+this[_0x3f9545(0x25b)][_0x3f9545(0x291)](_0x246088)[_0x3f9545(0x1fd)]);}catch(_0x18a7bc){console[_0x3f9545(0x26e)](_0x3f9545(0x290)+_0x3705ec+':',_0x18a7bc),this[_0x3f9545(0x2a2)](_0x3705ec);}}async[a6_0x5a6532(0x289)](_0x1adc93,_0x743b1d){const _0x1d5df2=a6_0x5a6532,_0x2b3c26=this[_0x1d5df2(0x2b6)][_0x1d5df2(0x291)](_0x1adc93);if(!_0x2b3c26){console[_0x1d5df2(0x26e)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20'+_0x1adc93);return;}try{console[_0x1d5df2(0x29e)](_0x1d5df2(0x1f7)+_0x1adc93),await _0x2b3c26[_0x1d5df2(0x28d)][_0x1d5df2(0x276)](new RTCSessionDescription(_0x743b1d)),console[_0x1d5df2(0x29e)](_0x1d5df2(0x26c));const _0x59e646=await _0x2b3c26['peerConnection'][_0x1d5df2(0x259)]();console[_0x1d5df2(0x29e)](_0x1d5df2(0x28c)),await _0x2b3c26[_0x1d5df2(0x28d)][_0x1d5df2(0x1fb)](_0x59e646),console[_0x1d5df2(0x29e)]('[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)'),this[_0x1d5df2(0x278)]&&(this[_0x1d5df2(0x278)][_0x1d5df2(0x27a)](JSON[_0x1d5df2(0x297)]({'op':_0x1d5df2(0x268),'session_id':_0x1adc93,'answer':_0x59e646})),console[_0x1d5df2(0x29e)](_0x1d5df2(0x25e)+_0x1adc93));}catch(_0x1a6709){console[_0x1d5df2(0x26e)]('[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20'+_0x1adc93+':',_0x1a6709),this[_0x1d5df2(0x2a2)](_0x1adc93);}}async[a6_0x5a6532(0x23c)](_0xe82a9d,_0x3b064e){const _0x40c6e8=a6_0x5a6532,_0x377286=this[_0x40c6e8(0x2b6)]['get'](_0xe82a9d);if(!_0x377286){console[_0x40c6e8(0x26e)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20'+_0xe82a9d);return;}try{await _0x377286[_0x40c6e8(0x28d)][_0x40c6e8(0x2b9)](new RTCIceCandidate(_0x3b064e)),console['log']('[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20'+_0xe82a9d);}catch(_0xfa5e93){console[_0x40c6e8(0x26e)](_0x40c6e8(0x24d)+_0xe82a9d+':',_0xfa5e93);}}[a6_0x5a6532(0x1fa)](_0x42f06b,_0x584bc1){const _0x20a316=a6_0x5a6532;if(!this[_0x20a316(0x24e)]||this[_0x20a316(0x24e)][_0x20a316(0x205)]!==this['rosbridgeWs']['OPEN'])return console['error'](_0x20a316(0x2b7)),null;console[_0x20a316(0x29e)](_0x20a316(0x21f)+_0x42f06b);const _0x524267=_0x42f06b['includes']('depth'),_0x129f50=_0x42f06b[_0x20a316(0x24b)](_0x20a316(0x230))||_0x42f06b[_0x20a316(0x24b)](_0x20a316(0x25f));let _0x865bff=[];_0x524267?_0x129f50?_0x865bff=[_0x20a316(0x274),'sensor_msgs/msg/CompressedImage',_0x20a316(0x258),'sensor_msgs/Image']:_0x865bff=['sensor_msgs/Image','sensor_msgs/msg/Image',_0x20a316(0x274)]:_0x865bff=[_0x20a316(0x274),_0x20a316(0x1e9),_0x20a316(0x26f)];console[_0x20a316(0x29e)](_0x20a316(0x232)+_0x42f06b+_0x20a316(0x225)+(_0x524267?_0x20a316(0x243):_0x20a316(0x24f))+_0x20a316(0x227),_0x865bff);const _0x593373=[];let _0x1bcaa0=![];const _0x28daa1=_0x4d4b95=>{return _0x3d6eb2=>{const _0x27a0c2=a6_0x626f;try{const _0xc68063=JSON[_0x27a0c2(0x20f)](_0x3d6eb2[_0x27a0c2(0x219)]);_0xc68063['op']===_0x27a0c2(0x212)&&_0xc68063['topic']===_0x42f06b&&_0xc68063[_0x27a0c2(0x2a4)]&&(!_0x1bcaa0&&(console[_0x27a0c2(0x29e)]('[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20'+_0x42f06b+_0x27a0c2(0x200)+_0x4d4b95),_0x1bcaa0=!![]),_0x584bc1(_0xc68063[_0x27a0c2(0x2a4)]));}catch(_0x487b7b){console[_0x27a0c2(0x26e)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x487b7b);}};};for(const _0x4917df of _0x865bff){const _0xc05a84={'op':_0x20a316(0x211),'topic':_0x42f06b,'type':_0x4917df};console[_0x20a316(0x29e)](_0x20a316(0x1f3)+_0x4917df),this[_0x20a316(0x24e)][_0x20a316(0x27a)](JSON[_0x20a316(0x297)](_0xc05a84));const _0x42b0aa=_0x28daa1(_0x4917df);this[_0x20a316(0x24e)]['addEventListener']('message',_0x42b0aa),_0x593373[_0x20a316(0x204)]({'handler':_0x42b0aa,'type':_0x4917df});}return _0x524267&&_0x129f50&&setTimeout(()=>{const _0x34d305=_0x20a316;if(!_0x1bcaa0){console['log'](_0x34d305(0x1fe)+_0x42f06b+_0x34d305(0x209));const _0x1c5168=_0x42f06b['replace'](_0x34d305(0x229),'')[_0x34d305(0x1f1)](_0x34d305(0x1eb),''),_0x191bb2=[_0x1c5168+_0x34d305(0x293),_0x1c5168+_0x34d305(0x234),_0x1c5168];for(const _0x15da23 of _0x191bb2){console[_0x34d305(0x29e)](_0x34d305(0x28a)+_0x15da23);const _0x537d2a={'op':_0x34d305(0x211),'topic':_0x15da23,'type':'sensor_msgs/Image'};this[_0x34d305(0x24e)][_0x34d305(0x27a)](JSON[_0x34d305(0x297)](_0x537d2a));const _0xe6f412=_0x1e35ae=>{const _0x59b7c4=_0x34d305;try{const _0x66c4da=JSON[_0x59b7c4(0x20f)](_0x1e35ae[_0x59b7c4(0x219)]);_0x66c4da['op']===_0x59b7c4(0x212)&&_0x66c4da['topic']===_0x15da23&&_0x66c4da[_0x59b7c4(0x2a4)]&&(console['log'](_0x59b7c4(0x267)+_0x15da23+',\x20converting\x20to\x20base64...'),_0x66c4da[_0x59b7c4(0x2a4)][_0x59b7c4(0x219)]&&!_0x66c4da[_0x59b7c4(0x2a4)][_0x59b7c4(0x219)][_0x59b7c4(0x29f)](_0x59b7c4(0x210))&&_0x584bc1(_0x66c4da[_0x59b7c4(0x2a4)]));}catch(_0x215a4d){console[_0x59b7c4(0x26e)](_0x59b7c4(0x1f6),_0x215a4d);}};this[_0x34d305(0x24e)][_0x34d305(0x20a)]('message',_0xe6f412),_0x593373[_0x34d305(0x204)]({'handler':_0xe6f412,'type':'sensor_msgs/Image','topic':_0x15da23});}}},0xbb8),{'unsubscribe':()=>{const _0x39ee1e=_0x20a316;for(const {handler:_0x39c5f7,type:_0x1ec8a6,topic:_0x2c933c}of _0x593373){this[_0x39ee1e(0x24e)]['removeEventListener'](_0x39ee1e(0x273),_0x39c5f7),this[_0x39ee1e(0x24e)][_0x39ee1e(0x205)]===this[_0x39ee1e(0x24e)][_0x39ee1e(0x236)]&&this['rosbridgeWs'][_0x39ee1e(0x27a)](JSON['stringify']({'op':'unsubscribe','topic':_0x2c933c||_0x42f06b}));}}};}['drawLoadingPattern'](_0x5e8a82,_0x1fbc2e){const _0x29c59c=a6_0x5a6532;_0x1fbc2e[_0x29c59c(0x28e)]=_0x29c59c(0x215),_0x1fbc2e[_0x29c59c(0x26a)](0x0,0x0,_0x5e8a82[_0x29c59c(0x233)],_0x5e8a82[_0x29c59c(0x29a)]),_0x1fbc2e[_0x29c59c(0x28e)]=_0x29c59c(0x29d),_0x1fbc2e[_0x29c59c(0x2b2)]=_0x29c59c(0x26d),_0x1fbc2e[_0x29c59c(0x1e5)]='center',_0x1fbc2e[_0x29c59c(0x1ed)]('ðŸ¤–\x20Robot\x20Camera',_0x5e8a82[_0x29c59c(0x233)]/0x2,_0x5e8a82['height']/0x2-0x14),_0x1fbc2e['fillStyle']=_0x29c59c(0x208),_0x1fbc2e[_0x29c59c(0x2b2)]='16px\x20Arial',_0x1fbc2e[_0x29c59c(0x1ed)](_0x29c59c(0x1ee),_0x5e8a82[_0x29c59c(0x233)]/0x2,_0x5e8a82[_0x29c59c(0x29a)]/0x2+0x14);const _0x34b219=Date[_0x29c59c(0x27d)]()/0x3e8;for(let _0x5ac2a7=0x0;_0x5ac2a7<0x3;_0x5ac2a7++){const _0xe977d5=(Math[_0x29c59c(0x20e)](_0x34b219*0x2+_0x5ac2a7*0.5)+0x1)/0x2;_0x1fbc2e[_0x29c59c(0x28e)]=_0x29c59c(0x217)+_0xe977d5*0.5+')',_0x1fbc2e[_0x29c59c(0x281)](),_0x1fbc2e[_0x29c59c(0x296)](_0x5e8a82['width']/0x2-0x28+_0x5ac2a7*0x28,_0x5e8a82[_0x29c59c(0x29a)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x1fbc2e[_0x29c59c(0x20c)]();}}[a6_0x5a6532(0x2aa)](_0x4866c7,_0x4fe0bf){const _0x4cc83d=a6_0x5a6532;try{if(!_0x4866c7||!_0x4fe0bf)return;const _0x3afd98=_0x4fe0bf['getContext']('2d'),_0x96804e=_0x3afd98[_0x4cc83d(0x27f)](0x0,0x0,_0x4fe0bf[_0x4cc83d(0x233)],_0x4fe0bf[_0x4cc83d(0x29a)]),_0x4077d4=this[_0x4cc83d(0x257)](_0x96804e[_0x4cc83d(0x219)],_0x4fe0bf['width'],_0x4fe0bf['height']),_0x5ef894={'width':_0x4fe0bf['width'],'height':_0x4fe0bf['height'],'data':_0x4077d4};typeof _0x4866c7[_0x4cc83d(0x272)]===_0x4cc83d(0x20b)&&_0x4866c7[_0x4cc83d(0x272)](_0x5ef894);}catch(_0x511d20){console[_0x4cc83d(0x26e)]('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x511d20);}}[a6_0x5a6532(0x257)](_0x3c634d,_0x34acc4,_0x28afd9){const _0x4f4ba1=a6_0x5a6532,_0x505282=_0x34acc4*_0x28afd9,_0x3472ed=_0x34acc4*_0x28afd9/0x4,_0x41e812=new Uint8Array(_0x505282+_0x3472ed*0x2);let _0x5ce5cb=0x0,_0x14dd9b=_0x505282,_0x5b3ae2=_0x505282+_0x3472ed;for(let _0x11d8b0=0x0;_0x11d8b0<_0x28afd9;_0x11d8b0++){for(let _0x61430b=0x0;_0x61430b<_0x34acc4;_0x61430b++){const _0x2eb8e7=(_0x11d8b0*_0x34acc4+_0x61430b)*0x4,_0x1c334e=_0x3c634d[_0x2eb8e7],_0x1e70a9=_0x3c634d[_0x2eb8e7+0x1],_0x10842a=_0x3c634d[_0x2eb8e7+0x2],_0x3234a7=Math[_0x4f4ba1(0x265)](0.299*_0x1c334e+0.587*_0x1e70a9+0.114*_0x10842a);_0x41e812[_0x5ce5cb++]=_0x3234a7;if(_0x11d8b0%0x2===0x0&&_0x61430b%0x2===0x0){const _0x8581eb=Math['round'](-0.169*_0x1c334e-0.331*_0x1e70a9+0.5*_0x10842a+0x80),_0x2afa9f=Math['round'](0.5*_0x1c334e-0.419*_0x1e70a9-0.081*_0x10842a+0x80);_0x41e812[_0x14dd9b++]=Math[_0x4f4ba1(0x253)](0x0,Math[_0x4f4ba1(0x270)](0xff,_0x8581eb)),_0x41e812[_0x5b3ae2++]=Math['max'](0x0,Math[_0x4f4ba1(0x270)](0xff,_0x2afa9f));}}}return _0x41e812;}async[a6_0x5a6532(0x28f)](_0x1dcb6a,_0x19ee9a,_0x144a30,_0xab5d48,_0x10b80b){const _0x200165=a6_0x5a6532;try{if(!_0x144a30||!_0x144a30[_0x200165(0x219)])return;Math[_0x200165(0x228)]()<0.01&&console['log'](_0x200165(0x275)+_0xab5d48+',\x20size:\x20'+_0x144a30[_0x200165(0x219)][_0x200165(0x271)]+'\x20bytes');const _0x2aa40e=Buffer[_0x200165(0x254)](_0x144a30[_0x200165(0x219)],_0x200165(0x1f2)),_0x485409=this[_0x200165(0x216)][_0x200165(0x20d)](_0xab5d48);let _0x39c6b5;_0x485409?_0x39c6b5=await this[_0x200165(0x216)]['processDepthImage'](_0x2aa40e,_0x1dcb6a,_0x19ee9a,_0xab5d48):_0x39c6b5=await this[_0x200165(0x216)][_0x200165(0x249)](_0x2aa40e,_0x1dcb6a,_0x19ee9a),_0x19ee9a[_0x200165(0x28b)](_0x39c6b5,0x0,0x0),_0x19ee9a[_0x200165(0x28e)]=_0x200165(0x2a3),_0x19ee9a[_0x200165(0x26a)](0xa,0xa,0xdc,0x32),_0x19ee9a['fillStyle']=_0x485409?_0x200165(0x29b):_0x200165(0x203),_0x19ee9a['font']=_0x200165(0x22e),_0x19ee9a[_0x200165(0x1ed)]((_0x485409?_0x200165(0x294):_0x200165(0x298))+':\x20'+new Date()[_0x200165(0x22a)](),0xf,0x1c),_0x19ee9a['fillStyle']='#ffffff',_0x19ee9a['font']=_0x200165(0x1fc),_0x19ee9a[_0x200165(0x1ed)](_0x200165(0x251)+_0xab5d48[_0x200165(0x287)]('/')[_0x200165(0x21d)](),0xf,0x2d),this[_0x200165(0x2aa)](_0x10b80b,_0x1dcb6a);}catch(_0xb7d782){console[_0x200165(0x1f8)](_0x200165(0x239)+_0xab5d48+':',_0xb7d782['message']);_0xab5d48[_0x200165(0x24b)](_0x200165(0x243))&&Math['random']()<0.1&&console[_0x200165(0x1f8)]('[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20'+_0xab5d48[_0x200165(0x1f1)](_0x200165(0x229),_0x200165(0x293)));_0x19ee9a[_0x200165(0x28e)]='#1a1a1a',_0x19ee9a['fillRect'](0x0,0x0,_0x1dcb6a[_0x200165(0x233)],_0x1dcb6a[_0x200165(0x29a)]),_0x19ee9a['fillStyle']=_0x200165(0x1ff),_0x19ee9a['font']=_0x200165(0x279),_0x19ee9a[_0x200165(0x1e5)]=_0x200165(0x283);const _0x1ed06a=_0xab5d48[_0x200165(0x24b)](_0x200165(0x243))?_0x200165(0x21e):_0x200165(0x24c);_0x19ee9a[_0x200165(0x1ed)](_0x1ed06a,_0x1dcb6a[_0x200165(0x233)]/0x2,_0x1dcb6a['height']/0x2),_0x19ee9a[_0x200165(0x28e)]=_0x200165(0x244),_0x19ee9a['font']=_0x200165(0x292),_0x19ee9a[_0x200165(0x1ed)](_0x200165(0x251)+_0xab5d48[_0x200165(0x287)]('/')[_0x200165(0x21d)](),_0x1dcb6a['width']/0x2,_0x1dcb6a[_0x200165(0x29a)]/0x2+0x19),this[_0x200165(0x2aa)](_0x10b80b,_0x1dcb6a);}}['stopSession'](_0xc3107e){const _0x45719e=a6_0x5a6532,_0x43928c=this['activeSessions']['get'](_0xc3107e);if(!_0x43928c){console[_0x45719e(0x1f8)](_0x45719e(0x23a)+_0xc3107e);return;}console[_0x45719e(0x29e)](_0x45719e(0x1f5)+_0xc3107e+_0x45719e(0x246)+_0x43928c['topic']);try{this[_0x45719e(0x278)]&&this[_0x45719e(0x278)][_0x45719e(0x205)]===this[_0x45719e(0x278)][_0x45719e(0x236)]&&this[_0x45719e(0x278)]['send'](JSON['stringify']({'op':_0x45719e(0x1e8),'session_id':_0xc3107e})),_0x43928c['videoTrack']&&_0x43928c[_0x45719e(0x1ef)][_0x45719e(0x213)](),_0x43928c['peerConnection']&&_0x43928c['peerConnection']['close']();}catch(_0xe06646){console['error'](_0x45719e(0x214)+_0xe06646);}this[_0x45719e(0x21b)](_0xc3107e);}['cleanupSession'](_0x5342c3){const _0x3cd021=a6_0x5a6532,_0x1743c2=this[_0x3cd021(0x2b6)][_0x3cd021(0x291)](_0x5342c3);if(_0x1743c2){const _0x2449c9=this[_0x3cd021(0x25b)][_0x3cd021(0x291)](_0x1743c2[_0x3cd021(0x24a)]);_0x2449c9&&(_0x2449c9[_0x3cd021(0x262)](_0x5342c3),_0x2449c9[_0x3cd021(0x1fd)]===0x0&&this[_0x3cd021(0x25b)]['delete'](_0x1743c2['topic'])),this[_0x3cd021(0x2ad)](_0x1743c2['topic']);}this[_0x3cd021(0x2b6)][_0x3cd021(0x262)](_0x5342c3),console['log'](_0x3cd021(0x22c)+_0x5342c3);}[a6_0x5a6532(0x255)](){const _0x5dd7d2=a6_0x5a6532;console[_0x5dd7d2(0x29e)](_0x5dd7d2(0x2ac));const _0x1afcd5=Array[_0x5dd7d2(0x254)](this[_0x5dd7d2(0x2b6)][_0x5dd7d2(0x277)]());_0x1afcd5['forEach'](_0x50455b=>this[_0x5dd7d2(0x2a2)](_0x50455b));}[a6_0x5a6532(0x223)](){const _0x43c787=a6_0x5a6532,_0x2590a2=[];for(const [_0xf4aa31,_0x4e552a]of this[_0x43c787(0x2b6)]){_0x2590a2[_0x43c787(0x204)]({'sessionId':_0xf4aa31,'topic':_0x4e552a['topic'],'connectionState':_0x4e552a[_0x43c787(0x28d)]?.[_0x43c787(0x295)]||_0x43c787(0x2ae),'hasVideoTrack':!!_0x4e552a['videoTrack']});}return _0x2590a2;}[a6_0x5a6532(0x2a0)](){const _0x4cb8cc=a6_0x5a6532,_0x5f4b26=[];for(const [_0x250722,_0x3eb93e]of this[_0x4cb8cc(0x2b0)]){_0x5f4b26[_0x4cb8cc(0x204)]({'topic':_0x250722,'frameCount':_0x3eb93e[_0x4cb8cc(0x245)],'hasVideoSource':!!_0x3eb93e[_0x4cb8cc(0x27e)],'hasRosSubscriber':!!_0x3eb93e[_0x4cb8cc(0x260)]});}return _0x5f4b26;}}module[a6_0x5a6532(0x1e3)]=new ApplianceWebRTCService();