const a6_0x2ec171=a6_0x5d18;(function(_0x56190d,_0x2473d8){const _0x10c87d=a6_0x5d18,_0x3f986f=_0x56190d();while(!![]){try{const _0x337fa5=parseInt(_0x10c87d(0x10f))/0x1*(-parseInt(_0x10c87d(0x10c))/0x2)+parseInt(_0x10c87d(0x16f))/0x3+parseInt(_0x10c87d(0x145))/0x4*(-parseInt(_0x10c87d(0x17d))/0x5)+parseInt(_0x10c87d(0x187))/0x6*(parseInt(_0x10c87d(0x109))/0x7)+parseInt(_0x10c87d(0x14c))/0x8+-parseInt(_0x10c87d(0x155))/0x9*(parseInt(_0x10c87d(0xe4))/0xa)+parseInt(_0x10c87d(0x148))/0xb;if(_0x337fa5===_0x2473d8)break;else _0x3f986f['push'](_0x3f986f['shift']());}catch(_0x436b1d){_0x3f986f['push'](_0x3f986f['shift']());}}}(a6_0x1c63,0x6c778));function a6_0x5d18(_0x3407f2,_0x44af9a){const _0x198c2e=a6_0x1c63();return a6_0x5d18=function(_0x589f2b,_0x54b06c){_0x589f2b=_0x589f2b-0xd8;let _0x1c6346=_0x198c2e[_0x589f2b];return _0x1c6346;},a6_0x5d18(_0x3407f2,_0x44af9a);}const a6_0x54b06c=(function(){let _0x2bda0c=!![];return function(_0x2769e0,_0x3c3860){const _0x3fdd7f=_0x2bda0c?function(){const _0x32e0f3=a6_0x5d18;if(_0x3c3860){const _0x58cb25=_0x3c3860[_0x32e0f3(0x119)](_0x2769e0,arguments);return _0x3c3860=null,_0x58cb25;}}:function(){};return _0x2bda0c=![],_0x3fdd7f;};}()),a6_0x589f2b=a6_0x54b06c(this,function(){const _0x50b9f2=a6_0x5d18;return a6_0x589f2b[_0x50b9f2(0x136)]()['search'](_0x50b9f2(0x1a6))[_0x50b9f2(0x136)]()[_0x50b9f2(0x115)](a6_0x589f2b)[_0x50b9f2(0x125)]('(((.+)+)+)+$');});a6_0x589f2b();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x2ec171(0x126)),sharp=require('sharp'),config=require('../config'),DepthImageProcessor=require('./DepthImageProcessor'),turnCredentialsService=require('./turnCredentialsService');class ApplianceWebRTCService{constructor(){const _0x2c3f8e=a6_0x2ec171;this[_0x2c3f8e(0x11f)]=new Map(),this[_0x2c3f8e(0xe0)]=new Map(),this[_0x2c3f8e(0xe1)]=new Map(),this[_0x2c3f8e(0x140)]=null,this[_0x2c3f8e(0xe7)]=null,this[_0x2c3f8e(0x1a7)]=new DepthImageProcessor(),this[_0x2c3f8e(0x14e)]={'iceServers':[{'urls':'stun:stun.l.google.com:19302'},{'urls':_0x2c3f8e(0x131)}]};}[a6_0x2ec171(0xe5)](_0x3b7851,_0x56ed34){const _0x4dbe23=a6_0x2ec171;this['rosbridgeWs']=_0x3b7851,this['serverWs']=_0x56ed34,turnCredentialsService['initialize'](config[_0x4dbe23(0x134)]),this[_0x4dbe23(0x156)](),console[_0x4dbe23(0xe3)](_0x4dbe23(0x169));}async[a6_0x2ec171(0x156)](){const _0x3a6efd=a6_0x2ec171;try{console['log'](_0x3a6efd(0x101));const _0x64fcee=await turnCredentialsService[_0x3a6efd(0x178)]();this['rtcConfig'][_0x3a6efd(0x19c)]=_0x64fcee,console['log'](_0x3a6efd(0xfb));}catch(_0x32ef06){console[_0x3a6efd(0x14b)](_0x3a6efd(0x139),_0x32ef06),console[_0x3a6efd(0xe3)](_0x3a6efd(0x12e));}}[a6_0x2ec171(0x14f)](_0x3b9888){const _0x115447=a6_0x2ec171;if(!_0x3b9888['op']||!_0x3b9888['op'][_0x115447(0xf9)](_0x115447(0x11b)))return![];console['log']('[WebRTC\x20Appliance]\x20Handling\x20message:\x20'+_0x3b9888['op']);switch(_0x3b9888['op']){case _0x115447(0x154):this[_0x115447(0xdd)](_0x3b9888['session_id'],_0x3b9888[_0x115447(0x117)]);return!![];case'webrtc_offer':this['handleOffer'](_0x3b9888[_0x115447(0xeb)],_0x3b9888[_0x115447(0x151)]);return!![];case _0x115447(0x198):this[_0x115447(0x113)](_0x3b9888[_0x115447(0xeb)],_0x3b9888[_0x115447(0x11e)]);return!![];case _0x115447(0xe9):this['stopSession'](_0x3b9888[_0x115447(0xeb)]);return!![];default:console[_0x115447(0xee)]('[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20'+_0x3b9888['op']);return![];}}['getOrCreateSharedVideoSource'](_0x1a085e){const _0x57469d=a6_0x2ec171;if(this[_0x57469d(0xe1)][_0x57469d(0x105)](_0x1a085e)){const _0x406c0a=this['sharedVideoSources'][_0x57469d(0x13b)](_0x1a085e);return _0x406c0a[_0x57469d(0x13e)]++,console[_0x57469d(0xe3)](_0x57469d(0x16c)+_0x1a085e+'\x20('+_0x406c0a['frameCount']+'\x20sessions)'),_0x406c0a;}console[_0x57469d(0xe3)](_0x57469d(0xe6)+_0x1a085e);const {createCanvas:_0x22dece}=require(_0x57469d(0x186)),_0x1f210c=_0x22dece(config['webrtc'][_0x57469d(0x196)][_0x57469d(0x173)],config['webrtc'][_0x57469d(0x196)][_0x57469d(0x17e)]),_0x2b68a6=_0x1f210c[_0x57469d(0x123)]('2d');this[_0x57469d(0x133)](_0x1f210c,_0x2b68a6);const {RTCVideoSource:_0x18d025}=nonstandard,_0x46a1e3=new _0x18d025();let _0x565c76=0x0;const _0xebfddb=0x3e8/config[_0x57469d(0x1a0)][_0x57469d(0x196)][_0x57469d(0xec)],_0x4db24b=this[_0x57469d(0x16a)](_0x1a085e,_0x4cface=>{const _0x5019d8=Date['now']();_0x5019d8-_0x565c76>=_0xebfddb&&(_0x565c76=_0x5019d8,this['updateCanvasWithImageData'](_0x1f210c,_0x2b68a6,_0x4cface,_0x1a085e,_0x46a1e3));}),_0x5510fb={'videoSource':_0x46a1e3,'canvas':_0x1f210c,'rosSubscriber':_0x4db24b,'frameCount':0x1,'topic':_0x1a085e};return this[_0x57469d(0xe1)][_0x57469d(0x12b)](_0x1a085e,_0x5510fb),_0x5510fb;}['releaseSharedVideoSource'](_0x2953b6){const _0x35bd6a=a6_0x2ec171,_0x4855bc=this[_0x35bd6a(0xe1)][_0x35bd6a(0x13b)](_0x2953b6);if(!_0x4855bc)return;_0x4855bc[_0x35bd6a(0x13e)]--,console[_0x35bd6a(0xe3)]('[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x2953b6+'\x20('+_0x4855bc[_0x35bd6a(0x13e)]+_0x35bd6a(0x142)),_0x4855bc[_0x35bd6a(0x13e)]<=0x0&&(console[_0x35bd6a(0xe3)](_0x35bd6a(0x11c)+_0x2953b6+_0x35bd6a(0x110)),_0x4855bc['videoSource']&&(_0x4855bc[_0x35bd6a(0xf7)]=null),_0x4855bc[_0x35bd6a(0x108)]&&_0x4855bc[_0x35bd6a(0x108)]['unsubscribe'](),this[_0x35bd6a(0xe1)][_0x35bd6a(0x19d)](_0x2953b6));}async[a6_0x2ec171(0xdd)](_0x468f95,_0x48a697){const _0x55292a=a6_0x2ec171;try{console[_0x55292a(0xe3)](_0x55292a(0x13c)+_0x468f95+_0x55292a(0x159)+_0x48a697);const _0x5a1ef0=this[_0x55292a(0x17a)](_0x48a697),_0x1bb6f0=new RTCPeerConnection(this[_0x55292a(0x14e)]),_0x3e5670=_0x5a1ef0[_0x55292a(0xf7)][_0x55292a(0x15b)]({'width':config[_0x55292a(0x1a0)][_0x55292a(0x196)][_0x55292a(0x173)],'height':config['webrtc'][_0x55292a(0x196)][_0x55292a(0x17e)],'framerate':config['webrtc'][_0x55292a(0x196)][_0x55292a(0xec)]});console[_0x55292a(0xe3)](_0x55292a(0x104)+_0x468f95);const {MediaStream:_0x573ab1}=require('wrtc'),_0x43641f=new _0x573ab1([_0x3e5670]);_0x1bb6f0[_0x55292a(0x144)](_0x3e5670,_0x43641f),this[_0x55292a(0x171)](_0x5a1ef0[_0x55292a(0xf7)],_0x5a1ef0[_0x55292a(0x186)]),_0x1bb6f0[_0x55292a(0x1a2)]=_0x47137d=>{const _0x55212f=_0x55292a;if(_0x47137d[_0x55212f(0x11e)]&&this[_0x55212f(0xe7)])console['log'](_0x55212f(0xed)+_0x468f95+':',{'type':_0x47137d['candidate'][_0x55212f(0x14d)],'protocol':_0x47137d['candidate'][_0x55212f(0x10b)],'address':_0x47137d[_0x55212f(0x11e)][_0x55212f(0x181)],'port':_0x47137d[_0x55212f(0x11e)][_0x55212f(0x147)]}),this[_0x55212f(0xe7)][_0x55212f(0x13d)](JSON['stringify']({'op':'webrtc_ice_candidate','session_id':_0x468f95,'candidate':_0x47137d[_0x55212f(0x11e)]}));else!_0x47137d[_0x55212f(0x11e)]&&console[_0x55212f(0xe3)](_0x55212f(0x11a)+_0x468f95);},_0x1bb6f0[_0x55292a(0xfc)]=()=>{const _0x5da44e=_0x55292a;console[_0x5da44e(0xe3)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x468f95+_0x5da44e(0x19f)+_0x1bb6f0['connectionState']);if(_0x1bb6f0[_0x5da44e(0x124)]===_0x5da44e(0x11d))console[_0x5da44e(0xe3)](_0x5da44e(0x185)+_0x468f95+'\x20successfully\x20connected!');else{if(_0x1bb6f0[_0x5da44e(0x124)]===_0x5da44e(0x12a))console[_0x5da44e(0xe3)](_0x5da44e(0x185)+_0x468f95+'\x20connection\x20failed,\x20stopping\x20session'),this[_0x5da44e(0x17c)](_0x468f95);else _0x1bb6f0[_0x5da44e(0x124)]===_0x5da44e(0x195)&&(console[_0x5da44e(0xe3)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x468f95+_0x5da44e(0x15e)),this[_0x5da44e(0x12f)](_0x468f95));}},this[_0x55292a(0x11f)][_0x55292a(0x12b)](_0x468f95,{'peerConnection':_0x1bb6f0,'topic':_0x48a697,'videoTrack':_0x3e5670,'mediaStream':_0x43641f,'status':_0x55292a(0x111)}),!this[_0x55292a(0xe0)][_0x55292a(0x105)](_0x48a697)&&this[_0x55292a(0xe0)]['set'](_0x48a697,new Set()),this[_0x55292a(0xe0)][_0x55292a(0x13b)](_0x48a697)[_0x55292a(0x160)](_0x468f95),console[_0x55292a(0xe3)](_0x55292a(0x185)+_0x468f95+_0x55292a(0x14a)),console['log']('[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20'+_0x48a697+':\x20'+this['topicSessions'][_0x55292a(0x13b)](_0x48a697)[_0x55292a(0x13f)]);}catch(_0x5776a3){console[_0x55292a(0x14b)]('[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20'+_0x468f95+':',_0x5776a3),this['stopSession'](_0x468f95);}}async[a6_0x2ec171(0x166)](_0xd91ae5,_0x5f08cc){const _0xb1f951=a6_0x2ec171,_0x1f73ad=this[_0xb1f951(0x11f)][_0xb1f951(0x13b)](_0xd91ae5);if(!_0x1f73ad){console['error']('[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20'+_0xd91ae5);return;}try{console['log'](_0xb1f951(0x15a)+_0xd91ae5),await _0x1f73ad['peerConnection'][_0xb1f951(0x152)](new RTCSessionDescription(_0x5f08cc)),console[_0xb1f951(0xe3)](_0xb1f951(0x138));const _0x1ee927=await _0x1f73ad[_0xb1f951(0xdf)][_0xb1f951(0xef)]();console[_0xb1f951(0xe3)](_0xb1f951(0x18c)),await _0x1f73ad['peerConnection'][_0xb1f951(0x13a)](_0x1ee927),console[_0xb1f951(0xe3)]('[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)'),this[_0xb1f951(0xe7)]&&(this['serverWs'][_0xb1f951(0x13d)](JSON['stringify']({'op':_0xb1f951(0x150),'session_id':_0xd91ae5,'answer':_0x1ee927})),console['log'](_0xb1f951(0x17f)+_0xd91ae5));}catch(_0x4919bb){console[_0xb1f951(0x14b)](_0xb1f951(0x18d)+_0xd91ae5+':',_0x4919bb),this['stopSession'](_0xd91ae5);}}async['handleIceCandidate'](_0x4d7927,_0x402192){const _0x18ed56=a6_0x2ec171,_0x21c3a0=this[_0x18ed56(0x11f)][_0x18ed56(0x13b)](_0x4d7927);if(!_0x21c3a0){console[_0x18ed56(0x14b)]('[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20'+_0x4d7927);return;}try{await _0x21c3a0[_0x18ed56(0xdf)][_0x18ed56(0x116)](new RTCIceCandidate(_0x402192)),console[_0x18ed56(0xe3)](_0x18ed56(0x122)+_0x4d7927);}catch(_0x3b1421){console[_0x18ed56(0x14b)](_0x18ed56(0x192)+_0x4d7927+':',_0x3b1421);}}['subscribeToROSTopic'](_0x385632,_0x46091d){const _0x331dcb=a6_0x2ec171;if(!this['rosbridgeWs']||this[_0x331dcb(0x140)][_0x331dcb(0x18e)]!==this[_0x331dcb(0x140)][_0x331dcb(0xde)])return console[_0x331dcb(0x14b)](_0x331dcb(0x15f)),null;console['log'](_0x331dcb(0x129)+_0x385632);const _0x134628=_0x385632['includes']('depth'),_0x1cb883=_0x385632['includes'](_0x331dcb(0xf4))||_0x385632[_0x331dcb(0x130)](_0x331dcb(0xea));let _0x1851ac=[];_0x134628?_0x1cb883?_0x1851ac=[_0x331dcb(0x167),_0x331dcb(0xfd),_0x331dcb(0x163),'sensor_msgs/Image']:_0x1851ac=[_0x331dcb(0x188),_0x331dcb(0x100),_0x331dcb(0x167)]:_0x1851ac=[_0x331dcb(0x167),_0x331dcb(0xfd),_0x331dcb(0x188)];console[_0x331dcb(0xe3)](_0x331dcb(0x157)+_0x385632+_0x331dcb(0x176)+(_0x134628?_0x331dcb(0x120):_0x331dcb(0xf1))+_0x331dcb(0x143),_0x1851ac);const _0x3cfcac=[];let _0x46a2b5=![];const _0x24391d=_0x26c7e2=>{return _0x2af8a4=>{const _0x5c2dbd=a6_0x5d18;try{const _0xc16712=JSON[_0x5c2dbd(0x180)](_0x2af8a4[_0x5c2dbd(0x189)]);_0xc16712['op']===_0x5c2dbd(0x174)&&_0xc16712[_0x5c2dbd(0x117)]===_0x385632&&_0xc16712['msg']&&(!_0x46a2b5&&(console[_0x5c2dbd(0xe3)](_0x5c2dbd(0x177)+_0x385632+_0x5c2dbd(0x16b)+_0x26c7e2),_0x46a2b5=!![]),_0x46091d(_0xc16712[_0x5c2dbd(0x16e)]));}catch(_0x5b2779){console[_0x5c2dbd(0x14b)](_0x5c2dbd(0x193),_0x5b2779);}};};for(const _0x576033 of _0x1851ac){const _0x2e8341={'op':_0x331dcb(0x10e),'topic':_0x385632,'type':_0x576033};console['log']('[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20'+_0x576033),this[_0x331dcb(0x140)][_0x331dcb(0x13d)](JSON[_0x331dcb(0x137)](_0x2e8341));const _0x5bea19=_0x24391d(_0x576033);this[_0x331dcb(0x140)][_0x331dcb(0x162)](_0x331dcb(0x1a8),_0x5bea19),_0x3cfcac[_0x331dcb(0x197)]({'handler':_0x5bea19,'type':_0x576033});}return _0x134628&&_0x1cb883&&setTimeout(()=>{const _0x19d3ad=_0x331dcb;if(!_0x46a2b5){console[_0x19d3ad(0xe3)](_0x19d3ad(0x18a)+_0x385632+',\x20trying\x20alternative\x20depth\x20topics');const _0x108c6f=_0x385632[_0x19d3ad(0x17b)](_0x19d3ad(0xf8),'')[_0x19d3ad(0x17b)]('/compressed',''),_0x24378a=[_0x108c6f+_0x19d3ad(0x128),_0x108c6f+_0x19d3ad(0x1a1),_0x108c6f];for(const _0xf1696c of _0x24378a){console[_0x19d3ad(0xe3)](_0x19d3ad(0x18f)+_0xf1696c);const _0x38350d={'op':_0x19d3ad(0x10e),'topic':_0xf1696c,'type':'sensor_msgs/Image'};this[_0x19d3ad(0x140)][_0x19d3ad(0x13d)](JSON[_0x19d3ad(0x137)](_0x38350d));const _0x52bd75=_0x4a8ec1=>{const _0x1a7b00=_0x19d3ad;try{const _0x5486e7=JSON[_0x1a7b00(0x180)](_0x4a8ec1[_0x1a7b00(0x189)]);_0x5486e7['op']===_0x1a7b00(0x174)&&_0x5486e7[_0x1a7b00(0x117)]===_0xf1696c&&_0x5486e7[_0x1a7b00(0x16e)]&&(console[_0x1a7b00(0xe3)](_0x1a7b00(0x141)+_0xf1696c+_0x1a7b00(0x132)),_0x5486e7[_0x1a7b00(0x16e)][_0x1a7b00(0x189)]&&!_0x5486e7[_0x1a7b00(0x16e)][_0x1a7b00(0x189)][_0x1a7b00(0xf9)](_0x1a7b00(0x175))&&_0x46091d(_0x5486e7[_0x1a7b00(0x16e)]));}catch(_0x259ac8){console[_0x1a7b00(0x14b)](_0x1a7b00(0xf3),_0x259ac8);}};this['rosbridgeWs'][_0x19d3ad(0x162)](_0x19d3ad(0x1a8),_0x52bd75),_0x3cfcac['push']({'handler':_0x52bd75,'type':_0x19d3ad(0x188),'topic':_0xf1696c});}}},0xbb8),{'unsubscribe':()=>{const _0x224553=_0x331dcb;for(const {handler:_0xf4372c,type:_0x374f9b,topic:_0x193d63}of _0x3cfcac){this[_0x224553(0x140)]['removeEventListener'](_0x224553(0x1a8),_0xf4372c),this[_0x224553(0x140)]['readyState']===this[_0x224553(0x140)][_0x224553(0xde)]&&this[_0x224553(0x140)][_0x224553(0x13d)](JSON[_0x224553(0x137)]({'op':_0x224553(0x172),'topic':_0x193d63||_0x385632}));}}};}[a6_0x2ec171(0x133)](_0x98469e,_0x95293){const _0x4c7e29=a6_0x2ec171;_0x95293[_0x4c7e29(0xff)]=_0x4c7e29(0xdb),_0x95293[_0x4c7e29(0x121)](0x0,0x0,_0x98469e[_0x4c7e29(0x173)],_0x98469e[_0x4c7e29(0x17e)]),_0x95293[_0x4c7e29(0xff)]='#00aaff',_0x95293[_0x4c7e29(0x199)]=_0x4c7e29(0xdc),_0x95293[_0x4c7e29(0x1a9)]=_0x4c7e29(0x146),_0x95293[_0x4c7e29(0x10a)]('ü§ñ\x20Robot\x20Camera',_0x98469e[_0x4c7e29(0x173)]/0x2,_0x98469e[_0x4c7e29(0x17e)]/0x2-0x14),_0x95293[_0x4c7e29(0xff)]=_0x4c7e29(0x118),_0x95293['font']=_0x4c7e29(0x158),_0x95293[_0x4c7e29(0x10a)]('Waiting\x20for\x20ROS\x20image\x20data...',_0x98469e[_0x4c7e29(0x173)]/0x2,_0x98469e[_0x4c7e29(0x17e)]/0x2+0x14);const _0x25701f=Date[_0x4c7e29(0x19b)]()/0x3e8;for(let _0x5145d0=0x0;_0x5145d0<0x3;_0x5145d0++){const _0x3ca08d=(Math[_0x4c7e29(0x102)](_0x25701f*0x2+_0x5145d0*0.5)+0x1)/0x2;_0x95293[_0x4c7e29(0xff)]='rgba(0,\x20170,\x20255,\x20'+_0x3ca08d*0.5+')',_0x95293[_0x4c7e29(0x18b)](),_0x95293[_0x4c7e29(0x191)](_0x98469e['width']/0x2-0x28+_0x5145d0*0x28,_0x98469e[_0x4c7e29(0x17e)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x95293['fill']();}}['sendFrameToVideoSource'](_0x35104f,_0x421f74){const _0x3c6495=a6_0x2ec171;try{if(!_0x35104f||!_0x421f74)return;const _0x298034=_0x421f74[_0x3c6495(0x123)]('2d'),_0x187192=_0x298034[_0x3c6495(0xda)](0x0,0x0,_0x421f74['width'],_0x421f74[_0x3c6495(0x17e)]),_0x29d5e1=this[_0x3c6495(0xe2)](_0x187192[_0x3c6495(0x189)],_0x421f74[_0x3c6495(0x173)],_0x421f74[_0x3c6495(0x17e)]),_0x527448={'width':_0x421f74['width'],'height':_0x421f74[_0x3c6495(0x17e)],'data':_0x29d5e1};typeof _0x35104f[_0x3c6495(0x10d)]==='function'&&_0x35104f[_0x3c6495(0x10d)](_0x527448);}catch(_0x5a379b){console[_0x3c6495(0x14b)]('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x5a379b);}}[a6_0x2ec171(0xe2)](_0x4cf88c,_0x28595c,_0x337b8e){const _0x1f56a9=a6_0x2ec171,_0x3da86c=_0x28595c*_0x337b8e,_0x33c834=_0x28595c*_0x337b8e/0x4,_0x395fd1=new Uint8Array(_0x3da86c+_0x33c834*0x2);let _0x39a2b3=0x0,_0x3bf463=_0x3da86c,_0x1687ba=_0x3da86c+_0x33c834;for(let _0x493e1f=0x0;_0x493e1f<_0x337b8e;_0x493e1f++){for(let _0x4606b6=0x0;_0x4606b6<_0x28595c;_0x4606b6++){const _0x72f122=(_0x493e1f*_0x28595c+_0x4606b6)*0x4,_0x2873ae=_0x4cf88c[_0x72f122],_0x1b6cb3=_0x4cf88c[_0x72f122+0x1],_0x56757d=_0x4cf88c[_0x72f122+0x2],_0x4ade03=Math[_0x1f56a9(0x106)](0.299*_0x2873ae+0.587*_0x1b6cb3+0.114*_0x56757d);_0x395fd1[_0x39a2b3++]=_0x4ade03;if(_0x493e1f%0x2===0x0&&_0x4606b6%0x2===0x0){const _0x3f6f25=Math['round'](-0.169*_0x2873ae-0.331*_0x1b6cb3+0.5*_0x56757d+0x80),_0x232641=Math['round'](0.5*_0x2873ae-0.419*_0x1b6cb3-0.081*_0x56757d+0x80);_0x395fd1[_0x3bf463++]=Math[_0x1f56a9(0x12c)](0x0,Math[_0x1f56a9(0x15d)](0xff,_0x3f6f25)),_0x395fd1[_0x1687ba++]=Math[_0x1f56a9(0x12c)](0x0,Math[_0x1f56a9(0x15d)](0xff,_0x232641));}}}return _0x395fd1;}async[a6_0x2ec171(0xfe)](_0x240831,_0x2bbef5,_0x127364,_0x509ea4,_0x57234a){const _0x322a2b=a6_0x2ec171;try{if(!_0x127364||!_0x127364[_0x322a2b(0x189)])return;Math[_0x322a2b(0x15c)]()<0.01&&console[_0x322a2b(0xe3)](_0x322a2b(0xf0)+_0x509ea4+_0x322a2b(0xfa)+_0x127364[_0x322a2b(0x189)][_0x322a2b(0x107)]+'\x20bytes');const _0x77a959=Buffer[_0x322a2b(0xf5)](_0x127364[_0x322a2b(0x189)],'base64'),_0x1d8ec7=this[_0x322a2b(0x1a7)][_0x322a2b(0x194)](_0x509ea4);let _0x20dd93;_0x1d8ec7?_0x20dd93=await this[_0x322a2b(0x1a7)][_0x322a2b(0x135)](_0x77a959,_0x240831,_0x2bbef5,_0x509ea4):_0x20dd93=await this['depthProcessor'][_0x322a2b(0x164)](_0x77a959,_0x240831,_0x2bbef5),_0x2bbef5[_0x322a2b(0x19a)](_0x20dd93,0x0,0x0),_0x2bbef5[_0x322a2b(0xff)]=_0x322a2b(0xf6),_0x2bbef5[_0x322a2b(0x121)](0xa,0xa,0xdc,0x32),_0x2bbef5[_0x322a2b(0xff)]=_0x1d8ec7?_0x322a2b(0xf2):'#00ff00',_0x2bbef5[_0x322a2b(0x199)]='12px\x20monospace',_0x2bbef5[_0x322a2b(0x10a)]((_0x1d8ec7?_0x322a2b(0x190):_0x322a2b(0x179))+':\x20'+new Date()['toLocaleTimeString'](),0xf,0x1c),_0x2bbef5[_0x322a2b(0xff)]=_0x322a2b(0x118),_0x2bbef5[_0x322a2b(0x199)]='10px\x20monospace',_0x2bbef5[_0x322a2b(0x10a)](_0x322a2b(0x112)+_0x509ea4[_0x322a2b(0x168)]('/')[_0x322a2b(0x161)](),0xf,0x2d),this[_0x322a2b(0x171)](_0x57234a,_0x240831);}catch(_0x4e346f){console['warn'](_0x322a2b(0x1a3)+_0x509ea4+':',_0x4e346f['message']);_0x509ea4['includes']('depth')&&Math[_0x322a2b(0x15c)]()<0.1&&console[_0x322a2b(0xee)](_0x322a2b(0x1a5)+_0x509ea4['replace'](_0x322a2b(0xf8),'/image_raw'));_0x2bbef5[_0x322a2b(0xff)]='#1a1a1a',_0x2bbef5['fillRect'](0x0,0x0,_0x240831[_0x322a2b(0x173)],_0x240831[_0x322a2b(0x17e)]),_0x2bbef5[_0x322a2b(0xff)]=_0x322a2b(0x182),_0x2bbef5[_0x322a2b(0x199)]=_0x322a2b(0x158),_0x2bbef5['textAlign']=_0x322a2b(0x146);const _0x5ef8b3=_0x509ea4['includes'](_0x322a2b(0x120))?_0x322a2b(0x153):_0x322a2b(0x149);_0x2bbef5[_0x322a2b(0x10a)](_0x5ef8b3,_0x240831[_0x322a2b(0x173)]/0x2,_0x240831[_0x322a2b(0x17e)]/0x2),_0x2bbef5[_0x322a2b(0xff)]=_0x322a2b(0xd9),_0x2bbef5[_0x322a2b(0x199)]='12px\x20Arial',_0x2bbef5[_0x322a2b(0x10a)]('Topic:\x20'+_0x509ea4[_0x322a2b(0x168)]('/')[_0x322a2b(0x161)](),_0x240831['width']/0x2,_0x240831[_0x322a2b(0x17e)]/0x2+0x19),this['sendFrameToVideoSource'](_0x57234a,_0x240831);}}['stopSession'](_0x4335d0){const _0x6392e3=a6_0x2ec171,_0x9e8e6c=this[_0x6392e3(0x11f)][_0x6392e3(0x13b)](_0x4335d0);if(!_0x9e8e6c){console[_0x6392e3(0xee)](_0x6392e3(0x1a4)+_0x4335d0);return;}console[_0x6392e3(0xe3)](_0x6392e3(0x1aa)+_0x4335d0+'\x20for\x20topic:\x20'+_0x9e8e6c[_0x6392e3(0x117)]);try{this['serverWs']&&this[_0x6392e3(0xe7)]['readyState']===this[_0x6392e3(0xe7)][_0x6392e3(0xde)]&&this[_0x6392e3(0xe7)]['send'](JSON[_0x6392e3(0x137)]({'op':'webrtc_stop_session','session_id':_0x4335d0})),_0x9e8e6c[_0x6392e3(0x183)]&&_0x9e8e6c[_0x6392e3(0x183)][_0x6392e3(0x12d)](),_0x9e8e6c[_0x6392e3(0xdf)]&&_0x9e8e6c['peerConnection'][_0x6392e3(0x127)]();}catch(_0x59bccd){console[_0x6392e3(0x14b)](_0x6392e3(0x19e)+_0x59bccd);}this[_0x6392e3(0x12f)](_0x4335d0);}['cleanupSession'](_0x5e548){const _0x157a23=a6_0x2ec171,_0x354cb5=this['activeSessions'][_0x157a23(0x13b)](_0x5e548);if(_0x354cb5){const _0x3d5b38=this[_0x157a23(0xe0)][_0x157a23(0x13b)](_0x354cb5[_0x157a23(0x117)]);_0x3d5b38&&(_0x3d5b38[_0x157a23(0x19d)](_0x5e548),_0x3d5b38['size']===0x0&&this[_0x157a23(0xe0)][_0x157a23(0x19d)](_0x354cb5['topic'])),this[_0x157a23(0xe8)](_0x354cb5[_0x157a23(0x117)]);}this[_0x157a23(0x11f)][_0x157a23(0x19d)](_0x5e548),console[_0x157a23(0xe3)](_0x157a23(0xd8)+_0x5e548);}[a6_0x2ec171(0x170)](){const _0x398019=a6_0x2ec171;console[_0x398019(0xe3)]('[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions');const _0x4dd20a=Array[_0x398019(0xf5)](this[_0x398019(0x11f)]['keys']());_0x4dd20a[_0x398019(0x114)](_0x39dd28=>this[_0x398019(0x17c)](_0x39dd28));}[a6_0x2ec171(0x103)](){const _0x4367e4=a6_0x2ec171,_0x1daad8=[];for(const [_0x5c7fb9,_0x198c7b]of this[_0x4367e4(0x11f)]){_0x1daad8['push']({'sessionId':_0x5c7fb9,'topic':_0x198c7b[_0x4367e4(0x117)],'connectionState':_0x198c7b[_0x4367e4(0xdf)]?.[_0x4367e4(0x124)]||_0x4367e4(0x165),'hasVideoTrack':!!_0x198c7b['videoTrack']});}return _0x1daad8;}[a6_0x2ec171(0x16d)](){const _0x5e6aa9=a6_0x2ec171,_0x259ae2=[];for(const [_0x3d104b,_0x32e647]of this[_0x5e6aa9(0xe1)]){_0x259ae2[_0x5e6aa9(0x197)]({'topic':_0x3d104b,'frameCount':_0x32e647[_0x5e6aa9(0x13e)],'hasVideoSource':!!_0x32e647[_0x5e6aa9(0xf7)],'hasRosSubscriber':!!_0x32e647['rosSubscriber']});}return _0x259ae2;}}function a6_0x1c63(){const _0x2b5077=['Topic:\x20','handleIceCandidate','forEach','constructor','addIceCandidate','topic','#ffffff','apply','[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20','webrtc_','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','connected','candidate','activeSessions','depth','fillRect','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','getContext','connectionState','search','wrtc','close','/image_raw','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','failed','set','max','stop','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','cleanupSession','includes','stun:stun1.l.google.com:19302',',\x20converting\x20to\x20base64...','drawLoadingPattern','serverUrl','processDepthImage','toString','stringify','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:','setLocalDescription','get','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','send','frameCount','size','rosbridgeWs','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','\x20sessions\x20remaining)','\x20image,\x20trying\x20message\x20types:','addTrack','60460PVqXhw','center','port','10568536zEADXb','üìπ\x20Processing\x20video...','\x20initialized\x20successfully','error','4607336wElfAa','type','rtcConfig','handleMessage','webrtc_answer','offer','setRemoteDescription','üîç\x20Processing\x20depth...','webrtc_init_session','144rfLabE','updateTurnCredentials','[WebRTC\x20Appliance]\x20Topic\x20','16px\x20Arial','\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','createTrack','random','min','\x20connection\x20closed,\x20cleaning\x20up','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','add','pop','addEventListener','compressed_depth_image_transport/CompressedDepthImage','processColorImage','unknown','handleOffer','sensor_msgs/CompressedImage','split','[WebRTC\x20Appliance]\x20Service\x20initialized','subscribeToROSTopic','\x20with\x20message\x20type\x20','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','getSharedVideoSources','msg','186192kMUcCM','stopAllSessions','sendFrameToVideoSource','unsubscribe','width','publish','/9j/','\x20detected\x20as\x20','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','getIceServers','üìπ\x20Color','getOrCreateSharedVideoSource','replace','stopSession','50PPjLjX','height','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','parse','address','#888','videoTrack','exports','[WebRTC\x20Appliance]\x20Session\x20','canvas','1218dPjvuR','sensor_msgs/Image','data','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','beginPath','[WebRTC\x20Appliance]\x20Created\x20answer','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','readyState','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','üîç\x20Depth','arc','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','isDepthTopic','closed','video','push','webrtc_ice_candidate','font','putImageData','now','iceServers','delete','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','\x20connection\x20state:\x20','webrtc','/image','onicecandidate','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','(((.+)+)+)+$','depthProcessor','message','textAlign','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','#666','getImageData','#1a1a1a','24px\x20Arial','initializeSession','OPEN','peerConnection','topicSessions','sharedVideoSources','convertRGBAtoI420','log','394190zyNojX','initialize','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','serverWs','releaseSharedVideoSource','webrtc_stop_session','compressedDepth','session_id','framerate','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','warn','createAnswer','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','color','#00ffff','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','compressed','from','rgba(0,\x200,\x200,\x200.7)','videoSource','/compressedDepth','startsWith',',\x20size:\x20','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','onconnectionstatechange','sensor_msgs/msg/CompressedImage','updateCanvasWithImageData','fillStyle','sensor_msgs/msg/Image','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','sin','getActiveSessions','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','has','round','length','rosSubscriber','5299MVRWvl','fillText','protocol','4vZKQru','onFrame','subscribe','263147gkpDZx',',\x20cleaning\x20up\x20shared\x20resources','initializing'];a6_0x1c63=function(){return _0x2b5077;};return a6_0x1c63();}module[a6_0x2ec171(0x184)]=new ApplianceWebRTCService();