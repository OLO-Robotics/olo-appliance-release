function a6_0x2d89(_0x328083,_0x179e12){const _0xcc10af=a6_0x45ac();return a6_0x2d89=function(_0x5c1653,_0x5c3ecc){_0x5c1653=_0x5c1653-0x16d;let _0x45acf9=_0xcc10af[_0x5c1653];return _0x45acf9;},a6_0x2d89(_0x328083,_0x179e12);}const a6_0x321cbb=a6_0x2d89;(function(_0x4b9587,_0x18f555){const _0x4d4ac2=a6_0x2d89,_0x54258a=_0x4b9587();while(!![]){try{const _0x9c9f52=parseInt(_0x4d4ac2(0x226))/0x1*(parseInt(_0x4d4ac2(0x1f3))/0x2)+parseInt(_0x4d4ac2(0x22a))/0x3+parseInt(_0x4d4ac2(0x1ff))/0x4+-parseInt(_0x4d4ac2(0x18d))/0x5*(parseInt(_0x4d4ac2(0x16f))/0x6)+-parseInt(_0x4d4ac2(0x221))/0x7+parseInt(_0x4d4ac2(0x232))/0x8*(parseInt(_0x4d4ac2(0x220))/0x9)+-parseInt(_0x4d4ac2(0x237))/0xa*(parseInt(_0x4d4ac2(0x20b))/0xb);if(_0x9c9f52===_0x18f555)break;else _0x54258a['push'](_0x54258a['shift']());}catch(_0x4d4c00){_0x54258a['push'](_0x54258a['shift']());}}}(a6_0x45ac,0xc757a));const a6_0x5c3ecc=(function(){let _0x1b409b=!![];return function(_0x410cee,_0xca5c93){const _0x513fac=_0x1b409b?function(){if(_0xca5c93){const _0x160579=_0xca5c93['apply'](_0x410cee,arguments);return _0xca5c93=null,_0x160579;}}:function(){};return _0x1b409b=![],_0x513fac;};}()),a6_0x5c1653=a6_0x5c3ecc(this,function(){const _0x2374e5=a6_0x2d89;return a6_0x5c1653[_0x2374e5(0x17a)]()['search'](_0x2374e5(0x227))[_0x2374e5(0x17a)]()[_0x2374e5(0x1b2)](a6_0x5c1653)[_0x2374e5(0x188)](_0x2374e5(0x227));});a6_0x5c1653();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x321cbb(0x1c3)),sharp=require('sharp'),config=require('../config'),DepthImageProcessor=require(a6_0x321cbb(0x1e1)),turnCredentialsService=require(a6_0x321cbb(0x17f));class ApplianceWebRTCService{constructor(){const _0x510abe=a6_0x321cbb;this[_0x510abe(0x204)]=new Map(),this[_0x510abe(0x1b5)]=new Map(),this[_0x510abe(0x1ce)]=new Map(),this[_0x510abe(0x1fb)]=null,this[_0x510abe(0x20d)]=null,this[_0x510abe(0x1c4)]=new DepthImageProcessor(),this[_0x510abe(0x1f2)]={'iceServers':[{'urls':'stun:stun.l.google.com:19302'},{'urls':_0x510abe(0x1d5)}]};}[a6_0x321cbb(0x1bb)](_0x8352e4,_0x395f77){const _0x448af7=a6_0x321cbb;this[_0x448af7(0x1fb)]=_0x8352e4,this[_0x448af7(0x20d)]=_0x395f77,turnCredentialsService['initialize'](config[_0x448af7(0x214)]),this[_0x448af7(0x16e)](),console[_0x448af7(0x1b3)]('[WebRTC\x20Appliance]\x20Service\x20initialized');}async[a6_0x321cbb(0x16e)](){const _0x3235b1=a6_0x321cbb;try{console[_0x3235b1(0x1b3)](_0x3235b1(0x190));const _0x18516b=await turnCredentialsService[_0x3235b1(0x181)]();this[_0x3235b1(0x1f2)]['iceServers']=_0x18516b,console[_0x3235b1(0x1b3)](_0x3235b1(0x16d));}catch(_0x5dcb42){console[_0x3235b1(0x1a2)]('[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:',_0x5dcb42),console[_0x3235b1(0x1b3)](_0x3235b1(0x187));}}['handleMessage'](_0x3ea649){const _0x54f5d2=a6_0x321cbb;if(!_0x3ea649['op']||!_0x3ea649['op'][_0x54f5d2(0x236)](_0x54f5d2(0x189)))return![];console[_0x54f5d2(0x1b3)](_0x54f5d2(0x173)+_0x3ea649['op']);switch(_0x3ea649['op']){case'webrtc_init_session':this[_0x54f5d2(0x1a9)](_0x3ea649[_0x54f5d2(0x1ec)],_0x3ea649[_0x54f5d2(0x19d)]);return!![];case _0x54f5d2(0x1ba):this[_0x54f5d2(0x177)](_0x3ea649['session_id'],_0x3ea649['offer']);return!![];case'webrtc_ice_candidate':this[_0x54f5d2(0x1f9)](_0x3ea649[_0x54f5d2(0x1ec)],_0x3ea649[_0x54f5d2(0x212)]);return!![];case _0x54f5d2(0x19f):this[_0x54f5d2(0x1ef)](_0x3ea649[_0x54f5d2(0x1ec)]);return!![];default:console[_0x54f5d2(0x175)](_0x54f5d2(0x1c2)+_0x3ea649['op']);return![];}}[a6_0x321cbb(0x1a8)](_0x243e06){const _0xa437c8=a6_0x321cbb;if(this['sharedVideoSources'][_0xa437c8(0x174)](_0x243e06)){const _0x5c54ee=this['sharedVideoSources'][_0xa437c8(0x170)](_0x243e06);return _0x5c54ee[_0xa437c8(0x225)]++,console[_0xa437c8(0x1b3)](_0xa437c8(0x197)+_0x243e06+'\x20('+_0x5c54ee[_0xa437c8(0x225)]+_0xa437c8(0x1cc)),_0x5c54ee;}console[_0xa437c8(0x1b3)]('[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x243e06);const {createCanvas:_0x40e108}=require(_0xa437c8(0x1c1)),_0x47e14b=_0x40e108(config[_0xa437c8(0x19b)][_0xa437c8(0x213)][_0xa437c8(0x233)],config[_0xa437c8(0x19b)][_0xa437c8(0x213)][_0xa437c8(0x1cb)]),_0x100b9c=_0x47e14b[_0xa437c8(0x1d4)]('2d');this['drawLoadingPattern'](_0x47e14b,_0x100b9c);const {RTCVideoSource:_0x398be7}=nonstandard,_0x669bf0=new _0x398be7();let _0x46876f=0x0;const _0x1507e1=0x3e8/config[_0xa437c8(0x19b)][_0xa437c8(0x213)][_0xa437c8(0x1f5)],_0x5956c1=this[_0xa437c8(0x1f4)](_0x243e06,_0x25cf09=>{const _0x4f74fb=_0xa437c8,_0x6b9e8a=Date[_0x4f74fb(0x217)]();_0x6b9e8a-_0x46876f>=_0x1507e1&&(_0x46876f=_0x6b9e8a,this[_0x4f74fb(0x1e9)](_0x47e14b,_0x100b9c,_0x25cf09,_0x243e06,_0x669bf0));}),_0x3a332a={'videoSource':_0x669bf0,'canvas':_0x47e14b,'rosSubscriber':_0x5956c1,'frameCount':0x1,'topic':_0x243e06};return this['sharedVideoSources'][_0xa437c8(0x21d)](_0x243e06,_0x3a332a),_0x3a332a;}['releaseSharedVideoSource'](_0x47abd2){const _0x2a8db3=a6_0x321cbb,_0x1292fd=this[_0x2a8db3(0x1ce)][_0x2a8db3(0x170)](_0x47abd2);if(!_0x1292fd)return;_0x1292fd['frameCount']--,console[_0x2a8db3(0x1b3)](_0x2a8db3(0x1f6)+_0x47abd2+'\x20('+_0x1292fd[_0x2a8db3(0x225)]+_0x2a8db3(0x1e8)),_0x1292fd['frameCount']<=0x0&&(console[_0x2a8db3(0x1b3)]('[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20'+_0x47abd2+',\x20cleaning\x20up\x20shared\x20resources'),_0x1292fd['videoSource']&&(_0x1292fd[_0x2a8db3(0x1dc)]=null),_0x1292fd['rosSubscriber']&&_0x1292fd[_0x2a8db3(0x1b0)][_0x2a8db3(0x186)](),this[_0x2a8db3(0x1ce)]['delete'](_0x47abd2));}async[a6_0x321cbb(0x1a9)](_0x30cc2e,_0x165f92){const _0x251d83=a6_0x321cbb;try{console[_0x251d83(0x1b3)](_0x251d83(0x20e)+_0x30cc2e+_0x251d83(0x172)+_0x165f92);const _0x2bcf59=this[_0x251d83(0x1a8)](_0x165f92),_0x350ac9=new RTCPeerConnection(this[_0x251d83(0x1f2)]),_0x1d545c=_0x2bcf59[_0x251d83(0x1dc)]['createTrack']({'width':config[_0x251d83(0x19b)][_0x251d83(0x213)]['width'],'height':config['webrtc'][_0x251d83(0x213)]['height'],'framerate':config[_0x251d83(0x19b)][_0x251d83(0x213)]['framerate']});console['log'](_0x251d83(0x22f)+_0x30cc2e);const {MediaStream:_0x50291c}=require(_0x251d83(0x1c3)),_0x4289ba=new _0x50291c([_0x1d545c]);_0x350ac9[_0x251d83(0x1da)](_0x1d545c,_0x4289ba),this[_0x251d83(0x216)](_0x2bcf59[_0x251d83(0x1dc)],_0x2bcf59['canvas']),_0x350ac9[_0x251d83(0x21a)]=_0x13b6c3=>{const _0x45bab0=_0x251d83;if(_0x13b6c3[_0x45bab0(0x212)]&&this[_0x45bab0(0x20d)])console[_0x45bab0(0x1b3)](_0x45bab0(0x1b4)+_0x30cc2e+':',{'type':_0x13b6c3[_0x45bab0(0x212)][_0x45bab0(0x176)],'protocol':_0x13b6c3[_0x45bab0(0x212)][_0x45bab0(0x1e4)],'address':_0x13b6c3[_0x45bab0(0x212)]['address'],'port':_0x13b6c3[_0x45bab0(0x212)][_0x45bab0(0x1fd)]}),this[_0x45bab0(0x20d)]['send'](JSON['stringify']({'op':_0x45bab0(0x194),'session_id':_0x30cc2e,'candidate':_0x13b6c3[_0x45bab0(0x212)]}));else!_0x13b6c3['candidate']&&console[_0x45bab0(0x1b3)]('[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20'+_0x30cc2e);},_0x350ac9[_0x251d83(0x1ac)]=()=>{const _0x46f0c9=_0x251d83;console[_0x46f0c9(0x1b3)]('[WebRTC\x20Appliance]\x20Session\x20'+_0x30cc2e+'\x20connection\x20state:\x20'+_0x350ac9[_0x46f0c9(0x17e)]);if(_0x350ac9[_0x46f0c9(0x17e)]===_0x46f0c9(0x1f1))console['log'](_0x46f0c9(0x1c9)+_0x30cc2e+_0x46f0c9(0x21c));else{if(_0x350ac9['connectionState']===_0x46f0c9(0x203))console[_0x46f0c9(0x1b3)](_0x46f0c9(0x1c9)+_0x30cc2e+'\x20connection\x20failed,\x20stopping\x20session'),this['stopSession'](_0x30cc2e);else _0x350ac9[_0x46f0c9(0x17e)]===_0x46f0c9(0x23b)&&(console[_0x46f0c9(0x1b3)](_0x46f0c9(0x1c9)+_0x30cc2e+_0x46f0c9(0x1af)),this[_0x46f0c9(0x228)](_0x30cc2e));}},this[_0x251d83(0x204)][_0x251d83(0x21d)](_0x30cc2e,{'peerConnection':_0x350ac9,'topic':_0x165f92,'videoTrack':_0x1d545c,'mediaStream':_0x4289ba,'status':_0x251d83(0x19c)}),!this['topicSessions'][_0x251d83(0x174)](_0x165f92)&&this[_0x251d83(0x1b5)][_0x251d83(0x21d)](_0x165f92,new Set()),this['topicSessions'][_0x251d83(0x170)](_0x165f92)[_0x251d83(0x231)](_0x30cc2e),console[_0x251d83(0x1b3)](_0x251d83(0x1c9)+_0x30cc2e+_0x251d83(0x1a0)),console[_0x251d83(0x1b3)](_0x251d83(0x1dd)+_0x165f92+':\x20'+this['topicSessions'][_0x251d83(0x170)](_0x165f92)[_0x251d83(0x1f0)]);}catch(_0x211917){console[_0x251d83(0x1a2)](_0x251d83(0x1cd)+_0x30cc2e+':',_0x211917),this[_0x251d83(0x1ef)](_0x30cc2e);}}async[a6_0x321cbb(0x177)](_0x1fed92,_0x17bb77){const _0xd4d1e7=a6_0x321cbb,_0x42df9d=this[_0xd4d1e7(0x204)][_0xd4d1e7(0x170)](_0x1fed92);if(!_0x42df9d){console[_0xd4d1e7(0x1a2)](_0xd4d1e7(0x1bd)+_0x1fed92);return;}try{console[_0xd4d1e7(0x1b3)](_0xd4d1e7(0x1eb)+_0x1fed92),await _0x42df9d['peerConnection'][_0xd4d1e7(0x1d1)](new RTCSessionDescription(_0x17bb77)),console['log']('[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)');const _0x29cb54=await _0x42df9d[_0xd4d1e7(0x200)][_0xd4d1e7(0x1f7)]();console[_0xd4d1e7(0x1b3)]('[WebRTC\x20Appliance]\x20Created\x20answer'),await _0x42df9d[_0xd4d1e7(0x200)][_0xd4d1e7(0x1b7)](_0x29cb54),console[_0xd4d1e7(0x1b3)](_0xd4d1e7(0x20c)),this[_0xd4d1e7(0x20d)]&&(this[_0xd4d1e7(0x20d)][_0xd4d1e7(0x1be)](JSON[_0xd4d1e7(0x198)]({'op':'webrtc_answer','session_id':_0x1fed92,'answer':_0x29cb54})),console['log'](_0xd4d1e7(0x1d9)+_0x1fed92));}catch(_0x2685e5){console[_0xd4d1e7(0x1a2)](_0xd4d1e7(0x1cf)+_0x1fed92+':',_0x2685e5),this[_0xd4d1e7(0x1ef)](_0x1fed92);}}async[a6_0x321cbb(0x1f9)](_0x51d290,_0x4d2a82){const _0x45a8ad=a6_0x321cbb,_0xe0527c=this[_0x45a8ad(0x204)][_0x45a8ad(0x170)](_0x51d290);if(!_0xe0527c){console[_0x45a8ad(0x1a2)](_0x45a8ad(0x17d)+_0x51d290);return;}try{await _0xe0527c[_0x45a8ad(0x200)]['addIceCandidate'](new RTCIceCandidate(_0x4d2a82)),console[_0x45a8ad(0x1b3)](_0x45a8ad(0x223)+_0x51d290);}catch(_0x2361b5){console[_0x45a8ad(0x1a2)](_0x45a8ad(0x222)+_0x51d290+':',_0x2361b5);}}[a6_0x321cbb(0x1f4)](_0x58cbe8,_0x47dde6){const _0x47b1a9=a6_0x321cbb;if(!this[_0x47b1a9(0x1fb)]||this[_0x47b1a9(0x1fb)][_0x47b1a9(0x1ae)]!==this['rosbridgeWs'][_0x47b1a9(0x184)])return console[_0x47b1a9(0x1a2)](_0x47b1a9(0x22c)),null;console['log'](_0x47b1a9(0x207)+_0x58cbe8);const _0x23689f=_0x58cbe8[_0x47b1a9(0x191)](_0x47b1a9(0x1e2)),_0x66b8f=_0x58cbe8[_0x47b1a9(0x191)](_0x47b1a9(0x23d))||_0x58cbe8['includes'](_0x47b1a9(0x205));let _0x3e586c=[];_0x23689f?_0x66b8f?_0x3e586c=[_0x47b1a9(0x182),_0x47b1a9(0x239),_0x47b1a9(0x19e),_0x47b1a9(0x1d3)]:_0x3e586c=['sensor_msgs/Image',_0x47b1a9(0x199),_0x47b1a9(0x182)]:_0x3e586c=[_0x47b1a9(0x182),'sensor_msgs/msg/CompressedImage','sensor_msgs/Image'];console['log'](_0x47b1a9(0x230)+_0x58cbe8+_0x47b1a9(0x211)+(_0x23689f?_0x47b1a9(0x1e2):_0x47b1a9(0x18a))+_0x47b1a9(0x234),_0x3e586c);const _0x4be25e=[];let _0x34ca21=![];const _0x2fed9d=_0x3af876=>{return _0x33dbe6=>{const _0x4e98f8=a6_0x2d89;try{const _0x3ed612=JSON[_0x4e98f8(0x206)](_0x33dbe6['data']);_0x3ed612['op']===_0x4e98f8(0x193)&&_0x3ed612[_0x4e98f8(0x19d)]===_0x58cbe8&&_0x3ed612['msg']&&(!_0x34ca21&&(console[_0x4e98f8(0x1b3)](_0x4e98f8(0x209)+_0x58cbe8+_0x4e98f8(0x1ed)+_0x3af876),_0x34ca21=!![]),_0x47dde6(_0x3ed612[_0x4e98f8(0x1d7)]));}catch(_0x3df79a){console[_0x4e98f8(0x1a2)]('[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:',_0x3df79a);}};};for(const _0x49d3bc of _0x3e586c){const _0x5ba2ac={'op':_0x47b1a9(0x23a),'topic':_0x58cbe8,'type':_0x49d3bc};console[_0x47b1a9(0x1b3)]('[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20'+_0x49d3bc),this[_0x47b1a9(0x1fb)]['send'](JSON[_0x47b1a9(0x198)](_0x5ba2ac));const _0x28da11=_0x2fed9d(_0x49d3bc);this[_0x47b1a9(0x1fb)]['addEventListener'](_0x47b1a9(0x1e3),_0x28da11),_0x4be25e[_0x47b1a9(0x224)]({'handler':_0x28da11,'type':_0x49d3bc});}return _0x23689f&&_0x66b8f&&setTimeout(()=>{const _0x511bfd=_0x47b1a9;if(!_0x34ca21){console[_0x511bfd(0x1b3)](_0x511bfd(0x23e)+_0x58cbe8+_0x511bfd(0x192));const _0xae562a=_0x58cbe8[_0x511bfd(0x1e0)](_0x511bfd(0x1a4),'')[_0x511bfd(0x1e0)](_0x511bfd(0x1b6),''),_0x58e704=[_0xae562a+'/image_raw',_0xae562a+_0x511bfd(0x1d2),_0xae562a];for(const _0xcb3221 of _0x58e704){console[_0x511bfd(0x1b3)](_0x511bfd(0x210)+_0xcb3221);const _0x33e3f6={'op':_0x511bfd(0x23a),'topic':_0xcb3221,'type':_0x511bfd(0x1d3)};this[_0x511bfd(0x1fb)][_0x511bfd(0x1be)](JSON['stringify'](_0x33e3f6));const _0x3bc39d=_0x599312=>{const _0x2d5c35=_0x511bfd;try{const _0x145804=JSON[_0x2d5c35(0x206)](_0x599312['data']);_0x145804['op']===_0x2d5c35(0x193)&&_0x145804[_0x2d5c35(0x19d)]===_0xcb3221&&_0x145804[_0x2d5c35(0x1d7)]&&(console[_0x2d5c35(0x1b3)]('[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20'+_0xcb3221+_0x2d5c35(0x201)),_0x145804[_0x2d5c35(0x1d7)][_0x2d5c35(0x183)]&&!_0x145804[_0x2d5c35(0x1d7)]['data'][_0x2d5c35(0x236)](_0x2d5c35(0x1d0))&&_0x47dde6(_0x145804[_0x2d5c35(0x1d7)]));}catch(_0x300c57){console[_0x2d5c35(0x1a2)](_0x2d5c35(0x23c),_0x300c57);}};this[_0x511bfd(0x1fb)][_0x511bfd(0x1a3)](_0x511bfd(0x1e3),_0x3bc39d),_0x4be25e[_0x511bfd(0x224)]({'handler':_0x3bc39d,'type':_0x511bfd(0x1d3),'topic':_0xcb3221});}}},0xbb8),{'unsubscribe':()=>{const _0x5c9ffa=_0x47b1a9;for(const {handler:_0x5af1b4,type:_0x1e35f2,topic:_0x246bca}of _0x4be25e){this['rosbridgeWs'][_0x5c9ffa(0x185)](_0x5c9ffa(0x1e3),_0x5af1b4),this[_0x5c9ffa(0x1fb)][_0x5c9ffa(0x1ae)]===this[_0x5c9ffa(0x1fb)][_0x5c9ffa(0x184)]&&this[_0x5c9ffa(0x1fb)][_0x5c9ffa(0x1be)](JSON['stringify']({'op':_0x5c9ffa(0x186),'topic':_0x246bca||_0x58cbe8}));}}};}[a6_0x321cbb(0x1b9)](_0x2c25e5,_0x32f668){const _0x4b1efb=a6_0x321cbb;_0x32f668[_0x4b1efb(0x235)]='#1a1a1a',_0x32f668[_0x4b1efb(0x229)](0x0,0x0,_0x2c25e5[_0x4b1efb(0x233)],_0x2c25e5[_0x4b1efb(0x1cb)]),_0x32f668[_0x4b1efb(0x235)]=_0x4b1efb(0x1a7),_0x32f668[_0x4b1efb(0x1ab)]=_0x4b1efb(0x20f),_0x32f668[_0x4b1efb(0x1ee)]=_0x4b1efb(0x1df),_0x32f668[_0x4b1efb(0x17b)](_0x4b1efb(0x178),_0x2c25e5[_0x4b1efb(0x233)]/0x2,_0x2c25e5[_0x4b1efb(0x1cb)]/0x2-0x14),_0x32f668[_0x4b1efb(0x235)]=_0x4b1efb(0x1c6),_0x32f668[_0x4b1efb(0x1ab)]=_0x4b1efb(0x22b),_0x32f668[_0x4b1efb(0x17b)]('Waiting\x20for\x20ROS\x20image\x20data...',_0x2c25e5[_0x4b1efb(0x233)]/0x2,_0x2c25e5[_0x4b1efb(0x1cb)]/0x2+0x14);const _0x1b50b6=Date['now']()/0x3e8;for(let _0x2a74f1=0x0;_0x2a74f1<0x3;_0x2a74f1++){const _0x12a191=(Math['sin'](_0x1b50b6*0x2+_0x2a74f1*0.5)+0x1)/0x2;_0x32f668['fillStyle']='rgba(0,\x20170,\x20255,\x20'+_0x12a191*0.5+')',_0x32f668['beginPath'](),_0x32f668[_0x4b1efb(0x21f)](_0x2c25e5[_0x4b1efb(0x233)]/0x2-0x28+_0x2a74f1*0x28,_0x2c25e5[_0x4b1efb(0x1cb)]/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x32f668[_0x4b1efb(0x219)]();}}[a6_0x321cbb(0x216)](_0x3ba69c,_0x37889e){const _0x3086ba=a6_0x321cbb;try{if(!_0x3ba69c||!_0x37889e)return;const _0x324470=_0x37889e[_0x3086ba(0x1d4)]('2d'),_0x17c874=_0x324470[_0x3086ba(0x1b1)](0x0,0x0,_0x37889e['width'],_0x37889e[_0x3086ba(0x1cb)]),_0x43b60a=this['convertRGBAtoI420'](_0x17c874[_0x3086ba(0x183)],_0x37889e['width'],_0x37889e[_0x3086ba(0x1cb)]),_0x2aaa7c={'width':_0x37889e[_0x3086ba(0x233)],'height':_0x37889e['height'],'data':_0x43b60a};typeof _0x3ba69c[_0x3086ba(0x1d8)]===_0x3086ba(0x1c8)&&_0x3ba69c[_0x3086ba(0x1d8)](_0x2aaa7c);}catch(_0x167ff7){console[_0x3086ba(0x1a2)]('[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:',_0x167ff7);}}[a6_0x321cbb(0x215)](_0x5af2c0,_0x338121,_0x502598){const _0x293973=a6_0x321cbb,_0x5ed550=_0x338121*_0x502598,_0x1d6426=_0x338121*_0x502598/0x4,_0xfb420e=new Uint8Array(_0x5ed550+_0x1d6426*0x2);let _0x2438a3=0x0,_0x33f17c=_0x5ed550,_0x92aee8=_0x5ed550+_0x1d6426;for(let _0x4dbf85=0x0;_0x4dbf85<_0x502598;_0x4dbf85++){for(let _0x1e8433=0x0;_0x1e8433<_0x338121;_0x1e8433++){const _0x1d232e=(_0x4dbf85*_0x338121+_0x1e8433)*0x4,_0x2e536f=_0x5af2c0[_0x1d232e],_0x44fea5=_0x5af2c0[_0x1d232e+0x1],_0x5855cc=_0x5af2c0[_0x1d232e+0x2],_0x39642c=Math['round'](0.299*_0x2e536f+0.587*_0x44fea5+0.114*_0x5855cc);_0xfb420e[_0x2438a3++]=_0x39642c;if(_0x4dbf85%0x2===0x0&&_0x1e8433%0x2===0x0){const _0x41fcfe=Math[_0x293973(0x1e5)](-0.169*_0x2e536f-0.331*_0x44fea5+0.5*_0x5855cc+0x80),_0x3fc432=Math[_0x293973(0x1e5)](0.5*_0x2e536f-0.419*_0x44fea5-0.081*_0x5855cc+0x80);_0xfb420e[_0x33f17c++]=Math[_0x293973(0x1a6)](0x0,Math['min'](0xff,_0x41fcfe)),_0xfb420e[_0x92aee8++]=Math[_0x293973(0x1a6)](0x0,Math[_0x293973(0x22e)](0xff,_0x3fc432));}}}return _0xfb420e;}async[a6_0x321cbb(0x1e9)](_0x37d644,_0x12c132,_0x423f6,_0x20ab79,_0x32919f){const _0xd1c981=a6_0x321cbb;try{if(!_0x423f6||!_0x423f6['data'])return;Math[_0xd1c981(0x1b8)]()<0.01&&console[_0xd1c981(0x1b3)](_0xd1c981(0x1e6)+_0x20ab79+',\x20size:\x20'+_0x423f6[_0xd1c981(0x183)][_0xd1c981(0x196)]+_0xd1c981(0x1ad));const _0x445117=Buffer[_0xd1c981(0x1ca)](_0x423f6['data'],_0xd1c981(0x1fc)),_0x569b62=this[_0xd1c981(0x1c4)][_0xd1c981(0x208)](_0x20ab79);let _0x367b2d;_0x569b62?_0x367b2d=await this[_0xd1c981(0x1c4)][_0xd1c981(0x1a1)](_0x445117,_0x37d644,_0x12c132,_0x20ab79):_0x367b2d=await this[_0xd1c981(0x1c4)][_0xd1c981(0x18f)](_0x445117,_0x37d644,_0x12c132),_0x12c132[_0xd1c981(0x1aa)](_0x367b2d,0x0,0x0),_0x12c132[_0xd1c981(0x235)]=_0xd1c981(0x1c7),_0x12c132[_0xd1c981(0x229)](0xa,0xa,0xdc,0x32),_0x12c132[_0xd1c981(0x235)]=_0x569b62?'#00ffff':_0xd1c981(0x195),_0x12c132[_0xd1c981(0x1ab)]=_0xd1c981(0x22d),_0x12c132[_0xd1c981(0x17b)]((_0x569b62?'ðŸ”\x20Depth':_0xd1c981(0x20a))+':\x20'+new Date()[_0xd1c981(0x1bf)](),0xf,0x1c),_0x12c132[_0xd1c981(0x235)]=_0xd1c981(0x1c6),_0x12c132[_0xd1c981(0x1ab)]='10px\x20monospace',_0x12c132[_0xd1c981(0x17b)](_0xd1c981(0x1d6)+_0x20ab79[_0xd1c981(0x179)]('/')[_0xd1c981(0x180)](),0xf,0x2d),this[_0xd1c981(0x216)](_0x32919f,_0x37d644);}catch(_0x303f53){console['warn']('[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20'+_0x20ab79+':',_0x303f53[_0xd1c981(0x1e3)]);_0x20ab79[_0xd1c981(0x191)]('depth')&&Math[_0xd1c981(0x1b8)]()<0.1&&console[_0xd1c981(0x175)](_0xd1c981(0x18e)+_0x20ab79[_0xd1c981(0x1e0)](_0xd1c981(0x1a4),_0xd1c981(0x1c0)));_0x12c132[_0xd1c981(0x235)]='#1a1a1a',_0x12c132['fillRect'](0x0,0x0,_0x37d644[_0xd1c981(0x233)],_0x37d644[_0xd1c981(0x1cb)]),_0x12c132[_0xd1c981(0x235)]=_0xd1c981(0x1ea),_0x12c132[_0xd1c981(0x1ab)]='16px\x20Arial',_0x12c132[_0xd1c981(0x1ee)]=_0xd1c981(0x1df);const _0x369307=_0x20ab79[_0xd1c981(0x191)](_0xd1c981(0x1e2))?'ðŸ”\x20Processing\x20depth...':_0xd1c981(0x1fa);_0x12c132['fillText'](_0x369307,_0x37d644[_0xd1c981(0x233)]/0x2,_0x37d644['height']/0x2),_0x12c132[_0xd1c981(0x235)]='#666',_0x12c132[_0xd1c981(0x1ab)]=_0xd1c981(0x18c),_0x12c132['fillText'](_0xd1c981(0x1d6)+_0x20ab79[_0xd1c981(0x179)]('/')[_0xd1c981(0x180)](),_0x37d644['width']/0x2,_0x37d644[_0xd1c981(0x1cb)]/0x2+0x19),this['sendFrameToVideoSource'](_0x32919f,_0x37d644);}}[a6_0x321cbb(0x1ef)](_0x5f1e46){const _0x231120=a6_0x321cbb,_0x558cbd=this[_0x231120(0x204)]['get'](_0x5f1e46);if(!_0x558cbd){console['warn'](_0x231120(0x1c5)+_0x5f1e46);return;}console[_0x231120(0x1b3)](_0x231120(0x1f8)+_0x5f1e46+_0x231120(0x202)+_0x558cbd['topic']);try{this[_0x231120(0x20d)]&&this[_0x231120(0x20d)][_0x231120(0x1ae)]===this['serverWs'][_0x231120(0x184)]&&this[_0x231120(0x20d)][_0x231120(0x1be)](JSON[_0x231120(0x198)]({'op':_0x231120(0x19f),'session_id':_0x5f1e46})),_0x558cbd[_0x231120(0x1fe)]&&_0x558cbd[_0x231120(0x1fe)][_0x231120(0x17c)](),_0x558cbd['peerConnection']&&_0x558cbd['peerConnection'][_0x231120(0x18b)]();}catch(_0x2cc9ae){console['error'](_0x231120(0x1bc)+_0x2cc9ae);}this['cleanupSession'](_0x5f1e46);}['cleanupSession'](_0x284295){const _0x17488d=a6_0x321cbb,_0x59d225=this[_0x17488d(0x204)]['get'](_0x284295);if(_0x59d225){const _0x1906e3=this[_0x17488d(0x1b5)][_0x17488d(0x170)](_0x59d225['topic']);_0x1906e3&&(_0x1906e3[_0x17488d(0x238)](_0x284295),_0x1906e3[_0x17488d(0x1f0)]===0x0&&this['topicSessions']['delete'](_0x59d225[_0x17488d(0x19d)])),this[_0x17488d(0x21e)](_0x59d225['topic']);}this['activeSessions'][_0x17488d(0x238)](_0x284295),console[_0x17488d(0x1b3)]('[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20'+_0x284295);}[a6_0x321cbb(0x1db)](){const _0x435671=a6_0x321cbb;console[_0x435671(0x1b3)](_0x435671(0x171));const _0x3bfcf7=Array[_0x435671(0x1ca)](this[_0x435671(0x204)][_0x435671(0x1a5)]());_0x3bfcf7[_0x435671(0x1de)](_0x2aaf01=>this[_0x435671(0x1ef)](_0x2aaf01));}[a6_0x321cbb(0x218)](){const _0x31d51d=a6_0x321cbb,_0x10216d=[];for(const [_0x2411a9,_0x1a8421]of this[_0x31d51d(0x204)]){_0x10216d[_0x31d51d(0x224)]({'sessionId':_0x2411a9,'topic':_0x1a8421[_0x31d51d(0x19d)],'connectionState':_0x1a8421['peerConnection']?.[_0x31d51d(0x17e)]||_0x31d51d(0x1e7),'hasVideoTrack':!!_0x1a8421['videoTrack']});}return _0x10216d;}[a6_0x321cbb(0x19a)](){const _0x553bd7=a6_0x321cbb,_0x4da83d=[];for(const [_0x408e62,_0x43c981]of this[_0x553bd7(0x1ce)]){_0x4da83d[_0x553bd7(0x224)]({'topic':_0x408e62,'frameCount':_0x43c981['frameCount'],'hasVideoSource':!!_0x43c981[_0x553bd7(0x1dc)],'hasRosSubscriber':!!_0x43c981[_0x553bd7(0x1b0)]});}return _0x4da83d;}}module[a6_0x321cbb(0x21b)]=new ApplianceWebRTCService();function a6_0x45ac(){const _0xeb4186=['onFrame','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','addTrack','stopAllSessions','videoSource','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','forEach','center','replace','./DepthImageProcessor','depth','message','protocol','round','[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20','unknown','\x20sessions\x20remaining)','updateCanvasWithImageData','#888','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','session_id','\x20with\x20message\x20type\x20','textAlign','stopSession','size','connected','rtcConfig','2nmnAPY','subscribeToROSTopic','framerate','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','createAnswer','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','handleIceCandidate','ðŸ“¹\x20Processing\x20video...','rosbridgeWs','base64','port','videoTrack','2082236AlkRgN','peerConnection',',\x20converting\x20to\x20base64...','\x20for\x20topic:\x20','failed','activeSessions','compressedDepth','parse','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','isDepthTopic','[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20','ðŸ“¹\x20Color','706519mBCyvF','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','serverWs','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','24px\x20Arial','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','\x20detected\x20as\x20','candidate','video','serverUrl','convertRGBAtoI420','sendFrameToVideoSource','now','getActiveSessions','fill','onicecandidate','exports','\x20successfully\x20connected!','set','releaseSharedVideoSource','arc','5150709wOMHXf','3821342tgSpvT','[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20','[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20','push','frameCount','854395AvOsyz','(((.+)+)+)+$','cleanupSession','fillRect','4532937EkoytN','16px\x20Arial','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','12px\x20monospace','min','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','[WebRTC\x20Appliance]\x20Topic\x20','add','8fQbdlQ','width','\x20image,\x20trying\x20message\x20types:','fillStyle','startsWith','210wWyGEN','delete','sensor_msgs/msg/CompressedImage','subscribe','closed','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','compressed','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','updateTurnCredentials','16662eBMJsI','get','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','\x20for\x20topic\x20','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','has','warn','type','handleOffer','ðŸ¤–\x20Robot\x20Camera','split','toString','fillText','stop','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','connectionState','./turnCredentialsService','pop','getIceServers','sensor_msgs/CompressedImage','data','OPEN','removeEventListener','unsubscribe','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','search','webrtc_','color','close','12px\x20Arial','1345TLWZEK','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','processColorImage','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','includes',',\x20trying\x20alternative\x20depth\x20topics','publish','webrtc_ice_candidate','#00ff00','length','[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20','stringify','sensor_msgs/msg/Image','getSharedVideoSources','webrtc','initializing','topic','compressed_depth_image_transport/CompressedDepthImage','webrtc_stop_session','\x20initialized\x20successfully','processDepthImage','error','addEventListener','/compressedDepth','keys','max','#00aaff','getOrCreateSharedVideoSource','initializeSession','putImageData','font','onconnectionstatechange','\x20bytes','readyState','\x20connection\x20closed,\x20cleaning\x20up','rosSubscriber','getImageData','constructor','log','[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20','topicSessions','/compressed','setLocalDescription','random','drawLoadingPattern','webrtc_offer','initialize','[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','send','toLocaleTimeString','/image_raw','canvas','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','wrtc','depthProcessor','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','#ffffff','rgba(0,\x200,\x200,\x200.7)','function','[WebRTC\x20Appliance]\x20Session\x20','from','height','\x20sessions)','[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20','sharedVideoSources','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','/9j/','setRemoteDescription','/image','sensor_msgs/Image','getContext','stun:stun1.l.google.com:19302','Topic:\x20','msg'];a6_0x45ac=function(){return _0xeb4186;};return a6_0x45ac();}