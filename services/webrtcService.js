const a6_0x5061c2=a6_0x5615;function a6_0x5615(_0x2f12e7,_0x403e21){const _0x253908=a6_0x3c92();return a6_0x5615=function(_0xea15bc,_0x3bde79){_0xea15bc=_0xea15bc-0x16d;let _0x3c9297=_0x253908[_0xea15bc];return _0x3c9297;},a6_0x5615(_0x2f12e7,_0x403e21);}(function(_0x3e80d0,_0x4b8246){const _0x529ed7=a6_0x5615,_0x184a9a=_0x3e80d0();while(!![]){try{const _0x4459cf=-parseInt(_0x529ed7(0x16d))/0x1*(-parseInt(_0x529ed7(0x1fc))/0x2)+parseInt(_0x529ed7(0x230))/0x3+-parseInt(_0x529ed7(0x1d9))/0x4+parseInt(_0x529ed7(0x223))/0x5*(parseInt(_0x529ed7(0x22e))/0x6)+-parseInt(_0x529ed7(0x1b5))/0x7+-parseInt(_0x529ed7(0x186))/0x8*(parseInt(_0x529ed7(0x1b0))/0x9)+-parseInt(_0x529ed7(0x1c8))/0xa*(-parseInt(_0x529ed7(0x1f2))/0xb);if(_0x4459cf===_0x4b8246)break;else _0x184a9a['push'](_0x184a9a['shift']());}catch(_0x5672e5){_0x184a9a['push'](_0x184a9a['shift']());}}}(a6_0x3c92,0x44b83));const a6_0x3bde79=(function(){let _0x17a722=!![];return function(_0xa8b6c8,_0xaffdad){const _0x211f70=_0x17a722?function(){const _0x46b5da=a6_0x5615;if(_0xaffdad){const _0x3154ec=_0xaffdad[_0x46b5da(0x1f9)](_0xa8b6c8,arguments);return _0xaffdad=null,_0x3154ec;}}:function(){};return _0x17a722=![],_0x211f70;};}()),a6_0xea15bc=a6_0x3bde79(this,function(){const _0x4c6004=a6_0x5615;return a6_0xea15bc[_0x4c6004(0x209)]()[_0x4c6004(0x173)](_0x4c6004(0x239))['toString']()[_0x4c6004(0x1a4)](a6_0xea15bc)[_0x4c6004(0x173)](_0x4c6004(0x239));});a6_0xea15bc();const {RTCPeerConnection,RTCSessionDescription,RTCIceCandidate,nonstandard}=require(a6_0x5061c2(0x224)),sharp=require(a6_0x5061c2(0x1a9)),config=require(a6_0x5061c2(0x206)),DepthImageProcessor=require(a6_0x5061c2(0x1d8)),turnCredentialsService=require(a6_0x5061c2(0x1ba));function a6_0x3c92(){const _0x32d998=['2OLccbE','add','\x20for\x20topic:\x20','framerate','sendFrameToVideoSource','onconnectionstatechange','[WebRTC\x20Appliance]\x20Attempted\x20to\x20stop\x20non-existent\x20session:\x20','🔍\x20Processing\x20depth...','getIceServers','connectionState','../config','startsWith','webrtc_offer','toString','[WebRTC\x20Appliance]\x20Error\x20processing\x20ROS\x20message:','[WebRTC\x20Appliance]\x20Created\x20answer','setRemoteDescription','drawLoadingPattern','processDepthImage','[WebRTC\x20Appliance]\x20Trying\x20alternative\x20topic:\x20','data','depthProcessor','random','\x20bytes','[WebRTC\x20Appliance]\x20Error\x20handling\x20offer\x20for\x20session\x20','12px\x20Arial','compressed_depth_image_transport/CompressedDepthImage','#00ff00','split','[WebRTC\x20Appliance]\x20Session\x20not\x20found:\x20','closed','setLocalDescription','sensor_msgs/CompressedImage','10px\x20monospace','#00ffff','[WebRTC\x20Appliance]\x20Set\x20local\x20description\x20(answer)','\x20for\x20topic\x20','onFrame','[WebRTC\x20Appliance]\x20Stopping\x20session:\x20','66845bKlQHA','wrtc','unknown','\x20initialized\x20successfully','[WebRTC\x20Appliance]\x20Released\x20shared\x20video\x20source\x20for\x20topic\x20','\x20connection\x20closed,\x20cleaning\x20up','[WebRTC\x20Appliance]\x20Active\x20sessions\x20for\x20topic\x20','\x20with\x20message\x20type\x20','width','font','Topic:\x20','54VnnRYk','[WebRTC\x20Appliance]\x20Handling\x20message:\x20','1418244wNEctr',',\x20size:\x20','offer','\x20connection\x20state:\x20','unsubscribe','base64','replace','compressedDepth','set','(((.+)+)+)+$','sensor_msgs/msg/CompressedImage','protocol','handleMessage','#666','[WebRTC\x20Appliance]\x20Creating\x20new\x20shared\x20video\x20source\x20for\x20topic\x20','102384MoDVqO','[WebRTC\x20Appliance]\x20Subscribing\x20to\x20ROS\x20topic:\x20','videoTrack','send','handleIceCandidate','\x20detected\x20as\x20','search','[WebRTC\x20Appliance]\x20Depth\x20processing\x20issue.\x20Alternative\x20topics:\x20','min','function','sensor_msgs/Image','[WebRTC\x20Appliance]\x20Initializing\x20session\x20','error','subscribe','stringify','includes','[WebRTC\x20Appliance]\x20Error\x20sending\x20frame\x20to\x20video\x20source:','webrtc','msg','fillStyle','compressed','topicSessions','peerConnection','[WebRTC\x20Appliance]\x20No\x20data\x20received\x20on\x20','stopAllSessions','8jQCplr','iceServers','🤖\x20Robot\x20Camera','#ffffff','#888','\x20connection\x20failed,\x20stopping\x20session','log','addIceCandidate',',\x20cleaning\x20up\x20shared\x20resources','16px\x20Arial','[WebRTC\x20Appliance]\x20Session\x20not\x20found\x20for\x20ICE\x20candidate:\x20','[WebRTC\x20Appliance]\x20Created\x20video\x20track\x20for\x20session\x20','session_id','candidate','[WebRTC\x20Appliance]\x20TURN\x20credentials\x20updated\x20successfully','[WebRTC\x20Appliance]\x20Unknown\x20operation:\x20','warn','type','updateTurnCredentials','message','[WebRTC\x20Appliance]\x20Using\x20fallback\x20STUN\x20servers','getContext','height','activeSessions','[WebRTC\x20Appliance]\x20No\x20more\x20sessions\x20for\x20topic\x20','has','subscribeToROSTopic','toLocaleTimeString',',\x20trying\x20alternative\x20depth\x20topics','delete','constructor','[WebRTC\x20Appliance]\x20Updating\x20TURN\x20credentials...','textAlign','topic','connected','sharp','getActiveSessions','push','rgba(0,\x200,\x200,\x200.7)','/compressedDepth','#00aaff','publish','1033245RxfHjx','round','video','[WebRTC\x20Appliance]\x20ROSBridge\x20not\x20connected','updateCanvasWithImageData','3441585gWgysj','sharedVideoSources','rosbridgeWs','size','webrtc_stop_session','./turnCredentialsService','24px\x20Arial','[WebRTC\x20Appliance]\x20Stopping\x20all\x20active\x20sessions','addTrack','fillText','failed','stopSession','isDepthTopic','processColorImage','arc','initializeSession','webrtc_ice_candidate','center','videoSource','18850ZySFpm','[WebRTC\x20Appliance]\x20Failed\x20to\x20process\x20frame\x20for\x20topic\x20','addEventListener','Waiting\x20for\x20ROS\x20image\x20data...','get','fillRect','[WebRTC\x20Appliance]\x20Set\x20remote\x20description\x20(offer)','from','[WebRTC\x20Appliance]\x20Processing\x20offer\x20for\x20session\x20','initialize','length','[WebRTC\x20Appliance]\x20Error\x20processing\x20alternative\x20topic\x20message:','OPEN','releaseSharedVideoSource','convertRGBAtoI420','depth','./DepthImageProcessor','413852Tlruzl','color','sensor_msgs/msg/Image','webrtc_answer','[WebRTC\x20Appliance]\x20Cleaned\x20up\x20session:\x20','#1a1a1a','serverUrl','frameCount','[WebRTC\x20Appliance]\x20Session\x20','rosSubscriber','getOrCreateSharedVideoSource','cleanupSession','parse','pop','serverWs','close','max','📹\x20Color','📹\x20Processing\x20video...','[WebRTC\x20Appliance]\x20Answer\x20sent\x20for\x20session\x20','rtcConfig','/image_raw','readyState','webrtc_init_session','keys','1727FTMxFK','[WebRTC\x20Appliance]\x20Service\x20initialized','fill','🔍\x20Depth','[WebRTC\x20Appliance]\x20Got\x20data\x20from\x20alternative\x20topic\x20','canvas',',\x20converting\x20to\x20base64...','apply','getImageData','12px\x20monospace'];a6_0x3c92=function(){return _0x32d998;};return a6_0x3c92();}class ApplianceWebRTCService{constructor(){const _0x51dcb0=a6_0x5061c2;this['activeSessions']=new Map(),this[_0x51dcb0(0x182)]=new Map(),this[_0x51dcb0(0x1b6)]=new Map(),this[_0x51dcb0(0x1b7)]=null,this[_0x51dcb0(0x1e7)]=null,this[_0x51dcb0(0x211)]=new DepthImageProcessor(),this[_0x51dcb0(0x1ed)]={'iceServers':[{'urls':'stun:stun.l.google.com:19302'},{'urls':'stun:stun1.l.google.com:19302'}]};}[a6_0x5061c2(0x1d1)](_0x4db46a,_0xa3f462){const _0x108492=a6_0x5061c2;this[_0x108492(0x1b7)]=_0x4db46a,this[_0x108492(0x1e7)]=_0xa3f462,turnCredentialsService['initialize'](config[_0x108492(0x1df)]),this[_0x108492(0x198)](),console[_0x108492(0x18c)](_0x108492(0x1f3));}async['updateTurnCredentials'](){const _0x4d3c3a=a6_0x5061c2;try{console[_0x4d3c3a(0x18c)](_0x4d3c3a(0x1a5));const _0x3e8daa=await turnCredentialsService[_0x4d3c3a(0x204)]();this['rtcConfig'][_0x4d3c3a(0x187)]=_0x3e8daa,console[_0x4d3c3a(0x18c)](_0x4d3c3a(0x194));}catch(_0x27655a){console[_0x4d3c3a(0x179)]('[WebRTC\x20Appliance]\x20Error\x20updating\x20TURN\x20credentials:',_0x27655a),console[_0x4d3c3a(0x18c)](_0x4d3c3a(0x19a));}}[a6_0x5061c2(0x23c)](_0x3f1478){const _0x4eef18=a6_0x5061c2;if(!_0x3f1478['op']||!_0x3f1478['op'][_0x4eef18(0x207)]('webrtc_'))return![];console[_0x4eef18(0x18c)](_0x4eef18(0x22f)+_0x3f1478['op']);switch(_0x3f1478['op']){case _0x4eef18(0x1f0):this[_0x4eef18(0x1c4)](_0x3f1478[_0x4eef18(0x192)],_0x3f1478[_0x4eef18(0x1a7)]);return!![];case _0x4eef18(0x208):this['handleOffer'](_0x3f1478[_0x4eef18(0x192)],_0x3f1478[_0x4eef18(0x232)]);return!![];case _0x4eef18(0x1c5):this[_0x4eef18(0x171)](_0x3f1478[_0x4eef18(0x192)],_0x3f1478['candidate']);return!![];case _0x4eef18(0x1b9):this[_0x4eef18(0x1c0)](_0x3f1478[_0x4eef18(0x192)]);return!![];default:console[_0x4eef18(0x196)](_0x4eef18(0x195)+_0x3f1478['op']);return![];}}[a6_0x5061c2(0x1e3)](_0x4b1366){const _0x2454e5=a6_0x5061c2;if(this[_0x2454e5(0x1b6)][_0x2454e5(0x19f)](_0x4b1366)){const _0x1e09fa=this['sharedVideoSources']['get'](_0x4b1366);return _0x1e09fa[_0x2454e5(0x1e0)]++,console[_0x2454e5(0x18c)]('[WebRTC\x20Appliance]\x20Reusing\x20shared\x20video\x20source\x20for\x20topic\x20'+_0x4b1366+'\x20('+_0x1e09fa['frameCount']+'\x20sessions)'),_0x1e09fa;}console[_0x2454e5(0x18c)](_0x2454e5(0x23e)+_0x4b1366);const {createCanvas:_0x158b54}=require('canvas'),_0x4d8a6b=_0x158b54(config[_0x2454e5(0x17e)][_0x2454e5(0x1b2)][_0x2454e5(0x22b)],config[_0x2454e5(0x17e)]['video']['height']),_0x33ea51=_0x4d8a6b[_0x2454e5(0x19b)]('2d');this[_0x2454e5(0x20d)](_0x4d8a6b,_0x33ea51);const {RTCVideoSource:_0x220723}=nonstandard,_0x539ba9=new _0x220723();let _0x3bfc50=0x0;const _0x3c789d=0x3e8/config[_0x2454e5(0x17e)][_0x2454e5(0x1b2)][_0x2454e5(0x1ff)],_0x51e774=this[_0x2454e5(0x1a0)](_0x4b1366,_0x3204aa=>{const _0xdabdac=_0x2454e5,_0x38d695=Date['now']();_0x38d695-_0x3bfc50>=_0x3c789d&&(_0x3bfc50=_0x38d695,this[_0xdabdac(0x1b4)](_0x4d8a6b,_0x33ea51,_0x3204aa,_0x4b1366,_0x539ba9));}),_0x4865a3={'videoSource':_0x539ba9,'canvas':_0x4d8a6b,'rosSubscriber':_0x51e774,'frameCount':0x1,'topic':_0x4b1366};return this['sharedVideoSources'][_0x2454e5(0x238)](_0x4b1366,_0x4865a3),_0x4865a3;}[a6_0x5061c2(0x1d5)](_0x2ab1b7){const _0x3b0966=a6_0x5061c2,_0x2eed45=this[_0x3b0966(0x1b6)]['get'](_0x2ab1b7);if(!_0x2eed45)return;_0x2eed45[_0x3b0966(0x1e0)]--,console[_0x3b0966(0x18c)](_0x3b0966(0x227)+_0x2ab1b7+'\x20('+_0x2eed45[_0x3b0966(0x1e0)]+'\x20sessions\x20remaining)'),_0x2eed45[_0x3b0966(0x1e0)]<=0x0&&(console['log'](_0x3b0966(0x19e)+_0x2ab1b7+_0x3b0966(0x18e)),_0x2eed45[_0x3b0966(0x1c7)]&&(_0x2eed45[_0x3b0966(0x1c7)]=null),_0x2eed45[_0x3b0966(0x1e2)]&&_0x2eed45[_0x3b0966(0x1e2)][_0x3b0966(0x234)](),this[_0x3b0966(0x1b6)]['delete'](_0x2ab1b7));}async[a6_0x5061c2(0x1c4)](_0x531b90,_0x5748da){const _0x48b80d=a6_0x5061c2;try{console['log'](_0x48b80d(0x178)+_0x531b90+_0x48b80d(0x220)+_0x5748da);const _0x5c9076=this['getOrCreateSharedVideoSource'](_0x5748da),_0x89d6d8=new RTCPeerConnection(this[_0x48b80d(0x1ed)]),_0x329c13=_0x5c9076[_0x48b80d(0x1c7)]['createTrack']({'width':config[_0x48b80d(0x17e)][_0x48b80d(0x1b2)]['width'],'height':config[_0x48b80d(0x17e)][_0x48b80d(0x1b2)][_0x48b80d(0x19c)],'framerate':config[_0x48b80d(0x17e)][_0x48b80d(0x1b2)][_0x48b80d(0x1ff)]});console[_0x48b80d(0x18c)](_0x48b80d(0x191)+_0x531b90);const {MediaStream:_0xe696a6}=require(_0x48b80d(0x224)),_0x15010b=new _0xe696a6([_0x329c13]);_0x89d6d8[_0x48b80d(0x1bd)](_0x329c13,_0x15010b),this[_0x48b80d(0x200)](_0x5c9076[_0x48b80d(0x1c7)],_0x5c9076[_0x48b80d(0x1f7)]),_0x89d6d8['onicecandidate']=_0xd470c9=>{const _0x3b19a5=_0x48b80d;if(_0xd470c9['candidate']&&this[_0x3b19a5(0x1e7)])console[_0x3b19a5(0x18c)]('[WebRTC\x20Appliance]\x20Generated\x20ICE\x20candidate\x20for\x20session\x20'+_0x531b90+':',{'type':_0xd470c9['candidate'][_0x3b19a5(0x197)],'protocol':_0xd470c9[_0x3b19a5(0x193)][_0x3b19a5(0x23b)],'address':_0xd470c9[_0x3b19a5(0x193)]['address'],'port':_0xd470c9[_0x3b19a5(0x193)]['port']}),this[_0x3b19a5(0x1e7)][_0x3b19a5(0x170)](JSON['stringify']({'op':_0x3b19a5(0x1c5),'session_id':_0x531b90,'candidate':_0xd470c9[_0x3b19a5(0x193)]}));else!_0xd470c9[_0x3b19a5(0x193)]&&console[_0x3b19a5(0x18c)]('[WebRTC\x20Appliance]\x20ICE\x20gathering\x20complete\x20for\x20session\x20'+_0x531b90);},_0x89d6d8[_0x48b80d(0x201)]=()=>{const _0x530a06=_0x48b80d;console[_0x530a06(0x18c)](_0x530a06(0x1e1)+_0x531b90+_0x530a06(0x233)+_0x89d6d8['connectionState']);if(_0x89d6d8[_0x530a06(0x205)]===_0x530a06(0x1a8))console['log']('[WebRTC\x20Appliance]\x20Session\x20'+_0x531b90+'\x20successfully\x20connected!');else{if(_0x89d6d8[_0x530a06(0x205)]===_0x530a06(0x1bf))console[_0x530a06(0x18c)](_0x530a06(0x1e1)+_0x531b90+_0x530a06(0x18b)),this[_0x530a06(0x1c0)](_0x531b90);else _0x89d6d8[_0x530a06(0x205)]===_0x530a06(0x21a)&&(console[_0x530a06(0x18c)](_0x530a06(0x1e1)+_0x531b90+_0x530a06(0x228)),this[_0x530a06(0x1e4)](_0x531b90));}},this['activeSessions'][_0x48b80d(0x238)](_0x531b90,{'peerConnection':_0x89d6d8,'topic':_0x5748da,'videoTrack':_0x329c13,'mediaStream':_0x15010b,'status':'initializing'}),!this[_0x48b80d(0x182)][_0x48b80d(0x19f)](_0x5748da)&&this[_0x48b80d(0x182)]['set'](_0x5748da,new Set()),this[_0x48b80d(0x182)]['get'](_0x5748da)[_0x48b80d(0x1fd)](_0x531b90),console['log'](_0x48b80d(0x1e1)+_0x531b90+_0x48b80d(0x226)),console[_0x48b80d(0x18c)](_0x48b80d(0x229)+_0x5748da+':\x20'+this[_0x48b80d(0x182)]['get'](_0x5748da)[_0x48b80d(0x1b8)]);}catch(_0xe58650){console[_0x48b80d(0x179)]('[WebRTC\x20Appliance]\x20Error\x20initializing\x20session\x20'+_0x531b90+':',_0xe58650),this[_0x48b80d(0x1c0)](_0x531b90);}}async['handleOffer'](_0x5e94ec,_0x143cbc){const _0x1f4cf2=a6_0x5061c2,_0x5a2e2d=this[_0x1f4cf2(0x19d)][_0x1f4cf2(0x1cc)](_0x5e94ec);if(!_0x5a2e2d){console['error'](_0x1f4cf2(0x219)+_0x5e94ec);return;}try{console[_0x1f4cf2(0x18c)](_0x1f4cf2(0x1d0)+_0x5e94ec),await _0x5a2e2d['peerConnection'][_0x1f4cf2(0x20c)](new RTCSessionDescription(_0x143cbc)),console[_0x1f4cf2(0x18c)](_0x1f4cf2(0x1ce));const _0x48b75e=await _0x5a2e2d[_0x1f4cf2(0x183)]['createAnswer']();console[_0x1f4cf2(0x18c)](_0x1f4cf2(0x20b)),await _0x5a2e2d[_0x1f4cf2(0x183)][_0x1f4cf2(0x21b)](_0x48b75e),console[_0x1f4cf2(0x18c)](_0x1f4cf2(0x21f)),this[_0x1f4cf2(0x1e7)]&&(this[_0x1f4cf2(0x1e7)][_0x1f4cf2(0x170)](JSON[_0x1f4cf2(0x17b)]({'op':_0x1f4cf2(0x1dc),'session_id':_0x5e94ec,'answer':_0x48b75e})),console[_0x1f4cf2(0x18c)](_0x1f4cf2(0x1ec)+_0x5e94ec));}catch(_0x4b8c52){console[_0x1f4cf2(0x179)](_0x1f4cf2(0x214)+_0x5e94ec+':',_0x4b8c52),this['stopSession'](_0x5e94ec);}}async[a6_0x5061c2(0x171)](_0x494fae,_0x1d45b2){const _0x4acaad=a6_0x5061c2,_0x5b9bb4=this[_0x4acaad(0x19d)]['get'](_0x494fae);if(!_0x5b9bb4){console[_0x4acaad(0x179)](_0x4acaad(0x190)+_0x494fae);return;}try{await _0x5b9bb4[_0x4acaad(0x183)][_0x4acaad(0x18d)](new RTCIceCandidate(_0x1d45b2)),console[_0x4acaad(0x18c)]('[WebRTC\x20Appliance]\x20ICE\x20candidate\x20added\x20for\x20session\x20'+_0x494fae);}catch(_0x5bdb6a){console[_0x4acaad(0x179)]('[WebRTC\x20Appliance]\x20Error\x20adding\x20ICE\x20candidate\x20for\x20session\x20'+_0x494fae+':',_0x5bdb6a);}}[a6_0x5061c2(0x1a0)](_0x111b29,_0x3e0eb1){const _0x4897f8=a6_0x5061c2;if(!this[_0x4897f8(0x1b7)]||this['rosbridgeWs'][_0x4897f8(0x1ef)]!==this[_0x4897f8(0x1b7)][_0x4897f8(0x1d4)])return console[_0x4897f8(0x179)](_0x4897f8(0x1b3)),null;console['log'](_0x4897f8(0x16e)+_0x111b29);const _0x1e4378=_0x111b29[_0x4897f8(0x17c)](_0x4897f8(0x1d7)),_0x9f1ae3=_0x111b29[_0x4897f8(0x17c)](_0x4897f8(0x181))||_0x111b29[_0x4897f8(0x17c)](_0x4897f8(0x237));let _0x55eafb=[];_0x1e4378?_0x9f1ae3?_0x55eafb=['sensor_msgs/CompressedImage',_0x4897f8(0x23a),_0x4897f8(0x216),_0x4897f8(0x177)]:_0x55eafb=[_0x4897f8(0x177),_0x4897f8(0x1db),_0x4897f8(0x21c)]:_0x55eafb=[_0x4897f8(0x21c),'sensor_msgs/msg/CompressedImage',_0x4897f8(0x177)];console[_0x4897f8(0x18c)]('[WebRTC\x20Appliance]\x20Topic\x20'+_0x111b29+_0x4897f8(0x172)+(_0x1e4378?_0x4897f8(0x1d7):_0x4897f8(0x1da))+'\x20image,\x20trying\x20message\x20types:',_0x55eafb);const _0x40d6ff=[];let _0x4b2c89=![];const _0x59f3ee=_0x3957b0=>{return _0x53f636=>{const _0x1fd66f=a6_0x5615;try{const _0x4a59b2=JSON['parse'](_0x53f636[_0x1fd66f(0x210)]);_0x4a59b2['op']===_0x1fd66f(0x1af)&&_0x4a59b2[_0x1fd66f(0x1a7)]===_0x111b29&&_0x4a59b2['msg']&&(!_0x4b2c89&&(console[_0x1fd66f(0x18c)]('[WebRTC\x20Appliance]\x20Successfully\x20receiving\x20data\x20on\x20'+_0x111b29+_0x1fd66f(0x22a)+_0x3957b0),_0x4b2c89=!![]),_0x3e0eb1(_0x4a59b2['msg']));}catch(_0x377780){console['error'](_0x1fd66f(0x20a),_0x377780);}};};for(const _0x358264 of _0x55eafb){const _0x1ee909={'op':_0x4897f8(0x17a),'topic':_0x111b29,'type':_0x358264};console[_0x4897f8(0x18c)]('[WebRTC\x20Appliance]\x20Trying\x20subscription\x20with\x20type:\x20'+_0x358264),this['rosbridgeWs'][_0x4897f8(0x170)](JSON[_0x4897f8(0x17b)](_0x1ee909));const _0x209b96=_0x59f3ee(_0x358264);this[_0x4897f8(0x1b7)][_0x4897f8(0x1ca)](_0x4897f8(0x199),_0x209b96),_0x40d6ff[_0x4897f8(0x1ab)]({'handler':_0x209b96,'type':_0x358264});}return _0x1e4378&&_0x9f1ae3&&setTimeout(()=>{const _0x12e5bc=_0x4897f8;if(!_0x4b2c89){console[_0x12e5bc(0x18c)](_0x12e5bc(0x184)+_0x111b29+_0x12e5bc(0x1a2));const _0x54dd44=_0x111b29[_0x12e5bc(0x236)](_0x12e5bc(0x1ad),'')[_0x12e5bc(0x236)]('/compressed',''),_0x1b3885=[_0x54dd44+'/image_raw',_0x54dd44+'/image',_0x54dd44];for(const _0xf6a753 of _0x1b3885){console[_0x12e5bc(0x18c)](_0x12e5bc(0x20f)+_0xf6a753);const _0x23dbae={'op':_0x12e5bc(0x17a),'topic':_0xf6a753,'type':'sensor_msgs/Image'};this[_0x12e5bc(0x1b7)][_0x12e5bc(0x170)](JSON[_0x12e5bc(0x17b)](_0x23dbae));const _0x1faaf0=_0x5f59ee=>{const _0x524ee3=_0x12e5bc;try{const _0x320c70=JSON[_0x524ee3(0x1e5)](_0x5f59ee[_0x524ee3(0x210)]);_0x320c70['op']===_0x524ee3(0x1af)&&_0x320c70[_0x524ee3(0x1a7)]===_0xf6a753&&_0x320c70['msg']&&(console['log'](_0x524ee3(0x1f6)+_0xf6a753+_0x524ee3(0x1f8)),_0x320c70['msg'][_0x524ee3(0x210)]&&!_0x320c70[_0x524ee3(0x17f)][_0x524ee3(0x210)][_0x524ee3(0x207)]('/9j/')&&_0x3e0eb1(_0x320c70[_0x524ee3(0x17f)]));}catch(_0xabe86a){console[_0x524ee3(0x179)](_0x524ee3(0x1d3),_0xabe86a);}};this[_0x12e5bc(0x1b7)]['addEventListener'](_0x12e5bc(0x199),_0x1faaf0),_0x40d6ff['push']({'handler':_0x1faaf0,'type':_0x12e5bc(0x177),'topic':_0xf6a753});}}},0xbb8),{'unsubscribe':()=>{const _0x3d0419=_0x4897f8;for(const {handler:_0x236c4c,type:_0x2fb65c,topic:_0x2867b6}of _0x40d6ff){this['rosbridgeWs']['removeEventListener']('message',_0x236c4c),this[_0x3d0419(0x1b7)][_0x3d0419(0x1ef)]===this[_0x3d0419(0x1b7)][_0x3d0419(0x1d4)]&&this[_0x3d0419(0x1b7)][_0x3d0419(0x170)](JSON[_0x3d0419(0x17b)]({'op':_0x3d0419(0x234),'topic':_0x2867b6||_0x111b29}));}}};}[a6_0x5061c2(0x20d)](_0x182854,_0x44aeaa){const _0x30395b=a6_0x5061c2;_0x44aeaa['fillStyle']='#1a1a1a',_0x44aeaa[_0x30395b(0x1cd)](0x0,0x0,_0x182854[_0x30395b(0x22b)],_0x182854[_0x30395b(0x19c)]),_0x44aeaa[_0x30395b(0x180)]=_0x30395b(0x1ae),_0x44aeaa['font']=_0x30395b(0x1bb),_0x44aeaa[_0x30395b(0x1a6)]=_0x30395b(0x1c6),_0x44aeaa[_0x30395b(0x1be)](_0x30395b(0x188),_0x182854[_0x30395b(0x22b)]/0x2,_0x182854[_0x30395b(0x19c)]/0x2-0x14),_0x44aeaa[_0x30395b(0x180)]=_0x30395b(0x189),_0x44aeaa[_0x30395b(0x22c)]='16px\x20Arial',_0x44aeaa[_0x30395b(0x1be)](_0x30395b(0x1cb),_0x182854[_0x30395b(0x22b)]/0x2,_0x182854[_0x30395b(0x19c)]/0x2+0x14);const _0x1d6eb0=Date['now']()/0x3e8;for(let _0x2ff8ae=0x0;_0x2ff8ae<0x3;_0x2ff8ae++){const _0x2fd514=(Math['sin'](_0x1d6eb0*0x2+_0x2ff8ae*0.5)+0x1)/0x2;_0x44aeaa[_0x30395b(0x180)]='rgba(0,\x20170,\x20255,\x20'+_0x2fd514*0.5+')',_0x44aeaa['beginPath'](),_0x44aeaa[_0x30395b(0x1c3)](_0x182854[_0x30395b(0x22b)]/0x2-0x28+_0x2ff8ae*0x28,_0x182854['height']/0x2+0x3c,0x8,0x0,0x2*Math['PI']),_0x44aeaa[_0x30395b(0x1f4)]();}}['sendFrameToVideoSource'](_0x1f8a88,_0xf97c50){const _0x4332d4=a6_0x5061c2;try{if(!_0x1f8a88||!_0xf97c50)return;const _0x11aed3=_0xf97c50[_0x4332d4(0x19b)]('2d'),_0x581659=_0x11aed3[_0x4332d4(0x1fa)](0x0,0x0,_0xf97c50[_0x4332d4(0x22b)],_0xf97c50[_0x4332d4(0x19c)]),_0x2b41b0=this['convertRGBAtoI420'](_0x581659[_0x4332d4(0x210)],_0xf97c50[_0x4332d4(0x22b)],_0xf97c50[_0x4332d4(0x19c)]),_0x175622={'width':_0xf97c50[_0x4332d4(0x22b)],'height':_0xf97c50[_0x4332d4(0x19c)],'data':_0x2b41b0};typeof _0x1f8a88[_0x4332d4(0x221)]===_0x4332d4(0x176)&&_0x1f8a88[_0x4332d4(0x221)](_0x175622);}catch(_0x1a9889){console[_0x4332d4(0x179)](_0x4332d4(0x17d),_0x1a9889);}}[a6_0x5061c2(0x1d6)](_0x567247,_0x244675,_0x128d1b){const _0x11b8f1=a6_0x5061c2,_0xe3dc29=_0x244675*_0x128d1b,_0x5d1bde=_0x244675*_0x128d1b/0x4,_0x1242bf=new Uint8Array(_0xe3dc29+_0x5d1bde*0x2);let _0x442868=0x0,_0x4e3105=_0xe3dc29,_0x4fc5cf=_0xe3dc29+_0x5d1bde;for(let _0x4cf446=0x0;_0x4cf446<_0x128d1b;_0x4cf446++){for(let _0x52f3cb=0x0;_0x52f3cb<_0x244675;_0x52f3cb++){const _0x35a6cc=(_0x4cf446*_0x244675+_0x52f3cb)*0x4,_0x2b9151=_0x567247[_0x35a6cc],_0x1bf077=_0x567247[_0x35a6cc+0x1],_0x54580f=_0x567247[_0x35a6cc+0x2],_0xf20d72=Math[_0x11b8f1(0x1b1)](0.299*_0x2b9151+0.587*_0x1bf077+0.114*_0x54580f);_0x1242bf[_0x442868++]=_0xf20d72;if(_0x4cf446%0x2===0x0&&_0x52f3cb%0x2===0x0){const _0x1c2d98=Math[_0x11b8f1(0x1b1)](-0.169*_0x2b9151-0.331*_0x1bf077+0.5*_0x54580f+0x80),_0x3b486e=Math[_0x11b8f1(0x1b1)](0.5*_0x2b9151-0.419*_0x1bf077-0.081*_0x54580f+0x80);_0x1242bf[_0x4e3105++]=Math['max'](0x0,Math[_0x11b8f1(0x175)](0xff,_0x1c2d98)),_0x1242bf[_0x4fc5cf++]=Math[_0x11b8f1(0x1e9)](0x0,Math['min'](0xff,_0x3b486e));}}}return _0x1242bf;}async['updateCanvasWithImageData'](_0x57dd50,_0x3732dc,_0x43d9d9,_0xb6243e,_0xd1fb83){const _0x239869=a6_0x5061c2;try{if(!_0x43d9d9||!_0x43d9d9['data'])return;Math['random']()<0.01&&console[_0x239869(0x18c)]('[WebRTC\x20Appliance]\x20Processing\x20image\x20data\x20for\x20topic\x20'+_0xb6243e+_0x239869(0x231)+_0x43d9d9['data'][_0x239869(0x1d2)]+_0x239869(0x213));const _0x383464=Buffer[_0x239869(0x1cf)](_0x43d9d9[_0x239869(0x210)],_0x239869(0x235)),_0x51c69c=this[_0x239869(0x211)][_0x239869(0x1c1)](_0xb6243e);let _0x54522e;_0x51c69c?_0x54522e=await this[_0x239869(0x211)][_0x239869(0x20e)](_0x383464,_0x57dd50,_0x3732dc,_0xb6243e):_0x54522e=await this[_0x239869(0x211)][_0x239869(0x1c2)](_0x383464,_0x57dd50,_0x3732dc),_0x3732dc['putImageData'](_0x54522e,0x0,0x0),_0x3732dc[_0x239869(0x180)]=_0x239869(0x1ac),_0x3732dc[_0x239869(0x1cd)](0xa,0xa,0xdc,0x32),_0x3732dc['fillStyle']=_0x51c69c?_0x239869(0x21e):_0x239869(0x217),_0x3732dc[_0x239869(0x22c)]=_0x239869(0x1fb),_0x3732dc[_0x239869(0x1be)]((_0x51c69c?_0x239869(0x1f5):_0x239869(0x1ea))+':\x20'+new Date()[_0x239869(0x1a1)](),0xf,0x1c),_0x3732dc['fillStyle']=_0x239869(0x189),_0x3732dc[_0x239869(0x22c)]=_0x239869(0x21d),_0x3732dc[_0x239869(0x1be)](_0x239869(0x22d)+_0xb6243e[_0x239869(0x218)]('/')[_0x239869(0x1e6)](),0xf,0x2d),this['sendFrameToVideoSource'](_0xd1fb83,_0x57dd50);}catch(_0x2909d1){console[_0x239869(0x196)](_0x239869(0x1c9)+_0xb6243e+':',_0x2909d1['message']);_0xb6243e[_0x239869(0x17c)]('depth')&&Math[_0x239869(0x212)]()<0.1&&console[_0x239869(0x196)](_0x239869(0x174)+_0xb6243e[_0x239869(0x236)]('/compressedDepth',_0x239869(0x1ee)));_0x3732dc[_0x239869(0x180)]=_0x239869(0x1de),_0x3732dc[_0x239869(0x1cd)](0x0,0x0,_0x57dd50['width'],_0x57dd50[_0x239869(0x19c)]),_0x3732dc[_0x239869(0x180)]=_0x239869(0x18a),_0x3732dc[_0x239869(0x22c)]=_0x239869(0x18f),_0x3732dc['textAlign']=_0x239869(0x1c6);const _0x6fd9d9=_0xb6243e[_0x239869(0x17c)](_0x239869(0x1d7))?_0x239869(0x203):_0x239869(0x1eb);_0x3732dc['fillText'](_0x6fd9d9,_0x57dd50[_0x239869(0x22b)]/0x2,_0x57dd50[_0x239869(0x19c)]/0x2),_0x3732dc[_0x239869(0x180)]=_0x239869(0x23d),_0x3732dc[_0x239869(0x22c)]=_0x239869(0x215),_0x3732dc[_0x239869(0x1be)](_0x239869(0x22d)+_0xb6243e['split']('/')['pop'](),_0x57dd50[_0x239869(0x22b)]/0x2,_0x57dd50['height']/0x2+0x19),this[_0x239869(0x200)](_0xd1fb83,_0x57dd50);}}['stopSession'](_0x3c50aa){const _0x4d69f2=a6_0x5061c2,_0x1cb0d0=this['activeSessions']['get'](_0x3c50aa);if(!_0x1cb0d0){console[_0x4d69f2(0x196)](_0x4d69f2(0x202)+_0x3c50aa);return;}console['log'](_0x4d69f2(0x222)+_0x3c50aa+_0x4d69f2(0x1fe)+_0x1cb0d0[_0x4d69f2(0x1a7)]);try{this[_0x4d69f2(0x1e7)]&&this[_0x4d69f2(0x1e7)][_0x4d69f2(0x1ef)]===this['serverWs'][_0x4d69f2(0x1d4)]&&this[_0x4d69f2(0x1e7)][_0x4d69f2(0x170)](JSON[_0x4d69f2(0x17b)]({'op':_0x4d69f2(0x1b9),'session_id':_0x3c50aa})),_0x1cb0d0[_0x4d69f2(0x16f)]&&_0x1cb0d0[_0x4d69f2(0x16f)]['stop'](),_0x1cb0d0[_0x4d69f2(0x183)]&&_0x1cb0d0[_0x4d69f2(0x183)][_0x4d69f2(0x1e8)]();}catch(_0x400d54){console['error']('[WebRTC\x20Appliance]\x20Error\x20during\x20session\x20cleanup:\x20'+_0x400d54);}this[_0x4d69f2(0x1e4)](_0x3c50aa);}[a6_0x5061c2(0x1e4)](_0x1e0b89){const _0x35d394=a6_0x5061c2,_0x184456=this['activeSessions'][_0x35d394(0x1cc)](_0x1e0b89);if(_0x184456){const _0x29eae0=this[_0x35d394(0x182)]['get'](_0x184456[_0x35d394(0x1a7)]);_0x29eae0&&(_0x29eae0[_0x35d394(0x1a3)](_0x1e0b89),_0x29eae0[_0x35d394(0x1b8)]===0x0&&this[_0x35d394(0x182)]['delete'](_0x184456[_0x35d394(0x1a7)])),this[_0x35d394(0x1d5)](_0x184456[_0x35d394(0x1a7)]);}this['activeSessions'][_0x35d394(0x1a3)](_0x1e0b89),console['log'](_0x35d394(0x1dd)+_0x1e0b89);}[a6_0x5061c2(0x185)](){const _0x1882de=a6_0x5061c2;console[_0x1882de(0x18c)](_0x1882de(0x1bc));const _0x4b55a9=Array[_0x1882de(0x1cf)](this['activeSessions'][_0x1882de(0x1f1)]());_0x4b55a9['forEach'](_0x5e5029=>this[_0x1882de(0x1c0)](_0x5e5029));}[a6_0x5061c2(0x1aa)](){const _0x28672d=a6_0x5061c2,_0x1467bd=[];for(const [_0xa27670,_0x25294d]of this[_0x28672d(0x19d)]){_0x1467bd[_0x28672d(0x1ab)]({'sessionId':_0xa27670,'topic':_0x25294d[_0x28672d(0x1a7)],'connectionState':_0x25294d[_0x28672d(0x183)]?.[_0x28672d(0x205)]||_0x28672d(0x225),'hasVideoTrack':!!_0x25294d[_0x28672d(0x16f)]});}return _0x1467bd;}['getSharedVideoSources'](){const _0x4a395a=a6_0x5061c2,_0x691d73=[];for(const [_0x1b58ad,_0x4168cf]of this[_0x4a395a(0x1b6)]){_0x691d73[_0x4a395a(0x1ab)]({'topic':_0x1b58ad,'frameCount':_0x4168cf['frameCount'],'hasVideoSource':!!_0x4168cf['videoSource'],'hasRosSubscriber':!!_0x4168cf[_0x4a395a(0x1e2)]});}return _0x691d73;}}module['exports']=new ApplianceWebRTCService();