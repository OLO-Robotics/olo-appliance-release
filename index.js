const a1_0x3d1fde=a1_0x37ad;(function(_0x1e5d57,_0x4e6cde){const _0x4e2050=a1_0x37ad,_0x1b6dc3=_0x1e5d57();while(!![]){try{const _0x1f6b9e=-parseInt(_0x4e2050(0x207))/0x1*(-parseInt(_0x4e2050(0x203))/0x2)+-parseInt(_0x4e2050(0x1e3))/0x3+parseInt(_0x4e2050(0x191))/0x4*(-parseInt(_0x4e2050(0x1c3))/0x5)+parseInt(_0x4e2050(0x22c))/0x6*(parseInt(_0x4e2050(0x18d))/0x7)+parseInt(_0x4e2050(0x197))/0x8+-parseInt(_0x4e2050(0x1c7))/0x9+parseInt(_0x4e2050(0x1f3))/0xa;if(_0x1f6b9e===_0x4e6cde)break;else _0x1b6dc3['push'](_0x1b6dc3['shift']());}catch(_0x34284d){_0x1b6dc3['push'](_0x1b6dc3['shift']());}}}(a1_0x446d,0xddacc));const a1_0x379f56=(function(){let _0x3022a7=!![];return function(_0x5e0f20,_0x422d8a){const _0x1ec5be=_0x3022a7?function(){const _0x287142=a1_0x37ad;if(_0x422d8a){const _0x55aa5c=_0x422d8a[_0x287142(0x1a5)](_0x5e0f20,arguments);return _0x422d8a=null,_0x55aa5c;}}:function(){};return _0x3022a7=![],_0x1ec5be;};}()),a1_0x1c2b2f=a1_0x379f56(this,function(){const _0x519d79=a1_0x37ad;return a1_0x1c2b2f[_0x519d79(0x184)]()[_0x519d79(0x218)](_0x519d79(0x1e6))[_0x519d79(0x184)]()[_0x519d79(0x1e9)](a1_0x1c2b2f)[_0x519d79(0x218)](_0x519d79(0x1e6));});a1_0x1c2b2f();const express=require(a1_0x3d1fde(0x236)),config=require(a1_0x3d1fde(0x1ed)),authService=require('./services/auth'),webrtcService=require(a1_0x3d1fde(0x226)),topicManager=require(a1_0x3d1fde(0x1e2)),WebSocket=require('ws'),axios=require(a1_0x3d1fde(0x180)),fs=require('fs'),prompt=require(a1_0x3d1fde(0x21f))({'sigint':!![]}),dotenv=require(a1_0x3d1fde(0x237)),app=express(),port=process[a1_0x3d1fde(0x183)][a1_0x3d1fde(0x20a)]||config[a1_0x3d1fde(0x20d)][a1_0x3d1fde(0x1c2)],APPLIANCE_FILE=a1_0x3d1fde(0x1d2),{DOMParser,XMLSerializer}=require('xmldom'),path=require(a1_0x3d1fde(0x1eb)),{execSync}=require(a1_0x3d1fde(0x18a)),APPLIANCE_BASE_URL=process[a1_0x3d1fde(0x183)][a1_0x3d1fde(0x242)]||'';function a1_0x37ad(_0x452dbe,_0x2b51ac){const _0x313685=a1_0x446d();return a1_0x37ad=function(_0x1c2b2f,_0x379f56){_0x1c2b2f=_0x1c2b2f-0x17e;let _0x446ddd=_0x313685[_0x1c2b2f];return _0x446ddd;},a1_0x37ad(_0x452dbe,_0x2b51ac);}console[a1_0x3d1fde(0x209)](a1_0x3d1fde(0x1d4)+(process[a1_0x3d1fde(0x183)][a1_0x3d1fde(0x23e)]||'development')),console[a1_0x3d1fde(0x209)](a1_0x3d1fde(0x19a)+config[a1_0x3d1fde(0x22d)]),console[a1_0x3d1fde(0x209)](a1_0x3d1fde(0x216)+config[a1_0x3d1fde(0x20d)][a1_0x3d1fde(0x188)]),console[a1_0x3d1fde(0x209)](a1_0x3d1fde(0x234)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function a1_0x446d(){const _0x426150=['robot\x20not\x20found','Attempting\x20to\x20login\x20to:','readyState','Successfully\x20registered\x20with\x20server','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','sample','endsWith','WSL\x20Appliance','slice','topic','catch','/rosapi/topics','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','parse','stopAllSessions','proxyPort','373090BwYJnX','name','code','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','9359694iEVZdq','/appliance/register','.dae','warn','Connected\x20to\x20ROSBridge\x20(WebRTC)','estimatedSize','utf8','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','response','\x20of\x20','get_urdf_param','.appliance.json','config','Environment:\x20','.obj','Authentication\x20required','String\x20value\x20is:\x20','EADDRINUSE','serializeToString','ros2\x20param\x20get\x20','package://','throttling','Failed\x20to\x20register\x20with\x20server:','/health','service_response','/ros/mesh?uri=','share','./services/TopicManager','4697073ALXcoD','roslib','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','(((.+)+)+)+$','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','Failed\x20to\x20register\x20with\x20server','constructor','unknown','path','call_service','./config','close','text/xml','get_mesh','strategies','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','27166810dUKqRt','largeDataTopics','status','base64','send','getTopicStrategy','ROSBridge\x20(main)\x20connection\x20error:','unlinkSync','isAuthenticated','length','post','data','http','development','includes','totalTopics','378WofsZS','\x20in\x20use,\x20trying\x20next\x20port...','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','getAttribute','733FLpKZf','reason','log','PORT','password','initialize','rosbridge','getSharedVideoSources','registrationToken','Registering\x20with\x20server...','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','writeFileSync','open','\x20attempts\x20starting\x20from\x20','string','ROSBridge\x20WebSocket\x20URL:\x20','samplingRate','search','existsSync','Connected\x20to\x20server','uri','sample_skip','OPEN','Failed\x20to\x20ping\x20server:','prompt-sync','Access-Control-Allow-Headers','/appliance/ping','use','Bearer\x20','Enter\x20password:\x20','listen','./services/webrtcService','OPTIONS','message','values','[URDF\x20REWRITE]\x20Rewrote\x20','APP_USERNAME','6cQWBYP','serverUrl','Successfully\x20logged\x20in','Topic\x20discovery\x20failed:','webrtc_skip','credentials','trim','Disconnected\x20from\x20server\x20(','Proxy\x20listening\x20on\x20port:\x20','toLowerCase','express','dotenv','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','error','Loaded\x20appliance\x20identity:','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','join','getToken','NODE_ENV','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','ros2\x20pkg\x20prefix\x20','request_id','APPLIANCE_BASE_URL','forward','Not\x20authenticated','[MESH]\x20Error\x20serving\x20mesh:','discoverTopics','Access-Control-Allow-Methods','handleMessage','[MESH]\x20Successfully\x20served\x20mesh:\x20','strategy','msg','axios','login','mesh_data','env','toString','setAttribute','get','readFileSync','wsEndpoint','types','child_process','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','12396356XQkdef','APP_PASSWORD','\x0aAPP_PASSWORD=','map','68qJbBYP','json','.ply','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','parseFromString','1248136ACOkCL','robotId','startsWith','Backend\x20Server\x20URL:\x20','header','APP_USERNAME=','replace','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','Failed\x20to\x20connect\x20to\x20server:','param_name','topics','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','urdf_param_data','exit','apply','.env','loadConfig','match','stringify','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','substring','Enter\x20username:\x20','getElementsByTagName','username','Appliance\x20is\x20running\x20and\x20authenticated!','filename','hide','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:'];a1_0x446d=function(){return _0x426150;};return a1_0x446d();}function updateEnvFile(_0x47c4cf,_0x10848d){const _0x3ee874=a1_0x3d1fde;fs[_0x3ee874(0x212)](_0x3ee874(0x1a6),_0x3ee874(0x19c)+_0x47c4cf+_0x3ee874(0x18f)+_0x10848d+'\x0a');}function reloadEnv(){const _0x33e043=a1_0x3d1fde;dotenv[_0x33e043(0x1d3)]({'override':!![]}),config[_0x33e043(0x231)][_0x33e043(0x1ae)]=process[_0x33e043(0x183)][_0x33e043(0x22b)],config[_0x33e043(0x231)][_0x33e043(0x20b)]=process[_0x33e043(0x183)][_0x33e043(0x18e)];}async function promptForCredentials(){const _0x5dc1ac=a1_0x3d1fde,_0x4a4d26=prompt(_0x5dc1ac(0x1ac)),_0x1cf45e=prompt[_0x5dc1ac(0x1b1)](_0x5dc1ac(0x224));updateEnvFile(_0x4a4d26,_0x1cf45e),reloadEnv();}function loadApplianceIdentity(){const _0x16269c=a1_0x3d1fde;if(fs[_0x16269c(0x219)](APPLIANCE_FILE))try{const _0x4ade1e=JSON[_0x16269c(0x1c0)](fs[_0x16269c(0x187)](APPLIANCE_FILE,_0x16269c(0x1cd)));if(_0x4ade1e[_0x16269c(0x198)]&&_0x4ade1e['registrationToken'])return robotId=_0x4ade1e[_0x16269c(0x198)],registrationToken=_0x4ade1e[_0x16269c(0x20f)],console['log'](_0x16269c(0x23a),robotId),topicManager[_0x16269c(0x1a7)](_0x4ade1e),!![];}catch(_0x149674){console[_0x16269c(0x239)](_0x16269c(0x1aa),_0x149674);}return![];}function saveApplianceIdentity(_0x723001,_0x93e7fe){const _0x107425=a1_0x3d1fde;let _0xa2d4f8={};if(fs['existsSync'](APPLIANCE_FILE))try{_0xa2d4f8=JSON['parse'](fs[_0x107425(0x187)](APPLIANCE_FILE,_0x107425(0x1cd)));}catch(_0x929339){_0xa2d4f8={};}_0xa2d4f8['robotId']=_0x723001,_0xa2d4f8[_0x107425(0x20f)]=_0x93e7fe,fs[_0x107425(0x212)](APPLIANCE_FILE,JSON[_0x107425(0x1a9)](_0xa2d4f8,null,0x2));}async function registerWithServer(){const _0x4eb27b=a1_0x3d1fde;try{const _0x2edb06=authService[_0x4eb27b(0x23d)]();if(!_0x2edb06)throw new Error(_0x4eb27b(0x244));let _0x245b63,_0x52b14e=![];while(!![]){try{robotId&&registrationToken?_0x245b63=await axios[_0x4eb27b(0x1fd)](config[_0x4eb27b(0x22d)]+'/appliance/register',{'name':_0x4eb27b(0x1ba),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x4eb27b(0x223)+_0x2edb06,'Content-Type':'application/json'}}):_0x245b63=await axios[_0x4eb27b(0x1fd)](config[_0x4eb27b(0x22d)]+_0x4eb27b(0x1c8),{'name':_0x4eb27b(0x1ba)},{'headers':{'Authorization':'Bearer\x20'+_0x2edb06,'Content-Type':'application/json'}});break;}catch(_0x36e139){const _0x3b4441=_0x36e139?.[_0x4eb27b(0x1cf)]?.[_0x4eb27b(0x1fe)]?.[_0x4eb27b(0x239)]||_0x36e139[_0x4eb27b(0x228)];if(!_0x52b14e&&_0x3b4441&&_0x3b4441[_0x4eb27b(0x235)]()[_0x4eb27b(0x201)](_0x4eb27b(0x1b3))){console[_0x4eb27b(0x1ca)](_0x4eb27b(0x211));if(fs['existsSync'](APPLIANCE_FILE))fs[_0x4eb27b(0x1fa)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x52b14e=!![];continue;}throw _0x36e139;}}if(!_0x245b63[_0x4eb27b(0x1fe)]||!_0x245b63[_0x4eb27b(0x1fe)]['registration_token']||!_0x245b63['data']['id'])throw new Error(_0x4eb27b(0x1e7));return registrationToken=_0x245b63[_0x4eb27b(0x1fe)]['registration_token'],robotId=_0x245b63[_0x4eb27b(0x1fe)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x4eb27b(0x209)](_0x4eb27b(0x1b6)),!![];}catch(_0x280813){return console[_0x4eb27b(0x239)](_0x4eb27b(0x1dd),_0x280813['message']),![];}}function rewriteUrdfMeshUris(_0x42e321){const _0xc30d9=a1_0x3d1fde;try{const _0x21b667=new DOMParser(),_0x1cd474=_0x21b667[_0xc30d9(0x196)](_0x42e321,_0xc30d9(0x1ef));let _0x1c59d2=0x0,_0x4b61d8=0x0;const _0x3e82c7=_0x1cd474[_0xc30d9(0x1ad)]('mesh');for(let _0x4bebe3=0x0;_0x4bebe3<_0x3e82c7['length'];_0x4bebe3++){const _0x445654=_0x3e82c7[_0x4bebe3],_0x1c45e9=_0x445654[_0xc30d9(0x206)](_0xc30d9(0x1b0)),_0x4ca8f3=['.stl',_0xc30d9(0x1c9),_0xc30d9(0x1d5),_0xc30d9(0x193),'.mesh'],_0x2b77c5=_0x4ca8f3['some'](_0x27f477=>_0x1c45e9['toLowerCase']()[_0xc30d9(0x1b9)](_0x27f477));if(_0x1c45e9&&_0x1c45e9[_0xc30d9(0x199)](_0xc30d9(0x1db))&&_0x2b77c5){_0x1c59d2++;const _0x1cf18b=APPLIANCE_BASE_URL+_0xc30d9(0x1e0)+encodeURIComponent(_0x1c45e9);_0x445654[_0xc30d9(0x185)](_0xc30d9(0x1b0),_0x1cf18b),_0x4b61d8++,console[_0xc30d9(0x209)](_0xc30d9(0x19e)+_0x1c45e9+'\x20->\x20'+_0x1cf18b);}}_0x1c59d2>0x0?console[_0xc30d9(0x209)](_0xc30d9(0x22a)+_0x4b61d8+_0xc30d9(0x1d0)+_0x1c59d2+'\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)'):console[_0xc30d9(0x209)](_0xc30d9(0x1a2));const _0x5dfbe0=new XMLSerializer();return _0x5dfbe0[_0xc30d9(0x1d9)](_0x1cd474);}catch(_0x2789fd){return console[_0xc30d9(0x239)](_0xc30d9(0x23f),_0x2789fd),_0x42e321;}}function connectToRosbridge(){const _0x30bdbf=a1_0x3d1fde;try{rosbridgeWs=new WebSocket(config['rosbridge'][_0x30bdbf(0x188)]),rosbridgeWs['on']('open',()=>{const _0x14ad3c=_0x30bdbf;console['log']('Connected\x20to\x20ROSBridge\x20(main)');const _0x1d4246=require(_0x14ad3c(0x1e4)),_0x369c36=new _0x1d4246['Ros']({'url':config[_0x14ad3c(0x20d)]['wsEndpoint']});_0x369c36['on']('connection',()=>{setTimeout(()=>{const _0x48e71f=a1_0x37ad;topicManager[_0x48e71f(0x246)](_0x369c36)[_0x48e71f(0x1bd)](_0x3993cf=>{const _0x2db6b1=_0x48e71f;console[_0x2db6b1(0x239)](_0x2db6b1(0x22f),_0x3993cf);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x30bdbf(0x228),_0x3692fb=>{const _0x18f30b=_0x30bdbf;if(serverWs&&serverWs[_0x18f30b(0x1b5)]===WebSocket['OPEN']){let _0x46152b=_0x3692fb['toString']();try{const _0x5e290e=JSON[_0x18f30b(0x1c0)](_0x46152b);if(_0x5e290e['op']==='publish'&&_0x5e290e[_0x18f30b(0x1bc)]){const _0x2a2b35=topicManager[_0x18f30b(0x248)](_0x5e290e);switch(_0x2a2b35['action']){case _0x18f30b(0x21c):return;case _0x18f30b(0x230):return;case _0x18f30b(0x243):default:_0x46152b=JSON[_0x18f30b(0x1a9)](_0x2a2b35[_0x18f30b(0x228)]);break;}}if((_0x5e290e['op']===_0x18f30b(0x1df)||_0x5e290e['op']===_0x18f30b(0x1ec))&&(_0x5e290e['service']===_0x18f30b(0x1be)||_0x5e290e[_0x18f30b(0x229)]&&_0x5e290e[_0x18f30b(0x229)][_0x18f30b(0x1a1)])){console[_0x18f30b(0x209)](_0x18f30b(0x18b));const _0xa5a0af=_0x5e290e[_0x18f30b(0x229)]?.[_0x18f30b(0x1a1)]||[],_0x467fd6=_0x5e290e[_0x18f30b(0x229)]?.[_0x18f30b(0x189)]||[],_0x194add=_0xa5a0af[_0x18f30b(0x190)]((_0x517215,_0x5a0969)=>{const _0xab0c01=_0x18f30b,_0x13a516=topicManager[_0xab0c01(0x1f8)](_0x517215);return{'name':_0x517215,'type':_0x467fd6[_0x5a0969]||_0xab0c01(0x1ea),'throttling':_0x13a516?{'isThrottled':_0x13a516[_0xab0c01(0x17e)]===_0xab0c01(0x1b8),'strategy':_0x13a516[_0xab0c01(0x17e)],'samplingRate':_0x13a516[_0xab0c01(0x217)],'reason':_0x13a516[_0xab0c01(0x208)],'estimatedSize':_0x13a516[_0xab0c01(0x1cc)]}:null};});_0x5e290e[_0x18f30b(0x229)]={'topics':_0x194add[_0x18f30b(0x190)](_0x2df8ae=>_0x2df8ae[_0x18f30b(0x1c4)]),'types':_0x194add['map'](_0x37a73e=>_0x37a73e['type']),'throttling':_0x194add[_0x18f30b(0x190)](_0x219303=>_0x219303[_0x18f30b(0x1dc)])},_0x46152b=JSON[_0x18f30b(0x1a9)](_0x5e290e),console[_0x18f30b(0x209)](_0x18f30b(0x195));}if(_0x5e290e['op']==='publish'&&_0x5e290e['topic']==='/robot_description')try{const _0x420289=_0x5e290e[_0x18f30b(0x17f)][_0x18f30b(0x1fe)],_0x110c06=rewriteUrdfMeshUris(_0x420289);_0x5e290e['msg'][_0x18f30b(0x1fe)]=_0x110c06,_0x46152b=JSON[_0x18f30b(0x1a9)](_0x5e290e);}catch(_0xc73545){console[_0x18f30b(0x239)](_0x18f30b(0x1b2),_0xc73545);}}catch(_0x40a82f){console['warn'](_0x18f30b(0x194),_0x40a82f[_0x18f30b(0x228)]);}serverWs[_0x18f30b(0x1f7)](_0x46152b);}}),rosbridgeWs['on'](_0x30bdbf(0x1ee),()=>{const _0x3e5ca9=_0x30bdbf;console['log']('Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x3e5ca9(0x1c1)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x30bdbf(0x239),_0x11fce5=>{const _0x6c0264=_0x30bdbf;console[_0x6c0264(0x239)](_0x6c0264(0x1f9),_0x11fce5);});}catch(_0x3bc9f7){console[_0x30bdbf(0x239)](_0x30bdbf(0x205),_0x3bc9f7),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x2a5cdb=a1_0x3d1fde;try{rosbridgeWebRTCWs=new WebSocket(config[_0x2a5cdb(0x20d)][_0x2a5cdb(0x188)]),rosbridgeWebRTCWs['on'](_0x2a5cdb(0x213),()=>{const _0x1ec0b4=_0x2a5cdb;console[_0x1ec0b4(0x209)](_0x1ec0b4(0x1cb)),webrtcService[_0x1ec0b4(0x20c)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x2a5cdb(0x228),_0x4b954e=>{}),rosbridgeWebRTCWs['on'](_0x2a5cdb(0x1ee),()=>{const _0x24c5b8=_0x2a5cdb;console[_0x24c5b8(0x209)](_0x24c5b8(0x18c)),webrtcService['stopAllSessions'](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x2a5cdb(0x239),_0x3a1d35=>{const _0x360663=_0x2a5cdb;console[_0x360663(0x239)]('ROSBridge\x20(WebRTC)\x20connection\x20error:',_0x3a1d35);});}catch(_0x463ca7){console[_0x2a5cdb(0x239)](_0x2a5cdb(0x1c6),_0x463ca7),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x551dbe=a1_0x3d1fde;try{if(!registrationToken)throw new Error(_0x551dbe(0x23b));const _0x36df38=config[_0x551dbe(0x22d)][_0x551dbe(0x19d)](_0x551dbe(0x1ff),'ws')+'/rosbridge?type=appliance&token='+registrationToken;serverWs=new WebSocket(_0x36df38),serverWs['on'](_0x551dbe(0x213),()=>{const _0x2544bf=_0x551dbe;console[_0x2544bf(0x209)](_0x2544bf(0x21a)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x2544bf(0x1b5)]===WebSocket[_0x2544bf(0x21d)]&&webrtcService[_0x2544bf(0x20c)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x551dbe(0x228),_0x323da3=>{const _0x393fb7=_0x551dbe;if(rosbridgeWs&&rosbridgeWs['readyState']===WebSocket['OPEN']){let _0x1ecd9e=_0x323da3[_0x393fb7(0x184)]();try{const _0xa9907=JSON[_0x393fb7(0x1c0)](_0x1ecd9e);if(webrtcService[_0x393fb7(0x248)](_0xa9907))return;if(_0xa9907['op']===_0x393fb7(0x1d1)&&typeof _0xa9907['param_name']===_0x393fb7(0x215)&&_0xa9907['request_id'])try{console[_0x393fb7(0x209)]('[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20'+_0xa9907[_0x393fb7(0x1a0)]);const _0x609381=execSync(_0x393fb7(0x1da)+_0xa9907[_0x393fb7(0x1a0)],{'encoding':'utf8'})['trim']();let _0x2efded=_0x609381;_0x609381['startsWith']('String\x20value\x20is:\x20')&&(_0x2efded=_0x609381[_0x393fb7(0x1ab)](_0x393fb7(0x1d7)[_0x393fb7(0x1fc)]()));_0x2efded[_0x393fb7(0x199)]('\x22')&&_0x2efded[_0x393fb7(0x1b9)]('\x22')&&(_0x2efded=_0x2efded[_0x393fb7(0x1bb)](0x1,-0x1));_0x2efded=_0x2efded[_0x393fb7(0x19d)](/\\n/g,'\x0a')[_0x393fb7(0x19d)](/\\"/g,'\x22');const _0x5c917b={'op':_0x393fb7(0x1a3),'request_id':_0xa9907[_0x393fb7(0x241)],'data':_0x2efded};serverWs[_0x393fb7(0x1f7)](JSON['stringify'](_0x5c917b)),console[_0x393fb7(0x209)](_0x393fb7(0x1ce)+_0xa9907[_0x393fb7(0x1a0)]);return;}catch(_0x9c7194){console[_0x393fb7(0x239)](_0x393fb7(0x1f2),_0x9c7194);const _0x31f83f={'op':_0x393fb7(0x1a3),'request_id':_0xa9907['request_id'],'error':_0x9c7194[_0x393fb7(0x228)]};serverWs['send'](JSON[_0x393fb7(0x1a9)](_0x31f83f));return;}if(_0xa9907['op']===_0x393fb7(0x1f0)&&typeof _0xa9907[_0x393fb7(0x21b)]===_0x393fb7(0x215)&&_0xa9907[_0x393fb7(0x241)])try{const _0x29e81d=_0xa9907[_0x393fb7(0x21b)][_0x393fb7(0x1a8)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x29e81d){const _0xbb5ef2=_0x29e81d[0x1],_0x3eedfe=_0x29e81d[0x2],_0x37b680=execSync(_0x393fb7(0x240)+_0xbb5ef2,{'encoding':'utf8'})[_0x393fb7(0x232)](),_0x934d24=path[_0x393fb7(0x23c)](_0x37b680,_0x393fb7(0x1e1),_0xbb5ef2,_0x3eedfe);if(!fs['existsSync'](_0x934d24))throw new Error('Mesh\x20file\x20not\x20found:\x20'+_0x934d24);const _0x11b62d=fs[_0x393fb7(0x187)](_0x934d24),_0x1357de={'op':_0x393fb7(0x182),'request_id':_0xa9907[_0x393fb7(0x241)],'data':_0x11b62d[_0x393fb7(0x184)](_0x393fb7(0x1f6))};serverWs[_0x393fb7(0x1f7)](JSON[_0x393fb7(0x1a9)](_0x1357de)),console[_0x393fb7(0x209)](_0x393fb7(0x249)+_0xa9907['uri']+'\x20from\x20'+_0x934d24);return;}}catch(_0x15c552){console[_0x393fb7(0x239)](_0x393fb7(0x245),_0x15c552);const _0x2da43a={'op':_0x393fb7(0x182),'request_id':_0xa9907[_0x393fb7(0x241)],'error':_0x15c552['message']};serverWs[_0x393fb7(0x1f7)](JSON[_0x393fb7(0x1a9)](_0x2da43a));return;}rosbridgeWs['send'](_0x1ecd9e);}catch(_0x88d557){rosbridgeWs[_0x393fb7(0x1f7)](_0x1ecd9e);}}}),serverWs['on'](_0x551dbe(0x1ee),(_0x31248d,_0x5df634)=>{const _0xefbf4a=_0x551dbe;console[_0xefbf4a(0x209)](_0xefbf4a(0x233)+_0x31248d+':\x20'+_0x5df634+'),\x20attempting\x20to\x20reconnect...'),webrtcService['stopAllSessions'](),setTimeout(connectToServer,0x1388);}),serverWs['on']('error',_0x359e90=>{const _0x26c180=_0x551dbe;console[_0x26c180(0x239)]('Server\x20connection\x20error:',_0x359e90);});}catch(_0x295b05){console[_0x551dbe(0x239)](_0x551dbe(0x19f),_0x295b05),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x4e121d,_0xbabcbe,_0x36b354)=>{const _0x3c868f=a1_0x3d1fde;if(!authService[_0x3c868f(0x1fb)]()){console[_0x3c868f(0x209)](_0x3c868f(0x1b4),config[_0x3c868f(0x22d)]);const _0xb8cca4=await authService[_0x3c868f(0x181)]();if(!_0xb8cca4)return _0xbabcbe[_0x3c868f(0x1f5)](0x191)[_0x3c868f(0x192)]({'error':_0x3c868f(0x1d6)});}_0x36b354();};app[a1_0x3d1fde(0x222)]((_0x2f09a7,_0x3f917a,_0x265b13)=>{const _0x52e643=a1_0x3d1fde;_0x3f917a['header']('Access-Control-Allow-Origin','*'),_0x3f917a['header'](_0x52e643(0x247),'GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS'),_0x3f917a[_0x52e643(0x19b)](_0x52e643(0x220),'Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization'),_0x2f09a7['method']===_0x52e643(0x227)?_0x3f917a['sendStatus'](0xc8):_0x265b13();}),app[a1_0x3d1fde(0x186)]('/',requireAuth,(_0x3434d4,_0x34e777)=>{const _0x2d3cfb=a1_0x3d1fde;_0x34e777['send'](_0x2d3cfb(0x1af));}),app[a1_0x3d1fde(0x186)](a1_0x3d1fde(0x1de),async(_0x3e7c1c,_0x41da91)=>{const _0xd9f815=a1_0x3d1fde,_0x36e903=authService[_0xd9f815(0x1fb)](),_0x4244b5=webrtcService['getActiveSessions'](),_0x7b155d=webrtcService[_0xd9f815(0x20e)](),_0x6d4572=topicManager['getStatistics']();_0x41da91[_0xd9f815(0x192)]({'status':'ok','environment':process[_0xd9f815(0x183)][_0xd9f815(0x23e)]||_0xd9f815(0x200),'backendUrl':config[_0xd9f815(0x22d)],'rosbridgeUrl':config['rosbridge'][_0xd9f815(0x188)],'proxyPort':port,'authenticated':_0x36e903,'topicManagement':{'discovered':_0x6d4572[_0xd9f815(0x202)],'strategies':_0x6d4572[_0xd9f815(0x1f1)],'largeDataTopics':_0x6d4572[_0xd9f815(0x1f4)]['length'],'largeTopicsList':_0x6d4572[_0xd9f815(0x1f4)]},'webrtc':{'activeSessions':_0x4244b5['length'],'sharedVideoSources':_0x7b155d[_0xd9f815(0x1fc)],'sessions':_0x4244b5,'sharedSources':_0x7b155d}});});const getInitialPort=()=>{const _0x2943ea=a1_0x3d1fde;if(process[_0x2943ea(0x183)]['PORT'])return parseInt(process[_0x2943ea(0x183)][_0x2943ea(0x20a)],0xa);return config['rosbridge'][_0x2943ea(0x1c2)];};async function listenWithRetries(_0x4ab9c6,_0x298de0,_0x4d22e5=0xa){const _0x3c245d=a1_0x3d1fde;let _0x37db03=_0x298de0;for(let _0x15cfe5=0x1;_0x15cfe5<=_0x4d22e5;_0x15cfe5++){try{return await new Promise((_0x18adfb,_0x5e2ae8)=>{const _0x5ec96d=a1_0x37ad,_0x4bc237=_0x4ab9c6[_0x5ec96d(0x225)](_0x37db03,()=>{const _0x4941c1=_0x5ec96d;console[_0x4941c1(0x209)](_0x4941c1(0x1b7)+_0x37db03),_0x18adfb(_0x4bc237);});_0x4bc237['on'](_0x5ec96d(0x239),_0x3ee431=>{const _0x1560f6=_0x5ec96d;_0x3ee431[_0x1560f6(0x1c5)]===_0x1560f6(0x1d8)?(console[_0x1560f6(0x1ca)]('Port\x20'+_0x37db03+_0x1560f6(0x204)),_0x5e2ae8(_0x3ee431)):_0x5e2ae8(_0x3ee431);});}),_0x37db03;}catch(_0x502377){_0x37db03++;}}throw new Error(_0x3c245d(0x1e5)+_0x4d22e5+_0x3c245d(0x214)+_0x298de0);}const startApp=async()=>{const _0x1f0952=a1_0x3d1fde;try{let _0x536bc5=await authService['login']();while(!_0x536bc5){console['log'](_0x1f0952(0x238)),await promptForCredentials(),_0x536bc5=await authService['login']();}console['log'](_0x1f0952(0x22e));!loadApplianceIdentity()&&console[_0x1f0952(0x209)](_0x1f0952(0x1bf));console[_0x1f0952(0x209)](_0x1f0952(0x210));const _0xf15167=await registerWithServer();if(!_0xf15167)throw new Error(_0x1f0952(0x1e8));connectToRosbridge(),connectToServer();const _0x29f8f2=getInitialPort();await listenWithRetries(app,_0x29f8f2,0xa);}catch(_0x250084){console[_0x1f0952(0x239)]('Failed\x20to\x20start\x20application:',_0x250084),process[_0x1f0952(0x1a4)](0x1);}};setInterval(async()=>{const _0x48c098=a1_0x3d1fde;try{if(robotId){const _0x349590=authService[_0x48c098(0x23d)]();await axios[_0x48c098(0x1fd)](config['serverUrl']+_0x48c098(0x221),{'robotId':robotId},{'headers':{'Authorization':'Bearer\x20'+_0x349590,'Content-Type':'application/json'}});}}catch(_0x28ee9c){console[_0x48c098(0x239)](_0x48c098(0x21e),_0x28ee9c[_0x48c098(0x228)]);}},0x1388),startApp();