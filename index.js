const a1_0x496e3d=a1_0xe6f9;(function(_0xe527d8,_0x149e68){const _0x40b55a=a1_0xe6f9,_0x2262f9=_0xe527d8();while(!![]){try{const _0x2cbec5=parseInt(_0x40b55a(0x210))/0x1*(-parseInt(_0x40b55a(0x236))/0x2)+-parseInt(_0x40b55a(0x1ab))/0x3+-parseInt(_0x40b55a(0x1d1))/0x4*(-parseInt(_0x40b55a(0x1e1))/0x5)+-parseInt(_0x40b55a(0x1fa))/0x6+parseInt(_0x40b55a(0x1d7))/0x7*(parseInt(_0x40b55a(0x23a))/0x8)+parseInt(_0x40b55a(0x216))/0x9+-parseInt(_0x40b55a(0x252))/0xa;if(_0x2cbec5===_0x149e68)break;else _0x2262f9['push'](_0x2262f9['shift']());}catch(_0x32dc42){_0x2262f9['push'](_0x2262f9['shift']());}}}(a1_0xb3cb,0x2ad59));const a1_0x32c389=(function(){let _0x20d16a=!![];return function(_0x2c814e,_0x2ed5ba){const _0x1ac851=_0x20d16a?function(){const _0x134c1b=a1_0xe6f9;if(_0x2ed5ba){const _0x4f6d46=_0x2ed5ba[_0x134c1b(0x231)](_0x2c814e,arguments);return _0x2ed5ba=null,_0x4f6d46;}}:function(){};return _0x20d16a=![],_0x1ac851;};}()),a1_0x162c8a=a1_0x32c389(this,function(){const _0x124189=a1_0xe6f9;return a1_0x162c8a['toString']()[_0x124189(0x233)]('(((.+)+)+)+$')[_0x124189(0x1d2)]()[_0x124189(0x263)](a1_0x162c8a)[_0x124189(0x233)](_0x124189(0x200));});a1_0x162c8a();const express=require('express'),config=require(a1_0x496e3d(0x253)),authService=require(a1_0x496e3d(0x1df)),webrtcService=require(a1_0x496e3d(0x1f9)),topicManager=require(a1_0x496e3d(0x227)),WebSocket=require('ws'),axios=require('axios'),fs=require('fs'),prompt=require(a1_0x496e3d(0x1a8))({'sigint':!![]}),dotenv=require(a1_0x496e3d(0x1c1)),app=express(),port=process[a1_0x496e3d(0x1bf)]['PORT']||config[a1_0x496e3d(0x226)]['proxyPort'],APPLIANCE_FILE=a1_0x496e3d(0x250),{DOMParser,XMLSerializer}=require(a1_0x496e3d(0x1dd)),path=require(a1_0x496e3d(0x265)),{execSync}=require('child_process'),APPLIANCE_BASE_URL=process[a1_0x496e3d(0x1bf)][a1_0x496e3d(0x1b3)]||'';console[a1_0x496e3d(0x229)](a1_0x496e3d(0x1ea)+(process['env'][a1_0x496e3d(0x1ef)]||a1_0x496e3d(0x1b7))),console[a1_0x496e3d(0x229)]('Backend\x20Server\x20URL:\x20'+config[a1_0x496e3d(0x21e)]),console[a1_0x496e3d(0x229)](a1_0x496e3d(0x255)+config['rosbridge'][a1_0x496e3d(0x1c3)]),console[a1_0x496e3d(0x229)]('Proxy\x20listening\x20on\x20port:\x20'+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x152aaf,_0x1ba3d7){const _0x23e11d=a1_0x496e3d;fs[_0x23e11d(0x1a2)](_0x23e11d(0x214),'APP_USERNAME='+_0x152aaf+'\x0aAPP_PASSWORD='+_0x1ba3d7+'\x0a');}function reloadEnv(){const _0x367935=a1_0x496e3d;dotenv[_0x367935(0x228)]({'override':!![]}),config[_0x367935(0x1f2)][_0x367935(0x20d)]=process[_0x367935(0x1bf)][_0x367935(0x1cb)],config['credentials'][_0x367935(0x1fd)]=process[_0x367935(0x1bf)][_0x367935(0x1e7)];}async function promptForCredentials(){const _0x52efad=a1_0x496e3d,_0x119cad=prompt('Enter\x20username:\x20'),_0x5b0e8b=prompt[_0x52efad(0x1e2)]('Enter\x20password:\x20');updateEnvFile(_0x119cad,_0x5b0e8b),reloadEnv();}function loadApplianceIdentity(){const _0x4999ec=a1_0x496e3d;if(fs[_0x4999ec(0x23c)](APPLIANCE_FILE))try{const _0x4f13c9=JSON[_0x4999ec(0x1e0)](fs['readFileSync'](APPLIANCE_FILE,_0x4999ec(0x1ec)));if(_0x4f13c9[_0x4999ec(0x1fe)]&&_0x4f13c9['registrationToken'])return robotId=_0x4f13c9[_0x4999ec(0x1fe)],registrationToken=_0x4f13c9[_0x4999ec(0x19f)],console[_0x4999ec(0x229)](_0x4999ec(0x22b),robotId),topicManager[_0x4999ec(0x23e)](_0x4f13c9),!![];}catch(_0x421ef1){console[_0x4999ec(0x215)](_0x4999ec(0x24a),_0x421ef1);}return![];}function saveApplianceIdentity(_0x56c2a,_0x531f84){const _0x44e131=a1_0x496e3d;let _0x53fbed={};if(fs[_0x44e131(0x23c)](APPLIANCE_FILE))try{_0x53fbed=JSON['parse'](fs[_0x44e131(0x1b4)](APPLIANCE_FILE,_0x44e131(0x1ec)));}catch(_0x38932c){_0x53fbed={};}_0x53fbed[_0x44e131(0x1fe)]=_0x56c2a,_0x53fbed['registrationToken']=_0x531f84,fs[_0x44e131(0x1a2)](APPLIANCE_FILE,JSON[_0x44e131(0x1c7)](_0x53fbed,null,0x2));}async function registerWithServer(){const _0x44e2cd=a1_0x496e3d;try{const _0x770ca5=authService[_0x44e2cd(0x1ca)]();if(!_0x770ca5)throw new Error(_0x44e2cd(0x243));let _0x6f7263,_0x47d486=![];while(!![]){try{robotId&&registrationToken?_0x6f7263=await axios[_0x44e2cd(0x1ad)](config['serverUrl']+_0x44e2cd(0x20c),{'name':_0x44e2cd(0x1fb),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x44e2cd(0x21c)+_0x770ca5,'Content-Type':_0x44e2cd(0x1de)}}):_0x6f7263=await axios[_0x44e2cd(0x1ad)](config[_0x44e2cd(0x21e)]+'/appliance/register',{'name':_0x44e2cd(0x1fb)},{'headers':{'Authorization':_0x44e2cd(0x21c)+_0x770ca5,'Content-Type':_0x44e2cd(0x1de)}});break;}catch(_0x40f657){const _0x1eafa5=_0x40f657?.[_0x44e2cd(0x1aa)]?.['data']?.[_0x44e2cd(0x215)]||_0x40f657[_0x44e2cd(0x242)];if(!_0x47d486&&_0x1eafa5&&_0x1eafa5[_0x44e2cd(0x1f6)]()['includes'](_0x44e2cd(0x256))){console[_0x44e2cd(0x225)](_0x44e2cd(0x20b));if(fs[_0x44e2cd(0x23c)](APPLIANCE_FILE))fs[_0x44e2cd(0x25a)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x47d486=!![];continue;}throw _0x40f657;}}if(!_0x6f7263[_0x44e2cd(0x248)]||!_0x6f7263[_0x44e2cd(0x248)][_0x44e2cd(0x234)]||!_0x6f7263[_0x44e2cd(0x248)]['id'])throw new Error(_0x44e2cd(0x235));return registrationToken=_0x6f7263[_0x44e2cd(0x248)][_0x44e2cd(0x234)],robotId=_0x6f7263[_0x44e2cd(0x248)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x44e2cd(0x229)](_0x44e2cd(0x1a3)),!![];}catch(_0x19efad){return console[_0x44e2cd(0x215)](_0x44e2cd(0x1d4),_0x19efad['message']),![];}}function rewriteUrdfMeshUris(_0x55940c){const _0x10d7d8=a1_0x496e3d;try{const _0x5bc6e3=new DOMParser(),_0x20674a=_0x5bc6e3[_0x10d7d8(0x1cc)](_0x55940c,_0x10d7d8(0x1d0));let _0x7817c0=0x0,_0x53677a=0x0;const _0x5134e4=_0x20674a[_0x10d7d8(0x1fc)](_0x10d7d8(0x21f));for(let _0x3145aa=0x0;_0x3145aa<_0x5134e4[_0x10d7d8(0x24d)];_0x3145aa++){const _0x56198f=_0x5134e4[_0x3145aa],_0x6de3f1=_0x56198f[_0x10d7d8(0x1e5)]('filename'),_0x51652d=[_0x10d7d8(0x1c4),'.dae','.obj',_0x10d7d8(0x1ac),_0x10d7d8(0x24b)],_0x4abd19=_0x51652d[_0x10d7d8(0x20a)](_0x610f86=>_0x6de3f1[_0x10d7d8(0x1f6)]()[_0x10d7d8(0x1b9)](_0x610f86));if(_0x6de3f1&&_0x6de3f1['startsWith'](_0x10d7d8(0x221))&&_0x4abd19){_0x7817c0++;const _0x17f7f6=APPLIANCE_BASE_URL+_0x10d7d8(0x24f)+encodeURIComponent(_0x6de3f1);_0x56198f['setAttribute'](_0x10d7d8(0x230),_0x17f7f6),_0x53677a++,console[_0x10d7d8(0x229)]('[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20'+_0x6de3f1+_0x10d7d8(0x232)+_0x17f7f6);}}_0x7817c0>0x0?console[_0x10d7d8(0x229)](_0x10d7d8(0x1cf)+_0x53677a+'\x20of\x20'+_0x7817c0+_0x10d7d8(0x1a0)):console['log'](_0x10d7d8(0x1dc));const _0x36b0be=new XMLSerializer();return _0x36b0be[_0x10d7d8(0x1c8)](_0x20674a);}catch(_0x526b80){return console[_0x10d7d8(0x215)](_0x10d7d8(0x1bb),_0x526b80),_0x55940c;}}function a1_0xb3cb(){const _0x6371d5=['Bearer\x20','String\x20value\x20is:\x20','serverUrl','mesh','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','package://','Port\x20','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','uri','warn','rosbridge','./services/TopicManager','config','log','largeDataTopics','Loaded\x20appliance\x20identity:','Access-Control-Allow-Origin','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','name','/robot_description','filename','apply','\x20->\x20','search','registration_token','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','2xiOqgf','Connected\x20to\x20ROSBridge\x20(WebRTC)','sample','http','8fPhSDq','isAuthenticated','existsSync','Topic\x20discovery\x20failed:','loadConfig','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','message','Not\x20authenticated','totalTopics','/appliance/ping','Disconnected\x20from\x20server\x20(','json','data','/rosbridge?type=appliance&token=','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','.mesh','msg','length','discoverTopics','/ros/mesh?uri=','.appliance.json','proxyPort','1804750Xmpniw','./config','Connected\x20to\x20ROSBridge\x20(main)','ROSBridge\x20WebSocket\x20URL:\x20','robot\x20not\x20found','[MESH]\x20Successfully\x20served\x20mesh:\x20','close','strategies','unlinkSync','substring','send','sample_skip','map','Attempting\x20to\x20login\x20to:','Failed\x20to\x20register\x20with\x20server','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','constructor','match','path','initialize','registrationToken','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','estimatedSize','writeFileSync','Successfully\x20registered\x20with\x20server','getTopicStrategy','\x20in\x20use,\x20trying\x20next\x20port...','types','publish','prompt-sync','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','response','238317hvkWUD','.ply','post','urdf_param_data','catch','Ros','OPTIONS','Access-Control-Allow-Headers','APPLIANCE_BASE_URL','readFileSync','strategy','stopAllSessions','development','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','endsWith','samplingRate','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','Server\x20connection\x20error:','trim','share','env','base64','dotenv','login','wsEndpoint','.stl','topics','Successfully\x20logged\x20in','stringify','serializeToString','param_name','getToken','APP_USERNAME','parseFromString','getSharedVideoSources','replace','[URDF\x20REWRITE]\x20Rewrote\x20','text/xml','8016mWRiwr','toString','string','Failed\x20to\x20register\x20with\x20server:','exit','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','1029021iCSIlZ','get_mesh','forward','Failed\x20to\x20ping\x20server:','get','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','xmldom','application/json','./services/auth','parse','690UjIjQr','hide','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','ROSBridge\x20(main)\x20connection\x20error:','getAttribute','mesh_data','APP_PASSWORD','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','EADDRINUSE','Environment:\x20','getStatistics','utf8','\x20from\x20','readyState','NODE_ENV','request_id','slice','credentials','throttling','roslib','OPEN','toLowerCase','Failed\x20to\x20connect\x20to\x20server:','unknown','./services/webrtcService','33354APXlsv','WSL\x20Appliance','getElementsByTagName','password','robotId','PORT','(((.+)+)+)+$','/rosapi/topics','connection','Authentication\x20required','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','header','),\x20attempting\x20to\x20reconnect...','open','getActiveSessions','use','some','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','/appliance/register','username','startsWith','topic','83467HNOXsN','listen','values','ROSBridge\x20(WebRTC)\x20connection\x20error:','.env','error','907506eMqxGc','Registering\x20with\x20server...','call_service','ros2\x20pkg\x20prefix\x20','handleMessage','type'];a1_0xb3cb=function(){return _0x6371d5;};return a1_0xb3cb();}function connectToRosbridge(){const _0x4728c5=a1_0x496e3d;try{rosbridgeWs=new WebSocket(config[_0x4728c5(0x226)]['wsEndpoint']),rosbridgeWs['on'](_0x4728c5(0x207),()=>{const _0x3d072c=_0x4728c5;console[_0x3d072c(0x229)](_0x3d072c(0x254));const _0x2da53e=require(_0x3d072c(0x1f4)),_0xddd423=new _0x2da53e[(_0x3d072c(0x1b0))]({'url':config['rosbridge'][_0x3d072c(0x1c3)]});_0xddd423['on'](_0x3d072c(0x202),()=>{setTimeout(()=>{const _0x379866=a1_0xe6f9;topicManager[_0x379866(0x24e)](_0xddd423)[_0x379866(0x1af)](_0x22bff5=>{const _0x5e1b68=_0x379866;console['error'](_0x5e1b68(0x23d),_0x22bff5);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x4728c5(0x242),_0x13755e=>{const _0x3efb32=_0x4728c5;if(serverWs&&serverWs[_0x3efb32(0x1ee)]===WebSocket[_0x3efb32(0x1f5)]){let _0x4680ae=_0x13755e[_0x3efb32(0x1d2)]();try{const _0x4c4223=JSON[_0x3efb32(0x1e0)](_0x4680ae);if(_0x4c4223['op']===_0x3efb32(0x1a7)&&_0x4c4223[_0x3efb32(0x20f)]){const _0x4b099f=topicManager[_0x3efb32(0x21a)](_0x4c4223);switch(_0x4b099f['action']){case _0x3efb32(0x25d):return;case'webrtc_skip':return;case _0x3efb32(0x1d9):default:_0x4680ae=JSON['stringify'](_0x4b099f['message']);break;}}if((_0x4c4223['op']==='service_response'||_0x4c4223['op']===_0x3efb32(0x218))&&(_0x4c4223['service']===_0x3efb32(0x201)||_0x4c4223[_0x3efb32(0x212)]&&_0x4c4223[_0x3efb32(0x212)][_0x3efb32(0x1c5)])){console[_0x3efb32(0x229)](_0x3efb32(0x261));const _0x56a9a2=_0x4c4223['values']?.[_0x3efb32(0x1c5)]||[],_0x2a3374=_0x4c4223[_0x3efb32(0x212)]?.[_0x3efb32(0x1a6)]||[],_0x5785a4=_0x56a9a2['map']((_0x33d58a,_0x28a003)=>{const _0xed752c=_0x3efb32,_0x507dd4=topicManager[_0xed752c(0x1a4)](_0x33d58a);return{'name':_0x33d58a,'type':_0x2a3374[_0x28a003]||_0xed752c(0x1f8),'throttling':_0x507dd4?{'isThrottled':_0x507dd4[_0xed752c(0x1b5)]===_0xed752c(0x238),'strategy':_0x507dd4[_0xed752c(0x1b5)],'samplingRate':_0x507dd4[_0xed752c(0x1ba)],'reason':_0x507dd4['reason'],'estimatedSize':_0x507dd4[_0xed752c(0x1a1)]}:null};});_0x4c4223['values']={'topics':_0x5785a4[_0x3efb32(0x25e)](_0x226c7a=>_0x226c7a[_0x3efb32(0x22e)]),'types':_0x5785a4[_0x3efb32(0x25e)](_0x49e42f=>_0x49e42f[_0x3efb32(0x21b)]),'throttling':_0x5785a4['map'](_0x2e4a0f=>_0x2e4a0f[_0x3efb32(0x1f3)])},_0x4680ae=JSON[_0x3efb32(0x1c7)](_0x4c4223),console['log'](_0x3efb32(0x241));}if(_0x4c4223['op']===_0x3efb32(0x1a7)&&_0x4c4223[_0x3efb32(0x20f)]===_0x3efb32(0x22f))try{const _0x46fab1=_0x4c4223[_0x3efb32(0x24c)][_0x3efb32(0x248)],_0x1ba147=rewriteUrdfMeshUris(_0x46fab1);_0x4c4223[_0x3efb32(0x24c)][_0x3efb32(0x248)]=_0x1ba147,_0x4680ae=JSON['stringify'](_0x4c4223);}catch(_0x8ca375){console[_0x3efb32(0x215)]('[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:',_0x8ca375);}}catch(_0x42dabe){console[_0x3efb32(0x225)](_0x3efb32(0x1e3),_0x42dabe[_0x3efb32(0x242)]);}serverWs[_0x3efb32(0x25c)](_0x4680ae);}}),rosbridgeWs['on'](_0x4728c5(0x258),()=>{const _0x3ce959=_0x4728c5;console[_0x3ce959(0x229)](_0x3ce959(0x22d)),webrtcService[_0x3ce959(0x1b6)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x4728c5(0x215),_0x5e5c8b=>{const _0x4ad7b7=_0x4728c5;console['error'](_0x4ad7b7(0x1e4),_0x5e5c8b);});}catch(_0x5ec416){console[_0x4728c5(0x215)](_0x4728c5(0x1a9),_0x5ec416),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0xa88b83=a1_0x496e3d;try{rosbridgeWebRTCWs=new WebSocket(config['rosbridge'][_0xa88b83(0x1c3)]),rosbridgeWebRTCWs['on'](_0xa88b83(0x207),()=>{const _0x2d80d9=_0xa88b83;console['log'](_0x2d80d9(0x237)),webrtcService[_0x2d80d9(0x19e)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0xa88b83(0x242),_0x2bf0b0=>{}),rosbridgeWebRTCWs['on'](_0xa88b83(0x258),()=>{const _0x4edf21=_0xa88b83;console['log'](_0x4edf21(0x23f)),webrtcService[_0x4edf21(0x1b6)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0xa88b83(0x215),_0x1993f1=>{const _0x57c96e=_0xa88b83;console[_0x57c96e(0x215)](_0x57c96e(0x213),_0x1993f1);});}catch(_0x2df44f){console[_0xa88b83(0x215)]('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):',_0x2df44f),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x154794=a1_0x496e3d;try{if(!registrationToken)throw new Error('Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.');const _0x5ebdfb=config['serverUrl'][_0x154794(0x1ce)](_0x154794(0x239),'ws')+_0x154794(0x249)+registrationToken;serverWs=new WebSocket(_0x5ebdfb),serverWs['on'](_0x154794(0x207),()=>{const _0x3add12=_0x154794;console[_0x3add12(0x229)]('Connected\x20to\x20server'),rosbridgeWebRTCWs&&rosbridgeWebRTCWs['readyState']===WebSocket[_0x3add12(0x1f5)]&&webrtcService[_0x3add12(0x19e)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x154794(0x242),_0x4bb54a=>{const _0x18af50=_0x154794;if(rosbridgeWs&&rosbridgeWs['readyState']===WebSocket['OPEN']){let _0x2f4069=_0x4bb54a[_0x18af50(0x1d2)]();try{const _0x432e75=JSON[_0x18af50(0x1e0)](_0x2f4069);if(webrtcService[_0x18af50(0x21a)](_0x432e75))return;if(_0x432e75['op']==='get_urdf_param'&&typeof _0x432e75['param_name']===_0x18af50(0x1d3)&&_0x432e75[_0x18af50(0x1f0)])try{console[_0x18af50(0x229)](_0x18af50(0x204)+_0x432e75[_0x18af50(0x1c9)]);const _0x13fdb0=execSync('ros2\x20param\x20get\x20'+_0x432e75[_0x18af50(0x1c9)],{'encoding':'utf8'})[_0x18af50(0x1bd)]();let _0x29dca5=_0x13fdb0;_0x13fdb0['startsWith'](_0x18af50(0x21d))&&(_0x29dca5=_0x13fdb0[_0x18af50(0x25b)]('String\x20value\x20is:\x20'[_0x18af50(0x24d)]()));_0x29dca5[_0x18af50(0x20e)]('\x22')&&_0x29dca5[_0x18af50(0x1b9)]('\x22')&&(_0x29dca5=_0x29dca5[_0x18af50(0x1f1)](0x1,-0x1));_0x29dca5=_0x29dca5[_0x18af50(0x1ce)](/\\n/g,'\x0a')[_0x18af50(0x1ce)](/\\"/g,'\x22');const _0x110b99={'op':_0x18af50(0x1ae),'request_id':_0x432e75['request_id'],'data':_0x29dca5};serverWs[_0x18af50(0x25c)](JSON[_0x18af50(0x1c7)](_0x110b99)),console[_0x18af50(0x229)](_0x18af50(0x240)+_0x432e75[_0x18af50(0x1c9)]);return;}catch(_0x2d3c88){console[_0x18af50(0x215)](_0x18af50(0x262),_0x2d3c88);const _0x5af306={'op':_0x18af50(0x1ae),'request_id':_0x432e75['request_id'],'error':_0x2d3c88['message']};serverWs[_0x18af50(0x25c)](JSON[_0x18af50(0x1c7)](_0x5af306));return;}if(_0x432e75['op']===_0x18af50(0x1d8)&&typeof _0x432e75[_0x18af50(0x224)]===_0x18af50(0x1d3)&&_0x432e75[_0x18af50(0x1f0)])try{const _0x20c30d=_0x432e75['uri'][_0x18af50(0x264)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x20c30d){const _0x210bd2=_0x20c30d[0x1],_0x17492b=_0x20c30d[0x2],_0x37865c=execSync(_0x18af50(0x219)+_0x210bd2,{'encoding':'utf8'})[_0x18af50(0x1bd)](),_0x24dc48=path['join'](_0x37865c,_0x18af50(0x1be),_0x210bd2,_0x17492b);if(!fs[_0x18af50(0x23c)](_0x24dc48))throw new Error('Mesh\x20file\x20not\x20found:\x20'+_0x24dc48);const _0x2d6e14=fs[_0x18af50(0x1b4)](_0x24dc48),_0x4f2619={'op':_0x18af50(0x1e6),'request_id':_0x432e75[_0x18af50(0x1f0)],'data':_0x2d6e14[_0x18af50(0x1d2)](_0x18af50(0x1c0))};serverWs[_0x18af50(0x25c)](JSON[_0x18af50(0x1c7)](_0x4f2619)),console[_0x18af50(0x229)](_0x18af50(0x257)+_0x432e75['uri']+_0x18af50(0x1ed)+_0x24dc48);return;}}catch(_0x376505){console[_0x18af50(0x215)]('[MESH]\x20Error\x20serving\x20mesh:',_0x376505);const _0x4379bd={'op':_0x18af50(0x1e6),'request_id':_0x432e75[_0x18af50(0x1f0)],'error':_0x376505[_0x18af50(0x242)]};serverWs['send'](JSON[_0x18af50(0x1c7)](_0x4379bd));return;}rosbridgeWs[_0x18af50(0x25c)](_0x2f4069);}catch(_0x4fa43d){rosbridgeWs[_0x18af50(0x25c)](_0x2f4069);}}}),serverWs['on'](_0x154794(0x258),(_0x11f4ea,_0x4fbc76)=>{const _0x199348=_0x154794;console[_0x199348(0x229)](_0x199348(0x246)+_0x11f4ea+':\x20'+_0x4fbc76+_0x199348(0x206)),webrtcService[_0x199348(0x1b6)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x154794(0x215),_0x35b5c5=>{const _0x51c4a3=_0x154794;console['error'](_0x51c4a3(0x1bc),_0x35b5c5);});}catch(_0x10bb61){console[_0x154794(0x215)](_0x154794(0x1f7),_0x10bb61),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x4dfdbb,_0x1caf80,_0x2f4512)=>{const _0x1dc4e9=a1_0x496e3d;if(!authService[_0x1dc4e9(0x23b)]()){console[_0x1dc4e9(0x229)](_0x1dc4e9(0x25f),config['serverUrl']);const _0x904391=await authService[_0x1dc4e9(0x1c2)]();if(!_0x904391)return _0x1caf80['status'](0x191)[_0x1dc4e9(0x247)]({'error':_0x1dc4e9(0x203)});}_0x2f4512();};app[a1_0x496e3d(0x209)]((_0x17a471,_0x114a3e,_0x3ba5b7)=>{const _0x31f134=a1_0x496e3d;_0x114a3e[_0x31f134(0x205)](_0x31f134(0x22c),'*'),_0x114a3e[_0x31f134(0x205)]('Access-Control-Allow-Methods',_0x31f134(0x1e8)),_0x114a3e[_0x31f134(0x205)](_0x31f134(0x1b2),_0x31f134(0x1d6)),_0x17a471['method']===_0x31f134(0x1b1)?_0x114a3e['sendStatus'](0xc8):_0x3ba5b7();}),app[a1_0x496e3d(0x1db)]('/',requireAuth,(_0x13e1e4,_0x41ed71)=>{const _0x136a45=a1_0x496e3d;_0x41ed71[_0x136a45(0x25c)]('Appliance\x20is\x20running\x20and\x20authenticated!');}),app[a1_0x496e3d(0x1db)]('/health',async(_0x42e855,_0x51b05f)=>{const _0x33a5c4=a1_0x496e3d,_0x41571b=authService['isAuthenticated'](),_0x46d075=webrtcService[_0x33a5c4(0x208)](),_0x8b68c=webrtcService[_0x33a5c4(0x1cd)](),_0x561dec=topicManager[_0x33a5c4(0x1eb)]();_0x51b05f[_0x33a5c4(0x247)]({'status':'ok','environment':process[_0x33a5c4(0x1bf)][_0x33a5c4(0x1ef)]||'development','backendUrl':config[_0x33a5c4(0x21e)],'rosbridgeUrl':config[_0x33a5c4(0x226)][_0x33a5c4(0x1c3)],'proxyPort':port,'authenticated':_0x41571b,'topicManagement':{'discovered':_0x561dec[_0x33a5c4(0x244)],'strategies':_0x561dec[_0x33a5c4(0x259)],'largeDataTopics':_0x561dec[_0x33a5c4(0x22a)]['length'],'largeTopicsList':_0x561dec[_0x33a5c4(0x22a)]},'webrtc':{'activeSessions':_0x46d075[_0x33a5c4(0x24d)],'sharedVideoSources':_0x8b68c['length'],'sessions':_0x46d075,'sharedSources':_0x8b68c}});});const getInitialPort=()=>{const _0x1d408f=a1_0x496e3d;if(process['env']['PORT'])return parseInt(process[_0x1d408f(0x1bf)][_0x1d408f(0x1ff)],0xa);return config[_0x1d408f(0x226)][_0x1d408f(0x251)];};async function listenWithRetries(_0x15b453,_0x3dae2e,_0x48aa5e=0xa){let _0x4257d4=_0x3dae2e;for(let _0x64ca78=0x1;_0x64ca78<=_0x48aa5e;_0x64ca78++){try{return await new Promise((_0x10bc61,_0x179dcc)=>{const _0x5e3dc4=a1_0xe6f9,_0x239f4d=_0x15b453[_0x5e3dc4(0x211)](_0x4257d4,()=>{const _0x22fa83=_0x5e3dc4;console[_0x22fa83(0x229)](_0x22fa83(0x220)+_0x4257d4),_0x10bc61(_0x239f4d);});_0x239f4d['on'](_0x5e3dc4(0x215),_0x2a44eb=>{const _0x73e1d8=_0x5e3dc4;_0x2a44eb['code']===_0x73e1d8(0x1e9)?(console[_0x73e1d8(0x225)](_0x73e1d8(0x222)+_0x4257d4+_0x73e1d8(0x1a5)),_0x179dcc(_0x2a44eb)):_0x179dcc(_0x2a44eb);});}),_0x4257d4;}catch(_0x58ff69){_0x4257d4++;}}throw new Error('Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20'+_0x48aa5e+'\x20attempts\x20starting\x20from\x20'+_0x3dae2e);}const startApp=async()=>{const _0x14dcad=a1_0x496e3d;try{let _0x59183a=await authService[_0x14dcad(0x1c2)]();while(!_0x59183a){console[_0x14dcad(0x229)](_0x14dcad(0x1b8)),await promptForCredentials(),_0x59183a=await authService[_0x14dcad(0x1c2)]();}console['log'](_0x14dcad(0x1c6));!loadApplianceIdentity()&&console[_0x14dcad(0x229)](_0x14dcad(0x223));console[_0x14dcad(0x229)](_0x14dcad(0x217));const _0x51a953=await registerWithServer();if(!_0x51a953)throw new Error(_0x14dcad(0x260));connectToRosbridge(),connectToServer();const _0x53dcdf=getInitialPort();await listenWithRetries(app,_0x53dcdf,0xa);}catch(_0x443b3a){console['error']('Failed\x20to\x20start\x20application:',_0x443b3a),process[_0x14dcad(0x1d5)](0x1);}};function a1_0xe6f9(_0x395602,_0xb4cedd){const _0x56f13c=a1_0xb3cb();return a1_0xe6f9=function(_0x162c8a,_0x32c389){_0x162c8a=_0x162c8a-0x19e;let _0xb3cba=_0x56f13c[_0x162c8a];return _0xb3cba;},a1_0xe6f9(_0x395602,_0xb4cedd);}setInterval(async()=>{const _0x4e16ef=a1_0x496e3d;try{if(robotId){const _0x331fba=authService['getToken']();await axios['post'](config[_0x4e16ef(0x21e)]+_0x4e16ef(0x245),{'robotId':robotId},{'headers':{'Authorization':_0x4e16ef(0x21c)+_0x331fba,'Content-Type':_0x4e16ef(0x1de)}});}}catch(_0x4f3f0c){console[_0x4e16ef(0x215)](_0x4e16ef(0x1da),_0x4f3f0c['message']);}},0x1388),startApp();