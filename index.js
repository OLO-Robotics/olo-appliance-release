const a1_0x2fdb65=a1_0x4175;(function(_0x2c957c,_0x58e71a){const _0x5d83b9=a1_0x4175,_0x5566c1=_0x2c957c();while(!![]){try{const _0x1fa4a6=parseInt(_0x5d83b9(0x23a))/0x1+-parseInt(_0x5d83b9(0x259))/0x2*(-parseInt(_0x5d83b9(0x26f))/0x3)+parseInt(_0x5d83b9(0x231))/0x4*(-parseInt(_0x5d83b9(0x22c))/0x5)+-parseInt(_0x5d83b9(0x286))/0x6+-parseInt(_0x5d83b9(0x284))/0x7*(-parseInt(_0x5d83b9(0x222))/0x8)+-parseInt(_0x5d83b9(0x1d3))/0x9*(parseInt(_0x5d83b9(0x264))/0xa)+-parseInt(_0x5d83b9(0x21c))/0xb;if(_0x1fa4a6===_0x58e71a)break;else _0x5566c1['push'](_0x5566c1['shift']());}catch(_0x5eca37){_0x5566c1['push'](_0x5566c1['shift']());}}}(a1_0x245a,0xb01df));const a1_0x346b57=(function(){let _0x1cd3c8=!![];return function(_0x5909c7,_0x2cd4c7){const _0xda7877=_0x1cd3c8?function(){const _0x5e07cb=a1_0x4175;if(_0x2cd4c7){const _0x3da039=_0x2cd4c7[_0x5e07cb(0x1f5)](_0x5909c7,arguments);return _0x2cd4c7=null,_0x3da039;}}:function(){};return _0x1cd3c8=![],_0xda7877;};}()),a1_0x3160f5=a1_0x346b57(this,function(){const _0x2be574=a1_0x4175;return a1_0x3160f5[_0x2be574(0x207)]()['search'](_0x2be574(0x26c))[_0x2be574(0x207)]()[_0x2be574(0x28e)](a1_0x3160f5)[_0x2be574(0x230)]('(((.+)+)+)+$');});a1_0x3160f5();const express=require('express'),config=require(a1_0x2fdb65(0x268)),authService=require('./services/auth'),webrtcService=require(a1_0x2fdb65(0x1f8)),topicManager=require(a1_0x2fdb65(0x1d2)),WebSocket=require('ws'),axios=require(a1_0x2fdb65(0x26d)),fs=require('fs'),prompt=require('prompt-sync')({'sigint':!![]}),dotenv=require(a1_0x2fdb65(0x25f)),app=express(),port=process[a1_0x2fdb65(0x236)]['PORT']||config[a1_0x2fdb65(0x242)][a1_0x2fdb65(0x256)],APPLIANCE_FILE=a1_0x2fdb65(0x272),{DOMParser,XMLSerializer}=require(a1_0x2fdb65(0x20f)),path=require(a1_0x2fdb65(0x224)),{execSync}=require(a1_0x2fdb65(0x238)),APPLIANCE_BASE_URL=process[a1_0x2fdb65(0x236)][a1_0x2fdb65(0x1d9)]||'';console['log'](a1_0x2fdb65(0x28c)+(process[a1_0x2fdb65(0x236)]['NODE_ENV']||a1_0x2fdb65(0x27f))),console[a1_0x2fdb65(0x1f1)]('Backend\x20Server\x20URL:\x20'+config[a1_0x2fdb65(0x22d)]),console[a1_0x2fdb65(0x1f1)](a1_0x2fdb65(0x252)+config[a1_0x2fdb65(0x242)][a1_0x2fdb65(0x290)]),console[a1_0x2fdb65(0x1f1)](a1_0x2fdb65(0x271)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x3ff89e,_0x477df7){const _0x4dd9d0=a1_0x2fdb65;fs[_0x4dd9d0(0x24c)](_0x4dd9d0(0x281),_0x4dd9d0(0x26a)+_0x3ff89e+_0x4dd9d0(0x269)+_0x477df7+'\x0a');}function a1_0x245a(){const _0x557063=['\x20->\x20','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','roslib','get','readFileSync','Connected\x20to\x20ROSBridge\x20(WebRTC)','msg','robot\x20not\x20found','urdf_param_data','topic','request_id','substring','OPEN','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','toString','[MESH]\x20Successfully\x20served\x20mesh:\x20','publish','Attempting\x20to\x20login\x20to:','Not\x20authenticated','.mesh','strategies','length','xmldom','PORT','),\x20attempting\x20to\x20reconnect...','stringify','unknown','Authentication\x20required','username','send','match','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','startsWith','Appliance\x20is\x20running\x20and\x20authenticated!','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','7787307zoauuA','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','call_service','method','Loaded\x20appliance\x20identity:','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','12656TvPOeG','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','path','catch','/appliance/ping','get_mesh','Failed\x20to\x20register\x20with\x20server','/health','config','Registering\x20with\x20server...','4455CsZFmL','serverUrl','totalTopics','estimatedSize','search','100PuTPDx','Successfully\x20logged\x20in','setAttribute','post','status','env','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','child_process','uri','917445GKCgwG','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','readyState','mesh_data','error','getTopicStrategy','.obj','connection','rosbridge','Failed\x20to\x20connect\x20to\x20server:','exit','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','/robot_description','close','Failed\x20to\x20start\x20application:','Server\x20connection\x20error:','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','map','writeFileSync','types','sample','service','/appliance/register','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','ROSBridge\x20WebSocket\x20URL:\x20','parse','join','registration_token','proxyPort','\x20attempts\x20starting\x20from\x20','topics','20jBVLDH','sample_skip','Connected\x20to\x20ROSBridge\x20(main)','json','http','OPTIONS','dotenv','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','getToken','existsSync','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','8350mRcfNR','includes','loadConfig','utf8','./config','\x0aAPP_PASSWORD=','APP_USERNAME=','password','(((.+)+)+)+$','axios','Ros','274497ULjZpw','type','Proxy\x20listening\x20on\x20port:\x20','.appliance.json','.ply','message','throttling','getAttribute','param_name','data','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','some','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','trim','discoverTopics','forward','development','[MESH]\x20Error\x20serving\x20mesh:','.env','WSL\x20Appliance','replace','5908aiKdHO','stopAllSessions','3292356pducNJ','Port\x20','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','filename','parseFromString','service_response','Environment:\x20','Failed\x20to\x20ping\x20server:','constructor','APP_PASSWORD','wsEndpoint','mesh','Disconnected\x20from\x20server\x20(','header','Successfully\x20registered\x20with\x20server','warn','endsWith','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','/rosapi/topics','./services/TopicManager','12582ggOKFs','application/json','robotId','Bearer\x20','APP_USERNAME','Mesh\x20file\x20not\x20found:\x20','APPLIANCE_BASE_URL','samplingRate','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','get_urdf_param','getActiveSessions','ros2\x20param\x20get\x20','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','sendStatus','handleMessage','open','Failed\x20to\x20register\x20with\x20server:','listen','text/xml','Access-Control-Allow-Methods','registrationToken','action','base64','code','initialize','unlinkSync','Access-Control-Allow-Origin','toLowerCase','isAuthenticated','largeDataTopics','log','serializeToString','Enter\x20password:\x20','reason','apply','values','name','./services/webrtcService'];a1_0x245a=function(){return _0x557063;};return a1_0x245a();}function reloadEnv(){const _0x2a8ec5=a1_0x2fdb65;dotenv[_0x2a8ec5(0x22a)]({'override':!![]}),config['credentials'][_0x2a8ec5(0x215)]=process[_0x2a8ec5(0x236)][_0x2a8ec5(0x1d7)],config['credentials'][_0x2a8ec5(0x26b)]=process[_0x2a8ec5(0x236)][_0x2a8ec5(0x28f)];}async function promptForCredentials(){const _0x257f2e=a1_0x2fdb65,_0x39bcda=prompt('Enter\x20username:\x20'),_0x7a0266=prompt['hide'](_0x257f2e(0x1f3));updateEnvFile(_0x39bcda,_0x7a0266),reloadEnv();}function loadApplianceIdentity(){const _0xabcf75=a1_0x2fdb65;if(fs['existsSync'](APPLIANCE_FILE))try{const _0x1d3f1f=JSON[_0xabcf75(0x253)](fs['readFileSync'](APPLIANCE_FILE,'utf8'));if(_0x1d3f1f[_0xabcf75(0x1d5)]&&_0x1d3f1f['registrationToken'])return robotId=_0x1d3f1f[_0xabcf75(0x1d5)],registrationToken=_0x1d3f1f[_0xabcf75(0x1e7)],console[_0xabcf75(0x1f1)](_0xabcf75(0x220),robotId),topicManager[_0xabcf75(0x266)](_0x1d3f1f),!![];}catch(_0x5b14a1){console['error']('Failed\x20to\x20parse\x20appliance\x20identity\x20file:',_0x5b14a1);}return![];}function saveApplianceIdentity(_0x3e33ab,_0x2c593c){const _0x189535=a1_0x2fdb65;let _0x383552={};if(fs[_0x189535(0x262)](APPLIANCE_FILE))try{_0x383552=JSON[_0x189535(0x253)](fs[_0x189535(0x1fd)](APPLIANCE_FILE,_0x189535(0x267)));}catch(_0x28d24c){_0x383552={};}_0x383552[_0x189535(0x1d5)]=_0x3e33ab,_0x383552['registrationToken']=_0x2c593c,fs[_0x189535(0x24c)](APPLIANCE_FILE,JSON[_0x189535(0x212)](_0x383552,null,0x2));}async function registerWithServer(){const _0x3ace8a=a1_0x2fdb65;try{const _0x498294=authService[_0x3ace8a(0x261)]();if(!_0x498294)throw new Error(_0x3ace8a(0x20b));let _0x40ecf7,_0x203025=![];while(!![]){try{robotId&&registrationToken?_0x40ecf7=await axios[_0x3ace8a(0x234)](config[_0x3ace8a(0x22d)]+_0x3ace8a(0x250),{'name':_0x3ace8a(0x282),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x3ace8a(0x1d6)+_0x498294,'Content-Type':_0x3ace8a(0x1d4)}}):_0x40ecf7=await axios['post'](config[_0x3ace8a(0x22d)]+_0x3ace8a(0x250),{'name':_0x3ace8a(0x282)},{'headers':{'Authorization':_0x3ace8a(0x1d6)+_0x498294,'Content-Type':_0x3ace8a(0x1d4)}});break;}catch(_0x3a9a46){const _0x26db48=_0x3a9a46?.['response']?.[_0x3ace8a(0x278)]?.[_0x3ace8a(0x23e)]||_0x3a9a46[_0x3ace8a(0x274)];if(!_0x203025&&_0x26db48&&_0x26db48['toLowerCase']()[_0x3ace8a(0x265)](_0x3ace8a(0x200))){console[_0x3ace8a(0x295)](_0x3ace8a(0x260));if(fs[_0x3ace8a(0x262)](APPLIANCE_FILE))fs[_0x3ace8a(0x1ec)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x203025=!![];continue;}throw _0x3a9a46;}}if(!_0x40ecf7['data']||!_0x40ecf7['data']['registration_token']||!_0x40ecf7[_0x3ace8a(0x278)]['id'])throw new Error(_0x3ace8a(0x218));return registrationToken=_0x40ecf7['data'][_0x3ace8a(0x255)],robotId=_0x40ecf7[_0x3ace8a(0x278)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x3ace8a(0x1f1)](_0x3ace8a(0x294)),!![];}catch(_0xce859e){return console[_0x3ace8a(0x23e)](_0x3ace8a(0x1e3),_0xce859e[_0x3ace8a(0x274)]),![];}}function rewriteUrdfMeshUris(_0x1953e9){const _0x16f50e=a1_0x2fdb65;try{const _0xd4b337=new DOMParser(),_0x31b50d=_0xd4b337[_0x16f50e(0x28a)](_0x1953e9,_0x16f50e(0x1e5));let _0x9fb204=0x0,_0x2145c0=0x0;const _0x353e32=_0x31b50d['getElementsByTagName'](_0x16f50e(0x291));for(let _0x58db69=0x0;_0x58db69<_0x353e32['length'];_0x58db69++){const _0x2fd6d0=_0x353e32[_0x58db69],_0x524402=_0x2fd6d0[_0x16f50e(0x276)](_0x16f50e(0x289)),_0x344665=['.stl','.dae',_0x16f50e(0x240),_0x16f50e(0x273),_0x16f50e(0x20c)],_0x4300b1=_0x344665[_0x16f50e(0x27a)](_0x26fc25=>_0x524402[_0x16f50e(0x1ee)]()[_0x16f50e(0x296)](_0x26fc25));if(_0x524402&&_0x524402['startsWith']('package://')&&_0x4300b1){_0x9fb204++;const _0x144c83=APPLIANCE_BASE_URL+'/ros/mesh?uri='+encodeURIComponent(_0x524402);_0x2fd6d0[_0x16f50e(0x233)]('filename',_0x144c83),_0x2145c0++,console['log'](_0x16f50e(0x263)+_0x524402+_0x16f50e(0x1f9)+_0x144c83);}}_0x9fb204>0x0?console['log']('[URDF\x20REWRITE]\x20Rewrote\x20'+_0x2145c0+'\x20of\x20'+_0x9fb204+_0x16f50e(0x21b)):console[_0x16f50e(0x1f1)](_0x16f50e(0x21d));const _0x43944c=new XMLSerializer();return _0x43944c[_0x16f50e(0x1f2)](_0x31b50d);}catch(_0x4e637f){return console[_0x16f50e(0x23e)](_0x16f50e(0x245),_0x4e637f),_0x1953e9;}}function connectToRosbridge(){const _0x361830=a1_0x2fdb65;try{rosbridgeWs=new WebSocket(config[_0x361830(0x242)][_0x361830(0x290)]),rosbridgeWs['on'](_0x361830(0x1e2),()=>{const _0x5ac7cb=_0x361830;console[_0x5ac7cb(0x1f1)](_0x5ac7cb(0x25b));const _0x2fa5e0=require(_0x5ac7cb(0x1fb)),_0x40493d=new _0x2fa5e0[(_0x5ac7cb(0x26e))]({'url':config[_0x5ac7cb(0x242)][_0x5ac7cb(0x290)]});_0x40493d['on'](_0x5ac7cb(0x241),()=>{setTimeout(()=>{const _0x500eb1=a1_0x4175;topicManager[_0x500eb1(0x27d)](_0x40493d)[_0x500eb1(0x225)](_0x334cbb=>{const _0xf32a64=_0x500eb1;console[_0xf32a64(0x23e)]('Topic\x20discovery\x20failed:',_0x334cbb);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on']('message',_0x370830=>{const _0xe2b80e=_0x361830;if(serverWs&&serverWs[_0xe2b80e(0x23c)]===WebSocket['OPEN']){let _0x193d54=_0x370830[_0xe2b80e(0x207)]();try{const _0x4b2e87=JSON[_0xe2b80e(0x253)](_0x193d54);if(_0x4b2e87['op']===_0xe2b80e(0x209)&&_0x4b2e87[_0xe2b80e(0x202)]){const _0x4d4bcc=topicManager['handleMessage'](_0x4b2e87);switch(_0x4d4bcc[_0xe2b80e(0x1e8)]){case _0xe2b80e(0x25a):return;case'webrtc_skip':return;case _0xe2b80e(0x27e):default:_0x193d54=JSON[_0xe2b80e(0x212)](_0x4d4bcc[_0xe2b80e(0x274)]);break;}}if((_0x4b2e87['op']===_0xe2b80e(0x28b)||_0x4b2e87['op']===_0xe2b80e(0x21e))&&(_0x4b2e87[_0xe2b80e(0x24f)]===_0xe2b80e(0x1d1)||_0x4b2e87[_0xe2b80e(0x1f6)]&&_0x4b2e87['values'][_0xe2b80e(0x258)])){console[_0xe2b80e(0x1f1)](_0xe2b80e(0x279));const _0x4125da=_0x4b2e87['values']?.['topics']||[],_0x499444=_0x4b2e87[_0xe2b80e(0x1f6)]?.[_0xe2b80e(0x24d)]||[],_0x191454=_0x4125da['map']((_0x126e9f,_0x5672f6)=>{const _0x59a666=_0xe2b80e,_0x4678ac=topicManager[_0x59a666(0x23f)](_0x126e9f);return{'name':_0x126e9f,'type':_0x499444[_0x5672f6]||_0x59a666(0x213),'throttling':_0x4678ac?{'isThrottled':_0x4678ac['strategy']===_0x59a666(0x24e),'strategy':_0x4678ac['strategy'],'samplingRate':_0x4678ac[_0x59a666(0x1da)],'reason':_0x4678ac[_0x59a666(0x1f4)],'estimatedSize':_0x4678ac[_0x59a666(0x22f)]}:null};});_0x4b2e87['values']={'topics':_0x191454[_0xe2b80e(0x24b)](_0x4c7cb2=>_0x4c7cb2[_0xe2b80e(0x1f7)]),'types':_0x191454['map'](_0xa43e22=>_0xa43e22[_0xe2b80e(0x270)]),'throttling':_0x191454[_0xe2b80e(0x24b)](_0x1ee0a7=>_0x1ee0a7[_0xe2b80e(0x275)])},_0x193d54=JSON[_0xe2b80e(0x212)](_0x4b2e87),console[_0xe2b80e(0x1f1)](_0xe2b80e(0x206));}if(_0x4b2e87['op']===_0xe2b80e(0x209)&&_0x4b2e87['topic']===_0xe2b80e(0x246))try{const _0x180f56=_0x4b2e87['msg'][_0xe2b80e(0x278)],_0x49261b=rewriteUrdfMeshUris(_0x180f56);_0x4b2e87[_0xe2b80e(0x1ff)][_0xe2b80e(0x278)]=_0x49261b,_0x193d54=JSON['stringify'](_0x4b2e87);}catch(_0x36e2b7){console[_0xe2b80e(0x23e)](_0xe2b80e(0x288),_0x36e2b7);}}catch(_0x275ea4){console[_0xe2b80e(0x295)](_0xe2b80e(0x1fa),_0x275ea4[_0xe2b80e(0x274)]);}serverWs[_0xe2b80e(0x216)](_0x193d54);}}),rosbridgeWs['on'](_0x361830(0x247),()=>{const _0x94071c=_0x361830;console[_0x94071c(0x1f1)](_0x94071c(0x24a)),webrtcService[_0x94071c(0x285)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x361830(0x23e),_0x4fa03d=>{const _0x2e3589=_0x361830;console[_0x2e3589(0x23e)]('ROSBridge\x20(main)\x20connection\x20error:',_0x4fa03d);});}catch(_0x28eef1){console['error'](_0x361830(0x221),_0x28eef1),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x3d474e=a1_0x2fdb65;try{rosbridgeWebRTCWs=new WebSocket(config[_0x3d474e(0x242)][_0x3d474e(0x290)]),rosbridgeWebRTCWs['on'](_0x3d474e(0x1e2),()=>{const _0x36ad1c=_0x3d474e;console['log'](_0x36ad1c(0x1fe)),webrtcService[_0x36ad1c(0x1eb)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x3d474e(0x274),_0x36767e=>{}),rosbridgeWebRTCWs['on']('close',()=>{const _0x38512f=_0x3d474e;console['log'](_0x38512f(0x223)),webrtcService['stopAllSessions'](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x3d474e(0x23e),_0x59c96e=>{const _0xa010b=_0x3d474e;console[_0xa010b(0x23e)]('ROSBridge\x20(WebRTC)\x20connection\x20error:',_0x59c96e);});}catch(_0x1ae3c6){console[_0x3d474e(0x23e)](_0x3d474e(0x237),_0x1ae3c6),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x298bbb=a1_0x2fdb65;try{if(!registrationToken)throw new Error('Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.');const _0x5b89b7=config[_0x298bbb(0x22d)][_0x298bbb(0x283)](_0x298bbb(0x25d),'ws')+'/rosbridge?type=appliance&token='+registrationToken;serverWs=new WebSocket(_0x5b89b7),serverWs['on']('open',()=>{const _0x2c2688=_0x298bbb;console['log']('Connected\x20to\x20server'),rosbridgeWebRTCWs&&rosbridgeWebRTCWs['readyState']===WebSocket[_0x2c2688(0x205)]&&webrtcService[_0x2c2688(0x1eb)](rosbridgeWebRTCWs,serverWs);}),serverWs['on']('message',_0x54ccdb=>{const _0x44b91c=_0x298bbb;if(rosbridgeWs&&rosbridgeWs[_0x44b91c(0x23c)]===WebSocket[_0x44b91c(0x205)]){let _0x42af67=_0x54ccdb[_0x44b91c(0x207)]();try{const _0x38cd28=JSON[_0x44b91c(0x253)](_0x42af67);if(webrtcService[_0x44b91c(0x1e1)](_0x38cd28))return;if(_0x38cd28['op']===_0x44b91c(0x1dc)&&typeof _0x38cd28[_0x44b91c(0x277)]==='string'&&_0x38cd28['request_id'])try{console[_0x44b91c(0x1f1)](_0x44b91c(0x23b)+_0x38cd28[_0x44b91c(0x277)]);const _0x56f25a=execSync(_0x44b91c(0x1de)+_0x38cd28[_0x44b91c(0x277)],{'encoding':_0x44b91c(0x267)})[_0x44b91c(0x27c)]();let _0x583fd6=_0x56f25a;_0x56f25a[_0x44b91c(0x219)]('String\x20value\x20is:\x20')&&(_0x583fd6=_0x56f25a[_0x44b91c(0x204)]('String\x20value\x20is:\x20'[_0x44b91c(0x20e)]()));_0x583fd6[_0x44b91c(0x219)]('\x22')&&_0x583fd6[_0x44b91c(0x296)]('\x22')&&(_0x583fd6=_0x583fd6['slice'](0x1,-0x1));_0x583fd6=_0x583fd6[_0x44b91c(0x283)](/\\n/g,'\x0a')[_0x44b91c(0x283)](/\\"/g,'\x22');const _0x39bc1a={'op':_0x44b91c(0x201),'request_id':_0x38cd28[_0x44b91c(0x203)],'data':_0x583fd6};serverWs[_0x44b91c(0x216)](JSON[_0x44b91c(0x212)](_0x39bc1a)),console[_0x44b91c(0x1f1)](_0x44b91c(0x251)+_0x38cd28['param_name']);return;}catch(_0xad22e0){console['error']('[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:',_0xad22e0);const _0x3c844b={'op':'urdf_param_data','request_id':_0x38cd28[_0x44b91c(0x203)],'error':_0xad22e0[_0x44b91c(0x274)]};serverWs[_0x44b91c(0x216)](JSON[_0x44b91c(0x212)](_0x3c844b));return;}if(_0x38cd28['op']===_0x44b91c(0x227)&&typeof _0x38cd28[_0x44b91c(0x239)]==='string'&&_0x38cd28[_0x44b91c(0x203)])try{const _0x8fc3f4=_0x38cd28['uri'][_0x44b91c(0x217)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x8fc3f4){const _0x45968d=_0x8fc3f4[0x1],_0x17634a=_0x8fc3f4[0x2],_0x2a30d8=execSync('ros2\x20pkg\x20prefix\x20'+_0x45968d,{'encoding':'utf8'})[_0x44b91c(0x27c)](),_0x1d1c86=path[_0x44b91c(0x254)](_0x2a30d8,'share',_0x45968d,_0x17634a);if(!fs['existsSync'](_0x1d1c86))throw new Error(_0x44b91c(0x1d8)+_0x1d1c86);const _0x285095=fs[_0x44b91c(0x1fd)](_0x1d1c86),_0x23f5bc={'op':_0x44b91c(0x23d),'request_id':_0x38cd28['request_id'],'data':_0x285095[_0x44b91c(0x207)](_0x44b91c(0x1e9))};serverWs[_0x44b91c(0x216)](JSON['stringify'](_0x23f5bc)),console[_0x44b91c(0x1f1)](_0x44b91c(0x208)+_0x38cd28['uri']+'\x20from\x20'+_0x1d1c86);return;}}catch(_0x4f9241){console[_0x44b91c(0x23e)](_0x44b91c(0x280),_0x4f9241);const _0x27276d={'op':_0x44b91c(0x23d),'request_id':_0x38cd28[_0x44b91c(0x203)],'error':_0x4f9241[_0x44b91c(0x274)]};serverWs[_0x44b91c(0x216)](JSON[_0x44b91c(0x212)](_0x27276d));return;}rosbridgeWs[_0x44b91c(0x216)](_0x42af67);}catch(_0x3d60a5){rosbridgeWs[_0x44b91c(0x216)](_0x42af67);}}}),serverWs['on']('close',(_0x4c0df6,_0x1a728a)=>{const _0x7493ca=_0x298bbb;console['log'](_0x7493ca(0x292)+_0x4c0df6+':\x20'+_0x1a728a+_0x7493ca(0x211)),webrtcService[_0x7493ca(0x285)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x298bbb(0x23e),_0x326bdb=>{const _0x37caab=_0x298bbb;console[_0x37caab(0x23e)](_0x37caab(0x249),_0x326bdb);});}catch(_0x11e4a6){console[_0x298bbb(0x23e)](_0x298bbb(0x243),_0x11e4a6),setTimeout(connectToServer,0x1388);}}function a1_0x4175(_0xfdd620,_0x5d8757){const _0x278618=a1_0x245a();return a1_0x4175=function(_0x3160f5,_0x346b57){_0x3160f5=_0x3160f5-0x1d1;let _0x245a17=_0x278618[_0x3160f5];return _0x245a17;},a1_0x4175(_0xfdd620,_0x5d8757);}const requireAuth=async(_0x58156b,_0x432555,_0x5f1d40)=>{const _0x948445=a1_0x2fdb65;if(!authService[_0x948445(0x1ef)]()){console['log'](_0x948445(0x20a),config[_0x948445(0x22d)]);const _0xa73a0=await authService['login']();if(!_0xa73a0)return _0x432555[_0x948445(0x235)](0x191)[_0x948445(0x25c)]({'error':_0x948445(0x214)});}_0x5f1d40();};app['use']((_0x574a93,_0x317dd8,_0x290272)=>{const _0x341b53=a1_0x2fdb65;_0x317dd8['header'](_0x341b53(0x1ed),'*'),_0x317dd8[_0x341b53(0x293)](_0x341b53(0x1e6),_0x341b53(0x1db)),_0x317dd8[_0x341b53(0x293)]('Access-Control-Allow-Headers','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization'),_0x574a93[_0x341b53(0x21f)]===_0x341b53(0x25e)?_0x317dd8[_0x341b53(0x1e0)](0xc8):_0x290272();}),app[a1_0x2fdb65(0x1fc)]('/',requireAuth,(_0x58f348,_0x2fb757)=>{const _0x1b6ee8=a1_0x2fdb65;_0x2fb757[_0x1b6ee8(0x216)](_0x1b6ee8(0x21a));}),app[a1_0x2fdb65(0x1fc)](a1_0x2fdb65(0x229),async(_0x476aec,_0x15b8e3)=>{const _0x3a193f=a1_0x2fdb65,_0x48aa21=authService[_0x3a193f(0x1ef)](),_0x32032d=webrtcService[_0x3a193f(0x1dd)](),_0x2eea3d=webrtcService['getSharedVideoSources'](),_0x331516=topicManager['getStatistics']();_0x15b8e3[_0x3a193f(0x25c)]({'status':'ok','environment':process[_0x3a193f(0x236)]['NODE_ENV']||_0x3a193f(0x27f),'backendUrl':config[_0x3a193f(0x22d)],'rosbridgeUrl':config['rosbridge'][_0x3a193f(0x290)],'proxyPort':port,'authenticated':_0x48aa21,'topicManagement':{'discovered':_0x331516[_0x3a193f(0x22e)],'strategies':_0x331516[_0x3a193f(0x20d)],'largeDataTopics':_0x331516[_0x3a193f(0x1f0)]['length'],'largeTopicsList':_0x331516['largeDataTopics']},'webrtc':{'activeSessions':_0x32032d[_0x3a193f(0x20e)],'sharedVideoSources':_0x2eea3d[_0x3a193f(0x20e)],'sessions':_0x32032d,'sharedSources':_0x2eea3d}});});const getInitialPort=()=>{const _0x3a59b3=a1_0x2fdb65;if(process[_0x3a59b3(0x236)][_0x3a59b3(0x210)])return parseInt(process[_0x3a59b3(0x236)][_0x3a59b3(0x210)],0xa);return config[_0x3a59b3(0x242)][_0x3a59b3(0x256)];};async function listenWithRetries(_0x5e19f2,_0x56e660,_0x1c2ae0=0xa){const _0x1c0218=a1_0x2fdb65;let _0x10de2=_0x56e660;for(let _0x7a6977=0x1;_0x7a6977<=_0x1c2ae0;_0x7a6977++){try{return await new Promise((_0x4d6013,_0x2f2fa1)=>{const _0x27750e=a1_0x4175,_0x1fa358=_0x5e19f2[_0x27750e(0x1e4)](_0x10de2,()=>{const _0x4d59c9=_0x27750e;console['log'](_0x4d59c9(0x1df)+_0x10de2),_0x4d6013(_0x1fa358);});_0x1fa358['on'](_0x27750e(0x23e),_0x223f0b=>{const _0x3e8887=_0x27750e;_0x223f0b[_0x3e8887(0x1ea)]==='EADDRINUSE'?(console[_0x3e8887(0x295)](_0x3e8887(0x287)+_0x10de2+'\x20in\x20use,\x20trying\x20next\x20port...'),_0x2f2fa1(_0x223f0b)):_0x2f2fa1(_0x223f0b);});}),_0x10de2;}catch(_0x79429e){_0x10de2++;}}throw new Error(_0x1c0218(0x297)+_0x1c2ae0+_0x1c0218(0x257)+_0x56e660);}const startApp=async()=>{const _0x4267ab=a1_0x2fdb65;try{let _0x594614=await authService['login']();while(!_0x594614){console[_0x4267ab(0x1f1)]('Login\x20failed.\x20Please\x20enter\x20credentials\x20again.'),await promptForCredentials(),_0x594614=await authService['login']();}console['log'](_0x4267ab(0x232));!loadApplianceIdentity()&&console[_0x4267ab(0x1f1)](_0x4267ab(0x27b));console['log'](_0x4267ab(0x22b));const _0x5a7b72=await registerWithServer();if(!_0x5a7b72)throw new Error(_0x4267ab(0x228));connectToRosbridge(),connectToServer();const _0x2f305e=getInitialPort();await listenWithRetries(app,_0x2f305e,0xa);}catch(_0x207efe){console[_0x4267ab(0x23e)](_0x4267ab(0x248),_0x207efe),process[_0x4267ab(0x244)](0x1);}};setInterval(async()=>{const _0x524282=a1_0x2fdb65;try{if(robotId){const _0x5944ff=authService[_0x524282(0x261)]();await axios[_0x524282(0x234)](config[_0x524282(0x22d)]+_0x524282(0x226),{'robotId':robotId},{'headers':{'Authorization':'Bearer\x20'+_0x5944ff,'Content-Type':_0x524282(0x1d4)}});}}catch(_0x514753){console[_0x524282(0x23e)](_0x524282(0x28d),_0x514753[_0x524282(0x274)]);}},0x1388),startApp();