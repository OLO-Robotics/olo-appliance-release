const a1_0x4e0012=a1_0x1e80;(function(_0x1df410,_0x3bebff){const _0x2d9954=a1_0x1e80,_0x4a6369=_0x1df410();while(!![]){try{const _0x32f381=-parseInt(_0x2d9954(0xbe))/0x1*(-parseInt(_0x2d9954(0xfd))/0x2)+-parseInt(_0x2d9954(0x13f))/0x3*(parseInt(_0x2d9954(0xb2))/0x4)+-parseInt(_0x2d9954(0xfa))/0x5*(-parseInt(_0x2d9954(0x90))/0x6)+parseInt(_0x2d9954(0xd5))/0x7*(parseInt(_0x2d9954(0xfb))/0x8)+parseInt(_0x2d9954(0xf9))/0x9+-parseInt(_0x2d9954(0x12e))/0xa*(parseInt(_0x2d9954(0xa1))/0xb)+parseInt(_0x2d9954(0x110))/0xc*(-parseInt(_0x2d9954(0x146))/0xd);if(_0x32f381===_0x3bebff)break;else _0x4a6369['push'](_0x4a6369['shift']());}catch(_0x326970){_0x4a6369['push'](_0x4a6369['shift']());}}}(a1_0x2e55,0x38311));const a1_0x44714b=(function(){let _0x22f600=!![];return function(_0xf64965,_0x1ddbe2){const _0x347299=_0x22f600?function(){if(_0x1ddbe2){const _0x206e63=_0x1ddbe2['apply'](_0xf64965,arguments);return _0x1ddbe2=null,_0x206e63;}}:function(){};return _0x22f600=![],_0x347299;};}()),a1_0x459a1a=a1_0x44714b(this,function(){const _0xa61a90=a1_0x1e80;return a1_0x459a1a[_0xa61a90(0x10b)]()[_0xa61a90(0xc7)]('(((.+)+)+)+$')[_0xa61a90(0x10b)]()['constructor'](a1_0x459a1a)[_0xa61a90(0xc7)](_0xa61a90(0x11b));});a1_0x459a1a();const express=require('express'),config=require(a1_0x4e0012(0x13a)),authService=require(a1_0x4e0012(0x96)),webrtcService=require('./services/webrtcService'),topicManager=require(a1_0x4e0012(0xcf)),WebSocket=require('ws'),axios=require('axios'),fs=require('fs'),prompt=require('prompt-sync')({'sigint':!![]}),dotenv=require('dotenv'),app=express(),port=process[a1_0x4e0012(0x11a)][a1_0x4e0012(0x12d)]||config[a1_0x4e0012(0xe8)][a1_0x4e0012(0xd0)],APPLIANCE_FILE=a1_0x4e0012(0xee),{DOMParser,XMLSerializer}=require(a1_0x4e0012(0xef)),path=require('path'),{execSync}=require('child_process'),APPLIANCE_BASE_URL=process[a1_0x4e0012(0x11a)]['APPLIANCE_BASE_URL']||'';console['log'](a1_0x4e0012(0xd4)+(process[a1_0x4e0012(0x11a)][a1_0x4e0012(0x107)]||'development')),console[a1_0x4e0012(0x13e)](a1_0x4e0012(0xe2)+config[a1_0x4e0012(0xc9)]),console[a1_0x4e0012(0x13e)]('ROSBridge\x20WebSocket\x20URL:\x20'+config[a1_0x4e0012(0xe8)][a1_0x4e0012(0x130)]),console[a1_0x4e0012(0x13e)]('Proxy\x20listening\x20on\x20port:\x20'+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x4759b8,_0x4f04dc){const _0x48914e=a1_0x4e0012;fs[_0x48914e(0xb0)]('.env',_0x48914e(0x127)+_0x4759b8+_0x48914e(0xd3)+_0x4f04dc+'\x0a');}function reloadEnv(){const _0x390fb6=a1_0x4e0012;dotenv[_0x390fb6(0x117)]({'override':!![]}),config[_0x390fb6(0xe7)]['username']=process[_0x390fb6(0x11a)][_0x390fb6(0x131)],config[_0x390fb6(0xe7)][_0x390fb6(0xce)]=process[_0x390fb6(0x11a)]['APP_PASSWORD'];}async function promptForCredentials(){const _0x198982=a1_0x4e0012,_0x2f9668=prompt(_0x198982(0xb9)),_0x547b0e=prompt[_0x198982(0xa5)](_0x198982(0xb5));updateEnvFile(_0x2f9668,_0x547b0e),reloadEnv();}function loadApplianceIdentity(){const _0x4b0c15=a1_0x4e0012;if(fs[_0x4b0c15(0x147)](APPLIANCE_FILE))try{const _0x50c44d=JSON[_0x4b0c15(0x120)](fs[_0x4b0c15(0xe0)](APPLIANCE_FILE,'utf8'));if(_0x50c44d[_0x4b0c15(0x123)]&&_0x50c44d[_0x4b0c15(0xc8)])return robotId=_0x50c44d[_0x4b0c15(0x123)],registrationToken=_0x50c44d['registrationToken'],console[_0x4b0c15(0x13e)]('Loaded\x20appliance\x20identity:',robotId),topicManager['loadConfig'](_0x50c44d),!![];}catch(_0x97fb95){console[_0x4b0c15(0xf7)](_0x4b0c15(0xcc),_0x97fb95);}return![];}function a1_0x2e55(){const _0x16f515=['Backend\x20Server\x20URL:\x20','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','Access-Control-Allow-Methods','throttling','strategy','credentials','rosbridge','readyState','Port\x20','[URDF\x20REWRITE]\x20Rewrote\x20','Not\x20authenticated','isAuthenticated','.appliance.json','xmldom','getElementsByTagName','request_id','Failed\x20to\x20connect\x20to\x20server:','discoverTopics','\x20in\x20use,\x20trying\x20next\x20port...','service','No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.','error','largeDataTopics','3673773hFsfkn','13530TrDWKM','132200XjvLTy','/rosapi/topics','2EVTsPE','/appliance/register','forward','unlinkSync','Failed\x20to\x20register\x20with\x20server:','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','Successfully\x20registered\x20with\x20server','getActiveSessions','exit','String\x20value\x20is:\x20','NODE_ENV','sample','json','filename','toString','samplingRate','package://','header','substring','44652OwJsQz','join','action','),\x20attempting\x20to\x20reconnect...','endsWith','some','.ply','config','response','urdf_param_data','env','(((.+)+)+)+$','string','[MESH]\x20Successfully\x20served\x20mesh:\x20','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','stringify','parse','base64','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','robotId','utf8','param_name','connection','APP_USERNAME=','call_service','method','values','trim','/ros/mesh?uri=','PORT','15640Lletpc','text/xml','wsEndpoint','APP_USERNAME','toLowerCase','slice','send','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','.mesh','unknown','\x20from\x20','post','./config','getStatistics','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','Connected\x20to\x20server','log','78HBodYU','[MESH]\x20Error\x20serving\x20mesh:','map','/appliance/ping','setAttribute','replace','getToken','2366mXgwhl','existsSync','Topic\x20discovery\x20failed:','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','totalTopics','ros2\x20param\x20get\x20','Bearer\x20','.dae','804QSKemX','topic','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','/robot_description','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','get','./services/auth','Authentication\x20required','close','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','sendStatus','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','stopAllSessions','Mesh\x20file\x20not\x20found:\x20','includes','application/json','OPTIONS','1881XBKzQj','getSharedVideoSources','topics','reason','hide','.obj','Attempting\x20to\x20login\x20to:','initialize','handleMessage','estimatedSize','robot\x20not\x20found','get_mesh','http','catch','EADDRINUSE','writeFileSync','\x20->\x20','41300AOXalK','message','Registering\x20with\x20server...','Enter\x20password:\x20','publish','Failed\x20to\x20register\x20with\x20server','OPEN','Enter\x20username:\x20','webrtc_skip','mesh','open','get_urdf_param','341976CELQeO','getAttribute','WSL\x20Appliance','[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:','mesh_data','Successfully\x20logged\x20in','ROSBridge\x20(main)\x20connection\x20error:','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','/rosbridge?type=appliance&token=','search','registrationToken','serverUrl','startsWith','data','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','uri','password','./services/TopicManager','proxyPort','Access-Control-Allow-Origin','warn','\x0aAPP_PASSWORD=','Environment:\x20','140mUjHiz','ROSBridge\x20(WebRTC)\x20connection\x20error:','msg','registration_token','serializeToString','length','\x20attempts\x20starting\x20from\x20','login','name','Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20','strategies','readFileSync','Ros'];a1_0x2e55=function(){return _0x16f515;};return a1_0x2e55();}function saveApplianceIdentity(_0x5687b7,_0x2937c4){const _0x20b9dc=a1_0x4e0012;let _0x144a3f={};if(fs[_0x20b9dc(0x147)](APPLIANCE_FILE))try{_0x144a3f=JSON[_0x20b9dc(0x120)](fs[_0x20b9dc(0xe0)](APPLIANCE_FILE,_0x20b9dc(0x124)));}catch(_0x51e013){_0x144a3f={};}_0x144a3f[_0x20b9dc(0x123)]=_0x5687b7,_0x144a3f['registrationToken']=_0x2937c4,fs[_0x20b9dc(0xb0)](APPLIANCE_FILE,JSON[_0x20b9dc(0x11f)](_0x144a3f,null,0x2));}async function registerWithServer(){const _0x55ea70=a1_0x4e0012;try{const _0x581ab8=authService['getToken']();if(!_0x581ab8)throw new Error(_0x55ea70(0xec));let _0x359bb3,_0x974ab5=![];while(!![]){try{robotId&&registrationToken?_0x359bb3=await axios[_0x55ea70(0x139)](config['serverUrl']+_0x55ea70(0xfe),{'name':'WSL\x20Appliance','robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x55ea70(0x8e)+_0x581ab8,'Content-Type':_0x55ea70(0x9f)}}):_0x359bb3=await axios['post'](config[_0x55ea70(0xc9)]+_0x55ea70(0xfe),{'name':_0x55ea70(0xc0)},{'headers':{'Authorization':_0x55ea70(0x8e)+_0x581ab8,'Content-Type':'application/json'}});break;}catch(_0x2d7bde){const _0x567912=_0x2d7bde?.[_0x55ea70(0x118)]?.[_0x55ea70(0xcb)]?.[_0x55ea70(0xf7)]||_0x2d7bde['message'];if(!_0x974ab5&&_0x567912&&_0x567912[_0x55ea70(0x132)]()[_0x55ea70(0x9e)](_0x55ea70(0xab))){console[_0x55ea70(0xd2)]('Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.');if(fs[_0x55ea70(0x147)](APPLIANCE_FILE))fs[_0x55ea70(0x100)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x974ab5=!![];continue;}throw _0x2d7bde;}}if(!_0x359bb3[_0x55ea70(0xcb)]||!_0x359bb3[_0x55ea70(0xcb)][_0x55ea70(0xd8)]||!_0x359bb3[_0x55ea70(0xcb)]['id'])throw new Error(_0x55ea70(0x122));return registrationToken=_0x359bb3['data'][_0x55ea70(0xd8)],robotId=_0x359bb3[_0x55ea70(0xcb)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x55ea70(0x13e)](_0x55ea70(0x103)),!![];}catch(_0x36af59){return console[_0x55ea70(0xf7)](_0x55ea70(0x101),_0x36af59[_0x55ea70(0xb3)]),![];}}function rewriteUrdfMeshUris(_0xd16946){const _0x3c5cb3=a1_0x4e0012;try{const _0x4df56d=new DOMParser(),_0x2af4ce=_0x4df56d['parseFromString'](_0xd16946,_0x3c5cb3(0x12f));let _0x4e4647=0x0,_0x46ef44=0x0;const _0x18b814=_0x2af4ce[_0x3c5cb3(0xf0)](_0x3c5cb3(0xbb));for(let _0x2c2ddd=0x0;_0x2c2ddd<_0x18b814['length'];_0x2c2ddd++){const _0x287f02=_0x18b814[_0x2c2ddd],_0x562cbb=_0x287f02[_0x3c5cb3(0xbf)](_0x3c5cb3(0x10a)),_0x1bad3c=['.stl',_0x3c5cb3(0x8f),_0x3c5cb3(0xa6),_0x3c5cb3(0x116),_0x3c5cb3(0x136)],_0x1486a9=_0x1bad3c[_0x3c5cb3(0x115)](_0x4f2552=>_0x562cbb[_0x3c5cb3(0x132)]()[_0x3c5cb3(0x114)](_0x4f2552));if(_0x562cbb&&_0x562cbb['startsWith'](_0x3c5cb3(0x10d))&&_0x1486a9){_0x4e4647++;const _0x2fbf14=APPLIANCE_BASE_URL+_0x3c5cb3(0x12c)+encodeURIComponent(_0x562cbb);_0x287f02[_0x3c5cb3(0x143)](_0x3c5cb3(0x10a),_0x2fbf14),_0x46ef44++,console[_0x3c5cb3(0x13e)](_0x3c5cb3(0x99)+_0x562cbb+_0x3c5cb3(0xb1)+_0x2fbf14);}}_0x4e4647>0x0?console[_0x3c5cb3(0x13e)](_0x3c5cb3(0xeb)+_0x46ef44+'\x20of\x20'+_0x4e4647+_0x3c5cb3(0x13c)):console[_0x3c5cb3(0x13e)](_0x3c5cb3(0x102));const _0x4ec1e1=new XMLSerializer();return _0x4ec1e1[_0x3c5cb3(0xd9)](_0x2af4ce);}catch(_0x1ea120){return console['error']('[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):',_0x1ea120),_0xd16946;}}function connectToRosbridge(){const _0x3e1189=a1_0x4e0012;try{rosbridgeWs=new WebSocket(config[_0x3e1189(0xe8)][_0x3e1189(0x130)]),rosbridgeWs['on'](_0x3e1189(0xbc),()=>{const _0x415591=_0x3e1189;console[_0x415591(0x13e)]('Connected\x20to\x20ROSBridge\x20(main)');const _0x5643b6=require('roslib'),_0x5f06e1=new _0x5643b6[(_0x415591(0xe1))]({'url':config[_0x415591(0xe8)][_0x415591(0x130)]});_0x5f06e1['on'](_0x415591(0x126),()=>{setTimeout(()=>{const _0x22b6eb=a1_0x1e80;topicManager[_0x22b6eb(0xf3)](_0x5f06e1)[_0x22b6eb(0xae)](_0x320d38=>{const _0x204350=_0x22b6eb;console['error'](_0x204350(0x148),_0x320d38);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x3e1189(0xb3),_0x3880a0=>{const _0x58bc2f=_0x3e1189;if(serverWs&&serverWs[_0x58bc2f(0xe9)]===WebSocket[_0x58bc2f(0xb8)]){let _0x14f2d1=_0x3880a0[_0x58bc2f(0x10b)]();try{const _0x307568=JSON[_0x58bc2f(0x120)](_0x14f2d1);if(_0x307568['op']===_0x58bc2f(0xb6)&&_0x307568[_0x58bc2f(0x91)]){const _0x28becf=topicManager[_0x58bc2f(0xa9)](_0x307568);switch(_0x28becf[_0x58bc2f(0x112)]){case'sample_skip':return;case _0x58bc2f(0xba):return;case _0x58bc2f(0xff):default:_0x14f2d1=JSON[_0x58bc2f(0x11f)](_0x28becf[_0x58bc2f(0xb3)]);break;}}if((_0x307568['op']==='service_response'||_0x307568['op']===_0x58bc2f(0x128))&&(_0x307568[_0x58bc2f(0xf5)]===_0x58bc2f(0xfc)||_0x307568[_0x58bc2f(0x12a)]&&_0x307568[_0x58bc2f(0x12a)][_0x58bc2f(0xa3)])){console[_0x58bc2f(0x13e)](_0x58bc2f(0x94));const _0x25dda3=_0x307568['values']?.[_0x58bc2f(0xa3)]||[],_0x53b251=_0x307568[_0x58bc2f(0x12a)]?.['types']||[],_0x53cffd=_0x25dda3[_0x58bc2f(0x141)]((_0x4e5126,_0x2a5782)=>{const _0x5af0d2=_0x58bc2f,_0x1a8c8=topicManager['getTopicStrategy'](_0x4e5126);return{'name':_0x4e5126,'type':_0x53b251[_0x2a5782]||_0x5af0d2(0x137),'throttling':_0x1a8c8?{'isThrottled':_0x1a8c8[_0x5af0d2(0xe6)]===_0x5af0d2(0x108),'strategy':_0x1a8c8[_0x5af0d2(0xe6)],'samplingRate':_0x1a8c8[_0x5af0d2(0x10c)],'reason':_0x1a8c8[_0x5af0d2(0xa4)],'estimatedSize':_0x1a8c8[_0x5af0d2(0xaa)]}:null};});_0x307568[_0x58bc2f(0x12a)]={'topics':_0x53cffd[_0x58bc2f(0x141)](_0x2fe03c=>_0x2fe03c[_0x58bc2f(0xdd)]),'types':_0x53cffd[_0x58bc2f(0x141)](_0x6b2683=>_0x6b2683['type']),'throttling':_0x53cffd[_0x58bc2f(0x141)](_0x1425d5=>_0x1425d5[_0x58bc2f(0xe5)])},_0x14f2d1=JSON[_0x58bc2f(0x11f)](_0x307568),console[_0x58bc2f(0x13e)](_0x58bc2f(0xc5));}if(_0x307568['op']===_0x58bc2f(0xb6)&&_0x307568[_0x58bc2f(0x91)]===_0x58bc2f(0x93))try{const _0x24e394=_0x307568[_0x58bc2f(0xd7)][_0x58bc2f(0xcb)],_0x703159=rewriteUrdfMeshUris(_0x24e394);_0x307568[_0x58bc2f(0xd7)]['data']=_0x703159,_0x14f2d1=JSON[_0x58bc2f(0x11f)](_0x307568);}catch(_0x235838){console['error'](_0x58bc2f(0x11e),_0x235838);}}catch(_0x238f8a){console[_0x58bc2f(0xd2)](_0x58bc2f(0xc1),_0x238f8a[_0x58bc2f(0xb3)]);}serverWs[_0x58bc2f(0x134)](_0x14f2d1);}}),rosbridgeWs['on'](_0x3e1189(0x98),()=>{const _0x4e6b0e=_0x3e1189;console[_0x4e6b0e(0x13e)]('Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x4e6b0e(0x9c)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on']('error',_0x2188e8=>{const _0x3b0d4b=_0x3e1189;console['error'](_0x3b0d4b(0xc4),_0x2188e8);});}catch(_0xd9ba92){console['error'](_0x3e1189(0x135),_0xd9ba92),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x1fd014=a1_0x4e0012;try{rosbridgeWebRTCWs=new WebSocket(config['rosbridge'][_0x1fd014(0x130)]),rosbridgeWebRTCWs['on']('open',()=>{const _0x2ffe6f=_0x1fd014;console['log']('Connected\x20to\x20ROSBridge\x20(WebRTC)'),webrtcService[_0x2ffe6f(0xa8)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x1fd014(0xb3),_0xf178df=>{}),rosbridgeWebRTCWs['on'](_0x1fd014(0x98),()=>{const _0x4c7136=_0x1fd014;console[_0x4c7136(0x13e)](_0x4c7136(0x9b)),webrtcService[_0x4c7136(0x9c)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on'](_0x1fd014(0xf7),_0xc63b1c=>{const _0x17983a=_0x1fd014;console['error'](_0x17983a(0xd6),_0xc63b1c);});}catch(_0x13339a){console[_0x1fd014(0xf7)]('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):',_0x13339a),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x504eea=a1_0x4e0012;try{if(!registrationToken)throw new Error(_0x504eea(0xe3));const _0xd4d643=config[_0x504eea(0xc9)][_0x504eea(0x144)](_0x504eea(0xad),'ws')+_0x504eea(0xc6)+registrationToken;serverWs=new WebSocket(_0xd4d643),serverWs['on'](_0x504eea(0xbc),()=>{const _0x513af7=_0x504eea;console[_0x513af7(0x13e)](_0x513af7(0x13d)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x513af7(0xe9)]===WebSocket[_0x513af7(0xb8)]&&webrtcService[_0x513af7(0xa8)](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x504eea(0xb3),_0x1c547e=>{const _0x184287=_0x504eea;if(rosbridgeWs&&rosbridgeWs[_0x184287(0xe9)]===WebSocket[_0x184287(0xb8)]){let _0x2c1179=_0x1c547e['toString']();try{const _0x20ac11=JSON[_0x184287(0x120)](_0x2c1179);if(webrtcService['handleMessage'](_0x20ac11))return;if(_0x20ac11['op']===_0x184287(0xbd)&&typeof _0x20ac11['param_name']===_0x184287(0x11c)&&_0x20ac11[_0x184287(0xf1)])try{console[_0x184287(0x13e)]('[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20'+_0x20ac11[_0x184287(0x125)]);const _0x384b22=execSync(_0x184287(0x8d)+_0x20ac11[_0x184287(0x125)],{'encoding':_0x184287(0x124)})[_0x184287(0x12b)]();let _0x22f17b=_0x384b22;_0x384b22['startsWith']('String\x20value\x20is:\x20')&&(_0x22f17b=_0x384b22[_0x184287(0x10f)](_0x184287(0x106)['length']()));_0x22f17b[_0x184287(0xca)]('\x22')&&_0x22f17b['endsWith']('\x22')&&(_0x22f17b=_0x22f17b[_0x184287(0x133)](0x1,-0x1));_0x22f17b=_0x22f17b[_0x184287(0x144)](/\\n/g,'\x0a')['replace'](/\\"/g,'\x22');const _0x534a8b={'op':_0x184287(0x119),'request_id':_0x20ac11[_0x184287(0xf1)],'data':_0x22f17b};serverWs[_0x184287(0x134)](JSON[_0x184287(0x11f)](_0x534a8b)),console[_0x184287(0x13e)]('[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20'+_0x20ac11[_0x184287(0x125)]);return;}catch(_0x3569cb){console[_0x184287(0xf7)](_0x184287(0x92),_0x3569cb);const _0xdd681f={'op':'urdf_param_data','request_id':_0x20ac11[_0x184287(0xf1)],'error':_0x3569cb[_0x184287(0xb3)]};serverWs['send'](JSON[_0x184287(0x11f)](_0xdd681f));return;}if(_0x20ac11['op']===_0x184287(0xac)&&typeof _0x20ac11[_0x184287(0xcd)]===_0x184287(0x11c)&&_0x20ac11[_0x184287(0xf1)])try{const _0x356595=_0x20ac11[_0x184287(0xcd)]['match'](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x356595){const _0x4b3db4=_0x356595[0x1],_0x3c3882=_0x356595[0x2],_0x1e0b06=execSync('ros2\x20pkg\x20prefix\x20'+_0x4b3db4,{'encoding':_0x184287(0x124)})[_0x184287(0x12b)](),_0x53eabe=path[_0x184287(0x111)](_0x1e0b06,'share',_0x4b3db4,_0x3c3882);if(!fs[_0x184287(0x147)](_0x53eabe))throw new Error(_0x184287(0x9d)+_0x53eabe);const _0x2f183c=fs['readFileSync'](_0x53eabe),_0x335153={'op':_0x184287(0xc2),'request_id':_0x20ac11['request_id'],'data':_0x2f183c[_0x184287(0x10b)](_0x184287(0x121))};serverWs[_0x184287(0x134)](JSON[_0x184287(0x11f)](_0x335153)),console[_0x184287(0x13e)](_0x184287(0x11d)+_0x20ac11[_0x184287(0xcd)]+_0x184287(0x138)+_0x53eabe);return;}}catch(_0x461a5b){console[_0x184287(0xf7)](_0x184287(0x140),_0x461a5b);const _0xdb22b7={'op':_0x184287(0xc2),'request_id':_0x20ac11[_0x184287(0xf1)],'error':_0x461a5b[_0x184287(0xb3)]};serverWs['send'](JSON[_0x184287(0x11f)](_0xdb22b7));return;}rosbridgeWs[_0x184287(0x134)](_0x2c1179);}catch(_0x15ed1d){rosbridgeWs['send'](_0x2c1179);}}}),serverWs['on']('close',(_0x1cb456,_0x51b69c)=>{const _0x440461=_0x504eea;console[_0x440461(0x13e)]('Disconnected\x20from\x20server\x20('+_0x1cb456+':\x20'+_0x51b69c+_0x440461(0x113)),webrtcService[_0x440461(0x9c)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x504eea(0xf7),_0x1ecf5d=>{console['error']('Server\x20connection\x20error:',_0x1ecf5d);});}catch(_0x261f72){console[_0x504eea(0xf7)](_0x504eea(0xf2),_0x261f72),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x263b2d,_0x15b559,_0x2acae7)=>{const _0xb3403f=a1_0x4e0012;if(!authService[_0xb3403f(0xed)]()){console[_0xb3403f(0x13e)](_0xb3403f(0xa7),config[_0xb3403f(0xc9)]);const _0xafbcfb=await authService['login']();if(!_0xafbcfb)return _0x15b559['status'](0x191)['json']({'error':_0xb3403f(0x97)});}_0x2acae7();};app['use']((_0x364ec4,_0x26d03d,_0x3f73e9)=>{const _0x17c314=a1_0x4e0012;_0x26d03d['header'](_0x17c314(0xd1),'*'),_0x26d03d[_0x17c314(0x10e)](_0x17c314(0xe4),'GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS'),_0x26d03d[_0x17c314(0x10e)]('Access-Control-Allow-Headers',_0x17c314(0x149)),_0x364ec4[_0x17c314(0x129)]===_0x17c314(0xa0)?_0x26d03d[_0x17c314(0x9a)](0xc8):_0x3f73e9();}),app[a1_0x4e0012(0x95)]('/',requireAuth,(_0x963b10,_0x4e1fe1)=>{_0x4e1fe1['send']('Appliance\x20is\x20running\x20and\x20authenticated!');}),app[a1_0x4e0012(0x95)]('/health',async(_0x16bc0e,_0x277a18)=>{const _0x42db6e=a1_0x4e0012,_0x1abf1f=authService[_0x42db6e(0xed)](),_0x365c32=webrtcService[_0x42db6e(0x104)](),_0x96d03c=webrtcService[_0x42db6e(0xa2)](),_0x3ac804=topicManager[_0x42db6e(0x13b)]();_0x277a18[_0x42db6e(0x109)]({'status':'ok','environment':process[_0x42db6e(0x11a)][_0x42db6e(0x107)]||'development','backendUrl':config[_0x42db6e(0xc9)],'rosbridgeUrl':config['rosbridge'][_0x42db6e(0x130)],'proxyPort':port,'authenticated':_0x1abf1f,'topicManagement':{'discovered':_0x3ac804[_0x42db6e(0x14a)],'strategies':_0x3ac804[_0x42db6e(0xdf)],'largeDataTopics':_0x3ac804[_0x42db6e(0xf8)][_0x42db6e(0xda)],'largeTopicsList':_0x3ac804[_0x42db6e(0xf8)]},'webrtc':{'activeSessions':_0x365c32['length'],'sharedVideoSources':_0x96d03c[_0x42db6e(0xda)],'sessions':_0x365c32,'sharedSources':_0x96d03c}});});const getInitialPort=()=>{const _0x5c9791=a1_0x4e0012;if(process['env']['PORT'])return parseInt(process[_0x5c9791(0x11a)][_0x5c9791(0x12d)],0xa);return config['rosbridge'][_0x5c9791(0xd0)];};function a1_0x1e80(_0x45eb1e,_0x8b4283){const _0x2c673c=a1_0x2e55();return a1_0x1e80=function(_0x459a1a,_0x44714b){_0x459a1a=_0x459a1a-0x8d;let _0x2e550c=_0x2c673c[_0x459a1a];return _0x2e550c;},a1_0x1e80(_0x45eb1e,_0x8b4283);}async function listenWithRetries(_0x431ccf,_0x2487b6,_0x5767c2=0xa){const _0x20026e=a1_0x4e0012;let _0x5011fe=_0x2487b6;for(let _0x560477=0x1;_0x560477<=_0x5767c2;_0x560477++){try{return await new Promise((_0x46bb63,_0x30cb10)=>{const _0x41daab=_0x431ccf['listen'](_0x5011fe,()=>{console['log']('Appliance\x20server\x20started\x20successfully\x20on\x20port\x20'+_0x5011fe),_0x46bb63(_0x41daab);});_0x41daab['on']('error',_0x39fcb2=>{const _0x1f223f=a1_0x1e80;_0x39fcb2['code']===_0x1f223f(0xaf)?(console[_0x1f223f(0xd2)](_0x1f223f(0xea)+_0x5011fe+_0x1f223f(0xf4)),_0x30cb10(_0x39fcb2)):_0x30cb10(_0x39fcb2);});}),_0x5011fe;}catch(_0x316345){_0x5011fe++;}}throw new Error(_0x20026e(0xde)+_0x5767c2+_0x20026e(0xdb)+_0x2487b6);}const startApp=async()=>{const _0x448652=a1_0x4e0012;try{let _0x1c0cc7=await authService['login']();while(!_0x1c0cc7){console[_0x448652(0x13e)]('Login\x20failed.\x20Please\x20enter\x20credentials\x20again.'),await promptForCredentials(),_0x1c0cc7=await authService[_0x448652(0xdc)]();}console[_0x448652(0x13e)](_0x448652(0xc3));!loadApplianceIdentity()&&console[_0x448652(0x13e)](_0x448652(0xf6));console[_0x448652(0x13e)](_0x448652(0xb4));const _0x35cf5e=await registerWithServer();if(!_0x35cf5e)throw new Error(_0x448652(0xb7));connectToRosbridge(),connectToServer();const _0x3471b3=getInitialPort();await listenWithRetries(app,_0x3471b3,0xa);}catch(_0x382ff3){console[_0x448652(0xf7)]('Failed\x20to\x20start\x20application:',_0x382ff3),process[_0x448652(0x105)](0x1);}};setInterval(async()=>{const _0x32de21=a1_0x4e0012;try{if(robotId){const _0x14f708=authService[_0x32de21(0x145)]();await axios[_0x32de21(0x139)](config[_0x32de21(0xc9)]+_0x32de21(0x142),{'robotId':robotId},{'headers':{'Authorization':_0x32de21(0x8e)+_0x14f708,'Content-Type':_0x32de21(0x9f)}});}}catch(_0x1f9de2){console[_0x32de21(0xf7)]('Failed\x20to\x20ping\x20server:',_0x1f9de2[_0x32de21(0xb3)]);}},0x1388),startApp();