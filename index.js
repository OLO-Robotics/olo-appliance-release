const a1_0x80a5e2=a1_0x5674;(function(_0x1803c8,_0x416c64){const _0x304724=a1_0x5674,_0x1efc37=_0x1803c8();while(!![]){try{const _0x2fc22f=parseInt(_0x304724(0x1ac))/0x1*(parseInt(_0x304724(0x186))/0x2)+-parseInt(_0x304724(0x148))/0x3*(parseInt(_0x304724(0x12d))/0x4)+parseInt(_0x304724(0x1cc))/0x5*(parseInt(_0x304724(0x171))/0x6)+parseInt(_0x304724(0x1a3))/0x7*(parseInt(_0x304724(0x12b))/0x8)+parseInt(_0x304724(0x12a))/0x9+parseInt(_0x304724(0x192))/0xa+-parseInt(_0x304724(0x137))/0xb*(parseInt(_0x304724(0x12c))/0xc);if(_0x2fc22f===_0x416c64)break;else _0x1efc37['push'](_0x1efc37['shift']());}catch(_0x1778c7){_0x1efc37['push'](_0x1efc37['shift']());}}}(a1_0x488f,0x7ca13));const a1_0x4cc559=(function(){let _0x52b19e=!![];return function(_0x55c7b5,_0x1a7eb1){const _0x27944b=_0x52b19e?function(){const _0x39ba5e=a1_0x5674;if(_0x1a7eb1){const _0x35e549=_0x1a7eb1[_0x39ba5e(0x1bc)](_0x55c7b5,arguments);return _0x1a7eb1=null,_0x35e549;}}:function(){};return _0x52b19e=![],_0x27944b;};}()),a1_0x7aa9c8=a1_0x4cc559(this,function(){const _0x2cd1a1=a1_0x5674;return a1_0x7aa9c8['toString']()[_0x2cd1a1(0x177)]('(((.+)+)+)+$')[_0x2cd1a1(0x187)]()[_0x2cd1a1(0x183)](a1_0x7aa9c8)[_0x2cd1a1(0x177)](_0x2cd1a1(0x164));});a1_0x7aa9c8();const express=require(a1_0x80a5e2(0x116)),config=require(a1_0x80a5e2(0x14a)),authService=require(a1_0x80a5e2(0x15d)),webrtcService=require(a1_0x80a5e2(0x1a8)),topicManager=require(a1_0x80a5e2(0x10e)),WebSocket=require('ws'),axios=require(a1_0x80a5e2(0x18a)),fs=require('fs'),prompt=require(a1_0x80a5e2(0x185))({'sigint':!![]}),dotenv=require('dotenv'),app=express(),port=process['env'][a1_0x80a5e2(0x119)]||config[a1_0x80a5e2(0x15b)][a1_0x80a5e2(0x1a0)],APPLIANCE_FILE='.appliance.json',{DOMParser,XMLSerializer}=require(a1_0x80a5e2(0x12e)),path=require(a1_0x80a5e2(0x13f)),{execSync}=require(a1_0x80a5e2(0x128)),APPLIANCE_BASE_URL=process[a1_0x80a5e2(0x156)][a1_0x80a5e2(0x14e)]||'';console[a1_0x80a5e2(0x197)](a1_0x80a5e2(0x13e)+(process[a1_0x80a5e2(0x156)][a1_0x80a5e2(0x180)]||a1_0x80a5e2(0x1ab))),console[a1_0x80a5e2(0x197)](a1_0x80a5e2(0x127)+config[a1_0x80a5e2(0x158)]),console[a1_0x80a5e2(0x197)]('ROSBridge\x20WebSocket\x20URL:\x20'+config[a1_0x80a5e2(0x15b)]['wsEndpoint']),console[a1_0x80a5e2(0x197)]('Proxy\x20listening\x20on\x20port:\x20'+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x10dc23,_0xc1b2f8){const _0x42c8b1=a1_0x80a5e2;fs['writeFileSync'](_0x42c8b1(0x1c8),'APP_USERNAME='+_0x10dc23+'\x0aAPP_PASSWORD='+_0xc1b2f8+'\x0a');}function reloadEnv(){const _0x25f675=a1_0x80a5e2;dotenv['config']({'override':!![]}),config[_0x25f675(0x195)]['username']=process['env'][_0x25f675(0x18f)],config[_0x25f675(0x195)][_0x25f675(0x150)]=process[_0x25f675(0x156)][_0x25f675(0x1af)];}async function promptForCredentials(){const _0x481b76=a1_0x80a5e2,_0x3d4908=prompt(_0x481b76(0x155)),_0x5fe290=prompt[_0x481b76(0x18c)](_0x481b76(0x18b));updateEnvFile(_0x3d4908,_0x5fe290),reloadEnv();}function loadApplianceIdentity(){const _0x141f09=a1_0x80a5e2;if(fs[_0x141f09(0x11e)](APPLIANCE_FILE))try{const _0xf63fde=JSON[_0x141f09(0x110)](fs['readFileSync'](APPLIANCE_FILE,_0x141f09(0x165)));if(_0xf63fde[_0x141f09(0x125)]&&_0xf63fde[_0x141f09(0x176)])return robotId=_0xf63fde[_0x141f09(0x125)],registrationToken=_0xf63fde[_0x141f09(0x176)],console[_0x141f09(0x197)](_0x141f09(0x1bf),robotId),topicManager[_0x141f09(0x182)](_0xf63fde),!![];}catch(_0x584fdb){console[_0x141f09(0x10c)](_0x141f09(0x11f),_0x584fdb);}return![];}function saveApplianceIdentity(_0x5e9977,_0x3897e2){const _0x545c5=a1_0x80a5e2;let _0x331f2c={};if(fs[_0x545c5(0x11e)](APPLIANCE_FILE))try{_0x331f2c=JSON['parse'](fs[_0x545c5(0x18e)](APPLIANCE_FILE,_0x545c5(0x165)));}catch(_0x130c00){_0x331f2c={};}_0x331f2c[_0x545c5(0x125)]=_0x5e9977,_0x331f2c[_0x545c5(0x176)]=_0x3897e2,fs['writeFileSync'](APPLIANCE_FILE,JSON['stringify'](_0x331f2c,null,0x2));}async function registerWithServer(){const _0x1f2315=a1_0x80a5e2;try{const _0x4f5d60=authService['getToken']();if(!_0x4f5d60)throw new Error('Not\x20authenticated');let _0x572340,_0x238e26=![];while(!![]){try{robotId&&registrationToken?_0x572340=await axios[_0x1f2315(0x1c9)](config[_0x1f2315(0x158)]+_0x1f2315(0x133),{'name':_0x1f2315(0x163),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x1f2315(0x189)+_0x4f5d60,'Content-Type':_0x1f2315(0x198)}}):_0x572340=await axios[_0x1f2315(0x1c9)](config[_0x1f2315(0x158)]+_0x1f2315(0x133),{'name':'WSL\x20Appliance'},{'headers':{'Authorization':_0x1f2315(0x189)+_0x4f5d60,'Content-Type':'application/json'}});break;}catch(_0x5dd6ca){const _0x29298b=_0x5dd6ca?.[_0x1f2315(0x114)]?.['data']?.['error']||_0x5dd6ca[_0x1f2315(0x149)];if(!_0x238e26&&_0x29298b&&_0x29298b[_0x1f2315(0x122)]()['includes']('robot\x20not\x20found')){console[_0x1f2315(0x1c3)]('Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.');if(fs[_0x1f2315(0x11e)](APPLIANCE_FILE))fs[_0x1f2315(0x16c)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0x238e26=!![];continue;}throw _0x5dd6ca;}}if(!_0x572340[_0x1f2315(0x11d)]||!_0x572340[_0x1f2315(0x11d)][_0x1f2315(0x134)]||!_0x572340[_0x1f2315(0x11d)]['id'])throw new Error(_0x1f2315(0x15a));return registrationToken=_0x572340[_0x1f2315(0x11d)][_0x1f2315(0x134)],robotId=_0x572340[_0x1f2315(0x11d)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x1f2315(0x197)](_0x1f2315(0x118)),!![];}catch(_0x509e3d){return console[_0x1f2315(0x10c)](_0x1f2315(0x126),_0x509e3d[_0x1f2315(0x149)]),![];}}function rewriteUrdfMeshUris(_0xdbe837){const _0x52d7db=a1_0x80a5e2;try{const _0x5dede6=new DOMParser(),_0x7a8d97=_0x5dede6[_0x52d7db(0x19a)](_0xdbe837,_0x52d7db(0x173));let _0xdacff6=0x0,_0x19f261=0x0;const _0x2f6c90=_0x7a8d97[_0x52d7db(0x19b)](_0x52d7db(0x13a));for(let _0x1f0e51=0x0;_0x1f0e51<_0x2f6c90[_0x52d7db(0x1cb)];_0x1f0e51++){const _0x265f78=_0x2f6c90[_0x1f0e51],_0x12381d=_0x265f78[_0x52d7db(0x15c)](_0x52d7db(0x18d)),_0x2e2e5c=[_0x52d7db(0x17b),'.dae',_0x52d7db(0x1c4),_0x52d7db(0x15e),_0x52d7db(0x14d)],_0x776500=_0x2e2e5c[_0x52d7db(0x188)](_0x549d2f=>_0x12381d[_0x52d7db(0x122)]()[_0x52d7db(0x142)](_0x549d2f));if(_0x12381d&&_0x12381d[_0x52d7db(0x17f)]('package://')&&_0x776500){_0xdacff6++;const _0x9165f0=APPLIANCE_BASE_URL+'/ros/mesh?uri='+encodeURIComponent(_0x12381d);_0x265f78[_0x52d7db(0x12f)]('filename',_0x9165f0),_0x19f261++,console['log'](_0x52d7db(0x131)+_0x12381d+_0x52d7db(0x1c6)+_0x9165f0);}}_0xdacff6>0x0?console[_0x52d7db(0x197)](_0x52d7db(0x17e)+_0x19f261+_0x52d7db(0x143)+_0xdacff6+_0x52d7db(0x1bd)):console[_0x52d7db(0x197)]('[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF');const _0x213504=new XMLSerializer();return _0x213504[_0x52d7db(0x172)](_0x7a8d97);}catch(_0x2ea9e6){return console[_0x52d7db(0x10c)](_0x52d7db(0x1c5),_0x2ea9e6),_0xdbe837;}}function a1_0x488f(){const _0x402ad0=['setAttribute','mesh_data','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','ROSBridge\x20(WebRTC)\x20connection\x20error:','/appliance/register','registration_token','login','get_urdf_param','847AHhEjE','header','code','mesh','\x20from\x20','status','replace','Environment:\x20','path','handleMessage','get','endsWith','\x20of\x20','webrtc_skip','ros2\x20pkg\x20prefix\x20','largeDataTopics','Disconnected\x20from\x20server\x20(','661953iPPiPy','message','./config','uri','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20','.mesh','APPLIANCE_BASE_URL','Access-Control-Allow-Origin','password','service','string','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','strategies','Enter\x20username:\x20','env','trim','serverUrl','Port\x20','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','rosbridge','getAttribute','./services/auth','.ply','topic','name','stringify','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','WSL\x20Appliance','(((.+)+)+)+$','utf8','String\x20value\x20is:\x20','/robot_description','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','estimatedSize','EADDRINUSE','/health','unlinkSync','\x20attempts\x20starting\x20from\x20','msg','param_name','stopAllSessions','1087872PfepFs','serializeToString','text/xml','samplingRate','),\x20attempting\x20to\x20reconnect...','registrationToken','search','types','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','topics','.stl','map','substring','[URDF\x20REWRITE]\x20Rewrote\x20','startsWith','NODE_ENV','base64','loadConfig','constructor','Failed\x20to\x20start\x20application:','prompt-sync','46666SiZqpF','toString','some','Bearer\x20','axios','Enter\x20password:\x20','hide','filename','readFileSync','APP_USERNAME','ROSBridge\x20(main)\x20connection\x20error:','/appliance/ping','4619680MvaaNF','initialize','strategy','credentials','getStatistics','log','application/json','urdf_param_data','parseFromString','getElementsByTagName','slice','[MESH]\x20Successfully\x20served\x20mesh:\x20','service_response','Failed\x20to\x20connect\x20to\x20server:','proxyPort','values','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','46676gcRFah','unknown','send','Topic\x20discovery\x20failed:','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','./services/webrtcService','Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...','wsEndpoint','development','5EilSuc','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','discoverTopics','APP_PASSWORD','readyState','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','OPEN','action','publish','Successfully\x20logged\x20in','Attempting\x20to\x20login\x20to:','open','getSharedVideoSources','totalTopics','/rosbridge?type=appliance&token=','throttling','apply','\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)','Ros','Loaded\x20appliance\x20identity:','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','http','sendStatus','warn','.obj','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','\x20->\x20','json','.env','post','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','length','5IIyUqW','match','Access-Control-Allow-Methods','error','exit','./services/TopicManager','sample','parse','Connected\x20to\x20server','Failed\x20to\x20ping\x20server:','Server\x20connection\x20error:','response','isAuthenticated','express','get_mesh','Successfully\x20registered\x20with\x20server','PORT','Failed\x20to\x20register\x20with\x20server','method','request_id','data','existsSync','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','sample_skip','roslib','toLowerCase','share','close','robotId','Failed\x20to\x20register\x20with\x20server:','Backend\x20Server\x20URL:\x20','child_process','/rosapi/topics','2924316EwBrcl','1112hwmkjV','199572pvMSBL','4ENeLUN','xmldom'];a1_0x488f=function(){return _0x402ad0;};return a1_0x488f();}function connectToRosbridge(){const _0x23f619=a1_0x80a5e2;try{rosbridgeWs=new WebSocket(config[_0x23f619(0x15b)][_0x23f619(0x1aa)]),rosbridgeWs['on'](_0x23f619(0x1b7),()=>{const _0x1ea342=_0x23f619;console['log']('Connected\x20to\x20ROSBridge\x20(main)');const _0xb0a0d5=require(_0x1ea342(0x121)),_0x5e884a=new _0xb0a0d5[(_0x1ea342(0x1be))]({'url':config[_0x1ea342(0x15b)][_0x1ea342(0x1aa)]});_0x5e884a['on']('connection',()=>{setTimeout(()=>{const _0x1a0b69=a1_0x5674;topicManager[_0x1a0b69(0x1ae)](_0x5e884a)['catch'](_0x415884=>{const _0x18ad9e=_0x1a0b69;console[_0x18ad9e(0x10c)](_0x18ad9e(0x1a6),_0x415884);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x23f619(0x149),_0xa20657=>{const _0x189245=_0x23f619;if(serverWs&&serverWs[_0x189245(0x1b0)]===WebSocket['OPEN']){let _0x4dc765=_0xa20657['toString']();try{const _0x5122b0=JSON[_0x189245(0x110)](_0x4dc765);if(_0x5122b0['op']===_0x189245(0x1b4)&&_0x5122b0['topic']){const _0x23e1af=topicManager[_0x189245(0x140)](_0x5122b0);switch(_0x23e1af[_0x189245(0x1b3)]){case _0x189245(0x120):return;case _0x189245(0x144):return;case'forward':default:_0x4dc765=JSON['stringify'](_0x23e1af['message']);break;}}if((_0x5122b0['op']===_0x189245(0x19e)||_0x5122b0['op']==='call_service')&&(_0x5122b0[_0x189245(0x151)]===_0x189245(0x129)||_0x5122b0[_0x189245(0x1a1)]&&_0x5122b0[_0x189245(0x1a1)][_0x189245(0x17a)])){console[_0x189245(0x197)](_0x189245(0x1c0));const _0x102166=_0x5122b0[_0x189245(0x1a1)]?.[_0x189245(0x17a)]||[],_0x2a1841=_0x5122b0[_0x189245(0x1a1)]?.[_0x189245(0x178)]||[],_0xa58175=_0x102166['map']((_0x3f5925,_0x24c700)=>{const _0x4e6041=_0x189245,_0x38d024=topicManager['getTopicStrategy'](_0x3f5925);return{'name':_0x3f5925,'type':_0x2a1841[_0x24c700]||_0x4e6041(0x1a4),'throttling':_0x38d024?{'isThrottled':_0x38d024[_0x4e6041(0x194)]===_0x4e6041(0x10f),'strategy':_0x38d024['strategy'],'samplingRate':_0x38d024[_0x4e6041(0x174)],'reason':_0x38d024['reason'],'estimatedSize':_0x38d024[_0x4e6041(0x169)]}:null};});_0x5122b0[_0x189245(0x1a1)]={'topics':_0xa58175[_0x189245(0x17c)](_0x5deb8a=>_0x5deb8a[_0x189245(0x160)]),'types':_0xa58175[_0x189245(0x17c)](_0x38c070=>_0x38c070['type']),'throttling':_0xa58175[_0x189245(0x17c)](_0xccbd32=>_0xccbd32[_0x189245(0x1bb)])},_0x4dc765=JSON['stringify'](_0x5122b0),console[_0x189245(0x197)](_0x189245(0x153));}if(_0x5122b0['op']===_0x189245(0x1b4)&&_0x5122b0[_0x189245(0x15f)]===_0x189245(0x167))try{const _0xff1039=_0x5122b0[_0x189245(0x16e)]['data'],_0x4c2424=rewriteUrdfMeshUris(_0xff1039);_0x5122b0[_0x189245(0x16e)][_0x189245(0x11d)]=_0x4c2424,_0x4dc765=JSON[_0x189245(0x161)](_0x5122b0);}catch(_0x6aaf91){console[_0x189245(0x10c)]('[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:',_0x6aaf91);}}catch(_0x25a617){console[_0x189245(0x1c3)]('[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:',_0x25a617[_0x189245(0x149)]);}serverWs['send'](_0x4dc765);}}),rosbridgeWs['on'](_0x23f619(0x124),()=>{const _0x29dfc8=_0x23f619;console[_0x29dfc8(0x197)](_0x29dfc8(0x1a2)),webrtcService[_0x29dfc8(0x170)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on'](_0x23f619(0x10c),_0xf19486=>{const _0x5b8009=_0x23f619;console['error'](_0x5b8009(0x190),_0xf19486);});}catch(_0x14eebd){console[_0x23f619(0x10c)]('Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):',_0x14eebd),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0x1de0be=a1_0x80a5e2;try{rosbridgeWebRTCWs=new WebSocket(config[_0x1de0be(0x15b)][_0x1de0be(0x1aa)]),rosbridgeWebRTCWs['on'](_0x1de0be(0x1b7),()=>{const _0x487f0a=_0x1de0be;console['log']('Connected\x20to\x20ROSBridge\x20(WebRTC)'),webrtcService[_0x487f0a(0x193)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0x1de0be(0x149),_0x2bb4f1=>{}),rosbridgeWebRTCWs['on'](_0x1de0be(0x124),()=>{const _0x158c62=_0x1de0be;console[_0x158c62(0x197)](_0x158c62(0x1a9)),webrtcService['stopAllSessions'](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on']('error',_0x2b94a5=>{const _0x5b4882=_0x1de0be;console[_0x5b4882(0x10c)](_0x5b4882(0x132),_0x2b94a5);});}catch(_0xe9f92){console[_0x1de0be(0x10c)](_0x1de0be(0x1ca),_0xe9f92),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x186460=a1_0x80a5e2;try{if(!registrationToken)throw new Error(_0x186460(0x1b1));const _0x10ff25=config[_0x186460(0x158)][_0x186460(0x13d)](_0x186460(0x1c1),'ws')+_0x186460(0x1ba)+registrationToken;serverWs=new WebSocket(_0x10ff25),serverWs['on'](_0x186460(0x1b7),()=>{const _0x428d1a=_0x186460;console['log'](_0x428d1a(0x111)),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x428d1a(0x1b0)]===WebSocket[_0x428d1a(0x1b2)]&&webrtcService[_0x428d1a(0x193)](rosbridgeWebRTCWs,serverWs);}),serverWs['on']('message',_0x1382cc=>{const _0x2f59e9=_0x186460;if(rosbridgeWs&&rosbridgeWs[_0x2f59e9(0x1b0)]===WebSocket[_0x2f59e9(0x1b2)]){let _0x15ea7c=_0x1382cc['toString']();try{const _0x375555=JSON[_0x2f59e9(0x110)](_0x15ea7c);if(webrtcService[_0x2f59e9(0x140)](_0x375555))return;if(_0x375555['op']===_0x2f59e9(0x136)&&typeof _0x375555[_0x2f59e9(0x16f)]===_0x2f59e9(0x152)&&_0x375555[_0x2f59e9(0x11c)])try{console[_0x2f59e9(0x197)](_0x2f59e9(0x168)+_0x375555[_0x2f59e9(0x16f)]);const _0x5de5aa=execSync('ros2\x20param\x20get\x20'+_0x375555[_0x2f59e9(0x16f)],{'encoding':_0x2f59e9(0x165)})[_0x2f59e9(0x157)]();let _0x2a8829=_0x5de5aa;_0x5de5aa[_0x2f59e9(0x17f)]('String\x20value\x20is:\x20')&&(_0x2a8829=_0x5de5aa[_0x2f59e9(0x17d)](_0x2f59e9(0x166)['length']()));_0x2a8829['startsWith']('\x22')&&_0x2a8829[_0x2f59e9(0x142)]('\x22')&&(_0x2a8829=_0x2a8829[_0x2f59e9(0x19c)](0x1,-0x1));_0x2a8829=_0x2a8829[_0x2f59e9(0x13d)](/\\n/g,'\x0a')[_0x2f59e9(0x13d)](/\\"/g,'\x22');const _0x8d063={'op':_0x2f59e9(0x199),'request_id':_0x375555[_0x2f59e9(0x11c)],'data':_0x2a8829};serverWs['send'](JSON[_0x2f59e9(0x161)](_0x8d063)),console[_0x2f59e9(0x197)](_0x2f59e9(0x14c)+_0x375555[_0x2f59e9(0x16f)]);return;}catch(_0x5488ac){console['error'](_0x2f59e9(0x1ad),_0x5488ac);const _0x539539={'op':'urdf_param_data','request_id':_0x375555['request_id'],'error':_0x5488ac[_0x2f59e9(0x149)]};serverWs['send'](JSON[_0x2f59e9(0x161)](_0x539539));return;}if(_0x375555['op']===_0x2f59e9(0x117)&&typeof _0x375555[_0x2f59e9(0x14b)]===_0x2f59e9(0x152)&&_0x375555[_0x2f59e9(0x11c)])try{const _0x2ef6da=_0x375555[_0x2f59e9(0x14b)][_0x2f59e9(0x1cd)](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x2ef6da){const _0x12e8b6=_0x2ef6da[0x1],_0x5177d0=_0x2ef6da[0x2],_0x106ca6=execSync(_0x2f59e9(0x145)+_0x12e8b6,{'encoding':'utf8'})[_0x2f59e9(0x157)](),_0x13c8b3=path['join'](_0x106ca6,_0x2f59e9(0x123),_0x12e8b6,_0x5177d0);if(!fs['existsSync'](_0x13c8b3))throw new Error('Mesh\x20file\x20not\x20found:\x20'+_0x13c8b3);const _0x513a0c=fs[_0x2f59e9(0x18e)](_0x13c8b3),_0x59ca81={'op':_0x2f59e9(0x130),'request_id':_0x375555[_0x2f59e9(0x11c)],'data':_0x513a0c['toString'](_0x2f59e9(0x181))};serverWs['send'](JSON[_0x2f59e9(0x161)](_0x59ca81)),console[_0x2f59e9(0x197)](_0x2f59e9(0x19d)+_0x375555[_0x2f59e9(0x14b)]+_0x2f59e9(0x13b)+_0x13c8b3);return;}}catch(_0x71f8ae){console[_0x2f59e9(0x10c)]('[MESH]\x20Error\x20serving\x20mesh:',_0x71f8ae);const _0x76c5ff={'op':_0x2f59e9(0x130),'request_id':_0x375555[_0x2f59e9(0x11c)],'error':_0x71f8ae[_0x2f59e9(0x149)]};serverWs['send'](JSON[_0x2f59e9(0x161)](_0x76c5ff));return;}rosbridgeWs[_0x2f59e9(0x1a5)](_0x15ea7c);}catch(_0x4158a1){rosbridgeWs[_0x2f59e9(0x1a5)](_0x15ea7c);}}}),serverWs['on']('close',(_0x1ba129,_0x48d97a)=>{const _0x3cf513=_0x186460;console[_0x3cf513(0x197)](_0x3cf513(0x147)+_0x1ba129+':\x20'+_0x48d97a+_0x3cf513(0x175)),webrtcService['stopAllSessions'](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x186460(0x10c),_0x5e5ea3=>{const _0x2af7e0=_0x186460;console[_0x2af7e0(0x10c)](_0x2af7e0(0x113),_0x5e5ea3);});}catch(_0x3a1f9c){console['error'](_0x186460(0x19f),_0x3a1f9c),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x597687,_0x113dc0,_0x5258cc)=>{const _0x4ae9b6=a1_0x80a5e2;if(!authService[_0x4ae9b6(0x115)]()){console[_0x4ae9b6(0x197)](_0x4ae9b6(0x1b6),config[_0x4ae9b6(0x158)]);const _0x585b80=await authService[_0x4ae9b6(0x135)]();if(!_0x585b80)return _0x113dc0[_0x4ae9b6(0x13c)](0x191)[_0x4ae9b6(0x1c7)]({'error':'Authentication\x20required'});}_0x5258cc();};function a1_0x5674(_0x4de4f3,_0x42aad4){const _0x48879f=a1_0x488f();return a1_0x5674=function(_0x7aa9c8,_0x4cc559){_0x7aa9c8=_0x7aa9c8-0x10b;let _0x488f27=_0x48879f[_0x7aa9c8];return _0x488f27;},a1_0x5674(_0x4de4f3,_0x42aad4);}app['use']((_0x18c660,_0x1f4e5c,_0x43b340)=>{const _0x5403b5=a1_0x80a5e2;_0x1f4e5c['header'](_0x5403b5(0x14f),'*'),_0x1f4e5c[_0x5403b5(0x138)](_0x5403b5(0x10b),_0x5403b5(0x1a7)),_0x1f4e5c['header']('Access-Control-Allow-Headers',_0x5403b5(0x162)),_0x18c660[_0x5403b5(0x11b)]==='OPTIONS'?_0x1f4e5c[_0x5403b5(0x1c2)](0xc8):_0x43b340();}),app[a1_0x80a5e2(0x141)]('/',requireAuth,(_0x58b34c,_0x3cb398)=>{const _0x45d7d2=a1_0x80a5e2;_0x3cb398[_0x45d7d2(0x1a5)]('Appliance\x20is\x20running\x20and\x20authenticated!');}),app[a1_0x80a5e2(0x141)](a1_0x80a5e2(0x16b),async(_0x57156f,_0x9b5beb)=>{const _0x4fc2a3=a1_0x80a5e2,_0x21c6d2=authService[_0x4fc2a3(0x115)](),_0x437ea8=webrtcService['getActiveSessions'](),_0x20ce22=webrtcService[_0x4fc2a3(0x1b8)](),_0xc4a065=topicManager[_0x4fc2a3(0x196)]();_0x9b5beb['json']({'status':'ok','environment':process[_0x4fc2a3(0x156)][_0x4fc2a3(0x180)]||_0x4fc2a3(0x1ab),'backendUrl':config[_0x4fc2a3(0x158)],'rosbridgeUrl':config[_0x4fc2a3(0x15b)][_0x4fc2a3(0x1aa)],'proxyPort':port,'authenticated':_0x21c6d2,'topicManagement':{'discovered':_0xc4a065[_0x4fc2a3(0x1b9)],'strategies':_0xc4a065[_0x4fc2a3(0x154)],'largeDataTopics':_0xc4a065[_0x4fc2a3(0x146)]['length'],'largeTopicsList':_0xc4a065[_0x4fc2a3(0x146)]},'webrtc':{'activeSessions':_0x437ea8['length'],'sharedVideoSources':_0x20ce22[_0x4fc2a3(0x1cb)],'sessions':_0x437ea8,'sharedSources':_0x20ce22}});});const getInitialPort=()=>{const _0x22ee43=a1_0x80a5e2;if(process['env'][_0x22ee43(0x119)])return parseInt(process[_0x22ee43(0x156)]['PORT'],0xa);return config[_0x22ee43(0x15b)][_0x22ee43(0x1a0)];};async function listenWithRetries(_0x4532e7,_0x183e0f,_0x264078=0xa){const _0x5ee4c1=a1_0x80a5e2;let _0x481808=_0x183e0f;for(let _0x104c90=0x1;_0x104c90<=_0x264078;_0x104c90++){try{return await new Promise((_0x5d4732,_0x3d1c97)=>{const _0x2bd304=_0x4532e7['listen'](_0x481808,()=>{const _0x500568=a1_0x5674;console[_0x500568(0x197)]('Appliance\x20server\x20started\x20successfully\x20on\x20port\x20'+_0x481808),_0x5d4732(_0x2bd304);});_0x2bd304['on']('error',_0x2b8131=>{const _0x5cbe1a=a1_0x5674;_0x2b8131[_0x5cbe1a(0x139)]===_0x5cbe1a(0x16a)?(console['warn'](_0x5cbe1a(0x159)+_0x481808+'\x20in\x20use,\x20trying\x20next\x20port...'),_0x3d1c97(_0x2b8131)):_0x3d1c97(_0x2b8131);});}),_0x481808;}catch(_0x286c5b){_0x481808++;}}throw new Error('Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20'+_0x264078+_0x5ee4c1(0x16d)+_0x183e0f);}const startApp=async()=>{const _0xa0afbd=a1_0x80a5e2;try{let _0x369924=await authService[_0xa0afbd(0x135)]();while(!_0x369924){console['log'](_0xa0afbd(0x179)),await promptForCredentials(),_0x369924=await authService[_0xa0afbd(0x135)]();}console[_0xa0afbd(0x197)](_0xa0afbd(0x1b5));!loadApplianceIdentity()&&console[_0xa0afbd(0x197)]('No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.');console[_0xa0afbd(0x197)]('Registering\x20with\x20server...');const _0xeb404=await registerWithServer();if(!_0xeb404)throw new Error(_0xa0afbd(0x11a));connectToRosbridge(),connectToServer();const _0xc45422=getInitialPort();await listenWithRetries(app,_0xc45422,0xa);}catch(_0x3b1b3f){console[_0xa0afbd(0x10c)](_0xa0afbd(0x184),_0x3b1b3f),process[_0xa0afbd(0x10d)](0x1);}};setInterval(async()=>{const _0x1c05a2=a1_0x80a5e2;try{if(robotId){const _0x4ddc8c=authService['getToken']();await axios[_0x1c05a2(0x1c9)](config[_0x1c05a2(0x158)]+_0x1c05a2(0x191),{'robotId':robotId},{'headers':{'Authorization':_0x1c05a2(0x189)+_0x4ddc8c,'Content-Type':'application/json'}});}}catch(_0x4a83ba){console[_0x1c05a2(0x10c)](_0x1c05a2(0x112),_0x4a83ba['message']);}},0x1388),startApp();