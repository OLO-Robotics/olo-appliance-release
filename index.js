function a1_0x4e7c(_0x4f4040,_0x21062b){const _0xd9969e=a1_0xb300();return a1_0x4e7c=function(_0x2367a6,_0x5852d8){_0x2367a6=_0x2367a6-0xf2;let _0xb30071=_0xd9969e[_0x2367a6];return _0xb30071;},a1_0x4e7c(_0x4f4040,_0x21062b);}const a1_0x4f4340=a1_0x4e7c;(function(_0x33e82e,_0x442998){const _0x2dc005=a1_0x4e7c,_0x1703d8=_0x33e82e();while(!![]){try{const _0x4671bf=parseInt(_0x2dc005(0x19d))/0x1+parseInt(_0x2dc005(0x164))/0x2*(parseInt(_0x2dc005(0x16a))/0x3)+-parseInt(_0x2dc005(0x14f))/0x4+parseInt(_0x2dc005(0x118))/0x5+parseInt(_0x2dc005(0x19c))/0x6*(parseInt(_0x2dc005(0x108))/0x7)+-parseInt(_0x2dc005(0xfa))/0x8+-parseInt(_0x2dc005(0x193))/0x9;if(_0x4671bf===_0x442998)break;else _0x1703d8['push'](_0x1703d8['shift']());}catch(_0x215be9){_0x1703d8['push'](_0x1703d8['shift']());}}}(a1_0xb300,0xe8d54));const a1_0x5852d8=(function(){let _0x598466=!![];return function(_0x16238b,_0x5a1b3d){const _0x5b2bc8=_0x598466?function(){const _0x26a921=a1_0x4e7c;if(_0x5a1b3d){const _0x6842c7=_0x5a1b3d[_0x26a921(0x1b0)](_0x16238b,arguments);return _0x5a1b3d=null,_0x6842c7;}}:function(){};return _0x598466=![],_0x5b2bc8;};}()),a1_0x2367a6=a1_0x5852d8(this,function(){const _0x312e92=a1_0x4e7c;return a1_0x2367a6['toString']()[_0x312e92(0x12c)](_0x312e92(0x178))[_0x312e92(0x17e)]()['constructor'](a1_0x2367a6)[_0x312e92(0x12c)](_0x312e92(0x178));});a1_0x2367a6();const express=require(a1_0x4f4340(0x13f)),config=require(a1_0x4f4340(0x1ac)),authService=require('./services/auth'),webrtcService=require(a1_0x4f4340(0x103)),topicManager=require('./services/TopicManager'),WebSocket=require('ws'),axios=require('axios'),fs=require('fs'),prompt=require('prompt-sync')({'sigint':!![]}),dotenv=require(a1_0x4f4340(0x11a)),app=express(),port=process[a1_0x4f4340(0x15f)][a1_0x4f4340(0x18b)]||config['rosbridge']['proxyPort'],APPLIANCE_FILE='.appliance.json',{DOMParser,XMLSerializer}=require(a1_0x4f4340(0x104)),path=require(a1_0x4f4340(0x129)),{execSync}=require('child_process'),APPLIANCE_BASE_URL=process[a1_0x4f4340(0x15f)][a1_0x4f4340(0x10a)]||'';console['log'](a1_0x4f4340(0x1af)+(process[a1_0x4f4340(0x15f)][a1_0x4f4340(0x126)]||'development')),console['log']('Backend\x20Server\x20URL:\x20'+config[a1_0x4f4340(0x1b1)]),console[a1_0x4f4340(0x153)](a1_0x4f4340(0x125)+config[a1_0x4f4340(0x162)]['wsEndpoint']),console['log'](a1_0x4f4340(0x142)+port);let serverWs=null,rosbridgeWs=null,rosbridgeWebRTCWs=null,registrationToken=null,robotId=null;function updateEnvFile(_0x2b6239,_0x1721dd){const _0x4fcca7=a1_0x4f4340;fs[_0x4fcca7(0x10d)](_0x4fcca7(0x121),_0x4fcca7(0x18a)+_0x2b6239+_0x4fcca7(0x163)+_0x1721dd+'\x0a');}function reloadEnv(){const _0x37f2e0=a1_0x4f4340;dotenv[_0x37f2e0(0x1a8)]({'override':!![]}),config[_0x37f2e0(0xf7)][_0x37f2e0(0x134)]=process['env'][_0x37f2e0(0x16d)],config[_0x37f2e0(0xf7)]['password']=process[_0x37f2e0(0x15f)][_0x37f2e0(0x15b)];}async function promptForCredentials(){const _0x352fde=a1_0x4f4340,_0x5de0b8=prompt(_0x352fde(0x132)),_0x174993=prompt[_0x352fde(0xf3)](_0x352fde(0x184));updateEnvFile(_0x5de0b8,_0x174993),reloadEnv();}function a1_0xb300(){const _0x9fabb0=['\x20attempts\x20starting\x20from\x20','990kTofuY','1441821byMTLa','throttling','package://','catch','filename','getActiveSessions','Failed\x20to\x20connect\x20to\x20server:','\x20in\x20use,\x20trying\x20next\x20port...','/robot_description','data','uri','config','WSL\x20Appliance','Topic\x20discovery\x20failed:','\x20->\x20','./config','warn','send','Environment:\x20','apply','serverUrl','replace','login','application/json','ROSBridge\x20(WebRTC)\x20connection\x20error:','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(WebRTC):','Registering\x20with\x20server...','hide','getTopicStrategy','open','sample_skip','credentials','get_urdf_param','/appliance/ping','14459304uosGis','totalTopics','[MESH]\x20Successfully\x20served\x20mesh:\x20','status','robotId','use','[TopicManager]\x20Enhanced\x20topics\x20response\x20sent\x20to\x20client','Login\x20failed.\x20Please\x20enter\x20credentials\x20again.','[URDF\x20REWRITE]\x20Rewrote\x20','./services/webrtcService','xmldom','Connected\x20to\x20ROSBridge\x20(main)','Access-Control-Allow-Origin','topic','2009ahgvyX','\x20from\x20','APPLIANCE_BASE_URL','forward','[MESH]\x20Error\x20serving\x20mesh:','writeFileSync','String\x20value\x20is:\x20','Appliance\x20is\x20running\x20and\x20authenticated!','Loaded\x20appliance\x20identity:','Origin,\x20X-Requested-With,\x20Content-Type,\x20Accept,\x20Authorization','GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','stopAllSessions','json','strategy','strategies','\x20of\x20','2234410qpRJaq','get_mesh','dotenv','join','/appliance/register','ros2\x20pkg\x20prefix\x20','header','roslib','[URDF\x20REWRITE]\x20No\x20mesh\x20references\x20found\x20in\x20URDF','.env','.obj','service_response','toLowerCase','ROSBridge\x20WebSocket\x20URL:\x20','NODE_ENV','proxyPort','handleMessage','path','param_name','endsWith','search','[URDF\x20PARAM]\x20Fetching\x20URDF\x20from\x20parameter:\x20','startsWith','connection','Failed\x20to\x20connect\x20to\x20ROSBridge\x20(main):','utf8','Enter\x20username:\x20','Bearer\x20','username','/rosapi/topics','samplingRate','msg','message','get','OPEN','[URDF\x20REWRITE]\x20Rewrote\x20mesh\x20URI:\x20','exit','trim','Port\x20','express','string','/rosbridge?type=appliance&token=','Proxy\x20listening\x20on\x20port:\x20','close','readFileSync','Failed\x20to\x20register\x20with\x20server','unlinkSync','urdf_param_data','/ros/mesh?uri=','service','unknown','types','[URDF\x20PARAM]\x20Error\x20fetching\x20URDF\x20parameter:','request_id','Failed\x20to\x20parse\x20appliance\x20identity\x20file:','3575004ZlxohJ','.stl','Disconnected\x20from\x20server\x20(','largeDataTopics','log','Mesh\x20file\x20not\x20found:\x20','action','registrationToken','setAttribute','length','Access-Control-Allow-Headers','discoverTopics','APP_PASSWORD','Connected\x20to\x20ROSBridge\x20(WebRTC)','estimatedSize','name','env','Failed\x20to\x20start\x20application:','mesh','rosbridge','\x0aAPP_PASSWORD=','18YFYNPL','parse','error','some','reason','publish','582789isTtSJ','EADDRINUSE','wsEndpoint','APP_USERNAME','isAuthenticated','initialize','[TopicManager]\x20Enhancing\x20topics\x20response\x20with\x20throttling\x20metadata','[URDF\x20REWRITE]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs\x20in\x20URDF\x20(WebSocket):','slice','Failed\x20to\x20get\x20registration\x20token\x20or\x20robot\x20id\x20from\x20server','type','topics','registration_token','Server\x20connection\x20error:','(((.+)+)+)+$','includes','values','existsSync','post','stringify','toString','http','Robot\x20not\x20found\x20on\x20server.\x20Deleting\x20local\x20identity\x20and\x20re-registering.','getToken','listen','Registration\x20token\x20not\x20found.\x20Please\x20register\x20this\x20appliance\x20first.','Enter\x20password:\x20','webrtc_skip','code','Appliance\x20server\x20started\x20successfully\x20on\x20port\x20','Authentication\x20required','getAttribute','APP_USERNAME=','PORT','base64','readyState','robot\x20not\x20found','parseFromString','serializeToString','call_service','getStatistics','266193vAegKG','map','mesh_data','Disconnected\x20from\x20ROSBridge\x20(main),\x20attempting\x20to\x20reconnect...','/health','[URDF]\x20Failed\x20to\x20rewrite\x20mesh\x20URIs:','ROSBridge\x20(main)\x20connection\x20error:','[URDF\x20PARAM]\x20Successfully\x20served\x20URDF\x20parameter:\x20'];a1_0xb300=function(){return _0x9fabb0;};return a1_0xb300();}function loadApplianceIdentity(){const _0x5b0702=a1_0x4f4340;if(fs[_0x5b0702(0x17b)](APPLIANCE_FILE))try{const _0x16ebcc=JSON['parse'](fs[_0x5b0702(0x144)](APPLIANCE_FILE,_0x5b0702(0x131)));if(_0x16ebcc[_0x5b0702(0xfe)]&&_0x16ebcc[_0x5b0702(0x156)])return robotId=_0x16ebcc['robotId'],registrationToken=_0x16ebcc[_0x5b0702(0x156)],console[_0x5b0702(0x153)](_0x5b0702(0x110),robotId),topicManager['loadConfig'](_0x16ebcc),!![];}catch(_0x592cf7){console[_0x5b0702(0x166)](_0x5b0702(0x14e),_0x592cf7);}return![];}function saveApplianceIdentity(_0x339848,_0x26565f){const _0x26b2ba=a1_0x4f4340;let _0x1e2298={};if(fs['existsSync'](APPLIANCE_FILE))try{_0x1e2298=JSON[_0x26b2ba(0x165)](fs[_0x26b2ba(0x144)](APPLIANCE_FILE,'utf8'));}catch(_0x56bdd0){_0x1e2298={};}_0x1e2298['robotId']=_0x339848,_0x1e2298[_0x26b2ba(0x156)]=_0x26565f,fs[_0x26b2ba(0x10d)](APPLIANCE_FILE,JSON[_0x26b2ba(0x17d)](_0x1e2298,null,0x2));}async function registerWithServer(){const _0x2d3667=a1_0x4f4340;try{const _0xee3b40=authService[_0x2d3667(0x181)]();if(!_0xee3b40)throw new Error('Not\x20authenticated');let _0x26f882,_0xbf03da=![];while(!![]){try{robotId&&registrationToken?_0x26f882=await axios[_0x2d3667(0x17c)](config['serverUrl']+_0x2d3667(0x11c),{'name':_0x2d3667(0x1a9),'robotId':robotId,'registration_token':registrationToken},{'headers':{'Authorization':_0x2d3667(0x133)+_0xee3b40,'Content-Type':_0x2d3667(0x1b4)}}):_0x26f882=await axios[_0x2d3667(0x17c)](config[_0x2d3667(0x1b1)]+_0x2d3667(0x11c),{'name':_0x2d3667(0x1a9)},{'headers':{'Authorization':_0x2d3667(0x133)+_0xee3b40,'Content-Type':_0x2d3667(0x1b4)}});break;}catch(_0x2489ac){const _0x3d8d3e=_0x2489ac?.['response']?.[_0x2d3667(0x1a6)]?.[_0x2d3667(0x166)]||_0x2489ac[_0x2d3667(0x138)];if(!_0xbf03da&&_0x3d8d3e&&_0x3d8d3e[_0x2d3667(0x124)]()[_0x2d3667(0x179)](_0x2d3667(0x18e))){console['warn'](_0x2d3667(0x180));if(fs[_0x2d3667(0x17b)](APPLIANCE_FILE))fs[_0x2d3667(0x146)](APPLIANCE_FILE);robotId=null,registrationToken=null,_0xbf03da=!![];continue;}throw _0x2489ac;}}if(!_0x26f882[_0x2d3667(0x1a6)]||!_0x26f882[_0x2d3667(0x1a6)][_0x2d3667(0x176)]||!_0x26f882[_0x2d3667(0x1a6)]['id'])throw new Error(_0x2d3667(0x173));return registrationToken=_0x26f882[_0x2d3667(0x1a6)]['registration_token'],robotId=_0x26f882[_0x2d3667(0x1a6)]['id'],saveApplianceIdentity(robotId,registrationToken),console[_0x2d3667(0x153)]('Successfully\x20registered\x20with\x20server'),!![];}catch(_0x3d05cc){return console[_0x2d3667(0x166)]('Failed\x20to\x20register\x20with\x20server:',_0x3d05cc[_0x2d3667(0x138)]),![];}}function rewriteUrdfMeshUris(_0x388e57){const _0xa7f140=a1_0x4f4340;try{const _0x24fe5c=new DOMParser(),_0x4b319f=_0x24fe5c[_0xa7f140(0x18f)](_0x388e57,'text/xml');let _0x2fcb6b=0x0,_0x514884=0x0;const _0x428159=_0x4b319f['getElementsByTagName'](_0xa7f140(0x161));for(let _0x2af4c0=0x0;_0x2af4c0<_0x428159['length'];_0x2af4c0++){const _0x99a0f8=_0x428159[_0x2af4c0],_0x33bd61=_0x99a0f8[_0xa7f140(0x189)](_0xa7f140(0x1a1)),_0x167edb=[_0xa7f140(0x150),'.dae',_0xa7f140(0x122),'.ply','.mesh'],_0x2699cf=_0x167edb[_0xa7f140(0x167)](_0x525acd=>_0x33bd61[_0xa7f140(0x124)]()[_0xa7f140(0x12b)](_0x525acd));if(_0x33bd61&&_0x33bd61[_0xa7f140(0x12e)](_0xa7f140(0x19f))&&_0x2699cf){_0x2fcb6b++;const _0xa596a9=APPLIANCE_BASE_URL+_0xa7f140(0x148)+encodeURIComponent(_0x33bd61);_0x99a0f8[_0xa7f140(0x157)](_0xa7f140(0x1a1),_0xa596a9),_0x514884++,console[_0xa7f140(0x153)](_0xa7f140(0x13b)+_0x33bd61+_0xa7f140(0x1ab)+_0xa596a9);}}_0x2fcb6b>0x0?console['log'](_0xa7f140(0x102)+_0x514884+_0xa7f140(0x117)+_0x2fcb6b+'\x20mesh\x20references\x20in\x20URDF\x20(WebSocket)'):console['log'](_0xa7f140(0x120));const _0x327d8f=new XMLSerializer();return _0x327d8f[_0xa7f140(0x190)](_0x4b319f);}catch(_0x3d2326){return console[_0xa7f140(0x166)](_0xa7f140(0x171),_0x3d2326),_0x388e57;}}function connectToRosbridge(){const _0x181f4a=a1_0x4f4340;try{rosbridgeWs=new WebSocket(config[_0x181f4a(0x162)][_0x181f4a(0x16c)]),rosbridgeWs['on'](_0x181f4a(0xf5),()=>{const _0x4fc236=_0x181f4a;console['log'](_0x4fc236(0x105));const _0xb1e6e8=require(_0x4fc236(0x11f)),_0x4f4c0b=new _0xb1e6e8['Ros']({'url':config[_0x4fc236(0x162)][_0x4fc236(0x16c)]});_0x4f4c0b['on'](_0x4fc236(0x12f),()=>{setTimeout(()=>{const _0x14bfb5=a1_0x4e7c;topicManager[_0x14bfb5(0x15a)](_0x4f4c0b)[_0x14bfb5(0x1a0)](_0x3a0818=>{const _0x598c6d=_0x14bfb5;console[_0x598c6d(0x166)](_0x598c6d(0x1aa),_0x3a0818);});},0x3e8);}),connectToRosbridgeWebRTC();}),rosbridgeWs['on'](_0x181f4a(0x138),_0x4db2fe=>{const _0x44191e=_0x181f4a;if(serverWs&&serverWs[_0x44191e(0x18d)]===WebSocket['OPEN']){let _0x4a33e6=_0x4db2fe[_0x44191e(0x17e)]();try{const _0x16ea8c=JSON[_0x44191e(0x165)](_0x4a33e6);if(_0x16ea8c['op']===_0x44191e(0x169)&&_0x16ea8c[_0x44191e(0x107)]){const _0x15a660=topicManager['handleMessage'](_0x16ea8c);switch(_0x15a660[_0x44191e(0x155)]){case _0x44191e(0xf6):return;case _0x44191e(0x185):return;case _0x44191e(0x10b):default:_0x4a33e6=JSON[_0x44191e(0x17d)](_0x15a660[_0x44191e(0x138)]);break;}}if((_0x16ea8c['op']===_0x44191e(0x123)||_0x16ea8c['op']===_0x44191e(0x191))&&(_0x16ea8c[_0x44191e(0x149)]===_0x44191e(0x135)||_0x16ea8c[_0x44191e(0x17a)]&&_0x16ea8c[_0x44191e(0x17a)][_0x44191e(0x175)])){console['log'](_0x44191e(0x170));const _0x37c38a=_0x16ea8c[_0x44191e(0x17a)]?.[_0x44191e(0x175)]||[],_0xb57e96=_0x16ea8c['values']?.[_0x44191e(0x14b)]||[],_0x4f4a11=_0x37c38a[_0x44191e(0x194)]((_0x2494bb,_0x5051f7)=>{const _0x1515c3=_0x44191e,_0xfe8c65=topicManager[_0x1515c3(0xf4)](_0x2494bb);return{'name':_0x2494bb,'type':_0xb57e96[_0x5051f7]||_0x1515c3(0x14a),'throttling':_0xfe8c65?{'isThrottled':_0xfe8c65[_0x1515c3(0x115)]==='sample','strategy':_0xfe8c65[_0x1515c3(0x115)],'samplingRate':_0xfe8c65[_0x1515c3(0x136)],'reason':_0xfe8c65[_0x1515c3(0x168)],'estimatedSize':_0xfe8c65[_0x1515c3(0x15d)]}:null};});_0x16ea8c[_0x44191e(0x17a)]={'topics':_0x4f4a11[_0x44191e(0x194)](_0x27b75e=>_0x27b75e[_0x44191e(0x15e)]),'types':_0x4f4a11[_0x44191e(0x194)](_0x5b6592=>_0x5b6592[_0x44191e(0x174)]),'throttling':_0x4f4a11['map'](_0x1034bf=>_0x1034bf[_0x44191e(0x19e)])},_0x4a33e6=JSON[_0x44191e(0x17d)](_0x16ea8c),console[_0x44191e(0x153)](_0x44191e(0x100));}if(_0x16ea8c['op']===_0x44191e(0x169)&&_0x16ea8c['topic']===_0x44191e(0x1a5))try{const _0x57402f=_0x16ea8c[_0x44191e(0x137)][_0x44191e(0x1a6)],_0xd6c904=rewriteUrdfMeshUris(_0x57402f);_0x16ea8c[_0x44191e(0x137)][_0x44191e(0x1a6)]=_0xd6c904,_0x4a33e6=JSON['stringify'](_0x16ea8c);}catch(_0x672bdf){console['error'](_0x44191e(0x198),_0x672bdf);}}catch(_0x1a1d47){console[_0x44191e(0x1ad)]('[ROSBridge]\x20Failed\x20to\x20parse\x20message\x20for\x20topic\x20management:',_0x1a1d47[_0x44191e(0x138)]);}serverWs['send'](_0x4a33e6);}}),rosbridgeWs['on']('close',()=>{const _0x271cf3=_0x181f4a;console[_0x271cf3(0x153)](_0x271cf3(0x196)),webrtcService[_0x271cf3(0x113)](),setTimeout(connectToRosbridge,0x1388);}),rosbridgeWs['on']('error',_0x43b31d=>{const _0x2817ac=_0x181f4a;console[_0x2817ac(0x166)](_0x2817ac(0x199),_0x43b31d);});}catch(_0x7af8fd){console[_0x181f4a(0x166)](_0x181f4a(0x130),_0x7af8fd),setTimeout(connectToRosbridge,0x1388);}}function connectToRosbridgeWebRTC(){const _0xb68310=a1_0x4f4340;try{rosbridgeWebRTCWs=new WebSocket(config[_0xb68310(0x162)]['wsEndpoint']),rosbridgeWebRTCWs['on'](_0xb68310(0xf5),()=>{const _0x1f5c1a=_0xb68310;console[_0x1f5c1a(0x153)](_0x1f5c1a(0x15c)),webrtcService[_0x1f5c1a(0x16f)](rosbridgeWebRTCWs,serverWs);}),rosbridgeWebRTCWs['on'](_0xb68310(0x138),_0x263960=>{}),rosbridgeWebRTCWs['on'](_0xb68310(0x143),()=>{const _0x2df389=_0xb68310;console[_0x2df389(0x153)]('Disconnected\x20from\x20ROSBridge\x20(WebRTC),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x2df389(0x113)](),setTimeout(connectToRosbridgeWebRTC,0x1388);}),rosbridgeWebRTCWs['on']('error',_0x3bad6e=>{const _0x4e560c=_0xb68310;console[_0x4e560c(0x166)](_0x4e560c(0x1b5),_0x3bad6e);});}catch(_0x188925){console['error'](_0xb68310(0x1b6),_0x188925),setTimeout(connectToRosbridgeWebRTC,0x1388);}}function connectToServer(){const _0x2da011=a1_0x4f4340;try{if(!registrationToken)throw new Error(_0x2da011(0x183));const _0x5f428d=config[_0x2da011(0x1b1)][_0x2da011(0x1b2)](_0x2da011(0x17f),'ws')+_0x2da011(0x141)+registrationToken;serverWs=new WebSocket(_0x5f428d),serverWs['on'](_0x2da011(0xf5),()=>{const _0x2caad8=_0x2da011;console['log']('Connected\x20to\x20server'),rosbridgeWebRTCWs&&rosbridgeWebRTCWs[_0x2caad8(0x18d)]===WebSocket[_0x2caad8(0x13a)]&&webrtcService['initialize'](rosbridgeWebRTCWs,serverWs);}),serverWs['on'](_0x2da011(0x138),_0x1491bc=>{const _0x43eb4c=_0x2da011;if(rosbridgeWs&&rosbridgeWs[_0x43eb4c(0x18d)]===WebSocket['OPEN']){let _0x575096=_0x1491bc[_0x43eb4c(0x17e)]();try{const _0x39b96f=JSON[_0x43eb4c(0x165)](_0x575096);if(webrtcService[_0x43eb4c(0x128)](_0x39b96f))return;if(_0x39b96f['op']===_0x43eb4c(0xf8)&&typeof _0x39b96f[_0x43eb4c(0x12a)]===_0x43eb4c(0x140)&&_0x39b96f['request_id'])try{console[_0x43eb4c(0x153)](_0x43eb4c(0x12d)+_0x39b96f['param_name']);const _0x293932=execSync('ros2\x20param\x20get\x20'+_0x39b96f[_0x43eb4c(0x12a)],{'encoding':_0x43eb4c(0x131)})[_0x43eb4c(0x13d)]();let _0x23e44f=_0x293932;_0x293932[_0x43eb4c(0x12e)](_0x43eb4c(0x10e))&&(_0x23e44f=_0x293932['substring']('String\x20value\x20is:\x20'[_0x43eb4c(0x158)]()));_0x23e44f['startsWith']('\x22')&&_0x23e44f[_0x43eb4c(0x12b)]('\x22')&&(_0x23e44f=_0x23e44f[_0x43eb4c(0x172)](0x1,-0x1));_0x23e44f=_0x23e44f['replace'](/\\n/g,'\x0a')[_0x43eb4c(0x1b2)](/\\"/g,'\x22');const _0x3a3048={'op':_0x43eb4c(0x147),'request_id':_0x39b96f['request_id'],'data':_0x23e44f};serverWs[_0x43eb4c(0x1ae)](JSON[_0x43eb4c(0x17d)](_0x3a3048)),console[_0x43eb4c(0x153)](_0x43eb4c(0x19a)+_0x39b96f['param_name']);return;}catch(_0x27cdc5){console[_0x43eb4c(0x166)](_0x43eb4c(0x14c),_0x27cdc5);const _0x182bca={'op':'urdf_param_data','request_id':_0x39b96f['request_id'],'error':_0x27cdc5[_0x43eb4c(0x138)]};serverWs[_0x43eb4c(0x1ae)](JSON['stringify'](_0x182bca));return;}if(_0x39b96f['op']===_0x43eb4c(0x119)&&typeof _0x39b96f['uri']===_0x43eb4c(0x140)&&_0x39b96f['request_id'])try{const _0x1ac9dd=_0x39b96f[_0x43eb4c(0x1a7)]['match'](/^package:\/\/([^\/]+)\/(.+)$/);if(_0x1ac9dd){const _0x2d0ec3=_0x1ac9dd[0x1],_0x42ab79=_0x1ac9dd[0x2],_0x5b192c=execSync(_0x43eb4c(0x11d)+_0x2d0ec3,{'encoding':_0x43eb4c(0x131)})[_0x43eb4c(0x13d)](),_0x37a631=path[_0x43eb4c(0x11b)](_0x5b192c,'share',_0x2d0ec3,_0x42ab79);if(!fs['existsSync'](_0x37a631))throw new Error(_0x43eb4c(0x154)+_0x37a631);const _0x3eae9c=fs[_0x43eb4c(0x144)](_0x37a631),_0x9d2deb={'op':_0x43eb4c(0x195),'request_id':_0x39b96f[_0x43eb4c(0x14d)],'data':_0x3eae9c[_0x43eb4c(0x17e)](_0x43eb4c(0x18c))};serverWs['send'](JSON[_0x43eb4c(0x17d)](_0x9d2deb)),console[_0x43eb4c(0x153)](_0x43eb4c(0xfc)+_0x39b96f['uri']+_0x43eb4c(0x109)+_0x37a631);return;}}catch(_0x2517a7){console['error'](_0x43eb4c(0x10c),_0x2517a7);const _0x2f8348={'op':_0x43eb4c(0x195),'request_id':_0x39b96f[_0x43eb4c(0x14d)],'error':_0x2517a7[_0x43eb4c(0x138)]};serverWs['send'](JSON['stringify'](_0x2f8348));return;}rosbridgeWs[_0x43eb4c(0x1ae)](_0x575096);}catch(_0x3f355d){rosbridgeWs['send'](_0x575096);}}}),serverWs['on'](_0x2da011(0x143),(_0x223683,_0x56179a)=>{const _0x219a07=_0x2da011;console[_0x219a07(0x153)](_0x219a07(0x151)+_0x223683+':\x20'+_0x56179a+'),\x20attempting\x20to\x20reconnect...'),webrtcService[_0x219a07(0x113)](),setTimeout(connectToServer,0x1388);}),serverWs['on'](_0x2da011(0x166),_0x726ac3=>{const _0x20c221=_0x2da011;console[_0x20c221(0x166)](_0x20c221(0x177),_0x726ac3);});}catch(_0x393ff8){console[_0x2da011(0x166)](_0x2da011(0x1a3),_0x393ff8),setTimeout(connectToServer,0x1388);}}const requireAuth=async(_0x19604d,_0x30bd65,_0x3dbf8d)=>{const _0x5915fd=a1_0x4f4340;if(!authService[_0x5915fd(0x16e)]()){console[_0x5915fd(0x153)]('Attempting\x20to\x20login\x20to:',config[_0x5915fd(0x1b1)]);const _0x3bf62f=await authService[_0x5915fd(0x1b3)]();if(!_0x3bf62f)return _0x30bd65[_0x5915fd(0xfd)](0x191)[_0x5915fd(0x114)]({'error':_0x5915fd(0x188)});}_0x3dbf8d();};app[a1_0x4f4340(0xff)]((_0x47488a,_0x129fbb,_0x32d24e)=>{const _0x4fa679=a1_0x4f4340;_0x129fbb[_0x4fa679(0x11e)](_0x4fa679(0x106),'*'),_0x129fbb[_0x4fa679(0x11e)]('Access-Control-Allow-Methods',_0x4fa679(0x112)),_0x129fbb[_0x4fa679(0x11e)](_0x4fa679(0x159),_0x4fa679(0x111)),_0x47488a['method']==='OPTIONS'?_0x129fbb['sendStatus'](0xc8):_0x32d24e();}),app[a1_0x4f4340(0x139)]('/',requireAuth,(_0xa15203,_0x28871e)=>{const _0x16e21b=a1_0x4f4340;_0x28871e[_0x16e21b(0x1ae)](_0x16e21b(0x10f));}),app[a1_0x4f4340(0x139)](a1_0x4f4340(0x197),async(_0x546114,_0x2004e8)=>{const _0x2fc923=a1_0x4f4340,_0x2673dd=authService[_0x2fc923(0x16e)](),_0x3863c1=webrtcService[_0x2fc923(0x1a2)](),_0x37edaa=webrtcService['getSharedVideoSources'](),_0x1a426b=topicManager[_0x2fc923(0x192)]();_0x2004e8[_0x2fc923(0x114)]({'status':'ok','environment':process['env']['NODE_ENV']||'development','backendUrl':config[_0x2fc923(0x1b1)],'rosbridgeUrl':config[_0x2fc923(0x162)][_0x2fc923(0x16c)],'proxyPort':port,'authenticated':_0x2673dd,'topicManagement':{'discovered':_0x1a426b[_0x2fc923(0xfb)],'strategies':_0x1a426b[_0x2fc923(0x116)],'largeDataTopics':_0x1a426b[_0x2fc923(0x152)][_0x2fc923(0x158)],'largeTopicsList':_0x1a426b[_0x2fc923(0x152)]},'webrtc':{'activeSessions':_0x3863c1[_0x2fc923(0x158)],'sharedVideoSources':_0x37edaa[_0x2fc923(0x158)],'sessions':_0x3863c1,'sharedSources':_0x37edaa}});});const getInitialPort=()=>{const _0x4b7fae=a1_0x4f4340;if(process['env'][_0x4b7fae(0x18b)])return parseInt(process[_0x4b7fae(0x15f)][_0x4b7fae(0x18b)],0xa);return config[_0x4b7fae(0x162)][_0x4b7fae(0x127)];};async function listenWithRetries(_0x1cfb40,_0x33d424,_0x3c0e87=0xa){const _0x4bf86c=a1_0x4f4340;let _0x24e656=_0x33d424;for(let _0x7f597a=0x1;_0x7f597a<=_0x3c0e87;_0x7f597a++){try{return await new Promise((_0x5bc1b4,_0x4f2b74)=>{const _0x5ee703=a1_0x4e7c,_0x2a8b21=_0x1cfb40[_0x5ee703(0x182)](_0x24e656,()=>{const _0x20b741=_0x5ee703;console[_0x20b741(0x153)](_0x20b741(0x187)+_0x24e656),_0x5bc1b4(_0x2a8b21);});_0x2a8b21['on'](_0x5ee703(0x166),_0x599037=>{const _0x4a742b=_0x5ee703;_0x599037[_0x4a742b(0x186)]===_0x4a742b(0x16b)?(console[_0x4a742b(0x1ad)](_0x4a742b(0x13e)+_0x24e656+_0x4a742b(0x1a4)),_0x4f2b74(_0x599037)):_0x4f2b74(_0x599037);});}),_0x24e656;}catch(_0x57ddcb){_0x24e656++;}}throw new Error('Failed\x20to\x20bind\x20to\x20a\x20port\x20after\x20'+_0x3c0e87+_0x4bf86c(0x19b)+_0x33d424);}const startApp=async()=>{const _0x4513fe=a1_0x4f4340;try{let _0x197ce=await authService[_0x4513fe(0x1b3)]();while(!_0x197ce){console[_0x4513fe(0x153)](_0x4513fe(0x101)),await promptForCredentials(),_0x197ce=await authService['login']();}console['log']('Successfully\x20logged\x20in');!loadApplianceIdentity()&&console[_0x4513fe(0x153)]('No\x20appliance\x20identity\x20found.\x20Registering\x20as\x20new.');console[_0x4513fe(0x153)](_0x4513fe(0xf2));const _0x343cc6=await registerWithServer();if(!_0x343cc6)throw new Error(_0x4513fe(0x145));connectToRosbridge(),connectToServer();const _0x9305ce=getInitialPort();await listenWithRetries(app,_0x9305ce,0xa);}catch(_0x52535b){console[_0x4513fe(0x166)](_0x4513fe(0x160),_0x52535b),process[_0x4513fe(0x13c)](0x1);}};setInterval(async()=>{const _0x19cbd6=a1_0x4f4340;try{if(robotId){const _0x300040=authService[_0x19cbd6(0x181)]();await axios[_0x19cbd6(0x17c)](config[_0x19cbd6(0x1b1)]+_0x19cbd6(0xf9),{'robotId':robotId},{'headers':{'Authorization':_0x19cbd6(0x133)+_0x300040,'Content-Type':'application/json'}});}}catch(_0x301424){console[_0x19cbd6(0x166)]('Failed\x20to\x20ping\x20server:',_0x301424[_0x19cbd6(0x138)]);}},0x1388),startApp();